var Laya=window.Laya=function(h,t){var u={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(t,e){return 1==arguments.length?u.__presubstr.call(this,t):u.__presubstr.call(this,t,0<e?e:this.length+e)},__init:function(t){t.forEach(function(t){t.__init$&&t.__init$()})},__isClass:function(t){return t&&(t.__isclass||t==Object||t==String||t==Array)},__newvec:function(t,e){var i=[];i.length=t;for(var n=0;n<t;n++)i[n]=e;return i},__extend:function(t,e){for(var i in e)if(e.hasOwnProperty(i)){var n=Object.getOwnPropertyDescriptor(e,i),r=n.get,a=n.set;r||a?r&&a?Object.defineProperty(t,i,n):(r&&Object.defineProperty(t,i,r),a&&Object.defineProperty(t,i,a)):t[i]=e[i]}function s(){u.un(this,"constructor",t)}s.prototype=e.prototype,t.prototype=new s,u.un(t.prototype,"__imps",u.__copy({},e.prototype.__imps))},__copy:function(t,e){if(!e)return null;for(var i in t=t||{},e)t[i]=e[i];return t},__package:function(t,e){if(!u.__packages[t]){u.__packages[t]=!0;var i=h,n=t.split(".");if(1<n.length)for(var r=0,a=n.length-1;r<a;r++){var s=i[n[r]];i=s||(i[n[r]]={})}i[n[n.length-1]]||(i[n[n.length-1]]=e||{})}},__hasOwnProperty:function(t,e){return e=e||this,Object.hasOwnProperty.call(e,t)||function t(e,i){if(Object.hasOwnProperty.call(i.prototype,e))return!0;var n=i.prototype.__super;return null==n?null:t(e,n)}(t,e.__class)},__typeof:function(t,e){if(!t||!e)return!1;if(e===String)return"string"==typeof t;if(e===Number)return"number"==typeof t;if(e.__interface__)e=e.__interface__;else if("string"!=typeof e)return t instanceof e;return t.__imps&&t.__imps[e]||t.__class==e},__as:function(t,e){return this.__typeof(t,e)?t:null},__int:function(t){return t?parseInt(t):0},interface:function(t,e){u.__package(t,{});var i=u.__internals,n=i[t]=i[t]||{self:t};if(e){var r=e.split(",");n.extend=[];for(var a=0;a<r.length;a++){var s=r[a];i[s]=i[s]||{self:s},n.extend.push(i[s])}}var o=h,l=t.split(".");for(a=0;a<l.length-1;a++)o=o[l[a]];o[l[l.length-1]]={__interface__:t}},class:function(t,e,i,n){if(i&&u.__extend(t,i),e)if(u.__package(e,t),u.__classmap[e]=t,0<e.indexOf(".")){if(0==e.indexOf("laya.")){var r=e.split(".");n=n||r[r.length-1],u[n]&&console.log("Warning!,this class["+n+"] already exist:",u[n]),u[n]=t}}else"Main"==e?h.Main=t:(u[e]&&console.log("Error!,this class["+e+"] already exist:",u[e]),u[e]=t);var a=u.un,s=t.prototype;a(s,"hasOwnProperty",u.__hasOwnProperty),a(s,"__class",t),a(s,"__super",i),a(s,"__className",e),a(t,"__super",i),a(t,"__className",e),a(t,"__isclass",!0),a(t,"super",function(t){this.__super.call(t)})},imps:function(t,e){if(!e)return null;var r=t.__imps||u.un(t,"__imps",{});function a(t){var e,i;if((e=u.__internals[t])&&(r[t]=!0,i=e.extend))for(var n=0;n<i.length;n++)a(i[n].self)}for(var i in e)a(i)},superSet:function(t,e,i,n){var r=t.prototype["_$set_"+i];r&&r.call(e,n)},superGet:function(t,e,i){var n=t.prototype["_$get_"+i];return n?n.call(e):null},getset:function(t,e,i,n,r){t?(n&&(e["_$GET_"+i]=n),r&&(e["_$SET_"+i]=r)):(n&&u.un(e,"_$get_"+i,n),r&&u.un(e,"_$set_"+i,r)),n&&r?Object.defineProperty(e,i,{get:n,set:r,enumerable:!1,configurable:!0}):(n&&Object.defineProperty(e,i,{get:n,enumerable:!1,configurable:!0}),r&&Object.defineProperty(e,i,{set:r,enumerable:!1,configurable:!0}))},static:function(i,n){for(var r=0,t=n.length;r<t;r+=2)if("length"==n[r])i.length=n[r+1].call(i);else{function e(){var e=n[r],t=n[r+1];Object.defineProperty(i,e,{get:function(){return delete this[e],this[e]=t.call(this)},set:function(t){delete this[e],this[e]=t},enumerable:!0,configurable:!0})}e()}},un:function(t,e,i){return i||(i=t[e]),u.__propun.value=i,Object.defineProperty(t,e,u.__propun),i},uns:function(e,t){t.forEach(function(t){u.un(e,t)})}};return h.console=h.console||{log:function(){}},h.trace=h.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),u}(window,document);!function(t,e,i){i.un,i.uns,i.static,i.class,i.getset,i.__newvec}(window,document,Laya),function(window,document,Laya){var __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;Laya.interface("laya.runtime.IMarket"),Laya.interface("laya.filters.IFilter"),Laya.interface("laya.display.ILayout"),Laya.interface("laya.resource.IDispose"),Laya.interface("laya.runtime.IPlatform"),Laya.interface("laya.resource.IDestroy"),Laya.interface("laya.runtime.IConchNode"),Laya.interface("laya.filters.IFilterAction"),Laya.interface("laya.runtime.ICPlatformClass"),Laya.interface("laya.resource.ICreateResource"),Laya.interface("laya.runtime.IConchRenderObject"),Laya.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var RunDriver=function(){function a(){}return __class(a,"laya.utils.RunDriver"),a.FILTER_ACTIONS=[],a.pixelRatio=-1,a._charSizeTestDiv=null,a.now=function(){return Date.now()},a.getWindow=function(){return window},a.getPixelRatio=function(){if(a.pixelRatio<0){var t=Browser.context,e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;(a.pixelRatio=(Browser.window.devicePixelRatio||1)/e)<1&&(a.pixelRatio=1)}return a.pixelRatio},a.getIncludeStr=function(t){return null},a.createShaderCondition=function(t){var e="(function() {return "+t+";})";return Browser.window.eval(e)},a.fontMap=[],a.measureText=function(t,e){var i=a.hanzi.test(t);if(i&&a.fontMap[e])return a.fontMap[e];var n=Browser.context;n.font=e;var r=n.measureText(t);return i&&(a.fontMap[e]=r),r},a.getWebGLContext=function(t){},a.beginFlush=function(){},a.endFinish=function(){},a.addToAtlas=null,a.flashFlushImage=function(t){},a.drawToCanvas=function(t,e,i,n,r,a){var s=HTMLCanvas.create("2D"),o=new RenderContext(i,n,s);return RenderSprite.renders[e]._fun(t,o,r,a),s},a.createParticleTemplate2D=null,a.createGLTextur=null,a.createWebGLContext2D=null,a.changeWebGLSize=function(t,e){},a.createRenderSprite=function(t,e){return new RenderSprite(t,e)},a.createFilterAction=function(t){return new ColorFilterAction},a.createGraphics=function(){return new Graphics},a.clear=function(t){Render._context.ctx.clear()},a.cancelLoadByUrl=function(t){},a.clearAtlas=function(t){},a.isAtlas=function(t){return!1},a.addTextureToAtlas=function(t){},a.getTexturePixels=function(t,e,i,n,r){return null},a.skinAniSprite=function(){return null},a.update3DLoop=function(){},__static(a,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),a}(),___Laya=(__getset(1,Laya,"alertGlobalError",null,function(t){var a=0;Browser.window.onerror=t?function(t,e,i,n,r){a++<5&&r&&alert("出错啦，请把此信息截图给研发商\n"+t+"\n"+r.stack||r)}:null}),Laya.init=function(t,e,i){for(var n=[],r=2,a=arguments.length;r<a;r++)n.push(arguments[r]);if(!Laya._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=Laya._arrayBufferSlice),Laya._isinit=!0,Browser.__init__(),Context.__init__(),Graphics.__init__(),Laya.timer=new Timer,Laya.scaleTimer=new Timer,Laya.loader=new LoaderManager,WeakObject.__init__(),r=0;for(var s=n.length;r<s;r++)n[r].enable&&n[r].enable();return Font.__init__(),Style.__init__(),ResourceManager.__init__(),CacheManager.beginCheck(),Laya._currentStage=Laya.stage=new Stage,Laya.stage.conchModel&&Laya.stage.conchModel.setRootNode(),Laya.getUrlPath(),Laya.render=new Render(0,0),Laya.stage.size(t,e),RenderSprite.__init__(),KeyBoardManager.__init__(),MouseManager.instance.__init__(Laya.stage,Render.canvas),Input.__init__(),SoundManager.autoStopMusic=!0,LocalStorage.__init__(),Render.canvas}},Laya.getUrlPath=function(){var t=Browser.window.location,e=t.pathname;e=":"==e.charAt(2)?e.substring(1):e,URL.rootPath=URL.basePath=URL.getPath("file:"==t.protocol?e:t.protocol+"//"+t.host+t.pathname)},Laya._arrayBufferSlice=function(t,e){var i=new Uint8Array(this,t,e-t),n=new Uint8Array(i.length);return n.set(i),n.buffer},Laya._runScript=function(t){return Browser.window["e"+String.fromCharCode(118)+"al"](t)},Laya.stage=null,Laya.timer=null,Laya.scaleTimer=null,Laya.loader=null,Laya.version="1.7.17",Laya.render=null,Laya._currentStage=null,Laya._isinit=!1,Laya.MiniAdpter={init:function(){window.navigator&&window.navigator.userAgent&&-1<window.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},__static(Laya,["conchMarket",function(){return this.conchMarket=window.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=window.PlatformClass}]),Laya),Config=function(){function t(){}return __class(t,"Config"),t.WebGLTextCacheCount=500,t.atlasEnable=!1,t.showCanvasMark=!1,t.animationInterval=50,t.isAntialias=!1,t.isAlpha=!1,t.premultipliedAlpha=!0,t.isStencil=!0,t.preserveDrawingBuffer=!1,t}(),EventDispatcher=function(){var l;function e(){this._events=null}__class(e,"laya.events.EventDispatcher");var t=e.prototype;return t.hasListener=function(t){return!!(this._events&&this._events[t])},t.event=function(t,e){if(!this._events||!this._events[t])return!1;var i=this._events[t];if(i.run)i.once&&delete this._events[t],null!=e?i.runWith(e):i.run();else{for(var n=0,r=i.length;n<r;n++){var a=i[n];a&&(null!=e?a.runWith(e):a.run()),a&&!a.once||(i.splice(n,1),n--,r--)}0===i.length&&this._events&&delete this._events[t]}return!0},t.on=function(t,e,i,n){return this._createListener(t,e,i,n,!1)},t.once=function(t,e,i,n){return this._createListener(t,e,i,n,!0)},t._createListener=function(t,e,i,n,r,a){void 0===a&&(a=!0),a&&this.off(t,e,i,r);var s=l.create(e||this,i,n,r);this._events||(this._events={});var o=this._events;return o[t]?o[t].run?o[t]=[o[t],s]:o[t].push(s):o[t]=s,this},t.off=function(t,e,i,n){if(void 0===n&&(n=!1),!this._events||!this._events[t])return this;var r=this._events[t];if(null!=i)if(r.run)e&&r.caller!==e||r.method!==i||n&&!r.once||(delete this._events[t],r.recover());else{for(var a=0,s=0,o=r.length;s<o;s++){var l=r[s];!l||e&&l.caller!==e||l.method!==i||n&&!l.once||(a++,r[s]=null,l.recover())}a===o&&delete this._events[t]}return this},t.offAll=function(t){var e=this._events;if(!e)return this;if(t)this._recoverHandlers(e[t]),delete e[t];else{for(var i in e)this._recoverHandlers(e[i]);this._events=null}return this},t._recoverHandlers=function(t){if(t)if(t.run)t.recover();else for(var e=t.length-1;-1<e;e--)t[e]&&(t[e].recover(),t[e]=null)},t.isMouseEvent=function(t){return e.MOUSE_EVENTS[t]},e.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},e.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0}),l=function(t){function r(t,e,i,n){r.__super.call(this,t,e,i,n)}return __class(r,"",Handler),r.prototype.recover=function(){0<this._id&&(this._id=0,r._pool.push(this.clear()))},r.create=function(t,e,i,n){return void 0===n&&(n=!0),r._pool.length?r._pool.pop().setTo(t,e,i,n):new r(t,e,i,n)},r._pool=[],r}()},e}(),Handler=function(){function r(t,e,i,n){this.once=!1,void(this._id=0)===n&&(n=!1),this.setTo(t,e,i,n)}__class(r,"laya.utils.Handler");var t=r.prototype;return t.setTo=function(t,e,i,n){return this._id=r._gid++,this.caller=t,this.method=e,this.args=i,this.once=n,this},t.run=function(){if(null==this.method)return null;var t=this._id,e=this.method.apply(this.caller,this.args);return this._id===t&&this.once&&this.recover(),e},t.runWith=function(t){if(null==this.method)return null;var e=this._id;if(null==t)var i=this.method.apply(this.caller,this.args);else i=this.args||t.unshift?this.args?this.method.apply(this.caller,this.args.concat(t)):this.method.apply(this.caller,t):this.method.call(this.caller,t);return this._id===e&&this.once&&this.recover(),i},t.clear=function(){return this.caller=null,this.method=null,this.args=null,this},t.recover=function(){0<this._id&&(this._id=0,r._pool.push(this.clear()))},r.create=function(t,e,i,n){return void 0===n&&(n=!0),r._pool.length?r._pool.pop().setTo(t,e,i,n):new r(t,e,i,n)},r._pool=[],r._gid=1,r}(),BitmapFont=function(){function t(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}__class(t,"laya.display.BitmapFont");var e=t.prototype;return e.loadFont=function(t,e){this._path=t,this._complete=e,Laya.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],Handler.create(this,this.onLoaded))},e.onLoaded=function(){this.parseFont(Loader.getRes(this._path),Loader.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},e.parseFont=function(t,e){if(null!=t&&null!=e){this._texture=e;var i=t.getElementsByTagName("info");if(!i[0].getAttributeNode)return this.parseFont2(t,e);this.fontSize=parseInt(i[0].getAttributeNode("size").nodeValue);var n,r=i[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],n=t.getElementsByTagName("char");var a=0;for(a=0;a<n.length;a++){var s=n[a],o=parseInt(s.getAttributeNode("id").nodeValue),l=parseInt(s.getAttributeNode("xoffset").nodeValue)/1,h=parseInt(s.getAttributeNode("yoffset").nodeValue)/1,u=parseInt(s.getAttributeNode("xadvance").nodeValue)/1,c=new Rectangle;c.x=parseInt(s.getAttributeNode("x").nodeValue),c.y=parseInt(s.getAttributeNode("y").nodeValue),c.width=parseInt(s.getAttributeNode("width").nodeValue),c.height=parseInt(s.getAttributeNode("height").nodeValue);var _=Texture.create(e,c.x,c.y,c.width,c.height,l,h);this._maxWidth=Math.max(this._maxWidth,u+this.letterSpacing),this._fontCharDic[o]=_,this._fontWidthMap[o]=u}}},e.parseFont2=function(t,e){if(null!=t&&null!=e){this._texture=e;var i=t.getElementsByTagName("info");this.fontSize=parseInt(i[0].attributes.size.nodeValue);var n=i[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];var r=t.getElementsByTagName("char"),a=0;for(a=0;a<r.length;a++){var s=r[a].attributes,o=parseInt(s.id.nodeValue),l=parseInt(s.xoffset.nodeValue)/1,h=parseInt(s.yoffset.nodeValue)/1,u=parseInt(s.xadvance.nodeValue)/1,c=new Rectangle;c.x=parseInt(s.x.nodeValue),c.y=parseInt(s.y.nodeValue),c.width=parseInt(s.width.nodeValue),c.height=parseInt(s.height.nodeValue);var _=Texture.create(e,c.x,c.y,c.width,c.height,l,h);this._maxWidth=Math.max(this._maxWidth,u+this.letterSpacing),this._fontCharDic[o]=_,this._fontWidthMap[o]=u}}},e.getCharTexture=function(t){return this._fontCharDic[t.charCodeAt(0)]},e.destroy=function(){if(this._texture){for(var t in this._fontCharDic){var e=this._fontCharDic[t];e&&e.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},e.setSpaceWidth=function(t){this._spaceWidth=t},e.getCharWidth=function(t){var e=t.charCodeAt(0);return this._fontWidthMap[e]?this._fontWidthMap[e]+this.letterSpacing:" "==t?this._spaceWidth+this.letterSpacing:0},e.getTextWidth=function(t){for(var e=0,i=0,n=t.length;i<n;i++)e+=this.getCharWidth(t.charAt(i));return e},e.getMaxWidth=function(){return this._maxWidth},e.getMaxHeight=function(){return this.fontSize},e.drawText=function(t,e,i,n,r,a){var s,o=this.getTextWidth(t),l=0;"center"===r&&(l=(a-o)/2),"right"===r&&(l=a-o);for(var h=0,u=0,c=t.length;u<c;u++)(s=this.getCharTexture(t.charAt(u)))&&(e.graphics.drawTexture(s,i+h+l,n),h+=this.getCharWidth(t.charAt(u)))},t}(),Style=function(){function i(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=i._TF_EMPTY}__class(i,"laya.display.css.Style");var t=i.prototype;return t.getTransform=function(){return this._tf},t.setTransform=function(t){this._tf="none"!==t&&t?t:i._TF_EMPTY},t.setTranslateX=function(t){this._tf===i._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.translateX=t},t.setTranslateY=function(t){this._tf===i._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.translateY=t},t.setScaleX=function(t){this._tf===i._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.scaleX=t},t.setScale=function(t,e){this._tf===i._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.scaleX=t,this._tf.scaleY=e},t.setScaleY=function(t){this._tf===i._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.scaleY=t},t.setRotate=function(t){this._tf===i._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.rotate=t},t.setSkewX=function(t){this._tf===i._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.skewX=t},t.setSkewY=function(t){this._tf===i._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.skewY=t},t.destroy=function(){this.scrollRect=null},t.render=function(t,e,i,n){},t.getCSSStyle=function(){return CSSStyle.EMPTY},t._enableLayout=function(){return!1},__getset(0,t,"scaleX",function(){return this._tf.scaleX},function(t){this.setScaleX(t)}),__getset(0,t,"transform",function(){return this.getTransform()},function(t){this.setTransform(t)}),__getset(0,t,"translateX",function(){return this._tf.translateX},function(t){this.setTranslateX(t)}),__getset(0,t,"translateY",function(){return this._tf.translateY},function(t){this.setTranslateY(t)}),__getset(0,t,"scaleY",function(){return this._tf.scaleY},function(t){this.setScaleY(t)}),__getset(0,t,"block",function(){return 0!=(1&this._type)}),__getset(0,t,"skewY",function(){return this._tf.skewY},function(t){this.setSkewY(t)}),__getset(0,t,"rotate",function(){return this._tf.rotate},function(t){this.setRotate(t)}),__getset(0,t,"skewX",function(){return this._tf.skewX},function(t){this.setSkewX(t)}),__getset(0,t,"paddingLeft",function(){return 0}),__getset(0,t,"paddingTop",function(){return 0}),__getset(0,t,"absolute",function(){return!0}),i.__init__=function(){i._TF_EMPTY=new TransformInfo,i.EMPTY=new i},i.EMPTY=null,i._TF_EMPTY=null,i}(),Font=function(){function e(t){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=Color.create(e.defaultColor),this.family=e.defaultFamily,this.stroke=e._STROKE,this.size=e.defaultSize,t&&t!==e.EMPTY&&t.copyTo(this)}__class(e,"laya.display.css.Font");var t=e.prototype;return t.set=function(t){this._text=null;for(var e=t.split(" "),i=0,n=e.length;i<n;i++){var r=e[i];switch(r){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<r.indexOf("px")&&(this.size=parseInt(r),this.family=e[i+1],i++)}},t.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},t.copyTo=function(t){t._type=this._type,t._text=this._text,t._weight=this._weight,t._color=this._color,t.family=this.family,t.stroke=this.stroke!=e._STROKE?this.stroke.slice():e._STROKE,t.indent=this.indent,t.size=this.size},__getset(0,t,"password",function(){return 0!=(1024&this._type)},function(t){t?this._type|=1024:this._type&=-1025}),__getset(0,t,"color",function(){return this._color.strColor},function(t){this._color=Color.create(t)}),__getset(0,t,"italic",function(){return 0!=(512&this._type)},function(t){t?this._type|=512:this._type&=-513}),__getset(0,t,"bold",function(){return 0!=(2048&this._type)},function(t){t?this._type|=2048:this._type&=-2049}),__getset(0,t,"weight",function(){return""+this._weight},function(t){var e=0;switch(t){case"normal":break;case"bold":this.bold=!0,e=700;break;case"bolder":e=800;break;case"lighter":e=100;break;default:e=parseInt(t)}this._weight=e,this._text=null}),__getset(0,t,"decoration",function(){return this._decoration?this._decoration.value:"none"},function(t){var e=t.split(" ");switch(this._decoration||(this._decoration={}),e[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=e[0]}e[1]&&(this._decoration.color=Color.create(e)),this._decoration.value=t}),e.__init__=function(){e.EMPTY=new e(null)},e.EMPTY=null,e.defaultColor="#000000",e.defaultSize=12,e.defaultFamily="Arial",e.defaultFont="12px Arial",e._STROKE=[0,"#000000"],e._ITALIC=512,e._PASSWORD=1024,e._BOLD=2048,e}(),TransformInfo=function(){function t(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return __class(t,"laya.display.css.TransformInfo"),t}(),Graphics=function(){function c(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,Render.isConchNode){this._nativeObj=new window._conchGraphics,this.id=this._nativeObj.conchID}}__class(c,"laya.display.Graphics");var t=c.prototype;return t.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},t.clear=function(t){void 0===t&&(t=!1);var e=0,i=0;if(t){var n=this._one;if(this._cmds){for(i=this._cmds.length,e=0;e<i;e++)!(n=this._cmds[e])||n.callee!==Render._context._drawTexture&&n.callee!==Render._context._drawTextureWithTransform||(n[0]=null,c._cache.push(n));this._cmds.length=0}else n&&(!n||n.callee!==Render._context._drawTexture&&n.callee!==Render._context._drawTextureWithTransform||(n[0]=null,c._cache.push(n)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for(e=0,i=this._vectorgraphArray.length;e<i;e++)VectorGraphManager.getInstance().deleteShape(this._vectorgraphArray[e]);this._vectorgraphArray.length=0}},t._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},t._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new GraphicsBounds,this._graphicBounds._graphics=this)},t._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},t._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},t.getBounds=function(t){return void 0===t&&(t=!1),this._initGraphicBounds(),this._graphicBounds.getBounds(t)},t.getBoundPoints=function(t){return void 0===t&&(t=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints(t)},t._addCmd=function(t){this._cmds=this._cmds||[],t.callee=t.shift(),this._cmds.push(t)},t.setFilters=function(t){this._saveToCmd(Render._context._setFilters,t)},t.drawTexture=function(t,e,i,n,r,a,s){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=1),!t||s<.01)return null;n||(n=t.sourceWidth),r||(r=t.sourceHeight),s=s<0?0:1<s?1:s;var o,l=!Render.isWebGL&&(Browser.onFirefox||Browser.onEdge||Browser.onIE||Browser.onSafari)?.5:0,h=n/t.sourceWidth,u=r/t.sourceHeight;return n=t.width*h,r=t.height*u,t.loaded&&(n<=0||r<=0)?null:(e+=t.offsetX*h,i+=t.offsetY*u,this._sp&&(this._sp._renderType|=512),e-=l,i-=l,n+=2*l,r+=2*l,c._cache.length?((o=c._cache.pop())[0]=t,o[1]=e,o[2]=i,o[3]=n,o[4]=r,o[5]=a,o[6]=s):o=[t,e,i,n,r,a,s],o.callee=a||1!=s?Render._context._drawTextureWithTransform:Render._context._drawTexture,null!=this._one||a||1!=s?this._saveToCmd(o.callee,o):(this._one=o,this._render=this._renderOneImg),t.loaded||t.once("loaded",this,this._textureLoaded,[t,o]),this._repaint(),o)},t.cleanByTexture=function(t,e,i,n,r){if(void 0===n&&(n=0),void 0===r&&(r=0),!t)return this.clear();if(this._one&&this._render===this._renderOneImg){n||(n=t.sourceWidth),r||(r=t.sourceHeight);var a=n/t.sourceWidth,s=r/t.sourceHeight;n=t.width*a,r=t.height*s,e+=t.offsetX*a,i+=t.offsetY*s,this._one[0]=t,this._one[1]=e,this._one[2]=i,this._one[3]=n,this._one[4]=r}else this.clear(),t&&this.drawTexture(t,e,i,n,r)},t.drawTextures=function(t,e){t&&this._saveToCmd(Render._context._drawTextures,[t,e])},t.fillTexture=function(t,e,i,n,r,a,s){if(void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a="repeat"),t){var o=[t,e,i,n,r,a,s||Point.EMPTY,{}];t.loaded||t.once("loaded",this,this._textureLoaded,[t,o]),this._saveToCmd(Render._context._fillTexture,o)}},t._textureLoaded=function(t,e){e[3]=e[3]||t.width,e[4]=e[4]||t.height,this._repaint()},t.fillCircle=function(t,e,i,n,r,a,s){i.bitmap.enableMerageInAtlas=!1;var o=new Float32Array(2*(s+1)),l=new Float32Array(2*(s+1)),h=new Uint16Array(3*s),u=2*Math.PI/s,c=0;o[0]=n,o[1]=r,l[0]=n/i.width,l[1]=r/i.height;for(var _=2,d=0;d<s;d++){var f=a*Math.cos(c)+n,p=a*Math.sin(c)+r;o[_]=f,o[_+1]=p,l[_]=f/i.width,l[_+1]=p/i.height,c+=u,_+=2}for(d=_=0;d<s;d++)h[_++]=0,h[_++]=d+1,h[_++]=s+1<=d+2?1:d+2;this.drawTriangles(i,t,e,o,l,h)},t.drawTriangles=function(t,e,i,n,r,a,s,o,l,h){void 0===o&&(o=1),this._saveToCmd(Render._context.drawTriangles,[t,e,i,n,r,a,s,o,l,h])},t._saveToCmd=function(t,e){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=e,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(e)),e.callee=t,this._repaint(),e},t.clipRect=function(t,e,i,n){this._saveToCmd(Render._context._clipRect,[t,e,i,n])},t.fillText=function(t,e,i,n,r,a,s){void 0===s&&(s=0),this._saveToCmd(Render._context._fillText,[t,e,i,n||Font.defaultFont,r,a])},t.fillBorderText=function(t,e,i,n,r,a,s,o){this._saveToCmd(Render._context._fillBorderText,[t,e,i,n||Font.defaultFont,r,a,s,o])},t.strokeText=function(t,e,i,n,r,a,s){this._saveToCmd(Render._context._strokeText,[t,e,i,n||Font.defaultFont,r,a,s])},t.alpha=function(t){t=t<0?0:1<t?1:t,this._saveToCmd(Render._context._alpha,[t])},t.setAlpha=function(t){t=t<0?0:1<t?1:t,this._saveToCmd(Render._context._setAlpha,[t])},t.transform=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._saveToCmd(Render._context._transform,[t,e,i])},t.rotate=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._saveToCmd(Render._context._rotate,[t,e,i])},t.scale=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0),this._saveToCmd(Render._context._scale,[t,e,i,n])},t.translate=function(t,e){this._saveToCmd(Render._context._translate,[t,e])},t.save=function(){this._saveToCmd(Render._context._save,[])},t.restore=function(){this._saveToCmd(Render._context._restore,[])},t.replaceText=function(t){this._repaint();var e=this._cmds;if(e){for(var i=e.length-1;-1<i;i--)if(this._isTextCmd(e[i].callee))return e[i][0].toUpperCase?e[i][0]=t:e[i][0].setText(t),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=t:this._one[0].setText(t),!0;return!1},t._isTextCmd=function(t){return t===Render._context._fillText||t===Render._context._fillBorderText||t===Render._context._strokeText},t.replaceTextColor=function(t){this._repaint();var e=this._cmds;if(e)for(var i=e.length-1;-1<i;i--)this._isTextCmd(e[i].callee)&&(e[i][4]=t,e[i][0].toUpperCase||(e[i][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=t,this._one[0].toUpperCase||(this._one[0].changed=!0))},t.loadImage=function(t,e,i,n,r,a){var s=this;void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0);var o=Loader.getRes(t);function l(t){t&&(s.drawTexture(t,e,i,n,r),null!=a&&a.call(s._sp,t))}o?l(o):Laya.loader.load(t,Handler.create(null,l),null,"image")},t._renderEmpty=function(t,e,i,n){},t._renderAll=function(t,e,i,n){for(var r,a=this._cmds,s=0,o=a.length;s<o;s++)(r=a[s]).callee.call(e,i,n,r)},t._renderOne=function(t,e,i,n){this._one.callee.call(e,i,n,this._one)},t._renderOneImg=function(t,e,i,n){this._one.callee.call(e,i,n,this._one),2305!==t._renderType&&(t._renderType|=1)},t.drawLine=function(t,e,i,n,r,a){void 0===a&&(a=1);var s=0;Render.isWebGL&&(s=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(s));var o=a%2==0?0:.5,l=[t+o,e+o,i+o,n+o,r,a,s];this._saveToCmd(Render._context._drawLine,l)},t.drawLines=function(t,e,i,n,r){void 0===r&&(r=1);var a=0;if(i&&!(i.length<4)){Render.isWebGL&&(a=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(a));var s=r%2==0?0:.5,o=[t+s,e+s,i,n,r,a];this._saveToCmd(Render._context._drawLines,o)}},t.drawCurves=function(t,e,i,n,r){void 0===r&&(r=1);var a=[t,e,i,n,r];this._saveToCmd(Render._context._drawCurves,a)},t.drawRect=function(t,e,i,n,r,a,s){void 0===s&&(s=1);var o=a?s/2:0,l=a?s:0,h=[t+o,e+o,i-l,n-l,r,a,s];this._saveToCmd(Render._context._drawRect,h)},t.drawCircle=function(t,e,i,n,r,a){void 0===a&&(a=1);var s=r?a/2:0,o=0;Render.isWebGL&&(o=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(o));var l=[t,e,i-s,n,r,a,o];this._saveToCmd(Render._context._drawCircle,l)},t.drawPie=function(t,e,i,n,r,a,s,o){void 0===o&&(o=1);var l=s?o/2:0,h=s?o:0,u=0;Render.isWebGL&&(u=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(u));var c=[t+l,e+l,i-h,n,r,a,s,o,u];c[3]=Utils.toRadian(n),c[4]=Utils.toRadian(r),this._saveToCmd(Render._context._drawPie,c)},t.drawPoly=function(t,e,i,n,r,a){void 0===a&&(a=1);var s=0,o=!1;Render.isWebGL&&(s=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(s),o=!(6<i.length));var l=r?a%2==0?0:.5:0,h=[t+l,e+l,i,n,r,a,s,o];this._saveToCmd(Render._context._drawPoly,h)},t.drawPath=function(t,e,i,n,r){var a=[t,e,i,n,r];this._saveToCmd(Render._context._drawPath,a)},__getset(0,t,"cmds",function(){return this._cmds},function(t){this._sp&&(this._sp._renderType|=512),this._cmds=t,this._render=this._renderAll,this._repaint()}),c.__init__=function(){if(Render.isConchNode){for(var t=laya.display.Graphics.prototype,e=Browser.window.ConchGraphics.prototype,i=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],n=0,r=i.length;n<=r;n++){var a=i[n];t[a]=e[a]}t._saveToCmd=null,e.drawImageS&&(t.drawTextures=function(t,e){if(t&&t.loaded&&t.bitmap&&t.source){var i=t.uv,n=t.bitmap.width,r=t.bitmap.height;this.drawImageS(t.bitmap.source,i[0]*n,i[1]*r,(i[2]-i[0])*n,(i[5]-i[3])*r,t.offsetX,t.offsetY,t.width,t.height,e)}}),t.drawTexture=function(t,e,i,n,r,a,s){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=1),t)if(t.loaded){if(t.loaded&&t.bitmap&&t.source&&(n||(n=t.sourceWidth),r||(r=t.sourceHeight),s=s<0?0:1<s?1:s,n=n-t.sourceWidth+t.width,r=r-t.sourceHeight+t.height,!(n<=0||r<=0))){e+=t.offsetX,i+=t.offsetY;var o=t.uv,l=t.bitmap.width,h=t.bitmap.height;this.drawImageM(t.bitmap.source,o[0]*l,o[1]*h,(o[2]-o[0])*l,(o[5]-o[3])*h,e,i,n,r,a,s),this._repaint()}}else t.once("loaded",this,function(){this.drawTexture(t,e,i,n,r,a)})},t.fillTexture=function(t,e,i,n,r,a,s){if(void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a="repeat"),t&&t.loaded){var o,l=Render._context.ctx,h=t.bitmap.width,u=t.bitmap.height,c=t.uv;o=t.uv!=Texture.DEF_UV?l.createPattern(t.bitmap.source,a,c[0]*h,c[1]*u,(c[2]-c[0])*h,(c[5]-c[3])*u):l.createPattern(t.bitmap.source,a);var _=0,d=0;s&&(e+=s.x%t.width,i+=s.y%t.height,_-=s.x%t.width,d-=s.y%t.height),this._fillImage(o,e,i,_,d,n,r)}}}},c._cache=[],c}(),GraphicsBounds=function(){function y(){this._cacheBoundsType=!1}__class(y,"laya.display.GraphicsBounds");var t=y.prototype;return t.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},t.reset=function(){this._temp&&(this._temp.length=0)},t.getBounds=function(t){return void 0===t&&(t=!1),(!this._bounds||!this._temp||this._temp.length<1||t!=this._cacheBoundsType)&&(this._bounds=Rectangle._getWrapRec(this.getBoundPoints(t),this._bounds)),this._cacheBoundsType=t,this._bounds},t.getBoundPoints=function(t){return void 0===t&&(t=!1),(!this._temp||this._temp.length<1||t!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(t)),this._cacheBoundsType=t,this._rstBoundPoints=Utils.copyArray(this._rstBoundPoints,this._temp)},t._getCmdPoints=function(t){void 0===t&&(t=!1);var e,i,n=Render._context,r=this._graphics.cmds;if((e=this._temp||(this._temp=[])).length=0,r||null==this._graphics._one||(y._tempCmds.length=0,y._tempCmds.push(this._graphics._one),r=y._tempCmds),!r)return e;(i=y._tempMatrixArrays).length=0;var a=y._initMatrix;a.identity();for(var s,o,l=y._tempMatrix,h=NaN,u=NaN,c=NaN,_=NaN,d=NaN,f=NaN,p=0,m=r.length;p<m;p++)if((s=r[p]).callee)switch(s.callee){case n._save:case 7:i.push(a),a=a.clone();break;case n._restore:case 8:a=i.pop();break;case n._scale:case 5:l.identity(),l.translate(-s[2],-s[3]),l.scale(s[0],s[1]),l.translate(s[2],s[3]),this._switchMatrix(a,l);break;case n._rotate:case 3:l.identity(),l.translate(-s[1],-s[2]),l.rotate(s[0]),l.translate(s[1],s[2]),this._switchMatrix(a,l);break;case n._translate:case 6:l.identity(),l.translate(s[0],s[1]),this._switchMatrix(a,l);break;case n._transform:case 4:l.identity(),l.translate(-s[1],-s[2]),l.concat(s[0]),l.translate(s[1],s[2]),this._switchMatrix(a,l);break;case 16:case 24:y._addPointArrToRst(e,Rectangle._getBoundPointS(s[0],s[1],s[2],s[3]),a);break;case 17:a.copyTo(l),l.concat(s[4]),y._addPointArrToRst(e,Rectangle._getBoundPointS(s[0],s[1],s[2],s[3]),l);break;case n._drawTexture:o=s[0],t?s[3]&&s[4]?y._addPointArrToRst(e,Rectangle._getBoundPointS(s[1],s[2],s[3],s[4]),a):(o=s[0],y._addPointArrToRst(e,Rectangle._getBoundPointS(s[1],s[2],o.width,o.height),a)):(h=(s[3]||o.sourceWidth)/o.width,u=(s[4]||o.sourceHeight)/o.height,c=h*o.sourceWidth,_=u*o.sourceHeight,d=0<o.offsetX?o.offsetX:0,f=0<o.offsetY?o.offsetY:0,d*=h,f*=u,y._addPointArrToRst(e,Rectangle._getBoundPointS(s[1]-d,s[2]-f,c,_),a));break;case n._fillTexture:s[3]&&s[4]?y._addPointArrToRst(e,Rectangle._getBoundPointS(s[1],s[2],s[3],s[4]),a):(o=s[0],y._addPointArrToRst(e,Rectangle._getBoundPointS(s[1],s[2],o.width,o.height),a));break;case n._drawTextureWithTransform:var g;g=s[5]?(a.copyTo(l),l.concat(s[5]),l):a,t?s[3]&&s[4]?y._addPointArrToRst(e,Rectangle._getBoundPointS(s[1],s[2],s[3],s[4]),g):(o=s[0],y._addPointArrToRst(e,Rectangle._getBoundPointS(s[1],s[2],o.width,o.height),g)):(o=s[0],h=(s[3]||o.sourceWidth)/o.width,u=(s[4]||o.sourceHeight)/o.height,c=h*o.sourceWidth,_=u*o.sourceHeight,d=0<o.offsetX?o.offsetX:0,f=0<o.offsetY?o.offsetY:0,d*=h,f*=u,y._addPointArrToRst(e,Rectangle._getBoundPointS(s[1]-d,s[2]-f,c,_),g));break;case n._drawRect:case 13:y._addPointArrToRst(e,Rectangle._getBoundPointS(s[0],s[1],s[2],s[3]),a);break;case n._drawCircle:case n._fillCircle:case 14:y._addPointArrToRst(e,Rectangle._getBoundPointS(s[0]-s[2],s[1]-s[2],s[2]+s[2],s[2]+s[2]),a);break;case n._drawLine:case 20:y._tempPoints.length=0;var v;v=.5*s[5],s[0]==s[2]?y._tempPoints.push(s[0]+v,s[1],s[2]+v,s[3],s[0]-v,s[1],s[2]-v,s[3]):s[1]==s[3]?y._tempPoints.push(s[0],s[1]+v,s[2],s[3]+v,s[0],s[1]-v,s[2],s[3]-v):y._tempPoints.push(s[0],s[1],s[2],s[3]),y._addPointArrToRst(e,y._tempPoints,a);break;case n._drawCurves:case 22:y._addPointArrToRst(e,Bezier.I.getBezierPoints(s[2]),a,s[0],s[1]);break;case n._drawPoly:case n._drawLines:case 18:y._addPointArrToRst(e,s[2],a,s[0],s[1]);break;case n._drawPath:case 19:y._addPointArrToRst(e,this._getPathPoints(s[2]),a,s[0],s[1]);break;case n._drawPie:case 15:y._addPointArrToRst(e,this._getPiePoints(s[0],s[1],s[2],s[3],s[4]),a)}return 200<e.length?e=Utils.copyArray(e,Rectangle._getWrapRec(e)._getBoundPoints()):8<e.length&&(e=GrahamScan.scanPList(e)),e},t._switchMatrix=function(t,e){e.concat(t),e.copyTo(t)},t._getPiePoints=function(t,e,i,n,r){var a=y._tempPoints;y._tempPoints.length=0,a.push(t,e);var s=(r-n)%(2*Math.PI)/10,o=NaN,l=n;for(o=0;o<=10;o++)a.push(t+i*Math.cos(l),e+i*Math.sin(l)),l+=s;return a},t._getPathPoints=function(t){var e,i,n=0,r=y._tempPoints;for(r.length=0,e=t.length,n=0;n<e;n++)1<(i=t[n]).length&&(r.push(i[1],i[2]),3<i.length&&r.push(i[3],i[4]));return r},y._addPointArrToRst=function(t,e,i,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var a,s=0;for(a=e.length,s=0;s<a;s+=2)y._addPointToRst(t,e[s]+n,e[s+1]+r,i)},y._addPointToRst=function(t,e,i,n){var r=Point.TEMP;r.setTo(e||0,i||0),n.transformPoint(r),t.push(r.x,r.y)},y._tempPoints=[],y._tempMatrixArrays=[],y._tempCmds=[],__static(y,["_tempMatrix",function(){return this._tempMatrix=new Matrix},"_initMatrix",function(){return this._initMatrix=new Matrix}]),y}(),Event=function(){function t(){}__class(t,"laya.events.Event");var e=t.prototype;return e.setTo=function(t,e,i){return this.type=t,this.currentTarget=e,this.target=i,this},e.stopPropagation=function(){this._stoped=!0},__getset(0,e,"stageY",function(){return Laya.stage.mouseY}),__getset(0,e,"charCode",function(){return this.nativeEvent.charCode}),__getset(0,e,"touches",function(){var t=this.nativeEvent.touches;if(t)for(var e=Laya.stage,i=0,n=t.length;i<n;i++){var r=t[i],a=Point.TEMP;a.setTo(r.clientX,r.clientY),e._canvasTransform.invertTransformPoint(a),e.transform.invertTransformPoint(a),r.stageX=a.x,r.stageY=a.y}return t}),__getset(0,e,"keyLocation",function(){return this.nativeEvent.keyLocation}),__getset(0,e,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),__getset(0,e,"altKey",function(){return this.nativeEvent.altKey}),__getset(0,e,"shiftKey",function(){return this.nativeEvent.shiftKey}),__getset(0,e,"stageX",function(){return Laya.stage.mouseX}),t.EMPTY=new t,t.MOUSE_DOWN="mousedown",t.MOUSE_UP="mouseup",t.CLICK="click",t.RIGHT_MOUSE_DOWN="rightmousedown",t.RIGHT_MOUSE_UP="rightmouseup",t.RIGHT_CLICK="rightclick",t.MOUSE_MOVE="mousemove",t.MOUSE_OVER="mouseover",t.MOUSE_OUT="mouseout",t.MOUSE_WHEEL="mousewheel",t.ROLL_OVER="mouseover",t.ROLL_OUT="mouseout",t.DOUBLE_CLICK="doubleclick",t.CHANGE="change",t.CHANGED="changed",t.RESIZE="resize",t.ADDED="added",t.REMOVED="removed",t.DISPLAY="display",t.UNDISPLAY="undisplay",t.ERROR="error",t.COMPLETE="complete",t.LOADED="loaded",t.PROGRESS="progress",t.INPUT="input",t.RENDER="render",t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.KEY_DOWN="keydown",t.KEY_PRESS="keypress",t.KEY_UP="keyup",t.FRAME="enterframe",t.DRAG_START="dragstart",t.DRAG_MOVE="dragmove",t.DRAG_END="dragend",t.ENTER="enter",t.SELECT="select",t.BLUR="blur",t.FOCUS="focus",t.VISIBILITY_CHANGE="visibilitychange",t.FOCUS_CHANGE="focuschange",t.PLAYED="played",t.PAUSED="paused",t.STOPPED="stopped",t.START="start",t.END="end",t.ENABLE_CHANGED="enablechanged",t.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",t.COMPONENT_ADDED="componentadded",t.COMPONENT_REMOVED="componentremoved",t.LAYER_CHANGED="layerchanged",t.HIERARCHY_LOADED="hierarchyloaded",t.RECOVERED="recovered",t.RELEASED="released",t.LINK="link",t.LABEL="label",t.FULL_SCREEN_CHANGE="fullscreenchange",t.DEVICE_LOST="devicelost",t.MESH_CHANGED="meshchanged",t.MATERIAL_CHANGED="materialchanged",t.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",t.ANIMATION_CHANGED="animationchanged",t.TRIGGER_ENTER="triggerenter",t.TRIGGER_STAY="triggerstay",t.TRIGGER_EXIT="triggerexit",t.TRAIL_FILTER_CHANGE="trailfilterchange",t.DOMINO_FILTER_CHANGE="dominofilterchange",t}(),Keyboard=function(){function t(){}return __class(t,"laya.events.Keyboard"),t.NUMBER_0=48,t.NUMBER_1=49,t.NUMBER_2=50,t.NUMBER_3=51,t.NUMBER_4=52,t.NUMBER_5=53,t.NUMBER_6=54,t.NUMBER_7=55,t.NUMBER_8=56,t.NUMBER_9=57,t.A=65,t.B=66,t.C=67,t.D=68,t.E=69,t.F=70,t.G=71,t.H=72,t.I=73,t.J=74,t.K=75,t.L=76,t.M=77,t.N=78,t.O=79,t.P=80,t.Q=81,t.R=82,t.S=83,t.T=84,t.U=85,t.V=86,t.W=87,t.X=88,t.Y=89,t.Z=90,t.F1=112,t.F2=113,t.F3=114,t.F4=115,t.F5=116,t.F6=117,t.F7=118,t.F8=119,t.F9=120,t.F10=121,t.F11=122,t.F12=123,t.F13=124,t.F14=125,t.F15=126,t.NUMPAD=21,t.NUMPAD_0=96,t.NUMPAD_1=97,t.NUMPAD_2=98,t.NUMPAD_3=99,t.NUMPAD_4=100,t.NUMPAD_5=101,t.NUMPAD_6=102,t.NUMPAD_7=103,t.NUMPAD_8=104,t.NUMPAD_9=105,t.NUMPAD_ADD=107,t.NUMPAD_DECIMAL=110,t.NUMPAD_DIVIDE=111,t.NUMPAD_ENTER=108,t.NUMPAD_MULTIPLY=106,t.NUMPAD_SUBTRACT=109,t.SEMICOLON=186,t.EQUAL=187,t.COMMA=188,t.MINUS=189,t.PERIOD=190,t.SLASH=191,t.BACKQUOTE=192,t.LEFTBRACKET=219,t.BACKSLASH=220,t.RIGHTBRACKET=221,t.QUOTE=222,t.ALTERNATE=18,t.BACKSPACE=8,t.CAPS_LOCK=20,t.COMMAND=15,t.CONTROL=17,t.DELETE=46,t.ENTER=13,t.ESCAPE=27,t.PAGE_UP=33,t.PAGE_DOWN=34,t.END=35,t.HOME=36,t.LEFT=37,t.UP=38,t.RIGHT=39,t.DOWN=40,t.SHIFT=16,t.SPACE=32,t.TAB=9,t.INSERT=45,t}(),KeyBoardManager=function(){function r(){}return __class(r,"laya.events.KeyBoardManager"),r.__init__=function(){r._addEvent("keydown"),r._addEvent("keypress"),r._addEvent("keyup")},r._addEvent=function(e){Browser.document.addEventListener(e,function(t){laya.events.KeyBoardManager._dispatch(t,e)},!0)},r._dispatch=function(t,e){if(r.enabled){r._event._stoped=!1,r._event.nativeEvent=t,r._event.keyCode=t.keyCode||t.which||t.charCode,"keydown"===e?r._pressKeys[r._event.keyCode]=!0:"keyup"===e&&(r._pressKeys[r._event.keyCode]=null);for(var i=Laya.stage.focus&&null!=Laya.stage.focus.event&&Laya.stage.focus.displayedInStage?Laya.stage.focus:Laya.stage,n=i;n;)n.event(e,r._event.setTo(e,n,i)),n=n.parent}},r.hasKeyDown=function(t){return r._pressKeys[t]},r._pressKeys={},r.enabled=!0,__static(r,["_event",function(){return this._event=new Event}]),r}(),KeyLocation=function(){function t(){}return __class(t,"laya.events.KeyLocation"),t.STANDARD=0,t.LEFT=1,t.RIGHT=2,t.NUM_PAD=3,t}(),MouseManager=function(){function u(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new Event,this._matrix=new Matrix,this._point=new Point,this._rect=new Rectangle,this._prePoint=new Point,this._curTouchID=NaN}__class(u,"laya.events.MouseManager");var t=u.prototype;return t.__init__=function(t,e){var i=this;this._stage=t;var n=this,r=this._eventList;e.oncontextmenu=function(t){if(u.enabled)return!1},e.addEventListener("mousedown",function(t){u.enabled&&(Browser.onIE||t.preventDefault(),r.push(t),n.mouseDownTime=Browser.now())}),e.addEventListener("mouseup",function(t){u.enabled&&(t.preventDefault(),r.push(t),n.mouseDownTime=-Browser.now())},!0),e.addEventListener("mousemove",function(t){if(u.enabled){t.preventDefault();var e=Browser.now();if(e-n._lastMoveTimer<10)return;n._lastMoveTimer=e,r.push(t)}},!0),e.addEventListener("mouseout",function(t){u.enabled&&r.push(t)}),e.addEventListener("mouseover",function(t){u.enabled&&r.push(t)}),e.addEventListener("touchstart",function(t){u.enabled&&(r.push(t),u._isFirstTouch||Input.isInputting||t.preventDefault(),n.mouseDownTime=Browser.now())}),e.addEventListener("touchend",function(t){u.enabled?(u._isFirstTouch||Input.isInputting||t.preventDefault(),u._isFirstTouch=!1,r.push(t),n.mouseDownTime=-Browser.now()):i._curTouchID=NaN},!0),e.addEventListener("touchmove",function(t){u.enabled&&(t.preventDefault(),r.push(t))},!0),e.addEventListener("touchcancel",function(t){u.enabled?(t.preventDefault(),r.push(t)):i._curTouchID=NaN},!0),e.addEventListener("mousewheel",function(t){u.enabled&&r.push(t)}),e.addEventListener("DOMMouseScroll",function(t){u.enabled&&r.push(t)})},t.initEvent=function(t,e){var i,n=this;n._event._stoped=!1,n._event.nativeEvent=e||t,n._target=null,this._point.setTo(t.pageX||t.clientX,t.pageY||t.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),n.mouseX=this._point.x,n.mouseY=this._point.y,n._event.touchId=t.identifier||0,this._tTouchID=n._event.touchId,(i=TouchManager.I._event)._stoped=!1,i.nativeEvent=n._event.nativeEvent,i.touchId=n._event.touchId},t.checkMouseWheel=function(t){this._event.delta=t.wheelDelta?.025*t.wheelDelta:-t.detail;for(var e=TouchManager.I.getLastOvers(),i=0,n=e.length;i<n;i++){var r=e[i];r.event("mousewheel",this._event.setTo("mousewheel",r,this._target))}},t.onMouseMove=function(t){TouchManager.I.onMouseMove(t,this._tTouchID)},t.onMouseDown=function(t){if(Input.isInputting&&Laya.stage.focus&&Laya.stage.focus.focus&&!Laya.stage.focus.contains(this._target)){var e=Laya.stage.focus._tf||Laya.stage.focus,i=t._tf||t;i instanceof laya.display.Input&&i.multiline==e.multiline?e._focusOut():e.focus=!1}TouchManager.I.onMouseDown(t,this._tTouchID,this._isLeftMouse)},t.onMouseUp=function(t){TouchManager.I.onMouseUp(t,this._tTouchID,this._isLeftMouse)},t.check=function(t,e,i,n){this._point.setTo(e,i),t.fromParentPoint(this._point),e=this._point.x,i=this._point.y;var r=t.scrollRect;if(r&&(this._rect.setTo(r.x,r.y,r.width,r.height),!this._rect.contains(e,i)))return!1;if(!this.disableMouseEvent){if(t.hitTestPrior&&!t.mouseThrough&&!this.hitTest(t,e,i))return!1;for(var a=t._childs.length-1;-1<a;a--){var s=t._childs[a];if(!s.destroyed&&s.mouseEnabled&&s.visible&&this.check(s,e,i,n))return!0}}var o=!(!t.hitTestPrior||t.mouseThrough||this.disableMouseEvent)||this.hitTest(t,e,i);return o?(this._target=t,n.call(this,t)):n===this.onMouseUp&&t===this._stage&&(this._target=this._stage,n.call(this,this._target)),o},t.hitTest=function(t,e,i){var n=!1;if(t.scrollRect&&(e-=t.scrollRect.x,i-=t.scrollRect.y),t.hitArea instanceof laya.utils.HitArea)return t.hitArea.isHit(e,i);if(0<t.width&&0<t.height||t.mouseThrough||t.hitArea)if(t.mouseThrough)n=t.getGraphicBounds().contains(e,i);else{var r=this._rect;t.hitArea?r=t.hitArea:r.setTo(0,0,t.width,t.height),n=r.contains(e,i)}return n},t.runEvent=function(){var t=this._eventList.length;if(t){for(var e,i=this,n=0,r=0,a=0;n<t;){var s=this._eventList[n];switch("mousemove"!==s.type&&(this._prePoint.x=this._prePoint.y=-1e6),s.type){case"mousedown":this._touchIDs[0]=this._id++,u._isTouchRespond?u._isTouchRespond=!1:(i._isLeftMouse=0===s.button,i.initEvent(s),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseDown));break;case"mouseup":i._isLeftMouse=0===s.button,i.initEvent(s),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-s.clientX)+Math.abs(this._prePoint.y-s.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=s.clientX,this._prePoint.y=s.clientY,i.initEvent(s),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseMove));break;case"touchstart":u._isTouchRespond=!0,i._isLeftMouse=!0;var o=s.changedTouches;for(r=0,a=o.length;r<a;r++)e=o[r],(u.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=e.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[e.identifier]=this._id++,i.initEvent(e,s),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseDown));break;case"touchend":case"touchcancel":u._isTouchRespond=!0,i._isLeftMouse=!0;var l=s.changedTouches;for(r=0,a=l.length;r<a;r++)if(e=l[r],u.multiTouchEnabled||e.identifier==this._curTouchID){this._curTouchID=NaN,i.initEvent(e,s);i.check(i._stage,i.mouseX,i.mouseY,i.onMouseUp)||i.onMouseUp(null)}break;case"touchmove":var h=s.changedTouches;for(r=0,a=h.length;r<a;r++)e=h[r],(u.multiTouchEnabled||e.identifier==this._curTouchID)&&(i.initEvent(e,s),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":i.checkMouseWheel(s);break;case"mouseout":TouchManager.I.stageMouseOut();break;case"mouseover":i._stage.event("mouseover",i._event.setTo("mouseover",i._stage,i._stage))}n++}this._eventList.length=0}},u.enabled=!0,u.multiTouchEnabled=!0,u._isTouchRespond=!1,u._isFirstTouch=!0,__static(u,["instance",function(){return this.instance=new u}]),u}(),TouchManager=function(){function f(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new Event}__class(f,"laya.events.TouchManager");var t=f.prototype;return t._clearTempArrs=function(){f._oldArr.length=0,f._newArr.length=0,f._tEleArr.length=0},t.getTouchFromArr=function(t,e){var i,n,r=0;for(i=e.length,r=0;r<i;r++)if((n=e[r]).id==t)return n;return null},t.removeTouchFromArr=function(t,e){var i=0;for(i=e.length-1;0<=i;i--)e[i].id==t&&e.splice(i,1)},t.createTouchO=function(t,e){var i;return(i=Pool.getItem("TouchData")||{}).id=e,i.tar=t,i},t.onMouseDown=function(t,e,i){var n,r,a,s;(void 0===i&&(i=!1),this.enable)&&(n=this.getTouchFromArr(e,this.preOvers),a=this.getEles(t,null,f._tEleArr),n?n.tar=t:(r=this.createTouchO(t,e),this.preOvers.push(r)),Browser.onMobile&&this.sendEvents(a,"mouseover",e),s=i?this.preDowns:this.preRightDowns,(n=this.getTouchFromArr(e,s))?n.tar=t:(r=this.createTouchO(t,e),s.push(r)),this.sendEvents(a,i?"mousedown":"rightmousedown",e),this._clearTempArrs())},t.sendEvents=function(t,e,i){void 0===i&&(i=0);var n,r,a,s=0;for(n=t.length,this._event._stoped=!1,r=t[0],s=0;s<n;s++){if((a=t[s]).destroyed)return;if(a.event(e,this._event.setTo(e,a,r)),this._event._stoped)break}},t.getEles=function(t,e,i){for(i?i.length=0:i=[];t&&t!=e;)i.push(t),t=t.parent;return i},t.checkMouseOutAndOverOfMove=function(t,e,i){if(void 0===i&&(i=0),e!=t){var n,r,a=0,s=0;if(e.contains(t))r=this.getEles(t,e,f._tEleArr),this.sendEvents(r,"mouseover",i);else if(t.contains(e))r=this.getEles(e,t,f._tEleArr),this.sendEvents(r,"mouseout",i);else{var o,l;(r=f._tEleArr).length=0,o=this.getEles(e,null,f._oldArr),l=this.getEles(t,null,f._newArr),s=o.length;var h=0;for(a=0;a<s;a++){if(n=o[a],0<=(h=l.indexOf(n))){l.splice(h,l.length-h);break}r.push(n)}0<r.length&&this.sendEvents(r,"mouseout",i),0<l.length&&this.sendEvents(l,"mouseover",i)}}},t.onMouseMove=function(t,e){var i,n;this.enable&&((i=this.getTouchFromArr(e,this.preOvers))?(this.checkMouseOutAndOverOfMove(t,i.tar),i.tar=t,n=this.getEles(t,null,f._tEleArr)):(n=this.getEles(t,null,f._tEleArr),this.sendEvents(n,"mouseover",e),this.preOvers.push(this.createTouchO(t,e))),this.sendEvents(n,"mousemove",e),this._clearTempArrs())},t.getLastOvers=function(){return(f._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,f._tEleArr):(f._tEleArr.push(Laya.stage),f._tEleArr)},t.stageMouseOut=function(){var t;t=this.getLastOvers(),this.preOvers.length=0,this.sendEvents(t,"mouseout",0)},t.onMouseUp=function(t,e,i){if(void 0===i&&(i=!1),this.enable){var n,r,a,s,o,l,h=0,u=0,c=Browser.onMobile;if(r=this.getEles(t,null,f._tEleArr),this.sendEvents(r,i?"mouseup":"rightmouseup",e),l=i?this.preDowns:this.preRightDowns,n=this.getTouchFromArr(e,l)){var _,d=Browser.now();if(_=d-this._lastClickTime<300,this._lastClickTime=d,t==n.tar)o=r;else for(a=this.getEles(n.tar,null,f._oldArr),(o=f._newArr).length=0,u=a.length,h=0;h<u;h++)s=a[h],0<=r.indexOf(s)&&o.push(s);0<o.length&&this.sendEvents(o,i?"click":"rightclick",e),i&&_&&this.sendEvents(o,"doubleclick",e),this.removeTouchFromArr(e,l),n.tar=null,Pool.recover("TouchData",n)}else;(n=this.getTouchFromArr(e,this.preOvers))&&c&&((o=this.getEles(n.tar,null,o))&&0<o.length&&this.sendEvents(o,"mouseout",e),this.removeTouchFromArr(e,this.preOvers),n.tar=null,Pool.recover("TouchData",n)),this._clearTempArrs()}},f._oldArr=[],f._newArr=[],f._tEleArr=[],__static(f,["I",function(){return this.I=new f}]),f}(),Filter=function(){function t(){this._action=null}__class(t,"laya.filters.Filter");var e=t.prototype;return Laya.imps(e,{"laya.filters.IFilter":!0}),e.callNative=function(t){},__getset(0,e,"type",function(){return-1}),__getset(0,e,"action",function(){return this._action}),t.BLUR=16,t.COLOR=32,t.GLOW=8,t._filterStart=null,t._filterEnd=null,t._EndTarget=null,t._recycleScope=null,t._filter=null,t._useSrc=null,t._endSrc=null,t._useOut=null,t._endOut=null,t}(),ColorFilterAction=function(){function t(){this.data=null}__class(t,"laya.filters.ColorFilterAction");var e=t.prototype;return Laya.imps(e,{"laya.filters.IFilterAction":!0}),e.apply=function(t){var e=t.ctx.ctx,i=t.ctx.ctx.canvas;if(0==i.width||0==i.height)return i;for(var n,r=e.getImageData(0,0,i.width,i.height),a=r.data,s=0,o=a.length;s<o;s+=4)n=this.getColor(a[s],a[s+1],a[s+2],a[s+3]),0!=a[s+3]&&(a[s]=n[0],a[s+1]=n[1],a[s+2]=n[2],a[s+3]=n[3]);return e.putImageData(r,0,0),t},e.getColor=function(t,e,i,n){var r=[];if(this.data._mat&&this.data._alpha){var a=this.data._mat,s=this.data._alpha;r[0]=a[0]*t+a[1]*e+a[2]*i+a[3]*n+s[0],r[1]=a[4]*t+a[5]*e+a[6]*i+a[7]*n+s[1],r[2]=a[8]*t+a[9]*e+a[10]*i+a[11]*n+s[2],r[3]=a[12]*t+a[13]*e+a[14]*i+a[15]*n+s[3]}return r},t}(),Arith=function(){function t(){}return __class(t,"laya.maths.Arith"),t.formatR=function(t){return t>Math.PI&&(t-=2*Math.PI),t<-Math.PI&&(t+=2*Math.PI),t},t.isPOT=function(t,e){return 0<t&&0==(t&t-1)&&0<e&&0==(e&e-1)},t.setMatToArray=function(t,e){t.a,t.b,t.c,t.d,t.tx,t.ty,e[0]=t.a,e[1]=t.b,e[4]=t.c,e[5]=t.d,e[12]=t.tx,e[13]=t.ty},t}(),Bezier=function(){function t(){this._controlPoints=[new Point,new Point,new Point],this._calFun=this.getPoint2}__class(t,"laya.maths.Bezier");var e=t.prototype;return e._switchPoint=function(t,e){var i=this._controlPoints.shift();i.setTo(t,e),this._controlPoints.push(i)},e.getPoint2=function(t,e){var i=this._controlPoints[0],n=this._controlPoints[1],r=this._controlPoints[2],a=Math.pow(1-t,2)*i.x+2*t*(1-t)*n.x+Math.pow(t,2)*r.x,s=Math.pow(1-t,2)*i.y+2*t*(1-t)*n.y+Math.pow(t,2)*r.y;e.push(a,s)},e.getPoint3=function(t,e){var i=this._controlPoints[0],n=this._controlPoints[1],r=this._controlPoints[2],a=this._controlPoints[3],s=Math.pow(1-t,3)*i.x+3*n.x*t*(1-t)*(1-t)+3*r.x*t*t*(1-t)+a.x*Math.pow(t,3),o=Math.pow(1-t,3)*i.y+3*n.y*t*(1-t)*(1-t)+3*r.y*t*t*(1-t)+a.y*Math.pow(t,3);e.push(s,o)},e.insertPoints=function(t,e){var i,n=NaN;for(i=1/(t=0<t?t:5),n=0;n<=1;n+=i)this._calFun(n,e)},e.getBezierPoints=function(t,e,i){void 0===e&&(e=5),void 0===i&&(i=2);var n,r,a=0;if((n=t.length)<2*(i+1))return[];switch(r=[],i){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=i;)this._controlPoints.push(new Point);for(a=0;a<2*i;a+=2)this._switchPoint(t[a],t[a+1]);for(a=2*i;a<n;a+=2)this._switchPoint(t[a],t[a+1]),a/2%i==0&&this.insertPoints(e,r);return r},__static(t,["I",function(){return this.I=new t}]),t}(),GrahamScan=function(){function h(){}return __class(h,"laya.maths.GrahamScan"),h.multiply=function(t,e,i){return(t.x-i.x)*(e.y-i.y)-(e.x-i.x)*(t.y-i.y)},h.dis=function(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)},h._getPoints=function(t,e,i){for(void 0===e&&(e=!1),h._mPointList||(h._mPointList=[]);h._mPointList.length<t;)h._mPointList.push(new Point);return i||(i=[]),i.length=0,e?h.getFrom(i,h._mPointList,t):h.getFromR(i,h._mPointList,t),i},h.getFrom=function(t,e,i){var n=0;for(n=0;n<i;n++)t.push(e[n]);return t},h.getFromR=function(t,e,i){var n=0;for(n=0;n<i;n++)t.push(e.pop());return t},h.pListToPointList=function(t,e){void 0===e&&(e=!1);var i=0,n=t.length/2,r=h._getPoints(n,e,h._tempPointList);for(i=0;i<n;i++)r[i].setTo(t[i+i],t[i+i+1]);return r},h.pointListToPlist=function(t){var e,i=0,n=t.length,r=h._temPList;for(i=r.length=0;i<n;i++)e=t[i],r.push(e.x,e.y);return r},h.scanPList=function(t){return Utils.copyArray(t,h.pointListToPlist(h.scan(h.pListToPointList(t,!0))))},h.scan=function(t){var e,i,n,r=0,a=0,s=0,o=t.length,l={};for((i=h._temArr).length=0,r=(o=t.length)-1;0<=r;r--)n=(e=t[r]).x+"_"+e.y,l.hasOwnProperty(n)||(l[n]=!0,i.push(e));for(o=i.length,Utils.copyArray(t,i),r=1;r<o;r++)(t[r].y<t[s].y||t[r].y==t[s].y&&t[r].x<t[s].x)&&(s=r);for(e=t[0],t[0]=t[s],t[s]=e,r=1;r<o-1;r++){for(a=(s=r)+1;a<o;a++)(0<h.multiply(t[a],t[s],t[0])||0==h.multiply(t[a],t[s],t[0])&&h.dis(t[0],t[a])<h.dis(t[0],t[s]))&&(s=a);e=t[r],t[r]=t[s],t[s]=e}if((i=h._temArr).length=0,t.length<3)return Utils.copyArray(i,t);for(i.push(t[0],t[1],t[2]),r=3;r<o;r++){for(;2<=i.length&&0<=h.multiply(t[r],i[i.length-1],i[i.length-2]);)i.pop();t[r]&&i.push(t[r])}return i},h._mPointList=null,h._tempPointList=[],h._temPList=[],h._temArr=[],h}(),MathUtil=function(){function r(){}return __class(r,"laya.maths.MathUtil"),r.subtractVector3=function(t,e,i){i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2]},r.lerp=function(t,e,i){return t*(1-i)+e*i},r.scaleVector3=function(t,e,i){i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e},r.lerpVector3=function(t,e,i,n){var r=t[0],a=t[1],s=t[2];n[0]=r+i*(e[0]-r),n[1]=a+i*(e[1]-a),n[2]=s+i*(e[2]-s)},r.lerpVector4=function(t,e,i,n){var r=t[0],a=t[1],s=t[2],o=t[3];n[0]=r+i*(e[0]-r),n[1]=a+i*(e[1]-a),n[2]=s+i*(e[2]-s),n[3]=o+i*(e[3]-o)},r.slerpQuaternionArray=function(t,e,i,n,r,a,s){var o,l,h,u,c,_=t[e+0],d=t[e+1],f=t[e+2],p=t[e+3],m=i[n+0],g=i[n+1],v=i[n+2],y=i[n+3];return(l=_*m+d*g+f*v+p*y)<0&&(l=-l,m=-m,g=-g,v=-v,y=-y),c=1e-6<1-l?(o=Math.acos(l),h=Math.sin(o),u=Math.sin((1-r)*o)/h,Math.sin(r*o)/h):(u=1-r,r),a[s+0]=u*_+c*m,a[s+1]=u*d+c*g,a[s+2]=u*f+c*v,a[s+3]=u*p+c*y,a},r.getRotation=function(t,e,i,n){return Math.atan2(n-e,i-t)/Math.PI*180},r.sortBigFirst=function(t,e){return t==e?0:t<e?1:-1},r.sortSmallFirst=function(t,e){return t==e?0:t<e?-1:1},r.sortNumBigFirst=function(t,e){return parseFloat(e)-parseFloat(t)},r.sortNumSmallFirst=function(t,e){return parseFloat(t)-parseFloat(e)},r.sortByKey=function(i,t,e){var n;return void 0===t&&(t=!1),void 0===e&&(e=!0),n=t?e?r.sortNumBigFirst:r.sortBigFirst:e?r.sortNumSmallFirst:r.sortSmallFirst,function(t,e){return n(t[i],e[i])}},r}(),Matrix=function(){function i(t,e,i,n,r,a){this.inPool=!1,this.bTransform=!1,void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=0),void 0===a&&(a=0),this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=a,this._checkTransform()}__class(i,"laya.maths.Matrix");var t=i.prototype;return t.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},t._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},t.setTranslate=function(t,e){return this.tx=t,this.ty=e,this},t.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.scale=function(t,e){this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this.bTransform=!0},t.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,a=this.tx;this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=a*e-this.ty*i,this.ty=a*i+this.ty*e,this.bTransform=!0},t.skew=function(t,e){var i=Math.tan(t),n=Math.tan(e),r=this.a,a=this.b;return this.a+=n*this.c,this.b+=n*this.d,this.c+=i*r,this.d+=i*a,this},t.invertTransformPoint=function(t){var e=this.a,i=this.b,n=this.c,r=this.d,a=this.tx,s=e*r-i*n,o=r/s,l=-i/s,h=-n/s,u=e/s,c=(n*this.ty-r*a)/s,_=-(e*this.ty-i*a)/s;return t.setTo(o*t.x+h*t.y+c,l*t.x+u*t.y+_)},t.transformPoint=function(t){return t.setTo(this.a*t.x+this.c*t.y+this.tx,this.b*t.x+this.d*t.y+this.ty)},t.transformPointN=function(t){return t.setTo(this.a*t.x+this.c*t.y,this.b*t.x+this.d*t.y)},t.transformPointArray=function(t,e){for(var i=t.length,n=0;n<i;n+=2){var r=t[n],a=t[n+1];e[n]=this.a*r+this.c*a+this.tx,e[n+1]=this.b*r+this.d*a+this.ty}return e},t.transformPointArrayScale=function(t,e){for(var i=t.length,n=0;n<i;n+=2){var r=t[n],a=t[n+1];e[n]=this.a*r+this.c*a,e[n+1]=this.b*r+this.d*a}return e},t.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},t.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},t.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,r=this.tx,a=t*n-e*i;return this.a=n/a,this.b=-e/a,this.c=-i/a,this.d=t/a,this.tx=(i*this.ty-n*r)/a,this.ty=-(t*this.ty-e*r)/a,this},t.setTo=function(t,e,i,n,r,a){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=a,this},t.concat=function(t){var e=this.a,i=this.c,n=this.tx;return this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d,this.tx=n*t.a+this.ty*t.c+t.tx,this.ty=n*t.b+this.ty*t.d+t.ty,this},t.scaleEx=function(t,e){var i=this.a,n=this.b,r=this.c,a=this.d;this.d=(this.c=0!==n||0!==r?(this.a=t*i,this.b=t*n,e*r):(this.a=t*i,this.b=0*a,0*i),e*a),this.bTransform=!0},t.rotateEx=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.b,a=this.c,s=this.d;this.d=0!==r||0!==a?(this.a=e*n+i*a,this.b=e*r+i*s,this.c=-i*n+e*a,-i*r+e*s):(this.a=e*n,this.b=i*s,this.c=-i*n,e*s),this.bTransform=!0},t.clone=function(){var t=i.create();return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t.bTransform=this.bTransform,t},t.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t.bTransform=this.bTransform,t},t.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},t.destroy=function(){if(!this.inPool){var t=i._cache;this.inPool=!0,t._length||(t._length=0),(t[t._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},i.mul=function(t,e,i){var n=t.a,r=t.b,a=t.c,s=t.d,o=t.tx,l=t.ty,h=e.a,u=e.b,c=e.c,_=e.d,d=e.tx,f=e.ty;return i.ty=0!==u||0!==c?(i.a=n*h+r*c,i.b=n*u+r*_,i.c=a*h+s*c,i.d=a*u+s*_,i.tx=h*o+c*l+d,u*o+_*l+f):(i.a=n*h,i.b=r*_,i.c=a*h,i.d=s*_,i.tx=h*o+d,_*l+f),i},i.mul16=function(t,e,i){var n=t.a,r=t.b,a=t.c,s=t.d,o=t.tx,l=t.ty,h=e.a,u=e.b,c=e.c,_=e.d,d=e.tx,f=e.ty;return i[13]=0!==u||0!==c?(i[0]=n*h+r*c,i[1]=n*u+r*_,i[4]=a*h+s*c,i[5]=a*u+s*_,i[12]=h*o+c*l+d,u*o+_*l+f):(i[0]=n*h,i[1]=r*_,i[4]=a*h,i[5]=s*_,i[12]=h*o+d,_*l+f),i},i.mulPre=function(t,e,i,n,r,a,s,o){var l=t.a,h=t.b,u=t.c,c=t.d,_=t.tx,d=t.ty;return o.ty=0!==i||0!==n?(o.a=l*e+h*n,o.b=l*i+h*r,o.c=u*e+c*n,o.d=u*i+c*r,o.tx=e*_+n*d+a,i*_+r*d+s):(o.a=l*e,o.b=h*r,o.c=u*e,o.d=c*r,o.tx=e*_+a,r*d+s),o},i.mulPos=function(t,e,i,n,r,a,s,o){var l=t.a,h=t.b,u=t.c,c=t.d,_=t.tx,d=t.ty;return o.ty=0!==h||0!==u?(o.a=e*l+i*u,o.b=e*h+i*c,o.c=n*l+r*u,o.d=n*h+r*c,o.tx=l*a+u*s+_,h*a+c*s+d):(o.a=e*l,o.b=i*c,o.c=n*l,o.d=r*c,o.tx=l*a+_,c*s+d),o},i.preMul=function(t,e,i){var n=t.a,r=t.b,a=t.c,s=t.d,o=e.a,l=e.b,h=e.c,u=e.d,c=e.tx,_=e.ty;return i.a=o*n,i.b=i.c=0,i.d=u*s,i.tx=c*n+t.tx,i.ty=_*s+t.ty,0===l&&0===h&&0===r&&0===a||(i.a+=l*a,i.d+=h*r,i.b+=o*r+l*s,i.c+=h*n+u*a,i.tx+=_*a,i.ty+=c*r),i},i.preMulXY=function(t,e,i,n){var r=t.a,a=t.b,s=t.c,o=t.d;return n.a=r,n.b=a,n.c=s,n.d=o,n.tx=e*r+t.tx+i*s,n.ty=i*o+t.ty+e*a,n},i.create=function(){var t=i._cache,e=t._length?t[--t._length]:new i;return e.inPool=!1,e},i.EMPTY=new i,i.TEMP=new i,i._cache=[],i}(),Point=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}__class(t,"laya.maths.Point");var e=t.prototype;return e.setTo=function(t,e){return this.x=t,this.y=e,this},e.distance=function(t,e){return Math.sqrt((this.x-t)*(this.x-t)+(this.y-e)*(this.y-e))},e.toString=function(){return this.x+","+this.y},e.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(0<t){var e=1/t;this.x*=e,this.y*=e}},t.TEMP=new t,t.EMPTY=new t,t}(),Rectangle=function(){function h(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=t,this.y=e,this.width=i,this.height=n}__class(h,"laya.maths.Rectangle");var t=h.prototype;return t.setTo=function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},t.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t.contains=function(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.right&&e>=this.y&&e<this.bottom)},t.intersects=function(t){return!(t.x>this.x+this.width||t.x+t.width<this.x||t.y>this.y+this.height||t.y+t.height<this.y)},t.intersection=function(t,e){return this.intersects(t)?(e||(e=new h),e.x=Math.max(this.x,t.x),e.y=Math.max(this.y,t.y),e.width=Math.min(this.right,t.right)-e.x,e.height=Math.min(this.bottom,t.bottom)-e.y,e):null},t.union=function(t,e){return e||(e=new h),this.clone(e),t.width<=0||t.height<=0?e:(e.addPoint(t.x,t.y),e.addPoint(t.right,t.bottom),this)},t.clone=function(t){return t||(t=new h),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},t.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},t.equals=function(t){return!(!t||t.x!==this.x||t.y!==this.y||t.width!==this.width||t.height!==this.height)},t.addPoint=function(t,e){return this.x>t&&(this.width+=this.x-t,this.x=t),this.y>e&&(this.height+=this.y-e,this.y=e),this.width<t-this.x&&(this.width=t-this.x),this.height<e-this.y&&(this.height=e-this.y),this},t._getBoundPoints=function(){var t=h._temB;return(t.length=0)==this.width||0==this.height||t.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),t},t.isEmpty=function(){return this.width<=0||this.height<=0},__getset(0,t,"right",function(){return this.x+this.width}),__getset(0,t,"bottom",function(){return this.y+this.height}),h._getBoundPointS=function(t,e,i,n){var r=h._temA;return(r.length=0)==i||0==n||r.push(t,e,t+i,e,t,e+n,t+i,e+n),r},h._getWrapRec=function(t,e){if(!t||t.length<1)return e?e.setTo(0,0,0,0):h.TEMP.setTo(0,0,0,0);e=e||new h;var i,n,r,a,s,o=t.length,l=Point.TEMP;for(r=s=-(n=a=99999),i=0;i<o;i+=2)l.x=t[i],l.y=t[i+1],n=n<l.x?n:l.x,a=a<l.y?a:l.y,r=r>l.x?r:l.x,s=s>l.y?s:l.y;return e.setTo(n,a,r-n,s-a)},h.EMPTY=new h,h.TEMP=new h,h._temB=[],h._temA=[],h}(),SoundManager=function(){function l(){}return __class(l,"laya.media.SoundManager"),__getset(1,l,"useAudioMusic",function(){return l._useAudioMusic},function(t){l._useAudioMusic=t,l._musicClass=t?AudioSound:null}),__getset(1,l,"autoStopMusic",function(){return l._autoStopMusic},function(t){Laya.stage.off("blur",null,l._stageOnBlur),Laya.stage.off("focus",null,l._stageOnFocus),Laya.stage.off("visibilitychange",null,l._visibilityChange),(l._autoStopMusic=t)&&(Laya.stage.on("blur",null,l._stageOnBlur),Laya.stage.on("focus",null,l._stageOnFocus),Laya.stage.on("visibilitychange",null,l._visibilityChange))}),__getset(1,l,"muted",function(){return l._muted},function(t){t!=l._muted&&(t&&l.stopAllSound(),l.musicMuted=t,l._muted=t)}),__getset(1,l,"musicMuted",function(){return l._musicMuted},function(t){t!=l._musicMuted&&(t?(l._tMusic&&l._musicChannel&&!l._musicChannel.isStopped?l._musicChannel.pause():l._musicChannel=null,l._musicMuted=t):(l._musicMuted=t,l._tMusic&&l._musicChannel&&l._musicChannel.resume()))}),__getset(1,l,"soundMuted",function(){return l._soundMuted},function(t){l._soundMuted=t}),l.addChannel=function(t){0<=l._channels.indexOf(t)||l._channels.push(t)},l.removeChannel=function(t){var e=0;for(e=l._channels.length-1;0<=e;e--)l._channels[e]==t&&l._channels.splice(e,1)},l.disposeSoundIfNotUsed=function(t){var e=0;for(e=l._channels.length-1;0<=e;e--)if(l._channels[e].url==t)return;l.destroySound(t)},l._visibilityChange=function(){Laya.stage.isVisibility?l._stageOnFocus():l._stageOnBlur()},l._stageOnBlur=function(){l._isActive=!1,l._musicChannel&&(l._musicChannel.isStopped||(l._blurPaused=!0,l._musicChannel.pause())),l.stopAllSound(),Laya.stage.once("mousedown",null,l._stageOnFocus)},l._recoverWebAudio=function(){WebAudioSound.ctx&&"running"!=WebAudioSound.ctx.state&&WebAudioSound.ctx.resume()},l._stageOnFocus=function(){l._isActive=!0,l._recoverWebAudio(),Laya.stage.off("mousedown",null,l._stageOnFocus),l._blurPaused&&l._musicChannel&&l._musicChannel.isStopped&&(l._blurPaused=!1,l._musicChannel.resume())},l.playSound=function(t,e,i,n,r){if(void 0===e&&(e=1),void 0===r&&(r=0),!l._isActive||!t)return null;if(l._muted)return null;if(l._recoverWebAudio(),(t=URL.formatURL(t))==l._tMusic){if(l._musicMuted)return null}else{if(Render.isConchApp){var a=Utils.getFileExtension(t);if("wav"!=a&&"ogg"!=a)return alert("The sound only supports wav or ogg format,for optimal performance reason,please refer to the official website document."),null}if(l._soundMuted)return null}var s,o;return Browser.onMiniGame||(s=Laya.loader.getRes(t)),n||(n=l._soundClass),s||((s=new n).load(t),Loader.cacheRes(t,s)),(o=s.play(r,e))?(o.url=t,o.volume=t==l._tMusic?l.musicVolume:l.soundVolume,o.completeHandler=i,o):null},l.destroySound=function(t){var e=Laya.loader.getRes(t);e&&(Loader.clearRes(t),e.dispose())},l.playMusic=function(t,e,i,n){return void 0===e&&(e=0),void 0===n&&(n=0),t=URL.formatURL(t),l._tMusic=t,l._musicChannel&&l._musicChannel.stop(),l._musicChannel=l.playSound(t,e,i,l._musicClass,n)},l.stopSound=function(t){t=URL.formatURL(t);var e,i=0;for(i=l._channels.length-1;0<=i;i--)(e=l._channels[i]).url==t&&e.stop()},l.stopAll=function(){l._tMusic=null;var t=0;for(t=l._channels.length-1;0<=t;t--)l._channels[t].stop()},l.stopAllSound=function(){var t,e=0;for(e=l._channels.length-1;0<=e;e--)(t=l._channels[e]).url!=l._tMusic&&t.stop()},l.stopMusic=function(){l._musicChannel&&l._musicChannel.stop(),l._tMusic=null},l.setSoundVolume=function(t,e){if(e)e=URL.formatURL(e),l._setVolume(e,t);else{l.soundVolume=t;var i,n=0;for(n=l._channels.length-1;0<=n;n--)(i=l._channels[n]).url!=l._tMusic&&(i.volume=t)}},l.setMusicVolume=function(t){l.musicVolume=t,l._setVolume(l._tMusic,t)},l._setVolume=function(t,e){t=URL.formatURL(t);var i,n=0;for(n=l._channels.length-1;0<=n;n--)(i=l._channels[n]).url==t&&(i.volume=e)},l.musicVolume=1,l.soundVolume=1,l.playbackRate=1,l._useAudioMusic=!0,l._muted=!1,l._soundMuted=!1,l._musicMuted=!1,l._tMusic=null,l._musicChannel=null,l._channels=[],l._autoStopMusic=!1,l._blurPaused=!1,l._isActive=!0,l._soundClass=null,l._musicClass=null,l.autoReleaseSound=!0,l}(),LocalStorage=function(){var t;function i(){}return __class(i,"laya.net.LocalStorage"),i.__init__=function(){i._baseClass||(i._baseClass=t).init(),i.items=i._baseClass.items,i.support=i._baseClass.support},i.setItem=function(t,e){i._baseClass.setItem(t,e)},i.getItem=function(t){return i._baseClass.getItem(t)},i.setJSON=function(t,e){i._baseClass.setJSON(t,e)},i.getJSON=function(t){return i._baseClass.getJSON(t)},i.removeItem=function(t){i._baseClass.removeItem(t)},i.clear=function(){i._baseClass.clear()},i._baseClass=null,i.items=null,i.support=!1,i.__init$=function(){t=function(){function i(){}return __class(i,""),i.init=function(){try{i.items=window.localStorage,i.setItem("laya","1"),i.removeItem("laya"),i.support=!0}catch(t){}i.support||console.log("LocalStorage is not supprot or browser is private mode.")},i.setItem=function(t,e){try{i.support&&i.items.setItem(t,e)}catch(t){console.warn("set localStorage failed",t)}},i.getItem=function(t){return i.support?i.items.getItem(t):null},i.setJSON=function(t,e){try{i.support&&i.items.setItem(t,JSON.stringify(e))}catch(t){console.warn("set localStorage failed",t)}},i.getJSON=function(t){return JSON.parse(i.support?i.items.getItem(t):null)},i.removeItem=function(t){i.support&&i.items.removeItem(t)},i.clear=function(){i.support&&i.items.clear()},i.items=null,i.support=!1,i}()},i}(),ResourceVersion=function(){function n(){}return __class(n,"laya.net.ResourceVersion"),n.enable=function(t,e,i){void 0===i&&(i=2),laya.net.ResourceVersion.type=i,Laya.loader.load(t,Handler.create(null,n.onManifestLoaded,[e]),null,"json"),URL.customFormat=n.addVersionPrefix},n.onManifestLoaded=function(t,e){n.manifest=e,t.run(),e||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},n.addVersionPrefix=function(t){return n.manifest&&n.manifest[t]?2==n.type?n.manifest[t]:n.manifest[t]+"/"+t:t},n.FOLDER_VERSION=1,n.FILENAME_VERSION=2,n.manifest=null,n.type=1,n}(),TTFLoader=function(){function t(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}__class(t,"laya.net.TTFLoader");var e=t.prototype;return e.load=function(t){var e=(this._url=t).split(".ttf")[0].split("/");this.fontName=e[e.length-1],Browser.window.conch?this._loadConch():Browser.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},e._loadConch=function(){this._http=new HttpRequest,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},e._onHttpLoaded=function(t){Browser.window.conch.setFontFaceFromBuffer(this.fontName,t),this._clearHttp(),this._complete()},e._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},e._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},e._complete=function(){Laya.timer.clear(this,this._complete),Laya.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},e._checkComplete=function(){RunDriver.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},e._loadWithFontFace=function(){var t=new Browser.window.FontFace(this.fontName,"url('"+this._url+"')");Browser.window.document.fonts.add(t);var e=this;t.loaded.then(function(){e._complete()}),t.load()},e._createDiv=function(){this._div=Browser.createElement("div"),this._div.innerHTML="laya";var t=this._div.style;t.fontFamily=this.fontName,t.position="absolute",t.left="-100px",t.top="-100px",Browser.document.body.appendChild(this._div)},e._loadWithCSS=function(){var t=this,e=Browser.createElement("style");e.type="text/css",Browser.document.body.appendChild(e),e.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=RunDriver.measureText("LayaTTFFont",this._fontTxt).width;var i=this;e.onload=function(){Laya.timer.once(1e4,i,t._complete)},Laya.timer.loop(20,this,this._checkComplete),this._createDiv()},t._testString="LayaTTFFont",t}(),URL=function(){function n(t){this._url=null,this._path=null,this._url=n.formatURL(t),this._path=n.getPath(t)}__class(n,"laya.net.URL");var t=n.prototype;return __getset(0,t,"path",function(){return this._path}),__getset(0,t,"url",function(){return this._url}),n.formatURL=function(t,e){if(!t)return"null path";if(0<t.indexOf(":"))return t;null!=n.customFormat&&(t=n.customFormat(t,e));var i=t.charAt(0);if("."===i)return n.formatRelativePath((e||n.basePath)+t);if("~"===i)return n.rootPath+t.substring(1);if("d"===i){if(0===t.indexOf("data:image"))return t}else if("/"===i)return t;return(e||n.basePath)+t},n.formatRelativePath=function(t){for(var e=t.split("/"),i=0,n=e.length;i<n;i++)".."==e[i]&&(e.splice(i-1,2),i-=2);return e.join("/")},n.isAbsolute=function(t){return 0<t.indexOf(":")||"/"==t.charAt(0)},n.getPath=function(t){var e=t.lastIndexOf("/");return 0<e?t.substr(0,e+1):""},n.getFileName=function(t){var e=t.lastIndexOf("/");return 0<e?t.substr(e+1):t},n.version={},n.basePath="",n.rootPath="",n.customFormat=function(t){var e=n.version[t];return!Render.isConchApp&&e&&(t+="?v="+e),t},n}(),Render=function(){function r(t,e){this._timeId=0;var i=r._mainCanvas.source.style;i.position="absolute",i.top=i.left="0px",i.background="#000000",r._mainCanvas.source.id="layaCanvas";var n=laya.renders.Render.isWebGL;r._mainCanvas.source.width=t,r._mainCanvas.source.height=e,n&&r.WebGL.init(r._mainCanvas,t,e),Browser.container.appendChild(r._mainCanvas.source),(r._context=new RenderContext(t,e,n?null:r._mainCanvas)).ctx.setIsMainContext(),Browser.window.requestAnimationFrame(function t(){Laya.stage._loop();Browser.window.requestAnimationFrame(t)}),Laya.stage.on("visibilitychange",this,this._onVisibilitychange)}__class(r,"laya.renders.Render");var t=r.prototype;return t._onVisibilitychange=function(){Laya.stage.isVisibility?0!=this._timeId&&Browser.window.clearInterval(this._timeId):this._timeId=Browser.window.setInterval(this._enterFrame,1e3)},t._enterFrame=function(t){Laya.stage._loop()},__getset(1,r,"context",function(){return r._context}),__getset(1,r,"canvas",function(){return r._mainCanvas.source}),r._context=null,r._mainCanvas=null,r.WebGL=null,r.isConchNode=!1,r.isConchApp=!1,r.isConchWebGL=!1,r.isWebGL=!1,r.is3DMode=!1,r.optimizeTextureMemory=function(t,e){return!0},r.__init$=function(){window.ConchRenderType=window.ConchRenderType||1,window.ConchRenderType|=window.conch?4:0,r.isConchNode=5==(5&window.ConchRenderType),r.isConchApp=4==(4&window.ConchRenderType),r.isConchWebGL=6==window.ConchRenderType},r}(),RenderContext=function(){function s(t,e,i){this.x=0,this.y=0,this._drawTexture=function(t,e,i){i[0].loaded&&this.ctx.drawTexture(i[0],i[1],i[2],i[3],i[4],t,e)},this._fillTexture=function(t,e,i){i[0].loaded&&this.ctx.fillTexture(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6],i[7])},this._drawTextureWithTransform=function(t,e,i){i[0].loaded&&this.ctx.drawTextureWithTransform(i[0],i[1],i[2],i[3],i[4],i[5],t,e,i[6])},this._fillQuadrangle=function(t,e,i){this.ctx.fillQuadrangle(i[0],i[1],i[2],i[3],i[4])},this._drawRect=function(t,e,i){var n=this.ctx;null!=i[4]&&(n.fillStyle=i[4],n.fillRect(t+i[0],e+i[1],i[2],i[3],null)),null!=i[5]&&(n.strokeStyle=i[5],n.lineWidth=i[6],n.strokeRect(t+i[0],e+i[1],i[2],i[3],i[6]))},this._drawPie=function(t,e,i){var n=this.ctx;Render.isWebGL&&n.setPathId(i[8]),n.beginPath(),Render.isWebGL?(n.movePath(i[0]+t,i[1]+e),n.moveTo(0,0)):n.moveTo(t+i[0],e+i[1]),n.arc(t+i[0],e+i[1],i[2],i[3],i[4]),n.closePath(),this._fillAndStroke(i[5],i[6],i[7],!0)},this._clipRect=function(t,e,i){this.ctx.clipRect(t+i[0],e+i[1],i[2],i[3])},this._fillRect=function(t,e,i){this.ctx.fillRect(t+i[0],e+i[1],i[2],i[3],i[4])},this._drawCircle=function(t,e,i){var n=this.ctx;Render.isWebGL&&n.setPathId(i[6]),Stat.drawCall++,n.beginPath(),Render.isWebGL&&n.movePath(i[0]+t,i[1]+e),n.arc(i[0]+t,i[1]+e,i[2],0,s.PI2),n.closePath(),this._fillAndStroke(i[3],i[4],i[5],!0)},this._fillCircle=function(t,e,i){Stat.drawCall++;var n=this.ctx;n.beginPath(),n.fillStyle=i[3],n.arc(i[0]+t,i[1]+e,i[2],0,s.PI2),n.fill()},this._setShader=function(t,e,i){this.ctx.setShader(i[0])},this._drawLine=function(t,e,i){var n=this.ctx;Render.isWebGL&&n.setPathId(i[6]),n.beginPath(),n.strokeStyle=i[4],n.lineWidth=i[5],Render.isWebGL?(n.movePath(t,e),n.moveTo(i[0],i[1]),n.lineTo(i[2],i[3])):(n.moveTo(t+i[0],e+i[1]),n.lineTo(t+i[2],e+i[3])),n.stroke()},this._drawLines=function(t,e,i){var n=this.ctx;Render.isWebGL&&n.setPathId(i[5]),n.beginPath(),t+=i[0],e+=i[1],Render.isWebGL&&n.movePath(t,e),n.strokeStyle=i[3],n.lineWidth=i[4];var r=i[2],a=2,s=r.length;if(Render.isWebGL)for(n.moveTo(r[0],r[1]);a<s;)n.lineTo(r[a++],r[a++]);else for(n.moveTo(t+r[0],e+r[1]);a<s;)n.lineTo(t+r[a++],e+r[a++]);n.stroke()},this._drawLinesWebGL=function(t,e,i){this.ctx.drawLines(t+this.x+i[0],e+this.y+i[1],i[2],i[3],i[4])},this._drawCurves=function(t,e,i){this.ctx.drawCurves(t,e,i)},this._draw=function(t,e,i){i[0].call(null,this,t,e)},this._transformByMatrix=function(t,e,i){this.ctx.transformByMatrix(i[0])},this._setTransform=function(t,e,i){this.ctx.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])},this._setTransformByMatrix=function(t,e,i){this.ctx.setTransformByMatrix(i[0])},this._save=function(t,e,i){this.ctx.save()},this._restore=function(t,e,i){this.ctx.restore()},this._translate=function(t,e,i){this.ctx.translate(i[0],i[1])},this._transform=function(t,e,i){this.ctx.translate(i[1]+t,i[2]+e);var n=i[0];this.ctx.transform(n.a,n.b,n.c,n.d,n.tx,n.ty),this.ctx.translate(-t-i[1],-e-i[2])},this._rotate=function(t,e,i){this.ctx.translate(i[1]+t,i[2]+e),this.ctx.rotate(i[0]),this.ctx.translate(-t-i[1],-e-i[2])},this._scale=function(t,e,i){this.ctx.translate(i[2]+t,i[3]+e),this.ctx.scale(i[0],i[1]),this.ctx.translate(-t-i[2],-e-i[3])},this._alpha=function(t,e,i){this.ctx.globalAlpha*=i[0]},this._setAlpha=function(t,e,i){this.ctx.globalAlpha=i[0]},this._fillText=function(t,e,i){this.ctx.fillText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5])},this._strokeText=function(t,e,i){this.ctx.strokeText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6])},this._fillBorderText=function(t,e,i){this.ctx.fillBorderText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6],i[7])},this._blendMode=function(t,e,i){this.ctx.globalCompositeOperation=i[0]},this._beginClip=function(t,e,i){this.ctx.beginClip&&this.ctx.beginClip(t+i[0],e+i[1],i[2],i[3])},this._setIBVB=function(t,e,i){this.ctx.setIBVB(i[0]+t,i[1]+e,i[2],i[3],i[4],i[5],i[6],i[7])},this._fillTrangles=function(t,e,i){this.ctx.fillTrangles(i[0],i[1]+t,i[2]+e,i[3],i[4])},this._drawPath=function(t,e,i){var n=this.ctx;Render.isWebGL&&n.setPathId(-1),n.beginPath(),t+=i[0],e+=i[1],Render.isWebGL&&n.movePath(t,e);for(var r=i[2],a=0,s=r.length;a<s;a++){var o=r[a];switch(o[0]){case"moveTo":Render.isWebGL?n.moveTo(o[1],o[2]):n.moveTo(t+o[1],e+o[2]);break;case"lineTo":Render.isWebGL?n.lineTo(o[1],o[2]):n.lineTo(t+o[1],e+o[2]);break;case"arcTo":Render.isWebGL?n.arcTo(o[1],o[2],o[3],o[4],o[5]):n.arcTo(t+o[1],e+o[2],t+o[3],e+o[4],o[5]);break;case"closePath":n.closePath()}}var l=i[3];null!=l&&(n.fillStyle=l.fillStyle,n.fill());var h=i[4];null!=h&&(n.strokeStyle=h.strokeStyle,n.lineWidth=h.lineWidth||1,n.lineJoin=h.lineJoin,n.lineCap=h.lineCap,n.miterLimit=h.miterLimit,n.stroke())},this.drawPoly=function(t,e,i){this.ctx.drawPoly(t+this.x+i[0],e+this.y+i[1],i[2],i[3],i[4],i[5],i[6])},this._drawPoly=function(t,e,i){var n=this.ctx,r=i[2],a=2,s=r.length;if(Render.isWebGL)for(n.setPathId(i[6]),n.beginPath(),t+=i[0],e+=i[1],n.movePath(t,e),n.moveTo(r[0],r[1]);a<s;)n.lineTo(r[a++],r[a++]);else for(n.beginPath(),t+=i[0],e+=i[1],n.moveTo(t+r[0],e+r[1]);a<s;)n.lineTo(t+r[a++],e+r[a++]);n.closePath(),this._fillAndStroke(i[3],i[4],i[5],i[7])},this._drawSkin=function(t,e,i){var n=i[0];if(n){var r=this.ctx;n.render(r,t,e)}},this._drawParticle=function(t,e,i){this.ctx.drawParticle(t+this.x,e+this.y,i[0])},this._setFilters=function(t,e,i){this.ctx.setFilters(i)},i?this.ctx=i.getContext("2d"):(i=HTMLCanvas.create("3D"),this.ctx=RunDriver.createWebGLContext2D(i),i._setContext(this.ctx)),i.size(t,e),this.canvas=i}__class(s,"laya.renders.RenderContext");var t=s.prototype;return t.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},t.drawTexture=function(t,e,i,n,r){t.loaded&&this.ctx.drawTexture(t,e,i,n,r,this.x,this.y)},t._drawTextures=function(t,e,i){i[0].loaded&&this.ctx.drawTextures(i[0],i[1],t+this.x,e+this.y)},t.drawTextureWithTransform=function(t,e,i,n,r,a,s){t.loaded&&this.ctx.drawTextureWithTransform(t,e,i,n,r,a,this.x,this.y,s)},t.fillQuadrangle=function(t,e,i,n,r){this.ctx.fillQuadrangle(t,e,i,n,r)},t.drawCanvas=function(t,e,i,n,r){this.ctx.drawCanvas(t,e+this.x,i+this.y,n,r)},t.drawRect=function(t,e,i,n,r,a){void 0===a&&(a=1);var s=this.ctx;s.strokeStyle=r,s.lineWidth=a,s.strokeRect(t+this.x,e+this.y,i,n,a)},t._fillAndStroke=function(t,e,i,n){void 0===n&&(n=!1);var r=this.ctx;null!=t&&(r.fillStyle=t,Render.isWebGL?r.fill(n):r.fill()),null!=e&&0<i&&(r.strokeStyle=e,r.lineWidth=i,r.stroke())},t.clipRect=function(t,e,i,n){this.ctx.clipRect(t+this.x,e+this.y,i,n)},t.fillRect=function(t,e,i,n,r){this.ctx.fillRect(t+this.x,e+this.y,i,n,r)},t.drawCircle=function(t,e,i,n,r){void 0===r&&(r=1),Stat.drawCall++;var a=this.ctx;a.beginPath(),a.strokeStyle=n,a.lineWidth=r,a.arc(t+this.x,e+this.y,i,0,s.PI2),a.stroke()},t.drawTriangles=function(t,e,i){if(Render.isWebGL)this.ctx.drawTriangles(i[0],t+i[1],e+i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9]);else{var n=i[5],r=0,a=n.length,s=this.ctx;for(r=0;r<a;r+=3){var o=2*n[r],l=2*n[r+1],h=2*n[r+2];s.drawTriangle(i[0],i[3],i[4],o,l,h,i[6],!0)}}},t.fillCircle=function(t,e,i,n){Stat.drawCall++;var r=this.ctx;r.beginPath(),r.fillStyle=n,r.arc(t+this.x,e+this.y,i,0,s.PI2),r.fill()},t.setShader=function(t){this.ctx.setShader(t)},t.drawLine=function(t,e,i,n,r,a){void 0===a&&(a=1);var s=this.ctx;s.beginPath(),s.strokeStyle=r,s.lineWidth=a,s.moveTo(this.x+t,this.y+e),s.lineTo(this.x+i,this.y+n),s.stroke()},t.clear=function(){this.ctx.clear()},t.transformByMatrix=function(t){this.ctx.transformByMatrix(t)},t.setTransform=function(t,e,i,n,r,a){this.ctx.setTransform(t,e,i,n,r,a)},t.setTransformByMatrix=function(t){this.ctx.setTransformByMatrix(t)},t.save=function(){this.ctx.save()},t.restore=function(){this.ctx.restore()},t.translate=function(t,e){this.ctx.translate(t,e)},t.transform=function(t,e,i,n,r,a){this.ctx.transform(t,e,i,n,r,a)},t.rotate=function(t){this.ctx.rotate(t)},t.scale=function(t,e){this.ctx.scale(t,e)},t.alpha=function(t){this.ctx.globalAlpha*=t},t.setAlpha=function(t){this.ctx.globalAlpha=t},t.fillWords=function(t,e,i,n,r,a){void 0===a&&(a=0),this.ctx.fillWords(t,e,i,n,r,a)},t.fillBorderWords=function(t,e,i,n,r,a,s){this.ctx.fillBorderWords(t,e,i,n,r,a,s)},t.fillText=function(t,e,i,n,r,a){this.ctx.fillText(t,e+this.x,i+this.y,n,r,a)},t.strokeText=function(t,e,i,n,r,a,s){this.ctx.strokeText(t,e+this.x,i+this.y,n,r,a,s)},t.blendMode=function(t){this.ctx.globalCompositeOperation=t},t.flush=function(){this.ctx.flush&&this.ctx.flush()},t.addRenderObject=function(t){this.ctx.addRenderObject(t)},t.beginClip=function(t,e,i,n){this.ctx.beginClip&&this.ctx.beginClip(t,e,i,n)},t.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},t.fillTrangles=function(t,e,i){this.ctx.fillTrangles(i[0],i[1],i[2],i[3],4<i.length?i[4]:null)},s.PI2=2*Math.PI,s}(),RenderSprite=function(){function s(t,e){switch(this._next=e||s.NORENDER,t){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=Filter._filter);case 69905:return void(this._fun=s._initRenderFun)}this.onCreate(t)}__class(s,"laya.renders.RenderSprite");var t=s.prototype;return t.onCreate=function(t){},t._style=function(t,e,i,n){t._style.render(t,e,i,n);var r=this._next;r._fun.call(r,t,e,i,n)},t._no=function(t,e,i,n){},t._custom=function(t,e,i,n){t.customRender(e,i,n);var r=t._style._tf;this._next._fun.call(this._next,t,e,i-r.translateX,n-r.translateY)},t._clip=function(t,e,i,n){var r=this._next;if(r!=s.NORENDER){var a=t._style.scrollRect;e.ctx.save(),e.ctx.clipRect(i,n,a.width,a.height),r._fun.call(r,t,e,i-a.x,n-a.y),e.ctx.restore()}},t._blend=function(t,e,i,n){var r=t._style;r.blendMode&&(e.ctx.globalCompositeOperation=r.blendMode);var a=this._next;a._fun.call(a,t,e,i,n),e.ctx.globalCompositeOperation="source-over"},t._mask=function(t,e,i,n){var r=this._next;r._fun.call(r,t,e,i,n);var a=t.mask;a&&(e.ctx.globalCompositeOperation="destination-in",(0<a.numChildren||!a.graphics._isOnlyOne())&&(a.cacheAsBitmap=!0),a.render(e,i-t.pivotX,n-t.pivotY)),e.ctx.globalCompositeOperation="source-over"},t._graphics=function(t,e,i,n){var r=t._style._tf;t._graphics&&t._graphics._render(t,e,i-r.translateX,n-r.translateY);var a=this._next;a._fun.call(a,t,e,i,n)},t._image=function(t,e,i,n){var r=t._style;e.ctx.drawTexture2(i,n,r._tf.translateX,r._tf.translateY,t.transform,r.alpha,r.blendMode,t._graphics._one)},t._image2=function(t,e,i,n){var r=t._style._tf;e.ctx.drawTexture2(i,n,r.translateX,r.translateY,t.transform,1,null,t._graphics._one)},t._alpha=function(t,e,i,n){var r;if(.01<(r=t._style.alpha)||t._needRepaint()){var a=e.ctx.globalAlpha;e.ctx.globalAlpha*=r;var s=this._next;s._fun.call(s,t,e,i,n),e.ctx.globalAlpha=a}},t._transform=function(t,e,i,n){var r=t.transform,a=this._next;r&&a!=s.NORENDER?(e.save(),e.transform(r.a,r.b,r.c,r.d,r.tx+i,r.ty+n),a._fun.call(a,t,e,0,0),e.restore()):a._fun.call(a,t,e,i,n)},t._childs=function(t,e,i,n){var r=t._style,a=r._tf;if(i=i-a.translateX+r.paddingLeft,n=n-a.translateY+r.paddingTop,r._calculation){var s=t._getWords();if(s){var o=r;o&&(o.stroke?e.fillBorderWords(s,i,n,o.font,o.color,o.strokeColor,o.stroke):e.fillWords(s,i,n,o.font,o.color,o.underLine))}}var l,h=t._childs,u=h.length;if(t.viewport||t.optimizeScrollRect&&t._style.scrollRect){var c=t.viewport||t._style.scrollRect,_=c.x,d=c.y,f=c.right,p=c.bottom,m=NaN,g=NaN;for(v=0;v<u;++v)(l=h[v]).visible&&(m=l._x)<f&&m+l.width>_&&(g=l._y)<p&&g+l.height>d&&l.render(e,i,n)}else for(var v=0;v<u;++v)(l=h[v])._style.visible&&l.render(e,i,n)},t._canvas=function(t,e,i,n){var r=t._$P.cacheCanvas;if(r){"bitmap"===r.type?Stat.canvasBitmap++:Stat.canvasNormal++;var a=r.ctx;if(t._needRepaint()||!a)this._canvas_repaint(t,e,i,n);else{var s=r._cacheRec;e.drawCanvas(a.canvas,i+s.x,n+s.y,s.width,s.height)}}else this._next._fun.call(this._next,t,e,i,n)},t._canvas_repaint=function(t,e,i,n){var r=t._$P.cacheCanvas,a=this._next;if(r){var s,o,l,h,u=r.ctx,c=t._needRepaint()||!u,_=r.type;if("bitmap"===_?Stat.canvasBitmap++:Stat.canvasNormal++,c){var d,f;r._cacheRec||(r._cacheRec=new Rectangle),Render.isWebGL&&"bitmap"!==_?r._cacheRec.setTo(-t.pivotX,-t.pivotY,1,1):((h=t.getSelfBounds()).x=h.x-t.pivotX,h.y=h.y-t.pivotY,h.x=h.x-16,h.y=h.y-16,h.width=h.width+32,h.height=h.height+32,h.x=Math.floor(h.x+i)-i,h.y=Math.floor(h.y+n)-n,h.width=Math.floor(h.width),h.height=Math.floor(h.height),r._cacheRec.copyFrom(h)),h=r._cacheRec;var p,m=Render.isWebGL?1:Browser.pixelRatio*Laya.stage.clientScaleX,g=Render.isWebGL?1:Browser.pixelRatio*Laya.stage.clientScaleY;if(!Render.isWebGL){var v,y=1,x=1;for(v=t;v&&v!=Laya.stage;)y*=v.scaleX,x*=v.scaleY,v=v.parent;Render.isWebGL?(y<1&&(m*=y),x<1&&(g*=x)):(1<y&&(m*=y),1<x&&(g*=x))}if(t.scrollRect){var E=t.scrollRect;h.x-=E.x,h.y-=E.y}if(d=h.width*m,f=h.height*g,o=h.x,l=h.y,Render.isWebGL&&"bitmap"===_&&(2048<d||2048<f))return console.warn("cache bitmap size larger than 2048,cache ignored"),r.ctx&&(Pool.recover("RenderContext",r.ctx),r.ctx.canvas.size(0,0),r.ctx=null),void a._fun.call(a,t,e,i,n);if(u||(u=r.ctx=Pool.getItem("RenderContext")||new RenderContext(d,f,HTMLCanvas.create("AUTO"))),u.ctx.sprite=t,(s=u.canvas).clear(),(s.width!=d||s.height!=f)&&s.size(d,f),"bitmap"===_?s.context.asBitmap=!0:"normal"===_&&(s.context.asBitmap=!1),1!=m||1!=g){var T=u.ctx;T.save(),T.scale(m,g),!Render.isConchWebGL&&Render.isConchApp&&(p=t._$P.cf)&&T.setFilterMatrix&&T.setFilterMatrix(p._mat,p._alpha),a._fun.call(a,t,u,-o,-l),T.restore(),Render.isConchApp&&!Render.isConchWebGL||t._applyFilters()}else T=u.ctx,!Render.isConchWebGL&&Render.isConchApp&&(p=t._$P.cf)&&T.setFilterMatrix&&T.setFilterMatrix(p._mat,p._alpha),a._fun.call(a,t,u,-o,-l),Render.isConchApp&&!Render.isConchWebGL||t._applyFilters();t._$P.staticCache&&(r.reCache=!1),Stat.canvasReCache++}else o=(h=r._cacheRec).x,l=h.y,s=u.canvas;e.drawCanvas(s,i+o,n+l,h.width,h.height)}else a._fun.call(a,t,u,i,n)},s.__init__=function(){var t,e,i=0;for(e=RunDriver.createRenderSprite(69905,null),t=s.renders.length=4096,i=0;i<t;i++)s.renders[i]=e;s.renders[0]=RunDriver.createRenderSprite(0,null),function(t,e){for(var i=0,n=0;n<t.length;n++)i|=t[n],s.renders[i]=e}([1,512,4,2],new s(1,null)),s.renders[513]=RunDriver.createRenderSprite(513,null),s.renders[517]=new s(517,null)},s._initRenderFun=function(t,e,i,n){var r=t._renderType;(s.renders[r]=s._getTypeRender(r))._fun(t,e,i,n)},s._getTypeRender=function(t){for(var e=null,i=2048;1<i;)i&t&&(e=RunDriver.createRenderSprite(i,e)),i>>=1;return e},s.IMAGE=1,s.ALPHA=2,s.TRANSFORM=4,s.BLEND=8,s.CANVAS=16,s.FILTERS=32,s.MASK=64,s.CLIP=128,s.STYLE=256,s.GRAPHICS=512,s.CUSTOM=1024,s.CHILDS=2048,s.INIT=69905,s.renders=[],s.NORENDER=new s(0,null),s}(),Context=function(){function o(){this._repaint=!1}__class(o,"laya.resource.Context");var t=o.prototype;return t.replaceReset=function(){var t,e,i=0;for(t=o.replaceKeys.length,i=0;i<t;i++)e=o.replaceKeys[i],this[o.newKeys[i]]=this[e]},t.replaceResotre=function(){this.__restore(),this.__reset()},t.setIsMainContext=function(){},t.drawTextures=function(t,e,i,n){Stat.drawCall+=e.length/2;for(var r=t.width,a=t.height,s=0,o=e.length;s<o;s+=2)this.drawTexture(t,e[s],e[s+1],r,a,i,n)},t.drawCanvas=function(t,e,i,n,r){Stat.drawCall++,this.drawImage(t.source,e,i,n,r)},t.fillRect=function(t,e,i,n,r){Stat.drawCall++,r&&(this.fillStyle=r),this.__fillRect(t,e,i,n)},t.fillText=function(t,e,i,n,r,a){Stat.drawCall++,3<arguments.length&&null!=n&&(this.font=n,this.fillStyle=r,this.textAlign=a,this.textBaseline="top"),this.__fillText(t,e,i)},t.fillBorderText=function(t,e,i,n,r,a,s,o){Stat.drawCall++,this.font=n,this.fillStyle=r,this.textBaseline="top",this.strokeStyle=a,this.lineWidth=s,this.textAlign=o,this.__strokeText(t,e,i),this.__fillText(t,e,i)},t.strokeText=function(t,e,i,n,r,a,s){Stat.drawCall++,3<arguments.length&&null!=n&&(this.font=n,this.strokeStyle=r,this.lineWidth=a,this.textAlign=s,this.textBaseline="top"),this.__strokeText(t,e,i)},t.transformByMatrix=function(t){this.transform(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.setTransformByMatrix=function(t){this.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.clipRect=function(t,e,i,n){Stat.drawCall++,this.beginPath(),this.rect(t,e,i,n),this.clip()},t.drawTexture=function(t,e,i,n,r,a,s){Stat.drawCall++;var o=t.uv,l=t.bitmap.width,h=t.bitmap.height;this.drawImage(t.source,o[0]*l,o[1]*h,(o[2]-o[0])*l,(o[5]-o[3])*h,e+a,i+s,n,r)},t.drawTextureWithTransform=function(t,e,i,n,r,a,s,o,l){Stat.drawCall++;var h=t.uv,u=t.bitmap.width,c=t.bitmap.height;this.save(),1!=l&&(this.globalAlpha*=l),a?(this.transform(a.a,a.b,a.c,a.d,a.tx+s,a.ty+o),this.drawImage(t.source,h[0]*u,h[1]*c,(h[2]-h[0])*u,(h[5]-h[3])*c,e,i,n,r)):this.drawImage(t.source,h[0]*u,h[1]*c,(h[2]-h[0])*u,(h[5]-h[3])*c,e+s,i+o,n,r),this.restore()},t.drawTexture2=function(t,e,i,n,r,a,s,o){"use strict";var l=o[0];if(l.loaded&&l.bitmap&&l.source){Stat.drawCall++;var h=1!==a;if(h){var u=this.globalAlpha;this.globalAlpha*=a}var c=l.uv,_=l.bitmap.width,d=l.bitmap.height;r?(this.save(),this.transform(r.a,r.b,r.c,r.d,r.tx+t,r.ty+e),this.drawImage(l.source,c[0]*_,c[1]*d,(c[2]-c[0])*_,(c[5]-c[3])*d,o[1]-i,o[2]-n,o[3],o[4]),this.restore()):this.drawImage(l.source,c[0]*_,c[1]*d,(c[2]-c[0])*_,(c[5]-c[3])*d,o[1]-i+t,o[2]-n+e,o[3],o[4]),h&&(this.globalAlpha=u)}},t.fillTexture=function(t,e,i,n,r,a,s,o){if(!o.pat){if(t.uv!=Texture.DEF_UV){var l=new HTMLCanvas("2D");l.getContext("2d"),l.size(t.width,t.height),l.context.drawTexture(t,0,0,t.width,t.height,0,0),t=new Texture(l)}o.pat=this.createPattern(t.bitmap.source,a)}var h=e,u=i,c=0,_=0;s&&(h+=s.x%t.width,u+=s.y%t.height,c-=s.x%t.width,_-=s.y%t.height),this.translate(h,u),this.fillRect(c,_,n,r,o.pat),this.translate(-h,-u)},t.drawTriangle=function(t,e,i,n,r,a,s,o){var l=t.bitmap,h=l.source,u=t.width,c=t.height,_=l.width,d=l.height,f=i[n]*_,p=i[r]*_,m=i[a]*_,g=i[n+1]*d,v=i[r+1]*d,y=i[a+1]*d,x=e[n],E=e[r],T=e[a],S=e[n+1],w=e[r+1],M=e[a+1];if(o){var D=(x+E+T)/3,I=(S+w+M)/3,b=x-D,C=S-I,A=Math.sqrt(b*b+C*C);x=D+b/A*(A+1),S=I+C/A*(A+1),C=w-I,E=D+(b=E-D)/(A=Math.sqrt(b*b+C*C))*(A+1),w=I+C/A*(A+1),C=M-I,T=D+(b=T-D)/(A=Math.sqrt(b*b+C*C))*(A+1),M=I+C/A*(A+1)}this.save(),s&&this.transform(s.a,s.b,s.c,s.d,s.tx,s.ty),this.beginPath(),this.moveTo(x,S),this.lineTo(E,w),this.lineTo(T,M),this.closePath(),this.clip();var R=1/(f*v+g*m+p*y-v*m-g*p-f*y),L=x*v+g*T+E*y-v*T-g*E-x*y,O=f*E+x*m+p*T-E*m-x*p-f*T,P=f*v*T+g*E*m+x*p*y-x*v*m-g*p*T-f*E*y,N=S*v+g*M+w*y-v*M-g*w-S*y,V=f*w+S*m+p*M-w*m-S*p-f*M,F=f*v*M+g*w*m+S*p*y-S*v*m-g*p*M-f*w*y;this.transform(L*R,N*R,O*R,V*R,P*R,F*R),this.drawImage(h,t.uv[0]*_,t.uv[1]*d,u,c,t.uv[0]*_,t.uv[1]*d,u,c),this.restore()},t.flush=function(){return 0},t.fillWords=function(t,e,i,n,r,a){n&&(this.font=n),r&&(this.fillStyle=r);this.textBaseline="top",this.textAlign="left";for(var s=0,o=t.length;s<o;s++){var l=t[s];if(this.__fillText(l.char,l.x+e,l.y+i),1===a){var h=l.height,u=.5*l.style.letterSpacing;u||(u=0),this.beginPath(),this.strokeStyle=r,this.lineWidth=1,this.moveTo(e+l.x-u+.5,i+l.y+h+.5),this.lineTo(e+l.x+l.width+u+.5,i+l.y+h+.5),this.stroke()}}},t.fillBorderWords=function(t,e,i,n,r,a,s){n&&(this.font=n),r&&(this.fillStyle=r),this.textBaseline="top",this.lineWidth=s,this.textAlign="left",this.strokeStyle=a;for(var o=0,l=t.length;o<l;o++){var h=t[o];this.__strokeText(h.char,h.x+e,h.y+i),this.__fillText(h.char,h.x+e,h.y+i)}},t.destroy=function(){this.canvas.width=this.canvas.height=0},t.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},t.drawCurves=function(t,e,i){this.beginPath(),this.strokeStyle=i[3],this.lineWidth=i[4];var n=i[2];t+=i[0],e+=i[1],this.moveTo(t+n[0],e+n[1]);for(var r=2,a=n.length;r<a;)this.quadraticCurveTo(t+n[r++],e+n[r++],t+n[r++],e+n[r++]);this.stroke()},o.__init__=function(e){var i=laya.resource.Context.prototype;if(!(e=e||CanvasRenderingContext2D.prototype).inited){e.inited=!0,e.__fillText=e.fillText,e.__fillRect=e.fillRect,e.__strokeText=e.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function(t){e[t]=i[t]})}},o.replaceCanvasGetSet=function(t,e){var i=Object.getOwnPropertyDescriptor(t,e);if(!i||!i.configurable)return!1;var n,r={};for(n in i)"set"!=n&&(r[n]=i[n]);var a=i.set;return r.set=function(t){a.call(this,t);var e=this.getContext("2d");e&&"__reset"in e&&e.__reset()},Object.defineProperty(t,e,r),!0},o.replaceGetSet=function(t,e){var i=Object.getOwnPropertyDescriptor(t,e);if(!i||!i.configurable)return!1;var n,r={};for(n in i)"set"!=n&&(r[n]=i[n]);var a=i.set,s="___"+e+"__";return o.newKeys.push(s),r.set=function(t){t!=this[s]&&(this[s]=t,a.call(this,t))},Object.defineProperty(t,e,r),!0},o._default=new o,o.newKeys=[],__static(o,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),o}(),ResourceManager=function(){function a(t){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++a._uniqueIDCounter,this._name=t||"Content Manager",a._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,a._resourceManagers.push(this),this._resources=[]}__class(a,"laya.resource.ResourceManager");var t=a.prototype;return Laya.imps(t,{"laya.resource.IDispose":!0}),t.getResourceByIndex=function(t){return this._resources[t]},t.getResourcesLength=function(){return this._resources.length},t.addResource=function(t){return t.resourceManager&&t.resourceManager.removeResource(t),-1===this._resources.indexOf(t)&&((t._resourceManager=this)._resources.push(t),this.addSize(t.memorySize),!0)},t.removeResource=function(t){var e=this._resources.indexOf(t);return-1!==e&&(this._resources.splice(e,1),t._resourceManager=null,this._memorySize-=t.memorySize,!0)},t.unload=function(){for(var t=this._resources.slice(0,this._resources.length),e=0;e<t.length;e++){t[e].destroy()}t.length=0},t.dispose=function(){if(this===a._systemResourceManager)throw new Error("systemResourceManager不能被释放！");a._resourceManagers.splice(a._resourceManagers.indexOf(this),1),a._isResourceManagersSorted=!1;for(var t=this._resources.slice(0,this._resources.length),e=0;e<t.length;e++){var i=t[e];i.resourceManager.removeResource(i),i.destroy()}t.length=0},t.addSize=function(t){t&&(this.autoRelease&&0<t&&this._memorySize+t>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=t)},t.garbageCollection=function(t){var e=this._resources;(e=e.slice()).sort(function(t,e){if(!t||!e)throw new Error("a或b不能为空！");return t.released&&e.released?0:t.released?1:e.released?-1:t._lastUseFrameCount-e._lastUseFrameCount});for(var i=Stat.loopCount,n=0,r=e.length;n<r;n++){var a=e[n];if(!(1<i-a._lastUseFrameCount))return void(this._memorySize>=t&&(this._isOverflow=!0));if(a.releaseResource(),this._memorySize<t)return void(this._isOverflow=!1)}},__getset(0,t,"id",function(){return this._id}),__getset(0,t,"name",function(){return this._name},function(t){!t&&""===t||this._name===t||(this._name=t,a._isResourceManagersSorted=!1)}),__getset(0,t,"memorySize",function(){return this._memorySize}),__getset(1,a,"systemResourceManager",function(){return a._systemResourceManager}),a.__init__=function(){a.currentResourceManager=a.systemResourceManager},a.getLoadedResourceManagerByIndex=function(t){return a._resourceManagers[t]},a.getLoadedResourceManagersCount=function(){return a._resourceManagers.length},a.recreateContentManagers=function(t){void 0===t&&(t=!1);for(var e=a.currentResourceManager,i=0;i<a._resourceManagers.length;i++){a.currentResourceManager=a._resourceManagers[i];for(var n=0;n<a.currentResourceManager._resources.length;n++)a.currentResourceManager._resources[n].releaseResource(t),a.currentResourceManager._resources[n].activeResource(t)}a.currentResourceManager=e},a.releaseContentManagers=function(t){void 0===t&&(t=!1);for(var e=a.currentResourceManager,i=0;i<a._resourceManagers.length;i++){a.currentResourceManager=a._resourceManagers[i];for(var n=0;n<a.currentResourceManager._resources.length;n++){var r=a.currentResourceManager._resources[n];!r.released&&r.releaseResource(t)}}a.currentResourceManager=e},a._uniqueIDCounter=0,a._isResourceManagersSorted=!1,a._resourceManagers=[],__static(a,["_systemResourceManager",function(){return this._systemResourceManager=new a("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=a._systemResourceManager}]),a}(),System=function(){function System(){}return __class(System,"laya.system.System"),System.changeDefinition=function(name,classObj){Laya[name]=classObj;var str=name+"=classObj";eval(str)},System.__init__=function(){Render.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())},System}(),Browser=function(){function i(){}return __class(i,"laya.utils.Browser"),__getset(1,i,"pixelRatio",function(){return i.__init__(),-1<i.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:RunDriver.getPixelRatio()}),__getset(1,i,"height",function(){return i.__init__(),(Laya.stage&&Laya.stage.canvasRotation?i.clientWidth:i.clientHeight)*i.pixelRatio}),__getset(1,i,"clientWidth",function(){return i.__init__(),i.window.innerWidth||i.document.body.clientWidth}),__getset(1,i,"window",function(){return i.__init__(),i._window}),__getset(1,i,"clientHeight",function(){return i.__init__(),i.window.innerHeight||i.document.body.clientHeight||i.document.documentElement.clientHeight}),__getset(1,i,"width",function(){return i.__init__(),(Laya.stage&&Laya.stage.canvasRotation?i.clientHeight:i.clientWidth)*i.pixelRatio}),__getset(1,i,"container",function(){return i.__init__(),i._container||((i._container=i.createElement("div")).id="layaContainer",i.document.body.appendChild(i._container)),i._container},function(t){i._container=t}),__getset(1,i,"document",function(){return i.__init__(),i._document}),i.__init__=function(){i._window||(i._window=RunDriver.getWindow(),i._document=i.window.document,i._window.addEventListener("message",function(t){laya.utils.Browser._onMessage(t)},!1),i.document.__createElement=i.document.createElement,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)},i.userAgent=i.window.navigator.userAgent,i.onIOS=!!(i.u=i.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),i.onMobile=-1<i.u.indexOf("Mobile"),i.onIPhone=-1<i.u.indexOf("iPhone"),i.onMac=-1<i.u.indexOf("Mac OS X"),i.onIPad=-1<i.u.indexOf("iPad"),i.onAndriod=-1<i.u.indexOf("Android")||-1<i.u.indexOf("Adr"),i.onWP=-1<i.u.indexOf("Windows Phone"),i.onQQBrowser=-1<i.u.indexOf("QQBrowser"),i.onMQQBrowser=-1<i.u.indexOf("MQQBrowser")||-1<i.u.indexOf("Mobile")&&-1<i.u.indexOf("QQ"),i.onIE=!!i.window.ActiveXObject||"ActiveXObject"in i.window,i.onWeiXin=-1<i.u.indexOf("MicroMessenger"),i.onPC=!i.onMobile,i.onSafari=-1<i.u.indexOf("Safari"),i.onFirefox=-1<i.u.indexOf("Firefox"),i.onEdge=-1<i.u.indexOf("Edge"),i.onMiniGame=-1<i.u.indexOf("MiniGame"),i.onLimixiu=-1<i.u.indexOf("limixiu"),i.httpProtocol="http:"==i.window.location.protocol,i.onMiniGame&&null==i.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),i.webAudioEnabled=!!(i.window.AudioContext||i.window.webkitAudioContext||i.window.mozAudioContext),i.soundType=i.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",Sound=i.webAudioEnabled?WebAudioSound:AudioSound,i.webAudioEnabled&&WebAudioSound.initWebAudio(),AudioSound._initMusicAudio(),i.enableTouch="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,window.focus(),SoundManager._soundClass=Sound,SoundManager._musicClass=AudioSound,Render._mainCanvas=Render._mainCanvas||HTMLCanvas.create("2D"),i.canvas||(i.canvas=HTMLCanvas.create("2D"),i.context=i.canvas.getContext("2d")))},i._onMessage=function(t){if(t.data&&"size"==t.data.name){if(i.window.innerWidth=t.data.width,i.window.innerHeight=t.data.height,i.window.__innerHeight=t.data.clientHeight,!i.document.createEvent)return void console.warn("no document.createEvent");var e=i.document.createEvent("HTMLEvents");return e.initEvent("resize",!1,!1),void i.window.dispatchEvent(e)}},i.createElement=function(t){return i.__init__(),i.document.__createElement(t)},i.getElementById=function(t){return i.__init__(),i.document.getElementById(t)},i.removeElement=function(t){t&&t.parentNode&&t.parentNode.removeChild(t)},i.now=function(){return RunDriver.now()},i._window=null,i._document=null,i._container=null,i.userAgent=null,i.u=null,i.onIOS=!1,i.onMac=!1,i.onMobile=!1,i.onIPhone=!1,i.onIPad=!1,i.onAndriod=!1,i.onAndroid=!1,i.onWP=!1,i.onQQBrowser=!1,i.onMQQBrowser=!1,i.onSafari=!1,i.onFirefox=!1,i.onEdge=!1,i.onIE=!1,i.onWeiXin=!1,i.onMiniGame=!1,i.onLimixiu=!1,i.onPC=!1,i.httpProtocol=!1,i.webAudioEnabled=!1,i.soundType=null,i.enableTouch=!1,i.canvas=null,i.context=null,i.__init$=function(){},i}(),Byte=function(){function e(t){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,t?(this._u8d_=new Uint8Array(t),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}__class(e,"laya.utils.Byte");var t=e.prototype;return t.___resizeBuffer=function(e){try{var t=new Uint8Array(e);null!=this._u8d_&&(this._u8d_.length<=e?t.set(this._u8d_):t.set(this._u8d_.subarray(0,e))),this._u8d_=t,this._d_=new DataView(t.buffer)}catch(t){throw"___resizeBuffer err:"+e}},t.getString=function(){return this.rUTF(this.getUint16())},t.getFloat32Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var n=new Float32Array(this._d_.buffer.slice(t,i));return this._pos_=i,n},t.getUint8Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var n=new Uint8Array(this._d_.buffer.slice(t,i));return this._pos_=i,n},t.getInt16Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var n=new Int16Array(this._d_.buffer.slice(t,i));return this._pos_=i,n},t.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var t=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,t},t.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var t=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,t},t.writeFloat32=function(t){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,t,this._xd_),this._pos_+=4},t.writeFloat64=function(t){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,t,this._xd_),this._pos_+=8},t.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var t=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,t},t.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var t=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,t},t.writeInt32=function(t){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,t,this._xd_),this._pos_+=4},t.writeUint32=function(t){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,t,this._xd_),this._pos_+=4},t.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var t=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,t},t.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var t=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,t},t.writeUint16=function(t){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,t,this._xd_),this._pos_+=2},t.writeInt16=function(t){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,t,this._xd_),this._pos_+=2},t.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},t.writeUint8=function(t){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,t),this._pos_++},t._getUInt8=function(t){return this._d_.getUint8(t)},t._getUint16=function(t){return this._d_.getUint16(t,this._xd_)},t._getMatrix=function(){return new Matrix(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},t.rUTF=function(t){for(var e="",i=this._pos_+t,n=0,r=String.fromCharCode,a=this._u8d_;this._pos_<i;)(n=a[this._pos_++])<128?0!=n&&(e+=r(n)):e+=r(n<224?(63&n)<<6|127&a[this._pos_++]:n<240?(31&n)<<12|(127&a[this._pos_++])<<6|127&a[this._pos_++]:(15&n)<<18|(127&a[this._pos_++])<<12|a[this._pos_++]<<6&127|127&a[this._pos_++]),0;return e},t.getCustomString=function(t){for(var e="",i=0,n=0,r=String.fromCharCode,a=this._u8d_;0<t;)if((n=a[this._pos_])<128)e+=r(n),this._pos_++,t--;else for(i=n-128,this._pos_++,t-=i;0<i;)n=a[this._pos_++],e+=r(a[this._pos_++]<<8|n),i--;return e},t.clear=function(){this._pos_=0,this.length=0},t.__getBuffer=function(){return this._d_.buffer},t.writeUTFBytes=function(t){for(var e=0,i=(t+="").length;e<i;e++){var n=t.charCodeAt(e);n<=127?this.writeByte(n):n<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|n>>6,128|63&n],this._pos_),this._pos_+=2):n<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|n>>12,128|n>>6&63,128|63&n],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n],this._pos_),this._pos_+=4)}},t.writeUTFString=function(t){var e=this.pos;this.writeUint16(1),this.writeUTFBytes(t);var i=this.pos-e-2;if(65536<=i)throw"writeUTFString byte len more than 65536";this._d_.setUint16(e,i,this._xd_)},t.readUTFString=function(){return this.readUTFBytes(this.getUint16())},t.getUTFString=function(){return this.readUTFString()},t.readUTFBytes=function(t){if(void 0===t&&(t=-1),0==t)return"";var e=this.bytesAvailable;if(e<t)throw"readUTFBytes error - Out of bounds";return t=0<t?t:e,this.rUTF(t)},t.getUTFBytes=function(t){return void 0===t&&(t=-1),this.readUTFBytes(t)},t.writeByte=function(t){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,t),this._pos_+=1},t.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},t.getByte=function(){return this.readByte()},t.ensureWrite=function(t){this._length<t&&(this._length=t),this._allocated_<t&&(this.length=t)},t.writeArrayBuffer=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),e<0||i<0)throw"writeArrayBuffer error - Out of bounds";0==i&&(i=t.byteLength-e),this.ensureWrite(this._pos_+i);var n=new Uint8Array(t);this._u8d_.set(n.subarray(e,e+i),this._pos_),this._pos_+=i},__getset(0,t,"buffer",function(){var t=this._d_.buffer;return t.byteLength==this.length?t:t.slice(0,this.length)}),__getset(0,t,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(t){this._xd_="littleEndian"==t}),__getset(0,t,"length",function(){return this._length},function(t){this._allocated_<t?this.___resizeBuffer(this._allocated_=Math.floor(Math.max(t,2*this._allocated_))):this._allocated_>t&&this.___resizeBuffer(this._allocated_=t),this._length=t}),__getset(0,t,"pos",function(){return this._pos_},function(t){this._pos_=t}),__getset(0,t,"bytesAvailable",function(){return this._length-this._pos_}),e.getSystemEndian=function(){if(!e._sysEndian){var t=new ArrayBuffer(2);new DataView(t).setInt16(0,256,!0),e._sysEndian=256===new Int16Array(t)[0]?"littleEndian":"bigEndian"}return e._sysEndian},e.BIG_ENDIAN="bigEndian",e.LITTLE_ENDIAN="littleEndian",e._sysEndian=null,e}(),CacheManager=function(){function r(){}return __class(r,"laya.utils.CacheManager"),r.regCacheByFunction=function(t,e){var i;r.unRegCacheByFunction(t,e),i={tryDispose:t,getCacheList:e},r._cacheList.push(i)},r.unRegCacheByFunction=function(t,e){var i,n=0;for(i=r._cacheList.length,n=0;n<i;n++)if(r._cacheList[n].tryDispose==t&&r._cacheList[n].getCacheList==e)return void r._cacheList.splice(n,1)},r.forceDispose=function(){var t=0,e=r._cacheList.length;for(t=0;t<e;t++)r._cacheList[t].tryDispose(!0)},r.beginCheck=function(t){void 0===t&&(t=15e3),Laya.timer.loop(t,null,r._checkLoop)},r.stopCheck=function(){Laya.timer.clear(null,r._checkLoop)},r._checkLoop=function(){var t=r._cacheList;if(!(t.length<1)){var e,i=Browser.now(),n=0;for(e=n=t.length;0<n&&(t[r._index=++r._index%e].tryDispose(!1),!(Browser.now()-i>r.loopTimeLimit));)n--}},r.loopTimeLimit=2,r._cacheList=[],r._index=0,r}(),ClassUtils=function(){function d(){}return __class(d,"laya.utils.ClassUtils"),d.regClass=function(t,e){d._classMap[t]=e},d.getRegClass=function(t){return d._classMap[t]},d.getInstance=function(t){var e=d.getClass(t);return e?new e:(console.warn("[error] Undefined class:",t),null)},d.createByJson=function(t,e,i,n,r){"string"==typeof t&&(t=JSON.parse(t));var a=t.props;if(!e&&!(e=r?r.runWith(t):d.getInstance(a.runtime||t.type)))return null;var s=t.child;if(s)for(var o=0,l=s.length;o<l;o++){var h=s[o];if("render"!==h.props.name&&"render"!==h.props.renderType||!e._$set_itemRender)if("Graphic"==h.type)d.addGraphicsToSprite(h,e);else if(d.isDrawType(h.type))d.addGraphicToSprite(h,e,!0);else{var u=d.createByJson(h,null,i,n,r);"Script"==h.type?u.hasOwnProperty("owner")?u.owner=e:u.hasOwnProperty("target")&&(u.target=e):"mask"==h.props.renderType?e.mask=u:e.addChild(u)}else e.itemRender=h}if(a)for(var c in a){var _=a[c];"var"===c&&i?i[_]=e:_ instanceof Array&&"function"==typeof e[c]?e[c].apply(e,_):e[c]=_}return n&&t.customProps&&n.runWith([e,t]),e.created&&e.created(),e},d.addGraphicsToSprite=function(t,e){var i;if((i=t.child)&&!(i.length<1)){var n;n=d._getGraphicsFromSprite(t,e);var r=0,a=0;t.props&&(r=d._getObjVar(t.props,"x",0),a=d._getObjVar(t.props,"y",0)),0!=r&&0!=a&&n.translate(r,a);var s,o=0;for(s=i.length,o=0;o<s;o++)d._addGraphicToGraphics(i[o],n);0!=r&&0!=a&&n.translate(-r,-a)}},d.addGraphicToSprite=function(t,e,i){var n;void 0===i&&(i=!1),n=i?d._getGraphicsFromSprite(t,e):e.graphics,d._addGraphicToGraphics(t,n)},d._getGraphicsFromSprite=function(t,e){var i,n;if(!t||!t.props)return e.graphics;switch(n=t.props.renderType){case"hit":case"unHit":var r;e.hitArea||(e.hitArea=new HitArea),(r=e.hitArea)[n]||(r[n]=new Graphics),i=r[n]}return i||(i=e.graphics),i},d._getTransformData=function(t){var e;(t.hasOwnProperty("pivotX")||t.hasOwnProperty("pivotY"))&&(e=e||new Matrix).translate(-d._getObjVar(t,"pivotX",0),-d._getObjVar(t,"pivotY",0));var i=d._getObjVar(t,"scaleX",1),n=d._getObjVar(t,"scaleY",1),r=d._getObjVar(t,"rotation",0);d._getObjVar(t,"skewX",0),d._getObjVar(t,"skewY",0);return 1==i&&1==n&&0==r||((e=e||new Matrix).scale(i,n),e.rotate(.0174532922222222*r)),e},d._addGraphicToGraphics=function(t,e){var i,n;if((i=t.props)&&(n=d.DrawTypeDic[t.type])){var r,a;r=e;var s=d._getParams(i,n[1],n[2],n[3]);((a=d._tM)||1!=d._alpha)&&(r.save(),a&&r.transform(a),1!=d._alpha&&r.alpha(d._alpha)),r[n[0]].apply(r,s),(a||1!=d._alpha)&&r.restore()}},d._adptLineData=function(t){return t[2]=parseFloat(t[0])+parseFloat(t[2]),t[3]=parseFloat(t[1])+parseFloat(t[3]),t},d._adptTextureData=function(t){return t[0]=Loader.getRes(t[0]),t},d._adptLinesData=function(t){return t[2]=d._getPointListByStr(t[2]),t},d.isDrawType=function(t){return"Image"!=t&&d.DrawTypeDic.hasOwnProperty(t)},d._getParams=function(t,e,i,n){var r;void 0===i&&(i=0),(r=d._temParam).length=e.length;var a,s,o=0;for(a=e.length,o=0;o<a;o++)r[o]=d._getObjVar(t,e[o][0],e[o][1]);return d._alpha=d._getObjVar(t,"alpha",1),s=d._getTransformData(t),d._tM=s?(i||(i=0),s.translate(r[i],r[i+1]),r[i]=r[i+1]=0,s):null,n&&d[n]&&(r=d[n](r)),r},d._getPointListByStr=function(t){var e,i,n=0;for(i=(e=t.split(",")).length,n=0;n<i;n++)e[n]=parseFloat(e[n]);return e},d._getObjVar=function(t,e,i){return t.hasOwnProperty(e)?t[e]:i},d._temParam=[],d._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},d.getClass=function(t){var e=d._classMap[t]||t;return"string"==typeof e?Laya.__classmap[e]:e},d._tM=null,d._alpha=NaN,__static(d,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),d}(),Color=function(){function a(t){if(this._color=[],"string"==typeof t){null===(this.strColor=t)&&(t="#000000"),"#"==t.charAt(0)&&(t=t.substr(1));var e=t.length;if(3==e||4==e){for(var i="",n=0;n<e;n++)i+=t[n]+t[n];t=i}var r=this.numColor=parseInt(t,16);if(8==t.length)return void(this._color=[parseInt(t.substr(0,2),16)/255,((16711680&r)>>16)/255,((65280&r)>>8)/255,(255&r)/255])}else r=this.numColor=t,this.strColor=Utils.toHexColor(r);this._color=[((16711680&r)>>16)/255,((65280&r)>>8)/255,(255&r)/255,1],this._color.__id=++a._COLODID}return __class(a,"laya.utils.Color"),a._initDefault=function(){for(var t in a._DEFAULT={},a._COLOR_MAP)a._SAVE[t]=a._DEFAULT[t]=new a(a._COLOR_MAP[t]);return a._DEFAULT},a._initSaveMap=function(){for(var t in a._SAVE_SIZE=0,a._SAVE={},a._DEFAULT)a._SAVE[t]=a._DEFAULT[t]},a.create=function(t){var e=a._SAVE[t+""];return null!=e?e:(a._SAVE_SIZE<1e3||a._initSaveMap(),a._SAVE[t+""]=new a(t))},a._SAVE={},a._SAVE_SIZE=0,a._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},a._DEFAULT=a._initDefault(),a._COLODID=1,a}(),Dictionary=function(){function t(){this._values=[],this._keys=[]}__class(t,"laya.utils.Dictionary");var e=t.prototype;return e.set=function(t,e){var i=this.indexOf(t);0<=i?this._values[i]=e:(this._keys.push(t),this._values.push(e))},e.indexOf=function(t){var e=this._keys.indexOf(t);return 0<=e?e:(t="string"==typeof t?Number(t):"number"==typeof t?t.toString():t,this._keys.indexOf(t))},e.get=function(t){var e=this.indexOf(t);return e<0?null:this._values[e]},e.remove=function(t){var e=this.indexOf(t);return 0<=e&&(this._keys.splice(e,1),this._values.splice(e,1),!0)},e.clear=function(){this._values.length=0,this._keys.length=0},__getset(0,e,"values",function(){return this._values}),__getset(0,e,"keys",function(){return this._keys}),t}(),Dragging=function(){function t(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}__class(t,"laya.utils.Dragging");var e=t.prototype;return e.start=function(t,e,i,n,r,a,s,o){void 0===o&&(o=.92),this.clearTimer(),this.target=t,this.area=e,this.hasInertia=i,this.elasticDistance=e?n:0,this.elasticBackTime=r,this.data=a,this._disableMouseEvent=s,this.ratio=o,1!=t.globalScaleX||1!=t.globalScaleY?this._parent=t.parent:this._parent=Laya.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,Laya.stage.on("mouseup",this,this.onStageMouseUp),Laya.stage.on("mouseout",this,this.onStageMouseUp),Laya.timer.frameLoop(1,this,this.loop)},e.clearTimer=function(){Laya.timer.clear(this,this.loop),Laya.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},e.stop=function(){this._dragging&&(MouseManager.instance.disableMouseEvent=!1,Laya.stage.off("mouseup",this,this.onStageMouseUp),Laya.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},e.loop=function(){var t=this._parent.getMousePoint(),e=t.x,i=t.y,n=e-this._lastX,r=i-this._lastY;if(this._clickOnly){if(!(1<Math.abs(n*Laya.stage._canvasTransform.getScaleX())||1<Math.abs(r*Laya.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),MouseManager.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push(n,r);0===n&&0===r||(this._lastX=e,this._lastY=i,this.target.x+=n*this._elasticRateX,this.target.y+=r*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},e.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var t=this.area.x-this.target.x;else t=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-t/this.elasticDistance),this.target.y<this.area.y)var e=this.area.y-this.target.y;else e=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-e/this.elasticDistance)}},e.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},e.onStageMouseUp=function(t){if(MouseManager.instance.disableMouseEvent=!1,Laya.stage.off("mouseup",this,this.onStageMouseUp),Laya.stage.off("mouseout",this,this.onStageMouseUp),Laya.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var e=this._offsets.length,i=Math.min(e,6),n=this._offsets.length-i,r=e-1;n<r;r--)this._offsetY+=this._offsets[r--],this._offsetX+=this._offsets[r];this._offsetX=this._offsetX/i*2,this._offsetY=this._offsetY/i*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),Laya.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},e.checkElastic=function(){var t=NaN,e=NaN;if(this.target.x<this.area.x?t=this.area.x:this.target.x>this.area.x+this.area.width&&(t=this.area.x+this.area.width),this.target.y<this.area.y?e=this.area.y:this.target.y>this.area.y+this.area.height&&(e=this.area.y+this.area.height),isNaN(t)&&isNaN(e))this.clear();else{var i={};isNaN(t)||(i.x=t),isNaN(e)||(i.y=e),this._tween=Tween.to(this.target,i,this.elasticBackTime,Ease.sineOut,Handler.create(this,this.clear),0,!1,!1)}},e.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(Laya.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},e.clear=function(){if(this.target){this.clearTimer();var t=this.target;this.target=null,this._parent=null,t.event("dragend",this.data)}},t}(),Ease=function(){function o(){}return __class(o,"laya.utils.Ease"),o.linearNone=function(t,e,i,n){return i*t/n+e},o.linearIn=function(t,e,i,n){return i*t/n+e},o.linearInOut=function(t,e,i,n){return i*t/n+e},o.linearOut=function(t,e,i,n){return i*t/n+e},o.bounceIn=function(t,e,i,n){return i-o.bounceOut(n-t,0,i,n)+e},o.bounceInOut=function(t,e,i,n){return t<.5*n?.5*o.bounceIn(2*t,0,i,n)+e:.5*o.bounceOut(2*t-n,0,i,n)+.5*i+e},o.bounceOut=function(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},o.backIn=function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*(t/=n)*t*((r+1)*t-r)+e},o.backInOut=function(t,e,i,n,r){return void 0===r&&(r=1.70158),(t/=.5*n)<1?.5*i*(t*t*((1+(r*=1.525))*t-r))+e:i/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},o.backOut=function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*((t=t/n-1)*t*((r+1)*t+r)+1)+e},o.elasticIn=function(t,e,i,n,r,a){var s;return void 0===r&&(r=0),void 0===a&&(a=0),0==t?e:1==(t/=n)?e+i:(a||(a=.3*n),s=!r||0<i&&r<i||i<0&&r<-i?(r=i,a/4):a/o.PI2*Math.asin(i/r),-r*Math.pow(2,10*(t-=1))*Math.sin((t*n-s)*o.PI2/a)+e)},o.elasticInOut=function(t,e,i,n,r,a){var s;return void 0===r&&(r=0),void 0===a&&(a=0),0==t?e:2==(t/=.5*n)?e+i:(a||(a=n*(.3*1.5)),s=!r||0<i&&r<i||i<0&&r<-i?(r=i,a/4):a/o.PI2*Math.asin(i/r),t<1?r*Math.pow(2,10*(t-=1))*Math.sin((t*n-s)*o.PI2/a)*-.5+e:r*Math.pow(2,-10*(t-=1))*Math.sin((t*n-s)*o.PI2/a)*.5+i+e)},o.elasticOut=function(t,e,i,n,r,a){var s;return void 0===r&&(r=0),void 0===a&&(a=0),0==t?e:1==(t/=n)?e+i:(a||(a=.3*n),s=!r||0<i&&r<i||i<0&&r<-i?(r=i,a/4):a/o.PI2*Math.asin(i/r),r*Math.pow(2,-10*t)*Math.sin((t*n-s)*o.PI2/a)+i+e)},o.strongIn=function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},o.strongInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t*t+e:.5*i*((t-=2)*t*t*t*t+2)+e},o.strongOut=function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},o.sineInOut=function(t,e,i,n){return.5*-i*(Math.cos(Math.PI*t/n)-1)+e},o.sineIn=function(t,e,i,n){return-i*Math.cos(t/n*o.HALF_PI)+i+e},o.sineOut=function(t,e,i,n){return i*Math.sin(t/n*o.HALF_PI)+e},o.quintIn=function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},o.quintInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t*t+e:.5*i*((t-=2)*t*t*t*t+2)+e},o.quintOut=function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},o.quartIn=function(t,e,i,n){return i*(t/=n)*t*t*t+e},o.quartInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t+e:.5*-i*((t-=2)*t*t*t-2)+e},o.quartOut=function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},o.cubicIn=function(t,e,i,n){return i*(t/=n)*t*t+e},o.cubicInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t+e:.5*i*((t-=2)*t*t+2)+e},o.cubicOut=function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},o.quadIn=function(t,e,i,n){return i*(t/=n)*t+e},o.quadInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t+e:.5*-i*(--t*(t-2)-1)+e},o.quadOut=function(t,e,i,n){return-i*(t/=n)*(t-2)+e},o.expoIn=function(t,e,i,n){return 0==t?e:i*Math.pow(2,10*(t/n-1))+e-.001*i},o.expoInOut=function(t,e,i,n){return 0==t?e:t==n?e+i:(t/=.5*n)<1?.5*i*Math.pow(2,10*(t-1))+e:.5*i*(2-Math.pow(2,-10*--t))+e},o.expoOut=function(t,e,i,n){return t==n?e+i:i*(1-Math.pow(2,-10*t/n))+e},o.circIn=function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},o.circInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*-i*(Math.sqrt(1-t*t)-1)+e:.5*i*(Math.sqrt(1-(t-=2)*t)+1)+e},o.circOut=function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},o.HALF_PI=.5*Math.PI,o.PI2=2*Math.PI,o}(),HitArea=function(){function c(){this._hit=null,this._unHit=null}__class(c,"laya.utils.HitArea");var t=c.prototype;return t.isHit=function(t,e){return!!c.isHitGraphic(t,e,this.hit)&&!c.isHitGraphic(t,e,this.unHit)},t.contains=function(t,e){return this.isHit(t,e)},__getset(0,t,"hit",function(){return this._hit||(this._hit=new Graphics),this._hit},function(t){this._hit=t}),__getset(0,t,"unHit",function(){return this._unHit||(this._unHit=new Graphics),this._unHit},function(t){this._unHit=t}),c.isHitGraphic=function(t,e,i){if(!i)return!1;var n;if(!(n=i.cmds)&&i._one&&((n=c._cmds).length=1,n[0]=i._one),!n)return!1;var r,a,s=0;for(r=n.length,s=0;s<r;s++)if(a=n[s]){var o=Render._context;switch(a.callee){case o._translate:case 6:t-=a[0],e-=a[1]}if(c.isHitCmd(t,e,a))return!0}return!1},c.isHitCmd=function(t,e,i){if(!i)return!1;var n=Render._context,r=!1;switch(i.callee){case n._drawRect:case 13:c._rec.setTo(i[0],i[1],i[2],i[3]),r=c._rec.contains(t,e);break;case n._drawCircle:case n._fillCircle:case 14:r=(t-=i[0])*t+(e-=i[1])*e<i[2]*i[2];break;case n._drawPoly:case 18:t-=i[0],e-=i[1],r=c.ptInPolygon(t,e,i[2])}return r},c.ptInPolygon=function(t,e,i){var n;(n=c._ptPoint).setTo(t,e);var r,a=0,s=NaN,o=NaN,l=NaN,h=NaN;r=i.length;for(var u=0;u<r;u+=2){if(s=i[u],o=i[u+1],l=i[(u+2)%r],o!=(h=i[(u+3)%r]))if(!(n.y<Math.min(o,h)))if(!(n.y>=Math.max(o,h)))(n.y-o)*(l-s)/(h-o)+s>n.x&&a++}return a%2==1},c._cmds=[],__static(c,["_rec",function(){return this._rec=new Rectangle},"_ptPoint",function(){return this._ptPoint=new Point}]),c}(),HTMLChar=function(){function r(t,e,i,n){this.char=t,this.charNum=t.charCodeAt(0),this._x=this._y=0,this.width=e,this.height=i,this.style=n,this.isWord=!r._isWordRegExp.test(t)}__class(r,"laya.utils.HTMLChar");var t=r.prototype;return Laya.imps(t,{"laya.display.ILayout":!0}),t.setSprite=function(t){this._sprite=t},t.getSprite=function(){return this._sprite},t._isChar=function(){return!0},t._getCSSStyle=function(){return this.style},__getset(0,t,"width",function(){return this._w},function(t){this._w=t}),__getset(0,t,"x",function(){return this._x},function(t){this._sprite&&(this._sprite.x=t),this._x=t}),__getset(0,t,"y",function(){return this._y},function(t){this._sprite&&(this._sprite.y=t),this._y=t}),__getset(0,t,"height",function(){return this._h},function(t){this._h=t}),r._isWordRegExp=new RegExp("[\\w.]",""),r}(),Log=function(){function e(){}return __class(e,"laya.utils.Log"),e.enable=function(){e._logdiv||(e._logdiv=Browser.window.document.createElement("div"),Browser.window.document.body.appendChild(e._logdiv),e._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},e.toggle=function(){var t=e._logdiv.style;"1px"==t.width?t.width=t.height="50%":t.width=t.height="1px"},e.print=function(t){e._logdiv&&(e.maxCount<=e._count&&e.clear(),e._count++,e._logdiv.innerText+=t+"\n",e._logdiv.scrollTop=e._logdiv.scrollHeight)},e.clear=function(){e._logdiv.innerText="",e._count=0},e._logdiv=null,e._count=0,e.maxCount=20,e}(),Mouse=function(){function e(){}return __class(e,"laya.utils.Mouse"),__getset(1,e,"cursor",function(){return e._style.cursor},function(t){e._style.cursor=t}),e.hide=function(){"none"!=e.cursor&&(e._preCursor=e.cursor,e.cursor="none")},e.show=function(){"none"==e.cursor&&(e.cursor=e._preCursor?e._preCursor:"auto")},e._preCursor=null,__static(e,["_style",function(){return this._style=Browser.document.body.style}]),e}(),Pool=function(){function r(){}return __class(r,"laya.utils.Pool"),r.getPoolBySign=function(t){return r._poolDic[t]||(r._poolDic[t]=[])},r.clearBySign=function(t){r._poolDic[t]&&(r._poolDic[t].length=0)},r.recover=function(t,e){e.__InPool||(e.__InPool=!0,r.getPoolBySign(t).push(e))},r.getItemByClass=function(t,e){var i=r.getPoolBySign(t),n=i.length?i.pop():new e;return n.__InPool=!1,n},r.getItemByCreateFun=function(t,e){var i=r.getPoolBySign(t),n=i.length?i.pop():e();return n.__InPool=!1,n},r.getItem=function(t){var e=r.getPoolBySign(t),i=e.length?e.pop():null;return i&&(i.__InPool=!1),i},r._poolDic={},r.InPoolSign="__InPool",r}(),PoolCache=function(){function n(){this.sign=null,this.maxCount=1e3}__class(n,"laya.utils.PoolCache");var t=n.prototype;return t.getCacheList=function(){return Pool.getPoolBySign(this.sign)},t.tryDispose=function(t){var e;(e=Pool.getPoolBySign(this.sign)).length>this.maxCount&&e.splice(this.maxCount,e.length-this.maxCount)},n.addPoolCacheManager=function(t,e){var i;void 0===e&&(e=100),(i=new n).sign=t,i.maxCount=e,CacheManager.regCacheByFunction(Utils.bind(i.tryDispose,i),Utils.bind(i.getCacheList,i))},n}(),Stat=function(){function l(){}return __class(l,"laya.utils.Stat"),__getset(1,l,"onclick",null,function(t){l._sp&&l._sp.on("click",l._sp,t),l._canvas&&(l._canvas.source.onclick=t,l._canvas.source.style.pointerEvents="")}),l.show=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),Render.isConchApp?Browser.window.conch.showFPS&&Browser.window.conch.showFPS(t,e):(Browser.onMiniGame||Browser.onLimixiu||(l._useCanvas=!0),l._show=!0,l._fpsData.length=60,l._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},l._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},l._view[2]={title:"DrawCall",value:"drawCall",color:"white",units:"int"},l._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},Render.isWebGL?(l._view[4]={title:"Shader",value:"shaderCall",color:"white",units:"int"},Render.is3DMode?(l._view[0].title="FPS(3D)",l._view[5]={title:"TriFaces",value:"trianglesFaces",color:"white",units:"int"},l._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},l._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"}):(l._view[0].title="FPS(WebGL)",l._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"})):l._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"},l._useCanvas?l.createUIPre(t,e):l.createUI(t,e),l.enable())},l.createUIPre=function(t,e){var i=Browser.pixelRatio;l._width=130*i,l._vx=75*i,l._height=i*(12*l._view.length+3*i)+4,l._fontSize=12*i;for(var n=0;n<l._view.length;n++)l._view[n].x=4,l._view[n].y=n*l._fontSize+2*i;l._canvas||((l._canvas=new HTMLCanvas("2D")).size(l._width,l._height),(l._ctx=l._canvas.getContext("2d")).textBaseline="top",l._ctx.font=l._fontSize+"px Sans-serif",l._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+t+"px;top:"+e+"px;width:"+l._width/i+"px;height:"+l._height/i+"px;"),l._first=!0,l.loop(),l._first=!1,Browser.container.appendChild(l._canvas.source)},l.createUI=function(t,e){var i=l._sp,n=Browser.pixelRatio;i||(i=new Sprite,(l._leftText=new Text).pos(5,5),l._leftText.color="#ffffff",i.addChild(l._leftText),(l._txt=new Text).pos(80*n,5),l._txt.color="#ffffff",i.addChild(l._txt),l._sp=i),i.pos(t,e);for(var r="",a=0;a<l._view.length;a++){r+=l._view[a].title+"\n"}l._leftText.text=r;var s=138*n,o=n*(12*l._view.length+3*n)+4;l._txt.fontSize=l._fontSize*n,l._leftText.fontSize=l._fontSize*n,i.size(s,o),i.graphics.clear(),i.graphics.setAlpha(.5),i.graphics.drawRect(0,0,s,o,"#999999"),i.graphics.setAlpha(1),l.loop()},l.enable=function(){Laya.timer.frameLoop(1,l,l.loop)},l.hide=function(){l._show=!1,Laya.timer.clear(l,l.loop),l._canvas&&Browser.removeElement(l._canvas.source)},l.clear=function(){l.trianglesFaces=l.drawCall=l.shaderCall=l.spriteCount=l.spriteRenderUseCacheCount=l.treeNodeCollision=l.treeSpriteCollision=l.canvasNormal=l.canvasBitmap=l.canvasReCache=0},l.loop=function(){l._count++;var t=Browser.now();if(!(t-l._timer<1e3)){var e=l._count;if(l.FPS=Math.round(1e3*e/(t-l._timer)),l._show){l.trianglesFaces=Math.round(l.trianglesFaces/e),l.spriteCount=l._useCanvas?(l.drawCall=Math.round(l.drawCall/e)-2,l.shaderCall=Math.round(l.shaderCall/e),Math.round(l.spriteCount/e)-1):(l.drawCall=Math.round(l.drawCall/e)-2,l.shaderCall=Math.round(l.shaderCall/e)-4,Math.round(l.spriteCount/e)-4),l.spriteRenderUseCacheCount=Math.round(l.spriteRenderUseCacheCount/e),l.canvasNormal=Math.round(l.canvasNormal/e),l.canvasBitmap=Math.round(l.canvasBitmap/e),l.canvasReCache=Math.ceil(l.canvasReCache/e),l.treeNodeCollision=Math.round(l.treeNodeCollision/e),l.treeSpriteCollision=Math.round(l.treeSpriteCollision/e);var i=0<l.FPS?Math.floor(1e3/l.FPS).toString():" ";l._fpsStr=l.FPS+(l.renderSlow?" slow":"")+" "+i,l._spriteStr=l.spriteCount+(l.spriteRenderUseCacheCount?"/"+l.spriteRenderUseCacheCount:""),l._canvasStr=l.canvasReCache+"/"+l.canvasNormal+"/"+l.canvasBitmap,l.currentMemorySize=ResourceManager.systemResourceManager.memorySize,l._useCanvas?l.renderInfoPre():l.renderInfo(),l.clear()}l._count=0,l._timer=t}},l.renderInfoPre=function(){if(l._canvas){var t=l._ctx;t.clearRect(l._first?0:l._vx,0,l._width,l._height);for(var e=0;e<l._view.length;e++){var i=l._view[e];l._first&&(t.fillStyle="white",t.fillText(i.title,i.x,i.y,null,null,null)),t.fillStyle=i.color;var n=l[i.value];"M"==i.units&&(n=Math.floor(n/1048576*100)/100+" M"),t.fillText(n+"",i.x+l._vx,i.y,null,null,null)}}},l.renderInfo=function(){for(var t="",e=0;e<l._view.length;e++){var i=l._view[e],n=l[i.value];"M"==i.units&&(n=Math.floor(n/1048576*100)/100+" M"),"K"==i.units&&(n=Math.floor(n/1024*100)/100+" K"),t+=n+"\n"}l._txt.text=t},l.FPS=0,l.loopCount=0,l.shaderCall=0,l.drawCall=0,l.trianglesFaces=0,l.spriteCount=0,l.spriteRenderUseCacheCount=0,l.treeNodeCollision=0,l.treeSpriteCollision=0,l.canvasNormal=0,l.canvasBitmap=0,l.canvasReCache=0,l.renderSlow=!1,l.currentMemorySize=0,l._fpsStr=null,l._canvasStr=null,l._spriteStr=null,l._fpsData=[],l._timer=0,l._count=0,l._view=[],l._fontSize=12,l._txt=null,l._leftText=null,l._sp=null,l._show=!1,l._useCanvas=!1,l._canvas=null,l._ctx=null,l._first=!1,l._vx=NaN,l._width=0,l._height=100,l}(),StringKey=function(){function t(){this._strsToID={},this._idToStrs=[],this._length=0}__class(t,"laya.utils.StringKey");var e=t.prototype;return e.add=function(t){var e=this._strsToID[t];return null!=e?e:(this._idToStrs[this._length]=t,this._strsToID[t]=this._length++)},e.getID=function(t){var e=this._strsToID[t];return null==e?-1:e},e.getName=function(t){var e=this._idToStrs[t];return null==e?void 0:e},t}(),Timer=function(){var l;function h(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map=[],this._laters=[],this._handlers=[],this._temp=[],this._count=0,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}__class(h,"laya.utils.Timer");var t=h.prototype;return t._init=function(){Laya.timer&&Laya.timer.frameLoop(1,this,this._update)},t._now=function(){return Date.now()},t._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var t=this.currFrame=this.currFrame+this.scale,e=this._now();this._delta=(e-this._lastTimer)*this.scale;var i=this.currTimer=this.currTimer+this._delta;this._lastTimer=e;var n=this._handlers;for(s=this._count=0,o=n.length;s<o;s++)if(null!==(l=n[s]).method){var r=l.userFrame?t:i;if(r>=l.exeTime)if(l.repeat)if(l.jumpFrame)for(;r>=l.exeTime;)l.exeTime+=l.delay,l.run(!1);else l.exeTime+=l.delay,l.run(!1),r>l.exeTime&&(l.exeTime+=Math.ceil((r-l.exeTime)/l.delay)*l.delay);else l.run(!0)}else this._count++;(30<this._count||t%200==0)&&this._clearHandlers();for(var a=this._laters,s=0,o=a.length-1;s<=o;s++){var l=a[s];null!==l.method&&(this._map[l.key]=null,l.run(!1)),this._recoverHandler(l),s===o&&(o=a.length-1)}a.length=0}},t._clearHandlers=function(){for(var t=this._handlers,e=0,i=t.length;e<i;e++){var n=t[e];null!==n.method?this._temp.push(n):this._recoverHandler(n)}this._handlers=this._temp,this._temp=t,this._temp.length=0},t._recoverHandler=function(t){this._map[t.key]==t&&(this._map[t.key]=null),t.clear(),h._pool.push(t)},t._create=function(t,e,i,n,r,a,s){if(!i)return r.apply(n,a),null;if(s){var o=this._getHandler(n,r);if(o)return o.repeat=e,o.userFrame=t,o.delay=i,o.caller=n,o.method=r,o.args=a,o.exeTime=i+(t?this.currFrame:this.currTimer+this._now()-this._lastTimer),o}return(o=0<h._pool.length?h._pool.pop():new l).repeat=e,o.userFrame=t,o.delay=i,o.caller=n,o.method=r,o.args=a,o.exeTime=i+(t?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler(o),this._handlers.push(o),o},t._indexHandler=function(t){var e=t.caller,i=t.method,n=e?e.$_GID||(e.$_GID=Utils.getGID()):0,r=i.$_TID||(i.$_TID=1e5*this._mid++);t.key=n+r,this._map[t.key]=t},t.once=function(t,e,i,n,r){void 0===r&&(r=!0),this._create(!1,!1,t,e,i,n,r)},t.loop=function(t,e,i,n,r,a){void 0===r&&(r=!0),void 0===a&&(a=!1);var s=this._create(!1,!0,t,e,i,n,r);s&&(s.jumpFrame=a)},t.frameOnce=function(t,e,i,n,r){void 0===r&&(r=!0),this._create(!0,!1,t,e,i,n,r)},t.frameLoop=function(t,e,i,n,r){void 0===r&&(r=!0),this._create(!0,!0,t,e,i,n,r)},t.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+h._pool.length},t.clear=function(t,e){var i=this._getHandler(t,e);i&&(this._map[i.key]=null,i.key=0,i.clear())},t.clearAll=function(t){if(t)for(var e=0,i=this._handlers.length;e<i;e++){var n=this._handlers[e];n.caller===t&&(this._map[n.key]=null,n.key=0,n.clear())}},t._getHandler=function(t,e){var i=t?t.$_GID||(t.$_GID=Utils.getGID()):0,n=e.$_TID||(e.$_TID=1e5*this._mid++);return this._map[i+n]},t.callLater=function(t,e,i){if(null==this._getHandler(t,e)){if(h._pool.length)var n=h._pool.pop();else n=new l;n.caller=t,n.method=e,n.args=i,this._indexHandler(n),this._laters.push(n)}},t.runCallLater=function(t,e){var i=this._getHandler(t,e);i&&null!=i.method&&(this._map[i.key]=null,i.run(!0))},t.runTimer=function(t,e){this.runCallLater(t,e)},__getset(0,t,"delta",function(){return this._delta}),h._pool=[],h.__init$=function(){l=function(){function t(){this.key=0,this.repeat=!1,this.delay=0,this.userFrame=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}__class(t,"");var e=t.prototype;return e.clear=function(){this.caller=null,this.method=null,this.args=null},e.run=function(t){var e=this.caller;if(e&&e.destroyed)return this.clear();var i=this.method,n=this.args;t&&this.clear(),null!=i&&(n?i.apply(e,n):i.call(e))},t}()},h}(),Tween=function(){function c(){this.gid=0}__class(c,"laya.utils.Tween");var t=c.prototype;return t.to=function(t,e,i,n,r,a,s){return void 0===a&&(a=0),void 0===s&&(s=!1),this._create(t,e,i,n,r,a,s,!0,!1,!0)},t.from=function(t,e,i,n,r,a,s){return void 0===a&&(a=0),void 0===s&&(s=!1),this._create(t,e,i,n,r,a,s,!1,!1,!0)},t._create=function(t,e,i,n,r,a,s,o,l,h){if(!t)throw new Error("Tween:target is null");this._target=t,this._duration=i,this._ease=n||e.ease||c.easeNone,this._complete=r||e.complete,this._delay=a,this._props=[],this._usedTimer=0,this._startTimer=Browser.now(),this._usedPool=l,this._delayParam=null,this.update=e.update;var u=t.$_GID||(t.$_GID=Utils.getGID());return c.tweenMap[u]?(s&&c.clearTween(t),c.tweenMap[u].push(this)):c.tweenMap[u]=[this],h?a<=0?this.firstStart(t,e,o):(this._delayParam=[t,e,o],Laya.scaleTimer.once(a,this,this.firstStart,this._delayParam)):this._initProps(t,e,o),this},t.firstStart=function(t,e,i){this._delayParam=null,t.destroyed?this.clear():(this._initProps(t,e,i),this._beginLoop())},t._initProps=function(t,e,i){for(var n in e)if("number"==typeof t[n]){var r=i?t[n]:e[n],a=i?e[n]:t[n];this._props.push([n,r,a-r]),i||(t[n]=r)}},t._beginLoop=function(){Laya.scaleTimer.frameLoop(1,this,this._doEase)},t._doEase=function(){this._updateEase(Browser.now())},t._updateEase=function(t){var e=this._target;if(e){if(e.destroyed)return c.clearTween(e);var i=this._usedTimer=t-this._startTimer-this._delay;if(!(i<0)){if(i>=this._duration)return this.complete();for(var n=0<i?this._ease(i,0,1,this._duration):0,r=this._props,a=0,s=r.length;a<s;a++){var o=r[a];e[o[0]]=o[1]+n*o[2]}this.update&&this.update.run()}}},t.complete=function(){if(this._target){Laya.scaleTimer.runTimer(this,this.firstStart);for(var t=this._target,e=this._props,i=this._complete,n=0,r=e.length;n<r;n++){var a=e[n];t[a[0]]=a[1]+a[2]}this.update&&this.update.run(),this.clear(),i&&i.run()}},t.pause=function(){Laya.scaleTimer.clear(this,this._beginLoop),Laya.scaleTimer.clear(this,this._doEase),Laya.scaleTimer.clear(this,this.firstStart);var t;(t=Browser.now()-this._startTimer-this._delay)<0&&(this._usedTimer=t)},t.setStartTime=function(t){this._startTimer=t},t.clear=function(){this._target&&(this._remove(),this._clear())},t._clear=function(){this.pause(),Laya.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,Pool.recover("tween",this))},t.recover=function(){this._usedPool=!0,this._clear()},t._remove=function(){var t=c.tweenMap[this._target.$_GID];if(t)for(var e=0,i=t.length;e<i;e++)if(t[e]===this){t.splice(e,1);break}},t.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=Browser.now(),this._delayParam)Laya.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var t=this._props,e=0,i=t.length;e<i;e++){var n=t[e];this._target[n[0]]=n[1]}Laya.scaleTimer.once(this._delay,this,this._beginLoop)}},t.resume=function(){this._usedTimer>=this._duration||(this._startTimer=Browser.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?Laya.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},__getset(0,t,"progress",null,function(t){var e=t*this._duration;this._startTimer=Browser.now()-this._delay-e}),c.to=function(t,e,i,n,r,a,s,o){return void 0===a&&(a=0),void 0===s&&(s=!1),void 0===o&&(o=!0),Pool.getItemByClass("tween",c)._create(t,e,i,n,r,a,s,!0,o,!0)},c.from=function(t,e,i,n,r,a,s,o){return void 0===a&&(a=0),void 0===s&&(s=!1),void 0===o&&(o=!0),Pool.getItemByClass("tween",c)._create(t,e,i,n,r,a,s,!1,o,!0)},c.clearAll=function(t){if(t&&t.$_GID){var e=c.tweenMap[t.$_GID];if(e){for(var i=0,n=e.length;i<n;i++)e[i]._clear();e.length=0}}},c.clear=function(t){t.clear()},c.clearTween=function(t){c.clearAll(t)},c.easeNone=function(t,e,i,n){return i*t/n+e},c.tweenMap={},c}(),Utils=function(){function o(){}return __class(o,"laya.utils.Utils"),o.toRadian=function(t){return t*o._pi2},o.toAngle=function(t){return t*o._pi},o.toHexColor=function(t){if(t<0||isNaN(t))return null;for(var e=t.toString(16);e.length<6;)e="0"+e;return"#"+e},o.getGID=function(){return o._gid++},o.concatArray=function(t,e){if(!e)return t;if(!t)return e;var i=0,n=e.length;for(i=0;i<n;i++)t.push(e[i]);return t},o.clearArray=function(t){return t&&(t.length=0),t},o.copyArray=function(t,e){if(t||(t=[]),!e)return t;t.length=e.length;var i=0,n=e.length;for(i=0;i<n;i++)t[i]=e[i];return t},o.getGlobalRecByPoints=function(t,e,i,n,r){var a,s;return a=new Point(e,i),a=t.localToGlobal(a),s=new Point(n,r),s=t.localToGlobal(s),Rectangle._getWrapRec([a.x,a.y,s.x,s.y])},o.getGlobalPosAndScale=function(t){return o.getGlobalRecByPoints(t,0,0,1,1)},o.bind=function(t,e){return t.bind(e)},o.measureText=function(t,e){return RunDriver.measureText(t,e)},o.updateOrder=function(t){if(!t||t.length<2)return!1;for(var e,i=1,n=0,r=t.length,a=NaN;i<r;){for(e=t[n=i],a=t[n]._zOrder;-1<--n&&t[n]._zOrder>a;)t[n+1]=t[n];t[n+1]=e,i++}var s=e.parent.conchModel;if(s)if(null!=s.updateZOrder)s.updateZOrder();else{for(i=0;i<r;i++)s.removeChild(t[i].conchModel);for(i=0;i<r;i++)s.addChildAt(t[i].conchModel,i)}return!0},o.transPointList=function(t,e,i){var n=0,r=t.length;for(n=0;n<r;n+=2)t[n]+=e,t[n+1]+=i},o.parseInt=function(t,e){void 0===e&&(e=0);var i=Browser.window.parseInt(t,e);return isNaN(i)?0:i},o.getFileExtension=function(t){o._extReg.lastIndex=t.lastIndexOf(".");var e=o._extReg.exec(t);return e&&1<e.length?e[1].toLowerCase():null},o.getTransformRelativeToWindow=function(t,e,i){var n=Laya.stage,r=laya.utils.Utils.getGlobalPosAndScale(t),a=n._canvasTransform.clone(),s=a.tx,o=a.ty;a.rotate(-Math.PI/180*Laya.stage.canvasDegree),a.scale(Laya.stage.clientScaleX,Laya.stage.clientScaleY);var l=Laya.stage.canvasDegree%180!=0,h=NaN,u=NaN;l?(h=i+r.y,u=e+r.x,h*=a.d,u*=a.a,90==Laya.stage.canvasDegree?(h=s-h,u+=o):(h+=s,u=o-u)):(h=e+r.x,u=i+r.y,h*=a.a,u*=a.d,h+=s,u+=o);var c=NaN,_=NaN;return _=l?(c=a.d*r.height,a.a*r.width):(c=a.a*r.width,a.d*r.height),{x:h,y:u,scaleX:c,scaleY:_}},o.fitDOMElementInArea=function(t,e,i,n,r,a){t._fitLayaAirInitialized||(t._fitLayaAirInitialized=!0,t.style.transformOrigin=t.style.webKittransformOrigin="left top",t.style.position="absolute");var s=o.getTransformRelativeToWindow(e,i,n);t.style.transform=t.style.webkitTransform="scale("+s.scaleX+","+s.scaleY+") rotate("+Laya.stage.canvasDegree+"deg)",t.style.width=r+"px",t.style.height=a+"px",t.style.left=s.x+"px",t.style.top=s.y+"px"},o.isOkTextureList=function(t){if(!t)return!1;var e,i=0,n=t.length;for(i=0;i<n;i++)if(!(e=t[i])||!e.source)return!1;return!0},o.isOKCmdList=function(t){if(!t)return!1;var e,i,n=0,r=t.length,a=Render._context;for(n=0;n<r;n++)switch((e=t[n]).callee){case a._drawTexture:case a._fillTexture:case a._drawTextureWithTransform:if(!(i=e[0])||!i.source)return!1}return!0},o._gid=1,o._pi=180/Math.PI,o._pi2=Math.PI/180,o._extReg=/\.(\w+)\??/g,o.parseXMLFromString=function(t){var e;if(t=t.replace(/>\s+</g,"><"),-1<(e=(new DOMParser).parseFromString(t,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error(e.firstChild.firstChild.textContent);return e},o}(),VectorGraphManager=function(){function t(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],Render.isWebGL&&CacheManager.regCacheByFunction(Utils.bind(this.startDispose,this),Utils.bind(this.getCacheList,this))}__class(t,"laya.utils.VectorGraphManager");var e=t.prototype;return e.getId=function(){return this._id++},e.addShape=function(t,e){this.shapeDic[t]=e,this.useDic[t]||(this.useDic[t]=!0)},e.addLine=function(t,e){this.shapeLineDic[t]=e,this.shapeLineDic[t]||(this.shapeLineDic[t]=!0)},e.getShape=function(t){this._checkKey&&null!=this.useDic[t]&&(this.useDic[t]=!0)},e.deleteShape=function(t){this.shapeDic[t]&&(this.shapeDic[t]=null,delete this.shapeDic[t]),this.shapeLineDic[t]&&(this.shapeLineDic[t]=null,delete this.shapeLineDic[t]),null!=this.useDic[t]&&delete this.useDic[t]},e.getCacheList=function(){var t,e=[];for(t in this.shapeDic)e.push(this.shapeDic[t]);for(t in this.shapeLineDic)e.push(this.shapeLineDic[t]);return e},e.startDispose=function(t){var e;for(e in this.useDic)this.useDic[e]=!1;this._checkKey=!0},e.endDispose=function(){if(this._checkKey){var t;for(t in this.useDic)this.useDic[t]||this.deleteShape(t);this._checkKey=!1}},t.getInstance=function(){return t.instance=t.instance||new t},t.instance=null,t}(),WeakObject=function(){function n(){this._obj=null,this._obj=n.supportWeakMap?new Browser.window.WeakMap:{},n.supportWeakMap||n._maps.push(this)}__class(n,"laya.utils.WeakObject");var t=n.prototype;return t.set=function(t,e){if(null!=t)if(n.supportWeakMap){var i=t;"string"!=typeof t&&"number"!=typeof t||(i=n._keys[t])||(i=n._keys[t]={k:t}),this._obj.set(i,e)}else"string"==typeof t||"number"==typeof t?this._obj[t]=e:(t.$_GID||(t.$_GID=Utils.getGID()),this._obj[t.$_GID]=e)},t.get=function(t){if(null==t)return null;if(n.supportWeakMap){var e="string"==typeof t||"number"==typeof t?n._keys[t]:t;return e?this._obj.get(e):null}return"string"==typeof t||"number"==typeof t?this._obj[t]:this._obj[t.$_GID]},t.del=function(t){if(null!=t)if(n.supportWeakMap){var e="string"==typeof t||"number"==typeof t?n._keys[t]:t;if(!e)return;this._obj.delete(e)}else"string"==typeof t||"number"==typeof t?delete this._obj[t]:delete this._obj[this._obj.$_GID]},t.has=function(t){if(null==t)return!1;if(n.supportWeakMap){var e="string"==typeof t||"number"==typeof t?n._keys[t]:t;return this._obj.has(e)}return"string"==typeof t||"number"==typeof t?null!=this._obj[t]:null!=this._obj[this._obj.$_GID]},n.__init__=function(){(n.supportWeakMap=null!=Browser.window.WeakMap)||Laya.timer.loop(n.delInterval,null,n.clearCache)},n.clearCache=function(){for(var t=0,e=n._maps.length;t<e;t++){n._maps[t]._obj={}}},n.supportWeakMap=!1,n.delInterval=3e5,n._keys={},n._maps=[],__static(n,["I",function(){return this.I=new n}]),n}(),WordText=function(){function t(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}__class(t,"laya.utils.WordText");var e=t.prototype;return e.setText=function(t){this.changed=!0,this._text=t},e.toString=function(){return this._text},e.charCodeAt=function(t){return this._text?this._text.charCodeAt(t):NaN},e.charAt=function(t){return this._text?this._text.charAt(t):null},__getset(0,e,"length",function(){return this._text?this._text.length:0}),t}(),Node=function(t){function s(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,s.__super.call(this),this._childs=s.ARRAY_EMPTY,this._$P=s.PROP_EMPTY,this.timer=Laya.scaleTimer,this.conchModel=Render.isConchNode?this.createConchModel():null}__class(s,"laya.display.Node",EventDispatcher);var e=s.prototype;return e._setBit=function(t,e){1==t&&(this._getBit(t)!=e&&this._updateDisplayedInstage());e?this._bits|=t:this._bits&=~t},e._getBit=function(t){return 0!=(this._bits&t)},e._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},e._setUpNoticeType=function(t){var e=this;for(e._setBit(t,!0),e=e.parent;e;){if(e._getBit(t))return;e._setBit(t,!0),e=e.parent}},e.on=function(t,e,i,n){return"display"!==t&&"undisplay"!==t||this._getBit(1)||this._setUpNoticeType(1),this._createListener(t,e,i,n,!1)},e.once=function(t,e,i,n){return"display"!==t&&"undisplay"!==t||this._getBit(1)||this._setUpNoticeType(1),this._createListener(t,e,i,n,!0)},e.createConchModel=function(){return null},e.destroy=function(t){void 0===t&&(t=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&(t?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},e.destroyChildren=function(){if(this._childs)for(var t=this._childs.length-1;-1<t;t--)this._childs[t].destroy(!0)},e.addChild=function(t){if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),t._parent===this){var e=this.getChildIndex(t);e!==this._childs.length-1&&(this._childs.splice(e,1),this._childs.push(t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,this._childs.length-1)),this._childChanged())}else t.parent&&t.parent.removeChild(t),this._childs===s.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,this._childs.length-1),(t.parent=this)._childChanged();return t},e.addChildren=function(t){for(var e=arguments,i=0,n=e.length;i<n;)this.addChild(e[i++])},e.addChildAt=function(t,e){if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),0<=e&&e<=this._childs.length){if(t._parent===this){var i=this.getChildIndex(t);this._childs.splice(i,1),this._childs.splice(e,0,t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,e)),this._childChanged()}else t.parent&&t.parent.removeChild(t),this._childs===s.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(e,0,t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,e),t.parent=this;return t}throw new Error("appendChildAt:The index is out of bounds")},e.getChildIndex=function(t){return this._childs.indexOf(t)},e.getChildByName=function(t){var e=this._childs;if(e)for(var i=0,n=e.length;i<n;i++){var r=e[i];if(r.name===t)return r}return null},e._get$P=function(t){return this._$P[t]},e._set$P=function(t,e){return this.destroyed||(this._$P===s.PROP_EMPTY&&(this._$P={}),this._$P[t]=e),e},e.getChildAt=function(t){return this._childs[t]},e.setChildIndex=function(t,e){var i=this._childs;if(e<0||e>=i.length)throw new Error("setChildIndex:The index is out of bounds.");var n=this.getChildIndex(t);if(n<0)throw new Error("setChildIndex:node is must child of this object.");return i.splice(n,1),i.splice(e,0,t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,e)),this._childChanged(),t},e._childChanged=function(t){},e.removeChild=function(t){if(!this._childs)return t;var e=this._childs.indexOf(t);return this.removeChildAt(e)},e.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},e.removeChildByName=function(t){var e=this.getChildByName(t);return e&&this.removeChild(e),e},e.removeChildAt=function(t){var e=this.getChildAt(t);return e&&(this._childs.splice(t,1),this.conchModel&&this.conchModel.removeChild(e.conchModel),e.parent=null),e},e.removeChildren=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=2147483647),this._childs&&0<this._childs.length){var i=this._childs;if(0===t&&a<=e){var n=i;this._childs=s.ARRAY_EMPTY}else n=i.splice(t,e-t);for(var r=0,a=n.length;r<a;r++)n[r].parent=null,this.conchModel&&this.conchModel.removeChild(n[r].conchModel)}return this},e.replaceChild=function(t,e){var i=this._childs.indexOf(e);return-1<i?(this._childs.splice(i,1,t),this.conchModel&&(this.conchModel.removeChild(e.conchModel),this.conchModel.addChildAt(t.conchModel,i)),e.parent=null,t.parent=this,t):null},e._updateDisplayedInstage=function(){var t;t=this;var e=Laya.stage;for(this._displayedInStage=!1;t;){if(t._getBit(1)){this._displayedInStage=t._displayedInStage;break}if(t==e||t._displayedInStage){this._displayedInStage=!0;break}t=t.parent}},e._setDisplay=function(t){this._displayedInStage!==t&&((this._displayedInStage=t)?this.event("display"):this.event("undisplay"))},e._displayChild=function(t,e){var i=t._childs;if(i)for(var n=0,r=i.length;n<r;n++){var a=i[n];a._getBit(1)&&(0<a._childs.length?this._displayChild(a,e):a._setDisplay(e))}t._setDisplay(e)},e.contains=function(t){if(t===this)return!0;for(;t;){if(t.parent===this)return!0;t=t.parent}return!1},e.timerLoop=function(t,e,i,n,r,a){void 0===r&&(r=!0),void 0===a&&(a=!1),this.timer.loop(t,e,i,n,r,a)},e.timerOnce=function(t,e,i,n,r){void 0===r&&(r=!0),this.timer._create(!1,!1,t,e,i,n,r)},e.frameLoop=function(t,e,i,n,r){void 0===r&&(r=!0),this.timer._create(!0,!0,t,e,i,n,r)},e.frameOnce=function(t,e,i,n,r){void 0===r&&(r=!0),this.timer._create(!0,!1,t,e,i,n,r)},e.clearTimer=function(t,e){this.timer.clear(t,e)},__getset(0,e,"numChildren",function(){return this._childs.length}),__getset(0,e,"destroyed",function(){return this._destroyed}),__getset(0,e,"parent",function(){return this._parent},function(t){this._parent!==t&&(t?(this._parent=t,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),t.displayedInStage&&this._displayChild(this,!0)),t._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=t))}),__getset(0,e,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),s.ARRAY_EMPTY=[],s.PROP_EMPTY={},s.NOTICE_DISPLAY=1,s.MOUSEENABLE=2,s}(),CSSStyle=function(t){function _(t){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,_.__super.call(this),this._padding=_._PADDING,this._spacing=_._SPACING,this._aligns=_._ALIGNS,this._font=Font.EMPTY,this._ower=t}__class(_,"laya.display.css.CSSStyle",t);var e=_.prototype;return e.destroy=function(){this._ower=null,this._font=null,this._rect=null},e.inherit=function(t){this._font=t._font,this._spacing=t._spacing===_._SPACING?_._SPACING:t._spacing.slice(),this.lineHeight=t.lineHeight},e._widthAuto=function(){return 0!=(262144&this._type)},e.widthed=function(t){return 0!=(8&this._type)},e._calculation=function(t,e){if(e.indexOf("%")<0)return!1;var n=this._ower,r=n.parent,a=this._rect;function s(t,e,i){return t*i[0]+e*i[1]+i[2]}function i(t){var e=r.width,i=n.width;a.width&&(n.width=s(e,i,a.width)),a.height&&(n.height=s(e,i,a.height)),a.left&&(n.x=s(e,i,a.left)),a.top&&(n.y=s(e,i,a.top))}null===a&&(r._getCSSStyle()._type|=524288,r.on("resize",this,i),this._rect=a={input:{}});var o=e.split(" ");return o[0]=parseFloat(o[0])/100,1==o.length?o[1]=o[2]=0:(o[1]=parseFloat(o[1])/100,o[2]=parseFloat(o[2])),a[t]=o,a.input[t]=e,i(),!0},e.heighted=function(t){return 0!=(8192&this._type)},e.size=function(t,e){var i=this._ower,n=!1;-1!==t&&t!=this._ower.width&&(this._type|=8,this._ower.width=t,n=!0),-1!==e&&e!=this._ower.height&&(this._type|=8192,this._ower.height=e,n=!0),n&&(i._layoutLater(),524288&this._type&&i.event("resize",this))},e._getAlign=function(){return this._aligns[0]},e._getValign=function(){return this._aligns[1]},e._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},e._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new Font(this._font))},e.render=function(t,e,i,n){var r=t.width,a=t.height;i-=t.pivotX,n-=t.pivotY,this._bgground&&null!=this._bgground.color&&e.ctx.fillRect(i,n,r,a,this._bgground.color),this._border&&this._border.color&&e.drawRect(i,n,r,a,this._border.color.strColor,this._border.size)},e.getCSSStyle=function(){return this},e.cssText=function(t){this.attrs(_.parseOneCSS(t,";"))},e.attrs=function(t){if(t)for(var e=0,i=t.length;e<i;e++){var n=t[e];this[n[0]]=n[1]}},e.setTransform=function(t){"none"===t?this._tf=Style._TF_EMPTY:this.attrs(_.parseOneCSS(t,","))},e.translate=function(t,e){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.translateX=t,this._tf.translateY=e},e.scale=function(t,e){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.scaleX=t,this._tf.scaleY=e},e._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},__getset(0,e,"block",t.prototype._$get_block,function(t){t?this._type|=1:this._type&=-2}),__getset(0,e,"valign",function(){return _._valigndef[this._aligns[1]]},function(t){this._aligns===_._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=_._valigndef[t]}),__getset(0,e,"height",null,function(t){if(this._type|=8192,"string"==typeof t){if(this._calculation("height",t))return;t=parseInt(t)}this.size(-1,t)}),__getset(0,e,"width",null,function(t){if(this._type|=8,"string"==typeof t){var e=t.indexOf("auto");if(0<=e&&(this._type|=262144,t=t.substr(0,e)),this._calculation("width",t))return;t=parseInt(t)}this.size(t,-1)}),__getset(0,e,"fontWeight",function(){return this._font.weight},function(t){this._createFont().weight=t}),__getset(0,e,"left",null,function(t){var e=this._ower;if("string"==typeof t){if("center"===t?t="50% -50% 0":"right"===t&&(t="100% -100% 0"),this._calculation("left",t))return;t=parseInt(t)}e.x=t}),__getset(0,e,"_translate",null,function(t){this.translate(t[0],t[1])}),__getset(0,e,"absolute",function(){return 0!=(4&this._type)}),__getset(0,e,"top",null,function(t){var e=this._ower;if("string"==typeof t){if("middle"===t?t="50% -50% 0":"bottom"===t&&(t="100% -100% 0"),this._calculation("top",t))return;t=parseInt(t)}e.y=t}),__getset(0,e,"align",function(){return _._aligndef[this._aligns[0]]},function(t){this._aligns===_._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=_._aligndef[t]}),__getset(0,e,"bold",function(){return this._font.bold},function(t){this._createFont().bold=t}),__getset(0,e,"padding",function(){return this._padding},function(t){this._padding=t}),__getset(0,e,"leading",function(){return this._spacing[1]},function(t){"string"==typeof t&&(t=parseInt(t+"")),this._spacing===_._SPACING&&(this._spacing=[0,0]),this._spacing[1]=t}),__getset(0,e,"lineElement",function(){return 0!=(65536&this._type)},function(t){t?this._type|=65536:this._type&=-65537}),__getset(0,e,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function(t){this.lineElement=!1,"right"===t?this._type|=32768:this._type&=-32769}),__getset(0,e,"textDecoration",function(){return this._font.decoration},function(t){this._createFont().decoration=t}),__getset(0,e,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function(t){"nowrap"===t&&(this._type|=131072),"none"===t&&(this._type&=-131073)}),__getset(0,e,"background",null,function(t){t?(this._bgground||(this._bgground={}),this._bgground.color=t,this._ower.conchModel&&this._ower.conchModel.bgColor(t),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),__getset(0,e,"wordWrap",function(){return 0==(131072&this._type)},function(t){t?this._type&=-131073:this._type|=131072}),__getset(0,e,"color",function(){return this._font.color},function(t){this._createFont().color=t}),__getset(0,e,"password",function(){return this._font.password},function(t){this._createFont().password=t}),__getset(0,e,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function(t){"none"===t?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=t),this._ower.conchModel&&this._ower.conchModel.bgColor(t),this._ower._renderType|=256}),__getset(0,e,"font",function(){return this._font.toString()},function(t){this._createFont().set(t)}),__getset(0,e,"weight",null,function(t){this._createFont().weight=t}),__getset(0,e,"letterSpacing",function(){return this._spacing[0]},function(t){"string"==typeof t&&(t=parseInt(t+"")),this._spacing===_._SPACING&&(this._spacing=[0,0]),this._spacing[0]=t}),__getset(0,e,"fontSize",function(){return this._font.size},function(t){this._createFont().size=t}),__getset(0,e,"italic",function(){return this._font.italic},function(t){this._createFont().italic=t}),__getset(0,e,"fontFamily",function(){return this._font.family},function(t){this._createFont().family=t}),__getset(0,e,"stroke",function(){return this._font.stroke[0]},function(t){this._createFont().stroke===Font._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=t}),__getset(0,e,"strokeColor",function(){return this._font.stroke[1]},function(t){this._createFont().stroke===Font._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=t}),__getset(0,e,"border",function(){return this._border?this._border.value:""},function(t){if("none"!=t){this._border||(this._border={});var e=(this._border.value=t).split(" ");if(this._border.color=Color.create(e[e.length-1]),1==e.length)return this._border.size=1,void(this._border.type="solid");var i=0;0<e[0].indexOf("px")?(this._border.size=parseInt(e[0]),i++):this._border.size=1,this._border.type=e[i],this._ower._renderType|=256}else this._border=null}),__getset(0,e,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function(t){t?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==t?null:Color.create(t),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),__getset(0,e,"position",function(){return 4&this._type?"absolute":""},function(t){"absolute"==t?this._type|=4:this._type&=-5}),__getset(0,e,"display",null,function(t){switch(t){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),__getset(0,e,"paddingLeft",function(){return this.padding[3]}),__getset(0,e,"paddingTop",function(){return this.padding[0]}),__getset(0,e,"_scale",null,function(t){this._ower.scale(t[0],t[1])}),__getset(0,e,"_rotate",null,function(t){this._ower.rotation=t}),_.parseOneCSS=function(t,e){for(var i,n=[],r=t.split(e),a=0,s=r.length;a<s;a++){var o=r[a],l=o.indexOf(":"),h=o.substr(0,l).replace(/^\s+|\s+$/g,"");if(0!=h.length){var u=o.substr(l+1).replace(/^\s+|\s+$/g,""),c=[h,u];switch(h){case"italic":case"bold":c[1]="true"==u;break;case"line-height":c[0]="lineHeight",c[1]=parseInt(u);break;case"font-size":c[0]="fontSize",c[1]=parseInt(u);break;case"padding":1<(i=u.split(" ")).length||(i[1]=i[2]=i[3]=i[0]),c[1]=[parseInt(i[0]),parseInt(i[1]),parseInt(i[2]),parseInt(i[3])];break;case"rotate":c[0]="_rotate",c[1]=parseFloat(u);break;case"scale":i=u.split(" "),c[0]="_scale",c[1]=[parseFloat(i[0]),parseFloat(i[1])];break;case"translate":i=u.split(" "),c[0]="_translate",c[1]=[parseInt(i[0]),parseInt(i[1])];break;default:(c[0]=_._CSSTOVALUE[h])||(c[0]=h)}n.push(c)}}return n},_.parseCSS=function(t,e){for(var i;null!=(i=_._parseCSSRegExp.exec(t));)_.styleSheets[i[1]]=_.parseOneCSS(i[2],";")},_.EMPTY=new _(null),_._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},_._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),_._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},_._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},_.styleSheets={},_.ALIGN_CENTER=1,_.ALIGN_RIGHT=2,_.VALIGN_MIDDLE=1,_.VALIGN_BOTTOM=2,_._CSS_BLOCK=1,_._DISPLAY_NONE=2,_._ABSOLUTE=4,_._WIDTH_SET=8,_._PADDING=[0,0,0,0],_._RECT=[-1,-1,-1,-1],_._SPACING=[0,0],_._ALIGNS=[0,0,0],_.ADDLAYOUTED=512,_._NEWFONT=4096,_._HEIGHT_SET=8192,_._BACKGROUND_SET=16384,_._FLOAT_RIGHT=32768,_._LINE_ELEMENT=65536,_._NOWARP=131072,_._WIDTHAUTO=262144,_._LISTERRESZIE=524288,_}(Style),AudioSound=function(t){function s(){this.url=null,this.audio=null,this.loaded=!1,s.__super.call(this)}__class(s,"laya.media.h5audio.AudioSound",EventDispatcher);var e=s.prototype;return e.dispose=function(){var t=s._audioCache[this.url];t&&(t.src="",delete s._audioCache[this.url])},e.load=function(t){var e;if(t=URL.formatURL(t),(this.url=t)==SoundManager._tMusic?(s._initMusicAudio(),(e=s._musicAudio).src!=t&&(s._audioCache[e.src]=null,e=null)):e=s._audioCache[t],e&&2<=e.readyState)this.event("complete");else{e||(e=t==SoundManager._tMusic?(s._initMusicAudio(),s._musicAudio):Browser.createElement("audio"),(s._audioCache[t]=e).src=t),e.addEventListener("canplaythrough",n),e.addEventListener("error",r);var i=this;(this.audio=e).load?e.load():r()}function n(){a(),i.loaded=!0,i.event("complete")}function r(){e.load=null,a(),i.event("error")}function a(){e.removeEventListener("canplaythrough",n),e.removeEventListener("error",r)}},e.play=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=0),!this.url)return null;var i,n;if(!(i=this.url==SoundManager._tMusic?s._musicAudio:s._audioCache[this.url]))return null;n=Pool.getItem("audio:"+this.url),Render.isConchApp?n||((n=Browser.createElement("audio")).src=this.url):this.url==SoundManager._tMusic?(s._initMusicAudio(),(n=s._musicAudio).src=this.url):n=n||i.cloneNode(!0);var r=new AudioSoundChannel(n);return r.url=this.url,r.loops=e,r.startTime=t,r.play(),SoundManager.addChannel(r),r},__getset(0,e,"duration",function(){var t;return(t=s._audioCache[this.url])?t.duration:0}),s._initMusicAudio=function(){s._musicAudio||(s._musicAudio||(s._musicAudio=Browser.createElement("audio")),Render.isConchApp||Browser.document.addEventListener("mousedown",s._makeMusicOK))},s._makeMusicOK=function(){Browser.document.removeEventListener("mousedown",s._makeMusicOK),s._musicAudio.src?s._musicAudio.play():(s._musicAudio.src="",s._musicAudio.load())},s._audioCache={},s._musicAudio=null,s}(),SoundChannel=function(t){function e(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.completeHandler=null,e.__super.call(this)}__class(e,"laya.media.SoundChannel",EventDispatcher);var i=e.prototype;return i.play=function(){},i.stop=function(){},i.pause=function(){},i.resume=function(){},i.__runComplete=function(t){t&&t.run()},__getset(0,i,"volume",function(){return 1},function(t){}),__getset(0,i,"position",function(){return 0}),__getset(0,i,"duration",function(){return 0}),e}(),Sound=function(t){function e(){e.__super.call(this)}__class(e,"laya.media.Sound",EventDispatcher);var i=e.prototype;return i.load=function(t){},i.play=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),null},i.dispose=function(){},__getset(0,i,"duration",function(){return 0}),e}(),WebAudioSound=function(t){function n(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,n.__super.call(this)}__class(n,"laya.media.webaudio.WebAudioSound",EventDispatcher);var e=n.prototype;return e.load=function(t){var e=this;if(t=URL.formatURL(t),this.url=t,this.audioBuffer=n._dataCache[t],this.audioBuffer)this._loaded(this.audioBuffer);else if(n.e.on("loaded:"+t,this,this._loaded),n.e.on("err:"+t,this,this._err),!n.__loadingSound[t]){n.__loadingSound[t]=!0;var i=new Browser.window.XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){e._disposed?e._removeLoadEvents():(e.data=i.response,n.buffs.push({buffer:e.data,url:e.url}),n.decode())},i.onerror=function(t){e._err()},i.send()}},e._err=function(){this._removeLoadEvents(),n.__loadingSound[this.url]=!1,this.event("error")},e._loaded=function(t){this._removeLoadEvents(),this._disposed||(this.audioBuffer=t,n._dataCache[this.url]=this.audioBuffer,this.loaded=!0,this.event("complete"))},e._removeLoadEvents=function(){n.e.off("loaded:"+this.url,this,this._loaded),n.e.off("err:"+this.url,this,this._err)},e.__playAfterLoaded=function(){if(this.__toPlays){var t,e,i,n=0;for(t=(e=this.__toPlays).length,n=0;n<t;n++)(i=e[n])[2]&&!i[2].isStopped&&this.play(i[0],i[1],i[2]);this.__toPlays.length=0}},e.play=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),i=i||new WebAudioSoundChannel,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([t,e,i]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),i.url=this.url,i.loops=e,i.audioBuffer=this.audioBuffer,i.startTime=t,i.play(),SoundManager.addChannel(i),i},e.dispose=function(){this._disposed=!0,delete n._dataCache[this.url],delete n.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},__getset(0,e,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),n.decode=function(){n.buffs.length<=0||n.isDecoding||(n.isDecoding=!0,n.tInfo=n.buffs.shift(),n.ctx.decodeAudioData(n.tInfo.buffer,n._done,n._fail))},n._done=function(t){n.e.event("loaded:"+n.tInfo.url,t),n.isDecoding=!1,n.decode()},n._fail=function(){n.e.event("err:"+n.tInfo.url,null),n.isDecoding=!1,n.decode()},n._playEmptySound=function(){if(null!=n.ctx){var t=n.ctx.createBufferSource();t.buffer=n._miniBuffer,t.connect(n.ctx.destination),t.start(0,0,0)}},n._unlock=function(){n._unlocked||(n._playEmptySound(),"running"==n.ctx.state&&(Browser.document.removeEventListener("mousedown",n._unlock,!0),Browser.document.removeEventListener("touchend",n._unlock,!0),n._unlocked=!0))},n.initWebAudio=function(){"running"!=n.ctx.state&&(n._unlock(),Browser.document.addEventListener("mousedown",n._unlock,!0),Browser.document.addEventListener("touchend",n._unlock,!0))},n._dataCache={},n.buffs=[],n.isDecoding=!1,n._unlocked=!1,n.tInfo=null,n.__loadingSound={},__static(n,["window",function(){return this.window=Browser.window},"webAudioEnabled",function(){return this.webAudioEnabled=n.window.AudioContext||n.window.webkitAudioContext||n.window.mozAudioContext},"ctx",function(){return this.ctx=n.webAudioEnabled?new(n.window.AudioContext||n.window.webkitAudioContext||n.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=n.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new EventDispatcher}]),n}(),HttpRequest=function(t){function e(){this._responseType=null,this._data=null,e.__super.call(this),this._http=new Browser.window.XMLHttpRequest}__class(e,"laya.net.HttpRequest",EventDispatcher);var i=e.prototype;return i.send=function(t,e,i,n,r){void 0===i&&(i="get"),void 0===n&&(n="text"),this._responseType=n,this._data=null;var a=this,s=this._http;if(s.open(i,t,!0),r)for(var o=0;o<r.length;o++)s.setRequestHeader(r[o++],r[o]);else Render.isConchApp||(e&&"string"!=typeof e?s.setRequestHeader("Content-Type","application/json"):s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));s.responseType="arraybuffer"!==n?"text":"arraybuffer",s.onerror=function(t){a._onError(t)},s.onabort=function(t){a._onAbort(t)},s.onprogress=function(t){a._onProgress(t)},s.onload=function(t){a._onLoad(t)},s.send(e)},i._onProgress=function(t){t&&t.lengthComputable&&this.event("progress",t.loaded/t.total)},i._onAbort=function(t){this.error("Request was aborted by user")},i._onError=function(t){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},i._onLoad=function(t){var e=this._http,i=void 0!==e.status?e.status:200;200===i||204===i||0===i?this.complete():this.error("["+e.status+"]"+e.statusText+":"+e.responseURL)},i.error=function(t){this.clear(),this.event("error",t)},i.complete=function(){this.clear();var e=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=Utils.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(t){e=!1,this.error(t.message)}e&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},i.clear=function(){var t=this._http;t.onerror=t.onabort=t.onprogress=t.onload=null},__getset(0,i,"url",function(){return this._http.responseURL}),__getset(0,i,"http",function(){return this._http}),__getset(0,i,"data",function(){return this._data}),e}(),Loader=function(t){function M(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,M.__super.call(this)}__class(M,"laya.net.Loader",EventDispatcher);var e=M.prototype;return e.load=function(t,e,i,n,r){if(void 0===i&&(i=!0),void 0===r&&(r=!1),0===(this._url=t).indexOf("data:image")?this._type=e="image":(this._type=e||(e=this.getTypeFromUrl(t)),t=URL.formatURL(t)),this._cache=i,this._data=null,!r&&M.loadedMap[t])return this._data=M.loadedMap[t],this.event("progress",1),void this.event("complete",this._data);if(n&&M.setGroup(t,n),null!=M.parserMap[e])return this._customParse=!0,void(M.parserMap[e]instanceof laya.utils.Handler?M.parserMap[e].runWith(this):M.parserMap[e].call(null,this));if("image"===e||"htmlimage"===e||"nativeimage"===e)return this._loadImage(t);if("sound"===e)return this._loadSound(t);if("ttf"===e)return this._loadTTF(t);if("atlas"==e&&M.preLoadedAtlasConfigMap[t])return this.onLoaded(M.preLoadedAtlasConfigMap[t]),void delete M.preLoadedAtlasConfigMap[t];var a;switch(this._http||(this._http=new HttpRequest,this._http.on("progress",this,this.onProgress),this._http.on("error",this,this.onError),this._http.on("complete",this,this.onLoaded)),e){case"atlas":a="json";break;case"font":a="xml";break;case"pkm":a="arraybuffer";break;default:a=e}this._http.send(t,null,"get",a)},e.getTypeFromUrl=function(t){var e=Utils.getFileExtension(t);return e?M.typeMap[e]:(console.warn("Not recognize the resources suffix",t),"text")},e._loadTTF=function(t){t=URL.formatURL(t);var e=new TTFLoader;e.complete=Handler.create(this,this.onLoaded),e.load(t)},e._loadImage=function(e){e=URL.formatURL(e);var i,t=this;function n(){i.onload=null,i.onerror=null,delete M.imgCache[e]}var r=function(){n(),t.onLoaded(i)},a=function(){n(),t.event("error","Load image failed")};"nativeimage"===this._type?((i=new Browser.window.Image).crossOrigin="",i.onload=r,i.onerror=a,i.src=e,M.imgCache[e]=i):new HTMLImage.create(e,{onload:r,onerror:a,onCreate:function(t){i=t,M.imgCache[e]=t}})},e._loadSound=function(t){var e=new SoundManager._soundClass,i=this;function n(){e.offAll()}e.on("complete",this,function(){n(),i.onLoaded(e)}),e.on("error",this,function(){n(),e.dispose(),i.event("error","Load sound failed")}),e.load(t)},e.onProgress=function(t){"atlas"===this._type?this.event("progress",.3*t):this.event("progress",t)},e.onError=function(t){this.event("error",t)},e.onLoaded=function(t){var e=this._type;if("image"===e){var i=new Texture(t);i.url=this._url,this.complete(i)}else if("sound"===e||"htmlimage"===e||"nativeimage"===e)this.complete(t);else if("atlas"===e){if(!t.src&&!t._setContext){if(!this._data){if((this._data=t).meta&&t.meta.image)for(var n=t.meta.image.split(","),r=0<=this._url.indexOf("/")?"/":"\\",a=this._url.lastIndexOf(r),s=0<=a?this._url.substr(0,a+1):"",o=0,l=n.length;o<l;o++)n[o]=s+n[o];else n=[this._url.replace(".json",".png")];n.reverse(),t.toLoads=n,t.pics=[]}return this.event("progress",.3+1/n.length*.6),this._loadImage(n.pop())}if(this._data.pics.push(t),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var h=this._data.frames,u=this._url.split("?")[0],c=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:u.substring(0,u.lastIndexOf("."))+"/",_=this._data.pics,d=URL.formatURL(this._url),f=M.atlasMap[d]||(M.atlasMap[d]=[]);f.dir=c;var p=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var m in p=parseFloat(this._data.meta.scale),h){var g=h[m],v=_[g.frame.idx?g.frame.idx:0],y=URL.formatURL(c+m);v.scaleRate=p,M.cacheRes(y,Texture.create(v,g.frame.x,g.frame.y,g.frame.w,g.frame.h,g.spriteSourceSize.x,g.spriteSourceSize.y,g.sourceSize.w,g.sourceSize.h)),M.loadedMap[y].url=y,f.push(y)}else for(m in h)v=_[(g=h[m]).frame.idx?g.frame.idx:0],y=URL.formatURL(c+m),M.cacheRes(y,Texture.create(v,g.frame.x,g.frame.y,g.frame.w,g.frame.h,g.spriteSourceSize.x,g.spriteSourceSize.y,g.sourceSize.w,g.sourceSize.h)),M.loadedMap[y].url=y,f.push(y);delete this._data.pics,this.complete(this._data)}else if("font"==e){if(!t.src)return this._data=t,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var x=new BitmapFont;x.parseFont(this._data,t);var E=this._url.split(".fnt")[0].split("/"),T=E[E.length-1];Text.registerBitmapFont(T,x),this._data=x,this.complete(this._data)}else if("pkm"==e){var S=HTMLImage.create(t,this._url),w=new Texture(S);w.url=this._url,this.complete(w)}else this.complete(t)},e.complete=function(t){this._data=t,this._customParse?this.event("loaded",t instanceof Array?[t]:t):(M._loaders.push(this),M._isWorking||M.checkNext())},e.endLoad=function(t){t&&(this._data=t),this._cache&&M.cacheRes(this._url,this._data),this._customParse=!1,this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},__getset(0,e,"url",function(){return this._url}),__getset(0,e,"data",function(){return this._data}),__getset(0,e,"cache",function(){return this._cache}),__getset(0,e,"type",function(){return this._type}),M.checkNext=function(){M._isWorking=!0;for(var t=Browser.now();M._startIndex<M._loaders.length;)if(Browser.now(),M._loaders[M._startIndex].endLoad(),M._startIndex++,Browser.now()-t>M.maxTimeOut)return console.warn("loader callback cost a long time:"+(Browser.now()-t)+" url="+M._loaders[M._startIndex-1].url),void Laya.timer.frameOnce(1,null,M.checkNext);M._loaders.length=0,M._startIndex=0,M._isWorking=!1},M.clearRes=function(t,e){void 0===e&&(e=!1),t=URL.formatURL(t);var i=M.getAtlas(t);if(i){for(var n=0,r=i.length;n<r;n++){var a=i[n],s=M.getRes(a);delete M.loadedMap[a],s&&s.destroy(e)}i.length=0,delete M.atlasMap[t],delete M.loadedMap[t]}else{var o=M.loadedMap[t];o&&(delete M.loadedMap[t],o instanceof laya.resource.Texture&&o.bitmap&&o.destroy(e))}},M.clearTextureRes=function(t){t=URL.formatURL(t);var e=laya.net.Loader.getAtlas(t),i=e&&0<e.length?laya.net.Loader.getRes(e[0]):laya.net.Loader.getRes(t);i&&i.bitmap&&(Render.isConchApp?i.bitmap.source.releaseTexture&&i.bitmap.source.releaseTexture():null==i.bitmap._atlaser&&i.bitmap.releaseResource(!0))},M.setAtlasConfigs=function(t,e){M.preLoadedAtlasConfigMap[URL.formatURL(t)]=e},M.getRes=function(t){return M.loadedMap[URL.formatURL(t)]},M.getAtlas=function(t){return M.atlasMap[URL.formatURL(t)]},M.cacheRes=function(t,e){t=URL.formatURL(t),null!=M.loadedMap[t]?console.warn("Resources already exist,is repeated loading:",t):M.loadedMap[t]=e},M.setGroup=function(t,e){M.groupMap[e]||(M.groupMap[e]=[]),M.groupMap[e].push(t)},M.clearResByGroup=function(t){if(M.groupMap[t]){var e=M.groupMap[t],i=0,n=e.length;for(i=0;i<n;i++)M.clearRes(e[i]);e.length=0}},M.TEXT="text",M.JSON="json",M.XML="xml",M.BUFFER="arraybuffer",M.IMAGE="image",M.SOUND="sound",M.ATLAS="atlas",M.FONT="font",M.TTF="ttf",M.PKM="pkm",M.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf"},M.parserMap={},M.groupMap={},M.maxTimeOut=100,M.loadedMap={},M.preLoadedAtlasConfigMap={},M.atlasMap={},M._loaders=[],M._isWorking=!1,M._startIndex=0,M.imgCache={},M}(),LoaderManager=function(t){var _;function d(){this.retryNum=1,this.retryDelay=0,this.maxLoader=5,this._loaders=[],this._loaderCount=0,this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},d.__super.call(this);for(var t=0;t<this._maxPriority;t++)this._resInfos[t]=[]}__class(d,"laya.net.LoaderManager",EventDispatcher);var e=d.prototype;return e.create=function(t,i,e,n,r,a,s,o){if(void 0===a&&(a=1),void 0===s&&(s=!0),t instanceof Array){var l=t,h=l.length,u=0;if(e)var c=Handler.create(e.caller,e.method,e.args,!1);for(var _=0;_<h;_++){var d=l[_];"string"==typeof d&&(d=l[_]={url:d}),d.progress=0;var f=e?Handler.create(null,g,[d],!1):null,p=e||i?Handler.create(null,m,[d]):null;this._create(d.url,p,f,d.clas||n,d.params||r,d.priority||a,s,d.group||o)}function m(t,e){u++,t.progress=1,u===h&&i&&i.run()}function g(t,e){t.progress=e;for(var i=0,n=0;n<h;n++){i+=l[n].progress}var r=i/h;c.runWith(r)}return!0}return this._create(t,i,e,n,r,a,s,o)},e._create=function(e,i,t,n,r,a,s,o){void 0===a&&(a=1),void 0===s&&(s=!0);var l=URL.formatURL(e),h=this.getRes(l);if(h)!h.hasOwnProperty("loaded")||h.loaded?(t&&t.runWith(1),i&&i.run()):i&&Laya.loader._createListener(e,i.caller,i.method,i.args,!0,!1);else{var u=Utils.getFileExtension(e),c=d.createMap[u];if(!c)throw new Error("LoaderManager:unknown file("+e+") extension with: "+u+".");n||(n=c[0]);var _=c[1];if("atlas"==u)this.load(e,i,t,_,a,s);else{n===Texture&&(_="htmlimage"),(h=n?new n:null).hasOwnProperty("_loaded")&&(h._loaded=!1),h._setUrl(e),o&&h._setGroup(o),this._createLoad(h,e,Handler.create(null,function(t){h&&!h.destroyed&&t&&h.onAsynLoaded.call(h,e,t,r),i&&i.run();Laya.loader.event(e)}),t,_,a,!1,o,!0),s&&this.cacheRes(l,h)}}return h},e.load=function(t,e,i,n,r,a,s,o){var l=this;if(void 0===r&&(r=1),void 0===a&&(a=!0),void 0===o&&(o=!1),t instanceof Array)return this._loadAssets(t,e,i,n,r,a,s);var h=Loader.getRes(t);if(null!=h)Laya.timer.frameOnce(1,null,function(){i&&i.runWith(1),e&&e.runWith(h),l._loaderCount||l.event("complete")});else{var u=d._resMap[t];u?(e&&u._createListener("complete",e.caller,e.method,e.args,!1,!1),i&&u._createListener("progress",i.caller,i.method,i.args,!1,!1)):((u=this._infoPool.length?this._infoPool.pop():new _).url=t,u.type=n,u.cache=a,u.group=s,u.ignoreCache=o,e&&u.on("complete",e.caller,e.method,e.args),i&&u.on("progress",i.caller,i.method,i.args),d._resMap[t]=u,r=r<this._maxPriority?r:this._maxPriority-1,this._resInfos[r].push(u),this._next())}return this},e._createLoad=function(t,e,i,n,r,a,s,o,l){var h=this;if(void 0===a&&(a=1),void 0===s&&(s=!0),void 0===l&&(l=!1),e instanceof Array)return this._loadAssets(e,i,n,r,a,s,o);var u=Loader.getRes(e);if(null!=u)Laya.timer.frameOnce(1,null,function(){n&&n.runWith(1),i&&i.runWith(u),h._loaderCount||h.event("complete")});else{var c=d._resMap[e];c?(i&&c._createListener("complete",i.caller,i.method,i.args,!1,!1),n&&c._createListener("progress",n.caller,n.method,n.args,!1,!1)):((c=this._infoPool.length?this._infoPool.pop():new _).url=e,c.clas=t,c.type=r,c.cache=s,c.group=o,c.ignoreCache=l,i&&c.on("complete",i.caller,i.method,i.args),n&&c.on("progress",n.caller,n.method,n.args),d._resMap[e]=c,a=a<this._maxPriority?a:this._maxPriority-1,this._resInfos[a].push(c),this._next())}return this},e._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var t=0;t<this._maxPriority;t++)for(var e=this._resInfos[t];0<e.length;){var i=e.shift();if(i)return this._doLoad(i)}this._loaderCount||this.event("complete")}},e._doLoad=function(e){this._loaderCount++;var i=this._loaders.length?this._loaders.pop():new Loader;i.on("complete",null,r),i.on("progress",null,function(t){e.event("progress",t)}),i.on("error",null,function(t){r(null)});var n=this;function r(t){i.offAll(),i._data=null,n._loaders.push(i),n._endLoad(e,t instanceof Array?[t]:t),n._loaderCount--,n._next()}i._class=e.clas,i.load(e.url,e.type,e.cache,e.group,e.ignoreCache)},e._endLoad=function(t,e){var i=t.url;if(null==e){var n=this._failRes[i]||0;if(n<this.retryNum)return console.warn("[warn]Retry to load:",i),this._failRes[i]=n+1,void Laya.timer.once(this.retryDelay,this,this._addReTry,[t],!1);console.warn("[error]Failed to load:",i),this.event("error",i)}this._failRes[i]&&(this._failRes[i]=0),delete d._resMap[i],t.event("complete",e),t.offAll(),this._infoPool.push(t)},e._addReTry=function(t){this._resInfos[this._maxPriority-1].push(t),this._next()},e.clearRes=function(t,e){void 0===e&&(e=!1),Loader.clearRes(t,e)},e.getRes=function(t){return Loader.getRes(t)},e.cacheRes=function(t,e){Loader.cacheRes(t,e)},e.clearTextureRes=function(t){Loader.clearTextureRes(t)},e.setGroup=function(t,e){Loader.setGroup(t,e)},e.clearResByGroup=function(t){Loader.clearResByGroup(t)},e.clearUnLoaded=function(){for(var t=0;t<this._maxPriority;t++){for(var e=this._resInfos[t],i=e.length-1;-1<i;i--){var n=e[i];n&&(n.offAll(),this._infoPool.push(n))}e.length=0}this._loaderCount=0,d._resMap={}},e.cancelLoadByUrls=function(t){if(t)for(var e=0,i=t.length;e<i;e++)this.cancelLoadByUrl(t[e])},e.cancelLoadByUrl=function(t){for(var e=0;e<this._maxPriority;e++)for(var i=this._resInfos[e],n=i.length-1;-1<n;n--){var r=i[n];r&&r.url===t&&(i[n]=null,r.offAll(),this._infoPool.push(r))}d._resMap[t]&&delete d._resMap[t]},e._loadAssets=function(t,i,s,e,n,r,a){void 0===n&&(n=1),void 0===r&&(r=!0);for(var o=t.length,l=0,h=0,u=[],c=!0,_=0;_<o;_++){var d=t[_];"string"==typeof d&&(d={url:d,type:e,size:1,priority:n}),d.size||(d.size=1),d.progress=0,h+=d.size,u.push(d);var f=s?Handler.create(null,g,[d],!1):null,p=i||s?Handler.create(null,m,[d]):null;this.load(d.url,p,f,d.type,d.priority||1,r,d.group||a)}function m(t,e){l++,t.progress=1,e||(c=!1),l===o&&i&&i.runWith(c)}function g(t,e){if(null!=s){t.progress=e;for(var i=0,n=0;n<u.length;n++){var r=u[n];i+=r.size*r.progress}var a=i/h;s.runWith(a)}}return this},d.cacheRes=function(t,e){Loader.cacheRes(t,e)},d._resMap={},__static(d,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),d.__init$=function(){_=function(t){function e(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,e.__super.call(this)}return __class(e,"",EventDispatcher),e}()},d}(),ColorFilter=function(t){function r(t){r.__super.call(this),t||(t=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var e=0,i=0,n=0;n<20;n++)n%5!=4?this._mat[e++]=t[n]:this._alpha[i++]=t[n];this._action=RunDriver.createFilterAction(32),this._action.data=this}__class(r,"laya.filters.ColorFilter",Filter);var e=r.prototype;return Laya.imps(e,{"laya.filters.IFilter":!0}),e.callNative=function(t){t._$P.cf=this;t.conchModel&&t.conchModel.setFilterMatrix&&t.conchModel.setFilterMatrix(this._mat,this._alpha)},__getset(0,e,"type",function(){return 32}),__getset(0,e,"action",function(){return this._action}),r}(),Socket=function(t){function n(t,e,i){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===e&&(e=0),n.__super.call(this),this._byteClass=i||Byte,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,t&&0<e&&e<65535&&this.connect(t,e)}__class(n,"laya.net.Socket",EventDispatcher);var e=n.prototype;return e.connect=function(t,e){var i="ws://"+t+":"+e;i="https:"==Browser.window.location.protocol?"wss://"+t+":"+e:"ws://"+t+":"+e,this.connectByUrl(i)},e.connectByUrl=function(t){var e=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new Browser.window.WebSocket(t,this.protocols):this._socket=new Browser.window.WebSocket(t),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function(t){e._onOpen(t)},this._socket.onmessage=function(t){e._onMessage(t)},this._socket.onclose=function(t){e._onClose(t)},this._socket.onerror=function(t){e._onError(t)}},e.cleanSocket=function(){try{this._socket.close()}catch(t){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},e.close=function(){if(null!=this._socket)try{this._socket.close()}catch(t){}},e._onOpen=function(t){this._connected=!0,this.event("open",t)},e._onMessage=function(t){if(t&&t.data){var e=t.data;if(this.disableInput&&e)this.event("message",e);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var i=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,e&&("string"==typeof e?this._input.writeUTFBytes(e):this._input.writeArrayBuffer(e),this._addInputPosition=this._input.pos,this._input.pos=i),this.event("message",e)}}},e._onClose=function(t){this._connected=!1,this.event("close",t)},e._onError=function(t){this.event("error",t)},e.send=function(t){this._socket.send(t)},e.flush=function(){if(this._output&&0<this._output.length){var e;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch(t){e=t}this._output.endian=this.endian,this._output.clear(),e&&this.event("error",e)}},__getset(0,e,"input",function(){return this._input}),__getset(0,e,"output",function(){return this._output}),__getset(0,e,"connected",function(){return this._connected}),__getset(0,e,"endian",function(){return this._endian},function(t){this._endian=t,null!=this._input&&(this._input.endian=t),null!=this._output&&(this._output.endian=t)}),n.LITTLE_ENDIAN="littleEndian",n.BIG_ENDIAN="bigEndian",n}(),WorkerLoader=function(t){function r(){this.worker=null,r.__super.call(this);var e=this;this.worker=new Browser.window.Worker(r.workerPath),this.worker.onmessage=function(t){e.workerMessage(t.data)}}__class(r,"laya.net.WorkerLoader",EventDispatcher);var e=r.prototype;return e.workerMessage=function(t){if(t)switch(t.type){case"Image":this.imageLoaded(t);break;case"Msg":this.event("image_msg",t.msg)}},e.imageLoaded=function(t){if(t&&t.buffer&&t.buffer.length<10)return r._enable=!1,this._myTrace("buffer lost when postmessage ,disable workerloader"),this.event(t.url,null),void this.event("image_err",t.url+"\n"+t.msg);if(!t.dataType)return this.event(t.url,null),void this.event("image_err",t.url+"\n"+t.msg);var e,i,n;switch(t.dataType){case"buffer":(n=(i=(e=new HTMLCanvas("2D")).source.getContext("2d")).createImageData(t.width,t.height)).data.set(t.buffer),e.size(n.width,n.height),i.putImageData(n,0,0),e.memorySize=0;break;case"imagedata":i=(e=new HTMLCanvas("2D")).source.getContext("2d"),n=t.imagedata,e.size(n.width,n.height),i.putImageData(n,0,0),n=t.imagedata,e.memorySize=0;break;case"imageBitmap":n=t.imageBitmap,Render.isWebGL?e=n:(i=(e=new HTMLCanvas("2D")).source.getContext("2d"),e.size(n.width,n.height),i.drawImage(n,0,0),e.src=t.url)}Render.isWebGL&&(e=new laya.webgl.resource.WebGLImage(e,t.url)),this.event(t.url,e)},e._myTrace=function(t){var e=arguments,i=[],n=0,r=e.length;for(n=0;n<r;n++)i.push(e[n]);this.event("image_msg",i.join(" "))},e.loadImage=function(t){var e;(e={type:"load"}).url=t,this.worker.postMessage(e)},e._loadImage=function(e){var i=this;if(!r._enable||e.toLowerCase().indexOf(".png")<0)r._preLoadFun.call(i,e);else{e=URL.formatURL(e);var n=function(t){laya.net.WorkerLoader.I.off(e,i,n),t?i.onLoaded(t):r._preLoadFun.call(i,e)};laya.net.WorkerLoader.I.on(e,i,n),laya.net.WorkerLoader.I.loadImage(e)}},__getset(1,r,"enable",function(){return r._enable},function(t){r.disableJSDecode&&!Browser.window.createImageBitmap||(r._enable=t)&&null==r._preLoadFun&&(r._enable=r.__init__())}),r.__init__=function(){return null==r._preLoadFun&&(!!Browser.window.Worker&&(r._preLoadFun=Loader.prototype._loadImage,Loader.prototype._loadImage=r.prototype._loadImage,r.I||(r.I=new r),!0))},r.workerSupported=function(){return!!Browser.window.Worker},r.IMAGE_LOADED="image_loaded",r.IMAGE_ERR="image_err",r.IMAGE_MSG="image_msg",r.I=null,r._preLoadFun=null,r._enable=!1,r.workerPath="libs/worker.js",r.disableJSDecode=!0,r}(),Resource=function(t){function o(){o.__super.call(this),this._$1__id=++o._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,(o._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,ResourceManager.currentResourceManager&&ResourceManager.currentResourceManager.addResource(this)}__class(o,"laya.resource.Resource",EventDispatcher);var e=o.prototype;return Laya.imps(e,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),e._setUrl=function(t){var e;this._url!==t&&(this._url&&((e=o._urlResourcesMap[this._url]).splice(e.indexOf(this),1),0===e.length&&delete o._urlResourcesMap[this._url]),t&&((e=o._urlResourcesMap[t])||(o._urlResourcesMap[t]=e=[]),e.push(this)),this._url=t)},e._getGroup=function(){return this._group},e._setGroup=function(t){var e;this._group!==t&&(this._group&&((e=o._groupResourcesMap[this._group]).splice(e.indexOf(this),1),0===e.length&&delete o._groupResourcesMap[this._group]),t&&((e=o._groupResourcesMap[t])||(o._groupResourcesMap[t]=e=[]),e.push(this)),this._group=t)},e._addReference=function(){this._referenceCount++},e._removeReference=function(){this._referenceCount--},e._clearReference=function(){this._referenceCount=0},e._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},e.recreateResource=function(){this.completeCreate()},e.disposeResource=function(){},e.activeResource=function(t){void 0===t&&(t=!1),this._lastUseFrameCount=Stat.loopCount,!this._destroyed&&this.__loaded&&(this._released||t)&&this.recreateResource()},e.releaseResource=function(t){return void 0===t&&(t=!1),!(!t&&this.lock)&&(!(this._released&&!t)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},e.onAsynLoaded=function(t,e,i){throw new Error("Resource: must override this function!")},e.destroy=function(){var t;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete o._idResourcesMap[this.id],this._url&&((t=o._urlResourcesMap[this._url])&&(t.splice(t.indexOf(this),1),0===t.length&&delete o._urlResourcesMap[this.url]),Loader.clearRes(this._url),this.__loaded||RunDriver.cancelLoadByUrl(this._url)),this._group&&((t=o._groupResourcesMap[this._group]).splice(t.indexOf(this),1),0===t.length&&delete o._groupResourcesMap[this.url]))},e.completeCreate=function(){this._released=!1,this.event("recovered",this)},e.dispose=function(){this.destroy()},__getset(0,e,"memorySize",function(){return this._memorySize},function(t){var e=t-this._memorySize;this._memorySize=t,this.resourceManager&&this.resourceManager.addSize(e)}),__getset(0,e,"_loaded",null,function(t){this.__loaded=t}),__getset(0,e,"loaded",function(){return this.__loaded}),__getset(0,e,"id",function(){return this._$1__id}),__getset(0,e,"destroyed",function(){return this._destroyed}),__getset(0,e,"group",function(){return this._getGroup()},function(t){this._setGroup(t)}),__getset(0,e,"resourceManager",function(){return this._resourceManager}),__getset(0,e,"url",function(){return this._url}),__getset(0,e,"released",function(){return this._released}),__getset(0,e,"referenceCount",function(){return this._referenceCount}),o.getResourceByID=function(t){return o._idResourcesMap[t]},o.getResourceByURL=function(t,e){return void 0===e&&(e=0),o._urlResourcesMap[t][e]},o.getResourceCountByURL=function(t){return o._urlResourcesMap[t].length},o.destroyUnusedResources=function(t){var e;if(t){var i=o._groupResourcesMap[t];if(i)for(var n=i.slice(),r=0,a=n.length;r<a;r++)(e=n[r]).lock||0!==e._referenceCount||e.destroy()}else for(var s in o._idResourcesMap)(e=o._idResourcesMap[s]).lock||0!==e._referenceCount||e.destroy()},o._uniqueIDCounter=0,o._idResourcesMap={},o._urlResourcesMap={},o._groupResourcesMap={},o}(),Texture=function(t){function D(t,e){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,D.__super.call(this),t&&t._addReference&&t._addReference(),this.setTo(t,e)}__class(D,"laya.resource.Texture",EventDispatcher);var e=D.prototype;return e._setUrl=function(t){this.url=t},e.setTo=function(t,e){if(t instanceof window.HTMLElement){var i=HTMLCanvas.create("2D",t);this.bitmap=i}else this.bitmap=t;if(this.uv=e||D.DEF_UV,t){this._w=t.width,this._h=t.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var n=this;if(this._loaded)RunDriver.addToAtlas&&RunDriver.addToAtlas(n);else{var r=t;r instanceof laya.resource.HTMLImage&&r.image&&r.image.addEventListener("load",function(t){RunDriver.addToAtlas&&RunDriver.addToAtlas(n)},!1)}}},e.active=function(){this.bitmap&&this.bitmap.activeResource()},e.destroy=function(t){if(void 0===t&&(t=!1),this.bitmap&&0<this.bitmap.referenceCount){var e=this.bitmap;t?(Render.isConchApp&&e.source&&e.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,e.dispose(),e._clearReference()):(e._removeReference(),0==e.referenceCount&&(Render.isConchApp&&e.source&&e.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,e.dispose())),this.url&&this===Laya.loader.getRes(this.url)&&Laya.loader.clearRes(this.url,t),this._loaded=!1}},e.load=function(t){var e=this;this._loaded=!1,t=URL.customFormat(t);var i=this.bitmap||(this.bitmap=HTMLImage.create(t));i&&i._addReference();var n=this;i.onload=function(){i.onload=null,n._loaded=!0,e.sourceWidth=e._w=i.width,e.sourceHeight=e._h=i.height,n.event("loaded",this),RunDriver.addToAtlas&&RunDriver.addToAtlas(n)}},e.addTextureToAtlas=function(t){RunDriver.addTextureToAtlas(this)},e.getPixels=function(t,e,i,n){if(Render.isConchApp){var r=this.bitmap;if(r.source&&r.source.getImageData){var a=r.source.getImageData(t,e,i,n),s=new Uint8Array(a);return Array.from(s)}return null}return Render.isWebGL?RunDriver.getTexturePixels(this,t,e,i,n):(Browser.canvas.size(i,n),Browser.canvas.clear(),Browser.context.drawTexture(this,-t,-e,this.width,this.height,0,0),Browser.context.getImageData(0,0,i,n).data)},e.onAsynLoaded=function(t,e){e&&e._addReference(),this.setTo(e,this.uv)},__getset(0,e,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),__getset(0,e,"loaded",function(){return this._loaded}),__getset(0,e,"released",function(){return!this.bitmap||this.bitmap.released}),__getset(0,e,"width",function(){return this._w?this._w:this.uv&&this.uv!==D.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function(t){this._w=t,this.sourceWidth||(this.sourceWidth=t)}),__getset(0,e,"repeat",function(){return!Render.isWebGL||!this.bitmap||this.bitmap.repeat},function(t){t&&Render.isWebGL&&this.bitmap&&(this.bitmap.repeat=t)&&(this.bitmap.enableMerageInAtlas=!1)}),__getset(0,e,"height",function(){return this._h?this._h:this.uv&&this.uv!==D.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function(t){this._h=t,this.sourceHeight||(this.sourceHeight=t)}),__getset(0,e,"isLinearSampling",function(){return!Render.isWebGL||9728!=this.bitmap.minFifter},function(t){!t&&Render.isWebGL&&(t||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),D.moveUV=function(t,e,i){for(var n=0;n<8;n+=2)i[n]+=t,i[n+1]+=e;return i},D.create=function(t,e,i,n,r,a,s,o,l){void 0===a&&(a=0),void 0===s&&(s=0),void 0===o&&(o=0),void 0===l&&(l=0);var h=t instanceof laya.resource.Texture,u=h?t.uv:D.DEF_UV,c=h?t.bitmap:t,_=RunDriver.isAtlas(c);if(_){var d=c._atlaser,f=t._atlasID;if(-1==f)throw new Error("create texture error");c=d._inAtlasTextureBitmapValue[f],u=d._inAtlasTextureOriUVValue[f]}var p=new D(c,null);c.width&&e+n>c.width&&(n=c.width-e),c.height&&i+r>c.height&&(r=c.height-i),p.width=n,p.height=r,p.offsetX=a,p.offsetY=s,p.sourceWidth=o||n,p.sourceHeight=l||r;var m=1/c.width,g=1/c.height;e*=m,i*=g,n*=m,r*=g;var v=p.uv[0],y=p.uv[1],x=p.uv[4],E=p.uv[5],T=x-v,S=E-y,w=D.moveUV(u[0],u[1],[e,i,e+n,i,e+n,i+r,e,i+r]);p.uv=[v+w[0]*T,y+w[1]*S,x-(1-w[2])*T,y+w[3]*S,x-(1-w[4])*T,E-(1-w[5])*S,v+w[6]*T,E-(1-w[7])*S],_&&p.addTextureToAtlas();var M=c.scaleRate;return M&&1!=M?(p.sourceWidth/=M,p.sourceHeight/=M,p.width/=M,p.height/=M,p.scaleRate=M,p.offsetX/=M,p.offsetY/=M):p.scaleRate=1,p},D.createFromTexture=function(t,e,i,n,r){var a=t.scaleRate;1!=a&&(e*=a,i*=a,n*=a,r*=a);var s=Rectangle.TEMP.setTo(e-t.offsetX,i-t.offsetY,n,r),o=s.intersection(D._rect1.setTo(0,0,t.width,t.height),D._rect2);if(!o)return null;var l=D.create(t,o.x,o.y,o.width,o.height,o.x-s.x,o.y-s.y,n,r);return l.bitmap._removeReference(),l},D.DEF_UV=[0,0,1,0,1,1,0,1],D.INV_UV=[0,1,1,1,1,0,0,0],D._rect1=new Rectangle,D._rect2=new Rectangle,D}(),TimeLine=function(t){var o;function a(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,a.__super.call(this)}__class(a,"laya.utils.TimeLine",EventDispatcher);var e=a.prototype;return e.to=function(t,e,i,n,r){return void 0===r&&(r=0),this._create(t,e,i,n,r,!0)},e.from=function(t,e,i,n,r){return void 0===r&&(r=0),this._create(t,e,i,n,r,!1)},e._create=function(t,e,i,n,r,a){var s=Pool.getItemByClass("tweenData",o);return s.isTo=a,s.type=0,s.target=t,s.duration=i,s.data=e,s.startTime=this._startTime+r,s.endTime=s.startTime+s.duration,s.ease=n,this._startTime=Math.max(s.endTime,this._startTime),this._tweenDataList.push(s),this._startTimeSort=!0,this._endTimeSort=!0,this},e.addLabel=function(t,e){var i=Pool.getItemByClass("tweenData",o);return i.type=1,i.data=t,i.endTime=i.startTime=this._startTime+e,this._labelDic||(this._labelDic={}),this._labelDic[t]=i,this._tweenDataList.push(i),this},e.removeLabel=function(t){if(this._labelDic&&this._labelDic[t]){var e=this._labelDic[t];if(e){var i=this._tweenDataList.indexOf(e);-1<i&&this._tweenDataList.splice(i,1)}delete this._labelDic[t]}},e.gotoTime=function(t){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var e,i,n,r;for(var a in this._firstTweenDic)if(i=this._firstTweenDic[a])for(var s in i)i.diyTarget.hasOwnProperty(s)&&(i.diyTarget[s]=i[s]);for(a in this._tweenDic)(e=this._tweenDic[a]).clear(),delete this._tweenDic[a];if(this._index=0,this._gidIndex=0,this._currTime=t,this._lastTime=Browser.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=n=this._tweenDataList.concat(),n.sort(function(t,e){return t.endTime>e.endTime?1:t.endTime<e.endTime?-1:0})}else n=this._endTweenDataList;for(var o=0,l=n.length;o<l;o++)if(0==(r=n[o]).type){if(!(t>=r.endTime))break;this._index=Math.max(this._index,o+1);var h=r.data;if(r.isTo)for(var u in h)r.target[u]=h[u]}for(o=0,l=this._tweenDataList.length;o<l;o++)0==(r=this._tweenDataList[o]).type&&t>=r.startTime&&t<r.endTime&&(this._index=Math.max(this._index,o+1),this._gidIndex++,(e=Pool.getItemByClass("tween",Tween))._create(r.target,r.data,r.duration,r.ease,Handler.create(this,this._animComplete,[this._gidIndex]),0,!1,r.isTo,!0,!1),e.setStartTime(this._currTime-(t-r.startTime)),e._updateEase(this._currTime),e.gid=this._gidIndex,this._tweenDic[this._gidIndex]=e)}},e.gotoLabel=function(t){if(null!=this._labelDic){var e=this._labelDic[t];e&&this.gotoTime(e.startTime)}},e.pause=function(){Laya.timer.clear(this,this._update)},e.resume=function(){this.play(this._currTime,this._loopKey)},e.play=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function(t,e){return t.startTime>e.startTime?1:t.startTime<e.startTime?-1:0});for(var i=0,n=this._tweenDataList.length;i<n;i++){var r=this._tweenDataList[i];if(null!=r&&0==r.type){var a=r.target,s=a.$_GID||(a.$_GID=Utils.getGID()),o=null;for(var l in null==this._firstTweenDic[s]?((o={}).diyTarget=a,this._firstTweenDic[s]=o):o=this._firstTweenDic[s],r.data)null==o[l]&&(o[l]=a[l])}}}"string"==typeof t?this.gotoLabel(t):this.gotoTime(t),this._loopKey=e,this._lastTime=Browser.now(),Laya.timer.frameLoop(1,this,this._update)}},e._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var t in this._tweenDic)(e=this._tweenDic[t]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var e,i=Browser.now(),n=i-this._lastTime,r=this._currTime+=n*this.scale;for(t in this._lastTime=i,this._tweenDic)(e=this._tweenDic[t])._updateEase(r);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var a=this._tweenDataList[this._index];r>=a.startTime&&(this._index++,0==a.type?(this._gidIndex++,(e=Pool.getItemByClass("tween",Tween))._create(a.target,a.data,a.duration,a.ease,Handler.create(this,this._animComplete,[this._gidIndex]),0,!1,a.isTo,!0,!1),e.setStartTime(r),e.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=e)._updateEase(r)):this.event("label",a.data))}},e._animComplete=function(t){this._tweenDic[t]&&delete this._tweenDic[t]},e._complete=function(){this.event("complete")},e.reset=function(){var t;if(this._labelDic)for(t in this._labelDic)delete this._labelDic[t];for(t in this._tweenDic)this._tweenDic[t].clear(),delete this._tweenDic[t];for(t in this._firstTweenDic)delete this._firstTweenDic[t];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var e,i=0;for(e=this._tweenDataList.length,i=0;i<e;i++)this._tweenDataList[i]&&this._tweenDataList[i].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,Laya.timer.clear(this,this._update)},e.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},__getset(0,e,"index",function(){return this._frameIndex},function(t){this._frameIndex=t,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),__getset(0,e,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),a.to=function(t,e,i,n,r){return void 0===r&&(r=0),(new a).to(t,e,i,n,r)},a.from=function(t,e,i,n,r){return void 0===r&&(r=0),(new a).from(t,e,i,n,r)},a.__init$=function(){o=function(){function t(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return __class(t,""),t.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,Pool.recover("tweenData",this)},t}()},a}(),Sprite=function(r){function i(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,i.__super.call(this),this._style=Style.EMPTY}__class(i,"laya.display.Sprite",r);var t=i.prototype;return Laya.imps(t,{"laya.display.ILayout":!0}),t.createConchModel=function(){return new ConchNode},t.destroy=function(t){void 0===t&&(t=!0),this._releaseMem(),r.prototype.destroy.call(this,t),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},t.updateZOrder=function(){Utils.updateOrder(this._childs)&&this.repaint()},t.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},t.setBounds=function(t){this._set$P("uBounds",t)},t.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new Rectangle),Rectangle._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},t.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new Rectangle),Rectangle._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},t._boundPointsToParent=function(t){void 0===t&&(t=!1);var e=0,i=0;this._style&&(e=this._style._tf.translateX,i=this._style._tf.translateY,t=t||0!==this._style._tf.rotate,this._style.scrollRect&&(e+=this._style.scrollRect.x,i+=this._style.scrollRect.y));var n=this._getBoundPointsM(t);if(!n||n.length<1)return n;if(8!=n.length&&(n=t?GrahamScan.scanPList(n):Rectangle._getWrapRec(n,Rectangle.TEMP)._getBoundPoints()),!this.transform)return Utils.transPointList(n,this._x-e,this._y-i),n;var r=Point.TEMP,a=0,s=n.length;for(a=0;a<s;a+=2)r.x=n[a],r.y=n[a+1],this.toParentPoint(r),n[a]=r.x,n[a+1]=r.y;return n},t.getGraphicBounds=function(t){return void 0===t&&(t=!1),this._graphics?this._graphics.getBounds(t):Rectangle.TEMP.setTo(0,0,0,0)},t._getBoundPointsM=function(t){if(void 0===t&&(t=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var e=Utils.clearArray(this._$P.temBM),i=Rectangle.TEMP;return i.copyFrom(this.scrollRect),Utils.concatArray(e,i._getBoundPoints()),e}for(var n,r,a,s=this._graphics?this._graphics.getBoundPoints():Utils.clearArray(this._$P.temBM),o=0,l=(a=this._childs).length;o<l;o++)(n=a[o])instanceof laya.display.Sprite&&1==n.visible&&(r=n._boundPointsToParent(t))&&(s=s?Utils.concatArray(s,r):r);return s},t.getStyle=function(){return this._style===Style.EMPTY&&(this._style=new Style),this._style},t.setStyle=function(t){this._style=t},t._adjustTransform=function(){"use strict";this._tfChanged=!1;var t,e=this._style._tf,i=e.scaleX,n=e.scaleY;if(e.rotate||1!==i||1!==n||e.skewX||e.skewY){(t=this._transform||(this._transform=Matrix.create())).bTransform=!0;var r=.0174532922222222*(e.rotate-e.skewX),a=.0174532922222222*(e.rotate+e.skewY),s=Math.cos(a),o=Math.sin(a),l=Math.sin(r),h=Math.cos(r);return t.a=i*s,t.b=i*o,t.c=-n*l,t.d=n*h,t.tx=t.ty=0,t}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,t},t.pos=function(t,e,i){if(void 0===i&&(i=!1),this._x!==t||this._y!==e){if(this.destroyed)return this;if(i){this._x=t,this._y=e,this.conchModel&&this.conchModel.pos(this._x,this._y);var n=this._parent;n&&0===n._repaint&&(n._repaint=1,n.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=t,this.y=e}return this},t.pivot=function(t,e){return this.pivotX=t,this.pivotY=e,this},t.size=function(t,e){return this.width=t,this.height=e,this},t.scale=function(t,e,i){void 0===i&&(i=!1);var n=this.getStyle(),r=n._tf;if(r.scaleX!=t||r.scaleY!=e){if(this.destroyed)return this;if(i){n.setScale(t,e),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(t,e),this._renderType|=4;var a=this._parent;a&&0===a._repaint&&(a._repaint=1,a.parentRepaint())}else this.scaleX=t,this.scaleY=e}return this},t.skew=function(t,e){return this.skewX=t,this.skewY=e,this},t.render=function(t,e,i){Stat.spriteCount++,RenderSprite.renders[this._renderType]._fun(this,t,e+this._x,i+this._y),this._repaint=0},t.drawToCanvas=function(t,e,i,n){if(Render.isConchNode){var r=HTMLCanvas.create("2D");return new RenderContext(t,e,r).ctx.setCanvasType(1),this.conchModel.drawToCanvas(r.source,i,n),r}return RunDriver.drawToCanvas(this,this._renderType,t,e,i,n)},t.customRender=function(t,e,i){this._renderType|=1024},t._applyFilters=function(){var t;if(!Render.isWebGL&&((t=this._$P.filters)&&!(t.length<1)))for(var e=0,i=t.length;e<i;e++)t[e].action.apply(this._$P.cacheCanvas)},t._isHaveGlowFilter=function(){var t,e=0;if(this.filters)for(e=0;e<this.filters.length;e++)if(8==this.filters[e].type)return!0;for(e=0,t=this._childs.length;e<t;e++)if(this._childs[e]._isHaveGlowFilter())return!0;return!1},t.localToGlobal=function(t,e){void 0===e&&(e=!1),!0===e&&(t=new Point(t.x,t.y));for(var i=this;i&&i!=Laya.stage;)t=i.toParentPoint(t),i=i.parent;return t},t.globalToLocal=function(t,e){void 0===e&&(e=!1),e&&(t=new Point(t.x,t.y));for(var i=this,n=[];i&&i!=Laya.stage;)n.push(i),i=i.parent;for(var r=n.length-1;0<=r;)t=(i=n[r]).fromParentPoint(t),r--;return t},t.toParentPoint=function(t){if(!t)return t;t.x-=this.pivotX,t.y-=this.pivotY,this.transform&&this._transform.transformPoint(t),t.x+=this._x,t.y+=this._y;var e=this._style.scrollRect;return e&&(t.x-=e.x,t.y-=e.y),t},t.fromParentPoint=function(t){if(!t)return t;t.x-=this._x,t.y-=this._y;var e=this._style.scrollRect;return e&&(t.x+=e.x,t.y+=e.y),this.transform&&this._transform.invertTransformPoint(t),t.x+=this.pivotX,t.y+=this.pivotY,t},t.on=function(t,e,i,n){return 1!==this._mouseEnableState&&this.isMouseEvent(t)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(t,e,i,n,!1)):r.prototype.on.call(this,t,e,i,n)},t.once=function(t,e,i,n){return 1!==this._mouseEnableState&&this.isMouseEvent(t)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(t,e,i,n,!0)):r.prototype.once.call(this,t,e,i,n)},t._$2__onDisplay=function(){if(1!==this._mouseEnableState){var t=this;for(t=t.parent;t&&1!==t._mouseEnableState&&!t._getBit(2);)t.mouseEnabled=!0,t._setBit(2,!0),t=t.parent}},t.loadImage=function(t,e,i,n,r,a){var s=this;return void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),this.graphics.loadImage(t,e,i,n,r,function(t){s.destroyed||(s.size(e+(n||t.width),i+(r||t.height)),s.repaint(),a&&a.runWith(t))}),this},t.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},t._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},t._childChanged=function(t){this._childs.length?this._renderType|=2048:this._renderType&=-2049,t&&this._get$P("hasZorder")&&Laya.timer.callLater(this,this.updateZOrder),this.repaint()},t.parentRepaint=function(){var t=this._parent;t&&0===t._repaint&&(t._repaint=1,t.parentRepaint())},t.startDrag=function(t,e,i,n,r,a,s){void 0===e&&(e=!1),void 0===i&&(i=0),void 0===n&&(n=300),void 0===a&&(a=!1),void 0===s&&(s=.92),this._$P.dragging||this._set$P("dragging",new Dragging),this._$P.dragging.start(this,t,e,i,n,r,a,s)},t.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},t._releaseMem=function(){if(this._$P){var t=this._$P.cacheCanvas;t&&t.ctx&&(Pool.recover("RenderContext",t.ctx),t.ctx.canvas.size(0,0),t.ctx=null);var e=this._$P._filterCache;e&&(e.destroy(),e.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},t._setDisplay=function(t){t||this._releaseMem(),r.prototype._setDisplay.call(this,t)},t.hitTestPoint=function(t,e){var i=this.globalToLocal(Point.TEMP.setTo(t,e));return t=i.x,e=i.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?Rectangle.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains(t,e)},t.getMousePoint=function(){return this.globalToLocal(Point.TEMP.setTo(Laya.stage.mouseX,Laya.stage.mouseY))},t._getWords=function(){return null},t._addChildsToLayout=function(n){var t=this._getWords();if(null==t&&0==this._childs.length)return!1;if(t)for(var e=0,i=t.length;e<i;e++)n.push(t[e]);return this._childs.forEach(function(t,e,i){t._style._enableLayout()&&t._addToLayout(n)}),!0},t._addToLayout=function(t){this._style.absolute||(this._style.block?t.push(this):this._addChildsToLayout(t)&&(this.x=this.y=0))},t._isChar=function(){return!1},t._getCSSStyle=function(){return this._style.getCSSStyle()},t._setAttributes=function(t,e){switch(t){case"x":this.x=parseFloat(e);break;case"y":this.y=parseFloat(e);break;case"width":this.width=parseFloat(e);break;case"height":this.height=parseFloat(e);break;default:this[t]=e}},t._layoutLater=function(){this.parent&&this.parent._layoutLater()},__getset(0,t,"optimizeScrollRect",function(){return this._optimizeScrollRect},function(t){this._optimizeScrollRect!=t&&(this._optimizeScrollRect=t,this.conchModel&&this.conchModel.optimizeScrollRect(t))}),__getset(0,t,"customRenderEnable",null,function(t){if(t&&(this._renderType|=1024,Render.isConchNode)){i.CustomList.push(this);var e=new HTMLCanvas("2d");e._setContext(new CanvasRenderingContext2D),this.customContext=new RenderContext(0,0,e),e.context.setCanvasType&&e.context.setCanvasType(2),this.conchModel.custom(e.context)}}),__getset(0,t,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function(t){this.cacheAs=t?this._$P.hasFilter?"none":"normal":"none"}),__getset(0,t,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function(t){var e=this._$P.cacheCanvas;if(t!==(e?e.type:"none")){if("none"!==t)this._getBit(1)||this._setUpNoticeType(1),e||(e=this._set$P("cacheCanvas",Pool.getItemByClass("cacheCanvas",Object))),e.type=t,e.reCache=!0,this._renderType|=16,"bitmap"==t&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if(e){var i=e;i&&i.ctx&&(Pool.recover("RenderContext",i.ctx),i.ctx.canvas.size(0,0),i.ctx=null),Pool.recover("cacheCanvas",e)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),__getset(0,t,"zOrder",function(){return this._zOrder},function(t){this._zOrder!=t&&(this._zOrder=t,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder(t),this._parent&&(t&&this._parent._set$P("hasZorder",!0),Laya.timer.callLater(this._parent,this.updateZOrder)))}),__getset(0,t,"rotation",function(){return this._style._tf.rotate},function(t){var e=this.getStyle();if(e._tf.rotate!==t){e.setRotate(t),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate(t),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),__getset(0,t,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(t){this._width!==t&&(this._width=t,this.conchModel&&this.conchModel.size(t,this._height),this.repaint())}),__getset(0,t,"x",function(){return this._x},function(t){if(this._x!==t){if(this.destroyed)return;this._x=t,this.conchModel&&this.conchModel.pos(t,this._y);var e=this._parent;e&&0===e._repaint&&(e._repaint=1,e.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),__getset(0,t,"globalScaleY",function(){for(var t=1,e=this;e&&e!==Laya.stage;)t*=e.scaleY,e=e.parent;return t}),__getset(0,t,"hitArea",function(){return this._$P.hitArea},function(t){this._set$P("hitArea",t)}),__getset(0,t,"staticCache",function(){return this._$P.staticCache},function(t){this._set$P("staticCache",t),t||this.reCache()}),__getset(0,t,"texture",function(){return this._texture},function(t){this._texture!=t&&(this._texture=t,this.graphics.cleanByTexture(t,0,0))}),__getset(0,t,"y",function(){return this._y},function(t){if(this._y!==t){if(this.destroyed)return;this._y=t,this.conchModel&&this.conchModel.pos(this._x,t);var e=this._parent;e&&0===e._repaint&&(e._repaint=1,e.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),__getset(0,t,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(t){this._height!==t&&(this._height=t,this.conchModel&&this.conchModel.size(this._width,t),this.repaint())}),__getset(0,t,"blendMode",function(){return this._style.blendMode},function(t){this.getStyle().blendMode=t,this.conchModel&&this.conchModel.blendMode(t),t&&"source-over"!=t?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),__getset(0,t,"scaleX",function(){return this._style._tf.scaleX},function(t){var e=this.getStyle();if(e._tf.scaleX!==t){e.setScaleX(t),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(t,e._tf.scaleY),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),__getset(0,t,"scaleY",function(){return this._style._tf.scaleY},function(t){var e=this.getStyle();if(e._tf.scaleY!==t){e.setScaleY(t),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(e._tf.scaleX,t),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),__getset(0,t,"stage",function(){return Laya.stage}),__getset(0,t,"skewX",function(){return this._style._tf.skewX},function(t){var e=this.getStyle();if(e._tf.skewX!==t){e.setSkewX(t),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(t,e._tf.skewY),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),__getset(0,t,"scrollRect",function(){return this._style.scrollRect},function(t){this.getStyle().scrollRect=t,this.repaint(),t?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect(t.x,t.y,t.width,t.height)):(this._renderType&=-129,this.conchModel&&(i.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),__getset(0,t,"skewY",function(){return this._style._tf.skewY},function(t){var e=this.getStyle();if(e._tf.skewY!==t){e.setSkewY(t),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(e._tf.skewX,t),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),__getset(0,t,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(t){this._tfChanged=!1,(this._transform=t)&&(this._x=t.tx,this._y=t.ty,t.tx=t.ty=0,this.conchModel&&this.conchModel.transform(t.a,t.b,t.c,t.d,this._x,this._y)),t?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),__getset(0,t,"pivotX",function(){return this._style._tf.translateX},function(t){this.getStyle().setTranslateX(t),this.conchModel&&this.conchModel.pivot(t,this._style._tf.translateY),this.repaint()}),__getset(0,t,"pivotY",function(){return this._style._tf.translateY},function(t){this.getStyle().setTranslateY(t),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,t),this.repaint()}),__getset(0,t,"alpha",function(){return this._style.alpha},function(t){this._style&&this._style.alpha!==t&&(t=t<0?0:1<t?1:t,this.getStyle().alpha=t,this.conchModel&&this.conchModel.alpha(t),1!==t?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),__getset(0,t,"visible",function(){return this._style.visible},function(t){this._style&&this._style.visible!==t&&(this.getStyle().visible=t,this.conchModel&&this.conchModel.visible(t),this.parentRepaint())}),__getset(0,t,"graphics",function(){return this._graphics||(this.graphics=RunDriver.createGraphics())},function(t){this._graphics&&(this._graphics._sp=null),(this._graphics=t)?(this._renderType&=-2,this._renderType|=512,(t._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&(i.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),__getset(0,t,"filters",function(){return this._$P.filters},function(t){t&&0===t.length&&(t=null),this._$P.filters!=t&&(this._set$P("filters",t?t.slice():null),Render.isConchApp&&(this.conchModel&&(i.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),Render.isWebGL&&(t&&t.length?this._renderType|=32:this._renderType&=-33),t&&0<t.length?(this._getBit(1)||this._setUpNoticeType(1),Render.isWebGL&&1==t.length&&t[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&(Render.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),__getset(0,t,"parent",r.prototype._$get_parent,function(t){Laya.superSet(Node,this,"parent",t),t&&this._getBit(2)&&this._$2__onDisplay()}),__getset(0,t,"mask",function(){return this._$P._mask},function(t){t&&this.mask&&this.mask._$P.maskParent||(t?(this.cacheAs="bitmap",this._set$P("_mask",t),t._set$P("maskParent",this)):(this.cacheAs="none",this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",t)),this.conchModel&&this.conchModel.mask(t?t.conchModel:null),this._renderType|=64,this.parentRepaint())}),__getset(0,t,"mouseEnabled",function(){return 1<this._mouseEnableState},function(t){this._mouseEnableState=t?2:1}),__getset(0,t,"globalScaleX",function(){for(var t=1,e=this;e&&e!==Laya.stage;)t*=e.scaleX,e=e.parent;return t}),__getset(0,t,"mouseX",function(){return this.getMousePoint().x}),__getset(0,t,"mouseY",function(){return this.getMousePoint().y}),i.fromImage=function(t){return(new i).loadImage(t)},i.CustomList=[],__static(i,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=window.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),i}(Node),AudioSoundChannel=function(t){function e(t){this._audio=null,this._onEnd=null,this._resumePlay=null,e.__super.call(this),this._onEnd=Utils.bind(this.__onEnd,this),this._resumePlay=Utils.bind(this.__resumePlay,this),t.addEventListener("ended",this._onEnd),this._audio=t}__class(e,"laya.media.h5audio.AudioSoundChannel",SoundChannel);var i=e.prototype;return i.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(Laya.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},i.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,Browser.container.appendChild(this._audio),this._audio.play()}catch(t){this.event("error")}},i.play=function(){this.isStopped=!1;try{this._audio.playbackRate=SoundManager.playbackRate,this._audio.currentTime=this.startTime}catch(t){return void this._audio.addEventListener("canplay",this._resumePlay)}SoundManager.addChannel(this),Browser.container.appendChild(this._audio),"play"in this._audio&&this._audio.play()},i.stop=function(){this.isStopped=!0,SoundManager.removeChannel(this),this.completeHandler=null,this._audio&&("pause"in this._audio&&Render.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),Browser.onIE||this._audio!=AudioSound._musicAudio&&Pool.recover("audio:"+this.url,this._audio),Browser.removeElement(this._audio),this._audio=null)},i.pause=function(){this.isStopped=!0,SoundManager.removeChannel(this),"pause"in this._audio&&this._audio.pause()},i.resume=function(){this._audio&&(this.isStopped=!1,SoundManager.addChannel(this),"play"in this._audio&&this._audio.play())},__getset(0,i,"position",function(){return this._audio?this._audio.currentTime:0}),__getset(0,i,"duration",function(){return this._audio?this._audio.duration:0}),__getset(0,i,"volume",function(){return this._audio?this._audio.volume:1},function(t){this._audio&&(this._audio.volume=t)}),e}(),WebAudioSoundChannel=function(t){function e(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=WebAudioSound.ctx,e.__super.call(this),this._onPlayEnd=Utils.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}__class(e,"laya.media.webaudio.WebAudioSoundChannel",SoundChannel);var i=e.prototype;return i.play=function(){if(SoundManager.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var t=this.context,e=this.gain,i=t.createBufferSource();(this.bufferSource=i).buffer=this.audioBuffer,i.connect(e),e&&e.disconnect(),e.connect(t.destination),i.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=Browser.now(),this.gain.gain.value=this._volume,0==this.loops&&(i.loop=!0),i.playbackRate.value=SoundManager.playbackRate,i.start(0,this.startTime),this._currentTime=0}},i.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&(Laya.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},i._clearBufferSource=function(){if(this.bufferSource){var t=this.bufferSource;t.stop?t.stop(0):t.noteOff(0),t.disconnect(0),t.onended=null,e._tryCleanFailed||this._tryClearBuffer(t),this.bufferSource=null}},i._tryClearBuffer=function(t){if(Browser.onMac)try{t.buffer=WebAudioSound._miniBuffer}catch(t){e._tryCleanFailed=!0}else try{t.buffer=null}catch(t){e._tryCleanFailed=!0}},i.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,SoundManager.removeChannel(this),this.completeHandler=null,SoundManager.autoReleaseSound&&Laya.timer.once(5e3,null,SoundManager.disposeSoundIfNotUsed,[this.url],!1)},i.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,SoundManager.removeChannel(this),SoundManager.autoReleaseSound&&Laya.timer.once(5e3,null,SoundManager.disposeSoundIfNotUsed,[this.url],!1)},i.resume=function(){this.startTime=this._pauseTime,this.play()},__getset(0,i,"position",function(){return this.bufferSource?(Browser.now()-this._startTime)/1e3+this.startTime:0}),__getset(0,i,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),__getset(0,i,"volume",function(){return this._volume},function(t){this.isStopped||(this._volume=t,this.gain.gain.value=t)}),e._tryCleanFailed=!1,e}(),Bitmap=function(t){function e(){e.__super.call(this),this._w=0,this._h=0}__class(e,"laya.resource.Bitmap",Resource);var i=e.prototype;return __getset(0,i,"width",function(){return this._w}),__getset(0,i,"height",function(){return this._h}),__getset(0,i,"source",function(){return this._source}),e}(),AnimationPlayerBase=function(e){function t(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,t.__super.call(this),this._interval=Config.animationInterval,this._setUpNoticeType(1)}__class(t,"laya.display.AnimationPlayerBase",e);var i=t.prototype;return i.play=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=""),void 0===n&&(n=!0),this._isPlaying=!0,this.index="string"==typeof t?this._getFrameByLabel(t):t,this.loop=e,this._actionName=i,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},i._getFrameByLabel=function(t){var e=0;for(e=0;e<this._count;e++)if(this._labels[e]&&0<=this._labels[e].indexOf(t))return e;return 0},i._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},i._setControlNode=function(t){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=t)&&t!=this&&(t.on("display",this,this._checkResumePlaying),t.on("undisplay",this,this._checkResumePlaying))},i._setDisplay=function(t){e.prototype._setDisplay.call(this,t),this._checkResumePlaying()},i._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},i.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},i.addLabel=function(t,e){this._labels||(this._labels={}),this._labels[e]||(this._labels[e]=[]),this._labels[e].push(t)},i.removeLabel=function(t){if(t){if(this._labels)for(var e in this._labels)this._removeLabelFromLabelList(this._labels[e],t)}else this._labels=null},i._removeLabelFromLabelList=function(t,e){if(t)for(var i=t.length-1;0<=i;i--)t[i]==e&&t.splice(i,1)},i.gotoAndStop=function(t){this.index="string"==typeof t?this._getFrameByLabel(t):t,this.stop()},i._displayToIndex=function(t){},i.clear=function(){this.stop(),this._labels=null},__getset(0,i,"interval",function(){return this._interval},function(t){this._interval!=t&&(this._frameRateChanged=!0,this._interval=t,this._isPlaying&&0<t&&this.timerLoop(t,this,this._frameLoop,null,!0,!0))}),__getset(0,i,"isPlaying",function(){return this._isPlaying}),__getset(0,i,"index",function(){return this._index},function(t){if(this._index=t,this._displayToIndex(t),this._labels&&this._labels[t])for(var e=this._labels[t],i=0,n=e.length;i<n;i++)this.event("label",e[i])}),__getset(0,i,"count",function(){return this._count}),t.WRAP_POSITIVE=0,t.WRAP_REVERSE=1,t.WRAP_PINGPONG=2,t}(Sprite),Text=function(e){function d(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,d.__super.call(this),this.overflow=d.VISIBLE,this._style=new CSSStyle(this),this._style.wordWrap=!1}__class(d,"laya.display.Text",e);var t=d.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._lines=null,this._words&&(this._words.length=0,this._words=null)},t._getBoundPointsM=function(t){void 0===t&&(t=!1);var e=Rectangle.TEMP;return e.setTo(0,0,this.width,this.height),e._getBoundPoints()},t.getGraphicBounds=function(t){void 0===t&&(t=!1);var e=Rectangle.TEMP;return e.setTo(0,0,this.width,this.height),e},t._getCSSStyle=function(){return this._style},t.lang=function(t,e,i,n,r,a,s,o,l,h,u){if(t=d.langPacks&&d.langPacks[t]?d.langPacks[t]:t,arguments.length<2)this._text=t;else{for(var c=0,_=arguments.length;c<_;c++)t=t.replace("{"+c+"}",arguments[c+1]);this._text=t}},t._isPassWordMode=function(){var t=this._style.password;return"prompt"in this&&this.prompt==this._text&&(t=!1),t},t._getPassWordTxt=function(t){var e;e="";for(var i=t.length;0<i;i--)e+="●";return e},t.renderText=function(t,e){var i=this.graphics;i.clear(!0);var n=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(Browser.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);Browser.context.font=n;var r=this.padding,a=r[3],s="left",o=this._lines,l=this.leading+this._charSize.height,h=this._currBitmapFont;h&&(l=this.leading+h.getMaxHeight());var u=r[0];if(!h&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?(s="right",a=this._width-r[1]):"center"==this.align&&(s="center",a=.5*this._width+r[3]-r[1])),0<this._height){var c=this._textHeight>this._height?"top":this.valign;"middle"===c?u=.5*(this._height-e*l)+r[0]-r[2]:"bottom"===c&&(u=this._height-e*l-r[2])}var _=this._style;if(h&&h.autoScaleSize)var d=h.fontSize/this.fontSize;if(this._clipPoint)if(i.save(),h&&h.autoScaleSize){var f=0,p=0;f=this._width?this._width-r[3]-r[1]:this._textWidth,p=this._height?this._height-r[0]-r[2]:this._textHeight,f*=d,p*=d,i.clipRect(r[3],r[0],f,p)}else i.clipRect(r[3],r[0],this._width?this._width-r[3]-r[1]:this._textWidth,this._height?this._height-r[0]-r[2]:this._textHeight);var m=_.password;"prompt"in this&&this.prompt==this._text&&(m=!1);for(var g=0,v=0,y=Math.min(this._lines.length,e+t)||1,x=t;x<y;x++){var E,T=o[x];if(m){var S=T.length;T="";for(var w=S;0<w;w--)T+="●"}if(g=a-(this._clipPoint?this._clipPoint.x:0),v=u+l*x-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline(s,g,v,x),h){var M=this.width;h.autoScaleSize&&(M=this.width*d),h.drawText(T,this,g,v,this.align,M)}else Render.isWebGL?(this._words||(this._words=[]),(E=this._words.length>x-t?this._words[x-t]:new WordText).setText(T)):E=T,_.stroke?i.fillBorderText(E,g,v,n,this.color,_.strokeColor,_.stroke,s):i.fillText(E,g,v,n,this.color,s)}if(h&&h.autoScaleSize){var D=1/d;this.scale(D,D)}this._clipPoint&&i.restore(),this._startX=a,this._startY=u},t.drawUnderline=function(t,e,i,n){var r=this._lineWidths[n];switch(t){case"center":e-=r/2;break;case"right":e-=r}i+=this._charSize.height,this._graphics.drawLine(e,i,e+r,i,this.underlineColor||this.color,1)},t.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);Browser.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new Point(0,0)):this._clipPoint=null;var t=this._lines.length;if(this.overflow!=d.VISIBLE){var e=this.overflow==d.HIDDEN?Math.floor:Math.ceil;t=Math.min(t,e((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var i=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText(i,t),this.repaint()},t.evalTextSize=function(){var t,e=NaN;t=Math.max.apply(this,this._lineWidths),e=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],t==this._textWidth&&e==this._textHeight||(this._textWidth=t,this._textHeight=e,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},t.checkEnabledViewportOrNot=function(){return this.overflow==d.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},t.changeText=function(t){this._text!==t&&(this.lang(t+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},t.parseLines=function(t){var e=this.wordWrap||this.overflow==d.HIDDEN;if(e)var i=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var n=Browser.context.measureText(d._testWord);this._charSize.width=n.width,this._charSize.height=n.height||this.fontSize}for(var r=t.replace(/\r\n/g,"\n").split("\n"),a=0,s=r.length;a<s;a++){var o=r[a];e?this.parseLine(o,i):(this._lineWidths.push(this.getTextWidth(o)),this._lines.push(o))}},t.parseLine=function(t,e){Browser.context;var i,n=this._lines,r=0,a=NaN,s=NaN,o=0;if((a=this.getTextWidth(t))<=e)return n.push(t),void this._lineWidths.push(a);a=this._charSize.width,0==(r=Math.floor(e/a))&&(r=1),s=a=this.getTextWidth(t.substring(0,r));for(var l=r,h=t.length;l<h;l++)if(e<(s+=a=this.getTextWidth(t.charAt(l))))if(this.wordWrap){var u=t.substring(o,l);if(u.charCodeAt(u.length-1)<255?(i=/(?:\w|-)+$/.exec(u))&&(l=i.index+o,0==i.index?l+=u.length:u=t.substring(o,l)):d.RightToLeft&&(i=/([\u0600-\u06FF])+$/.exec(u))&&(l=i.index+o,0==i.index?l+=u.length:u=t.substring(o,l)),n.push(u),this._lineWidths.push(s-a),!((o=l)+r<h)){n.push(t.substring(o,h)),this._lineWidths.push(this.getTextWidth(n[n.length-1])),o=-1;break}l+=r,s=a=this.getTextWidth(t.substring(o,l)),l--}else if(this.overflow==d.HIDDEN)return n.push(t.substring(0,l)),void this._lineWidths.push(this.getTextWidth(n[n.length-1]));this.wordWrap&&-1!=o&&(n.push(t.substring(o,h)),this._lineWidths.push(this.getTextWidth(n[n.length-1])))},t.getTextWidth=function(t){return this._currBitmapFont?this._currBitmapFont.getTextWidth(t):Browser.context.measureText(t).width},t.getWordWrapWidth=function(){var t=this.padding,e=NaN;return(e=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&(e=this.wordWrap?100:Browser.width),e<=0&&(e=100),e-t[3]-t[1]},t.getCharPoint=function(t,e){this._isChanged&&Laya.timer.runCallLater(this,this.typeset);for(var i=0,n=this._lines,r=0,a=0,s=n.length;a<s;a++){if(t<(i+=n[a].length)){var o=a;break}r=i}var l=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;Browser.context.font=l;var h=this.getTextWidth(this._text.substring(r,t));return(e||new Point).setTo(this._startX+h-(this._clipPoint?this._clipPoint.x:0),this._startY+o*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},__getset(0,t,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function(t){t!=this._width&&(Laya.superSet(Sprite,this,"width",t),this.isChanged=!0)}),__getset(0,t,"textWidth",function(){return this._isChanged&&Laya.timer.runCallLater(this,this.typeset),this._textWidth}),__getset(0,t,"height",function(){return this._height?this._height:this.textHeight+this.padding[0]+this.padding[2]},function(t){t!=this._height&&(Laya.superSet(Sprite,this,"height",t),this.isChanged=!0)}),__getset(0,t,"textHeight",function(){return this._isChanged&&Laya.timer.runCallLater(this,this.typeset),this._textHeight}),__getset(0,t,"padding",function(){return this._getCSSStyle().padding},function(t){this._getCSSStyle().padding=t,this.isChanged=!0}),__getset(0,t,"bold",function(){return this._getCSSStyle().bold},function(t){this._getCSSStyle().bold=t,this.isChanged=!0}),__getset(0,t,"text",function(){return this._text||""},function(t){this._text!==t&&(this.lang(t+""),this.isChanged=!0,this.event("change"))}),__getset(0,t,"color",function(){return this._getCSSStyle().color},function(t){this._getCSSStyle().color!=t&&(this._getCSSStyle().color=t,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),__getset(0,t,"font",function(){return this._getCSSStyle().fontFamily},function(t){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),d._bitmapFonts&&d._bitmapFonts[t]&&(this._currBitmapFont=d._bitmapFonts[t]),this._getCSSStyle().fontFamily=t,this.isChanged=!0}),__getset(0,t,"fontSize",function(){return this._getCSSStyle().fontSize},function(t){this._getCSSStyle().fontSize=t,this.isChanged=!0}),__getset(0,t,"italic",function(){return this._getCSSStyle().italic},function(t){this._getCSSStyle().italic=t,this.isChanged=!0}),__getset(0,t,"align",function(){return this._getCSSStyle().align},function(t){this._getCSSStyle().align=t,this.isChanged=!0}),__getset(0,t,"valign",function(){return this._getCSSStyle().valign},function(t){this._getCSSStyle().valign=t,this.isChanged=!0}),__getset(0,t,"wordWrap",function(){return this._getCSSStyle().wordWrap},function(t){this._getCSSStyle().wordWrap=t,this.isChanged=!0}),__getset(0,t,"leading",function(){return this._getCSSStyle().leading},function(t){this._getCSSStyle().leading=t,this.isChanged=!0}),__getset(0,t,"bgColor",function(){return this._getCSSStyle().backgroundColor},function(t){this._getCSSStyle().backgroundColor=t,this.isChanged=!0}),__getset(0,t,"borderColor",function(){return this._getCSSStyle().borderColor},function(t){this._getCSSStyle().borderColor=t,this.isChanged=!0}),__getset(0,t,"stroke",function(){return this._getCSSStyle().stroke},function(t){this._getCSSStyle().stroke=t,this.isChanged=!0}),__getset(0,t,"strokeColor",function(){return this._getCSSStyle().strokeColor},function(t){this._getCSSStyle().strokeColor=t,this.isChanged=!0}),__getset(0,t,"isChanged",null,function(t){this._isChanged!==t&&(this._isChanged=t)&&Laya.timer.callLater(this,this.typeset)}),__getset(0,t,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function(t){if(!(this.overflow!=d.SCROLL||this.textWidth<this._width)&&this._clipPoint){t=t<this.padding[3]?this.padding[3]:t;var e=this._textWidth-this._width;t=e<t?e:t;var i=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=t,this.renderText(this._lastVisibleLineIndex,i)}}),__getset(0,t,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function(t){if(!(this.overflow!=d.SCROLL||this.textHeight<this._height)&&this._clipPoint){t=t<this.padding[0]?this.padding[0]:t;var e=this._textHeight-this._height,i=(t=e<t?e:t)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=i;var n=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=t,this.renderText(i,n)}}),__getset(0,t,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),__getset(0,t,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),__getset(0,t,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),__getset(0,t,"underlineColor",function(){return this._underlineColor},function(t){this._underlineColor=t,this._isChanged=!0,this.typeset()}),d.registerBitmapFont=function(t,e){d._bitmapFonts||(d._bitmapFonts={}),d._bitmapFonts[t]=e},d.unregisterBitmapFont=function(t,e){if(void 0===e&&(e=!0),d._bitmapFonts&&d._bitmapFonts[t]){var i=d._bitmapFonts[t];e&&i.destroy(),delete d._bitmapFonts[t]}},d.setTextRightToLeft=function(){var t;(t=Browser.canvas.source.style).display="none",t.position="absolute",t.direction="rtl",Render._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,Browser.document.body.appendChild(Browser.canvas.source)},d.supportFont=function(t){Browser.context.font="10px sans-serif";var e=Browser.context.measureText("abcji").width;Browser.context.font="10px "+t;var i=Browser.context.measureText("abcji").width;return console.log(e,i),e!==i},d._testWord="游",d.langPacks=null,d.VISIBLE="visible",d.SCROLL="scroll",d.HIDDEN="hidden",d.CharacterCache=!0,d.RightToLeft=!1,d._bitmapFonts=null,__static(d,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),d}(Sprite),Stage=function(c){function s(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",s.__super.call(this),this.offset=new Point,this._canvasTransform=new Matrix,this._previousOrientation=Browser.window.orientation;var e=this;this.transform=Matrix.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var t=Browser.window,i=this;t.addEventListener("focus",function(){e._isFocused=!0,i.event("focus"),i.event("focuschange")}),t.addEventListener("blur",function(){e._isFocused=!1,i.event("blur"),i.event("focuschange"),i._isInputting()&&(Input.inputElement.target.focus=!1)});var n="visibilityState",r="visibilitychange",a=t.document;void 0!==a.hidden?(r="visibilitychange",n="visibilityState"):void 0!==a.mozHidden?(r="mozvisibilitychange",n="mozVisibilityState"):void 0!==a.msHidden?(r="msvisibilitychange",n="msVisibilityState"):void 0!==a.webkitHidden&&(r="webkitvisibilitychange",n="webkitVisibilityState"),t.document.addEventListener(r,function(){"hidden"==Browser.document[n]?i._setStageVisible(!1):i._setStageVisible(!0)}),t.document.addEventListener("qbrowserVisibilityChange",function(t){i._setStageVisible(!t.hidden)}),t.addEventListener("resize",function(){var t=Browser.window.orientation;null!=t&&t!=e._previousOrientation&&i._isInputting()&&(Input.inputElement.target.focus=!1),e._previousOrientation=t,i._isInputting()||i._resetCanvas()}),t.addEventListener("orientationchange",function(t){i._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),Browser.onMobile&&this.on("mousedown",this,this._onmouseMove)}__class(s,"laya.display.Stage",c);var t=s.prototype;return t._setStageVisible=function(t){this._isVisibility!=t&&(this._isVisibility=t,this._isVisibility||this._isInputting()&&(Input.inputElement.target.focus=!1),this.event("visibilitychange"))},t._isInputting=function(){return Browser.onMobile&&Input.isInputting},t._changeCanvasSize=function(){this.setScreenSize(Browser.clientWidth*Browser.pixelRatio,Browser.clientHeight*Browser.pixelRatio)},t._resetCanvas=function(){if(this.screenAdaptationEnabled){var t=Render._mainCanvas;t.source.style;t.size(1,1),Laya.timer.once(100,this,this._changeCanvasSize)}},t.setScreenSize=function(t,e){var i=!1;if("none"!==this._screenMode&&(i=(t/e<1?"vertical":"horizontal")!==this._screenMode)){var n=e;e=t,t=n}this.canvasRotation=i;var r=Render._mainCanvas,a=r.source.style,s=this._canvasTransform.identity(),o=this._scaleMode,l=t/this.designWidth,h=e/this.designHeight,u=this.designWidth,c=this.designHeight,_=t,d=e,f=Browser.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,o){case"noscale":l=h=1,_=this.designWidth,d=this.designHeight;break;case"showall":l=h=Math.min(l,h),u=_=Math.round(this.designWidth*l),c=d=Math.round(this.designHeight*h);break;case"noborder":l=h=Math.max(l,h),_=Math.round(this.designWidth*l),d=Math.round(this.designHeight*h);break;case"full":l=h=1,this._width=u=t,this._height=c=e;break;case"fixedwidth":h=l,this._height=c=Math.round(e/l);break;case"fixedheight":l=h,this._width=u=Math.round(t/h);break;case"fixedauto":t/e<this.designWidth/this.designHeight?(h=l,this._height=c=Math.round(e/l)):(l=h,this._width=u=Math.round(t/h))}this.conchModel&&this.conchModel.size(this._width,this._height),l*=this.scaleX,h*=this.scaleY,1===l&&1===h?this.transform.identity():(this.transform.a=this._formatData(l/(_/u)),this.transform.d=this._formatData(h/(d/c)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),r.size(u,c),RunDriver.changeWebGLSize(u,c),s.scale(_/u/f,d/c/f),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=t-_:this.offset.x=.5*(t-_)/f,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=e-d:this.offset.y=.5*(e-d)/f,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),s.translate(this.offset.x,this.offset.y),this.canvasDegree=0,i&&("horizontal"===this._screenMode?(s.rotate(Math.PI/2),s.translate(e/f,0),this.canvasDegree=90):(s.rotate(-Math.PI/2),s.translate(0,t/f),this.canvasDegree=-90)),s.a=this._formatData(s.a),s.d=this._formatData(s.d),s.tx=this._formatData(s.tx),s.ty=this._formatData(s.ty),a.transformOrigin=a.webkitTransformOrigin=a.msTransformOrigin=a.mozTransformOrigin=a.oTransformOrigin="0px 0px 0px",a.transform=a.webkitTransform=a.msTransform=a.mozTransform=a.oTransform="matrix("+s.toString()+")",s.translate(parseInt(a.left)||0,parseInt(a.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},t._formatData=function(t){return Math.abs(t)<1e-6?0:Math.abs(1-t)<.001?0<t?1:-1:t},t.getMousePoint=function(){return Point.TEMP.setTo(this.mouseX,this.mouseY)},t.repaint=function(){this._repaint=1},t.parentRepaint=function(){},t._loop=function(){return this.render(Render.context,0,0),!0},t._onmouseMove=function(t){this._mouseMoveTime=Browser.now()},t.getTimeFromFrameStart=function(){return Browser.now()-this._frameStartTime},t.render=function(t,e,i){if("sleep"===this._frameRate&&!Render.isConchApp){var n=Browser.now();if(!(1e3<=n-this._frameStartTime))return;this._frameStartTime=n}if(this._renderCount++,Render.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=Browser.now();var r="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),a=this._renderCount%2==0;if(Stat.renderSlow=!r,r||a||Render.isConchApp){var s;Stat.loopCount++,MouseManager.instance.runEvent(),Laya.timer._update(),RunDriver.update3DLoop();var o=0,l=0;if(Render.isConchNode)for(o=0,l=this._scenes.length;o<l;o++)(s=this._scenes[o])&&s._updateSceneConch();else for(o=0,l=this._scenes.length;o<l;o++)(s=this._scenes[o])&&s._updateScene();if(Render.isConchNode){var h=Sprite.CustomList;for(o=0,l=h.length;o<l;o++){var u=h[o];u.customRender(u.customContext,0,0)}return}}Render.isConchNode||!this.renderingEnabled||!r&&a||(Render.isWebGL?(t.clear(),c.prototype.render.call(this,t,e,i),Stat._show&&Stat._sp&&Stat._sp.render(t,e,i),RunDriver.clear(this._bgColor),RunDriver.beginFlush(),t.flush(),RunDriver.endFinish(),VectorGraphManager.instance&&VectorGraphManager.getInstance().endDispose()):(RunDriver.clear(this._bgColor),c.prototype.render.call(this,t,e,i),Stat._show&&Stat._sp&&Stat._sp.render(t,e,i)))}else this._renderCount%5==0&&(Stat.loopCount++,MouseManager.instance.runEvent(),Laya.timer._update())},t._requestFullscreen=function(){var t=Browser.document.documentElement;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()},t._fullScreenChanged=function(){Laya.stage.event("fullscreenchange")},t.exitFullscreen=function(){var t=Browser.document;t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen&&t.webkitExitFullscreen()},__getset(0,t,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),__getset(0,t,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),__getset(0,t,"frameRate",function(){return this._frameRate},function(t){if(this._frameRate=t,Render.isConchApp)switch(this._frameRate){case"slow":Browser.window.conch&&Browser.window.conchConfig.setSlowFrame&&Browser.window.conchConfig.setSlowFrame(!0);break;case"fast":Browser.window.conch&&Browser.window.conchConfig.setSlowFrame&&Browser.window.conchConfig.setSlowFrame(!1);break;case"mouse":Browser.window.conch&&Browser.window.conchConfig.setMouseFrame&&Browser.window.conchConfig.setMouseFrame(2e3);break;case"sleep":Browser.window.conch&&Browser.window.conchConfig.setLimitFPS&&Browser.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),__getset(0,t,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),__getset(0,t,"width",c.prototype._$get_width,function(t){this.designWidth=t,Laya.superSet(Sprite,this,"width",t),Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,t,"alignH",function(){return this._alignH},function(t){this._alignH=t,Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,t,"isFocused",function(){return this._isFocused}),__getset(0,t,"height",c.prototype._$get_height,function(t){this.designHeight=t,Laya.superSet(Sprite,this,"height",t),Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,t,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||Matrix.create()},c.prototype._$set_transform),__getset(0,t,"isVisibility",function(){return this._isVisibility}),__getset(0,t,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),__getset(0,t,"scaleMode",function(){return this._scaleMode},function(t){this._scaleMode=t,Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,t,"alignV",function(){return this._alignV},function(t){this._alignV=t,Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,t,"bgColor",function(){return this._bgColor},function(t){this._bgColor=t,this.conchModel&&this.conchModel.bgColor(t),Render.isWebGL&&(t?s._wgColor=Color.create(t)._color:Browser.onMiniGame||(s._wgColor=null)),Browser.onLimixiu?s._wgColor=Color.create(t)._color:Render.canvas.style.background=t||"none"}),__getset(0,t,"mouseX",function(){return Math.round(MouseManager.instance.mouseX/this.clientScaleX)}),__getset(0,t,"mouseY",function(){return Math.round(MouseManager.instance.mouseY/this.clientScaleY)}),__getset(0,t,"screenMode",function(){return this._screenMode},function(t){this._screenMode=t}),__getset(0,t,"visible",c.prototype._$get_visible,function(t){this.visible!==t&&(Laya.superSet(Sprite,this,"visible",t),Render._mainCanvas.source.style.visibility=t?"visible":"hidden")}),__getset(0,t,"fullScreenEnabled",null,function(t){var e=Browser.document,i=Render.canvas;t?(i.addEventListener("mousedown",this._requestFullscreen),i.addEventListener("touchstart",this._requestFullscreen),e.addEventListener("fullscreenchange",this._fullScreenChanged),e.addEventListener("mozfullscreenchange",this._fullScreenChanged),e.addEventListener("webkitfullscreenchange",this._fullScreenChanged),e.addEventListener("msfullscreenchange",this._fullScreenChanged)):(i.removeEventListener("mousedown",this._requestFullscreen),i.removeEventListener("touchstart",this._requestFullscreen),e.removeEventListener("fullscreenchange",this._fullScreenChanged),e.removeEventListener("mozfullscreenchange",this._fullScreenChanged),e.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),e.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),s.SCALE_NOSCALE="noscale",s.SCALE_EXACTFIT="exactfit",s.SCALE_SHOWALL="showall",s.SCALE_NOBORDER="noborder",s.SCALE_FULL="full",s.SCALE_FIXED_WIDTH="fixedwidth",s.SCALE_FIXED_HEIGHT="fixedheight",s.SCALE_FIXED_AUTO="fixedauto",s.ALIGN_LEFT="left",s.ALIGN_RIGHT="right",s.ALIGN_CENTER="center",s.ALIGN_TOP="top",s.ALIGN_MIDDLE="middle",s.ALIGN_BOTTOM="bottom",s.SCREEN_NONE="none",s.SCREEN_HORIZONTAL="horizontal",s.SCREEN_VERTICAL="vertical",s.FRAME_FAST="fast",s.FRAME_SLOW="slow",s.FRAME_MOUSE="mouse",s.FRAME_SLEEP="sleep",s.FRAME_MOUSE_THREDHOLD=2e3,__static(s,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),s}(Sprite),SoundNode=function(t){function e(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,e.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}__class(e,"laya.media.SoundNode",Sprite);var i=e.prototype;return i._onParentChange=function(){this.target=this.parent},i.play=function(t,e){void 0===t&&(t=1),isNaN(t)&&(t=1),this.url&&(this.stop(),this._channel=SoundManager.playSound(this.url,t,e))},i.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},i._setPlayAction=function(t,e,i,n){void 0===n&&(n=!0),this[i]&&t&&(n?t.on(e,this,this[i]):t.off(e,this,this[i]))},i._setPlayActions=function(t,e,i,n){if(void 0===n&&(n=!0),t&&e){var r,a=e.split(","),s=0;for(r=a.length,s=0;s<r;s++)this._setPlayAction(t,a[s],i,n)}},__getset(0,i,"playEvent",null,function(t){(this._playEvents=t)&&this._tar&&this._setPlayActions(this._tar,t,"play")}),__getset(0,i,"target",null,function(t){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=t,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),__getset(0,i,"stopEvent",null,function(t){(this._stopEvents=t)&&this._tar&&this._setPlayActions(this._tar,t,"stop")}),e}(),FileBitmap=function(t){function e(){this._src=null,this._onload=null,this._onerror=null,e.__super.call(this)}__class(e,"laya.resource.FileBitmap",Bitmap);var i=e.prototype;return __getset(0,i,"src",function(){return this._src},function(t){this._src=t}),__getset(0,i,"onload",null,function(t){}),__getset(0,i,"onerror",null,function(t){}),e}(),HTMLCanvas=function(t){function i(t,e){this._is2D=!1,i.__super.call(this);var n=this;if(this._source=this,"2D"===t||"AUTO"===t&&!Render.isWebGL){this._is2D=!0,this._source=e||Browser.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var r=this;r.getContext=function(t,e){if(n._ctx)return n._ctx;var i=n._ctx=n._source.getContext(t,e);return i&&(i._canvas=r,Render.isFlash||Browser.onLimixiu||(i.size=function(t,e){})),i}}this.lock=!0}__class(i,"laya.resource.HTMLCanvas",Bitmap);var e=i.prototype;return e.clear=function(){this._ctx&&this._ctx.clear()},e.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},e.release=function(){},e._setContext=function(t){this._ctx=t},e.getContext=function(t,e){return this._ctx?this._ctx:this._ctx=i._createContext(this)},e.getMemSize=function(){return 0},e.size=function(t,e){(this._w!=t||this._h!=e||this._source&&(this._source.width!=t||this._source.height!=e))&&(this._w=t,this._h=e,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size(t,e),this._source&&(this._source.height=e,this._source.width=t))},e.getCanvas=function(){return this._source},e.toBase64=function(t,e,i){if(this._source)if(Render.isConchApp&&this._source.toBase64)this._source.toBase64(t,e,i);else{var n=this._source.toDataURL(t,e);i.call(this,n)}},__getset(0,e,"context",function(){return this._ctx}),__getset(0,e,"asBitmap",null,function(t){}),i.create=function(t,e){return new i(t,e)},i.TYPE2D="2D",i.TYPE3D="3D",i.TYPEAUTO="AUTO",i._createContext=null,i}(),HTMLSubImage=function(t){function l(t,e,i,n,r,a,s,o){throw l.__super.call(this),new Error("不允许new！")}return __class(l,"laya.resource.HTMLSubImage",Bitmap),l.create=function(t,e,i,n,r,a,s,o){return void 0===o&&(o=!1),new l(t,e,i,n,r,a,s,o)},l}(),Animation=function(t){function c(){this._frames=null,this._url=null,c.__super.call(this),this._setControlNode(this)}__class(c,"laya.display.Animation",t);var e=c.prototype;return e.destroy=function(t){void 0===t&&(t=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,t),this._frames=null,this._labels=null},e.play=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=""),void 0===n&&(n=!0),i&&this._setFramesFromCache(i,n),this._isPlaying=!0,this.index="string"==typeof t?this._getFrameByLabel(t):t,this.loop=e,this._actionName=i,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},e._setFramesFromCache=function(t,e){var i;return void 0===e&&(e=!1),this._url&&(t=this._url+"#"+t),t&&c.framesMap[t]?((i=c.framesMap[t])instanceof Array?(this._frames=c.framesMap[t],this._count=this._frames.length):(i.nodeRoot&&(c.framesMap[t]=this._parseGraphicAnimationByData(i),i=c.framesMap[t]),this._frames=i.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=i.interval),this._labels=this._copyLabels(i.labels)),!0):(e&&console.log("ani not found:",t),!1)},e._copyLabels=function(t){if(!t)return null;var e,i;for(i in e={},t)e[i]=Utils.copyArray([],t[i]);return e},e._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&t.prototype._frameLoop.call(this)},e._displayToIndex=function(t){this._frames&&(this.graphics=this._frames[t])},e.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},e.loadImages=function(t,e){return void 0===e&&(e=""),this._url="",this._setFramesFromCache(e)||(this.frames=c.framesMap[e]?c.framesMap[e]:c.createFrames(t,e)),this},e.loadAtlas=function(e,i,n){void 0===n&&(n=""),this._url="";var r=this;function t(t){e===t&&(r.frames=c.framesMap[n]?c.framesMap[n]:c.createFrames(e,n),i&&i.run())}return r._setFramesFromCache(n)||(Loader.getAtlas(e)?t(e):Laya.loader.load(e,Handler.create(null,t,[e]),null,"atlas")),this},e.loadAnimation=function(t,e,i){this._url=t;return this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,e&&e.run()):!i||Loader.getAtlas(i)?this._loadAnimationData(t,e,i):Laya.loader.load(i,Handler.create(this,this._loadAnimationData,[t,e,i]),null,"atlas"),this},e._loadAnimationData=function(o,l,t){var h=this;if(!t||Loader.getAtlas(t)){var u=this;Loader.getRes(o)?e(o):Laya.loader.load(o,Handler.create(null,e,[o]),null,"json"),Loader.clearRes(o)}else console.warn("atlas load fail:"+t);function e(t){if(Loader.getRes(t)&&o===t){var e;if(c.framesMap[o+"#"])u._setFramesFromCache(h._actionName,!0),h.index=0,h._checkResumePlaying();else{var i=u._parseGraphicAnimation(Loader.getRes(o));if(!i)return;var n,r=i.animationList,a=0,s=r.length;for(a=0;a<s;a++)e=r[a],c.framesMap[o+"#"+e.name]=e,n||(n=e);n&&(c.framesMap[o+"#"]=n,u._setFramesFromCache(h._actionName,!0),h.index=0),h._checkResumePlaying()}l&&l.run()}}},e._parseGraphicAnimation=function(t){return GraphicAnimation.parseAnimationData(t)},e._parseGraphicAnimationByData=function(t){return GraphicAnimation.parseAnimationByData(t)},__getset(0,e,"frames",function(){return this._frames},function(t){(this._frames=t)&&(this._count=t.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),__getset(0,e,"autoPlay",null,function(t){t?this.play():this.stop()}),__getset(0,e,"source",null,function(t){-1<t.indexOf(".ani")?this.loadAnimation(t):-1<t.indexOf(".json")||-1<t.indexOf("als")||-1<t.indexOf("atlas")?this.loadAtlas(t):this.loadImages(t.split(","))}),__getset(0,e,"autoAnimation",null,function(t){this.play(0,!0,t,!1)}),c.createFrames=function(t,e){var i,n,r=0,a=0;if("string"==typeof t){var s=Loader.getAtlas(t);if(s&&s.length)for(i=[],r=0,a=s.length;r<a;r++)(n=new RunDriver.createGraphics).drawTexture(Loader.getRes(s[r]),0,0),i.push(n)}else if(t instanceof Array)for(i=[],r=0,a=t.length;r<a;r++)(n=new RunDriver.createGraphics).loadImage(t[r],0,0),i.push(n);return e&&(c.framesMap[e]=i),i},c.clearCache=function(t){var e,i=c.framesMap,n=t+"#";for(e in i)e!==t&&0!=e.indexOf(n)||delete c.framesMap[e]},c.framesMap={},c}(AnimationPlayerBase),FrameAnimation=function(t){function a(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,a.__super.call(this),null==a._sortIndexFun&&(a._sortIndexFun=MathUtil.sortByKey("index",!1,!0))}__class(a,"laya.display.FrameAnimation",t);var e=a.prototype;return e._setUp=function(t,e){this._labels=null,this._animationNewFrames=null,this._targetDic=t,this._animationData=e,this.interval=1e3/e.frameRate,e.parsed?(this._count=e.count,this._labels=e.labels,this._animationNewFrames=e.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),e.parsed=!0,e.labels=this._labels,e.count=this._count,e.animationNewFrames=this._animationNewFrames},e.clear=function(){t.prototype.clear.call(this),this._targetDic=null,this._animationData=null},e._displayToIndex=function(t){if(this._animationData){t<0&&(t=0),t>this._count&&(t=this._count);var e=this._animationData.nodes,i=0,n=e.length;for(i=0;i<n;i++)this._displayNodeToFrame(e[i],t)}},e._displayNodeToFrame=function(t,e,i){i||(i=this._targetDic);var n=i[t.target];if(n){var r,a,s,o=t.frames,l=t.keys,h=0,u=l.length;for(h=0;h<u;h++)s=(a=o[r=l[h]]).length>e?a[e]:a[a.length-1],n[r]=s}},e._calculateDatas=function(){if(this._animationData){var t,e=this._animationData.nodes,i=0,n=e.length;for(i=this._count=0;i<n;i++)t=e[i],this._calculateNodeKeyFrames(t);this._count+=1}},e._calculateNodeKeyFrames=function(t){var e,i,n=t.keyframes,r=t.target;for(e in t.frames||(t.frames={}),t.keys?t.keys.length=0:t.keys=[],t.initValues||(t.initValues={}),n)i=n[e],t.frames[e]||(t.frames[e]=[]),this._targetDic&&this._targetDic[r]&&(t.initValues[e]=this._targetDic[r][e]),i.sort(a._sortIndexFun),t.keys.push(e),this._calculateNodePropFrames(i,t.frames[e],e,r)},e.resetToInitState=function(){if(this._targetDic&&this._animationData){var t,e,i=this._animationData.nodes,n=0,r=i.length;for(n=0;n<r;n++)if(e=(t=i[n]).initValues){var a,s=this._targetDic[t.target];if(s)for(a in e)s[a]=e[a]}}},e._calculateNodePropFrames=function(t,e,i,n){var r=0,a=t.length-1;for(e.length=t[a].index+1,r=0;r<a;r++)this._dealKeyFrame(t[r]),this._calculateFrameValues(t[r],t[r+1],e);0==a&&(e[0]=t[0].value,this._animationNewFrames&&(this._animationNewFrames[t[0].index]=!0)),this._dealKeyFrame(t[r])},e._dealKeyFrame=function(t){t.label&&""!=t.label&&this.addLabel(t.label,t.index)},e._calculateFrameValues=function(t,e,i){var n,r=0,a=t.index,s=e.index,o=t.value,l=e.value-t.value,h=s-a;if(s>this._count&&(this._count=s),t.tween)for(null==(n=Ease[t.tweenMethod])&&(n=Ease.linearNone),r=a;r<s;r++)i[r]=n(r-a,o,l,h),this._animationNewFrames&&(this._animationNewFrames[r]=!0);else for(r=a;r<s;r++)i[r]=o;this._animationNewFrames&&(this._animationNewFrames[t.index]=!0,this._animationNewFrames[e.index]=!0),i[e.index]=e.value},a._sortIndexFun=null,a}(AnimationPlayerBase),Input=function(e){function r(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",r.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=Text.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}__class(r,"laya.display.Input",e);var t=r.prototype;return t.setSelection=function(t,e){this.focus=!0,laya.display.Input.inputElement.selectionStart=t,laya.display.Input.inputElement.selectionEnd=e},t._onUnDisplay=function(t){this.focus=!1},t._onMouseDown=function(t){this.focus=!0},t._syncInputTransform=function(){var t=this.nativeInput,e=Utils.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),i=this._width-this.padding[1]-this.padding[3],n=this._height-this.padding[0]-this.padding[2];Render.isConchApp?(t.setScale(e.scaleX,e.scaleY),t.setSize(i,n),t.setPos(e.x,e.y)):(r.inputContainer.style.transform=r.inputContainer.style.webkitTransform="scale("+e.scaleX+","+e.scaleY+") rotate("+Laya.stage.canvasDegree+"deg)",t.style.width=i+"px",t.style.height=n+"px",r.inputContainer.style.left=e.x+"px",r.inputContainer.style.top=e.y+"px")},t.select=function(){this.nativeInput.select()},t._setInputMethod=function(){r.input.parentElement&&r.inputContainer.removeChild(r.input),r.area.parentElement&&r.inputContainer.removeChild(r.area),r.inputElement=this._multiline?r.area:r.input,r.inputContainer.appendChild(r.inputElement),Text.RightToLeft&&(r.inputElement.style.direction="rtl")},t._focusIn=function(){laya.display.Input.isInputting=!0;var t=this.nativeInput;this._focus=!0;var e=t.style;e.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),t.readOnly=!this._editable,Render.isConchApp&&(t.setType(this._type),t.setForbidEdit(!this._editable)),t.maxLength=this._maxChars;this.padding;if(t.type=this._type,t.value=this._content,t.placeholder=this._prompt,Laya.stage.off("keydown",this,this._onKeyDown),Laya.stage.on("keydown",this,this._onKeyDown),(Laya.stage.focus=this).event("focus"),Browser.onPC&&t.focus(),!Browser.onMiniGame){this._text;this._text=null}this.typeset(),t.setColor(this._originColor),t.setFontSize(this.fontSize),t.setFontFace(Browser.onIPhone&&Text._fontFamilyMap[this.font]||this.font),Render.isConchApp&&t.setMultiAble&&t.setMultiAble(this._multiline),e.lineHeight=this.leading+this.fontSize+"px",e.fontStyle=this.italic?"italic":"normal",e.fontWeight=this.bold?"bold":"normal",e.textAlign=this.align,e.padding="0 0",this._syncInputTransform(),!Render.isConchApp&&Browser.onPC&&Laya.timer.frameLoop(1,this,this._syncInputTransform)},t._setPromptColor=function(){(r.promptStyleDOM=Browser.getElementById("promptStyle"))||((r.promptStyleDOM=Browser.createElement("style")).setAttribute("id","promptStyle"),Browser.document.head.appendChild(r.promptStyleDOM)),r.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},t._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(Laya.superSet(Text,this,"text",this._content),Laya.superSet(Text,this,"color",this._originColor)):(Laya.superSet(Text,this,"text",this._prompt),Laya.superSet(Text,this,"color",this._promptColor)),Laya.stage.off("keydown",this,this._onKeyDown),Laya.stage.focus=null,this.event("blur"),Render.isConchApp&&this.nativeInput.blur(),Browser.onPC&&Laya.timer.clear(this,this._syncInputTransform)},t._onKeyDown=function(t){13===t.keyCode&&(Browser.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},t.changeText=function(t){this._content=t,this._focus?(this.nativeInput.value=t||"",this.event("change")):e.prototype.changeText.call(this,t)},__getset(0,t,"color",e.prototype._$get_color,function(t){this._focus&&this.nativeInput.setColor(t),Laya.superSet(Text,this,"color",this._content?t:this._promptColor),this._originColor=t}),__getset(0,t,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function(t){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),__getset(0,t,"multiline",function(){return this._multiline},function(t){this._multiline=t,this.valign=t?"top":"middle"}),__getset(0,t,"maxChars",function(){return this._maxChars},function(t){t<=0&&(t=1e5),this._maxChars=t}),__getset(0,t,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function(t){Laya.superSet(Text,this,"color",this._originColor),t+="",this._focus?(this.nativeInput.value=t||"",this.event("change")):(this._multiline||(t=t.replace(/\r?\n/g,"")),(this._content=t)?Laya.superSet(Text,this,"text",t):(Laya.superSet(Text,this,"text",this._prompt),Laya.superSet(Text,this,"color",this.promptColor)))}),__getset(0,t,"nativeInput",function(){return this._multiline?r.area:r.input}),__getset(0,t,"prompt",function(){return this._prompt},function(t){!this._text&&t&&Laya.superSet(Text,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?Laya.superSet(Text,this,"text",this._text==this._prompt?t:this._text):Laya.superSet(Text,this,"text",t),this._prompt=Text.langPacks&&Text.langPacks[t]?Text.langPacks[t]:t}),__getset(0,t,"focus",function(){return this._focus},function(t){var e=this.nativeInput;this._focus!==t&&(t?(e.target?e.target._focusOut():this._setInputMethod(),(e.target=this)._focusIn()):(e.target=null,this._focusOut(),Browser.document.body.scrollTop=0,e.blur(),Render.isConchApp?e.setPos(-1e4,-1e4):r.inputContainer.contains(e)&&r.inputContainer.removeChild(e)))}),__getset(0,t,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function(t){this._restrictPattern=t?(-1<(t="[^"+t+"]").indexOf("^^")&&(t=t.replace("^^","")),new RegExp(t,"g")):null}),__getset(0,t,"editable",function(){return this._editable},function(t){this._editable=t,Render.isConchApp&&r.input.setForbidEdit(!t)}),__getset(0,t,"promptColor",function(){return this._promptColor},function(t){this._promptColor=t,this._content||Laya.superSet(Text,this,"color",t)}),__getset(0,t,"type",function(){return this._type},function(t){this._getCSSStyle().password="password"==t,this._type=t,Render.isConchApp&&this.nativeInput.setType(t)}),__getset(0,t,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function(t){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),__getset(0,t,"asPassword",function(){return this._getCSSStyle().password},function(t){this._getCSSStyle().password=t,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),r.__init__=function(){r._createInputElement(),Browser.onMobile&&Render.canvas.addEventListener(r.IOS_IFRAME?Browser.onMiniGame?"touchend":"click":"touchend",r._popupInputMethod)},r._popupInputMethod=function(t){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},r._createInputElement=function(){r._initInput(r.area=Browser.createElement("textarea")),r._initInput(r.input=Browser.createElement("input")),(r.inputContainer=Browser.createElement("div")).style.position="absolute",r.inputContainer.style.zIndex=1e5,Browser.container.appendChild(r.inputContainer),r.inputContainer.setPos=function(t,e){r.inputContainer.style.left=t+"px",r.inputContainer.style.top=e+"px"}},r._initInput=function(e){var t=e.style;t.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",t.resize="none",t.backgroundColor="transparent",t.border="none",t.outline="none",t.zIndex=1,e.addEventListener("input",r._processInputting),e.addEventListener("mousemove",r._stopEvent),e.addEventListener("mousedown",r._stopEvent),e.addEventListener("touchmove",r._stopEvent),e.setFontFace=function(t){e.style.fontFamily=t},Render.isConchApp||(e.setColor=function(t){e.style.color=t},e.setFontSize=function(t){e.style.fontSize=t+"px"})},r._processInputting=function(t){var e=laya.display.Input.inputElement.target;if(e){var i=laya.display.Input.inputElement.value;e._restrictPattern&&(i=i.replace(/\u2006|\x27/g,""),e._restrictPattern.test(i)&&(i=i.replace(e._restrictPattern,""),laya.display.Input.inputElement.value=i)),e._text=i,e.event("input")}},r._stopEvent=function(t){"touchmove"==t.type&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},r.TYPE_TEXT="text",r.TYPE_PASSWORD="password",r.TYPE_EMAIL="email",r.TYPE_URL="url",r.TYPE_NUMBER="number",r.TYPE_RANGE="range",r.TYPE_DATE="date",r.TYPE_MONTH="month",r.TYPE_WEEK="week",r.TYPE_TIME="time",r.TYPE_DATE_TIME="datetime",r.TYPE_DATE_TIME_LOCAL="datetime-local",r.TYPE_SEARCH="search",r.input=null,r.area=null,r.inputElement=null,r.inputContainer=null,r.confirmButton=null,r.promptStyleDOM=null,r.inputHeight=45,r.isInputting=!1,r.stageMatrix=null,__static(r,["IOS_IFRAME",function(){return this.IOS_IFRAME=Browser.onIOS&&Browser.window.top!=Browser.window.self}]),r}(Text),HTMLImage=function(t){function i(t,e){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,i.__super.call(this),this._init_(t,e)}__class(i,"laya.resource.HTMLImage",FileBitmap);var e=i.prototype;return e._init_=function(t,e){this._src=t,this._source=new Browser.window.Image,e&&(e.onload&&(this.onload=e.onload),e.onerror&&(this.onerror=e.onerror),e.onCreate&&e.onCreate(this)),0!=t.indexOf("data:image")&&(this._source.crossOrigin=""),t&&(this._source.src=t)},e.recreateResource=function(){var t=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var e=this;this._source=new Browser.window.Image,this._source.crossOrigin="",this._source.onload=function(){if(e._needReleaseAgain)return e._needReleaseAgain=!1,e._source.onload=null,void(e._source=null);e._source.onload=null,e.memorySize=t._w*t._h*4,e._recreateLock=!1,e.completeCreate()},this._source.src=this._src}},e.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},e.onresize=function(){this._w=this._source.width,this._h=this._source.height},__getset(0,e,"onload",null,function(t){var e=this;this._onload=t,this._source&&(this._source.onload=null!=this._onload?function(){e.onresize(),e._onload()}:null)}),__getset(0,e,"onerror",null,function(t){var e=this;this._onerror=t,this._source&&(this._source.onerror=null!=this._onerror?function(){e._onerror()}:null)}),__getset(0,e,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(t){this._enableMerageInAtlas=t,Render.isConchApp&&this._source&&(this._source.enableMerageInAtlas=t)}),i.create=function(t,e){return new i(t,e)},i}(),EffectAnimation=function(a){function t(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,t.__super.call(this)}__class(t,"laya.display.EffectAnimation",a);var e=t.prototype;return e._onOtherBegin=function(t){t!=this&&this.stop()},e.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},e._onPlayAction=function(){this.play(0,!1)},e.play=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=""),void 0===n&&(n=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,t,e,i,n))},e._recordInitData=function(){if(this._aniKeys){var t,e,i=0;for(t=this._aniKeys.length,i=0;i<t;i++)e=this._aniKeys[i],this._initData[e]=this._target[e]}},e._displayToIndex=function(t){if(this._animationData){t<0&&(t=0),t>this._count&&(t=this._count);var e=this._animationData.nodes,i=0,n=e.length;for(n=1<n?1:n,i=0;i<n;i++)this._displayNodeToFrame(e[i],t)}},e._displayNodeToFrame=function(t,e,i){if(this._target){var n;n=this._target;var r,a,s,o,l=t.frames,h=t.keys,u=0,c=h.length;o=t.secondFrames;var _,d,f,p,m=0;for(u=0;u<c;u++)a=l[r=h[u]],s=-1==(m=o[r])?this._initData[r]:e<m?(f=(d=t.keyframes[r])[0]).tween?(null==(_=Ease[f.tweenMethod])&&(_=Ease.linearNone),p=d[1],_(e,this._initData[r],p.value-this._initData[r],p.index)):this._initData[r]:a.length>e?a[e]:a[a.length-1],n[r]=s}},e._calculateNodeKeyFrames=function(t){a.prototype._calculateNodeKeyFrames.call(this,t);var e,i,n,r=t.keyframes;t.target;for(e in n={},t.secondFrames=n,r)(i=r[e]).length<=1?n[e]=-1:n[e]=i[1].index},__getset(0,e,"target",function(){return this._target},function(t){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=t,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),__getset(0,e,"playEvent",null,function(t){(this._playEvents=t)&&this.addEvent()}),__getset(0,e,"effectData",null,function(t){var e;t&&((e=t.animations)&&e[0]&&(this._setUp({},e[0]),e[0].nodes&&e[0].nodes[0]&&(this._aniKeys=e[0].nodes[0].keys)))}),__getset(0,e,"effectClass",null,function(t){var e,i;(this._effectClass=ClassUtils.getClass(t),this._effectClass)&&((e=this._effectClass.uiView)&&(i=e.animations)&&i[0]&&(this._setUp({},i[0]),i[0].nodes&&i[0].nodes[0]&&(this._aniKeys=i[0].nodes[0].keys)))}),t.EffectAnimationBegin="effectanimationbegin",t}(FrameAnimation),GraphicAnimation=function(e){var I;function b(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,b.__super.call(this)}__class(b,"laya.utils.GraphicAnimation",e);var t=b.prototype;return t._parseNodeList=function(t){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[t.compId]=t.props,t.compId&&this._nodeList.push(t.compId);var e=t.child;if(e){var i=0,n=e.length;for(i=0;i<n;i++)this._parseNodeList(e[i])}},t._calGraphicData=function(t){var e;if(this._setUp(null,t),this._createGraphicData(),this._nodeIDAniDic)for(e in this._nodeIDAniDic)this._nodeIDAniDic[e]=null},t._createGraphicData=function(){var t,e=[],i=0,n=this.count,r=this._animationNewFrames;for(r||(r=[]),i=0;i<n;i++)!r[i]&&t||(t=this._createFrameGraphic(i)),e.push(t);this._gList=e},t._createFrameGraphic=function(t){var e=RunDriver.createGraphics();return b._rootMatrix||(b._rootMatrix=new Matrix),this._updateNodeGraphic(this._rootNode,t,b._rootMatrix,e),e},t._updateNodeGraphic=function(t,e,i,n,r){var a;void 0===r&&(r=1);var s,o,l,h=(a=this._nodeGDic[t.compId]=this._getNodeGraphicData(t.compId,e,this._nodeGDic[t.compId])).alpha*r;if(!(h<.01)&&(a.resultTransform||(a.resultTransform=Matrix.create()),s=a.resultTransform,Matrix.mul(a.transform,i,s),a.skin&&(o=this._getTextureByUrl(a.skin))&&(s._checkTransform()?(n.drawTexture(o,0,0,a.width,a.height,s,h),a.resultTransform=null):n.drawTexture(o,s.tx,s.ty,a.width,a.height,null,h)),l=t.child)){var u,c=0;for(u=l.length,c=0;c<u;c++)this._updateNodeGraphic(l[c],e,s,n,h)}},t._updateNoChilds=function(t,e){if(t.skin){var i=this._getTextureByUrl(t.skin);if(i){var n=t.transform;n._checkTransform();!n.bTransform?e.drawTexture(i,n.tx,n.ty,t.width,t.height,null,t.alpha):e.drawTexture(i,0,0,t.width,t.height,n.clone(),t.alpha)}}},t._updateNodeGraphic2=function(t,e,i){var n;if(n=this._nodeGDic[t.compId]=this._getNodeGraphicData(t.compId,e,this._nodeGDic[t.compId]),t.child){var r=n.transform;r._checkTransform();var a,s;s=(a=!r.bTransform)&&(0!=r.tx||0!=r.ty);var o,l,h;if((o=r.bTransform||1!=n.alpha)&&i.save(),1!=n.alpha&&i.alpha(n.alpha),a?s&&i.translate(r.tx,r.ty):i.transform(r.clone()),l=t.child,n.skin&&(h=this._getTextureByUrl(n.skin))&&i.drawTexture(h,0,0,n.width,n.height),l){var u,c=0;for(u=l.length,c=0;c<u;c++)this._updateNodeGraphic2(l[c],e,i)}o?i.restore():a?s&&i.translate(-r.tx,-r.ty):i.transform(r.clone().invert())}else this._updateNoChilds(n,i)},t._calculateNodeKeyFrames=function(t){e.prototype._calculateNodeKeyFrames.call(this,t),this._nodeIDAniDic[t.target]=t},t.getNodeDataByID=function(t){return this._nodeIDAniDic[t]},t._getParams=function(t,e,i,n){var r=b._temParam;r.length=e.length;var a=0,s=e.length;for(a=0;a<s;a++)r[a]=this._getObjVar(t,e[a][0],i,e[a][1],n);return r},t._getObjVar=function(t,e,i,n,r){if(t.hasOwnProperty(e)){var a=t[e];return i>=a.length&&(i=a.length-1),t[e][i]}return r.hasOwnProperty(e)?r[e]:n},t._getNodeGraphicData=function(t,e,i){i||(i=I.create()),i.transform?i.transform.identity():i.transform=Matrix.create();var n=this.getNodeDataByID(t);if(!n)return i;var r,a,s=n.frames,o=this._getParams(s,b._drawTextureCmd,e,this._nodeDefaultProps[t]),l=o[0],h=NaN,u=NaN,c=o[5],_=o[6],d=o[13],f=o[14],p=o[7],m=o[8],g=o[9],v=o[11],y=o[12];h=o[3],u=o[4],0!=h&&0!=u||(l=null),-1==h&&(h=0),-1==u&&(u=0),i.skin=l,i.width=h,i.height=u,l&&((r=this._getTextureByUrl(l))?(h||(h=r.sourceWidth),u||(u=r.sourceHeight)):console.warn("lost skin:",l,",you may load pics first")),i.alpha=o[10],a=i.transform,0!=d&&(c=d*h),0!=f&&(_=f*u),0==c&&0==_||a.translate(-c,-_);var x=null;if(g||1!==p||1!==m||v||y){(x=b._tempMt).identity(),x.bTransform=!0;var E=.0174532922222222*(g-v),T=.0174532922222222*(g+y),S=Math.cos(T),w=Math.sin(T),M=Math.sin(E),D=Math.cos(E);x.a=p*S,x.b=p*w,x.c=-m*M,x.d=m*D,x.tx=x.ty=0}return x&&(a=Matrix.mul(a,x,a)),a.translate(o[1],o[2]),i},t._getTextureByUrl=function(t){return Loader.getRes(t)},t.setAniData=function(t,e){if(t.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=t,this._parseNodeList(t);var i,n={},r=[],a=t.animations,s=0,o=a.length;for(s=0;s<o;s++)if(i=a[s],this._labels=null,(!e||e==i.name)&&i){try{this._calGraphicData(i)}catch(t){console.warn("parse animation fail:"+i.name+",empty animation created"),this._gList=[]}var l={};l.interval=1e3/i.frameRate,l.frames=this._gList,l.labels=this._labels,l.name=i.name,r.push(l),n[i.name]=l}this.animationList=r,this.animationDic=n}b._temParam.length=0},t.parseByData=function(t){var e,i;e=t.nodeRoot,i=t.aniO,delete t.nodeRoot,delete t.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=e,this._parseNodeList(e),this._labels=null;try{this._calGraphicData(i)}catch(t){console.warn("parse animation fail:"+i.name+",empty animation created"),this._gList=[]}var n=t;return n.interval=1e3/i.frameRate,n.frames=this._gList,n.labels=this._labels,n.name=i.name,n},t.setUpAniData=function(t){if(t.animations){var e,i={},n=[],r=t.animations,a=0,s=r.length;for(a=0;a<s;a++)if(e=r[a]){var o={};o.name=e.name,o.aniO=e,o.nodeRoot=t,n.push(o),i[e.name]=o}this.animationList=n,this.animationDic=i}},t._clear=function(){var t,e;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for(t in this._nodeGDic)(e=this._nodeGDic[t])&&e.recover();this._nodeGDic=null},b.parseAnimationByData=function(t){var e;return b._I||(b._I=new b),e=b._I.parseByData(t),b._I._clear(),e},b.parseAnimationData=function(t){var e;return b._I||(b._I=new b),b._I.setUpAniData(t),(e={}).animationList=b._I.animationList,e.animationDic=b._I.animationDic,b._I._clear(),e},b._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],b._temParam=[],b._I=null,b._rootMatrix=null,__static(b,["_tempMt",function(){return this._tempMt=new Matrix}]),b.__init$=function(){I=function(){function t(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return __class(t,""),t.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),Pool.recover("GraphicNode",this)},t.create=function(){return Pool.getItemByClass("GraphicNode",t)},t}()},b}(FrameAnimation);Laya.__init([EventDispatcher,LoaderManager,Render,Browser,Timer,LocalStorage,TimeLine,GraphicAnimation])}(window,document,Laya),function(t,e,i){i.un,i.uns,i.static;var n=i.class;i.getset,i.__newvec;new(function(){function t(){}return n(t,"LayaMain"),t}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}),function(r,t,a){a.un,a.uns;var e=a.static,s=a.class,n=a.getset,u=(a.__newvec,laya.utils.Browser),i=(laya.events.Event,laya.events.EventDispatcher),c=laya.resource.HTMLImage,_=laya.utils.Handler,o=laya.display.Input,d=laya.net.Loader,l=laya.net.LocalStorage,h=(laya.maths.Matrix,laya.renders.Render),f=laya.utils.RunDriver,p=laya.media.SoundChannel,m=laya.media.SoundManager,g=laya.net.URL,v=laya.utils.Utils,y=function(){function n(){}return s(n,"laya.wx.mini.MiniAdpter"),n.getJson=function(t){return JSON.parse(t)},n.init=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1),n._inited||(n._inited=!0,(n.window=r).navigator.userAgent.indexOf("MiniGame")<0||(n.isZiYu=e,n.isPosMsgYu=t,n.EnvConfig={},n.isZiYu||(x.setNativeFileDir("/layaairGame"),x.existDir(x.fileNativeDir,_.create(n,n.onMkdirCallBack))),n.systemInfo=wx.getSystemInfoSync(),n.window.focus=function(){},a.getUrlPath=function(){},n.window.logtime=function(t){},n.window.alertTimeLog=function(t){},n.window.resetShareInfo=function(){},n.window.CanvasRenderingContext2D=function(){},n.window.CanvasRenderingContext2D.prototype=n.window.wx.createCanvas().getContext("2d").__proto__,n.window.document.body.appendChild=function(){},n.EnvConfig.pixelRatioInt=0,f.getPixelRatio=n.pixelRatio,n._preCreateElement=u.createElement,u.createElement=n.createElement,f.createShaderCondition=n.createShaderCondition,v.parseXMLFromString=n.parseXMLFromString,o._createInputElement=T._createInputElement,n.EnvConfig.load=d.prototype.load,d.prototype.load=w.prototype.load,d.prototype._loadImage=E.prototype._loadImage,S.__init__(),l._baseClass=S))},n.getUrlEncode=function(t,e){return-1!=t.indexOf(".fnt")?"utf8":"arraybuffer"==e?"":"ascii"},n.downLoadFile=function(t,e,i,n){void 0===e&&(e=""),void 0===n&&(n="ascii"),x.getFileInfo(t)?null!=i&&i.runWith([0]):x.downLoadFile(t,e,i,n)},n.remove=function(t,e){x.deleteFile("",t,e,"",0)},n.removeAll=function(){x.deleteAll()},n.hasNativeFile=function(t){return x.isLocalNativeFile(t)},n.getFileInfo=function(t){return x.getFileInfo(t)},n.getFileList=function(){return x.filesListObj},n.exitMiniProgram=function(){n.window.wx.exitMiniProgram()},n.onMkdirCallBack=function(t,e){t||(x.filesListObj=JSON.parse(e.data))},n.pixelRatio=function(){if(!n.EnvConfig.pixelRatioInt)try{return n.EnvConfig.pixelRatioInt=n.systemInfo.pixelRatio,n.systemInfo.pixelRatio}catch(t){}return n.EnvConfig.pixelRatioInt},n.createElement=function(t){var e;if("canvas"==t)return 1==n.idx?n.isZiYu?(e=sharedCanvas).style={}:e=r.canvas:e=r.wx.createCanvas(),n.idx++,e;if("textarea"==t||"input"==t)return n.onCreateInput(t);if("div"!=t)return n._preCreateElement(t);var i=n._preCreateElement(t);return i.contains=function(t){return null},i.removeChild=function(t){},i},n.onCreateInput=function(t){var e=n._preCreateElement(t);return e.focus=T.wxinputFocus,e.blur=T.wxinputblur,e.style={},e.value=0,e.parentElement={},e.placeholder={},e.type={},e.setColor=function(t){},e.setType=function(t){},e.setFontFace=function(t){},e.addEventListener=function(t){},e.contains=function(t){return null},e.removeChild=function(t){},e},n.createShaderCondition=function(t){var e=this;return function(){return e[t.replace("this.","")]}},n.EnvConfig=null,n.window=null,n._preCreateElement=null,n._inited=!1,n.systemInfo=null,n.isZiYu=!1,n.isPosMsgYu=!1,n.autoCacheFile=!0,n.minClearSize=5242880,n.parseXMLFromString=function(t){var e;t=t.replace(/>\s+</g,"><");try{e=(new r.Parser.DOMParser).parseFromString(t,"text/xml")}catch(t){throw"需要引入xml解析库文件"}return e},n.idx=1,e(n,["nativefiles",function(){return this.nativefiles=["layaNativeDir","wxlocal"]}]),n}(),x=function(){function h(){}return s(h,"laya.wx.mini.MiniFileMgr"),h.isLocalNativeFile=function(t){for(var e=0,i=y.nativefiles.length;e<i;e++)if(-1!=t.indexOf(y.nativefiles[e]))return!0;return!1},h.getFileInfo=function(t){var e=t.split("?")[0],i=h.filesListObj[e];return null==i?null:i},h.read=function(t,e,i,n,r,a){var s;void 0===e&&(e="ascill"),void 0===n&&(n=""),void 0===r&&(r=!1),void 0===a&&(a=""),s=""==n||-1==n.indexOf("http://")&&-1==n.indexOf("https://")?t:h.getFileNativePath(t),h.fs.readFile({filePath:s,encoding:e,success:function(t){null!=i&&i.runWith([0,t])},fail:function(t){t&&""!=n?h.downFiles(n,e,i,n,r,a):null!=i&&i.runWith([1])}})},h.downFiles=function(t,e,i,n,r,a){void 0===e&&(e="ascii"),void 0===n&&(n=""),void 0===r&&(r=!1),void 0===a&&(a=""),h.wxdown({url:t,success:function(t){200===t.statusCode&&h.readFile(t.tempFilePath,e,i,n,r,a)},fail:function(t){null!=i&&i.runWith([1,t])}}).onProgressUpdate(function(t){null!=i&&i.runWith([2,t.progress])})},h.readFile=function(e,i,n,r,a,t){void 0===i&&(i="ascill"),void 0===r&&(r=""),void 0===a&&(a=!1),void 0===t&&(t=""),h.fs.readFile({filePath:e,encoding:i,success:function(t){-1!=e.indexOf("http://")||-1!=e.indexOf("https://")?(y.autoCacheFile||a)&&h.copyFile(e,r,n,i):null!=n&&n.runWith([0,t])},fail:function(t){t&&null!=n&&n.runWith([1,t])}})},h.downOtherFiles=function(t,e,i,n){void 0===i&&(i=""),void 0===n&&(n=!1),h.wxdown({url:t,success:function(t){200===t.statusCode&&((y.autoCacheFile||n)&&-1==i.indexOf("wx.qlogo.cn")?h.copyFile(t.tempFilePath,i,e):null!=e&&e.runWith([0,t.tempFilePath]))},fail:function(t){null!=e&&e.runWith([1,t])}})},h.downLoadFile=function(t,e,i,n){void 0===e&&(e=""),void 0===n&&(n="ascii"),"image"==e||"sound"==e?h.downOtherFiles(t,i,t,!0):h.downFiles(t,n,i,t,!0,e)},h.copyFile=function(t,i,n,r){void 0===r&&(r="");var e=t.split("/"),a=e[e.length-1],s=(i.split("?")[0],h.getFileInfo(i)),o=h.getFileNativePath(a),l=h.getCacheUseSize();s?s.readyUrl!=i?h.fs.getFileInfo({filePath:t,success:function(t){52428800<=l+4194304+t.size&&(t.size>y.minClearSize&&(y.minClearSize=t.size),h.onClearCacheRes()),h.deleteFile(a,i,n,r,t.size)},fail:function(t){null!=n&&n.runWith([1,t])}}):null!=n&&n.runWith([0]):h.fs.getFileInfo({filePath:t,success:function(e){52428800<=l+4194304+e.size&&(e.size>y.minClearSize&&(y.minClearSize=e.size),h.onClearCacheRes()),h.fs.copyFile({srcPath:t,destPath:o,success:function(t){h.onSaveFile(i,a,!0,r,n,e.size)},fail:function(t){null!=n&&n.runWith([1,t])}})},fail:function(t){null!=n&&n.runWith([1,t])}})},h.onClearCacheRes=function(){var t=y.minClearSize,e=[];for(var i in h.filesListObj)e.push(h.filesListObj[i]);h.sortOn(e,"time",16);for(var n=0,r=1,a=e.length;r<a;r++){var s=e[r];if(t<=n)break;n+=s.size,h.deleteFile("",s.readyUrl)}},h.sortOn=function(t,i,e){return void 0===e&&(e=0),16==e?t.sort(function(t,e){return t[i]-e[i]}):18==e?t.sort(function(t,e){return e[i]-t[i]}):t.sort(function(t,e){return t[i]-e[i]})},h.getFileNativePath=function(t){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+t},h.deleteFile=function(n,r,a,s,o){void 0===r&&(r=""),void 0===s&&(s=""),void 0===o&&(o=0);var t=h.getFileInfo(r),e=h.getFileNativePath(t.md5);h.fs.unlink({filePath:e,success:function(t){var e=""!=n;if(""!=n){var i=h.getFileNativePath(n);h.fs.copyFile({srcPath:n,destPath:i,success:function(t){h.onSaveFile(r,n,e,s,a,t.size)},fail:function(t){null!=a&&a.runWith([1,t])}})}else h.onSaveFile(r,n,e,s,a,o)},fail:function(t){}})},h.deleteAll=function(){var t=[];for(var e in h.filesListObj)t.push(h.filesListObj[e]);for(var i=1,n=t.length;i<n;i++){var r=t[i];h.deleteFile("",r.readyUrl)}},h.onSaveFile=function(t,e,i,n,r,a){void 0===i&&(i=!0),void 0===n&&(n=""),void 0===a&&(a=0);var s=t.split("?")[0];if(null==h.filesListObj.fileUsedSize&&(h.filesListObj.fileUsedSize=0),i){h.getFileNativePath(e);h.filesListObj[s]={md5:e,readyUrl:t,size:a,times:u.now(),encoding:n},h.filesListObj.fileUsedSize=parseInt(h.filesListObj.fileUsedSize)+a,h.writeFilesList(s,JSON.stringify(h.filesListObj),!0),null!=r&&r.runWith([0])}else if(h.filesListObj[s]){var o=parseInt(h.filesListObj[s].size);h.filesListObj.fileUsedSize=parseInt(h.filesListObj.fileUsedSize)-o,delete h.filesListObj[s],h.writeFilesList(s,JSON.stringify(h.filesListObj),!1),null!=r&&r.runWith([0])}},h.writeFilesList=function(t,e,i){var n=h.fileNativeDir+"/"+h.fileListName;h.fs.writeFile({filePath:n,encoding:"utf8",data:e,success:function(t){},fail:function(t){}}),!y.isZiYu&&y.isPosMsgYu&&wx.postMessage({url:t,data:h.filesListObj[t],isLoad:"filenative",isAdd:i})},h.getCacheUseSize=function(){return h.filesListObj&&h.filesListObj.fileUsedSize?h.filesListObj.fileUsedSize:0},h.existDir=function(t,e){h.fs.mkdir({dirPath:t,success:function(t){null!=e&&e.runWith([0,{data:JSON.stringify({})}])},fail:function(t){-1!=t.errMsg.indexOf("file already exists")?h.readSync(h.fileListName,"utf8",e):null!=e&&e.runWith([1,t])}})},h.readSync=function(t,e,i,n){void 0===e&&(e="ascill"),void 0===n&&(n="");var r,a=h.getFileNativePath(t);try{r=h.fs.readFileSync(a,e),null!=i&&i.runWith([0,{data:r}])}catch(t){null!=i&&i.runWith([1])}},h.setNativeFileDir=function(t){h.fileNativeDir=wx.env.USER_DATA_PATH+t},h.filesListObj={},h.fileNativeDir=null,h.fileListName="layaairfiles.txt",h.ziyuFileData={},h.loadPath="",h.DESCENDING=2,h.NUMERIC=16,e(h,["fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),h}(),E=function(){function r(){}return s(r,"laya.wx.mini.MiniImage"),r.prototype._loadImage=function(t){if(y.isZiYu)r.onCreateImage(t,this,!0);else{var e=!1;if(x.isLocalNativeFile(t)){if(-1!=t.indexOf("http://")||-1!=t.indexOf("https://"))if(""!=x.loadPath)t=t.split(x.loadPath)[1];else{var i=""!=g.rootPath?g.rootPath:g.basePath;""!=i&&(t=t.split(i)[1])}}else e=!0,t=g.formatURL(t);x.getFileInfo(t)?r.onCreateImage(t,this,!e):-1!=t.indexOf("http://")||-1!=t.indexOf("https://")?y.isZiYu?r.onCreateImage(t,this,!0):x.downOtherFiles(t,new _(r,r.onDownImgCallBack,[t,this]),t):r.onCreateImage(t,this,!0)}},r.onDownImgCallBack=function(t,e,i,n){void 0===n&&(n=""),i?e.onError(null):r.onCreateImage(t,e,!1,n)},r.onCreateImage=function(e,i,t,n){var r,a;if(void 0===t&&(t=!1),void 0===n&&(n=""),y.autoCacheFile)if(t)r=e;else if(""!=n)r=n;else{var s=x.getFileInfo(e).md5;r=x.getFileNativePath(s)}else r=t?e:n;function o(){a.onload=null,a.onerror=null,delete i.imgCache[e]}null==i.imgCache&&(i.imgCache={});var l=function(){o(),i._url=g.formatURL(i._url),i.onLoaded(a)},h=function(){o(),i.event("error","Load image failed")};"nativeimage"==i._type?((a=new u.window.Image).crossOrigin="",a.onload=l,a.onerror=h,a.src=r,i.imgCache[e]=a):new c.create(r,{onload:l,onerror:h,onCreate:function(t){a=t,i.imgCache[e]=t}})},r}(),T=function(){function i(){}return s(i,"laya.wx.mini.MiniInput"),i._createInputElement=function(){o._initInput(o.area=u.createElement("textarea")),o._initInput(o.input=u.createElement("input")),o.inputContainer=u.createElement("div"),o.inputContainer.style.position="absolute",o.inputContainer.style.zIndex=1e5,u.container.appendChild(o.inputContainer),o.inputContainer.setPos=function(t,e){o.inputContainer.style.left=t+"px",o.inputContainer.style.top=e+"px"},a.stage.on("resize",null,i._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(t){r.dispatchEvent&&r.dispatchEvent("resize")}),m._soundClass=M,m._musicClass=M;var t=y.systemInfo.model,e=y.systemInfo.system;-1!=t.indexOf("iPhone")&&(u.onIPhone=!0,u.onIOS=!0,u.onIPad=!0,u.onAndriod=!1),-1==e.indexOf("Android")&&-1==e.indexOf("Adr")||(u.onAndriod=!0,u.onIPhone=!1,u.onIOS=!1,u.onIPad=!1)},i._onStageResize=function(){a.stage._canvasTransform.identity().scale(u.width/h.canvas.width/f.getPixelRatio(),u.height/h.canvas.height/f.getPixelRatio())},i.wxinputFocus=function(t){var i=o.inputElement.target;i&&!i.editable||(y.window.wx.offKeyboardConfirm(),y.window.wx.offKeyboardInput(),y.window.wx.showKeyboard({defaultValue:i.text,maxLength:i.maxChars,multiple:i.multiline,confirmHold:!0,confirmType:"done",success:function(t){},fail:function(t){}}),y.window.wx.onKeyboardConfirm(function(t){var e=t?t.value:"";i.text=e,i.event("input"),laya.wx.mini.MiniInput.inputEnter()}),y.window.wx.onKeyboardInput(function(t){var e=t?t.value:"";i.multiline||-1==e.indexOf("\n")?(i.text=e,i.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},i.inputEnter=function(){o.inputElement.target.focus=!1},i.wxinputblur=function(){i.hideKeyboard()},i.hideKeyboard=function(){y.window.wx.offKeyboardConfirm(),y.window.wx.offKeyboardInput(),y.window.wx.hideKeyboard({success:function(t){console.log("隐藏键盘")},fail:function(t){console.log("隐藏键盘出错:"+(t?t.errMsg:""))}})},i}(),S=function(){function i(){}return s(i,"laya.wx.mini.MiniLocalStorage"),i.__init__=function(){i.items=i},i.setItem=function(t,e){wx.setStorageSync(t,e)},i.getItem=function(t){return wx.getStorageSync(t)},i.setJSON=function(t,e){i.setItem(t,e)},i.getJSON=function(t){return i.getItem(t)},i.removeItem=function(t){wx.removeStorageSync(t)},i.clear=function(){wx.clearStorageSync()},i.getStorageInfoSync=function(){try{var t=wx.getStorageInfoSync();return console.log(t.keys),console.log(t.currentSize),console.log(t.limitSize),t}catch(t){}return null},i.support=!0,i.items=null,i}(),w=(function(){function r(){}s(r,"laya.wx.mini.MiniLocation"),r.__init__=function(){y.window.navigator.geolocation.getCurrentPosition=r.getCurrentPosition,y.window.navigator.geolocation.watchPosition=r.watchPosition,y.window.navigator.geolocation.clearWatch=r.clearWatch},r.getCurrentPosition=function(e,t,i){var n;(n={success:function(t){null!=e&&e(t)}}).fail=t,y.window.wx.getLocation(n)},r.watchPosition=function(t,e,i){var n;return r._curID++,(n={}).success=t,n.error=e,r._watchDic[r._curID]=n,a.timer.loop(1e3,null,r._myLoop),r._curID},r.clearWatch=function(t){delete r._watchDic[t],r._hasWatch()||a.timer.clear(null,r._myLoop)},r._hasWatch=function(){var t;for(t in r._watchDic)if(r._watchDic[t])return!0;return!1},r._myLoop=function(){r.getCurrentPosition(r._mySuccess,r._myError)},r._mySuccess=function(t){var e,i={};for(e in i.coords=t,i.timestamp=u.now(),r._watchDic)r._watchDic[e].success&&r._watchDic[e].success(i)},r._myError=function(t){var e;for(e in r._watchDic)r._watchDic[e].error&&r._watchDic[e].error(t)},r._watchDic={},r._curID=0}(),function(r){function a(){a.__super.call(this)}s(a,"laya.wx.mini.MiniAccelerator",r);var t=a.prototype;t.on=function(t,e,i,n){return r.prototype.on.call(this,t,e,i,n),a.startListen(this.onDeviceOrientationChange),this},t.off=function(t,e,i,n){return void 0===n&&(n=!1),this.hasListener(t)||a.stopListen(),r.prototype.off.call(this,t,e,i,n)},a.__init__=function(){try{var t;if(!(t=laya.device.motion.Accelerator))return;t.prototype.on=a.prototype.on,t.prototype.off=a.prototype.off}catch(t){}},a.startListen=function(t){if(a._callBack=t,!a._isListening){a._isListening=!0;try{wx.onAccelerometerChange(a.onAccelerometerChange)}catch(t){}}},a.stopListen=function(){a._isListening=!1;try{wx.stopAccelerometer({})}catch(t){}},a.onAccelerometerChange=function(t){var e;(e={}).acceleration=t,e.accelerationIncludingGravity=t,e.rotationRate={},null!=a._callBack&&a._callBack(e)},a._isListening=!1,a._callBack=null}(i),function(t){function u(){u.__super.call(this)}return s(u,"laya.wx.mini.MiniLoader",i),u.prototype.load=function(t,e,i,n,r){void 0===i&&(i=!0),void 0===r&&(r=!1);var a=this;if(0===(a._url=t).indexOf("data:image")?a._type=e="image":a._type=e||(e=a.getTypeFromUrl(t)),a._cache=i,a._data=null,!r&&d.loadedMap[g.formatURL(t)])return a._data=d.loadedMap[g.formatURL(t)],this.event("progress",1),void this.event("complete",a._data);if(null!=d.parserMap[e])return a._customParse=!0,void(d.parserMap[e]instanceof laya.utils.Handler?d.parserMap[e].runWith(this):d.parserMap[e].call(null,this));var s=y.getUrlEncode(t,e),o=v.getFileExtension(t);if(-1!=u._fileTypeArr.indexOf(o))y.EnvConfig.load.call(this,t,e,i,n,r);else{if(y.isZiYu&&x.ziyuFileData[t]){var l=x.ziyuFileData[t];return void a.onLoaded(l)}if(x.getFileInfo(t)){var h=x.getFileInfo(t);h.encoding=null==h.encoding?"ascii":h.encoding,x.readFile(t,h.encoding,new _(u,u.onReadNativeCallBack,[s,t,e,i,n,r,a]),t)}else{if(x.isLocalNativeFile(t))return void x.read(t,s,new _(u,u.onReadNativeCallBack,[s,t,e,i,n,r,a]));-1!=(t=g.formatURL(t)).indexOf("http://")||-1!=t.indexOf("https://")?y.EnvConfig.load.call(a,t,e,i,n,r):x.readFile(t,s,new _(u,u.onReadNativeCallBack,[s,t,e,i,n,r,a]),t)}}},u.onReadNativeCallBack=function(t,e,i,n,r,a,s,o,l){var h;(void 0===n&&(n=!0),void 0===a&&(a=!1),void 0===o&&(o=0),o)?1==o&&y.EnvConfig.load.call(s,e,i,n,r,a):(h="json"==i||"atlas"==i?y.getJson(l.data):"xml"==i?v.parseXMLFromString(l.data):l.data,!y.isZiYu&&y.isPosMsgYu&&"arraybuffer"!=i&&wx.postMessage({url:e,data:h,isLoad:"filedata"}),s.onLoaded(h))},e(u,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),u}()),M=function(t){function a(){this._sound=null,this.url=null,this.loaded=!1,this.readyUrl=null,a.__super.call(this)}s(a,"laya.wx.mini.MiniSound",i);var e=a.prototype;return e.load=function(t){t=g.formatURL(t),this.url=t,this.readyUrl=t,a._audioCache[this.readyUrl]?this.event("complete"):y.autoCacheFile&&x.getFileInfo(t)?this.onDownLoadCallBack(t,0):y.autoCacheFile?x.downOtherFiles(t,_.create(this,this.onDownLoadCallBack,[t]),t):this.onDownLoadCallBack(t,0)},e.onDownLoadCallBack=function(t,e){if(e)this.event("error");else{var i;if(y.autoCacheFile){var n=x.getFileInfo(t).md5;i=x.getFileNativePath(n),this._sound=a._createSound(),this._sound.src=this.url=i}else this._sound=a._createSound(),this._sound.src=t;this._sound.onCanplay(a.bindToThis(this.onCanPlay,this)),this._sound.onError(a.bindToThis(this.onError,this))}},e.onError=function(t){try{console.log("-----1---------------minisound-----id:"+a._id),console.log(t)}catch(t){console.log("-----2---------------minisound-----id:"+a._id),console.log(t)}this.event("error"),this._sound.offError(null)},e.onCanPlay=function(){this.loaded=!0,this.event("complete"),(a._audioCache[this.readyUrl]=this)._sound.offCanplay(null)},e.play=function(t,e){var i;if(void 0===t&&(t=0),void 0===e&&(e=0),i=this.url==m._tMusic?(a._musicAudio||(a._musicAudio=a._createSound()),a._musicAudio):a._audioCache[this.readyUrl]?a._audioCache[this.readyUrl]._sound:a._createSound(),y.autoCacheFile&&x.getFileInfo(this.url)){var n=x.getFileInfo(this.url).md5;i.src=this.url=x.getFileNativePath(n)}else i.src=this.url;var r=new D(i,this);return r.url=this.url,r.loops=e,r.loop=0===e,r.startTime=t,r.play(),m.addChannel(r),r},e.dispose=function(){var t=a._audioCache[this.readyUrl];t&&(t.src="",t._sound&&(t._sound.destroy(),t._sound=null,t=null),delete a._audioCache[this.readyUrl])},n(0,e,"duration",function(){return this._sound.duration}),a._createSound=function(){return a._id++,y.window.wx.createInnerAudioContext()},a.bindToThis=function(t,e){return t.bind(e)},a._musicAudio=null,a._id=0,a._audioCache={},a}(),D=function(t){function i(t,e){this._audio=null,this._onEnd=null,this._miniSound=null,i.__super.call(this),this._audio=t,this._miniSound=e,this._onEnd=i.bindToThis(this.__onEnd,this),t.onEnded(this._onEnd)}s(i,"laya.wx.mini.MiniSoundChannel",p);var e=i.prototype;return e.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(a.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},e.play=function(){this.isStopped=!1,m.addChannel(this),this._audio.play()},e.stop=function(){this.isStopped=!0,m.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.pause(),this._audio.offEnded(null),this._audio=null,this._miniSound=null,this._onEnd=null)},e.pause=function(){this.isStopped=!0,this._audio.pause()},e.resume=function(){this._audio&&(this.isStopped=!1,m.addChannel(this),this._audio.play())},n(0,e,"autoplay",function(){return this._audio.autoplay},function(t){this._audio.autoplay=t}),n(0,e,"position",function(){return this._audio?this._audio.currentTime:0}),n(0,e,"duration",function(){return this._audio?this._audio.duration:0}),n(0,e,"loop",function(){return this._audio.loop},function(t){this._audio.loop=t}),n(0,e,"volume",function(){return this._audio?this._audio.volume:1},function(t){this._audio&&(this._audio.volume=t)}),i.bindToThis=function(t,e){return t.bind(e)},i}()}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}),function(t,e,T){T.un,T.uns;var s=T.static,_=T.class,l=T.getset,a=T.__newvec,u=laya.maths.Arith,c=laya.maths.Bezier,n=laya.resource.Bitmap,d=laya.utils.Browser,o=laya.utils.Byte,f=laya.utils.Color,S=(laya.filters.ColorFilter,T.Config),r=laya.resource.Context,w=(laya.events.Event,laya.filters.Filter),h=laya.display.Graphics,p=laya.resource.HTMLCanvas,m=(laya.utils.HTMLChar,laya.resource.HTMLImage),i=laya.resource.HTMLSubImage,M=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),D=laya.maths.Point,I=laya.maths.Rectangle,g=laya.renders.Render,v=(laya.renders.RenderContext,laya.renders.RenderSprite),y=laya.resource.Resource,x=laya.resource.ResourceManager,E=laya.utils.RunDriver,b=laya.display.Sprite,C=laya.display.Stage,A=laya.utils.Stat,R=laya.utils.StringKey,L=(laya.display.css.Style,laya.system.System),O=laya.display.Text,P=laya.resource.Texture,N=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),V=laya.utils.VectorGraphManager;laya.utils.WordText;T.interface("laya.webgl.shapes.IShape"),T.interface("laya.webgl.submit.ISubmit"),T.interface("laya.webgl.text.ICharSegment"),T.interface("laya.webgl.canvas.save.ISaveData"),T.interface("laya.webgl.resource.IMergeAtlasBitmap"),T.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var F=function(){function t(){}_(t,"laya.filters.webgl.FilterActionGL");var e=t.prototype;return T.imps(e,{"laya.filters.IFilterActionGL":!0}),e.setValue=function(t){},e.setValueMix=function(t){},e.apply3d=function(t,e,i,n,r){return null},e.apply=function(t){return null},l(0,e,"typeMix",function(){return 0}),t}(),B=function(){function t(){}return _(t,"laya.webgl.shader.ShaderValue"),t}(),U=function(){var n,r;function t(t,e,i){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new r,void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._cells=null,this._rowInfo=null,this._init(t,e),this._atlasID=i}_(t,"laya.webgl.atlas.AtlasGrid");var e=t.prototype;return e.getAltasID=function(){return this._atlasID},e.setAltasID=function(t){0<=t&&(this._atlasID=t)},e.addTex=function(t,e,i){var n=this._get(e,i);return 0==n.ret||(this._fill(n.x,n.y,e,i,t),this._texCount++),n},e._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},e._init=function(t,e){if(this._width=t,this._height=e,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=a(this._height);for(var i=0;i<this._height;i++)this._rowInfo[i]=new n;return this._clear(),!0},e._get=function(t,e){var i=new H;if(t>=this._failSize.width&&e>=this._failSize.height)return i;for(var n=-1,r=-1,a=this._width,s=this._height,o=this._cells,l=0;l<s;l++)if(!(this._rowInfo[l].spaceCount<t))for(var h=0;h<a;){var u=3*(l*a+h);if(0!=o[u]||o[u+1]<t||o[u+2]<e)h+=o[u+1];else{n=h,r=l;for(var c=0;c<t;c++)if(o[3*c+u+2]<e){n=-1;break}if(!(n<0))return i.ret=!0,i.x=n,i.y=r,i;h+=o[u+1]}}return i},e._fill=function(t,e,i,n,r){var a=this._width,s=this._height;this._check(t+i<=a&&e+n<=s);for(var o=e;o<n+e;++o){this._check(this._rowInfo[o].spaceCount>=i),this._rowInfo[o].spaceCount-=i;for(var l=0;l<i;l++){var h=3*(t+o*a+l);this._check(0==this._cells[h]),this._cells[h]=r,this._cells[h+1]=i,this._cells[h+2]=n}}if(0<t)for(o=0;o<n;++o){var u=0;for(l=t-1;0<=l&&0==this._cells[3*((e+o)*a+l)];--l,++u);for(l=u;0<l;--l)this._cells[3*((e+o)*a+t-l)+1]=l,this._check(0<l)}if(0<e)for(l=t;l<t+i;++l){for(u=0,o=e-1;0<=o&&0==this._cells[3*(l+o*a)];--o,u++);for(o=u;0<o;--o)this._cells[3*(l+(e-o)*a)+2]=o,this._check(0<o)}},e._check=function(t){0==t&&console.log("xtexMerger 错误啦")},e._clear=function(){for(var t=this._texCount=0;t<this._height;t++)this._rowInfo[t].spaceCount=this._width;for(var e=0;e<this._height;e++)for(var i=0;i<this._width;i++){var n=3*(e*this._width+i);this._cells[n]=0,this._cells[n+1]=this._width-i,this._cells[n+2]=this._width-e}this._failSize.width=this._width+1,this._failSize.height=this._height+1},t.__init$=function(){n=function(){function t(){this.spaceCount=0}return _(t,""),t}(),r=function(){function t(){this.width=0,this.height=0}return _(t,""),t}()},t}(),k=function(){function g(t,e,i,n){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=t,this._height=e,this._gridSize=i,this._maxAtlaserCount=n,this._gridNumX=t/i,this._gridNumY=e/i,this._curAtlasIndex=0,this._atlaserArray=[]}_(g,"laya.webgl.atlas.AtlasResourceManager");var t=g.prototype;return t.setAtlasParam=function(t,e,i,n){if(1==this._setAtlasParam)return g._sid_=0,this._width=t,this._height=e,this._gridSize=i,this._maxAtlaserCount=n,this._gridNumX=t/i,this._gridNumY=e/i,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},t.pushData=function(t){var e,i=t.bitmap,n=-1,r=null,a=0,s=0;for(a=0,e=this._atlaserArray.length;a<e&&(s=(this._curAtlasIndex+a)%e,-1==(n=(r=this._atlaserArray[s]).findBitmapIsExist(i)));a++);if(-1!=n){var o=r.InAtlasWebGLImagesOffsetValue[n];return f=o[0],p=o[1],r.addToAtlas(t,f,p),!0}this._setAtlasParam=!1;for(var l=Math.ceil((t.bitmap.width+2)/this._gridSize),h=Math.ceil((t.bitmap.height+2)/this._gridSize),u=!1,c=0;c<2;c++){var _=this._maxAtlaserCount;for(a=0;a<_;a++){s=(this._curAtlasIndex+a)%_,this._atlaserArray.length-1>=s||this._atlaserArray.push(new It(this._gridNumX,this._gridNumY,this._width,this._height,g._sid_++));var d=this._atlaserArray[s],f=0,p=0,m=d.addTex(1,l,h);if(m.ret){f=m.x*this._gridSize+1,p=m.y*this._gridSize+1,i.lock=!0,d.addToAtlasTexture(i,f,p),d.addToAtlas(t,f,p),u=!0,this._curAtlasIndex=s;break}}if(u)break;this._atlaserArray.push(new It(this._gridNumX,this._gridNumY,this._width,this._height,g._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return u||console.log(">>>AtlasManager pushData error"),u},t.addToAtlas=function(t){laya.webgl.atlas.AtlasResourceManager.instance.pushData(t)},t.garbageCollection=function(){if(!0===this._needGC){for(var t=this._atlaserArray.length-this._maxAtlaserCount,e=0;e<t;e++)this._atlaserArray[e].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+t),this._atlaserArray.splice(0,t),this._needGC=!1}return!0},t.freeAll=function(){for(var t=0,e=this._atlaserArray.length;t<e;t++)this._atlaserArray[t].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},t.getAtlaserCount=function(){return this._atlaserArray.length},t.getAtlaserByIndex=function(t){return this._atlaserArray[t]},l(1,g,"instance",function(){return g._Instance||(g._Instance=new g(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),g._Instance}),l(1,g,"enabled",function(){return S.atlasEnable}),l(1,g,"atlasLimitWidth",function(){return g._atlasLimitWidth},function(t){g._atlasLimitWidth=t}),l(1,g,"atlasLimitHeight",function(){return g._atlasLimitHeight},function(t){g._atlasLimitHeight=t}),g._enable=function(){S.atlasEnable=!0},g._disable=function(){S.atlasEnable=!1},g.__init__=function(){g.atlasTextureWidth=2048,g.atlasTextureHeight=2048,g.maxTextureCount=6,g.atlasLimitWidth=512,g.atlasLimitHeight=512},g._atlasLimitWidth=0,g._atlasLimitHeight=0,g.gridSize=16,g.atlasTextureWidth=0,g.atlasTextureHeight=0,g.maxTextureCount=0,g._atlasRestore=0,g.BOARDER_TYPE_NO=0,g.BOARDER_TYPE_RIGHT=1,g.BOARDER_TYPE_LEFT=2,g.BOARDER_TYPE_BOTTOM=4,g.BOARDER_TYPE_TOP=8,g.BOARDER_TYPE_ALL=15,g._sid_=0,g._Instance=null,g}(),H=function(){function t(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return _(t,"laya.webgl.atlas.MergeFillInfo"),t}(),z=function(){function e(){}return _(e,"laya.webgl.canvas.BlendMode"),e._init_=function(t){e.fns=[e.BlendNormal,e.BlendAdd,e.BlendMultiply,e.BlendScreen,e.BlendOverlay,e.BlendLight,e.BlendMask,e.BlendDestinationOut],e.targetFns=[e.BlendNormalTarget,e.BlendAddTarget,e.BlendMultiplyTarget,e.BlendScreenTarget,e.BlendOverlayTarget,e.BlendLightTarget,e.BlendMask,e.BlendDestinationOut]},e.BlendNormal=function(t){t.blendFunc(1,771)},e.BlendAdd=function(t){t.blendFunc(1,772)},e.BlendMultiply=function(t){t.blendFunc(774,771)},e.BlendScreen=function(t){t.blendFunc(1,1)},e.BlendOverlay=function(t){t.blendFunc(1,769)},e.BlendLight=function(t){t.blendFunc(1,1)},e.BlendNormalTarget=function(t){t.blendFunc(1,771)},e.BlendAddTarget=function(t){t.blendFunc(1,772)},e.BlendMultiplyTarget=function(t){t.blendFunc(774,771)},e.BlendScreenTarget=function(t){t.blendFunc(1,1)},e.BlendOverlayTarget=function(t){t.blendFunc(1,769)},e.BlendLightTarget=function(t){t.blendFunc(1,1)},e.BlendMask=function(t){t.blendFunc(0,770)},e.BlendDestinationOut=function(t){t.blendFunc(0,0)},e.activeBlendFunction=null,e.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],e.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},e.NORMAL="normal",e.ADD="add",e.MULTIPLY="multiply",e.SCREEN="screen",e.LIGHT="light",e.OVERLAY="overlay",e.DESTINATIONOUT="destination-out",e.fns=[],e.targetFns=[],e}(),G=function(){function i(t){this._color=f.create("black"),this.setValue(t)}_(i,"laya.webgl.canvas.DrawStyle");var t=i.prototype;return t.setValue=function(t){if(t){if("string"==typeof t)return void(this._color=f.create(t));if(t instanceof laya.utils.Color)return void(this._color=t)}},t.reset=function(){this._color=f.create("black")},t.equal=function(t){return"string"==typeof t?this._color.strColor===t:t instanceof laya.utils.Color&&this._color.numColor===t.numColor},t.toColorStr=function(){return this._color.strColor},i.create=function(t){var e;if(t&&("string"==typeof t?e=f.create(t):t instanceof laya.utils.Color&&(e=t),e))return e._drawStyle||(e._drawStyle=new i(t));return laya.webgl.canvas.DrawStyle.DEFAULT},s(i,["DEFAULT",function(){return this.DEFAULT=new i("#000000")}]),i}(),W=function(){function t(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];xt.mainContext;this.ib=Jt.create(35048),this.vb=$t.create(5)}_(t,"laya.webgl.canvas.Path");var e=t.prototype;return e.addPoint=function(t,e){this.tempArray.push(t,e)},e.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},e.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},e.polygon=function(t,e,i,n,r,a){var s;return this.geomatrys.push(this._curGeomatry=s=new Rt(t,e,i,n,r,a)),n||(s.fill=!1),null==a&&(s.borderWidth=0),s},e.setGeomtry=function(t){this.geomatrys.push(this._curGeomatry=t)},e.drawLine=function(t,e,i,n,r){var a;return this.closePath?this.geomatrys.push(this._curGeomatry=a=new At(t,e,i,n,r)):this.geomatrys.push(this._curGeomatry=a=new Ct(t,e,i,n,r)),a.fill=!1,a},e.update=function(){var t=this.ib._byteLength,e=this.geomatrys.length;this.offset=t;for(var i=this.geoStart;i<e;i++)this.geomatrys[i].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=e,this.count=(this.ib._byteLength-t)/pt.BYTES_PIDX},e.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},e.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},t}(),X=function(){function o(){}_(o,"laya.webgl.canvas.save.SaveBase");var t=o.prototype;return T.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._dataObj[this._valueName]=this._value,(o._cache[o._cache._length++]=this)._newSubmit&&(t._curSubmit=at.RENDERBASE,t._renderKey=0)},o._createArray=function(){var t=[];return t._length=0,t},o._init=function(){var t=o._namemap={};return t[1]="ALPHA",t[2]="fillStyle",t[8]="font",t[256]="lineWidth",t[512]="strokeStyle",t[8192]="_mergeID",t[1024]=t[2048]=t[4096]=[],t[16384]="textBaseline",t[32768]="textAlign",t[65536]="_nBlendType",t[1048576]="shader",t[2097152]="filters",t},o.save=function(t,e,i,n){if((t._saveMark._saveuse&e)!==e){t._saveMark._saveuse|=e;var r=o._cache,a=0<r._length?r[--r._length]:new o;a._value=i[a._valueName=o._namemap[e]],a._dataObj=i,a._newSubmit=n;var s=t._save;s[s._length++]=a}},o._cache=laya.webgl.canvas.save.SaveBase._createArray(),o._namemap=o._init(),o}(),Y=function(){function a(){this._clipRect=new I}_(a,"laya.webgl.canvas.save.SaveClipRect");var t=a.prototype;return T.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){t._clipRect=this._clipSaveRect,(a._cache[a._cache._length++]=this)._submitScissor.submitLength=t._submits._length-this._submitScissor.submitIndex,t._curSubmit=at.RENDERBASE,t._renderKey=0},a.save=function(t,e){if(131072!=(131072&t._saveMark._saveuse)){t._saveMark._saveuse|=131072;var i=a._cache,n=0<i._length?i[--i._length]:new a;n._clipSaveRect=t._clipRect,t._clipRect=n._clipRect.copyFrom(t._clipRect),n._submitScissor=e;var r=t._save;r[r._length++]=n}},s(a,["_cache",function(){return this._cache=X._createArray()}]),a}(),j=function(){function d(){this._contextX=0,this._contextY=0,this._clipRect=new I,this._rect=new I,this._matrix=new M}_(d,"laya.webgl.canvas.save.SaveClipRectStencil");var t=d.prototype;return T.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){ut.restore(t,this._rect,this._saveMatrix,this._contextX,this._contextY),t._clipRect=this._clipSaveRect,t._curMat=this._saveMatrix,t._x=this._contextX,t._y=this._contextY,d._cache[d._cache._length++]=this,t._curSubmit=at.RENDERBASE},d.save=function(t,e,i,n,r,a,s,o,l,h){if(262144!=(262144&t._saveMark._saveuse)){t._saveMark._saveuse|=262144;var u=d._cache,c=0<u._length?u[--u._length]:new d;c._clipSaveRect=t._clipRect,c._clipRect.setTo(s,o,l,h),t._clipRect=c._clipRect,c._rect.x=i,c._rect.y=n,c._rect.width=r,c._rect.height=a,c._contextX=t._x,c._contextY=t._y,c._saveMatrix=t._curMat,t._curMat.copyTo(c._matrix),t._curMat=c._matrix,c._submitStencil=e;var _=t._save;_[_._length++]=c}},s(d,["_cache",function(){return this._cache=X._createArray()}]),d}(),Z=function(){function n(){this._saveuse=0}_(n,"laya.webgl.canvas.save.SaveMark");var t=n.prototype;return T.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!0},t.restore=function(t){t._saveMark=this._preSaveMark,n._no[n._no._length++]=this},n.Create=function(t){var e=n._no,i=0<e._length?e[--e._length]:new n;return i._saveuse=0,i._preSaveMark=t._saveMark,t._saveMark=i},s(n,["_no",function(){return this._no=X._createArray()}]),n}(),K=function(){function a(){this._matrix=new M}_(a,"laya.webgl.canvas.save.SaveTransform");var t=a.prototype;return T.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){t._curMat=this._savematrix,a._no[a._no._length++]=this},a.save=function(t){var e=t._saveMark;if(2048!=(2048&e._saveuse)){e._saveuse|=2048;var i=a._no,n=0<i._length?i[--i._length]:new a;n._savematrix=t._curMat,t._curMat=t._curMat.copyTo(n._matrix);var r=t._save;r[r._length++]=n}},s(a,["_no",function(){return this._no=X._createArray()}]),a}(),q=function(){function r(){}_(r,"laya.webgl.canvas.save.SaveTranslate");var t=r.prototype;return T.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){t._curMat;t._x=this._x,t._y=this._y,r._no[r._no._length++]=this},r.save=function(t){var e=r._no,i=0<e._length?e[--e._length]:new r;i._x=t._x,i._y=t._y;var n=t._save;n[n._length++]=i},s(r,["_no",function(){return this._no=X._createArray()}]),r}(),Q=function(){function t(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new I}_(t,"laya.webgl.resource.RenderTargetMAX");var e=t.prototype;return e.setSP=function(t){this._sp=t},e.size=function(t,e){var i=this;this._width!==t||this._height!==e?(this.repaint=!0,this._width=t,this._height=e,this.target?this.target.size(t,e):this.target=Vt.create(t,e),this.target.hasListener("recovered")||this.target.on("recovered",this,function(t){T.timer.callLater(i._sp,i._sp.repaint)})):this.target.size(t,e)},e._flushToTarget=function(t,e){if(!e._destroy){var i=vt.worldScissorTest,n=vt.worldClipRect;vt.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,vt.worldScissorTest=!1,xt.mainContext.disable(3089);var r=vt.worldAlpha,a=vt.worldMatrix4,s=vt.worldMatrix,o=vt.worldFilters,l=vt.worldShaderDefines;if(vt.worldMatrix=M.EMPTY,vt.restoreTempArray(),vt.worldMatrix4=vt.TEMPMAT4_ARRAY,vt.worldAlpha=1,vt.worldFilters=null,vt.worldShaderDefines=null,Nt.activeShader=null,e.start(),S.showCanvasMark?e.clear(0,1,0,.3):e.clear(0,0,0,0),t.flush(),e.end(),Nt.activeShader=null,vt.worldAlpha=r,vt.worldMatrix4=a,vt.worldMatrix=s,vt.worldFilters=o,vt.worldShaderDefines=l,vt.worldScissorTest=i){var h=vt.height-n.y-n.height;xt.mainContext.scissor(n.x,h,n.width,n.height),xt.mainContext.enable(3089)}vt.worldClipRect=n}},e.flush=function(t){this.repaint&&(this._flushToTarget(t,this.target),this.repaint=!1)},e.drawTo=function(t,e,i,n,r){t.drawTexture(this.target.getTexture(),e,i,n,r,0,0)},e.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},t}(),J=function(){function t(){this.ALPHA=1,this.shaderType=0,this.defines=new bt}return _(t,"laya.webgl.shader.d2.Shader2D"),t.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},t.__init__=function(){var t,e;Zt.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),Zt.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),Zt.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),Zt.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4Color += texture2D(texture, v_texcoord + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),Zt.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),Zt.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),Zt.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),Zt.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),t="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",e='precision mediump float;\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',Zt.preCompile2D(0,1,t,e,null),t="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",e='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',Zt.preCompile2D(0,2,t,e,null),t="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",e="precision mediump float;\n//precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",Zt.preCompile2D(0,4,t,e,null),t="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",e='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',Zt.preCompile2D(0,256,t,e,null),t="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",e="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",Zt.preCompile2D(0,512,t,e,null)},t}(),$=function(){function e(t,e,i){this._value=0,this._name2int=t,this._int2name=e,this._int2nameMap=i}_(e,"laya.webgl.shader.ShaderDefines");var t=e.prototype;return t.add=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value|=t,this._value},t.addInt=function(t){return this._value|=t,this._value},t.remove=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value&=~t,this._value},t.isDefine=function(t){return(this._value&t)===t},t.getValue=function(){return this._value},t.setValue=function(t){this._value=t},t.toNameDic=function(){var t=this._int2nameMap[this._value];return t||e._toText(this._value,this._int2name,this._int2nameMap)},e._reg=function(t,e,i,n){n[i[t]=e]=t},e._toText=function(t,e,i){var n=i[t];if(n)return n;for(var r={},a=1,s=0;s<32&&!(t<(a=1<<s));s++)if(t&a){var o=e[a];o&&(r[o]="")}return i[t]=r},e._toInt=function(t,e){for(var i=t.split("."),n=0,r=0,a=i.length;r<a;r++){var s=e[i[r]];if(!s)throw new Error("Defines to int err:"+t+"/"+i[r]);n|=s}return n},e}(),tt=function(){function s(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new M}_(s,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var t=s.prototype;return t.init=function(t,e,i){if(e)this._vs=e;else{this._vs=[];var n=t.width,r=t.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push(n,0,1,0,1,1,1,1),this._vs.push(n,r,1,1,1,1,1,1),this._vs.push(0,r,0,1,1,1,1,1)}this._ps=i||(s._defaultPS||(s._defaultPS=[]).push(0,1,3,3,1,2),s._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=t},t.init2=function(t,e,i,n,r){this.transform&&(this.transform=null),i?this._ps=i:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=n,this._uvs=r,this.mEleNum=this._ps.length,this.mTexture=t,(g.isConchNode||g.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},t._initMyData=function(){var t=0,e=0,i=4*this._verticles.length;this._vs=s._tempVS;var n=!1;if(g.isConchNode||g.isConchApp?(this._vs.length=i,n=!0):this._vs.length<i&&(this._vs.length=i,n=!0),s._tVSLen=i,n)for(;t<i;)this._vs[t]=this._verticles[e],this._vs[t+1]=this._verticles[e+1],this._vs[t+2]=this._uvs[e],this._vs[t+3]=this._uvs[e+1],this._vs[t+4]=1,this._vs[t+5]=1,this._vs[t+6]=1,this._vs[t+7]=1,t+=8,e+=2;else for(;t<i;)this._vs[t]=this._verticles[e],this._vs[t+1]=this._verticles[e+1],this._vs[t+2]=this._uvs[e],this._vs[t+3]=this._uvs[e+1],t+=8,e+=2},t.getData2=function(t,e,i){var n;this.mVBBuffer=t,this.mIBBuffer=e,this._initMyData(),t.appendEx2(this._vs,Float32Array,s._tVSLen,4),this._indexStart=e._byteLength,(n=s._tempIB).length<this._ps.length&&(n.length=this._ps.length);for(var r=0,a=this._ps.length;r<a;r++)n[r]=this._ps[r]+i;e.appendEx2(n,Uint16Array,this._ps.length,2)},t.getData=function(t,e,i){if(this.mVBBuffer=t,this.mIBBuffer=e,t.append(this.mVBData),this._indexStart=e._byteLength,this.mIBData.start!=i){for(var n=0,r=this._ps.length;n<r;n++)this.mIBData[n]=this._ps[n]+i;this.mIBData.start=i}e.append(this.mIBData)},t.render=function(t,e,i){if(g.isWebGL&&this.mTexture){t._renderKey=0,t._shader2D.glTexture=null,et.getInstance().addSkinMesh(this);var n=at.createShape(t,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,wt.create(512,0));this.transform||(this.transform=M.EMPTY),this.transform.translate(e,i),M.mul(this.transform,t._curMat,this._tempMatrix),this.transform.translate(-e,-i);var r=n.shaderValue,a=r.u_mmat2||vt.getMatrArray();vt.mat2MatArray(this._tempMatrix,a),r.textureHost=this.mTexture,r.offsetX=0,r.offsetY=0,r.u_mmat2=a,r.ALPHA=t._shader2D.ALPHA,t._submits[t._submits._length++]=n}else g.isConchApp&&this.mTexture&&(this.transform||(this.transform=M.EMPTY),t.setSkinMesh&&t.setSkinMesh(e,i,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},s._tempVS=[],s._tempIB=[],s._defaultPS=null,s._tVSLen=0,s}(),et=function(){function t(){this.ib=null,this.vb=null;xt.mainContext;this.ib=Jt.create(35048),this.vb=$t.create(8)}_(t,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var e=t.prototype;return e.addSkinMesh=function(t){t.getData2(this.vb,this.ib,this.vb._byteLength/32)},e.reset=function(){this.vb.clear(),this.ib.clear()},t.getInstance=function(){return t.instance=t.instance||new t},t.instance=null,t}(),it=function(){function t(t,e,i,n,r,a,s,o,l){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===l&&(l=0),this.x=t,this.y=e,this.width=i,this.height=n,this.edges=r,this.color=a,this.borderWidth=s,this.borderColor=o}_(t,"laya.webgl.shapes.BasePoly");var e=t.prototype;return T.imps(e,{"laya.webgl.shapes.IShape":!0}),e.getData=function(t,e,i){},e.rebuild=function(t){},e.setMatrix=function(t){},e.needUpdate=function(t){return!0},e.sector=function(t,e,i){var n=this.x,r=this.y,a=this.edges,s=(this.r1-this.r0)/a,o=this.width,l=this.height,h=this.color,u=(h>>16&255)/255,c=(h>>8&255)/255,_=(255&h)/255;t.push(n,r,u,c,_);for(var d=0;d<a+1;d++)t.push(n+Math.sin(s*d+this.r0)*o,r+Math.cos(s*d+this.r0)*l),t.push(u,c,_);for(d=0;d<a;d++)e.push(i,i+d+1,i+d+2)},e.createLine2=function(t,e,i,n,r,a){var s,o,l,h,u,c,_,d,f,p,m,g,v,y,x,E,T,S,w,M,D=t.concat(),I=r,b=this.borderColor,C=(b>>16&255)/255,A=(b>>8&255)/255,R=(255&b)/255,L=D.length/2,O=n,P=i/2;l=D[0],h=D[1],p=l-(u=D[2]),f=(f=-(h-(c=D[3])))/(M=Math.sqrt(f*f+p*p))*P,p=p/M*P,I.push(l-f+this.x,h-p+this.y,C,A,R,l+f+this.x,h+p+this.y,C,A,R);for(var N=1;N<L-1;N++)l=D[2*(N-1)],h=D[2*(N-1)+1],u=D[2*N],c=D[2*N+1],_=D[2*(N+1)],d=D[2*(N+1)+1],p=l-u,g=u-_,x=(-(f=(f=-(h-c))/(M=Math.sqrt(f*f+p*p))*P)+l)*(-(p=p/M*P)+c)-(-f+u)*(-p+h),S=(-(m=(m=-(c-d))/(M=Math.sqrt(m*m+g*g))*P)+_)*(-(g=g/M*P)+c)-(-m+u)*(-g+d),w=(v=-p+h-(-p+c))*(T=-m+u-(-m+_))-(E=-g+d-(-g+c))*(y=-f+u-(-f+l)),Math.abs(w)<.1?(w+=10.1,I.push(u-f+this.x,c-p+this.y,C,A,R,u+f+this.x,c+p+this.y,C,A,R)):(((s=(y*S-T*x)/w)-u)*(s-u)+((o=(E*x-v*S)/w)-c)+(o-c),I.push(s+this.x,o+this.y,C,A,R,u-(s-u)+this.x,c-(o-c)+this.y,C,A,R));l=D[D.length-4],h=D[D.length-3],p=l-(u=D[D.length-2]),f=(f=-(h-(c=D[D.length-1])))/(M=Math.sqrt(f*f+p*p))*P,p=p/M*P,I.push(u-f+this.x,c-p+this.y,C,A,R,u+f+this.x,c+p+this.y,C,A,R);var V=a;for(N=1;N<V;N++)e.push(O+2*(N-1),O+2*(N-1)+1,O+2*N+1,O+2*N+1,O+2*N,O+2*(N-1));return I},e.createLine=function(t,e,i,n){var r=t.concat(),a=t,s=this.borderColor,o=(s>>16&255)/255,l=(s>>8&255)/255,h=(255&s)/255;r.splice(0,5);var u,c,_,d,f,p,m,g,v,y,x,E,T,S,w,M,D,I,b,C,A=r.length/5,R=n,L=i/2;_=r[0],d=r[1],y=_-(f=r[5]),v=(v=-(d-(p=r[6])))/(C=Math.sqrt(v*v+y*y))*L,y=y/C*L,a.push(_-v,d-y,o,l,h,_+v,d+y,o,l,h);for(var O=1;O<A-1;O++)_=r[5*(O-1)],d=r[5*(O-1)+1],f=r[5*O],p=r[5*O+1],m=r[5*(O+1)],g=r[5*(O+1)+1],y=_-f,E=f-m,w=(-(v=(v=-(d-p))/(C=Math.sqrt(v*v+y*y))*L)+_)*(-(y=y/C*L)+p)-(-v+f)*(-y+d),I=(-(x=(x=-(p-g))/(C=Math.sqrt(x*x+E*E))*L)+m)*(-(E=E/C*L)+p)-(-x+f)*(-E+g),b=(T=-y+d-(-y+p))*(D=-x+f-(-x+m))-(M=-E+g-(-E+p))*(S=-v+f-(-v+_)),Math.abs(b)<.1?(b+=10.1,a.push(f-v,p-y,o,l,h,f+v,p+y,o,l,h)):(((u=(S*I-D*w)/b)-f)*(u-f)+((c=(M*w-T*I)/b)-p)+(c-p),a.push(u,c,o,l,h,f-(u-f),p-(c-p),o,l,h));_=r[r.length-10],d=r[r.length-9],y=_-(f=r[r.length-5]),v=(v=-(d-(p=r[r.length-4])))/(C=Math.sqrt(v*v+y*y))*L,y=y/C*L,a.push(f-v,p-y,o,l,h,f+v,p+y,o,l,h);var P=this.edges+1;for(O=1;O<P;O++)e.push(R+2*(O-1),R+2*(O-1)+1,R+2*O+1,R+2*O+1,R+2*O,R+2*(O-1));return a},e.createLoopLine=function(t,e,i,n,r,a){var s=t.concat(),o=r||t,l=this.borderColor,h=(l>>16&255)/255,u=(l>>8&255)/255,c=(255&l)/255;s.splice(0,5);var _=[s[0],s[1]],d=[s[s.length-5],s[s.length-4]],f=d[0]+.5*(_[0]-d[0]),p=d[1]+.5*(_[1]-d[1]);s.unshift(f,p,0,0,0),s.push(f,p,0,0,0);var m,g,v,y,x,E,T,S,w,M,D,I,b,C,A,R,L,O,P,N,V=s.length/5,F=n,B=i/2;v=s[0],y=s[1],M=v-(x=s[5]),w=(w=-(y-(E=s[6])))/(N=Math.sqrt(w*w+M*M))*B,M=M/N*B,o.push(v-w,y-M,h,u,c,v+w,y+M,h,u,c);for(var U=1;U<V-1;U++)v=s[5*(U-1)],y=s[5*(U-1)+1],x=s[5*U],E=s[5*U+1],T=s[5*(U+1)],S=s[5*(U+1)+1],M=v-x,I=x-T,A=(-(w=(w=-(y-E))/(N=Math.sqrt(w*w+M*M))*B)+v)*(-(M=M/N*B)+E)-(-w+x)*(-M+y),O=(-(D=(D=-(E-S))/(N=Math.sqrt(D*D+I*I))*B)+T)*(-(I=I/N*B)+E)-(-D+x)*(-I+S),P=(b=-M+y-(-M+E))*(L=-D+x-(-D+T))-(R=-I+S-(-I+E))*(C=-w+x-(-w+v)),Math.abs(P)<.1?(P+=10.1,o.push(x-w,E-M,h,u,c,x+w,E+M,h,u,c)):(((m=(C*O-L*A)/P)-x)*(m-x)+((g=(R*A-b*O)/P)-E)+(g-E),o.push(m,g,h,u,c,x-(m-x),E-(g-E),h,u,c));a&&(e=a);var k=this.edges+1;for(U=1;U<k;U++)e.push(F+2*(U-1),F+2*(U-1)+1,F+2*U+1,F+2*U+1,F+2*U,F+2*(U-1));return e.push(F+2*(U-1),F+2*(U-1)+1,F+1,F+1,F,F+2*(U-1)),o},t}(),nt=function(){function p(){}return _(p,"laya.webgl.shapes.Earcut"),p.earcut=function(t,e,i){i=i||2;var n,r,a,s,o,l,h,u=e&&e.length,c=u?e[0]*i:t.length,_=p.linkedList(t,0,c,i,!0),d=[];if(!_)return d;if(u&&(_=p.eliminateHoles(t,e,_,i)),t.length>80*i){n=a=t[0],r=s=t[1];for(var f=i;f<c;f+=i)(o=t[f])<n&&(n=o),(l=t[f+1])<r&&(r=l),a<o&&(a=o),s<l&&(s=l);h=0!==(h=Math.max(a-n,s-r))?1/h:0}return p.earcutLinked(_,d,i,n,r,h),d},p.linkedList=function(t,e,i,n,r){var a,s;if(r===0<p.signedArea(t,e,i,n))for(a=e;a<i;a+=n)s=p.insertNode(a,t[a],t[a+1],s);else for(a=i-n;e<=a;a-=n)s=p.insertNode(a,t[a],t[a+1],s);return s&&p.equals(s,s.next)&&(p.removeNode(s),s=s.next),s},p.filterPoints=function(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!p.equals(n,n.next)&&0!==p.area(n.prev,n,n.next))n=n.next;else{if(p.removeNode(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e},p.earcutLinked=function(t,e,i,n,r,a,s){if(t){!s&&a&&p.indexCurve(t,n,r,a);for(var o,l,h=t;t.prev!==t.next;)if(o=t.prev,l=t.next,a?p.isEarHashed(t,n,r,a):p.isEar(t))e.push(o.i/i),e.push(t.i/i),e.push(l.i/i),p.removeNode(t),t=l.next,h=l.next;else if((t=l)===h){s?1===s?(t=p.cureLocalIntersections(t,e,i),p.earcutLinked(t,e,i,n,r,a,2)):2===s&&p.splitEarcut(t,e,i,n,r,a):p.earcutLinked(p.filterPoints(t,null),e,i,n,r,a,1);break}}},p.isEar=function(t){var e=t.prev,i=t,n=t.next;if(0<=p.area(e,i,n))return!1;for(var r=t.next.next;r!==t.prev;){if(p.pointInTriangle(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&0<=p.area(r.prev,r,r.next))return!1;r=r.next}return!0},p.isEarHashed=function(t,e,i,n){var r=t.prev,a=t,s=t.next;if(0<=p.area(r,a,s))return!1;for(var o=r.x<a.x?r.x<s.x?r.x:s.x:a.x<s.x?a.x:s.x,l=r.y<a.y?r.y<s.y?r.y:s.y:a.y<s.y?a.y:s.y,h=r.x>a.x?r.x>s.x?r.x:s.x:a.x>s.x?a.x:s.x,u=r.y>a.y?r.y>s.y?r.y:s.y:a.y>s.y?a.y:s.y,c=p.zOrder(o,l,e,i,n),_=p.zOrder(h,u,e,i,n),d=t.nextZ;d&&d.z<=_;){if(d!==t.prev&&d!==t.next&&p.pointInTriangle(r.x,r.y,a.x,a.y,s.x,s.y,d.x,d.y)&&0<=p.area(d.prev,d,d.next))return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=c;){if(d!==t.prev&&d!==t.next&&p.pointInTriangle(r.x,r.y,a.x,a.y,s.x,s.y,d.x,d.y)&&0<=p.area(d.prev,d,d.next))return!1;d=d.prevZ}return!0},p.cureLocalIntersections=function(t,e,i){var n=t;do{var r=n.prev,a=n.next.next;!p.equals(r,a)&&p.intersects(r,n,n.next,a)&&p.locallyInside(r,a)&&p.locallyInside(a,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(a.i/i),p.removeNode(n),p.removeNode(n.next),n=t=a),n=n.next}while(n!==t);return n},p.splitEarcut=function(t,e,i,n,r,a){var s=t;do{for(var o=s.next.next;o!==s.prev;){if(s.i!==o.i&&p.isValidDiagonal(s,o)){var l=p.splitPolygon(s,o);return s=p.filterPoints(s,s.next),l=p.filterPoints(l,l.next),p.earcutLinked(s,e,i,n,r,a),void p.earcutLinked(l,e,i,n,r,a)}o=o.next}s=s.next}while(s!==t)},p.eliminateHoles=function(t,e,i,n){var r,a,s,o,l,h=[];for(r=0,a=e.length;r<a;r++)s=e[r]*n,o=r<a-1?e[r+1]*n:t.length,(l=p.linkedList(t,s,o,n,!1))===l.next&&(l.steiner=!0),h.push(p.getLeftmost(l));for(h.sort(p.compareX),r=0;r<h.length;r++)p.eliminateHole(h[r],i),i=p.filterPoints(i,i.next);return i},p.compareX=function(t,e){return t.x-e.x},p.eliminateHole=function(t,e){if(e=p.findHoleBridge(t,e)){var i=p.splitPolygon(e,t);p.filterPoints(i,i.next)}},p.findHoleBridge=function(t,e){var i,n=e,r=t.x,a=t.y,s=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var o=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=r&&s<o){if((s=o)===r){if(a===n.y)return n;if(a===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===s)return i.prev;var l,h=i,u=i.x,c=i.y,_=1/0;for(n=i.next;n!==h;)r>=n.x&&n.x>=u&&r!==n.x&&p.pointInTriangle(a<c?r:s,a,u,c,a<c?s:r,a,n.x,n.y)&&((l=Math.abs(a-n.y)/(r-n.x))<_||l===_&&n.x>i.x)&&p.locallyInside(n,t)&&(i=n,_=l),n=n.next;return i},p.indexCurve=function(t,e,i,n){for(var r=t;null===r.z&&(r.z=p.zOrder(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,(r=r.next)!==t;);r.prevZ.nextZ=null,r.prevZ=null,p.sortLinked(r)},p.sortLinked=function(t){var e,i,n,r,a,s,o,l,h=1;do{for(i=t,a=t=null,s=0;i;){for(s++,n=i,e=o=0;e<h&&(o++,n=n.nextZ);e++);for(l=h;0<o||0<l&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(i=(r=i).nextZ,o--):(n=(r=n).nextZ,l--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;i=n}a.nextZ=null,h*=2}while(1<s);return t},p.zOrder=function(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1},p.getLeftmost=function(t){for(var e=t,i=t;e.x<i.x&&(i=e),(e=e.next)!==t;);return i},p.pointInTriangle=function(t,e,i,n,r,a,s,o){return 0<=(r-s)*(e-o)-(t-s)*(a-o)&&0<=(t-s)*(n-o)-(i-s)*(e-o)&&0<=(i-s)*(a-o)-(r-s)*(n-o)},p.isValidDiagonal=function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!p.intersectsPolygon(t,e)&&p.locallyInside(t,e)&&p.locallyInside(e,t)&&p.middleInside(t,e)},p.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)},p.equals=function(t,e){return t.x===e.x&&t.y===e.y},p.intersects=function(t,e,i,n){return!!(p.equals(t,e)&&p.equals(i,n)||p.equals(t,n)&&p.equals(i,e))||0<p.area(t,e,i)!=0<p.area(t,e,n)&&0<p.area(i,n,t)!=0<p.area(i,n,e)},p.intersectsPolygon=function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&p.intersects(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1},p.locallyInside=function(t,e){return p.area(t.prev,t,t.next)<0?0<=p.area(t,e,t.next)&&0<=p.area(t,t.prev,e):p.area(t,e,t.prev)<0||p.area(t,t.next,e)<0},p.middleInside=function(t,e){for(var i=t,n=!1,r=(t.x+e.x)/2,a=(t.y+e.y)/2;i.y>a!=i.next.y>a&&i.next.y!==i.y&&r<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(n=!n),(i=i.next)!==t;);return n},p.splitPolygon=function(t,e){var i=new rt(t.i,t.x,t.y),n=new rt(e.i,e.x,e.y),r=t.next,a=e.prev;return(t.next=e).prev=t,(i.next=r).prev=i,(n.next=i).prev=n,(a.next=n).prev=a,n},p.insertNode=function(t,e,i,n){var r=new rt(t,e,i);return n?(r.next=n.next,(r.prev=n).next.prev=r,n.next=r):(r.prev=r).next=r,r},p.removeNode=function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)},p.signedArea=function(t,e,i,n){for(var r=0,a=e,s=i-n;a<i;a+=n)r+=(t[s]-t[a])*(t[a+1]+t[s+1]),s=a;return r},p}(),rt=function(){function t(t,e,i){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return _(t,"laya.webgl.shapes.EarcutNode"),t}(),at=(function(){function t(t,e,i,n,r,a,s){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this.fillColor=n,this.fillAlpha=r,this.shape=s,this.fill=a}_(t,"laya.webgl.shapes.GeometryData");var e=t.prototype;e.clone=function(){return new t(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},e.getIndexData=function(){return null},e.getVertexData=function(){return null},e.destroy=function(){this.shape=null}}(),function(){function t(t){if(t instanceof Float32Array)this.points=t;else if(t instanceof Array){t.length;this.points=new Float32Array(t)}}_(t,"laya.webgl.shapes.Vertex");var e=t.prototype;T.imps(e,{"laya.webgl.shapes.IShape":!0}),e.getData=function(t,e,i){},e.needUpdate=function(t){return!1},e.rebuild=function(t){},e.setMatrix=function(t){}}(),function(){function l(t){void 0===t&&(t=1e4),this._renderType=t}_(l,"laya.webgl.submit.Submit");var t=l.prototype;return T.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.releaseRender=function(){var t=l._cache;(t[t._length++]=this).shaderValue.release(),this._vb=null},t.getRenderType=function(){return this._renderType},t.renderSubmit=function(){if(0===this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t.source;if(!t.bitmap||!e)return 1;this.shaderValue.texture=e}this._vb.bind_upload(this._ib);var i=xt.mainContext;return this.shaderValue.upload(),z.activeBlendFunction!==this._blendFn&&(i.enable(3042),this._blendFn(i),z.activeBlendFunction=this._blendFn),A.drawCall++,A.trianglesFaces+=this._numEle/3,i.drawElements(4,this._numEle,5123,this._startIdx),1},l.__init__=function(){var t=l.RENDERBASE=new l(-1);t.shaderValue=new wt(0,0),t.shaderValue.ALPHA=-1234},l.createSubmit=function(t,e,i,n,r){var a=l._cache._length?l._cache[--l._cache._length]:new l;null==i&&((i=a._selfVb||(a._selfVb=$t.create(-1))).clear(),n=0),a._ib=e,a._vb=i,a._startIdx=n*pt.BYTES_PIDX,a._numEle=0;var s=t._nBlendType;a._blendFn=t._targets?z.targetFns[s]:z.fns[s],a.shaderValue=r,a.shaderValue.setValue(t._shader2D);var o=t._shader2D.filters;return o&&a.shaderValue.setFilters(o),a},l.createShape=function(t,e,i,n,r,a){var s=l._cache._length?l._cache[--l._cache._length]:new l;s._ib=e,s._vb=i,s._numEle=n,s._startIdx=r,s.shaderValue=a,s.shaderValue.setValue(t._shader2D);var o=t._nBlendType;return s._blendFn=t._targets?z.targetFns[o]:z.fns[o],s},l.TYPE_2D=1e4,l.TYPE_CANVAS=10003,l.TYPE_CMDSETRT=10004,l.TYPE_CUSTOM=10005,l.TYPE_BLURRT=10006,l.TYPE_CMDDESTORYPRERT=10007,l.TYPE_DISABLESTENCIL=10008,l.TYPE_OTHERIBVB=10009,l.TYPE_PRIMITIVE=10010,l.TYPE_RT=10011,l.TYPE_BLUR_RT=10012,l.TYPE_TARGET=10013,l.TYPE_CHANGE_VALUE=10014,l.TYPE_SHAPE=10015,l.TYPE_TEXTURE=10016,l.TYPE_FILLTEXTURE=10017,l.RENDERBASE=null,l._cache=((l._cache=[])._length=0,l._cache),l}()),st=function(){function n(){this.fun=null,this.args=null}_(n,"laya.webgl.submit.SubmitCMD");var t=n.prototype;return T.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){return this.fun.apply(null,this.args),1},t.getRenderType=function(){return 0},t.releaseRender=function(){var t=n._cache;t[t._length++]=this},n.create=function(t,e){var i=n._cache._length?n._cache[--n._cache._length]:new n;return i.fun=e,i.args=t,i},n._cache=((n._cache=[])._length=0,n._cache),n}(),ot=function(){function e(){this.variables={}}_(e,"laya.webgl.submit.SubmitCMDScope");var t=e.prototype;return t.getValue=function(t){return this.variables[t]},t.addValue=function(t,e){return this.variables[t]=e},t.setValue=function(t,e){return this.variables.hasOwnProperty(t)?this.variables[t]=e:null},t.clear=function(){for(var t in this.variables)delete this.variables[t]},t.recycle=function(){this.clear(),e.POOL.push(this)},e.create=function(){var t=e.POOL.pop();return t||(t=new e),t},e.POOL=[],e}(),lt=function(){function c(){this.offset=0,this.startIndex=0,this._mat=M.create()}_(c,"laya.webgl.submit.SubmitOtherIBVB");var t=c.prototype;return T.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.releaseRender=function(){var t=c._cache;t[t._length++]=this},t.getRenderType=function(){return 10009},t.renderSubmit=function(){var t=this._shaderValue.textureHost;if(t){var e=t.source;if(!t.bitmap||!e)return 1;this._shaderValue.texture=e}this._vb.bind_upload(this._ib);var i=vt.worldMatrix4,n=M.TEMP;M.mulPre(this._mat,i[0],i[1],i[4],i[5],i[12],i[13],n);var r=vt.worldMatrix4=c.tempMatrix4;r[0]=n.a,r[1]=n.b,r[4]=n.c,r[5]=n.d,r[12]=n.tx,r[13]=n.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var a=xt.mainContext;return z.activeBlendFunction!==this._blendFn&&(a.enable(3042),this._blendFn(a),z.activeBlendFunction=this._blendFn),A.drawCall++,A.trianglesFaces+=this._numEle/3,a.drawElements(4,this._numEle,5123,this.startIndex),vt.worldMatrix4=i,Nt.activeShader=null,1},c.create=function(t,e,i,n,r,a,s,o,l){void 0===l&&(l=0);var h=c._cache._length?c._cache[--c._cache._length]:new c;h._ib=i,h._vb=e,h._numEle=n,h._shader=r,h._shaderValue=a;var u=t._nBlendType;switch(h._blendFn=t._targets?z.targetFns[u]:z.fns[u],l){case 0:h.offset=0,h.startIndex=o/(pt.BYTES_PE*e.vertexStride)*1.5,h.startIndex*=pt.BYTES_PIDX;break;case 1:h.startIndex=s,h.offset=o}return h},c._cache=((c._cache=[])._length=0,c._cache),c.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],c}(),ht=function(){function i(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new I,this.screenRect=new I}_(i,"laya.webgl.submit.SubmitScissor");var t=i.prototype;return T.imps(t,{"laya.webgl.submit.ISubmit":!0}),t._scissor=function(t,e,i,n){var r=vt.worldMatrix4,a=r[0],s=r[5],o=r[12],l=r[13];if(n*=s,(i*=a)<1||n<1)return!1;var h=(t=t*a+o)+i,u=(e=e*s+l)+n;t<0&&(i=h-(t=0)),e<0&&(n=u-(e=0));var c=vt.worldClipRect;if(t=Math.max(t,c.x),e=Math.max(e,c.y),i=Math.min(h,c.right)-t,n=Math.min(u,c.bottom)-e,i<1||n<1)return!1;var _=vt.worldScissorTest;return this.screenRect.copyFrom(c),c.x=t,c.y=e,c.width=i,c.height=n,vt.worldScissorTest=!0,e=vt.height-e-n,xt.mainContext.scissor(t,e,i,n),xt.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),_?(e=vt.height-this.screenRect.y-this.screenRect.height,xt.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height),xt.mainContext.enable(3089)):(xt.mainContext.disable(3089),vt.worldScissorTest=!1),c.copyFrom(this.screenRect),!0},t._scissorWithTagart=function(t,e,i,n){if(i<1||n<1)return!1;var r=t+i,a=e+n;t<0&&(i=r-(t=0)),e<0&&(n=a-(e=0));var s=vt.worldClipRect;if(t=Math.max(t,s.x),e=Math.max(e,s.y),i=Math.min(r,s.right)-t,n=Math.min(a,s.bottom)-e,i<1||n<1)return!1;var o=vt.worldScissorTest;return this.screenRect.copyFrom(s),vt.worldScissorTest=!0,s.x=t,s.y=e,s.width=i,s.height=n,e=vt.height-e-n,xt.mainContext.scissor(t,e,i,n),xt.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),o?(e=vt.height-this.screenRect.y-this.screenRect.height,xt.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height),xt.mainContext.enable(3089)):(xt.mainContext.disable(3089),vt.worldScissorTest=!1),s.copyFrom(this.screenRect),!0},t.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},t.getRenderType=function(){return 0},t.releaseRender=function(){var t=i._cache;(t[t._length++]=this).context=null},i.create=function(t){var e=i._cache._length?i._cache[--i._cache._length]:new i;return e.context=t,e},i._cache=((i._cache=[])._length=0,i._cache),i}(),ut=function(){function l(){this.step=0,this.blendMode=null,this.level=0}_(l,"laya.webgl.submit.SubmitStencil");var t=l.prototype;return T.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},t.getRenderType=function(){return 0},t.releaseRender=function(){var t=l._cache;t[t._length++]=this},t.do1=function(){var t=xt.mainContext;t.enable(2960),t.clear(1024),t.colorMask(!1,!1,!1,!1),t.stencilFunc(514,this.level,255),t.stencilOp(7680,7680,7682)},t.do2=function(){var t=xt.mainContext;t.stencilFunc(514,this.level+1,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680)},t.do3=function(){var t=xt.mainContext;t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680),t.clear(1024),t.disable(2960)},t.do4=function(){var t=xt.mainContext;0==this.level&&(t.enable(2960),t.clear(1024)),t.colorMask(!1,!1,!1,!1),t.stencilFunc(519,0,255),t.stencilOp(7680,7680,7682)},t.do5=function(){var t=xt.mainContext;t.stencilFunc(514,this.level,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680)},t.do6=function(){var t=xt.mainContext;z.targetFns[z.TOINT[this.blendMode]](t)},t.do7=function(){var t=xt.mainContext;t.colorMask(!1,!1,!1,!1),t.stencilOp(7680,7680,7683)},t.do8=function(){var t=xt.mainContext;t.colorMask(!0,!0,!0,!0),t.stencilFunc(514,this.level,255),t.stencilOp(7680,7680,7680)},l.restore=function(t,e,i,n,r){var a;if((t._renderKey=0)<l._mask&&l._mask--,0==l._mask)a=laya.webgl.submit.SubmitStencil.create(3),t.addRenderObject(a),t._curSubmit=at.RENDERBASE;else{a=laya.webgl.submit.SubmitStencil.create(7),t.addRenderObject(a);var s=t._vb;s._byteLength;if(mt.fillRectImgVb(s,null,e.x,e.y,e.width,e.height,P.DEF_UV,i,n,r,0,0)){t._shader2D.glTexture=null;var o=t._curSubmit=at.createSubmit(t,t._ib,s,(s._byteLength-64)/32*3,wt.create(2,0));o.shaderValue.ALPHA=1,t._submits[t._submits._length++]=o,t._curSubmit._numEle+=6,t._curSubmit=at.RENDERBASE}else alert("clipRect calc stencil rect error");a=laya.webgl.submit.SubmitStencil.create(8),t.addRenderObject(a)}},l.restore2=function(t,e){var i;(t._renderKey=0)<l._mask&&l._mask--,0==l._mask?(i=laya.webgl.submit.SubmitStencil.create(3),t.addRenderObject(i),t._curSubmit=at.RENDERBASE):(i=laya.webgl.submit.SubmitStencil.create(7),t.addRenderObject(i),t._submits[t._submits._length++]=e,i=laya.webgl.submit.SubmitStencil.create(8),t.addRenderObject(i))},l.create=function(t){var e=l._cache._length?l._cache[--l._cache._length]:new l;return 5==(e.step=t)&&++l._mask,e.level=l._mask,e},l._cache=((l._cache=[])._length=0,l._cache),l._mask=0,l}(),ct=function(){function o(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}_(o,"laya.webgl.submit.SubmitTarget");var t=o.prototype;return T.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){this._vb.bind_upload(this._ib);var t=this.scope.getValue(this.proName);return t&&(this.shaderValue.texture=t.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[t.width,t.height]),this.shaderValue.upload(),this.blend(),A.drawCall++,A.trianglesFaces+=this._numEle/3,xt.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},t.blend=function(){if(z.activeBlendFunction!==z.fns[this.blendType]){var t=xt.mainContext;t.enable(3042),z.fns[this.blendType](t),z.activeBlendFunction=z.fns[this.blendType]}},t.getRenderType=function(){return 0},t.releaseRender=function(){var t=o._cache;t[t._length++]=this},o.create=function(t,e,i,n,r,a){var s=o._cache._length?o._cache[--o._cache._length]:new o;return s._ib=e,s._vb=i,s.proName=a,s._startIdx=n*pt.BYTES_PIDX,s._numEle=0,s.blendType=t._nBlendType,s.shaderValue=r,s.shaderValue.setValue(t._shader2D),s},o._cache=((o._cache=[])._length=0,o._cache),o}(),_t=function(){function t(){this._sourceStr=null}_(t,"laya.webgl.text.CharSegment");var e=t.prototype;return T.imps(e,{"laya.webgl.text.ICharSegment":!0}),e.textToSpit=function(t){this._sourceStr=t},e.getChar=function(t){return this._sourceStr.charAt(t)},e.getCharCode=function(t){return this._sourceStr.charCodeAt(t)},e.length=function(){return this._sourceStr.length},t}(),dt=function(){var t;function A(){}return _(A,"laya.webgl.text.DrawText"),A.__init__=function(){A._charsTemp=new Array,A._drawValue=new t,A._charSeg=new _t},A.customCharSeg=function(t){A._charSeg=t},A.getChar=function(t,e,i){var n=Xt.createOneChar(t,i);return-1!=e&&(A._charsCache[e]=n),n},A._drawSlow=function(t,e,i,n,r,a,s,o,l,h,u,c,_,d,f){var p,m,g=A._drawValue.value(a,o,l,h,_,d,f),v=0,y=0,x=A._charsTemp,E=0,T=NaN;if(n)for(x.length=n.length,v=0,y=n.length;v<y;v++)T=(m=n[v]).charNum+g.txtID,x[v]=p=A._charsCache[T]||A.getChar(m.char,T,g),p.active();else{var S=i instanceof laya.utils.WordText?i.toString():i;if(O.CharacterCache){A._charSeg.textToSpit(S);var w=A._charSeg.length();for(v=0,y=x.length=w;v<y;v++)T=A._charSeg.getCharCode(v)+g.txtID,x[v]=p=A._charsCache[T]||A.getChar(A._charSeg.getChar(v),T,g),p.active(),E+=p.cw}else x.length=0,(p=A.getChar(S,-1,g)).active(),E+=p.cw,x[0]=p}var M=0;null!==s&&"left"!==s&&(M=-("center"==s?E/2:E));var D,I,b=NaN,C=0;if(n)for(v=0,y=x.length;v<y;v++)(p=x[v]).isSpace||(m=n[v],b=p.borderSize,D=p.texture,e._drawText(D,u+M+m.x*_-b,c+m.y*d-b,D.width,D.height,r,0,0,0,0));else{for(v=0,y=x.length;v<y;v++)(p=x[v]).isSpace||(b=p.borderSize,D=p.texture,e._drawText(D,u+M-b,c-b,D.width,D.height,r,0,0,0,0),t&&((I=t[C++])||(I=t[C-1]=[]),I[0]=D,I[1]=M-b,I[2]=-b)),M+=p.cw;t&&(t.length=C)}},A._drawFast=function(t,e,i,n,r){for(var a,s,o=0,l=t.length;o<l;o++)(a=(s=t[o])[0]).active(),e._drawText(a,n+s[1],r+s[2],a.width,a.height,i,0,0,0,0)},A.drawText=function(t,e,i,n,r,a,s,o,l,h,u,c){if(void 0===c&&(c=0),!(e&&0===e.length||i&&0===i.length)){var _=n.a,d=n.d;(0!==n.b||0!==n.c)&&(_=d=1);var f=1!==_||1!==d;if(f&&T.stage.transform){var p=T.stage.transform;f=p.a===_&&p.d===d}else f=!1;if(f){var m=(n=n.copyTo(St._tmpMatrix)).tx,g=n.ty;n.scale(1/_,1/d),n._checkTransform(),h*=_,u*=d,h+=m-n.tx,u+=g-n.ty}else _=d=1;if(i)A._drawSlow(null,t,e,i,n,r,a,s,o,l,h,u,_,d,c);else{if(null===e.toUpperCase){var v=_+1e5*d,y=e;return void(y.changed||y.id!==v?(y.id=v,y.changed=!1,A._drawSlow(y.save,t,e,i,n,r,a,s,o,l,h,u,_,d,c)):A._drawFast(y.save,t,n,h,u))}var x=e+r.toString()+s+o+l+_+d+a,E=A._textsCache[x];O.CharacterCache?E?A._drawFast(E,t,n,h,u):(A._textsCache.__length||(A._textsCache.__length=0),A._textsCache.__length>S.WebGLTextCacheCount&&((A._textsCache={}).__length=0,A._curPoolIndex=0),A._textCachesPool[A._curPoolIndex]?(E=A._textsCache[x]=A._textCachesPool[A._curPoolIndex]).length=0:A._textCachesPool[A._curPoolIndex]=E=A._textsCache[x]=[],A._textsCache.__length++,A._curPoolIndex++,A._drawSlow(E,t,e,i,n,r,a,s,o,l,h,u,_,d,c)):A._drawSlow(E,t,e,i,n,r,a,s,o,l,h,u,_,d,c)}}},A._charsTemp=null,A._textCachesPool=[],A._curPoolIndex=0,A._charsCache={},A._textsCache={},A._drawValue=null,A.d=[],A._charSeg=null,A.__init$=function(){t=function(){function l(){}return _(l,""),l.prototype.value=function(t,e,i,n,r,a,s){this.font=t,this.fillColor=e,this.borderColor=i,this.lineWidth=n,this.scaleX=r,this.scaleY=a,this.underLine=s;var o=t.toString()+r+a+n+e+i+s;return this.txtID=l._keymap[o],this.txtID||(this.txtID=1e-7*++l._keymapCount,l._keymap[o]=this.txtID),this},l.clear=function(){l._keymap={},l._keymapCount=1},l._keymap={},l._keymapCount=1,l}()},A}(),ft=function(){function r(t){this._index=0,this._size=14,this._italic=-2,r._cache2=r._cache2||[],this.setFont(t||"14px Arial")}_(r,"laya.webgl.text.FontInContext");var t=r.prototype;return t.setFont=function(t){var e=r._cache2[t];if(e)this._words=e[0],this._size=e[1];else{this._words=t.split(" ");for(var i=0,n=this._words.length;i<n;i++)if(0<this._words[i].indexOf("px")){this._index=i;break}this._size=parseInt(this._words[this._index]),r._cache2[t]=[this._words,this._size]}this._text=null,this._italic=-2},t.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},t.hasType=function(t){for(var e=0,i=this._words.length;e<i;e++)if(this._words[e]===t)return e;return-1},t.removeType=function(t){for(var e=0,i=this._words.length;e<i;e++)if(this._words[e]===t){this._words.splice(e,1),this._index>e&&this._index--;break}this._text=null,this._italic=-2},t.copyTo=function(t){return t._text=this._text,t._size=this._size,t._index=this._index,t._words=this._words.slice(),t._italic=-2,t},t.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},l(0,t,"size",function(){return this._size},function(t){this._size=t,this._words[this._index]=t+"px",this._text=null}),r.create=function(t){var e=r._cache[t];return e||(e=r._cache[t]=new r(t))},r.EMPTY=new r,r._cache={},r._cache2=null,r}(),pt=function(){function t(){}return _(t,"laya.webgl.utils.CONST3D2D"),t.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],t.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],t._TMPARRAY=[],t._OFFSETX=0,t._OFFSETY=0,s(t,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),t}(),mt=function(){function f(){}return _(f,"laya.webgl.utils.GlUtils"),f.make2DProjection=function(t,e,i){return[2/t,0,0,0,0,-2/e,0,0,0,0,2/i,0,-1,1,0,1]},f.fillIBQuadrangle=function(t,e){if(65535/4<e)throw Error("IBQuadrangle count:"+e+" must<:"+Math.floor(65535/4));e=Math.floor(e),t._resizeBuffer(6*(e+1)*2,!1),t.byteLength=t.bufferLength;for(var i=t.getUint16Array(),n=0,r=0;r<e;r++)i[n++]=4*r,i[n++]=4*r+2,i[n++]=4*r+1,i[n++]=4*r,i[n++]=4*r+3,i[n++]=4*r+2;return t.setNeedUpload(),!0},f.expandIBQuadrangle=function(t,e){t.bufferLength>=6*e*2||f.fillIBQuadrangle(t,e)},f.mathCeilPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},f.fillQuadrangleImgVb=function(t,e,i,n,r,a,s,o){"use strict";var l=16+(t._byteLength>>2);t.byteLength=l<<2;var h=t.getFloat32Array();h[(l-=16)+2]=r[0],h[l+3]=r[1],h[l+6]=r[2],h[l+7]=r[3],h[l+10]=r[4],h[l+11]=r[5],h[l+14]=r[6],h[l+15]=r[7];var u=a.a,c=a.b,_=a.c,d=a.d;if(1!==u||0!==c||0!==_||1!==d){a.bTransform=!0;var f=a.tx+s,p=a.ty+o;h[l]=(n[0]+e)*u+(n[1]+i)*_+f,h[l+1]=(n[0]+e)*c+(n[1]+i)*d+p,h[l+4]=(n[2]+e)*u+(n[3]+i)*_+f,h[l+5]=(n[2]+e)*c+(n[3]+i)*d+p,h[l+8]=(n[4]+e)*u+(n[5]+i)*_+f,h[l+9]=(n[4]+e)*c+(n[5]+i)*d+p,h[l+12]=(n[6]+e)*u+(n[7]+i)*_+f,h[l+13]=(n[6]+e)*c+(n[7]+i)*d+p}else a.bTransform=!1,e+=a.tx+s,i+=a.ty+o,h[l]=e+n[0],h[l+1]=i+n[1],h[l+4]=e+n[2],h[l+5]=i+n[3],h[l+8]=e+n[4],h[l+9]=i+n[5],h[l+12]=e+n[6],h[l+13]=i+n[7];return t._upload=!0},f.fillTranglesVB=function(t,e,i,n,r,a,s){var o=(t._byteLength>>2)+n.length;t.byteLength=o<<2;var l=t.getFloat32Array();o-=n.length;for(var h=n.length,u=r.a,c=r.b,_=r.c,d=r.d,f=0;f<h;f+=4)if(l[o+f+2]=n[f+2],l[o+f+3]=n[f+3],1!==u||0!==c||0!==_||1!==d){r.bTransform=!0;var p=r.tx+a,m=r.ty+s;l[o+f]=(n[f]+e)*u+(n[f+1]+i)*_+p,l[o+f+1]=(n[f]+e)*c+(n[f+1]+i)*d+m}else r.bTransform=!1,e+=r.tx+a,i+=r.ty+s,l[o+f]=e+n[f],l[o+f+1]=i+n[f+1];return t._upload=!0},f.copyPreImgVb=function(t,e,i){var n=t._byteLength>>2;t.byteLength=n+16<<2;for(var r=t.getFloat32Array(),a=0,s=n-16;a<4;a++)r[n]=r[s]+e,++s,r[++n]=r[s]+i,++s,r[++n]=r[s],++s,r[++n]=r[s],++n,++s;t._upload=!0},f.fillRectImgVb=function(t,e,i,n,r,a,s,o,l,h,u,c,_){void 0===_&&(_=!1);var d,f,p,m,g,v,y,x,E,T,S,w,M,D,I,b,C=1,A=o.a,R=o.b,L=o.c,O=o.d,P=e&&e.width<99999999;if(1!==A||0!==R||0!==L||1!==O?(o.bTransform=!0,0===R&&0===L&&(C=23,E=r+i,T=a+n,d=A*i+(S=o.tx+l),p=A*E+S,f=O*n+(w=o.ty+h),m=O*T+w)):(C=23,o.bTransform=!1,p=(d=i+o.tx+l)+r,m=(f=n+o.ty+h)+a),P&&(g=e.x,v=e.y,y=e.width+g,x=e.height+v),1!==C){if(Math.min(d,p)>=y)return!1;if(Math.min(f,m)>=x)return!1;if(Math.max(p,d)<=g)return!1;if(Math.max(m,f)<=v)return!1}var N=t._byteLength>>2;t.byteLength=N+16<<2;var V=t.getFloat32Array();switch(V[N+2]=s[0],V[N+3]=s[1],V[N+6]=s[2],V[N+7]=s[3],V[N+10]=s[4],V[N+11]=s[5],V[N+14]=s[6],V[N+15]=s[7],C){case 1:S=o.tx+l,w=o.ty+h;var F=A*i,B=L*n,U=O*n,k=R*i,H=A*(E=r+i),z=L*(T=a+n),G=O*T,W=R*E;V[N+13]=_?(M=F+B+S,I=Math.round(M)-M,D=U+k+w,b=Math.round(D)-D,V[N]=M+I,V[N+1]=D+b,V[N+4]=H+B+S+I,V[N+5]=U+W+w+b,V[N+8]=H+z+S+I,V[N+9]=G+W+w+b,V[N+12]=F+z+S+I,G+k+w+b):(V[N]=F+B+S,V[N+1]=U+k+w,V[N+4]=H+B+S,V[N+5]=U+W+w,V[N+8]=H+z+S,V[N+9]=G+W+w,V[N+12]=F+z+S,G+k+w);break;case 23:V[N+13]=_?(M=d+u,I=Math.round(M)-M,D=f,b=Math.round(D)-D,V[N]=M+I,V[N+1]=D+b,V[N+4]=p+u+I,V[N+5]=f+b,V[N+8]=p+I,V[N+9]=m+b,V[N+12]=d+I,m+b):(V[N]=d+u,V[N+1]=f,V[N+4]=p+u,V[N+5]=f,V[N+8]=p,V[N+9]=m,V[N+12]=d,m)}return t._upload=!0},f.fillLineVb=function(t,e,i,n,r,a,s,o){"use strict";var l=.5*s,h=f._fillLineArray,u=-(n-a),c=i-r,_=Math.sqrt(u*u+c*c);u/=_,c/=_,u*=l,c*=l,h[0]=i-u,h[1]=n-c,h[4]=i+u,h[5]=n+c,h[8]=r+u,h[9]=a+c,h[12]=r-u,h[13]=a-c,o&&o.transformPointArray(h,h);var d=16+(t._byteLength>>2);return t.byteLength=d<<2,t.insertData(h,d-16),!0},f._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],f}(),gt=(function(){function l(){}_(l,"laya.webgl.utils.MatirxArray"),l.ArrayMul=function(t,e,i){if(t)if(e)for(var n=NaN,r=NaN,a=NaN,s=NaN,o=0;o<4;o++)n=t[o],r=t[o+4],a=t[o+8],s=t[o+12],i[o]=n*e[0]+r*e[1]+a*e[2]+s*e[3],i[o+4]=n*e[4]+r*e[5]+a*e[6]+s*e[7],i[o+8]=n*e[8]+r*e[9]+a*e[10]+s*e[11],i[o+12]=n*e[12]+r*e[13]+a*e[14]+s*e[15];else l.copyArray(t,i);else l.copyArray(e,i)},l.copyArray=function(t,e){if(t&&e)for(var i=0;i<t.length;i++)e[i]=t[i]}}(),function(){function e(t,e,i){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=t,this._vb=new $t(t,35048),e&&this._vb._resizeBuffer(e,!1),this._ib=new Jt,i&&this._ib._resizeBuffer(i,!1)}_(e,"laya.webgl.utils.Mesh2D");var t=e.prototype;return t.cloneWithNewVB=function(){var t=new e(this._stride,0,0);return t._ib=this._ib,t._quadNum=this._quadNum,t._attribInfo=this._attribInfo,t},t.cloneWithNewVBIB=function(){var t=new e(this._stride,0,0);return t._attribInfo=this._attribInfo,t},t.getVBW=function(){return this._vb.setNeedUpload(),this._vb},t.getVBR=function(){return this._vb},t.getIBR=function(){return this._ib},t.getIBW=function(){return this._ib.setNeedUpload(),this._ib},t.createQuadIB=function(t){this._quadNum=t,this._ib._resizeBuffer(6*t*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var e=this._ib.getUint16Array(),i=0,n=0,r=0;r<t;r++)e[i++]=n,e[i++]=n+2,e[i++]=n+1,e[i++]=n,e[i++]=n+3,e[i++]=n+2,n+=4;this._ib.setNeedUpload()},t.setAttributes=function(t){if(this._attribInfo=t,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},t.getEleNum=function(){return this._ib.getBuffer().byteLength/2},t.releaseMesh=function(){},t.destroy=function(){},t.clearVB=function(){this._vb.clear()},e._gvaoid=0,e}()),vt=function(){function r(){}return _(r,"laya.webgl.utils.RenderState2D"),r.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},r.mat2MatArray=function(t,e){var i=t,n=e;return n[0]=i.a,n[1]=i.b,n[2]=r.EMPTYMAT4_ARRAY[2],n[3]=r.EMPTYMAT4_ARRAY[3],n[4]=i.c,n[5]=i.d,n[6]=r.EMPTYMAT4_ARRAY[6],n[7]=r.EMPTYMAT4_ARRAY[7],n[8]=r.EMPTYMAT4_ARRAY[8],n[9]=r.EMPTYMAT4_ARRAY[9],n[10]=r.EMPTYMAT4_ARRAY[10],n[11]=r.EMPTYMAT4_ARRAY[11],n[12]=i.tx,n[13]=i.ty,n[14]=r.EMPTYMAT4_ARRAY[14],n[15]=r.EMPTYMAT4_ARRAY[15],e},r.restoreTempArray=function(){r.TEMPMAT4_ARRAY[0]=1,r.TEMPMAT4_ARRAY[1]=0,r.TEMPMAT4_ARRAY[4]=0,r.TEMPMAT4_ARRAY[5]=1,r.TEMPMAT4_ARRAY[12]=0,r.TEMPMAT4_ARRAY[13]=0},r.clear=function(){r.worldScissorTest=!1,r.worldShaderDefines=null,r.worldFilters=null,r.worldAlpha=1,r.worldClipRect.x=r.worldClipRect.y=0,r.worldClipRect.width=r.width,r.worldClipRect.height=r.height,r.curRenderTarget=null},r._MAXSIZE=99999999,r.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r.worldMatrix4=r.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r.worldAlpha=1,r.worldScissorTest=!1,r.worldFilters=null,r.worldShaderDefines=null,r.curRenderTarget=null,r.width=0,r.height=0,s(r,["worldMatrix",function(){return this.worldMatrix=new M},"worldClipRect",function(){return this.worldClipRect=new I(0,0,99999999,99999999)}]),r}(),yt=function(){var v,i;function y(t,e,i,n,r){var a=this;function s(t){var e=[],i=new v(e);return a._compileToTree(i,t.split("\n"),0,e,r),i}var o=d.now();this._VS=s(e),this._PS=s(i),this._nameMap=n,2<d.now()-o&&console.log("ShaderCompile use time:"+(d.now()-o)+"  size:"+e.length+"/"+i.length)}_(y,"laya.webgl.utils.ShaderCompile");var t=y.prototype;return t._compileToTree=function(t,e,i,n,r){var a,s,o,l,h,u,c,_=0,d=0,f=0,p=0;for(d=i;d<e.length;d++)if(!((o=e[d]).length<1)&&0!==(_=o.indexOf("//"))){if(0<=_&&(o=o.substr(0,_)),a=c||new v(n),c=null,a.text=o,a.noCompile=!0,0<=(_=o.indexOf("#"))){for(l="#",p=_+1,f=o.length;p<f;p++){var m=o.charAt(p);if(" "===m||"\t"===m||"?"===m)break;l+=m}switch(a.name=l){case"#ifdef":case"#ifndef":if(a.src=o,a.noCompile=null!=o.match(/[!&|()=<>]/),a.noCompile?console.log("function():Boolean{return "+o.substr(_+a.name.length)+"}"):(u=o.replace(/^\s*/,"").split(/\s+/),a.setCondition(u[1],"#ifdef"===l?1:2),a.text="//"+a.text),a.setParent(t),t=a,r)for(u=o.substr(p).split(y._splitToWordExps3),p=0;p<u.length;p++)(o=u[p]).length&&(r[o]=!0);continue;case"#if":if(a.src=o,a.noCompile=!0,a.setParent(t),t=a,r)for(u=o.substr(p).split(y._splitToWordExps3),p=0;p<u.length;p++)(o=u[p]).length&&"defined"!=o&&(r[o]=!0);continue;case"#else":a.src=o,s=(t=t.parent).childs[t.childs.length-1],a.noCompile=s.noCompile,a.noCompile||(a.condition=s.condition,a.conditionType=1==s.conditionType?2:1,a.text="//"+a.text+" "+s.text+" "+a.conditionType),a.setParent(t),t=a;continue;case"#endif":s=(t=t.parent).childs[t.childs.length-1],a.noCompile=s.noCompile,a.noCompile||(a.text="//"+a.text),a.setParent(t);continue;case"#include":u=y.splitToWords(o,null);var g=y.includes[u[1]];if(!g)throw"ShaderCompile error no this include file:"+u[1];if((_=u[0].indexOf("?"))<0){a.setParent(t),o=g.getWith("with"==u[2]?u[3]:null),this._compileToTree(a,o.split("\n"),0,n,r),a.text="";continue}a.setCondition(u[0].substr(_+1),1),a.text=g.getWith("with"==u[2]?u[3]:null);break;case"#import":h=(u=y.splitToWords(o,null))[1],n.push({node:a,file:y.includes[h],ofs:a.text.length});continue}}else{if((s=t.childs[t.childs.length-1])&&!s.name){0<n.length&&y.splitToWords(o,s),c=a,s.text+="\n"+o;continue}0<n.length&&y.splitToWords(o,a)}a.setParent(t)}},t.createShader=function(t,e,i){var n={},r="";if(t)for(var a in t)r+="#define "+a+"\n",n[a]=!0;var s=this._VS.toscript(n,[]),o=this._PS.toscript(n,[]);return(i||Zt.create)(r+s.join("\n"),r+o.join("\n"),e,this._nameMap)},y._parseOne=function(t,e,i,n,r,a){var s={type:y.shaderParamsMap[i[n+1]],name:i[n+2],size:isNaN(parseInt(i[n+3]))?1:parseInt(i[n+3])};return a&&("attribute"==r?t.push(s):e.push(s)),":"==i[n+3]&&(s.type=i[n+4],n+=2),n+=2},y.addInclude=function(t,e){if(!e||0===e.length)throw new Error("add shader include file err:"+t);if(y.includes[t])throw new Error("add shader include file err, has add:"+t);y.includes[t]=new i(e)},y.preGetParams=function(t,e){var i=[t,e],n={},r=[],a=[],s={},o=[];n.attributes=r,n.uniforms=a,n.defines=s;for(var l=0,h=0,u=0;u<2;u++){i[u]=i[u].replace(y._removeAnnotation,"");var c,_=i[u].match(y._reg);for(l=0,h=_.length;l<h;l++){var d=_[l];if("attribute"==d||"uniform"==d)l=y._parseOne(r,a,_,l,d,!0);else{if("#define"==d){o[d=_[++l]]=1;continue}if("#ifdef"==d){s[c=_[++l]]=s[c]||[];for(l++;l<h;l++)if("attribute"==(d=_[l])||"uniform"==d)l=y._parseOne(r,a,_,l,d,o[c]);else if("#else"==d)for(l++;l<h;l++)if("attribute"==(d=_[l])||"uniform"==d)l=y._parseOne(r,a,_,l,d,!o[c]);else if("#endif"==d)break}}}}return n},y.splitToWords=function(t,e){for(var i,n,r=[],a=-1,s=0,o=t.length;s<o;s++)if(i=t.charAt(s),0<=" \t=+-*/&%!<>()'\",;".indexOf(i)){if(0<=a&&1<s-a&&(n=t.substr(a,s-a),r.push(n)),'"'==i||"'"==i){var l=t.indexOf(i,s+1);if(l<0)throw"Sharder err:"+t;r.push(t.substr(s+1,l-s-1)),s=l,a=-1;continue}"("==i&&e&&0<r.length&&(n=r[r.length-1]+";","vec4;main;".indexOf(n)<0&&(e.useFuns+=n)),a=-1}else a<0&&(a=s);return a<o&&1<o-a&&(n=t.substr(a,o-a),r.push(n)),r},y.IFDEF_NO=0,y.IFDEF_YES=1,y.IFDEF_ELSE=2,y.IFDEF_PARENT=3,y._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),y._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),y._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),y.includes={},s(y,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),y.__init$=function(){v=function(){function i(t){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=t}_(i,"");var t=i.prototype;return t.setParent=function(t){t.childs.push(this),this.z=t.z+1,this.parent=t},t.setCondition=function(t,e){t&&(this.conditionType=e,t=t.replace(/(\s*$)/g,""),this.condition=function(){return this[t]},this.condition.__condition=t)},t.toscript=function(t,e){return this._toscript(t,e,++i.__id)},t._toscript=function(n,r,a){if(this.childs.length<1&&!this.text)return r;r.length;if(this.condition){var t=!!this.condition.call(n);if(2===this.conditionType&&(t=!t),!t)return r}if(this.text&&r.push(this.text),0<this.childs.length&&this.childs.forEach(function(t,e,i){t._toscript(n,r,a)}),0<this.includefiles.length&&0<this.useFuns.length)for(var e,i=0,s=this.includefiles.length;i<s;i++)this.includefiles[i].curUseID!=a&&0<(e=this.includefiles[i].file.getFunsScript(this.useFuns)).length&&(this.includefiles[i].curUseID=a,r[0]=e+r[0]);return r},i.__id=1,i}(),i=function(){function t(t){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=t;for(var e=0,i=0,n=0;!((e=t.indexOf("#begin",e))<0);){for(n=e+5;!((n=t.indexOf("#end",n))<0)&&"i"===t.charAt(n+4);)n+=5;if(n<0)throw"add include err,no #end:"+t;i=t.indexOf("\n",e);var r=y.splitToWords(t.substr(e,i-e),null);"code"==r[1]?this.codes[r[2]]=t.substr(i+1,n-i-1):"function"==r[1]&&(i=t.indexOf("function",e),i+="function".length,this.funs[r[3]]=t.substr(i+1,n-i-1),this.funnames+=r[3]+";"),e=n+1}}_(t,"");var e=t.prototype;return e.getWith=function(t){var e=t?this.codes[t]:this.script;if(!e)throw"get with error:"+t;return e},e.getFunsScript=function(t){var e="";for(var i in this.funs)0<=t.indexOf(i+";")&&(e+=this.funs[i]);return e},t}()},y}(),xt=function(){function s(){}return _(s,"laya.webgl.WebGL"),s._uint8ArraySlice=function(){for(var t=this.length,e=new Uint8Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},s._float32ArraySlice=function(){for(var t=this.length,e=new Float32Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},s._uint16ArraySlice=function(t){var e,i=arguments,n=0,r=0;if(0===i.length)for(n=this.length,e=new Uint16Array(n),r=0;r<n;r++)e[r]=this[r];else if(2===i.length){var a=i[0],s=i[1];if(a<s)for(n=s-a,e=new Uint16Array(n),r=a;r<s;r++)e[r-a]=this[r];else e=new Uint16Array(0)}return e},s.expandContext=function(){var t=r.prototype,e=CanvasRenderingContext2D.prototype;e.fillTrangles=t.fillTrangles,Kt.__int__(null),e.setIBVB=function(t,e,i,n,r,a,s,o,l,h){void 0===l&&(l=0),void 0===h&&(h=0),null===i&&(this._ib=this._ib||Jt.QuadrangleIB,i=this._ib,mt.expandIBQuadrangle(i,n._byteLength/64+8)),this._setIBVB(t,e,i,n,r,a,s,o,l,h)},e.fillTrangles=function(t,e,i,n,r){this._curMat=this._curMat||M.create(),this._vb=this._vb||$t.create(),this._ib||(this._ib=Jt.create(),mt.fillIBQuadrangle(this._ib,s/4));var a=this._vb,s=n.length>>4;mt.fillTranglesVB(a,e,i,n,r||this._curMat,0,0),mt.expandIBQuadrangle(this._ib,a._byteLength/64+8);var o=new wt(1,0);o.textureHost=t;var l=new Qt("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; void main() {vec4 color= texture2D(texture, v_texcoord); color.a*=1.0; gl_FragColor= color;}");a._vertType=3,this._setIBVB(e,i,this._ib,a,6*s,r,l,o,0,0)}},s.enable=function(){if(d.__init__(),g.isConchApp&&!g.isConchWebGL)return E.skinAniSprite=function(){return new tt},s.expandContext(),!1;if(E.getWebGLContext=function(t){for(var e,i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=0;n<i.length;n++){try{e=t.getContext(i[n],{stencil:S.isStencil,alpha:S.isAlpha,antialias:S.isAntialias,premultipliedAlpha:S.premultipliedAlpha,preserveDrawingBuffer:S.preserveDrawingBuffer})}catch(t){}if(e)return e}return null},null==(s.mainContext=E.getWebGLContext(g._mainCanvas)))return!1;if(g.isWebGL)return!0;m.create=function(t,e){return new te(t,e)},i.create=function(t,e,i,n,r,a,s){return new jt(t,e,i,n,r,a,s)},g.WebGL=s,g.isWebGL=!0,dt.__init__(),E.createRenderSprite=function(t,e){return new Mt(t,e)},E.createWebGLContext2D=function(t){return new St(t)},E.changeWebGLSize=function(t,e){laya.webgl.WebGL.onStageResize(t,e)},E.createGraphics=function(){return new Tt};var t=E.createFilterAction;return E.createFilterAction=t||function(t){return new Dt},E.clear=function(t){vt.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var e=g.context.ctx,i=0==e._submits._length||S.preserveDrawingBuffer?f.create(t)._color:C._wgColor;i&&e.clearBG(i[0],i[1],i[2],i[3]),vt.clear()},E.addToAtlas=function(t,e){void 0===e&&(e=!1);var i=t.bitmap;g.optimizeTextureMemory(t.url,t)?T.__typeof(i,"laya.webgl.resource.IMergeAtlasBitmap")&&i.allowMerageInAtlas&&i.on("recovered",t,t.addTextureToAtlas):i.enableMerageInAtlas=!1},E.isAtlas=function(t){return t instanceof laya.webgl.atlas.AtlasWebGLCanvas},k._enable(),E.beginFlush=function(){for(var t=k.instance,e=t.getAtlaserCount(),i=0;i<e;i++){var n=t.getAtlaserByIndex(i).texture;n._flashCacheImageNeedFlush&&E.flashFlushImage(n)}},E.drawToCanvas=function(t,e,i,n,r,a){(i<=0||n<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),r-=t.x,a-=t.y;var s=Vt.create(i,n,6408,5121,0,!1);s.start(),s.clear(0,0,0,0),g.context.clear(),v.renders[e]._fun(t,g.context,r,vt.height-n+a),g.context.flush(),s.end();var o=s.getData(0,0,s.width,s.height);s.recycle();var l=new Wt;l._canvas=d.createElement("canvas"),l.size(i,n);var h=l._canvas.getContext("2d");d.canvas.size(i,n);var u=d.context,c=u.createImageData(i,n);return c.data.set(new Uint8ClampedArray(o.buffer)),l._imgData=c,u.putImageData(c,0,0),h.save(),h.translate(0,n),h.scale(1,-1),h.drawImage(d.canvas.source,0,0),h.restore(),l},E.createFilterAction=function(t){var e;switch(t){case 32:e=new Dt}return e},E.addTextureToAtlas=function(t){t._uvID++,k._atlasRestore++,t.bitmap.enableMerageInAtlas&&k.instance.addToAtlas(t)},E.getTexturePixels=function(t,e,i,n,r){g.context.ctx.clear();var a=new b;a.graphics.drawTexture(t,-e,-i);var s=Vt.create(n,r);s.start(),s.clear(0,0,0,0),a.render(g.context,0,0),g.context.ctx.flush(),s.end();for(var o=s.getData(0,0,n,r),l=[],h=0,u=r-1;0<=u;u--)for(var c=0;c<n;c++)h=4*(u*n+c),l.push(o[h]),l.push(o[h+1]),l.push(o[h+2]),l.push(o[h+3]);return l},E.skinAniSprite=function(){return new tt},p.create=function(t,e){var i=new Wt;return i._imgData=e,i.flipY=!1,i},w._filterStart=function(t,e,i,n,r){var a=t.getValue("bounds"),s=Vt.create(a.width,a.height);if(s.start(),s.clear(0,0,0,0),t.addValue("src",s),t.addValue("ScissorTest",vt.worldScissorTest),vt.worldScissorTest){var o=new I;o.copyFrom(i.ctx._clipRect),t.addValue("clipRect",o),vt.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},w._filterEnd=function(t,e,i,n,r){var a=t.getValue("bounds");t.getValue("src").end();var s=Vt.create(a.width,a.height);s.start(),s.clear(0,0,0,0),t.addValue("out",s),e._set$P("_filterCache",s),e._set$P("_isHaveGlowFilter",t.getValue("_isHaveGlowFilter"))},w._EndTarget=function(t,e){if(t.getValue("src").recycle(),t.getValue("out").end(),t.getValue("ScissorTest")){vt.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),e.ctx.save();var i=t.getValue("clipRect");e.ctx.clipRect(i.x,i.y,i.width,i.height)}},w._useSrc=function(t){var e=t.getValue("out");e.end(),(e=t.getValue("src")).start(),e.clear(0,0,0,0)},w._endSrc=function(t){t.getValue("src").end()},w._useOut=function(t){var e=t.getValue("src");e.end(),(e=t.getValue("out")).start(),e.clear(0,0,0,0)},w._endOut=function(t){t.getValue("out").end()},w._recycleScope=function(t){t.recycle()},w._filter=function(t,e,i,n){var r=this._next;if(r){var a,s,o=t.filters,l=o.length;if(1==l&&32==o[0].type)return e.ctx.save(),e.ctx.setFilters([o[0]]),r._fun.call(r,t,e,i,n),void e.ctx.restore();var h=ot.create(),u=D.TEMP,c=e.ctx._getTransformMatrix(),_=M.create();c.copyTo(_);var d=0,f=0,p=!1,m=t._$P._filterCache?t._$P._filterCache:null;if(!m||t._repaint){p=t._isHaveGlowFilter(),h.addValue("_isHaveGlowFilter",p),p&&(d=50,f=25),(s=new I).copyFrom(t.getSelfBounds()),s.x+=t.x,s.y+=t.y,s.x-=t.pivotX+4,s.y-=t.pivotY+4;var g=s.x,v=s.y;if(s.width+=d+8,s.height+=d+8,u.x=s.x*_.a+s.y*_.c,u.y=s.y*_.d+s.x*_.b,s.x=u.x,s.y=u.y,u.x=s.width*_.a+s.height*_.c,u.y=s.height*_.d+s.width*_.b,s.width=u.x,s.height=u.y,s.width<=0||s.height<=0)return;m&&m.recycle(),h.addValue("bounds",s);var y=st.create([h,t,e,0,0],w._filterStart);e.addRenderObject(y),e.ctx._renderKey=0,e.ctx._shader2D.glTexture=null;var x=t.x-g+f,E=t.y-v+f;r._fun.call(r,t,e,x,E),y=st.create([h,t,e,0,0],w._filterEnd),e.addRenderObject(y);for(var T=0;T<l;T++){0!=T&&(y=st.create([h],w._useSrc),e.addRenderObject(y),a=wt.create(1,0),M.TEMP.identity(),e.ctx.drawTarget(h,0,0,s.width,s.height,M.TEMP,"out",a,null,z.TOINT.overlay),y=st.create([h],w._useOut),e.addRenderObject(y)),o[T].action.apply3d(h,t,e,0,0)}y=st.create([h,e],w._EndTarget),e.addRenderObject(y)}else{if((p=!!t._$P._isHaveGlowFilter&&t._$P._isHaveGlowFilter)&&(d=50,f=25),(s=t.getBounds()).width<=0||s.height<=0)return;s.width+=d,s.height+=d,u.x=s.x*_.a+s.y*_.c,u.y=s.y*_.d+s.x*_.b,s.x=u.x,s.y=u.y,u.x=s.width*_.a+s.height*_.c,u.y=s.height*_.d+s.width*_.b,s.width=u.x,s.height=u.y,h.addValue("out",m)}i=i-f-t.x,n=n-f-t.y,u.setTo(i,n),_.transformPoint(u),i=u.x+s.x,n=u.y+s.y,a=wt.create(1,0),M.TEMP.identity(),e.ctx.drawTarget(h,i,n,s.width,s.height,M.TEMP,"out",a,null,z.TOINT.overlay),y=st.create([h],w._recycleScope),e.addRenderObject(y),_.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=s._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=s._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=s._uint8ArraySlice),!0},s.onStageResize=function(t,e){null!=s.mainContext&&(s.mainContext.viewport(0,0,t,e),vt.width=t,vt.height=e)},s.onInvalidGLRes=function(){k.instance.freeAll(),x.releaseContentManagers(!0),s.doNodeRepaint(T.stage),s.mainContext.viewport(0,0,vt.width,vt.height),T.stage.event("devicelost")},s.doNodeRepaint=function(t){0==t.numChildren&&t.repaint();for(var e=0;e<t.numChildren;e++)s.doNodeRepaint(t.getChildAt(e))},s.init=function(t,e,i){s.mainCanvas=t,p._createContext=function(t){return new St(t)},Wt._createContext=function(t){return new St(t)};var n=laya.webgl.WebGL.mainContext;if(null!=n.getShaderPrecisionFormat){var r=n.getShaderPrecisionFormat(35633,36338),a=n.getShaderPrecisionFormat(35632,36338);s.shaderHighPrecision=!(!r.precision||!a.precision)}else s.shaderHighPrecision=!1;if(s.compressAstc=n.getExtension("WEBGL_compressed_texture_astc"),s.compressAtc=n.getExtension("WEBGL_compressed_texture_atc"),s.compressEtc=n.getExtension("WEBGL_compressed_texture_etc"),s.compressEtc1=n.getExtension("WEBGL_compressed_texture_etc1"),s.compressPvrtc=n.getExtension("WEBGL_compressed_texture_pvrtc"),s.compressS3tc=n.getExtension("WEBGL_compressed_texture_s3tc"),s.compressS3tc_srgb=n.getExtension("WEBGL_compressed_texture_s3tc_srgb"),n.deleteTexture1=n.deleteTexture,n.deleteTexture=function(t){t==Et.curBindTexValue&&(Et.curBindTexValue=null),n.deleteTexture1(t)},s.onStageResize(e,i),null==s.mainContext)throw new Error("webGL getContext err!");L.__init__(),k.__init__(),bt.__init__(),at.__init__(),St.__init__(),wt.__init__(),J.__init__(),Kt.__int__(n),z._init_(n),g.isConchApp&&conch.setOnInvalidGLRes(s.onInvalidGLRes)},s.compressAstc=null,s.compressAtc=null,s.compressEtc=null,s.compressEtc1=null,s.compressPvrtc=null,s.compressS3tc=null,s.compressS3tc_srgb=null,s.mainCanvas=null,s.mainContext=null,s.antialias=!0,s.shaderHighPrecision=!1,s._bg_null=[0,0,0,0],s}(),Et=function(){function n(){}return _(n,"laya.webgl.WebGLContext"),n.UseProgram=function(t){return n._useProgram!==t&&(xt.mainContext.useProgram(t),n._useProgram=t,!0)},n.setDepthTest=function(t,e){e!==n._depthTest&&((n._depthTest=e)?t.enable(2929):t.disable(2929))},n.setDepthMask=function(t,e){e!==n._depthMask&&(n._depthMask=e,t.depthMask(e))},n.setDepthFunc=function(t,e){e!==n._depthFunc&&(n._depthFunc=e,t.depthFunc(e))},n.setBlend=function(t,e){e!==n._blend&&((n._blend=e)?t.enable(3042):t.disable(3042))},n.setBlendFunc=function(t,e,i){(e!==n._sFactor||i!==n._dFactor)&&(n._sFactor=e,n._dFactor=i,t.blendFunc(e,i))},n.setCullFace=function(t,e){e!==n._cullFace&&((n._cullFace=e)?t.enable(2884):t.disable(2884))},n.setFrontFace=function(t,e){e!==n._frontFace&&(n._frontFace=e,t.frontFace(e))},n.bindTexture=function(t,e,i){t.bindTexture(e,i),n.curBindTexTarget=e,n.curBindTexValue=i},n.DEPTH_BUFFER_BIT=256,n.STENCIL_BUFFER_BIT=1024,n.COLOR_BUFFER_BIT=16384,n.POINTS=0,n.LINES=1,n.LINE_LOOP=2,n.LINE_STRIP=3,n.TRIANGLES=4,n.TRIANGLE_STRIP=5,n.TRIANGLE_FAN=6,n.ZERO=0,n.ONE=1,n.SRC_COLOR=768,n.ONE_MINUS_SRC_COLOR=769,n.SRC_ALPHA=770,n.ONE_MINUS_SRC_ALPHA=771,n.DST_ALPHA=772,n.ONE_MINUS_DST_ALPHA=773,n.DST_COLOR=774,n.ONE_MINUS_DST_COLOR=775,n.SRC_ALPHA_SATURATE=776,n.FUNC_ADD=32774,n.BLEND_EQUATION=32777,n.BLEND_EQUATION_RGB=32777,n.BLEND_EQUATION_ALPHA=34877,n.FUNC_SUBTRACT=32778,n.FUNC_REVERSE_SUBTRACT=32779,n.BLEND_DST_RGB=32968,n.BLEND_SRC_RGB=32969,n.BLEND_DST_ALPHA=32970,n.BLEND_SRC_ALPHA=32971,n.CONSTANT_COLOR=32769,n.ONE_MINUS_CONSTANT_COLOR=32770,n.CONSTANT_ALPHA=32771,n.ONE_MINUS_CONSTANT_ALPHA=32772,n.BLEND_COLOR=32773,n.ARRAY_BUFFER=34962,n.ELEMENT_ARRAY_BUFFER=34963,n.ARRAY_BUFFER_BINDING=34964,n.ELEMENT_ARRAY_BUFFER_BINDING=34965,n.STREAM_DRAW=35040,n.STATIC_DRAW=35044,n.DYNAMIC_DRAW=35048,n.BUFFER_SIZE=34660,n.BUFFER_USAGE=34661,n.CURRENT_VERTEX_ATTRIB=34342,n.FRONT=1028,n.BACK=1029,n.CULL_FACE=2884,n.FRONT_AND_BACK=1032,n.BLEND=3042,n.DITHER=3024,n.STENCIL_TEST=2960,n.DEPTH_TEST=2929,n.SCISSOR_TEST=3089,n.POLYGON_OFFSET_FILL=32823,n.SAMPLE_ALPHA_TO_COVERAGE=32926,n.SAMPLE_COVERAGE=32928,n.NO_ERROR=0,n.INVALID_ENUM=1280,n.INVALID_VALUE=1281,n.INVALID_OPERATION=1282,n.OUT_OF_MEMORY=1285,n.CW=2304,n.CCW=2305,n.LINE_WIDTH=2849,n.ALIASED_POINT_SIZE_RANGE=33901,n.ALIASED_LINE_WIDTH_RANGE=33902,n.CULL_FACE_MODE=2885,n.FRONT_FACE=2886,n.DEPTH_RANGE=2928,n.DEPTH_WRITEMASK=2930,n.DEPTH_CLEAR_VALUE=2931,n.DEPTH_FUNC=2932,n.STENCIL_CLEAR_VALUE=2961,n.STENCIL_FUNC=2962,n.STENCIL_FAIL=2964,n.STENCIL_PASS_DEPTH_FAIL=2965,n.STENCIL_PASS_DEPTH_PASS=2966,n.STENCIL_REF=2967,n.STENCIL_VALUE_MASK=2963,n.STENCIL_WRITEMASK=2968,n.STENCIL_BACK_FUNC=34816,n.STENCIL_BACK_FAIL=34817,n.STENCIL_BACK_PASS_DEPTH_FAIL=34818,n.STENCIL_BACK_PASS_DEPTH_PASS=34819,n.STENCIL_BACK_REF=36003,n.STENCIL_BACK_VALUE_MASK=36004,n.STENCIL_BACK_WRITEMASK=36005,n.VIEWPORT=2978,n.SCISSOR_BOX=3088,n.COLOR_CLEAR_VALUE=3106,n.COLOR_WRITEMASK=3107,n.UNPACK_ALIGNMENT=3317,n.PACK_ALIGNMENT=3333,n.MAX_TEXTURE_SIZE=3379,n.MAX_VIEWPORT_DIMS=3386,n.SUBPIXEL_BITS=3408,n.RED_BITS=3410,n.GREEN_BITS=3411,n.BLUE_BITS=3412,n.ALPHA_BITS=3413,n.DEPTH_BITS=3414,n.STENCIL_BITS=3415,n.POLYGON_OFFSET_UNITS=10752,n.POLYGON_OFFSET_FACTOR=32824,n.TEXTURE_BINDING_2D=32873,n.SAMPLE_BUFFERS=32936,n.SAMPLES=32937,n.SAMPLE_COVERAGE_VALUE=32938,n.SAMPLE_COVERAGE_INVERT=32939,n.NUM_COMPRESSED_TEXTURE_FORMATS=34466,n.COMPRESSED_TEXTURE_FORMATS=34467,n.DONT_CARE=4352,n.FASTEST=4353,n.NICEST=4354,n.GENERATE_MIPMAP_HINT=33170,n.BYTE=5120,n.UNSIGNED_BYTE=5121,n.SHORT=5122,n.UNSIGNED_SHORT=5123,n.INT=5124,n.UNSIGNED_INT=5125,n.FLOAT=5126,n.DEPTH_COMPONENT=6402,n.ALPHA=6406,n.RGB=6407,n.RGBA=6408,n.LUMINANCE=6409,n.LUMINANCE_ALPHA=6410,n.UNSIGNED_SHORT_4_4_4_4=32819,n.UNSIGNED_SHORT_5_5_5_1=32820,n.UNSIGNED_SHORT_5_6_5=33635,n.FRAGMENT_SHADER=35632,n.VERTEX_SHADER=35633,n.MAX_VERTEX_ATTRIBS=34921,n.MAX_VERTEX_UNIFORM_VECTORS=36347,n.MAX_VARYING_VECTORS=36348,n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,n.MAX_TEXTURE_IMAGE_UNITS=34930,n.MAX_FRAGMENT_UNIFORM_VECTORS=36349,n.SHADER_TYPE=35663,n.DELETE_STATUS=35712,n.LINK_STATUS=35714,n.VALIDATE_STATUS=35715,n.ATTACHED_SHADERS=35717,n.ACTIVE_UNIFORMS=35718,n.ACTIVE_ATTRIBUTES=35721,n.SHADING_LANGUAGE_VERSION=35724,n.CURRENT_PROGRAM=35725,n.NEVER=512,n.LESS=513,n.EQUAL=514,n.LEQUAL=515,n.GREATER=516,n.NOTEQUAL=517,n.GEQUAL=518,n.ALWAYS=519,n.KEEP=7680,n.REPLACE=7681,n.INCR=7682,n.DECR=7683,n.INVERT=5386,n.INCR_WRAP=34055,n.DECR_WRAP=34056,n.VENDOR=7936,n.RENDERER=7937,n.VERSION=7938,n.NEAREST=9728,n.LINEAR=9729,n.NEAREST_MIPMAP_NEAREST=9984,n.LINEAR_MIPMAP_NEAREST=9985,n.NEAREST_MIPMAP_LINEAR=9986,n.LINEAR_MIPMAP_LINEAR=9987,n.TEXTURE_MAG_FILTER=10240,n.TEXTURE_MIN_FILTER=10241,n.TEXTURE_WRAP_S=10242,n.TEXTURE_WRAP_T=10243,n.TEXTURE_2D=3553,n.TEXTURE=5890,n.TEXTURE_CUBE_MAP=34067,n.TEXTURE_BINDING_CUBE_MAP=34068,n.TEXTURE_CUBE_MAP_POSITIVE_X=34069,n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,n.MAX_CUBE_MAP_TEXTURE_SIZE=34076,n.TEXTURE0=33984,n.TEXTURE1=33985,n.TEXTURE2=33986,n.TEXTURE3=33987,n.TEXTURE4=33988,n.TEXTURE5=33989,n.TEXTURE6=33990,n.TEXTURE7=33991,n.TEXTURE8=33992,n.TEXTURE9=33993,n.TEXTURE10=33994,n.TEXTURE11=33995,n.TEXTURE12=33996,n.TEXTURE13=33997,n.TEXTURE14=33998,n.TEXTURE15=33999,n.TEXTURE16=34e3,n.TEXTURE17=34001,n.TEXTURE18=34002,n.TEXTURE19=34003,n.TEXTURE20=34004,n.TEXTURE21=34005,n.TEXTURE22=34006,n.TEXTURE23=34007,n.TEXTURE24=34008,n.TEXTURE25=34009,n.TEXTURE26=34010,n.TEXTURE27=34011,n.TEXTURE28=34012,n.TEXTURE29=34013,n.TEXTURE30=34014,n.TEXTURE31=34015,n.ACTIVE_TEXTURE=34016,n.REPEAT=10497,n.CLAMP_TO_EDGE=33071,n.MIRRORED_REPEAT=33648,n.FLOAT_VEC2=35664,n.FLOAT_VEC3=35665,n.FLOAT_VEC4=35666,n.INT_VEC2=35667,n.INT_VEC3=35668,n.INT_VEC4=35669,n.BOOL=35670,n.BOOL_VEC2=35671,n.BOOL_VEC3=35672,n.BOOL_VEC4=35673,n.FLOAT_MAT2=35674,n.FLOAT_MAT3=35675,n.FLOAT_MAT4=35676,n.SAMPLER_2D=35678,n.SAMPLER_CUBE=35680,n.VERTEX_ATTRIB_ARRAY_ENABLED=34338,n.VERTEX_ATTRIB_ARRAY_SIZE=34339,n.VERTEX_ATTRIB_ARRAY_STRIDE=34340,n.VERTEX_ATTRIB_ARRAY_TYPE=34341,n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,n.VERTEX_ATTRIB_ARRAY_POINTER=34373,n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,n.COMPILE_STATUS=35713,n.LOW_FLOAT=36336,n.MEDIUM_FLOAT=36337,n.HIGH_FLOAT=36338,n.LOW_INT=36339,n.MEDIUM_INT=36340,n.HIGH_INT=36341,n.FRAMEBUFFER=36160,n.RENDERBUFFER=36161,n.RGBA4=32854,n.RGB5_A1=32855,n.RGB565=36194,n.DEPTH_COMPONENT16=33189,n.STENCIL_INDEX=6401,n.STENCIL_INDEX8=36168,n.DEPTH_STENCIL=34041,n.RENDERBUFFER_WIDTH=36162,n.RENDERBUFFER_HEIGHT=36163,n.RENDERBUFFER_INTERNAL_FORMAT=36164,n.RENDERBUFFER_RED_SIZE=36176,n.RENDERBUFFER_GREEN_SIZE=36177,n.RENDERBUFFER_BLUE_SIZE=36178,n.RENDERBUFFER_ALPHA_SIZE=36179,n.RENDERBUFFER_DEPTH_SIZE=36180,n.RENDERBUFFER_STENCIL_SIZE=36181,n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,n.COLOR_ATTACHMENT0=36064,n.DEPTH_ATTACHMENT=36096,n.STENCIL_ATTACHMENT=36128,n.DEPTH_STENCIL_ATTACHMENT=33306,n.NONE=0,n.FRAMEBUFFER_COMPLETE=36053,n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,n.FRAMEBUFFER_UNSUPPORTED=36061,n.FRAMEBUFFER_BINDING=36006,n.RENDERBUFFER_BINDING=36007,n.MAX_RENDERBUFFER_SIZE=34024,n.INVALID_FRAMEBUFFER_OPERATION=1286,n.UNPACK_FLIP_Y_WEBGL=37440,n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,n.CONTEXT_LOST_WEBGL=37442,n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,n.BROWSER_DEFAULT_WEBGL=37444,n._useProgram=null,n._depthTest=!0,n._depthMask=!0,n._blend=!1,n._cullFace=!1,n.curBindTexTarget=null,n.curBindTexValue=null,s(n,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),n}(),Tt=function(t){function e(){e.__super.call(this)}_(e,"laya.webgl.display.GraphicsGL",h);var i=e.prototype;return i.setShader=function(t){this._saveToCmd(g.context._setShader,[t])},i.setIBVB=function(t,e,i,n,r,a){this._saveToCmd(g.context._setIBVB,[t,e,i,n,r,a])},i.drawParticle=function(t,e,i){var n=E.createParticleTemplate2D(i);n.x=t,n.y=e,this._saveToCmd(g.context._drawParticle,[n])},e}(),St=function(t){var i;function U(t){this._x=0,this._y=0,this._id=++U._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,U.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=U.MAXCLIPRECT,this.mOutPoint,this._canvas=t,U._contextcount++,g.isFlash?(this._ib=Jt.create(35044),mt.fillIBQuadrangle(this._ib,16)):this._ib=Jt.QuadrangleIB,this.clear()}_(U,"laya.webgl.canvas.WebGLContext2D",r);var e=U.prototype;return e.setIsMainContext=function(){this._isMain=!0},e.clearBG=function(t,e,i,n){var r=xt.mainContext;r.clearColor(t,e,i,n),r.clear(16384)},e._getSubmits=function(){return this._submits},e._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},e.destroy=function(){--U._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas=null,this._ib&&this._ib!=Jt.QuadrangleIB&&this._ib.releaseResource()},e.clear=function(){this._submits||(this._other=i.DEFAULT,this._curMat=M.create(),this._vb=$t.create(-1),this._submits=[],this._save=[Z.Create(this)],this._save.length=10,this._shader2D=new J,this._triangleMesh=Pt.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=i.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=U.MAXCLIPRECT,this._curSubmit=at.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=G.DEFAULT;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},e.size=function(t,e){if(this._width!=t||this._height!=e)if(0==t||0==e){0!=this._vb._byteLength&&(this._width=t,this._height=e,this._vb.clear(),this._vb.upload());for(var i=0,n=this._submits._length;i<n;i++)this._submits[i].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=t,this._height=e,this._targets&&this._targets.size(t,e),this._canvas.memorySize-=this._canvas.memorySize;0===t&&0===e&&this._releaseMem()},e._getTransformMatrix=function(){return this._curMat},e.translate=function(t,e){0===t&&0===e||(q.save(this),this._curMat.bTransform&&(K.save(this),this._curMat.transformPointN(D.TEMP.setTo(t,e)),t=D.TEMP.x,e=D.TEMP.y),this._x+=t,this._y+=e)},e.save=function(){this._save[this._save._length++]=Z.Create(this)},e.restore=function(){var t=this._save._length;if(!(t<1))for(var e=t-1;0<=e;e--){var i=this._save[e];if(i.restore(this),i.isSaveMark())return void(this._save._length=e)}},e._fillText=function(t,e,i,n,r,a,s,o,l,h){void 0===h&&(h=0);var u=this._shader2D,c=this._curSubmit.shaderValue,_=r?ft.create(r):this._other.font;if(k.enabled)u.ALPHA!==c.ALPHA&&(u.glTexture=null),dt.drawText(this,t,e,this._curMat,_,l||this._other.textAlign,a,s,o,i,n,h);else{this._shader2D.defines.getValue();var d=a?f.create(a)._color:u.colorAdd;u.ALPHA===c.ALPHA&&d===u.colorAdd&&c.colorAdd===u.colorAdd||(u.glTexture=null,u.colorAdd=d),dt.drawText(this,t,e,this._curMat,_,l||this._other.textAlign,a,s,o,i,n,h)}},e.fillWords=function(t,e,i,n,r,a){this._fillText(null,t,e,i,n,r,null,-1,null,a)},e.fillBorderWords=function(t,e,i,n,r,a,s){this._fillBorderText(null,t,e,i,n,r,a,s,null)},e.fillText=function(t,e,i,n,r,a){this._fillText(t,null,e,i,n,r,null,-1,a)},e.strokeText=function(t,e,i,n,r,a,s){this._fillText(t,null,e,i,n,null,r,a||1,s)},e.fillBorderText=function(t,e,i,n,r,a,s,o){this._fillBorderText(t,null,e,i,n,r,a,s,o)},e._fillBorderText=function(t,e,i,n,r,a,s,o,l){if(!k.enabled)return this._fillText(t,e,i,n,r,null,s,o||1,l),void this._fillText(t,e,i,n,r,a,null,-1,l);var h=this._shader2D,u=this._curSubmit.shaderValue;h.ALPHA!==u.ALPHA&&(h.glTexture=null);var c=r?(U._fontTemp.setFont(r),U._fontTemp):this._other.font;dt.drawText(this,t,e,this._curMat,c,l||this._other.textAlign,a,s,o||1,i,n,0)},e.fillRect=function(t,e,i,n,r){var a=this._vb;if(mt.fillRectImgVb(a,this._clipRect,t,e,i,n,P.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var s=this._shader2D.fillStyle;r&&(this._shader2D.fillStyle=G.create(r));var o=this._shader2D,l=this._curSubmit.shaderValue;if(o.fillStyle!==l.fillStyle||o.ALPHA!==l.ALPHA){o.glTexture=null;var h=this._curSubmit=at.createSubmit(this,this._ib,a,(a._byteLength-64)/32*3,wt.create(2,0));h.shaderValue.color=o.fillStyle._color._color,h.shaderValue.ALPHA=o.ALPHA,this._submits[this._submits._length++]=h}this._curSubmit._numEle+=6,this._shader2D.fillStyle=s}},e.fillTexture=function(t,e,i,n,r,a,s,o){if(t.loaded&&t.bitmap&&t.source){var l=this._vb,h=t.bitmap.width,u=t.bitmap.height,c=t.uv,_=s.x%t.width,d=s.y%t.height;if(h!=o.w||u!=o.h){if(!o.w&&!o.h)switch(o.oy=o.ox=0,a){case"repeat":o.width=n,o.height=r;break;case"repeat-x":o.width=n,d<0?t.height+d>r?o.height=r:o.height=t.height+d:(o.oy=d,t.height+d>r?o.height=r-d:o.height=t.height);break;case"repeat-y":_<0?t.width+_>n?o.width=n:o.width=t.width+_:(o.ox=_,t.width+_>n?o.width=n-_:o.width=t.width),o.height=r;break;default:o.width=n,o.height=r}o.w=h,o.h=u,o.uv=[0,0,o.width/h,0,o.width/h,o.height/u,0,o.height/u]}if(e+=o.ox,i+=o.oy,_-=o.ox,d-=o.oy,mt.fillRectImgVb(l,this._clipRect,e,i,o.width,o.height,o.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var f=Ot.create(this,this._ib,l,(l._byteLength-64)/32*3,wt.create(256,0)),p=(this._submits[this._submits._length++]=f).shaderValue;p.textureHost=t;var m=c[0]*h,g=c[1]*u,v=(c[2]-c[0])*h,y=(c[5]-c[3])*u,x=-_/h,E=-d/u;p.u_TexRange[0]=m/h,p.u_TexRange[1]=v/h,p.u_TexRange[2]=g/u,p.u_TexRange[3]=y/u,p.u_offset[0]=x,p.u_offset[1]=E,k.enabled&&!this._isMain&&f.addTexture(t,(l._byteLength>>2)-16),(this._curSubmit=f)._renderType=10017,f._numEle+=6}}else this.sprite&&T.timer.callLater(this,this._repaintSprite)},e.setShader=function(t){X.save(this,1048576,this._shader2D,!0),this._shader2D.shader=t},e.setFilters=function(t){X.save(this,2097152,this._shader2D,!0),this._shader2D.filters=t,this._curSubmit=at.RENDERBASE,this._renderKey=0,this._drawCount++},e.drawTexture=function(t,e,i,n,r,a,s){this._drawTextureM(t,e,i,n,r,a,s,null,1)},e.addTextureVb=function(t,e,i){var n=this._curSubmit._vb||this._vb,r=n._byteLength>>2;n.byteLength=r+16<<2;for(var a=n.getFloat32Array(),s=0;s<16;s+=4)a[r++]=t[s]+e,a[r++]=t[s+1]+i,a[r++]=t[s+2],a[r++]=t[s+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),n._upload=!0},e.willDrawTexture=function(t,e){if(!(t.loaded&&t.bitmap&&t.source))return this.sprite&&T.timer.callLater(this,this._repaintSprite),0;var i=t.bitmap,n=i.id+this._shader2D.ALPHA*e+10016;if(n==this._renderKey)return n;var r=this._shader2D,a=r.ALPHA,s=this._curSubmit.shaderValue;r.ALPHA*=e,this._renderKey=n,this._drawCount++,r.glTexture=i;var o=this._vb,l=null,h=o._byteLength/32*3;return l=Ot.create(this,this._ib,o,h,wt.create(1,0)),(this._submits[this._submits._length++]=l).shaderValue.textureHost=t,l._renderType=10016,l._preIsSameTextureShader=10016===this._curSubmit._renderType&&r.ALPHA===s.ALPHA,this._curSubmit=l,r.ALPHA=a,n},e.drawTextures=function(t,e,i,n){if(t.loaded&&t.bitmap&&t.source){var r=this._clipRect;if(this._clipRect=U.MAXCLIPRECT,this._drawTextureM(t,e[0],e[1],t.width,t.height,i,n,null,1)){if(this._clipRect=r,A.drawCall++,!(e.length<4)){for(var a=this._curSubmit._vb||this._vb,s=this._curMat.a,o=this._curMat.d,l=2,h=e.length;l<h;l+=2)mt.copyPreImgVb(a,(e[l]-e[l-2])*s,(e[l+1]-e[l-1])*o),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&T.timer.callLater(this,this._repaintSprite)},e._drawTextureM=function(t,e,i,n,r,a,s,o,l){if(!t.loaded||!t.source)return this.sprite&&T.timer.callLater(this,this._repaintSprite),!1;var h=this._curSubmit._vb||this._vb,u=t.bitmap;e+=a,i+=s,this._drawCount++;var c=u.id+this._shader2D.ALPHA*l+10016;if(c!=this._renderKey){this._renderKey=c;var _=this._curSubmit.shaderValue,d=this._shader2D,f=d.ALPHA;d.ALPHA*=l,d.glTexture=u;var p=this._vb,m=null,g=p._byteLength/32*3;m=Ot.create(this,this._ib,p,g,wt.create(1,0)),(this._submits[this._submits._length++]=m).shaderValue.textureHost=t,m._renderType=10016,m._preIsSameTextureShader=10016===this._curSubmit._renderType&&d.ALPHA===_.ALPHA,this._curSubmit=m,h=this._curSubmit._vb||this._vb,d.ALPHA=f}return!!mt.fillRectImgVb(h,this._clipRect,e,i,n||t.width,r||t.height,t.uv,o||this._curMat,this._x,this._y,0,0)&&(k.enabled&&!this._isMain&&this._curSubmit.addTexture(t,(h._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},e._repaintSprite=function(){this.sprite&&this.sprite.repaint()},e._drawText=function(t,e,i,n,r,a,s,o,l,h){var u=t.bitmap;this._drawCount++;var c=u.id+this._shader2D.ALPHA+10016;if(c!=this._renderKey){this._renderKey=c;var _=this._curSubmit.shaderValue,d=this._shader2D;d.glTexture=u;var f=this._vb,p=null,m=f._byteLength/32*3;(p=k.enabled?Ot.create(this,this._ib,f,m,wt.create(1,0)):Ot.create(this,this._ib,f,m,qt.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&d.ALPHA===_.ALPHA,(this._submits[this._submits._length++]=p).shaderValue.textureHost=t,p._renderType=10016,this._curSubmit=p}t.active();var g=this._curSubmit._vb||this._vb;mt.fillRectImgVb(g,this._clipRect,e+s,i+o,n||t.width,r||t.height,t.uv,a||this._curMat,this._x,this._y,l,h,!0)&&(k.enabled&&!this._isMain&&this._curSubmit.addTexture(t,(g._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},e.drawTextureWithTransform=function(t,e,i,n,r,a,s,o,l){if(a){var h=this._curMat,u=this._x,c=this._y;(0!==s||0!==o)&&(this._x=s*h.a+o*h.c,this._y=o*h.d+s*h.b),a&&h.bTransform?(M.mul(a,h,U._tmpMatrix),(a=U._tmpMatrix)._checkTransform()):(this._x+=h.tx,this._y+=h.ty),this._drawTextureM(t,e,i,n,r,0,0,a,l),this._x=u,this._y=c}else this._drawTextureM(t,e,i,n,r,s,o,null,l)},e.fillQuadrangle=function(t,e,i,n,r){var a=this._curSubmit,s=this._vb,o=this._shader2D,l=a.shaderValue;if(this._renderKey=0,t.bitmap){var h=t.bitmap;o.glTexture==h&&o.ALPHA===l.ALPHA||(o.glTexture=h,(a=this._curSubmit=at.createSubmit(this,this._ib,s,s._byteLength/32*3,wt.create(1,0))).shaderValue.glTexture=h,this._submits[this._submits._length++]=a),mt.fillQuadrangleImgVb(s,e,i,n,t.uv,r||this._curMat,this._x,this._y)}else a.shaderValue.fillStyle&&a.shaderValue.fillStyle.equal(t)&&o.ALPHA===l.ALPHA||(o.glTexture=null,(a=this._curSubmit=at.createSubmit(this,this._ib,s,s._byteLength/32*3,wt.create(2,0))).shaderValue.defines.add(2),a.shaderValue.fillStyle=G.create(t),this._submits[this._submits._length++]=a),mt.fillQuadrangleImgVb(s,e,i,n,P.DEF_UV,r||this._curMat,this._x,this._y);a._numEle+=6},e.drawTexture2=function(t,e,i,n,r,a,s,o){if(0!=a){var l=this._curMat;if(this._x=t*l.a+e*l.c,this._y=e*l.d+t*l.b,r&&(r=l.bTransform||r.bTransform?(M.mul(r,l,U._tmpMatrix),U._tmpMatrix):(this._x+=r.tx+l.tx,this._y+=r.ty+l.ty,M.EMPTY)),1!==a||s){var h=this._shader2D.ALPHA,u=this._nBlendType;this._shader2D.ALPHA=a,s&&(this._nBlendType=z.TOINT(s)),this._drawTextureM(o[0],o[1]-i,o[2]-n,o[3],o[4],0,0,r,1),this._shader2D.ALPHA=h,this._nBlendType=u}else this._drawTextureM(o[0],o[1]-i,o[2]-n,o[3],o[4],0,0,r,1);this._x=this._y=0}},e.drawCanvas=function(t,e,i,n,r){var a=t.context;if(this._renderKey=0,a._targets)this._submits[this._submits._length++]=Lt.create(a,0,null),this._curSubmit=at.RENDERBASE,a._targets.drawTo(this,e,i,n,r);else{var s=this._submits[this._submits._length++]=Lt.create(a,this._shader2D.ALPHA,this._shader2D.filters),o=n/t.width,l=r/t.height,h=s._matrix;this._curMat.copyTo(h),1!=o&&1!=l&&h.scale(o,l);var u=h.tx,c=h.ty;h.tx=h.ty=0,h.transformPoint(D.TEMP.setTo(e,i)),h.translate(D.TEMP.x+u,D.TEMP.y+c),this._curSubmit=at.RENDERBASE}S.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=a._targets?"yellow":"green",this.strokeRect(e-1,i-1,n+2,r+2,1),this.strokeRect(e,i,n,r,1),this.restore())},e.drawTarget=function(t,e,i,n,r,a,s,o,l,h){void 0===h&&(h=-1);var u=this._vb;if(mt.fillRectImgVb(u,this._clipRect,e,i,n,r,l||P.DEF_UV,a||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var c=this._curSubmit=ct.create(this,this._ib,u,(u._byteLength-64)/32*3,o,s);c.blendType=-1==h?this._nBlendType:h,c.scope=t,this._submits[this._submits._length++]=c,this._curSubmit._numEle+=6}},e.mixRGBandAlpha=function(t){return this._mixRGBandAlpha(t,this._shader2D.ALPHA)},e._mixRGBandAlpha=function(t,e){var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24},e.drawTriangles=function(t,e,i,n,r,a,s,o,l,h){if(!t.loaded||!t.source)return this.sprite&&T.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;t.bitmap;var u=this._mixRGBandAlpha(4294967295,o),c=(n.length,a.length);this._renderKey=-1;var _=this._curSubmit=Ot.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,wt.create(1,0));return _.shaderValue.textureHost=t,_._renderType=10016,this._submits[this._submits._length++]=_,s?(U._tmpMatrix.a=s.a,U._tmpMatrix.b=s.b,U._tmpMatrix.c=s.c,U._tmpMatrix.d=s.d,U._tmpMatrix.tx=s.tx+e,U._tmpMatrix.ty=s.ty+i,M.mul(U._tmpMatrix,this._curMat,U._tmpMatrix)):(U._tmpMatrix.a=this._curMat.a,U._tmpMatrix.b=this._curMat.b,U._tmpMatrix.c=this._curMat.c,U._tmpMatrix.d=this._curMat.d,U._tmpMatrix.tx=this._curMat.tx+e,U._tmpMatrix.ty=this._curMat.ty+i),this._triangleMesh.addData(n,r,a,U._tmpMatrix,u,this),this._curSubmit._numEle+=c,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},e.transform=function(t,e,i,n,r,a){K.save(this),M.mul(M.TEMP.setTo(t,e,i,n,r,a),this._curMat,this._curMat),this._curMat._checkTransform()},e.setTransformByMatrix=function(t){t.copyTo(this._curMat)},e.transformByMatrix=function(t){K.save(this),M.mul(t,this._curMat,this._curMat),this._curMat._checkTransform()},e.rotate=function(t){K.save(this),this._curMat.rotateEx(t)},e.scale=function(t,e){K.save(this),this._curMat.scaleEx(t,e)},e.clipRect=function(t,e,i,n){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var r=ut.create(4);this.addRenderObject(r);var a=this._vb,s=a._byteLength>>2;if(mt.fillRectImgVb(a,null,t,e,i,n,P.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var o=this._curSubmit=at.createSubmit(this,this._ib,a,(a._byteLength-64)/32*3,wt.create(2,0));o.shaderValue.ALPHA=1,this._submits[this._submits._length++]=o,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var l=ut.create(5);this.addRenderObject(l);var h=a.getFloat32Array(),u=Math.min(Math.min(Math.min(h[s+0],h[s+4]),h[s+8]),h[s+12]),c=Math.max(Math.max(Math.max(h[s+0],h[s+4]),h[s+8]),h[s+12]),_=Math.min(Math.min(Math.min(h[s+1],h[s+5]),h[s+9]),h[s+13]),d=Math.max(Math.max(Math.max(h[s+1],h[s+5]),h[s+9]),h[s+13]);j.save(this,l,t,e,i,n,u,_,c-u,d-_),this._curSubmit=at.RENDERBASE}else{i*=this._curMat.a,n*=this._curMat.d;var f=D.TEMP;this._curMat.transformPoint(f.setTo(t,e)),i<0&&(f.x=f.x+i,i=-i),n<0&&(f.y=f.y+n,n=-n),this._renderKey=0;var p=this._curSubmit=ht.create(this);(this._submits[this._submits._length++]=p).submitIndex=this._submits._length,p.submitLength=9999999,Y.save(this,p);var m=this._clipRect,g=m.x,v=m.y,y=f.x+i,x=f.y+n;g<f.x&&(m.x=f.x),v<f.y&&(m.y=f.y),m.width=Math.min(y,g+m.width)-m.x,m.height=Math.min(x,v+m.height)-m.y,this._shader2D.glTexture=null,p.clipRect.copyFrom(m),this._curSubmit=at.RENDERBASE}},e.setIBVB=function(t,e,i,n,r,a,s,o,l,h,u){if(void 0===l&&(l=0),void 0===h&&(h=0),void 0===u&&(u=0),null===i){if(g.isFlash){var c=n;c._selfIB||(c._selfIB=Jt.create(35044)),c._selfIB.clear(),i=c._selfIB}else i=this._ib;mt.expandIBQuadrangle(i,n._byteLength/(4*n.vertexStride*4))}if(!o||!s)throw Error("setIBVB must input:shader shaderValues");var _=lt.create(this,n,i,r,s,o,l,h,u);a||(a=M.EMPTY),a.translate(t,e),M.mul(a,this._curMat,_._mat),a.translate(-t,-e),this._submits[this._submits._length++]=_,this._curSubmit=at.RENDERBASE,this._renderKey=0},e.addRenderObject=function(t){this._submits[this._submits._length++]=t},e.fillTrangles=function(t,e,i,n,r){var a=this._curSubmit,s=this._vb,o=this._shader2D,l=a.shaderValue,h=n.length>>4,u=t.bitmap;this._renderKey=0,o.glTexture==u&&o.ALPHA===l.ALPHA||((a=this._curSubmit=at.createSubmit(this,this._ib,s,s._byteLength/32*3,wt.create(1,0))).shaderValue.textureHost=t,this._submits[this._submits._length++]=a),mt.fillTranglesVB(s,e,i,n,r||this._curMat,this._x,this._y),a._numEle+=6*h},e.submitElement=function(t,e){var i=this._submits;for(e<0&&(e=i._length);t<e;)t+=i[t].renderSubmit()},e.finish=function(){xt.mainContext.finish()},e.flush=function(){var t=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if(t>this._ib.bufferLength/12&&mt.expandIBQuadrangle(this._ib,t),!this._isMain&&k.enabled&&k._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=k._atlasRestore;for(var e=this._submits,i=0,n=e._length;i<n;i++){var r=e[i];10016===r.getRenderType()&&r.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),et.instance&&et.getInstance().reset();var a;for(i=0,a=this.meshlist.length;i<a;i++){var s=this.meshlist[i];s.canReuse?s.releaseMesh():s.destroy()}return this.meshlist.length=0,this._curSubmit=at.RENDERBASE,this._renderKey=0,this._triangleMesh=Pt.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},e.setPathId=function(t){if(this.mId=t,-1!=this.mId){this.mHaveKey=!1;var e=V.getInstance();e.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,e.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},e.movePath=function(t,e){var i=t,n=e;t=this._curMat.a*i+this._curMat.c*n+this._curMat.tx,e=this._curMat.b*i+this._curMat.d*n+this._curMat.ty,this.mX+=t,this.mY+=e},e.beginPath=function(){var t=this._getPath();t.tempArray.length=0,t.closePath=!1,this.mX=0,this.mY=0},e.closePath=function(){this._path.closePath=!0},e.fill=function(t){void 0===t&&(t=!1);var e=this._getPath();this.drawPoly(0,0,e.tempArray,this.fillStyle._color.numColor,0,0,t)},e.stroke=function(){var t=this._getPath();if(0<this.lineWidth){if(-1==this.mId)t.drawLine(0,0,t.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var e=V.getInstance().shapeLineDic[this.mId];e.rebuild(t.tempArray),t.setGeomtry(e)}else V.getInstance().addLine(this.mId,t.drawLine(0,0,t.tempArray,this.lineWidth,this.strokeStyle._color.numColor));t.update();var i=[this.mX,this.mY],n=at.createShape(this,t.ib,t.vb,t.count,t.offset,wt.create(4,0));n.shaderValue.ALPHA=this._shader2D.ALPHA,n.shaderValue.u_pos=i,n.shaderValue.u_mmat2=vt.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=n}},e.line=function(t,e,i,n,r,a){var s=this._curSubmit,o=this._vb;if(mt.fillLineVb(o,this._clipRect,t,e,i,n,r,a)){this._renderKey=0;var l=this._shader2D,h=s.shaderValue;l.strokeStyle===h.strokeStyle&&l.ALPHA===h.ALPHA||(l.glTexture=null,(s=this._curSubmit=at.createSubmit(this,this._ib,o,(o._byteLength-64)/32*3,wt.create(2,0))).shaderValue.strokeStyle=l.strokeStyle,s.shaderValue.mainID=2,s.shaderValue.ALPHA=l.ALPHA,this._submits[this._submits._length++]=s),s._numEle+=6}},e.moveTo=function(t,e,i){void 0===i&&(i=!0);var n=this._getPath();if(i){var r=t,a=e;t=this._curMat.a*r+this._curMat.c*a,e=this._curMat.b*r+this._curMat.d*a}n.addPoint(t,e)},e.lineTo=function(t,e,i){void 0===i&&(i=!0);var n=this._getPath();if(i){var r=t,a=e;t=this._curMat.a*r+this._curMat.c*a,e=this._curMat.b*r+this._curMat.d*a}n.addPoint(t,e)},e.drawCurves=function(t,e,i){this.setPathId(-1),this.beginPath(),this.strokeStyle=i[3],this.lineWidth=i[4];var n=i[2];t+=i[0],e+=i[1],this.movePath(t,e),this.moveTo(n[0],n[1]);for(var r=2,a=n.length;r<a;)this.quadraticCurveTo(n[r++],n[r++],n[r++],n[r++]);this.stroke()},e.arcTo=function(t,e,i,n,r){if(-1==this.mId||!this.mHaveKey){var a=0,s=0,o=0,l=this._getPath();this._curMat.copyTo(U._tmpMatrix),U._tmpMatrix.tx=U._tmpMatrix.ty=0,U._tempPoint.setTo(l.getEndPointX(),l.getEndPointY()),U._tmpMatrix.invertTransformPoint(U._tempPoint);var h=U._tempPoint.x-t,u=U._tempPoint.y-e,c=Math.sqrt(h*h+u*u);if(!(c<=1e-6)){var _=h/c,d=u/c,f=i-t,p=n-e,m=f*f+p*p,g=Math.sqrt(m);if(!(g<=1e-6)){var v=f/g,y=p/g,x=_+v,E=d+y,T=Math.sqrt(x*x+E*E);if(!(T<=1e-6)){var S=x/T,w=E/T,M=Math.acos(S*_+w*d),D=Math.PI/2-M,I=(c=r/Math.tan(D))*_+t,b=c*d+e,C=Math.sqrt(c*c+r*r),A=t+S*C,R=e+w*C,L=0,O=0;if(0<=_*y-d*v){var P=2*D/U.SEGNUM;L=Math.sin(P),O=Math.cos(P)}else P=2*-D/U.SEGNUM,L=Math.sin(P),O=Math.cos(P);s=this._curMat.a*I+this._curMat.c*b,o=this._curMat.b*I+this._curMat.d*b,s==this._path.getEndPointX()&&o==this._path.getEndPointY()||l.addPoint(s,o);var N=I-A,V=b-R;for(a=0;a<U.SEGNUM;a++){var F=N*O+V*L,B=-N*L+V*O;s=F+A,o=B+R,t=this._curMat.a*s+this._curMat.c*o,o=e=this._curMat.b*s+this._curMat.d*o,(s=t)==this._path.getEndPointX()&&o==this._path.getEndPointY()||l.addPoint(s,o),N=F,V=B}}}}}},e.arc=function(t,e,i,n,r,a,s){if(void 0===a&&(a=!1),void 0===s&&(s=!0),-1!=this.mId){var o=V.getInstance().shapeDic[this.mId];if(o&&this.mHaveKey&&!o.needUpdate(this._curMat))return;e=t=0}var l,h=0,u=0,c=0,_=0,d=0,f=0,p=0;if(u=r-n,a)if(Math.abs(u)>=2*Math.PI)u=2*-Math.PI;else for(;0<u;)u-=2*Math.PI;else if(Math.abs(u)>=2*Math.PI)u=2*Math.PI;else for(;u<0;)u+=2*Math.PI;l=u/(p=i<101?Math.max(10,u*i/5):i<201?Math.max(10,u*i/20):Math.max(10,u*i/40))/2,c=Math.abs(4/3*(1-Math.cos(l))/Math.sin(l)),a&&(c=-c);var m=this._getPath(),g=NaN,v=NaN;for(f=0;f<=p;f++)h=n+u*(f/p),_=t+Math.cos(h)*i,d=e+Math.sin(h)*i,s&&(g=_,v=d,_=this._curMat.a*g+this._curMat.c*v,d=this._curMat.b*g+this._curMat.d*v),_==this._path.getEndPointX()&&d==this._path.getEndPointY()||m.addPoint(_,d);_=t+Math.cos(r)*i,d=e+Math.sin(r)*i,s&&(g=_,v=d,_=this._curMat.a*g+this._curMat.c*v,d=this._curMat.b*g+this._curMat.d*v),_==this._path.getEndPointX()&&d==this._path.getEndPointY()||m.addPoint(_,d)},e.quadraticCurveTo=function(t,e,i,n){var r=c.I,a=i,s=n;i=this._curMat.a*a+this._curMat.c*s,n=this._curMat.b*a+this._curMat.d*s,a=t,s=e,t=this._curMat.a*a+this._curMat.c*s,e=this._curMat.b*a+this._curMat.d*s;for(var o=r.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),t,e,i,n],30,2),l=0,h=o.length/2;l<h;l++)this.lineTo(o[2*l],o[2*l+1],!1);this.lineTo(i,n,!1)},e.rect=function(t,e,i,n){this._other=this._other.make(),this._other.path||(this._other.path=new W),this._other.path.rect(t,e,i,n)},e.strokeRect=function(t,e,i,n,r){var a=.5*r;this.line(t-a,e,t+i+a,e,r,this._curMat),this.line(t+i,e,t+i,e+n,r,this._curMat),this.line(t,e,t,e+n,r,this._curMat),this.line(t-a,e+n,t+i+a,e+n,r,this._curMat)},e.clip=function(){},e.drawPoly=function(t,e,i,n,r,a,s){void 0===s&&(s=!1),this._renderKey=0,this._shader2D.glTexture=null;var o=this._getPath();if(-1==this.mId)o.polygon(t,e,i,n,r||1,a);else if(this.mHaveKey){var l=V.getInstance().shapeDic[this.mId];l.setMatrix(this._curMat),l.rebuild(o.tempArray),o.setGeomtry(l)}else{var h=o.polygon(t,e,i,n,r||1,a);V.getInstance().addShape(this.mId,h),h.setMatrix(this._curMat)}o.update();var u,c=[this.mX,this.mY];if((u=at.createShape(this,o.ib,o.vb,o.count,o.offset,wt.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,u.shaderValue.u_pos=c,u.shaderValue.u_mmat2=vt.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=u,0<r){if(this.mHaveLineKey){var _=V.getInstance().shapeLineDic[this.mId];_.rebuild(o.tempArray),o.setGeomtry(_)}else V.getInstance().addShape(this.mId,o.drawLine(t,e,i,r,a));o.update(),(u=at.createShape(this,o.ib,o.vb,o.count,o.offset,wt.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,u.shaderValue.u_mmat2=vt.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=u}},e.drawParticle=function(t,e,i){i.x=t,i.y=e,this._submits[this._submits._length++]=i},e._getPath=function(){return this._path||(this._path=new W)},l(0,e,"globalCompositeOperation",function(){return z.NAMES[this._nBlendType]},function(t){var e=z.TOINT[t];null==e||this._nBlendType===e||(X.save(this,65536,this,!0),this._curSubmit=at.RENDERBASE,this._renderKey=0,this._nBlendType=e)}),l(0,e,"strokeStyle",function(){return this._shader2D.strokeStyle},function(t){this._shader2D.strokeStyle.equal(t)||(X.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=G.create(t))}),l(0,e,"globalAlpha",function(){return this._shader2D.ALPHA},function(t){(t=Math.floor(1e3*t)/1e3)!=this._shader2D.ALPHA&&(X.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=t)}),l(0,e,"asBitmap",null,function(t){if(t){if(this._targets||(this._targets=new Q),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),l(0,e,"fillStyle",function(){return this._shader2D.fillStyle},function(t){this._shader2D.fillStyle.equal(t)||(X.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=G.create(t))}),l(0,e,"textAlign",function(){return this._other.textAlign},function(t){this._other.textAlign===t||(this._other=this._other.make(),X.save(this,32768,this._other,!1),this._other.textAlign=t)}),l(0,e,"lineWidth",function(){return this._other.lineWidth},function(t){this._other.lineWidth===t||(this._other=this._other.make(),X.save(this,256,this._other,!1),this._other.lineWidth=t)}),l(0,e,"textBaseline",function(){return this._other.textBaseline},function(t){this._other.textBaseline===t||(this._other=this._other.make(),X.save(this,16384,this._other,!1),this._other.textBaseline=t)}),l(0,e,"font",null,function(t){t!=this._other.font.toString()&&(this._other=this._other.make(),X.save(this,8,this._other,!1),this._other.font===ft.EMPTY?this._other.font=new ft(t):this._other.font.setFont(t))}),U.__init__=function(){i.DEFAULT=new i},U._tempPoint=new D,U._SUBMITVBSIZE=32e3,U._MAXSIZE=99999999,U._RECTVBSIZE=16,U.MAXCLIPRECT=new I(0,0,99999999,99999999),U._COUNT=0,U._tmpMatrix=new M,U.SEGNUM=32,U._contextcount=0,s(U,["_fontTemp",function(){return this._fontTemp=new ft},"_drawStyleTemp",function(){return this._drawStyleTemp=new G(null)}]),U.__init$=function(){i=function(){function t(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=ft.EMPTY}_(t,"");var e=t.prototype;return e.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=ft.EMPTY},e.make=function(){return this===t.DEFAULT?new t:this},t.DEFAULT=null,t}()},U}(),wt=function(t){function n(t,e){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,n.__super.call(this),this.defines=new bt,this.position=n._POSITION,this.mainID=t,this.subID=e,this.textureHost=null,this.texture=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=t|e,this._inClassCache=n._cache[this._cacheID],0<t&&!this._inClassCache&&(this._inClassCache=n._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}_(n,"laya.webgl.shader.d2.value.Value2D",B);var e=n.prototype;return e.setValue=function(t){},e.refresh=function(){var t=this.size;return t[0]=vt.width,t[1]=vt.height,this.alpha=this.ALPHA*vt.worldAlpha,this.mmat=vt.worldMatrix4,this},e._ShaderWithCompile=function(){return Zt.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,Qt.create)},e._withWorldShaderDefines=function(){var t=vt.worldShaderDefines,e=Zt.sharders[this.mainID|this.defines._value|t.getValue()];if(!e){var i,n={};for(i in this.defines.toNameDic())n[i]="";for(i in t.toNameDic())n[i]="";e=Zt.withCompile2D(0,this.mainID,n,this.mainID|this.defines._value|t.getValue(),Qt.create)}var r=vt.worldFilters;if(!r)return e;for(var a,s=r.length,o=0;o<s;o++)(a=r[o])&&a.action.setValue(this);return e},e.upload=function(){var t=vt;this.alpha=this.ALPHA*t.worldAlpha,vt.worldMatrix4!==vt.TEMPMAT4_ARRAY&&this.defines.add(128),xt.shaderHighPrecision&&this.defines.add(1024);var e,i=t.worldShaderDefines?this._withWorldShaderDefines():Zt.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=t.width,this.size[1]=t.height,this.mmat=t.worldMatrix4,Nt.activeShader!==i?i._shaderValueWidth!==t.width||i._shaderValueHeight!==t.height?(i._shaderValueWidth=t.width,i._shaderValueHeight=t.height):e=i._params2dQuick2||i._make2dQuick2():i._shaderValueWidth!==t.width||i._shaderValueHeight!==t.height?(i._shaderValueWidth=t.width,i._shaderValueHeight=t.height):e=i._params2dQuick1||i._make2dQuick1(),i.upload(this,e)},e.setFilters=function(t){if(this.filters=t)for(var e,i=t.length,n=0;n<i;n++)(e=t[n])&&(this.defines.add(e.type),e.action.setValue(this))},e.clear=function(){this.defines.setValue(this.subID)},e.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.clear()},n._initone=function(t,e){n._typeClass[t]=e,n._cache[t]=[],n._cache[t]._length=0},n.__init__=function(){n._POSITION=[2,5126,!1,4*pt.BYTES_PE,0],n._TEXCOORD=[2,5126,!1,4*pt.BYTES_PE,2*pt.BYTES_PE],n._initone(2,Ut),n._initone(4,zt),n._initone(256,kt),n._initone(512,Bt),n._initone(1,Ht),n._initone(65,qt),n._initone(9,Ht)},n.create=function(t,e){var i=n._cache[t|e];return i._length?i[--i._length]:new n._typeClass[t|e](e)},n._POSITION=null,n._TEXCOORD=null,n._cache=[],n._typeClass=[],n.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n}(),Mt=function(t){function m(t,e){m.__super.call(this,t,e)}_(m,"laya.webgl.utils.RenderSprite3D",v);var e=m.prototype;return e.onCreate=function(t){switch(t){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},e._mask=function(t,e,i,n){var r,a,s=this._next,o=t.mask;if(o){e.ctx.save();var l=e.ctx.globalCompositeOperation,h=new I;if(h.copyFrom(o.getBounds()),h.width=Math.round(h.width),h.height=Math.round(h.height),h.x=Math.round(h.x),h.y=Math.round(h.y),0<h.width&&0<h.height){var u=t._style._tf,c=ot.create();c.addValue("bounds",h),r=st.create([c,e],laya.webgl.utils.RenderSprite3D.tmpTarget),e.addRenderObject(r),o.render(e,-h.x,-h.y),r=st.create([c],laya.webgl.utils.RenderSprite3D.endTmpTarget),e.addRenderObject(r),e.ctx.save(),e.clipRect(i-u.translateX+h.x,n-u.translateY+h.y,h.width,h.height),s._fun.call(s,t,e,i,n),e.ctx.restore(),a=ut.create(6),l=e.ctx.globalCompositeOperation,a.blendMode="mask",e.addRenderObject(a),M.TEMP.identity();var _=wt.create(1,0),d=P.INV_UV,f=h.width,p=h.height;(h.width<32||h.height<32)&&((d=m.tempUV)[0]=0,d[1]=0,d[2]=32<=h.width?1:h.width/32,d[3]=0,d[4]=32<=h.width?1:h.width/32,d[5]=32<=h.height?1:h.height/32,d[6]=0,d[7]=32<=h.height?1:h.height/32,h.width=32<=h.width?h.width:32,h.height=32<=h.height?h.height:32,d[1]*=-1,d[3]*=-1,d[5]*=-1,d[7]*=-1,d[1]+=1,d[3]+=1,d[5]+=1,d[7]+=1),e.ctx.drawTarget(c,i+h.x-u.translateX,n+h.y-u.translateY,f,p,M.TEMP,"tmpTarget",_,d,6),r=st.create([c],laya.webgl.utils.RenderSprite3D.recycleTarget),e.addRenderObject(r),(a=ut.create(6)).blendMode=l,e.addRenderObject(a)}e.ctx.restore()}else s._fun.call(s,t,e,i,n)},e._blend=function(t,e,i,n){var r=t._style,a=this._next;r.blendMode?(e.ctx.save(),e.ctx.globalCompositeOperation=r.blendMode,a._fun.call(a,t,e,i,n),e.ctx.restore()):a._fun.call(a,t,e,i,n)},e._transform=function(t,e,i,n){"use strict";var r=t.transform,a=this._next;if(r&&a!=v.NORENDER){var s=e.ctx;t._style;r.tx=i,r.ty=n;var o=s._getTransformMatrix(),l=o.clone();M.mul(r,o,o),o._checkTransform(),r.tx=r.ty=0,a._fun.call(a,t,e,0,0),l.copyTo(o),l.destroy()}else a._fun.call(a,t,e,i,n)},m.tmpTarget=function(t,e){var i=t.getValue("bounds"),n=Vt.create(i.width,i.height);n.start(),n.clear(0,0,0,0),t.addValue("tmpTarget",n)},m.endTmpTarget=function(t){t.getValue("tmpTarget").end()},m.recycleTarget=function(t){t.getValue("tmpTarget").recycle(),t.recycle()},s(m,["tempUV",function(){return this.tempUV=new Array(8)}]),m}(),Dt=function(t){function e(){this.data=null,e.__super.call(this)}_(e,"laya.filters.webgl.ColorFilterActionGL",F);var i=e.prototype;return T.imps(i,{"laya.filters.IFilterActionGL":!0}),i.setValue=function(t){t.colorMat=this.data._mat,t.colorAlpha=this.data._alpha},i.apply3d=function(t,e,i,n,r){var a=t.getValue("bounds"),s=wt.create(1,0);s.setFilters([this.data]);var o=M.TEMP;o.identity(),i.ctx.drawTarget(t,0,0,a.width,a.height,o,"src",s)},e}(),It=function(t){function a(t,e,i,n,r){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,a.__super.call(this,t,e,r),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new Gt,(this._atlasCanvas._atlaser=this)._atlasCanvas.width=i,this._atlasCanvas.height=n,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}_(a,"laya.webgl.atlas.Atlaser",U);var e=a.prototype;return e.computeUVinAtlasTexture=function(t,e,i,n){var r=k.atlasTextureWidth,a=k.atlasTextureHeight,s=i/r,o=n/a,l=(i+t.bitmap.width)/r,h=(n+t.bitmap.height)/a,u=t.bitmap.width/r,c=t.bitmap.height/a;t.uv=[s+e[0]*u,o+e[1]*c,l-(1-e[2])*u,o+e[3]*c,l-(1-e[4])*u,h-(1-e[5])*c,s+e[6]*u,h-(1-e[7])*c]},e.findBitmapIsExist=function(t){if(t instanceof laya.webgl.resource.WebGLImage){var e=t,i=e.url,n=this._InAtlasWebGLImagesKey[i||e.id];if(n)return n.offsetInfoID}return-1},e.addToAtlasTexture=function(t,e,i){if(t instanceof laya.webgl.resource.WebGLImage){var n=t,r=n.url;this._InAtlasWebGLImagesKey[r||n.id]={bitmap:t,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([e,i])}this._atlasCanvas.texSubImage2D(e,i,t.atlasSource),t.clearAtlasSource()},e.addToAtlas=function(t,e,i){t._atlasID=this._inAtlasTextureKey.length;var n=t.uv.slice(),r=t.bitmap;this._inAtlasTextureKey.push(t),this._inAtlasTextureOriUVValue.push(n),this._inAtlasTextureBitmapValue.push(r),this.computeUVinAtlasTexture(t,n,e,i),t.bitmap=this._atlasCanvas},e.clear=function(){for(var t=0,e=this._inAtlasTextureKey.length;t<e;t++)this._inAtlasTextureKey[t].bitmap=this._inAtlasTextureBitmapValue[t],this._inAtlasTextureKey[t].uv=this._inAtlasTextureOriUVValue[t],this._inAtlasTextureKey[t]._atlasID=-1,this._inAtlasTextureKey[t].bitmap.lock=!1,this._inAtlasTextureKey[t].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},e.dispose=function(){this.clear(),this._atlasCanvas.destroy()},l(0,e,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),l(0,e,"texture",function(){return this._atlasCanvas}),l(0,e,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),a}(),bt=function(t){function i(){i.__super.call(this,i.__name2int,i.__int2name,i.__int2nameMap)}return _(i,"laya.webgl.shader.d2.ShaderDefines2D",$),i.__init__=function(){i.reg("TEXTURE2D",1),i.reg("COLOR2D",2),i.reg("PRIMITIVE",4),i.reg("GLOW_FILTER",8),i.reg("BLUR_FILTER",16),i.reg("COLOR_FILTER",32),i.reg("COLOR_ADD",64),i.reg("WORLDMAT",128),i.reg("FILLTEXTURE",256),i.reg("FSHIGHPRECISION",1024)},i.reg=function(t,e){$._reg(t,e,i.__name2int,i.__int2name)},i.toText=function(t,e,i){return $._toText(t,e,i)},i.toInt=function(t){return $._toInt(t,i.__name2int)},i.TEXTURE2D=1,i.COLOR2D=2,i.PRIMITIVE=4,i.FILTERGLOW=8,i.FILTERBLUR=16,i.FILTERCOLOR=32,i.COLORADD=64,i.WORLDMAT=128,i.FILLTEXTURE=256,i.SKINMESH=512,i.SHADERDEFINE_FSHIGHPRECISION=1024,i.__name2int={},i.__int2name=[],i.__int2nameMap=[],i}(),Ct=(function(t){function o(t,e,i,n,r,a,s){o.__super.call(this,t,e,i,n,40,r,a,s)}_(o,"laya.webgl.shapes.Ellipse",it)}(),function(t){function a(t,e,i,n,r){this._points=[],this.rebuild(i),a.__super.call(this,t,e,0,0,0,r,n,r,0)}_(a,"laya.webgl.shapes.Line",it);var e=a.prototype;return e.rebuild=function(t){var e=t.length;e!=this._points.length&&(this.mUint16Array=new Uint16Array(6*(e/2-1)),this.mFloat32Array=new Float32Array(5*e)),this._points.length=0;for(var i=NaN,n=NaN,r=-1,a=-1,s=t.length/2,o=0;o<s;o++)i=t[2*o],n=t[2*o+1],(.01<Math.abs(r-i)||.01<Math.abs(a-n))&&this._points.push(i,n),r=i,a=n},e.getData=function(t,e,i){var n=[],r=[];0<this.borderWidth&&this.createLine2(this._points,n,this.borderWidth,i,r,this._points.length/2),this.mUint16Array.set(n,0),this.mFloat32Array.set(r,0),t.append(this.mUint16Array),e.append(this.mFloat32Array)},a}()),At=function(t){function c(t,e,i,n,r){this._points=[];for(var a=NaN,s=NaN,o=-1,l=-1,h=i.length/2-1,u=0;u<h;u++)a=i[2*u],s=i[2*u+1],(.01<Math.abs(o-a)||.01<Math.abs(l-s))&&this._points.push(a,s),o=a,l=s;a=i[2*h],s=i[2*h+1],o=this._points[0],l=this._points[1],(.01<Math.abs(o-a)||.01<Math.abs(l-s))&&this._points.push(a,s),c.__super.call(this,t,e,0,0,this._points.length/2,0,n,r)}_(c,"laya.webgl.shapes.LoopLine",it);var e=c.prototype;return e.getData=function(t,e,i){if(0<this.borderWidth){for(var n=this.color,r=(n>>16&255)/255,a=(n>>8&255)/255,s=(255&n)/255,o=[],l=0,h=0,u=[],c=Math.floor(this._points.length/2),_=0;_<c;_++)l=this._points[2*_],h=this._points[2*_+1],o.push(this.x+l,this.y+h,r,a,s);this.createLoopLine(o,u,this.borderWidth,i+o.length/5),t.append(new Uint16Array(u)),e.append(new Float32Array(o))}},e.createLoopLine=function(t,e,i,n,r,a){t.length;var s=t.concat(),o=r||t,l=this.borderColor,h=(l>>16&255)/255,u=(l>>8&255)/255,c=(255&l)/255,_=[s[0],s[1]],d=[s[s.length-5],s[s.length-4]],f=d[0]+.5*(_[0]-d[0]),p=d[1]+.5*(_[1]-d[1]);s.unshift(f,p,0,0,0),s.push(f,p,0,0,0);var m,g,v,y,x,E,T,S,w,M,D,I,b,C,A,R,L,O,P,N,V=s.length/5,F=n,B=i/2;v=s[0],y=s[1],M=v-(x=s[5]),w=(w=-(y-(E=s[6])))/(N=Math.sqrt(w*w+M*M))*B,M=M/N*B,o.push(v-w,y-M,h,u,c,v+w,y+M,h,u,c);for(var U=1;U<V-1;U++)v=s[5*(U-1)],y=s[5*(U-1)+1],x=s[5*U],E=s[5*U+1],T=s[5*(U+1)],S=s[5*(U+1)+1],M=v-x,I=x-T,A=(-(w=(w=-(y-E))/(N=Math.sqrt(w*w+M*M))*B)+v)*(-(M=M/N*B)+E)-(-w+x)*(-M+y),O=(-(D=(D=-(E-S))/(N=Math.sqrt(D*D+I*I))*B)+T)*(-(I=I/N*B)+E)-(-D+x)*(-I+S),P=(b=-M+y-(-M+E))*(L=-D+x-(-D+T))-(R=-I+S-(-I+E))*(C=-w+x-(-w+v)),Math.abs(P)<.1?(P+=10.1,o.push(x-w,E-M,h,u,c,x+w,E+M,h,u,c)):(((m=(C*O-L*A)/P)-x)*(m-x)+((g=(R*A-b*O)/P)-E)+(g-E),o.push(m,g,h,u,c,x-(m-x),E-(g-E),h,u,c));a&&(e=a);var k=this.edges+1;for(U=1;U<k;U++)e.push(F+2*(U-1),F+2*(U-1)+1,F+2*U+1,F+2*U+1,F+2*U,F+2*(U-1));return e.push(F+2*(U-1),F+2*(U-1)+1,F+1,F+1,F,F+2*(U-1)),o},c}(),Rt=function(t){function s(t,e,i,n,r,a){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=M.create(),this._points=i.slice(0,i.length),s.__super.call(this,t,e,0,0,this._points.length/2,n,r,a)}_(s,"laya.webgl.shapes.Polygon",it);var e=s.prototype;return e.rebuild=function(t){this._repaint||(this._points.length=0,this._points=this._points.concat(t))},e.setMatrix=function(t){t.copyTo(this._mat)},e.needUpdate=function(t){return this._repaint=this._mat.a==t.a&&this._mat.b==t.b&&this._mat.c==t.c&&this._mat.d==t.d&&this._mat.tx==t.tx&&this._mat.ty==t.ty,!this._repaint},e.getData=function(t,e,i){var n,r=0,a=this._points,s=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=i){for(this._start=i,n=[],s=this.earcutTriangles.length,r=0;r<s;r++)n.push(this.earcutTriangles[r]+i);this.mUint16Array=new Uint16Array(n)}}else{this._start=i,n=[];var o=[],l=[],h=this.color,u=(h>>16&255)/255,c=(h>>8&255)/255,_=(255&h)/255;for(s=Math.floor(a.length/2),r=0;r<s;r++)o.push(this.x+a[2*r],this.y+a[2*r+1],u,c,_),l.push(this.x+a[2*r],this.y+a[2*r+1]);for(this.earcutTriangles=nt.earcut(l,null,2),s=this.earcutTriangles.length,r=0;r<s;r++)n.push(this.earcutTriangles[r]+i);this.mUint16Array=new Uint16Array(n),this.mFloat32Array=new Float32Array(o)}t.append(this.mUint16Array),e.append(this.mFloat32Array)},s}(),Lt=function(t){function a(){this._matrix=new M,this._matrix4=pt.defaultMatrix4.concat(),a.__super.call(this,1e4),this.shaderValue=new wt(0,0)}_(a,"laya.webgl.submit.SubmitCanvas",at);var e=a.prototype;return e.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var t=vt.worldAlpha,e=vt.worldMatrix4,i=vt.worldMatrix,n=vt.worldFilters,r=vt.worldShaderDefines,a=this.shaderValue,s=this._matrix,o=this._matrix4,l=M.TEMP;return M.mul(s,i,l),o[0]=l.a,o[1]=l.b,o[4]=l.c,o[5]=l.d,o[12]=l.tx,o[13]=l.ty,vt.worldMatrix=l.clone(),vt.worldMatrix4=o,vt.worldAlpha=vt.worldAlpha*a.alpha,a.filters&&a.filters.length&&(vt.worldFilters=a.filters,vt.worldShaderDefines=a.defines),this._ctx_src.flush(),vt.worldAlpha=t,vt.worldMatrix4=e,vt.worldMatrix.destroy(),vt.worldMatrix=i,vt.worldFilters=n,vt.worldShaderDefines=r,1},e.releaseRender=function(){var t=a._cache;this._ctx_src=null,t[t._length++]=this},e.getRenderType=function(){return 10003},a.create=function(t,e,i){var n=a._cache._length?a._cache[--a._cache._length]:new a;n._ctx_src=t;var r=n.shaderValue;return r.alpha=e,r.defines.setValue(0),i&&i.length&&r.setFilters(i),n},a._cache=((a._cache=[])._length=0,a._cache),a}(),Ot=function(t){function h(t){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===t&&(t=1e4),h.__super.call(this,t)}_(h,"laya.webgl.submit.SubmitTexture",at);var e=h.prototype;return e.releaseRender=function(){var t=h._cache;(t[t._length++]=this).shaderValue.release(),this._preIsSameTextureShader=!1,this._vb=null,this._texs.length=0,this._vbPos.length=0,this._isSameTexture=!0},e.addTexture=function(t,e){this._texsID[this._texs.length]=t._uvID,this._texs.push(t),this._vbPos.push(e)},e.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var t=this.shaderValue.textureHost.bitmap;if(null!==t)for(var e=this._vb.getFloat32Array(),i=0,n=this._texs.length;i<n;i++){var r=this._texs[i];r.active();var a=r.uv;if(this._texsID[i]!==r._uvID){this._texsID[i]=r._uvID;var s=this._vbPos[i];e[s+2]=a[0],e[s+3]=a[1],e[s+6]=a[2],e[s+7]=a[3],e[s+10]=a[4],e[s+11]=a[5],e[s+14]=a[6],e[s+15]=a[7],this._vb.setNeedUpload()}r.bitmap!==t&&(this._isSameTexture=!1)}}},e.renderSubmit=function(){if(0===this._numEle)return h._shaderSet=!1,1;var t=this.shaderValue.textureHost;if(t){var e=t.source;if(!t.bitmap||!e)return h._shaderSet=!1,1;this.shaderValue.texture=e}this._vb.bind_upload(this._ib);var i=xt.mainContext;if(z.activeBlendFunction!==this._blendFn&&(i.enable(3042),this._blendFn(i),z.activeBlendFunction=this._blendFn),A.drawCall++,A.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&Nt.activeShader&&h._shaderSet?Nt.activeShader.uploadTexture2D(this.shaderValue.texture):this.shaderValue.upload(),h._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var n=t.bitmap,r=0,a=Nt.activeShader,s=0,o=this._texs.length;s<o;s++){var l=this._texs[s];l.bitmap===n&&s+1!==o||(a.uploadTexture2D(l.source),i.drawElements(4,6*(s-r+1),5123,this._startIdx+6*r*pt.BYTES_PIDX),n=l.bitmap,r=s)}else i.drawElements(4,this._numEle,5123,this._startIdx);return 1},h.create=function(t,e,i,n,r){var a=h._cache._length?h._cache[--h._cache._length]:new h;null==i&&((i=a._selfVb||(a._selfVb=$t.create(-1))).clear(),n=0),a._ib=e,a._vb=i,a._startIdx=n*pt.BYTES_PIDX,a._numEle=0;var s=t._nBlendType;a._blendFn=t._targets?z.targetFns[s]:z.fns[s],a.shaderValue=r,a.shaderValue.setValue(t._shader2D);var o=t._shader2D.filters;return o&&a.shaderValue.setFilters(o),a},h._cache=((h._cache=[])._length=0,h._cache),h._shaderSet=!0,h}(),Pt=function(t){function g(){g.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}_(g,"laya.webgl.utils.MeshTexture",gt);var e=g.prototype;return e.addData=function(t,e,i,n,r,a){for(var s=t.length/2,o=this._vb.needSize(s*g.const_stride)>>2,l=this._vb.getFloat32Array(),h=0,u=0;u<s;u++){var c=t[h],_=t[h+1],d=c*n.a+_*n.c+n.tx,f=c*n.b+_*n.d+n.ty;l[o++]=d,l[o++]=f,l[o++]=e[h],l[o++]=e[h+1],h+=2}this._vb.setNeedUpload();var p=this.vertNum;if(0<p){(s=i.length)>g.tmpIdx.length&&(g.tmpIdx=new Uint16Array(s));for(var m=0;m<s;m++)g.tmpIdx[m]=i[m]+p;this._ib.appendU16Array(g.tmpIdx,i.length)}else this._ib.append(i);this._ib.setNeedUpload(),this.vertNum+=s,this.indexNum+=i.length},e.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy()},g.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new g},g.const_stride=16,g._POOL=[],s(g,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),g}(),Nt=function(t){function e(){e.__super.call(this),this.lock=!0}return _(e,"laya.webgl.shader.BaseShader",y),e.activeShader=null,e.bindShader=null,e}(),Vt=function(e){function u(t,e,i,n,r,a,s,o,l){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===i&&(i=6408),void 0===n&&(n=5121),void 0===r&&(r=34041),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===o&&(o=-1),void 0===l&&(l=-1),this._type=1,this._w=t,this._h=e,this._surfaceFormat=i,this._surfaceType=n,this._depthStencilFormat=r,this._mipMap=a,this._repeat=s,this._minFifter=o,this._magFifter=l,this._createWebGLRenderTarget(),this.bitmap.lock=!0,u.__super.call(this,this.bitmap,P.INV_UV)}_(u,"laya.webgl.resource.RenderTarget2D",e);var t=u.prototype;return T.imps(t,{"laya.resource.IDispose":!0}),t.getType=function(){return this._type},t.getTexture=function(){return this},t.size=function(t,e){this._w==t&&this._h==e||(this._w=t,this._h=e,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},t.release=function(){this.destroy()},t.recycle=function(){u.POOL.push(this)},t.start=function(){var t=xt.mainContext;return this._preRenderTarget=vt.curRenderTarget,vt.curRenderTarget=this,t.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&(t.viewport(0,0,this._w,this._h),this._svWidth=vt.width,this._svHeight=vt.height,vt.width=this._w,vt.height=this._h,Nt.activeShader=null),this},t.clear=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1);var r=xt.mainContext;r.clearColor(t,e,i,n);var a=16384;switch(this._depthStencilFormat){case 33189:a|=256;break;case 36168:a|=1024;break;case 34041:a|=256,a|=1024}r.clear(a)},t.end=function(){var t=xt.mainContext;t.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,vt.curRenderTarget=this._preRenderTarget,1==this._type?(t.viewport(0,0,this._svWidth,this._svHeight),vt.width=this._svWidth,vt.height=this._svHeight,Nt.activeShader=null):t.viewport(0,0,T.stage.width,T.stage.height)},t.getData=function(t,e,i,n){var r=xt.mainContext;if(r.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===r.checkFramebufferStatus(36160)))return r.bindFramebuffer(36160,null),null;var a=new Uint8Array(this._w*this._h*4);return r.readPixels(t,e,i,n,this._surfaceFormat,this._surfaceType,a),r.bindFramebuffer(36160,null),a},t.destroy=function(t){void 0===t&&(t=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,e.prototype.destroy.call(this))},t.dispose=function(){},t._createWebGLRenderTarget=function(){this.bitmap=new Yt(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function(t){this.event("recovered")})},l(0,t,"surfaceFormat",function(){return this._surfaceFormat}),l(0,t,"magFifter",function(){return this._magFifter}),l(0,t,"surfaceType",function(){return this._surfaceType}),l(0,t,"mipMap",function(){return this._mipMap}),l(0,t,"depthStencilFormat",function(){return this._depthStencilFormat}),l(0,t,"minFifter",function(){return this._minFifter}),l(0,t,"source",function(){return this._alreadyResolved?T.superGet(P,this,"source"):null}),u.create=function(t,e,i,n,r,a,s,o,l){void 0===i&&(i=6408),void 0===n&&(n=5121),void 0===r&&(r=34041),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===o&&(o=-1),void 0===l&&(l=-1);var h=u.POOL.pop();return h||(h=new u(t,e)),h.bitmap&&h._w==t&&h._h==e&&h._surfaceFormat==i&&h._surfaceType==n&&h._depthStencilFormat==r&&h._mipMap==a&&h._repeat==s&&h._minFifter==o&&h._magFifter==l||(h._w=t,h._h=e,h._surfaceFormat=i,h._surfaceType=n,h._depthStencilFormat=r,h._mipMap=a,h._repeat=s,h._minFifter=o,h._magFifter=l,h.release(),h._createWebGLRenderTarget()),h},u.TYPE2D=1,u.TYPE3D=2,u.POOL=[],u}(P),Ft=function(t){function e(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,e.__super.call(this),e._gl=xt.mainContext}_(e,"laya.webgl.utils.Buffer",y);var i=e.prototype;return i._bind=function(){this.activeResource(),e._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&(e._bindVertexBuffer=this._glBuffer),e._gl.bindBuffer(this._bufferType,e._bindActive[this._bufferType]=this._glBuffer),Nt.activeShader=null)},i.recreateResource=function(){this._glBuffer||(this._glBuffer=e._gl.createBuffer()),this.completeCreate()},i.disposeResource=function(){this._glBuffer&&(xt.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},l(0,i,"bufferUsage",function(){return this._bufferUsage}),e._gl=null,e._bindActive={},e._bindVertexBuffer=null,e._enableAtributes=[],e}(),Bt=function(t){function i(t){this.texcoord=null,this.offsetX=300,this.offsetY=0,i.__super.call(this,512,0);var e=8*pt.BYTES_PE;this.position=[2,5126,!1,e,0],this.texcoord=[2,5126,!1,e,2*pt.BYTES_PE],this.color=[4,5126,!1,e,4*pt.BYTES_PE]}return _(i,"laya.webgl.shader.d2.skinAnishader.SkinSV",wt),i}(),Ut=function(t){function e(t){e.__super.call(this,2,0),this.color=[]}return _(e,"laya.webgl.shader.d2.value.Color2dSV",wt),e.prototype.setValue=function(t){t.fillStyle&&(this.color=t.fillStyle._color._color),t.strokeStyle&&(this.color=t.strokeStyle._color._color)},e}(),kt=function(t){function e(t){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=wt._TEXCOORD,e.__super.call(this,256,0)}_(e,"laya.webgl.shader.d2.value.FillTextureSV",wt);var i=e.prototype;return i.setValue=function(t){this.ALPHA=t.ALPHA,t.filters&&this.setFilters(t.filters)},i.clear=function(){this.texture=null,this.shader=null,this.defines.setValue(0)},e}(),Ht=function(t){function e(t){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=wt._TEXCOORD,void 0===t&&(t=0),e.__super.call(this,1,t)}_(e,"laya.webgl.shader.d2.value.TextureSV",wt);var i=e.prototype;return i.setValue=function(t){this.ALPHA=t.ALPHA,t.filters&&this.setFilters(t.filters)},i.clear=function(){this.texture=null,this.shader=null,this.defines.setValue(0)},e}(),zt=function(t){function e(t){this.a_color=null,this.u_pos=[0,0],e.__super.call(this,4,0),this.position=[2,5126,!1,5*pt.BYTES_PE,0],this.a_color=[3,5126,!1,5*pt.BYTES_PE,2*pt.BYTES_PE]}return _(e,"laya.webgl.shader.d2.value.PrimitiveSV",wt),e}(),Gt=function(t){function e(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,e.__super.call(this)}_(e,"laya.webgl.atlas.AtlasWebGLCanvas",t);var i=e.prototype;return i.recreateResource=function(){var t=xt.mainContext,e=this._source=t.createTexture(),i=Et.curBindTexTarget,n=Et.curBindTexValue;Et.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),i&&n&&Et.bindTexture(t,i,n),this.memorySize=this._w*this._h*4,this.completeCreate()},i.disposeResource=function(){this._source&&(xt.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},i.texSubImage2D=function(t,e,i){if(g.isFlash){this._flashCacheImage||(this._flashCacheImage=m.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var n=i.bitmapdata;this._flashCacheImage._image.copyPixels(n,0,0,n.width,n.height,t,e),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var r=xt.mainContext,a=Et.curBindTexTarget,s=Et.curBindTexValue;Et.bindTexture(r,3553,this._source),r.pixelStorei(37441,!0),0<=t-1&&r.texSubImage2D(3553,0,t-1,e,6408,5121,i),t+1<=this._w&&r.texSubImage2D(3553,0,t+1,e,6408,5121,i),0<=e-1&&r.texSubImage2D(3553,0,t,e-1,6408,5121,i),e+1<=this._h&&r.texSubImage2D(3553,0,t,e+1,6408,5121,i),r.texSubImage2D(3553,0,t,e,6408,5121,i),r.pixelStorei(37441,!1),a&&s&&Et.bindTexture(r,a,s)}},i.texSubImage2DPixel=function(t,e,i,n,r){var a=xt.mainContext,s=Et.curBindTexTarget,o=Et.curBindTexValue;Et.bindTexture(a,3553,this._source);var l=new Uint8Array(r.data);a.pixelStorei(37441,!0),a.texSubImage2D(3553,0,t,e,i,n,6408,5121,l),a.pixelStorei(37441,!1),s&&o&&Et.bindTexture(a,s,o)},l(0,i,"width",t.prototype._$get_width,function(t){this._w=t}),l(0,i,"height",t.prototype._$get_height,function(t){this._h=t}),e}(n),Wt=function(t){function i(){this.flipY=!0,this.premulAlpha=!1,this.alwaysChange=!1,i.__super.call(this)}_(i,"laya.webgl.resource.WebGLCanvas",n);var e=i.prototype;return e.getCanvas=function(){return this._canvas},e.clear=function(){this._ctx&&this._ctx.clear()},e.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null},e._setContext=function(t){this._ctx=t},e.getContext=function(t,e){return this._ctx?this._ctx:this._ctx=i._createContext(this)},e.size=function(t,e){this._w==t&&this._h==e||(this._w=t,this._h=e,this._ctx&&this._ctx.size(t,e),this._canvas&&(this._canvas.height=e,this._canvas.width=t))},e.activeResource=function(t){void 0===t&&(t=!1),this._source||this.recreateResource()},e.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},e.disposeResource=function(){this._source&&!this.iscpuSource&&(xt.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},e.createWebGlTexture=function(){var t=xt.mainContext;this._canvas;var e=this._source=t.createTexture();this.iscpuSource=!1;var i=Et.curBindTexTarget,n=Et.curBindTexValue;Et.bindTexture(t,3553,e),t.pixelStorei(37440,this.flipY?1:0),this.premulAlpha&&t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this._imgData),this.premulAlpha&&t.pixelStorei(37441,!1),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),t.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,i&&n&&Et.bindTexture(t,i,n)},e.reloadCanvasData=function(){var t=xt.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var e=Et.curBindTexTarget,i=Et.curBindTexValue;Et.bindTexture(t,3553,this._source),this.premulAlpha&&t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this._imgData),this.premulAlpha&&t.pixelStorei(37441,!1),t.pixelStorei(37440,0),e&&i&&Et.bindTexture(t,e,i)},e.texSubImage2D=function(t,e,i){var n=xt.mainContext,r=Et.curBindTexTarget,a=Et.curBindTexValue;Et.bindTexture(n,3553,this._source),n.pixelStorei(37441,!0),n.texSubImage2D(3553,0,e,i,6408,5121,t._source),n.pixelStorei(37441,!1),r&&a&&Et.bindTexture(n,r,a)},e.toBase64=function(t,e,i){var n=null;this._canvas&&(n=this._canvas.toDataURL(t,e)),i.call(this,n)},l(0,e,"context",function(){return this._ctx}),l(0,e,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),l(0,e,"asBitmap",null,function(t){this._ctx&&(this._ctx.asBitmap=t)}),i._createContext=null,i}(),Xt=function(t){function a(t,e){this.CborderSize=12,a.__super.call(this),this.char=t,this.isSpace=" "===t,this.xs=e.scaleX,this.ys=e.scaleY,this.font=e.font.toString(),this.fontSize=e.font.size,this.fillColor=e.fillColor,this.borderColor=e.borderColor,this.lineWidth=e.lineWidth,this.underLine=e.underLine;var i,n=g.isConchApp;n?((i=ConchTextCanvas)._source=ConchTextCanvas,i._source.canvas=ConchTextCanvas):i=d.canvas.source,this.canvas=i,this._enableMerageInAtlas=!0,this._ctx=n?i:this.canvas.getContext("2d",void 0);var r=N.measureText(this.char,this.font);this.cw=r.width*this.xs,this.ch=(r.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new P(this)}_(a,"laya.webgl.resource.WebGLCharImage",n);var e=a.prototype;return T.imps(e,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),e.active=function(){this.texture.active()},e.recreateResource=function(){var t=g.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),t){var e=this.fontSize;1==this.xs&&1==this.ys||(e=parseInt(e*(this.xs>this.ys?this.xs:this.ys)+""));var i="normal 100 "+e+"px Arial";this.borderColor&&(i+=" 1 "+this.borderColor),this._ctx.font=i,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,O.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var n=this._ctx.measureText(this.char).width+1;this._ctx.lineTo(n,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},e.onresize=function(t,e){this._w=t,this._h=e,this._allowMerageInAtlas=!0},e.clearAtlasSource=function(){},l(0,e,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),l(0,e,"atlasSource",function(){return this.canvas}),l(0,e,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(t){this._enableMerageInAtlas=t}),a.createOneChar=function(t,e){return new a(t,e)},a}(),Yt=function(t){function h(t,e,i,n,r,a,s,o,l){void 0===i&&(i=6408),void 0===n&&(n=5121),void 0===r&&(r=34041),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===o&&(o=-1),void 0===l&&(l=1),h.__super.call(this),this._w=t,this._h=e,this._surfaceFormat=i,this._surfaceType=n,this._depthStencilFormat=r,this._mipMap=a,this._repeat=s,this._minFifter=o,this._magFifter=l}_(h,"laya.webgl.resource.WebGLRenderTarget",n);var e=h.prototype;return e.recreateResource=function(){var t=xt.mainContext;this._frameBuffer||(this._frameBuffer=t.createFramebuffer()),this._source||(this._source=t.createTexture());var e=Et.curBindTexTarget,i=Et.curBindTexValue;Et.bindTexture(t,3553,this._source),t.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var n=this._minFifter,r=this._magFifter,a=this._repeat?10497:33071,s=u.isPOT(this._w,this._h);if(s?(this._mipMap?-1!==n||(n=9987):-1!==n||(n=9729),-1!==r||(r=9729),t.texParameteri(3553,10241,n),t.texParameteri(3553,10240,r),t.texParameteri(3553,10242,a),t.texParameteri(3553,10243,a),this._mipMap&&t.generateMipmap(3553)):(-1!==n||(n=9729),-1!==r||(r=9729),t.texParameteri(3553,10241,n),t.texParameteri(3553,10240,r),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),t.bindFramebuffer(36160,this._frameBuffer),t.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=t.createRenderbuffer()),t.bindRenderbuffer(36161,this._depthStencilBuffer),t.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:t.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:t.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:t.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}t.bindFramebuffer(36160,null),e&&i&&Et.bindTexture(t,e,i),t.bindRenderbuffer(36161,null),s&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},e.disposeResource=function(){this._frameBuffer&&(xt.mainContext.deleteTexture(this._source),xt.mainContext.deleteFramebuffer(this._frameBuffer),xt.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0)},l(0,e,"depthStencilBuffer",function(){return this._depthStencilBuffer}),l(0,e,"frameBuffer",function(){return this._frameBuffer}),h}(),jt=function(t){function o(t,e,i,n,r,a,s){this.offsetX=0,this.offsetY=0,o.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=a,this.canvas=t,this._ctx=t.getContext("2d",void 0),this._w=n,this._h=r,this.offsetX=e,this.offsetY=i,this.src=s,this._enableMerageInAtlas=!0,k.enabled&&this._w<k.atlasLimitWidth&&this._h<k.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}_(o,"laya.webgl.resource.WebGLSubImage",n);var e=o.prototype;return T.imps(e,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),e.size=function(t,e){this._w=t,this._h=e,this._ctx&&this._ctx.size(t,e),this.canvas&&(this.canvas.height=e,this.canvas.width=t)},e.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},e.createWebGlTexture=function(){var t=xt.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var e=this._source=t.createTexture(),i=Et.curBindTexTarget,n=Et.curBindTexValue;Et.bindTexture(t,3553,e),t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this.canvas),t.pixelStorei(37441,!1);var r=this.minFifter,a=this.magFifter,s=this.repeat?10497:33071,o=u.isPOT(this.width,this.height);o?(this.mipmap?-1!==r||(r=9987):-1!==r||(r=9729),-1!==a||(a=9729),t.texParameteri(3553,10240,a),t.texParameteri(3553,10241,r),t.texParameteri(3553,10242,s),t.texParameteri(3553,10243,s),this.mipmap&&t.generateMipmap(3553)):(-1!==r||(r=9729),-1!==a||(a=9729),t.texParameteri(3553,10241,r),t.texParameteri(3553,10240,a),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),i&&n&&Et.bindTexture(t,i,n),this.canvas=null,o&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},e.disposeResource=function(){k.enabled&&this._allowMerageInAtlas||!this._source||(xt.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},e.clearAtlasSource=function(){},l(0,e,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),l(0,e,"atlasSource",function(){return this.canvas}),l(0,e,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(t){this._allowMerageInAtlas=t}),o}(),Zt=function(t){function u(t,e,i,n){if(this.customCompile=!1,this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,u.__super.call(this),!t||!e)throw"Shader Error";(g.isConchApp||g.isFlash)&&(this.customCompile=!0),this._id=++u._count,this._vs=t,this._ps=e,this._nameMap=n||{},null!=i&&(u.sharders[i]=this)}_(u,"laya.webgl.shader.Shader",Nt);var e=u.prototype;return e.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},e.disposeResource=function(){xt.mainContext.deleteShader(this._vshader),xt.mainContext.deleteShader(this._pshader),xt.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},e._compile=function(){if(this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var t,e=[this._vs,this._ps];this.customCompile&&(t=yt.preGetParams(this._vs,this._ps));var i=xt.mainContext;if(this._program=i.createProgram(),this._vshader=u._createShader(i,e[0],35633),this._pshader=u._createShader(i,e[1],35632),i.attachShader(this._program,this._vshader),i.attachShader(this._program,this._pshader),i.linkProgram(this._program),!this.customCompile&&!i.getProgramParameter(this._program,35714))throw i.getProgramInfoLog(this._program);var n,r,a=0,s=this.customCompile?t.attributes.length:i.getProgramParameter(this._program,35721);for(a=0;a<s;a++){var o=this.customCompile?t.attributes[a]:i.getActiveAttrib(this._program,a);n={vartype:"attribute",glfun:null,ivartype:0,attrib:o,location:i.getAttribLocation(this._program,o.name),name:o.name,type:o.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push(n)}var l=this.customCompile?t.uniforms.length:i.getProgramParameter(this._program,35718);for(a=0;a<l;a++){var h=this.customCompile?t.uniforms[a]:i.getActiveUniform(this._program,a);0<(n={vartype:"uniform",glfun:null,ivartype:1,attrib:o,location:i.getUniformLocation(this._program,h.name),name:h.name,type:h.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(n.name=n.name.substr(0,n.name.length-3),n.isArray=!0,n.location=i.getUniformLocation(this._program,n.name)),this._params.push(n)}for(a=0,r=this._params.length;a<r;a++)if((n=this._params[a]).indexOfParams=a,n.index=1,n.value=[n.location,null],n.codename=n.name,n.name=this._nameMap[n.codename]?this._nameMap[n.codename]:n.codename,(this._paramsMap[n.name]=n)._this=this,n.uploadedValue=[],"attribute"!==n.vartype)switch(n.type){case 5124:n.fun=n.isArray?this._uniform1iv:this._uniform1i;break;case 5126:n.fun=n.isArray?this._uniform1fv:this._uniform1f;break;case 35664:n.fun=n.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:n.fun=n.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:n.fun=n.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:n.fun=this._uniform_sampler2D;break;case 35680:n.fun=this._uniform_samplerCube;break;case 35676:n.glfun=i.uniformMatrix4fv,n.fun=this._uniformMatrix4fv;break;case 35670:n.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else n.fun=this._attribute}},e.getUniform=function(t){return this._paramsMap[t]},e._attribute=function(t,e){var i=xt.mainContext,n=Ft._enableAtributes,r=t.location;return n[r]||i.enableVertexAttribArray(r),i.vertexAttribPointer(r,e[0],e[1],e[2],e[3],e[4]+this._offset),n[r]=Ft._bindVertexBuffer,1},e._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!==e?(xt.mainContext.uniform1f(t.location,i[0]=e),1):0},e._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(xt.mainContext.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return xt.mainContext.uniform1fv(t.location,e),1},e._uniform_vec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(xt.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(xt.mainContext.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return xt.mainContext.uniform2fv(t.location,e),1},e._uniform_vec3=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(xt.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3v=function(t,e){return xt.mainContext.uniform3fv(t.location,e),1},e._uniform_vec4=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(xt.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4v=function(t,e){return xt.mainContext.uniform4fv(t.location,e),1},e._uniformMatrix2fv=function(t,e){return xt.mainContext.uniformMatrix2fv(t.location,!1,e),1},e._uniformMatrix3fv=function(t,e){return xt.mainContext.uniformMatrix3fv(t.location,!1,e),1},e._uniformMatrix4fv=function(t,e){return xt.mainContext.uniformMatrix4fv(t.location,!1,e),1},e._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!==e?(xt.mainContext.uniform1i(t.location,i[0]=e),1):0},e._uniform1iv=function(t,e){return xt.mainContext.uniform1iv(t.location,e),1},e._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(xt.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_ivec2v=function(t,e){return xt.mainContext.uniform2iv(t.location,e),1},e._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(xt.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3vi=function(t,e){return xt.mainContext.uniform3iv(t.location,e),1},e._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(xt.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4vi=function(t,e){return xt.mainContext.uniform4iv(t.location,e),1},e._uniform_sampler2D=function(t,e){var i=xt.mainContext,n=t.uploadedValue;return null==n[0]?(n[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),i.activeTexture(u._TEXTURES[this._curActTexIndex]),Et.bindTexture(i,3553,e),this._curActTexIndex++,1):(i.activeTexture(u._TEXTURES[n[0]]),Et.bindTexture(i,3553,e),0)},e._uniform_samplerCube=function(t,e){var i=xt.mainContext,n=t.uploadedValue;return null==n[0]?(n[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),i.activeTexture(u._TEXTURES[this._curActTexIndex]),Et.bindTexture(i,34067,e),this._curActTexIndex++,1):(i.activeTexture(u._TEXTURES[n[0]]),Et.bindTexture(i,34067,e),0)},e._noSetValue=function(t){console.log("no....:"+t.name)},e.uploadOne=function(t,e){this.activeResource(),Et.UseProgram(this._program);var i=this._paramsMap[t];i.fun.call(this,i,e)},e.uploadTexture2D=function(t){A.shaderCall++;var e=xt.mainContext;e.activeTexture(33984),Et.bindTexture(e,3553,t)},e.upload=function(t,e){Nt.activeShader=Nt.bindShader=this,this._lastUseFrameCount===A.loopCount||this.activeResource(),Et.UseProgram(this._program),this._reCompile?(e=this._params,this._reCompile=!1):e=e||this._params;xt.mainContext;for(var i,n,r=e.length,a=0,s=0;s<r;s++)null!==(n=t[(i=e[s]).name])&&(a+=i.fun.call(this,i,n));A.shaderCall+=a},e.uploadArray=function(t,e,i){Nt.activeShader=this,(Nt.bindShader=this).activeResource(),Et.UseProgram(this._program);this._params;for(var n,r,a=0,s=e-2;0<=s;s-=2)(r=this._paramsMap[t[s]])&&null!=(n=t[s+1])&&(i&&i[r.name]&&i[r.name].bind(),a+=r.fun.call(this,r,n));A.shaderCall+=a},e.getParams=function(){return this._params},u.getShader=function(t){return u.sharders[t]},u.create=function(t,e,i,n){return new u(t,e,i,n)},u.withCompile=function(t,e,i,n){if(i&&u.sharders[i])return u.sharders[i];var r=u._preCompileShader[2e-4*t];if(!r)throw new Error("withCompile shader err!"+t);return r.createShader(e,i,n)},u.withCompile2D=function(t,e,i,n,r){if(n&&u.sharders[n])return u.sharders[n];var a=u._preCompileShader[2e-4*t+e];if(!a)throw new Error("withCompile shader err!"+t+" "+e);return a.createShader(i,n,r)},u.addInclude=function(t,e){yt.addInclude(t,e)},u.preCompile=function(t,e,i,n){var r=2e-4*t;u._preCompileShader[r]=new yt(r,e,i,n)},u.preCompile2D=function(t,e,i,n,r){var a=2e-4*t+e;u._preCompileShader[a]=new yt(a,i,n,r)},u._createShader=function(t,e,i){var n=t.createShader(i);return t.shaderSource(n,e),t.compileShader(n),n},u._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],u._count=0,u._preCompileShader={},u.SHADERNAME2ID=2e-4,u.sharders=((u.sharders=[]).length=32,u.sharders),s(u,["nameKey",function(){return this.nameKey=new R}]),u}(),Kt=function(t){function e(){this._maxsize=0,this._upload=!0,this._uploadSize=0,e.__super.call(this),this.lock=!0}_(e,"laya.webgl.utils.Buffer2D",t);var i=e.prototype;return i.needSize=function(t){var e=this._byteLength;if(t){var i=this._byteLength+t;i<=this._buffer.byteLength||this._resizeBuffer(i<<1,!0),this._byteLength=i}return e},i._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),A.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,Ft._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),Ft._gl.bufferSubData(this._bufferType,0,this._buffer)},i._bufferSubData=function(t,e,i){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._maxsize=Math.max(this._maxsize,this._byteLength),A.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,Ft._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),e||i){var n=this._buffer.slice(e,i);Ft._gl.bufferSubData(this._bufferType,t,n)}else Ft._gl.bufferSubData(this._bufferType,t,this._buffer)},i._checkArrayUse=function(){},i._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},i._bind_subUpload=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData(t,e,i),!0)},i._resizeBuffer=function(t,e){if(t<this._buffer.byteLength)return this;if(this.memorySize=t,e&&this._buffer&&0<this._buffer.byteLength){var i=new ArrayBuffer(t);new Uint8Array(i).set(new Uint8Array(this._buffer),0),this._buffer=i}else this._buffer=new ArrayBuffer(t);return this._checkArrayUse(),this._upload=!0,this},i.append=function(t){this._upload=!0;var e,i;e=t.byteLength,t instanceof Uint8Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint8Array(this._buffer,this._byteLength)):t instanceof Uint16Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint16Array(this._buffer,this._byteLength)):t instanceof Float32Array&&(this._resizeBuffer(this._byteLength+e,!0),i=new Float32Array(this._buffer,this._byteLength)),i.set(t,0),this._byteLength+=e,this._checkArrayUse()},i.appendU16Array=function(t,e){this._resizeBuffer(this._byteLength+2*e,!0);for(var i=new Uint16Array(this._buffer,this._byteLength,e),n=0;n<e;n++)i[n]=t[n];this._byteLength+=2*e,this._checkArrayUse()},i.appendEx=function(t,e){this._upload=!0;var i;i=t.byteLength,this._resizeBuffer(this._byteLength+i,!0),new e(this._buffer,this._byteLength).set(t,0),this._byteLength+=i,this._checkArrayUse()},i.appendEx2=function(t,e,i,n){void 0===n&&(n=1),this._upload=!0;var r,a;r=i*n,this._resizeBuffer(this._byteLength+r,!0),a=new e(this._buffer,this._byteLength);var s=0;for(s=0;s<i;s++)a[s]=t[s];this._byteLength+=r,this._checkArrayUse()},i.getBuffer=function(){return this._buffer},i.setNeedUpload=function(){this._upload=!0},i.getNeedUpload=function(){return this._upload},i.upload=function(){var t=this._bind_upload();return Ft._gl.bindBuffer(this._bufferType,null),Ft._bindActive[this._bufferType]=null,Nt.activeShader=null,t},i.subUpload=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var n=this._bind_subUpload();return Ft._gl.bindBuffer(this._bufferType,null),Ft._bindActive[this._bufferType]=null,Nt.activeShader=null,n},i.disposeResource=function(){t.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},i.clear=function(){this._byteLength=0,this._upload=!0},l(0,i,"bufferLength",function(){return this._buffer.byteLength}),l(0,i,"byteLength",null,function(t){this._byteLength!==t&&(t<=this._buffer.byteLength||this._resizeBuffer(2*t+256,!0),this._byteLength=t)}),e.__int__=function(t){Jt.QuadrangleIB=Jt.create(35044),mt.fillIBQuadrangle(Jt.QuadrangleIB,16)},e.FLOAT32=4,e.SHORT=2,e}(Ft),qt=(function(e){function i(t){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,i.__super.call(this,9)}_(i,"laya.webgl.shader.d2.value.GlowSV",e);var t=i.prototype;t.setValue=function(t){e.prototype.setValue.call(this,t)},t.clear=function(){e.prototype.clear.call(this)}}(Ht),function(t){function e(t){e.__super.call(this,64),this.defines.add(64)}_(e,"laya.webgl.shader.d2.value.TextSV",t);var i=e.prototype;return i.release=function(){(e.pool[e._length++]=this).clear()},i.clear=function(){t.prototype.clear.call(this)},e.create=function(){return e._length?e.pool[--e._length]:new e(null)},e.pool=[],e._length=0,e}(Ht)),Qt=function(t){function r(t,e,i,n){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,r.__super.call(this,t,e,i,n)}_(r,"laya.webgl.shader.d2.Shader2X",t);var e=r.prototype;return e.upload2dQuick1=function(t){this.upload(t,this._params2dQuick1||this._make2dQuick1())},e._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var t,e=this._params,i=0,n=e.length;i<n;i++)t=e[i],(g.isFlash||"size"!==t.name&&"position"!==t.name&&"texcoord"!==t.name)&&this._params2dQuick1.push(t)}return this._params2dQuick1},e.disposeResource=function(){t.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},e.upload2dQuick2=function(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())},e._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var t,e=this._params,i=0,n=e.length;i<n;i++)t=e[i],(g.isFlash||"size"!==t.name)&&this._params2dQuick2.push(t)}return this._params2dQuick2},r.create=function(t,e,i,n){return new r(t,e,i,n)},r}(Zt),Jt=function(t){function e(t){this._uint8Array=null,this._uint16Array=null,void 0===t&&(t=35044),e.__super.call(this),this._bufferUsage=t,this._bufferType=34963,g.isFlash||(this._buffer=new ArrayBuffer(8))}_(e,"laya.webgl.utils.IndexBuffer2D",Kt);var i=e.prototype;return i._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},i.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},i.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},i.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},e.QuadrangleIB=null,e.create=function(t){return void 0===t&&(t=35044),new e(t)},e}(),$t=function(i){function n(t,e){this._floatArray32=null,this._vertexStride=0,n.__super.call(this),this._vertexStride=t,this._bufferUsage=e,this._bufferType=34962,g.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}_(n,"laya.webgl.utils.VertexBuffer2D",i);var t=n.prototype;return t.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},t.bind=function(t){t&&t._bind(),this._bind()},t.insertData=function(t,e){this.getFloat32Array().set(t,e),this._upload=!0},t.bind_upload=function(t){t._bind_upload()||t._bind(),this._bind_upload()||this._bind()},t._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},t.disposeResource=function(){i.prototype.disposeResource.call(this);for(var t=Ft._enableAtributes,e=0;e<10;e++)xt.mainContext.disableVertexAttribArray(e),t[e]=null},t.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},l(0,t,"vertexStride",function(){return this._vertexStride}),n.create=function(t,e){return void 0===e&&(e=35048),new n(t,e)},n}(Kt),te=function(t){function a(t,e,i,n){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===i&&(i=6408),void 0===n&&(n=!0),a.__super.call(this,t,e),this._format=i,this._mipmap=n,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof t)this._url=t,this._src=t,this._image=new d.window.Image,e&&(e.onload&&(this.onload=e.onload),e.onerror&&(this.onerror=e.onerror),e.onCreate&&e.onCreate(this)),this._image.crossOrigin=t&&0==t.indexOf("data:")?null:"",t&&(this._image.src=t);else if(t instanceof ArrayBuffer){this._src=e,this._url=this._src;var r=new o(t);r.readUTFBytes(4),r.readUTFBytes(2),r.getInt16();r.endian="bigEndian",this._w=r.getInt16(),this._h=r.getInt16();r.getInt16(),r.getInt16();this._image=new Uint8Array(t,r.pos),this._format=xt.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,k.enabled&&this._w<k.atlasLimitWidth&&this._h<k.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else this._src=e,this._url=this._src,this._image=t.source||t,this.onresize();this._$5__enableMerageInAtlas=!0}_(a,"laya.webgl.resource.WebGLImage",m);var e=a.prototype;return T.imps(e,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),e._init_=function(t,e){},e._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var t=xt.mainContext,e=this._source=t.createTexture(),i=Et.curBindTexTarget,n=Et.curBindTexValue;switch(Et.bindTexture(t,3553,e),t.pixelStorei(37441,!0),this._format){case 6408:t.texImage2D(3553,0,this._format,6408,5121,this._image);break;case xt.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:t.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image)}t.pixelStorei(37441,!1);var r=this.minFifter,a=this.magFifter,s=this.repeat?10497:33071,o=u.isPOT(this._w,this._h);o?(this.mipmap?-1!==r||(r=9987):-1!==r||(r=9729),-1!==a||(a=9729),t.texParameteri(3553,10241,r),t.texParameteri(3553,10240,a),t.texParameteri(3553,10242,s),t.texParameteri(3553,10243,s),this.mipmap&&t.generateMipmap(3553)):(-1!==r||(r=9729),-1!==a||(a=9729),t.texParameteri(3553,10241,r),t.texParameteri(3553,10240,a),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),i&&n&&Et.bindTexture(t,i,n),this._image.onload=null,this._image=null,o&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._recreateLock=!1},e.recreateResource=function(){var t=this;if(null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var e=this;this._image=new d.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if(e._needReleaseAgain)return e._needReleaseAgain=!1,e._image.onload=null,void(e._image=null);e._allowMerageInAtlas&&e._enableMerageInAtlas?(t.memorySize=0,t._recreateLock=!1):e._createWebGlTexture(),e.completeCreate()},this._image.src=this._src}},e.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(xt.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},e.onresize=function(){this._w=this._image.width,this._h=this._image.height,k.enabled&&this._w<k.atlasLimitWidth&&this._h<k.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},e.clearAtlasSource=function(){this._image=null},l(0,e,"format",function(){return this._format}),l(0,e,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function(t){this._$5__enableMerageInAtlas=t}),l(0,e,"mipmap",function(){return this._mipmap}),l(0,e,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),l(0,e,"atlasSource",function(){return this._image}),l(0,e,"onload",null,function(t){var e=this;this._onload=t,this._image&&(this._image.onload=null!=this._onload?function(){e.onresize(),e._onload()}:null)}),l(0,e,"onerror",null,function(t){var e=this;this._onerror=t,this._image&&(this._image.onerror=null!=this._onerror?function(){e._onerror()}:null)}),a}();T.__init([dt,U,St,yt])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}),function(t,e,rt){rt.un,rt.uns;var i=rt.static,s=rt.class,n=rt.getset,p=rt.__newvec,o=laya.maths.Bezier,c=laya.utils.Browser,Ct=laya.utils.Byte,r=(laya.events.Event,laya.events.EventDispatcher),a=laya.display.Graphics,l=laya.resource.HTMLCanvas,h=laya.utils.Handler,u=laya.net.Loader,_=laya.maths.MathUtil,At=laya.maths.Matrix,d=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle),m=laya.renders.Render,f=(laya.renders.RenderContext,laya.resource.Resource),g=laya.utils.RunDriver,at=laya.display.Sprite,v=laya.utils.Stat,Rt=laya.resource.Texture,y=laya.net.URL,x=laya.utils.Utils,A=function(){function t(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return s(t,"laya.ani.AnimationContent"),t}(),R=function(){function t(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return s(t,"laya.ani.AnimationNodeContent"),t}(),E=function(){function t(){}return s(t,"laya.ani.AnimationParser01"),t.parse=function(t,e){var i=e.__getBuffer(),n=0,r=0,a=0,s=0,o=0,l=0,h=0,u=e.readUTFString();t._aniClassName=u;var c,_=e.readUTFString().split("\n"),d=e.getUint8(),f=e.getUint32(),p=e.getUint32();0<f&&(c=i.slice(f,p));var m=new Ct(c);for(0<p&&(t._publicExtData=i.slice(p,i.byteLength)),t._useParent=!!e.getUint8(),t._anis.length=d,n=0;n<d;n++){var g=t._anis[n]=new A;g.nodes=new Array;var v=g.name=_[e.getUint16()];t._aniMap[v]=n,g.bone3DMap={},g.playTime=e.getFloat32();var y=g.nodes.length=e.getUint8();for(r=g.totalKeyframeDatasLength=0;r<y;r++){var x=g.nodes[r]=new R;x.childs=[];var E=e.getInt16();0<=E&&(x.name=_[E],g.bone3DMap[x.name]=r),x.keyFrame=new Array,x.parentIndex=e.getInt16(),-1==x.parentIndex?x.parent=null:x.parent=g.nodes[x.parentIndex],x.lerpType=e.getUint8();var T=e.getUint32();m.pos=T;var S=x.keyframeWidth=m.getUint16();if(g.totalKeyframeDatasLength+=S,0===x.lerpType||1===x.lerpType)for(x.interpolationMethod=[],x.interpolationMethod.length=S,a=0;a<S;a++)x.interpolationMethod[a]=F.interpolation[m.getUint8()];null!=x.parent&&x.parent.childs.push(x);var w=e.getUint16();0<w&&(x.extenData=i.slice(e.pos,e.pos+w),e.pos+=w);var M,D=e.getUint16(),I=0;for(a=0,s=x.keyFrame.length=D;a<s;a++){if((M=x.keyFrame[a]=new L).duration=e.getFloat32(),M.startTime=I,2===x.lerpType){M.interpolationData=[];var b,C=e.getUint8();switch(b=e.getFloat32()){case 254:for(M.interpolationData.length=S,h=0;h<S;h++)M.interpolationData[h]=0;break;case 255:for(M.interpolationData.length=S,h=0;h<S;h++)M.interpolationData[h]=5;break;default:for(M.interpolationData.push(b),l=1;l<C;l++)M.interpolationData.push(e.getFloat32())}}for(M.data=new Float32Array(S),o=0;o<S;o++)M.data[o]=e.getFloat32(),-1e-8<M.data[o]&&M.data[o]<1e-8&&(M.data[o]=0);I+=M.duration}M.startTime=g.playTime,x.playTime=g.playTime,t._calculateKeyFrame(x,D,S)}}},t}(),T=function(){function E(){}return s(E,"laya.ani.AnimationParser02"),E.READ_DATA=function(){E._DATA.offset=E._reader.getUint32(),E._DATA.size=E._reader.getUint32()},E.READ_BLOCK=function(){for(var t=E._BLOCK.count=E._reader.getUint16(),e=E._BLOCK.blockStarts=[],i=E._BLOCK.blockLengths=[],n=0;n<t;n++)e.push(E._reader.getUint32()),i.push(E._reader.getUint32())},E.READ_STRINGS=function(){var t=E._reader.getUint32(),e=E._reader.getUint16(),i=E._reader.pos;E._reader.pos=t+E._DATA.offset;for(var n=0;n<e;n++)E._strings[n]=E._reader.readUTFString();E._reader.pos=i},E.parse=function(t,e){E._templet=t;(E._reader=e).__getBuffer();E.READ_DATA(),E.READ_BLOCK(),E.READ_STRINGS();for(var i=0,n=E._BLOCK.count;i<n;i++){var r=e.getUint16(),a=E._strings[r],s=E["READ_"+a];if(null==s)throw new Error("model file err,no this function:"+r+" "+a);s.call()}},E.READ_ANIMATIONS=function(){var t=E._reader,e=t.__getBuffer(),i=0,n=0,r=0,a=0,s=t.getUint16(),o=[];for(o.length=s,i=0;i<s;i++)o[i]=F.interpolation[t.getByte()];var l=t.getUint8();for(E._templet._anis.length=l,i=0;i<l;i++){var h=E._templet._anis[i]={};h.nodes=new Array;var u=h.name=E._strings[t.getUint16()];E._templet._aniMap[u]=i,h.bone3DMap={},h.playTime=t.getFloat32();var c=h.nodes.length=t.getInt16();for(n=h.totalKeyframeDatasLength=0;n<c;n++){var _=h.nodes[n]={};_.keyframeWidth=s,_.childs=[];var d=t.getUint16();0<=d&&(_.name=E._strings[d],h.bone3DMap[_.name]=n),_.keyFrame=new Array,_.parentIndex=t.getInt16(),-1==_.parentIndex?_.parent=null:_.parent=h.nodes[_.parentIndex],h.totalKeyframeDatasLength+=s,_.interpolationMethod=o,null!=_.parent&&_.parent.childs.push(_);var f=t.getUint16(),p=null,m=null;for(r=0,a=_.keyFrame.length=f;r<a;r++){(p=_.keyFrame[r]={}).startTime=t.getFloat32(),m&&(m.duration=p.startTime-m.startTime);var g=E._DATA.offset,v=t.getUint32(),y=4*s,x=e.slice(g+v,g+v+y);p.data=new Float32Array(x),m=p}p.duration=0,_.playTime=h.playTime,E._templet._calculateKeyFrame(_,f,s)}}},E._templet=null,E._reader=null,E._strings=[],i(E,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),E}(),Lt=(function(){function t(){}s(t,"laya.ani.AnimationState"),t.stopped=0,t.paused=1,t.playing=2}(),function(){function r(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new Xt,this.resultMatrix=new At,this._children=[]}s(r,"laya.ani.bone.Bone");var t=r.prototype;return t.setTempMatrix=function(t){this._tempMatrix=t;var e,i=0;for(i=0,e=this._children.length;i<e;i++)this._children[i].setTempMatrix(this._tempMatrix)},t.update=function(t){var e;if(this.rotation=this.transform.skX,t)e=this.resultTransform.getMatrix(),At.mul(e,t,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)e=this.resultTransform.getMatrix(),At.mul(e,this.parentBone.resultMatrix,this.resultMatrix);else{var i=this.parentBone,n=NaN,r=NaN,a=NaN,s=this.parentBone.resultMatrix;e=this.resultTransform.getMatrix();var o=s.a*e.tx+s.c*e.ty+s.tx,l=s.b*e.tx+s.d*e.ty+s.ty,h=new At;this.inheritRotation?(n=Math.atan2(i.resultMatrix.b,i.resultMatrix.a),r=Math.cos(n),a=Math.sin(n),h.setTo(r,a,-a,r,0,0),At.mul(this._tempMatrix,h,At.TEMP),At.TEMP.copyTo(h),e=this.resultTransform.getMatrix(),At.mul(e,h,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,e=this.resultTransform.getMatrix(),At.TEMP.identity(),At.TEMP.d=this.d,At.mul(e,At.TEMP,this.resultMatrix)),this.resultMatrix.tx=o,this.resultMatrix.ty=l}else(e=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var u,c=0;for(c=0,u=this._children.length;c<u;c++)this._children[c].update()},t.updateChild=function(){var t,e=0;for(e=0,t=this._children.length;e<t;e++)this._children[e].update()},t.setRotation=function(t){this._sprite&&(this._sprite.rotation=180*t/Math.PI)},t.updateDraw=function(t,e){r.ShowBones&&!r.ShowBones[this.name]||(this._sprite||(this._sprite=new at,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),rt.stage.addChild(this._sprite)),this._sprite.x=t+this.resultMatrix.tx,this._sprite.y=e+this.resultMatrix.ty);var i,n=0;for(n=0,i=this._children.length;n<i;n++)this._children[n].updateDraw(t,e)},t.addChild=function(t){this._children.push(t),t.parentBone=this},t.findBone=function(t){if(this.name==t)return this;var e,i,n=0;for(n=0,e=this._children.length;n<e;n++)if(i=this._children[n].findBone(t))return i;return null},t.localToWorld=function(t){var e=t[0],i=t[1];t[0]=e*this.resultMatrix.a+i*this.resultMatrix.c+this.resultMatrix.tx,t[1]=e*this.resultMatrix.b+i*this.resultMatrix.d+this.resultMatrix.ty},r.ShowBones={},r}()),Ot=function(){function p(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}s(p,"laya.ani.bone.BoneSlot");var t=p.prototype;return t.showSlotData=function(t,e){void 0===e&&(e=!0),this.currSlotData=t,e&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},t.showDisplayByName=function(t){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName(t))},t.replaceDisplayByName=function(t,e){if(this.currSlotData){var i;i=this.currSlotData.getDisplayByName(t);var n;n=this.currSlotData.getDisplayByName(e),this.replaceDisplayByIndex(i,n)}},t.replaceDisplayByIndex=function(t,e){this.currSlotData&&(this._replaceDic[t]=e,this.displayIndex==t&&this.showDisplayByIndex(t))},t.showDisplayByIndex=function(t){if(null!=this._replaceDic[t]&&(t=this._replaceDic[t]),this.currSlotData&&-1<t&&t<this.currSlotData.displayArr.length){if(this.displayIndex=t,this.currDisplayData=this.currSlotData.displayArr[t],this.currDisplayData){var e=this.currDisplayData.name;this.currTexture=this.templet.getTexture(e),this.currTexture&&!m.isConchApp&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},t.replaceSkin=function(t){this._diyTexture=t,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},t.setParentMatrix=function(t){this._parentMatrix=t},t.draw=function(t,e,i,n){if(void 0===i&&(i=!1),void 0===n&&(n=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var r,a=this.currTexture;switch(this._diyTexture&&(a=this._diyTexture),this.currDisplayData.type){case 0:if(t){var s=this.getDisplayMatrix();if(this._parentMatrix){var o=!1;if(s){var l;if(At.mul(s,this._parentMatrix,At.TEMP),l=i?(null==this._resultMatrix&&(this._resultMatrix=new At),this._resultMatrix):new At,!m.isWebGL&&this.currDisplayData.uvs||m.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var h=p._tempMatrix;h.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(h.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(o=!0,h.rotate(-Math.PI/2)),At.mul(h,At.TEMP,l)}else At.TEMP.copyTo(l);o?t.drawTexture(a,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,l):t.drawTexture(a,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,l)}}}break;case 1:if(null==(r=i?(null==this._skinSprite&&(this._skinSprite=p.createSkinMesh()),this._skinSprite):p.createSkinMesh()))return;var u;if(null==this.currDisplayData.bones){var c,_=this.currDisplayData.weights;this.deformData&&(_=this.deformData),c=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=C.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=C.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=_;this.currDisplayData.triangles.length;u=this.currDisplayData.triangles,r.init2(a,null,u,this._mVerticleArr,c);var d,f=this.getDisplayMatrix();if(this._parentMatrix)if(f)At.mul(f,this._parentMatrix,At.TEMP),d=i?(null==this._resultMatrix&&(this._resultMatrix=new At),this._resultMatrix):new At,At.TEMP.copyTo(d),r.transform=d}else this.skinMesh(e,r,n);t.drawSkin(r);break;case 2:if(null==(r=i?(null==this._skinSprite&&(this._skinSprite=p.createSkinMesh()),this._skinSprite):p.createSkinMesh()))return;this.skinMesh(e,r,n),t.drawSkin(r)}}},t.skinMesh=function(t,e,i){var n,r=this.currTexture,a=this.currDisplayData.bones;n=this._diyTexture?(r=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=C.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=C.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var s,o,l=this.currDisplayData.weights,h=this.currDisplayData.triangles,u=0,c=0,_=0,d=NaN,f=NaN,p=0,m=0,g=[],v=0,y=0;if(this.deformData&&0<this.deformData.length){var x=0;for(v=0,y=a.length;v<y;){for(_=a[v++]+v,c=u=0;v<_;v++)o=t[a[v]],d=l[p]+this.deformData[x++],f=l[p+1]+this.deformData[x++],m=l[p+2],u+=(d*o.a+f*o.c+o.tx)*m,c+=(d*o.b+f*o.d+o.ty)*m,p+=3;g.push(u,c)}}else for(v=0,y=a.length;v<y;){for(_=a[v++]+v,c=u=0;v<_;v++)o=t[a[v]],d=l[p],f=l[p+1],m=l[p+2],u+=(d*o.a+f*o.c+o.tx)*m,c+=(d*o.b+f*o.d+o.ty)*m,p+=3;g.push(u,c)}this._mVerticleArr=g,s=h,e.init2(r,null,s,this._mVerticleArr,n)},t.drawBonePoint=function(t){t&&this._parentMatrix&&t.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},t.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},t.getMatrix=function(){return this._resultMatrix},t.copy=function(){var t=new p;return t.type="copy",t.name=this.name,t.attachmentName=this.attachmentName,t.srcDisplayIndex=this.srcDisplayIndex,t.parent=this.parent,t.displayIndex=this.displayIndex,t.templet=this.templet,t.currSlotData=this.currSlotData,t.currTexture=this.currTexture,t.currDisplayData=this.currDisplayData,t},p.createSkinMesh=function(){return m.isWebGL||m.isConchApp?g.skinAniSprite():m.isWebGL?null:U.useSimpleMeshInCanvas?new B:new V},i(p,["_tempMatrix",function(){return this._tempMatrix=new At}]),p}(),S=function(){function t(){this.mesh=null,this.transform=null,this.context=null,this.mode=0}s(t,"laya.ani.bone.canvasmesh.CanvasMeshRender");var e=t.prototype;return e.renderToContext=function(t){this.context=t.ctx||t,this.mesh&&(0==this.mode?this._renderWithIndexes(this.mesh):this._renderNoIndexes(this.mesh))},e._renderNoIndexes=function(t){var e=0,i=t.vertices.length/2,n=0;for(e=0;e<i-2;e++)n=2*e,this._renderDrawTriangle(t,n,n+2,n+4)},e._renderWithIndexes=function(t){var e=t.indexes,i=0,n=e.length;for(i=0;i<n;i+=3){var r=2*e[i],a=2*e[i+1],s=2*e[i+2];this._renderDrawTriangle(t,r,a,s)}},e._renderDrawTriangle=function(t,e,i,n){var r=this.context,a=t.uvs,s=t.vertices,o=t.texture,l=o.bitmap,h=l.source,u=o.width,c=o.height,_=l.width,d=l.height,f=NaN,p=NaN,m=NaN,g=NaN,v=NaN,y=NaN;if(t.useUvTransform){var x=t.uvTransform;f=(a[e]*x.a+a[e+1]*x.c+x.tx)*_,p=(a[i]*x.a+a[i+1]*x.c+x.tx)*_,m=(a[n]*x.a+a[n+1]*x.c+x.tx)*_,g=(a[e]*x.b+a[e+1]*x.d+x.ty)*d,v=(a[i]*x.b+a[i+1]*x.d+x.ty)*d,y=(a[n]*x.b+a[n+1]*x.d+x.ty)*d}else f=a[e]*_,p=a[i]*_,m=a[n]*_,g=a[e+1]*d,v=a[i+1]*d,y=a[n+1]*d;var E=s[e],T=s[i],S=s[n],w=s[e+1],M=s[i+1],D=s[n+1];if(0<t.canvasPadding){var I=t.canvasPadding,b=t.canvasPadding,C=(E+T+S)/3,A=(w+M+D)/3,R=E-C,L=w-A,O=Math.sqrt(R*R+L*L);E=C+R/O*(O+I),w=A+L/O*(O+b),L=M-A,T=C+(R=T-C)/(O=Math.sqrt(R*R+L*L))*(O+I),M=A+L/O*(O+b),L=D-A,S=C+(R=S-C)/(O=Math.sqrt(R*R+L*L))*(O+I),D=A+L/O*(O+b)}if(r.save(),this.transform){var P=this.transform;r.transform(P.a,P.b,P.c,P.d,P.tx,P.ty)}r.beginPath(),r.moveTo(E,w),r.lineTo(T,M),r.lineTo(S,D),r.closePath(),r.clip();var N=1/(f*v+g*m+p*y-v*m-g*p-f*y),V=E*v+g*S+T*y-v*S-g*T-E*y,F=f*T+E*m+p*S-T*m-E*p-f*S,B=f*v*S+g*T*m+E*p*y-E*v*m-g*p*S-f*T*y,U=w*v+g*D+M*y-v*D-g*M-w*y,k=f*M+w*m+p*D-M*m-w*p-f*D,H=f*v*D+g*M*m+w*p*y-w*v*m-g*p*D-f*M*y;r.transform(V*N,U*N,F*N,k*N,B*N,H*N),r.drawImage(h,o.uv[0]*_,o.uv[1]*d,u,c,o.uv[0]*_,o.uv[1]*d,u,c),r.restore()},t}(),w=function(){function t(){this.texture=null,this.uvs=[0,0,1,0,1,1,0,1],this.vertices=[0,0,100,0,100,100,0,100],this.indexes=[0,1,3,3,1,2],this.uvTransform=null,this.useUvTransform=!1,this.canvasPadding=1}return s(t,"laya.ani.bone.canvasmesh.MeshData"),t.prototype.getBounds=function(){return d._getWrapRec(this.vertices)},t}(),Pt=function(){function t(){this.skinName=null,this.deformSlotDataList=[]}return s(t,"laya.ani.bone.DeformAniData"),t}(),Nt=function(){function t(){this.deformSlotDisplayList=[]}return s(t,"laya.ani.bone.DeformSlotData"),t}(),Vt=function(){function t(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}s(t,"laya.ani.bone.DeformSlotDisplayData");var e=t.prototype;return e.binarySearch1=function(t,e){var i=0,n=t.length-2;if(0==n)return 1;for(var r=n>>>1;;){if(t[Math.floor(r+1)]<=e?i=r+1:n=r,i==n)return i+1;r=i+n>>>1}return 0},e.apply=function(t,e,i){if(void 0===i&&(i=1),t+=.05,!(this.timeList.length<=0)){var n=0;if(!(t<this.timeList[0])){var r=this.vectices[0].length,a=[],s=this.binarySearch1(this.timeList,t);if(this.frameIndex=s,t>=this.timeList[this.timeList.length-1]){var o=this.vectices[this.vectices.length-1];if(i<1)for(n=0;n<r;n++)a[n]+=(o[n]-a[n])*i;else for(n=0;n<r;n++)a[n]=o[n];this.deformData=a}else{this.tweenKeyList[this.frameIndex];var l=this.vectices[this.frameIndex-1],h=this.vectices[this.frameIndex],u=this.timeList[this.frameIndex-1],c=this.timeList[this.frameIndex];i=this.tweenKeyList[s-1]?(t-u)/(c-u):0;var _=NaN;for(n=0;n<r;n++)_=l[n],a[n]=_+(h[n]-_)*i;this.deformData=a}}}},t}(),Ft=function(){function t(){this.time=NaN,this.drawOrder=[]}return s(t,"laya.ani.bone.DrawOrderData"),t}(),Bt=function(){function t(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return s(t,"laya.ani.bone.EventData"),t}(),M=function(){function nt(t,e){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=t,this._targetBone=e[t.targetBoneIndex],this.isSpine=t.isSpine,null==this._bones&&(this._bones=[]);for(var i=this._bones.length=0,n=t.boneIndexs.length;i<n;i++)this._bones.push(e[t.boneIndexs[i]]);this.name=t.name,this.mix=t.mix,this.bendDirection=t.bendDirection}s(nt,"laya.ani.bone.IkConstraint");var t=nt.prototype;return t.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},t._applyIk1=function(t,e,i,n){var r=t.parentBone,a=1/(r.resultMatrix.a*r.resultMatrix.d-r.resultMatrix.b*r.resultMatrix.c),s=e-r.resultMatrix.tx,o=i-r.resultMatrix.ty,l=(s*r.resultMatrix.d-o*r.resultMatrix.c)*a-t.transform.x,h=(o*r.resultMatrix.a-s*r.resultMatrix.b)*a-t.transform.y,u=Math.atan2(h,l)*nt.radDeg-0-t.transform.skX;t.transform.scX<0&&(u+=180),180<u?u-=360:u<-180&&(u+=360),t.transform.skX=t.transform.skY=t.transform.skX+u*n,t.update()},t.updatePos=function(t,e){this._sp&&this._sp.pos(t,e)},t._applyIk2=function(t,e,i,n,r,a){if(0!=a){var s=t.resultTransform.x,o=t.resultTransform.y,l=t.transform.scX,h=t.transform.scY,u=e.transform.scX,c=0,_=0,d=0;d=l<0?(l=-l,c=180,-1):(c=0,1),h<0&&(h=-h,d=-d),_=u<0?(u=-u,180):0;var f=e.resultTransform.x,p=NaN,m=NaN,g=NaN,v=t.resultMatrix.a,y=t.resultMatrix.c,x=t.resultMatrix.b,E=t.resultMatrix.d,T=Math.abs(l-h)<=1e-4;g=T?(m=v*f+y*(p=e.resultTransform.y)+t.resultMatrix.tx,x*f+E*p+t.resultMatrix.ty):(p=0,m=v*f+t.resultMatrix.tx,x*f+t.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new at,rt.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(i,n,15,"#ffff00"),this._sp.graphics.drawCircle(m,g,15,"#ff00ff")),t.setRotation(Math.atan2(g-t.resultMatrix.ty,m-t.resultMatrix.tx));var S=t.parentBone;v=S.resultMatrix.a,y=S.resultMatrix.c,x=S.resultMatrix.b;var w=1/(v*(E=S.resultMatrix.d)-y*x),M=i-S.resultMatrix.tx,D=n-S.resultMatrix.ty,I=(M*E-D*y)*w-s,b=(D*v-M*x)*w-o,C=((M=m-S.resultMatrix.tx)*E-(D=g-S.resultMatrix.ty)*y)*w-s,A=(D*v-M*x)*w-o,R=Math.sqrt(C*C+A*A),L=e.length*u,O=NaN,P=NaN;if(T){var N=(I*I+b*b-R*R-(L*=l)*L)/(2*R*L);N<-1?N=-1:1<N&&(N=1),P=Math.acos(N)*r,v=R+L*N,y=L*Math.sin(P),O=Math.atan2(b*v-I*y,I*v+b*y)}else{var V=(v=l*L)*v,F=(y=h*L)*y,B=I*I+b*b,U=Math.atan2(b,I),k=-2*F*R,H=F-V;if(0<(E=k*k-4*H*(x=F*R*R+V*B-V*F))){var z=Math.sqrt(E);k<0&&(z=-z);var G=(z=-(k+z)/2)/H,W=x/z,X=Math.abs(G)<Math.abs(W)?G:W;X*X<=B&&(D=Math.sqrt(B-X*X)*r,O=U-Math.atan2(D,X),P=Math.atan2(D/h,(X-R)/l))}var Y=0,j=Number.MAX_VALUE,Z=0,K=0,q=0,Q=0,J=0,$=0;Q<(E=(M=R+v)*M)&&(q=0,Q=E,J=M),(E=(M=R-v)*M)<j&&(Y=Math.PI,j=E,Z=M);var tt=Math.acos(-v*R/(V-F));(E=(M=v*Math.cos(tt)+R)*M+(D=y*Math.sin(tt))*D)<j&&(Y=tt,j=E,Z=M,K=D),Q<E&&(q=tt,Q=E,J=M,$=D),P=B<=(j+Q)/2?(O=U-Math.atan2(K*r,Z),Y*r):(O=U-Math.atan2($*r,J),q*r)}var et=Math.atan2(p,f)*d,it=t.resultTransform.skX;180<(O=(O-et)*nt.radDeg+c-it)?O-=360:O<-180&&(O+=360),t.resultTransform.x=s,t.resultTransform.y=o,t.resultTransform.skX=t.resultTransform.skY=it+O*a,it=e.resultTransform.skX,180<(P=((P+et)*nt.radDeg-0)*d+_-(it%=360))?P-=360:P<-180&&(P+=360),e.resultTransform.x=f,e.resultTransform.y=p,e.resultTransform.skX=e.resultTransform.skY=e.resultTransform.skY+P*a,t.update()}},t._applyIk3=function(t,e,i,n,r,a){if(0!=a){var s,o,l=e.resultMatrix.a*e.length,h=e.resultMatrix.b*e.length,u=l*l+h*h,c=Math.sqrt(u),_=t.resultMatrix.tx,d=t.resultMatrix.ty,f=e.resultMatrix.tx,p=e.resultMatrix.ty,m=f-_,g=p-d,v=m*m+g*g,y=Math.sqrt(v),x=(m=i-t.resultMatrix.tx)*m+(g=n-t.resultMatrix.ty)*g,E=Math.sqrt(x);if(c+y<=E||E+c<=y||E+y<=c){var T=NaN;f=_+(T=c+y<=E?1:-1)*(i-_)*y/E,p=d+T*(n-d)*y/E}else{var S=(v-u+x)/(2*x),w=Math.sqrt(v-S*S*x)/E,M=_+m*S,D=d+g*S,I=-g*w,b=m*w;p=0<r?(f=M-I,D-b):(f=M+I,D+b)}s=f,o=p,this.isDebug&&(this._sp||(this._sp=new at,rt.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(_,d,15,"#ff00ff"),this._sp.graphics.drawCircle(i,n,15,"#ffff00"),this._sp.graphics.drawCircle(s,o,15,"#ff00ff"));var C,A;C=Math.atan2(o-t.resultMatrix.ty,s-t.resultMatrix.tx),t.setRotation(C),(A=nt._tempMatrix).identity(),A.rotate(C),A.scale(t.resultMatrix.getScaleX(),t.resultMatrix.getScaleY()),A.translate(t.resultMatrix.tx,t.resultMatrix.ty),A.copyTo(t.resultMatrix),t.updateChild();var R,L;R=Math.atan2(n-o,i-s),e.setRotation(R),(L=nt._tempMatrix).identity(),L.rotate(R),L.scale(e.resultMatrix.getScaleX(),e.resultMatrix.getScaleY()),L.translate(s,o),A.copyTo(e.resultMatrix),e.updateChild()}},i(nt,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new At}]),nt}(),Ut=function(){function t(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return s(t,"laya.ani.bone.IkConstraintData"),t}(),D=function(){function d(){}return s(d,"laya.ani.bone.MeshTools"),d.findEdge=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!0);var n,r=0,a=0;for(n=t.length,a=-1,r=0;r<n;r+=2)(a<0||i==t[a+e]<t[r+e])&&(a=r);return a},d.findBestTriangle=function(t){var e;e=d.findEdge(t,1,!0);var i;i=d.findEdge(t,1,!1);var n;n=d.findEdge(t,0,!0);var r,a;return r=d.findEdge(t,0,!1),(a=d._bestTriangle).length=0,a.push(n,r),a.indexOf(e)<0&&a.push(e),a.indexOf(i)<0&&a.push(i),a},d.solveMesh=function(t,e){var i,n,r,a;(e=e||[]).length=0,i=t.uvs,n=t.vertices;var s,o,l;return s=(a=d.findBestTriangle(i))[0],o=a[1],l=a[2],d._absArr.length=0,r=d.solvePoints(t.texture.uv,i[s],i[s+1],i[o]-i[s],i[o+1]-i[s+1],i[l]-i[s],i[l+1]-i[s+1],d._absArr),d.transPoints(r,n[s],n[s+1],n[o]-n[s],n[o+1]-n[s+1],n[l]-n[s],n[l+1]-n[s+1],e)},d.solvePoints=function(t,e,i,n,r,a,s,o){o=o||[];var l,h,u=0;for(l=t.length,u=0;u<l;u+=2)h=d.solve2(t[u],t[u+1],e,i,n,r,a,s),o.push(h[0],h[1]);return o},d.transPoints=function(t,e,i,n,r,a,s,o){o=o||[];var l,h=0;for(l=t.length,h=0;h<l;h+=2)d.transPoint(t[h],t[h+1],e,i,n,r,a,s,o);return o},d.transPoint=function(t,e,i,n,r,a,s,o,l){var h,u;return h=i+r*t+s*e,u=n+a*t+o*e,(l=l||[]).push(h,u),l},d.solve2=function(t,e,i,n,r,a,s,o,l,h){void 0===l&&(l=!1),h=h||[];var u,c;if(0==r)return d.solve2(t,e,i,n,s,o,r,a,!0,h);var _;return u=((_=t-i)-(c=(e-n-_*a/r)/(o-s*a/r))*s)/r,l?h.push(c,u):h.push(u,c),h},d.solve=function(t,e,i,n){return d.solve2(t.x,t.y,e.x,e.y,i.x,i.y,n.x,n.y)},d._bestTriangle=[],d._absArr=[],d}(),I=function(){function L(t,e){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=t,this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.bones=[];for(var i=this.data.bones,n=0,r=i.length;n<r;n++)this.bones.push(e[i[n]])}s(L,"laya.ani.bone.PathConstraint");var t=L.prototype;return t.apply=function(t,e){if(this.target){var i=this.translateMix,n=this.translateMix,r=0<n,a=this.data.spacingMode,s="length"==a,o=this.data.rotateMode,l="tangent"==o,h="chainScale"==o,u=[],c=this.bones.length,_=l?c:c+1,d=[];(this._spaces=d)[0]=this.position;var f=this.spacing;if(h||s)for(var p=0,m=_-1;p<m;){var g=this.bones[p],v=g.length,y=v*g.resultMatrix.a,x=v*g.resultMatrix.b;v=Math.sqrt(y*y+x*x),h&&(u[p]=v),d[++p]=s?Math.max(0,v+f):f}else for(p=1;p<_;p++)d[p]=f;var E=this.computeWorldPositions(this.target,t,e,_,l,"percent"==this.data.positionMode,"percent"==a);if(this._debugKey){for(p=0;p<E.length;p++)e.drawCircle(E[p++],E[p++],5,"#00ff00");var T=[];for(p=0;p<E.length;p++)T.push(E[p++],E[p++]);e.drawLines(0,0,T,"#ff0000")}var S=E[0],w=E[1],M=this.data.offsetRotation,D="chain"==o&&0==M,I=NaN;for(p=0,I=3;p<c;p++,I+=3){(g=this.bones[p]).resultMatrix.tx+=(S-g.resultMatrix.tx)*i,g.resultMatrix.ty+=(w-g.resultMatrix.ty)*i;var b=(y=E[I])-S,C=(x=E[I+1])-w;if(h&&0!=(v=u[p])){var A=(Math.sqrt(b*b+C*C)/v-1)*n+1;g.resultMatrix.a*=A,g.resultMatrix.c*=A}if(S=y,w=x,r){var R=g.resultMatrix.a,L=g.resultMatrix.c,O=g.resultMatrix.b,P=g.resultMatrix.d,N=NaN,V=NaN,F=NaN;N=l?E[I-1]:0==d[p+1]?E[I+2]:Math.atan2(C,b),N-=Math.atan2(O,R)-M/180*Math.PI,D&&(V=Math.cos(N),F=Math.sin(N),S+=((v=g.length)*(V*R-F*O)-b)*n,w+=(v*(F*R+V*O)-C)*n),N>Math.PI?N-=2*Math.PI:N<-Math.PI&&(N+=2*Math.PI),N*=n,V=Math.cos(N),F=Math.sin(N),g.resultMatrix.a=V*R-F*O,g.resultMatrix.c=V*L-F*P,g.resultMatrix.b=F*R+V*O,g.resultMatrix.d=F*L+V*P}}}},t.computeWorldVertices2=function(t,e,i,n,r,a){var s,o,l=t.currDisplayData.bones,h=t.currDisplayData.weights,u=t.currDisplayData.triangles,c=0,_=0,d=0,f=0,p=0,m=0,g=0,v=0,y=0,x=0,E=0;if(null!=l){for(c=0;c<i;c+=2)_+=(f=l[_])+1,d+=f;var T=e;for(p=a,m=3*d;p<n;p+=2){for(v=g=0,f=l[_++],f+=_;_<f;_++,m+=3){s=T[l[_]].resultMatrix,y=h[m],x=h[m+1];var S=h[m+2];g+=(y*s.a+x*s.c+s.tx)*S,v+=(y*s.b+x*s.d+s.ty)*S}r[p]=g,r[p+1]=v}}else{var w,M;if(u||(u=h),t.deformData&&(u=t.deformData),w=t.parent,e)for(E=e.length,c=0;c<E;c++)if(e[c].name==w){o=e[c];break}o&&(M=o.resultMatrix),M||(M=L._tempMt);var D=M.tx,I=M.ty,b=M.a,C=M.b,A=M.c,R=M.d;for(o&&(R*=o.d),_=i,p=a;p<n;_+=2,p+=2)y=u[_],x=u[_+1],r[p]=y*b+x*C+D,r[p+1]=-(y*A+x*R+I)}},t.computeWorldPositions=function(t,e,i,n,r,a,s){t.currDisplayData.bones,t.currDisplayData.weights,t.currDisplayData.triangles;var o=[],l=0,h=t.currDisplayData.verLen,u=this.position,c=this._spaces,_=[],d=[],f=h/6,p=-1,m=NaN,g=0,v=0,y=NaN,x=NaN,E=NaN,T=NaN;if(f--,h-=4,this.computeWorldVertices2(t,e,2,h,o,0),this._debugKey)for(l=0;l<o.length;)i.drawCircle(o[l++],o[l++],10,"#ff0000");_=o,this._curves.length=f;var S=this._curves,w=_[m=0],M=_[1],D=0,I=0,b=0,C=0,A=0,R=0,L=NaN,O=NaN,P=NaN,N=NaN,V=NaN,F=NaN,B=NaN,U=NaN,k=0;for(l=0,k=2;l<f;l++,k+=6)D=_[k],I=_[k+1],b=_[k+2],C=_[k+3],V=2*(L=.1875*(w-2*D+b))+(P=.09375*(3*(D-b)-w+(A=_[k+4]))),F=2*(O=.1875*(M-2*I+C))+(N=.09375*(3*(I-C)-M+(R=_[k+5]))),B=.75*(D-w)+L+.16666667*P,U=.75*(I-M)+O+.16666667*N,m+=Math.sqrt(B*B+U*U),B+=V,U+=F,V+=P,F+=N,m+=Math.sqrt(B*B+U*U),B+=V,U+=F,m+=Math.sqrt(B*B+U*U),B+=V+P,U+=F+N,m+=Math.sqrt(B*B+U*U),S[l]=m,w=A,M=R;if(a&&(u*=m),s)for(l=0;l<n;l++)c[l]*=m;var H=this._segments,z=0,G=0;for(G=v=g=l=0;l<n;l++,g+=3)if((y=u+=x=c[l])<0)this.addBeforePosition(y,_,0,d,g);else if(m<y)this.addAfterPosition(y-m,_,h-4,d,g);else{for(;;v++)if(!((T=S[v])<y)){0==v?y/=T:y=(y-(E=S[v-1]))/(T-E);break}if(v!=p){var W=6*(p=v);for(w=_[W],M=_[W+1],D=_[W+2],I=_[W+3],b=_[W+4],C=_[W+5],V=2*(L=.03*(w-2*D+b))+(P=.006*(3*(D-b)-w+(A=_[W+6]))),F=2*(O=.03*(M-2*I+C))+(N=.006*(3*(I-C)-M+(R=_[W+7]))),B=.3*(D-w)+L+.16666667*P,U=.3*(I-M)+O+.16666667*N,z=Math.sqrt(B*B+U*U),H[0]=z,W=1;W<8;W++)B+=V,U+=F,V+=P,F+=N,z+=Math.sqrt(B*B+U*U),H[W]=z;B+=V,U+=F,z+=Math.sqrt(B*B+U*U),H[8]=z,B+=V+P,U+=F+N,z+=Math.sqrt(B*B+U*U),H[9]=z,G=0}for(y*=z;;G++)if(!((T=H[G])<y)){0==G?y/=T:y=G+(y-(E=H[G-1]))/(T-E);break}this.addCurvePosition(.1*y,w,M,D,I,b,C,A,R,d,g,r||0<l&&0==x)}return d},t.addBeforePosition=function(t,e,i,n,r){var a=e[i],s=e[i+1],o=e[i+2]-a,l=e[i+3]-s,h=Math.atan2(l,o);n[r]=a+t*Math.cos(h),n[r+1]=s+t*Math.sin(h),n[r+2]=h},t.addAfterPosition=function(t,e,i,n,r){var a=e[i+2],s=e[i+3],o=a-e[i],l=s-e[i+1],h=Math.atan2(l,o);n[r]=a+t*Math.cos(h),n[r+1]=s+t*Math.sin(h),n[r+2]=h},t.addCurvePosition=function(t,e,i,n,r,a,s,o,l,h,u,c){0==t&&(t=1e-4);var _=t*t,d=_*t,f=1-t,p=f*f,m=p*f,g=f*t,v=3*g,y=f*v,x=v*t,E=e*m+n*y+a*x+o*d,T=i*m+r*y+s*x+l*d;h[u]=E,h[u+1]=T,h[u+2]=c?Math.atan2(T-(i*p+r*g*2+s*_),E-(e*p+n*g*2+a*_)):0},L.NONE=-1,L.BEFORE=-2,L.AFTER=-3,i(L,["_tempMt",function(){return this._tempMt=new At}]),L}(),kt=function(){function t(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return s(t,"laya.ani.bone.PathConstraintData"),t}(),Ht=function(){function t(){this.name=null,this.slotArr=[]}return s(t,"laya.ani.bone.SkinData"),t}(),zt=function(){function t(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}s(t,"laya.ani.bone.SkinSlotDisplayData");var e=t.prototype;return e.createTexture=function(t){return this.texture||(this.texture=new Rt(t.bitmap,this.uvs),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=t.height,this.texture.height=t.width,this.texture.offsetX=-t.offsetX,this.texture.offsetY=-t.offsetY,this.texture.sourceWidth=t.sourceHeight,this.texture.sourceHeight=t.sourceWidth):(this.texture.width=t.width,this.texture.height=t.height,this.texture.offsetX=-t.offsetX,this.texture.offsetY=-t.offsetY,this.texture.sourceWidth=t.sourceWidth,this.texture.sourceHeight=t.sourceHeight),m.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture},e.destory=function(){this.texture&&this.texture.destroy()},t}(),Gt=function(){function t(){this.name=null,this.displayArr=[]}return s(t,"laya.ani.bone.SlotData"),t.prototype.getDisplayByName=function(t){for(var e=0,i=this.displayArr.length;e<i;e++)if(this.displayArr[e].attachmentName==t)return e;return-1},t}(),b=function(){function t(t,e){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=p(2,0),this._data=t,null==this._bones&&(this._bones=[]),this.target=e[t.targetIndex];var i,n=0;for(n=0,i=t.boneIndexs.length;n<i;n++)this._bones.push(e[t.boneIndexs[n]]);this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix}return s(t,"laya.ani.bone.TfConstraint"),t.prototype.apply=function(){for(var t,e=this.target.resultMatrix.a,i=this.target.resultMatrix.b,n=this.target.resultMatrix.c,r=this.target.resultMatrix.d,a=0,s=this._bones.length;a<s;a++){if(t=this._bones[a],0<this.rotateMix){var o=t.resultMatrix.a,l=t.resultMatrix.b,h=t.resultMatrix.c,u=t.resultMatrix.d,c=Math.atan2(n,e)-Math.atan2(h,o)+this._data.offsetRotation*Math.PI/180;c>Math.PI?c-=2*Math.PI:c<-Math.PI&&(c+=2*Math.PI),c*=this.rotateMix;var _=Math.cos(c),d=Math.sin(c);t.resultMatrix.a=_*o-d*h,t.resultMatrix.b=_*l-d*u,t.resultMatrix.c=d*o+_*h,t.resultMatrix.d=d*l+_*u}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),t.resultMatrix.tx+=(this._temp[0]-t.resultMatrix.tx)*this.translateMix,t.resultMatrix.ty+=(this._temp[1]-t.resultMatrix.ty)*this.translateMix,t.updateChild()),0<this.scaleMix){var f=Math.sqrt(t.resultMatrix.a*t.resultMatrix.a+t.resultMatrix.c*t.resultMatrix.c),p=Math.sqrt(e*e+n*n),m=1e-5<f?(f+(p-f+this._data.offsetScaleX)*this.scaleMix)/f:0;t.resultMatrix.a*=m,t.resultMatrix.c*=m,f=Math.sqrt(t.resultMatrix.b*t.resultMatrix.b+t.resultMatrix.d*t.resultMatrix.d),p=Math.sqrt(i*i+r*r),m=1e-5<f?(f+(p-f+this._data.offsetScaleY)*this.scaleMix)/f:0,t.resultMatrix.b*=m,t.resultMatrix.d*=m}if(0<this.shearMix){l=t.resultMatrix.b,u=t.resultMatrix.d;var g=Math.atan2(u,l);(c=Math.atan2(r,i)-Math.atan2(n,e)-(g-Math.atan2(t.resultMatrix.c,t.resultMatrix.a)))>Math.PI?c-=2*Math.PI:c<-Math.PI&&(c+=2*Math.PI),c=g+(c+this._data.offsetShearY*Math.PI/180)*this.shearMix,m=Math.sqrt(l*l+u*u),t.resultMatrix.b=Math.cos(c)*m,t.resultMatrix.d=Math.sin(c)*m}}},t}(),Wt=function(){function t(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return s(t,"laya.ani.bone.TfConstraintData"),t}(),Xt=function(){function t(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}s(t,"laya.ani.bone.Transform");var e=t.prototype;return e.initData=function(t){null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.skX&&(this.skX=t.skX),null!=t.skY&&(this.skY=t.skY),null!=t.scX&&(this.scX=t.scX),null!=t.scY&&(this.scY=t.scY)},e.getMatrix=function(){var t;return(t=this.mMatrix?this.mMatrix:this.mMatrix=new At).identity(),t.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew(t,this.skewX*Math.PI/180,this.skewY*Math.PI/180),t.rotate(this.skX*Math.PI/180),t.translate(this.x,this.y),t},e.skew=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),a=Math.sin(e),s=Math.cos(e);return t.setTo(t.a*s-t.b*n,t.a*a+t.b*r,t.c*s-t.d*n,t.c*a+t.d*r,t.tx*s-t.ty*n,t.tx*a+t.ty*r),t},t}(),C=function(){function t(){}return s(t,"laya.ani.bone.UVTools"),t.getRelativeUV=function(t,e,i){var n=t[0],r=t[2]-t[0],a=t[1],s=t[5]-t[1];i||(i=[]),i.length=e.length;var o,l=0;o=i.length;var h=1/r,u=1/s;for(l=0;l<o;l+=2)i[l]=(e[l]-n)*h,i[l+1]=(e[l+1]-a)*u;return i},t.getAbsoluteUV=function(t,e,i){if(0==t[0]&&0==t[1]&&1==t[4]&&1==t[5])return i?(x.copyArray(i,e),i):e;var n=t[0],r=t[2]-t[0],a=t[1],s=t[5]-t[1];i||(i=[]),i.length=e.length;var o,l=0;for(o=i.length,l=0;l<o;l+=2)i[l]=e[l]*r+n,i[l+1]=e[l+1]*s+a;return i},t}(),L=function(){function t(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return s(t,"laya.ani.KeyFramesContent"),t}(),O=function(){function u(){}return s(u,"laya.ani.math.BezierLerp"),u.getBezierRate=function(t,e,i,n,r){var a=u._getBezierParamKey(e,i,n,r),s=100*a+t;if(u._bezierResultCache[s])return u._bezierResultCache[s];var o,l=u._getBezierPoints(e,i,n,r,a),h=0;for(o=l.length,h=0;h<o;h+=2)if(t<=l[h])return u._bezierResultCache[s]=l[h+1],l[h+1];return u._bezierResultCache[s]=1},u._getBezierParamKey=function(t,e,i,n){return 100*(100*(100*(100*t+e)+i)+n)},u._getBezierPoints=function(t,e,i,n,r){return u._bezierPointsCache[r]?u._bezierPointsCache[r]:(a=[0,0,t,e,i,n,1,1],s=(new o).getBezierPoints(a,100,3),u._bezierPointsCache[r]=s);var a,s},u._bezierResultCache={},u._bezierPointsCache={},u}(),P=function(t){function e(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,e.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}s(e,"laya.ani.AnimationPlayer",r);var i=e.prototype;return rt.imps(i,{"laya.resource.IDestroy":!0}),i._onTempletLoadedComputeFullKeyframeIndices=function(t,e,i){this._templet===i&&this._cachePlayRate===t&&this._cacheFrameRate===e&&this._computeFullKeyframeIndices()},i._computeFullKeyframeIndices=function(){for(var t=this._fullFrames=[],e=this._templet,i=this._cacheFrameRateInterval*this._cachePlayRate,n=0,r=e.getAnimationCount();n<r;n++){for(var a=[],s=0,o=e.getAnimation(n).nodes.length;s<o;s++){for(var l=e.getAnimation(n).nodes[s],h=Math.floor(l.playTime/i+.01),u=new Uint16Array(h+1),c=-1,_=0,d=l.keyFrame.length;_<d;_++){var f=l.keyFrame[_],p=f.startTime,m=p+f.duration+i;do{for(var g=Math.floor(p/i+.5),v=c+1;v<g;v++)u[v]=_;u[c=g]=_,p+=i}while(p<=m)}a.push(u)}t.push(a)}},i._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},i._calculatePlayDuration=function(){if(0!==this.state){var t=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=t),this._playEnd>t&&(this._playEnd=t),this._playDuration=this._playEnd-this._playStart}},i._setPlayParams=function(t,e){this._currentTime=t,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/e+.01),0),this._currentFrameTime=this._currentKeyframeIndex*e},i._setPlayParamsWhenStop=function(t,e){this._currentTime=t,this._currentKeyframeIndex=Math.max(Math.floor(t/e+.01),0),this._currentFrameTime=this._currentKeyframeIndex*e,this._currentAnimationClipIndex=-1},i._update=function(t){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var e=this._cacheFrameRateInterval*this._cachePlayRate,i=0;this._startUpdateLoopCount!==v.loopCount&&(i=t*this.playbackRate,this._elapsedPlaybackTime+=i);var n=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=n)return this._setPlayParamsWhenStop(n,e),void this.event("stopped");if(i+=this._currentTime,0<n)if(n<=i)do{if(i-=n,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(n,e),this._stopWhenCircleFinish=!1,void this.event("stopped");i<n&&(this._setPlayParams(i,e),this.event("complete"))}while(n<=i);else this._setPlayParams(i,e);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(n,e),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},i._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},i.play=function(t,e,i,n,r){if(void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=2147483647),void 0===n&&(n=0),void 0===r&&(r=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(i<0||n<0||r<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==r&&r<n)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=e,this._overallDuration=i,this._playStart=n,this._playEnd=r,this._paused=!1,this._currentAnimationClipIndex=t,this._currentKeyframeIndex=0,this._startUpdateLoopCount=v.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},i.playByFrame=function(t,e,i,n,r,a){void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=2147483647),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=30);var s=1e3/a;this.play(t,e,i,n*s,r*s)},i.stop=function(t){void 0===t&&(t=!0),t?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},n(0,i,"playEnd",function(){return this._playEnd}),n(0,i,"templet",function(){return this._templet},function(t){0===!this.state&&this.stop(!0),this._templet!==t&&((this._templet=t).loaded?this._computeFullKeyframeIndices():t.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),n(0,i,"playStart",function(){return this._playStart}),n(0,i,"playDuration",function(){return this._playDuration}),n(0,i,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),n(0,i,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),n(0,i,"overallDuration",function(){return this._overallDuration}),n(0,i,"currentFrameTime",function(){return this._currentFrameTime}),n(0,i,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),n(0,i,"currentPlayTime",function(){return this._currentTime+this._playStart}),n(0,i,"cachePlayRate",function(){return this._cachePlayRate},function(t){this._cachePlayRate!==t&&(this._cachePlayRate=t,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[t,this._cacheFrameRate])))}),n(0,i,"cacheFrameRate",function(){return this._cacheFrameRate},function(t){this._cacheFrameRate!==t&&(this._cacheFrameRate=t,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,t])))}),n(0,i,"currentTime",null,function(t){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if(t<this._playStart||t>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=v.loopCount;var e=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=t,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/e),0),this._currentFrameTime=this._currentKeyframeIndex*e}}),n(0,i,"paused",function(){return this._paused},function(t){(this._paused=t)&&this.event("paused")}),n(0,i,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),n(0,i,"destroyed",function(){return this._destroyed}),e}(),N=function(t){function e(){e.__super.call(this),m.isConchNode&&(this.drawSkin=function(t){t.transform||(t.transform=At.EMPTY),this.setSkinMesh&&this.setSkinMesh(t._ps,t.mVBData,t.mEleNum,0,t.mTexture,t.transform)})}return s(e,"laya.ani.GraphicsAni",a),e.prototype.drawSkin=function(t){var e=[t];this._saveToCmd(m._context._drawSkin,e)},e}(),V=function(t){function n(){n.__super.call(this),this.mesh=new w}s(n,"laya.ani.bone.canvasmesh.SkinMeshCanvas",S);var e=n.prototype;return e.init2=function(t,e,i,n,r){var a;this.transform&&(this.transform=null),i?a=i:(a=[]).push(0,1,3,3,1,2),this.mesh.texture=t,this.mesh.indexes=a,this.mesh.vertices=n,this.mesh.uvs=r},e.render=function(t,e,i){this.mesh.texture&&(this.transform?(this.transform.translate(e,i),this.renderToContext(t),this.transform.translate(-e,-i)):(this.transform=n._tempMatrix,this.transform.identity(),this.transform.translate(e,i),this.renderToContext(t),this.transform.translate(-e,-i),this.transform=null))},i(n,["_tempMatrix",function(){return this._tempMatrix=new At}]),n}(),F=function(t){function v(){this._aniMap={},this.unfixedLastAniIndex=-1,v.__super.call(this),this._anis=new Array}s(v,"laya.ani.AnimationTemplet",f);var e=v.prototype;return e.parse=function(t){var e=new Ct(t);this._aniVersion=e.readUTFString(),E.parse(this,e)},e._calculateKeyFrame=function(t,e,i){var n=t.keyFrame;n[e]=n[0];for(var r=0;r<e;r++){var a=n[r];a.nextData=0===a.duration?a.data:n[r+1].data}n.length--},e.onAsynLoaded=function(t,e,i){var n=new Ct(e);switch(this._aniVersion=n.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":T.parse(this,n);break;default:E.parse(this,n)}this._endLoaded()},e.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},e.getAnimationCount=function(){return this._anis.length},e.getAnimation=function(t){return this._anis[t]},e.getAniDuration=function(t){return this._anis[t].playTime},e.getNodes=function(t){return this._anis[t].nodes},e.getNodeIndexWithName=function(t,e){return this._anis[t].bone3DMap[e]},e.getNodeCount=function(t){return this._anis[t].nodes.length},e.getTotalkeyframesLength=function(t){return this._anis[t].totalKeyframeDatasLength},e.getPublicExtData=function(){return this._publicExtData},e.getAnimationDataWithCache=function(t,e,i,n){var r=e[i];if(r){var a=r[t];return a?a[n]:null}return null},e.setAnimationDataWithCache=function(t,e,i,n,r){var a=e[i]||(e[i]={});(a[t]||(a[t]=[]))[n]=r},e.getOriginalData=function(t,e,i,n,r){for(var a=this._anis[t].nodes,s=0,o=0,l=a.length,h=0;o<l;o++){var u,c=a[o];u=c.keyFrame[i[o][n]],c.dataOffset=h;var _=r-u.startTime,d=c.lerpType;if(d)switch(d){case 0:case 1:for(s=0;s<c.keyframeWidth;)s+=c.interpolationMethod[s](c,s,e,h+s,u.data,_,null,u.duration,u.nextData);break;case 2:var f=u.interpolationData,p=f.length,m=0;for(s=0;s<p;){var g=f[s];switch(g){case 6:case 7:s+=v.interpolation[g](c,m,e,h+m,u.data,_,null,u.duration,u.nextData,f,s+1);break;default:s+=v.interpolation[g](c,m,e,h+m,u.data,_,null,u.duration,u.nextData)}m++}}else for(s=0;s<c.keyframeWidth;)s+=c.interpolationMethod[s](c,s,e,h+s,u.data,_,null,u.duration,u.nextData);h+=c.keyframeWidth}},e.getNodesCurrentFrameIndex=function(t,e){var i=this._anis[t].nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(i.length),this.unfixedCurrentTimes=new Float32Array(i.length),this.unfixedLastAniIndex=t);for(var n=0,r=i.length;n<r;n++){var a=i[n];for(e<this.unfixedCurrentTimes[n]&&(this.unfixedCurrentFrameIndexes[n]=0),this.unfixedCurrentTimes[n]=e;this.unfixedCurrentFrameIndexes[n]<a.keyFrame.length&&!(a.keyFrame[this.unfixedCurrentFrameIndexes[n]].startTime>this.unfixedCurrentTimes[n]);)this.unfixedCurrentFrameIndexes[n]++;this.unfixedCurrentFrameIndexes[n]--}return this.unfixedCurrentFrameIndexes},e.getOriginalDataUnfixedRate=function(t,e,i){var n=this._anis[t].nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(n.length),this.unfixedCurrentTimes=new Float32Array(n.length),this.unfixedKeyframes=p(n.length),this.unfixedLastAniIndex=t);for(var r=0,a=0,s=n.length,o=0;a<s;a++){var l=n[a];for(i<this.unfixedCurrentTimes[a]&&(this.unfixedCurrentFrameIndexes[a]=0),this.unfixedCurrentTimes[a]=i;this.unfixedCurrentFrameIndexes[a]<l.keyFrame.length&&!(l.keyFrame[this.unfixedCurrentFrameIndexes[a]].startTime>this.unfixedCurrentTimes[a]);)this.unfixedKeyframes[a]=l.keyFrame[this.unfixedCurrentFrameIndexes[a]],this.unfixedCurrentFrameIndexes[a]++;var h=this.unfixedKeyframes[a];l.dataOffset=o;var u=i-h.startTime;if(l.lerpType)switch(l.lerpType){case 0:case 1:for(r=0;r<l.keyframeWidth;)r+=l.interpolationMethod[r](l,r,e,o+r,h.data,u,null,h.duration,h.nextData);break;case 2:var c=h.interpolationData,_=c.length,d=0;for(r=0;r<_;){var f=c[r];switch(f){case 6:case 7:r+=v.interpolation[f](l,d,e,o+d,h.data,u,null,h.duration,h.nextData,c,r+1);break;default:r+=v.interpolation[f](l,d,e,o+d,h.data,u,null,h.duration,h.nextData)}d++}}else for(r=0;r<l.keyframeWidth;)r+=l.interpolationMethod[r](l,r,e,o+r,h.data,u,null,h.duration,h.nextData);o+=l.keyframeWidth}},v._LinearInterpolation_0=function(t,e,i,n,r,a,s,o,l,h){var u=0===o?0:a/o;return i[n]=(1-u)*r[e]+u*l[e],1},v._QuaternionInterpolation_1=function(t,e,i,n,r,a,s,o,l,h){var u=0===o?0:a/o;return _.slerpQuaternionArray(r,e,l,e,u,i,n),4},v._AngleInterpolation_2=function(t,e,i,n,r,a,s,o,l,h){return 0},v._RadiansInterpolation_3=function(t,e,i,n,r,a,s,o,l,h){return 0},v._Matrix4x4Interpolation_4=function(t,e,i,n,r,a,s,o,l,h){for(var u=0;u<16;u++,e++)i[n+u]=r[e]+a*s[e];return 16},v._NoInterpolation_5=function(t,e,i,n,r,a,s,o,l,h){return i[n]=r[e],1},v._BezierInterpolation_6=function(t,e,i,n,r,a,s,o,l,h,u){return void 0===u&&(u=0),i[n]=r[e]+(l[e]-r[e])*O.getBezierRate(a/o,h[u],h[u+1],h[u+2],h[u+3]),5},v._BezierInterpolation_7=function(t,e,i,n,r,a,s,o,l,h,u){return void 0===u&&(u=0),i[n]=h[u+4]+h[u+5]*O.getBezierRate((.001*a+h[u+6])/h[u+7],h[u],h[u+1],h[u+2],h[u+3]),9},v.load=function(t){return rt.loader.create(t,null,null,v)},v.interpolation=[v._LinearInterpolation_0,v._QuaternionInterpolation_1,v._AngleInterpolation_2,v._RadiansInterpolation_3,v._Matrix4x4Interpolation_4,v._NoInterpolation_5,v._BezierInterpolation_6,v._BezierInterpolation_7],v}(),B=(function(t){function n(){this.isCached=!1,this.canvas=null,this.tex=null,this.rec=null,n.__super.call(this)}s(n,"laya.ani.bone.canvasmesh.CacheAbleSkinMesh",V);var e=n.prototype;e.getCanvasPic=function(){var t,e=new l("2D"),i=e.getContext("2d");return this.rec=this.mesh.getBounds(),e.size(this.rec.width,this.rec.height),t=this.transform,this.transform=n.tempMt,this.transform.identity(),this.transform.translate(-this.rec.x,-this.rec.y),this.renderToContext(i),this.transform.translate(+this.rec.x,+this.rec.y),this.transform=t,new Rt(e)},e.render=function(t,e,i){this.mesh.texture&&(this.isCached||(this.isCached=!0,this.tex=this.getCanvasPic()),this.transform?(this.transform.translate(e,i),this._renderTextureToContext(t),this.transform.translate(-e,-i)):(this.transform=V._tempMatrix,this.transform.identity(),this.transform.translate(e,i),this._renderTextureToContext(t),this.transform.translate(-e,-i),this.transform=null))},e._renderTextureToContext=function(t){var e;if(this.context=t.ctx||t,t.save(),e=this.tex,this.transform){var i=this.transform;t.transform(i.a,i.b,i.c,i.d,i.tx,i.ty)}this.rec=this.mesh.getBounds(),t.translate(this.rec.x,this.rec.y),t.drawTexture(e,0,0,e.width,e.height,0,0),t.restore()},i(n,["tempMt",function(){return this.tempMt=new At}])}(),function(a){function t(){this.cacheOK=!1,this.cacheCmdOK=!1,this.transformCmds=[],this.drawCmds=[],t.__super.call(this),this.tempMesh=new w}s(t,"laya.ani.bone.canvasmesh.SimpleSkinMeshCanvas",a);var e=t.prototype;return e.init2=function(t,e,i,n,r){a.prototype.init2.call(this,t,e,i,n,r),this.cacheOK=!1,this.cacheCmdOK=!1,this.transformCmds.length=6,this.drawCmds.length=9},e.renderToContext=function(t){if(this.context=t.ctx||t,this.mesh){if(this.mesh.uvs.length<=8)return void(0==this.mode?this._renderWithIndexes(this.mesh):this._renderNoIndexes(this.mesh));this.cacheOK||(this.tempMesh.texture=this.mesh.texture,this.tempMesh.uvs=this.mesh.texture.uv,this.tempMesh.vertices=D.solveMesh(this.mesh,this.tempMesh.vertices),this.cacheOK=!0),0==this.mode?this._renderWithIndexes(this.tempMesh):this._renderNoIndexes(this.tempMesh)}},e._renderWithIndexes=function(t){if(this.cacheCmdOK)this.renderByCache(t);else{var e=t.indexes,i=0,n=e.length;for(1<n&&(n=1),i=0;i<n;i+=3){var r=2*e[i],a=2*e[i+1],s=2*e[i+2];this._renderDrawTriangle(t,r,a,s)}this.cacheCmdOK=!0}},e._renderDrawTriangle=function(t,e,i,n){var r=this.context,a=t.uvs,s=t.vertices,o=t.texture,l=o.bitmap,h=l.source,u=o.width,c=o.height,_=l.width,d=l.height,f=NaN,p=NaN,m=NaN,g=NaN,v=NaN,y=NaN;if(t.useUvTransform){var x=t.uvTransform;f=(a[e]*x.a+a[e+1]*x.c+x.tx)*_,p=(a[i]*x.a+a[i+1]*x.c+x.tx)*_,m=(a[n]*x.a+a[n+1]*x.c+x.tx)*_,g=(a[e]*x.b+a[e+1]*x.d+x.ty)*d,v=(a[i]*x.b+a[i+1]*x.d+x.ty)*d,y=(a[n]*x.b+a[n+1]*x.d+x.ty)*d}else f=a[e]*_,p=a[i]*_,m=a[n]*_,g=a[e+1]*d,v=a[i+1]*d,y=a[n+1]*d;var E=s[e],T=s[i],S=s[n],w=s[e+1],M=s[i+1],D=s[n+1],I=1/(f*v+g*m+p*y-v*m-g*p-f*y),b=E*v+g*S+T*y-v*S-g*T-E*y,C=f*T+E*m+p*S-T*m-E*p-f*S,A=f*v*S+g*T*m+E*p*y-E*v*m-g*p*S-f*T*y,R=w*v+g*D+M*y-v*D-g*M-w*y,L=f*M+w*m+p*D-M*m-w*p-f*D,O=f*v*D+g*M*m+w*p*y-w*v*m-g*p*D-f*M*y;if(this.transformCmds[0]=b*I,this.transformCmds[1]=R*I,this.transformCmds[2]=C*I,this.transformCmds[3]=L*I,this.transformCmds[4]=A*I,this.transformCmds[5]=O*I,this.drawCmds[0]=h,this.drawCmds[1]=o.uv[0]*_,this.drawCmds[2]=o.uv[1]*d,this.drawCmds[3]=u,this.drawCmds[4]=c,this.drawCmds[5]=o.uv[0]*_,this.drawCmds[6]=o.uv[1]*d,this.drawCmds[7]=u,this.drawCmds[8]=c,r.save(),this.transform){var P=this.transform;r.transform(P.a,P.b,P.c,P.d,P.tx,P.ty)}r.transform.apply(r,this.transformCmds),r.drawImage.apply(r,this.drawCmds),r.restore()},e.renderByCache=function(t){var e=this.context;if(e.save(),this.transform){var i=this.transform;e.transform(i.a,i.b,i.c,i.d,i.tx,i.ty)}e.transform.apply(e,this.transformCmds),e.drawImage.apply(e,this.drawCmds),e.restore()},t}(V)),U=function(e){function i(t,e){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,i.__super.call(this),void 0===e&&(e=0),t&&this.init(t,e)}s(i,"laya.ani.bone.Skeleton",e);var t=i.prototype;return t.init=function(t,e){void 0===e&&(e=0);var i,n,r,a=0,s=0;if(1==e)for(this._graphicsCache=[],a=0,s=t.getAnimationCount();a<s;a++)this._graphicsCache.push([]);if(this._yReverseMatrix=t.yReverseMatrix,this._aniMode=e,this._templet=t,this._player=new P,this._player.cacheFrameRate=t.rate,this._player.templet=t,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=t.mBoneArr,this._rootBone=t.mRootBone,this._aniSectionDic=t.aniSectionDic,0<t.ikArr.length)for(this._ikArr=[],a=0,s=t.ikArr.length;a<s;a++)this._ikArr.push(new M(t.ikArr[a],this._boneList));if(0<t.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),a=0,s=t.pathArr.length;a<s;a++)i=t.pathArr[a],n=new I(i,this._boneList),(r=this._boneSlotDic[i.name])&&((n=new I(i,this._boneList)).target=r),this._pathDic[i.name]=n;if(0<t.tfArr.length)for(this._tfArr=[],a=0,s=t.tfArr.length;a<s;a++)this._tfArr.push(new b(t.tfArr[a],this._boneList));if(0<t.skinDataArray.length){var o=this._templet.skinDataArray[this._skinIndex];this._skinName=o.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},t.load=function(t,e,i){void 0===i&&(i=0),this._aniPath=t,this._complete=e,this._loadAniMode=i,rt.loader.load([{url:t,type:"arraybuffer"}],h.create(this,this._onLoaded))},t._onLoaded=function(){var t,e=u.getRes(this._aniPath);null!=e&&(null==k.TEMPLET_DICTIONARY&&(k.TEMPLET_DICTIONARY={}),(t=k.TEMPLET_DICTIONARY[this._aniPath])?t.isParseFail?this._parseFail():t.isParserComplete?this._parseComplete():(t.on("complete",this,this._parseComplete),t.on("error",this,this._parseFail)):((t=new k)._setUrl(this._aniPath),(k.TEMPLET_DICTIONARY[this._aniPath]=t).on("complete",this,this._parseComplete),t.on("error",this,this._parseFail),t.isParserComplete=!1,t.parseData(null,e)))},t._parseComplete=function(){var t=k.TEMPLET_DICTIONARY[this._aniPath];t&&(this.init(t,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},t._parseFail=function(){console.log("[Error]:"+this._aniPath+"解析失败")},t._onPlay=function(){this.event("played")},t._onStop=function(){var t,e=this._templet.eventAniArr[this._aniClipIndex];if(e&&this._eventIndex<e.length)for(;this._eventIndex<e.length;this._eventIndex++)(t=e[this._eventIndex]).time>=this._player.playStart&&t.time<=this._player.playEnd&&this.event("label",t);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},t._onPause=function(){this.event("paused")},t._parseSrcBoneMatrix=function(){var t=0,e=0;for(e=this._templet.srcBoneMatrixArr.length,t=0;t<e;t++)this._boneMatrixArray.push(new At);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var i,n,r=this._templet.boneSlotArray;for(t=0,e=r.length;t<e;t++)i=r[t],null==(n=this._bindBoneBoneSlotDic[i.parent])&&(this._bindBoneBoneSlotDic[i.parent]=n=[]),this._boneSlotDic[i.name]=i=i.copy(),n.push(i),this._boneSlotArray.push(i)}},t._emitMissedEvents=function(t,e,i){void 0===i&&(i=0);var n=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if(n){var r,a,s=0;for(r=n.length,s=i;s<r;s++)(a=n[s]).time>=this._player.playStart&&a.time<=this._player.playEnd&&this.event("label",a)}},t._update=function(t){if(void 0===t&&(t=!0),!(this._pause||t&&this._indexControl)){var e=this.timer.currTimer,i=this._player.currentKeyframeIndex,n=e-this._lastTime;if(t?this._player._update(n):i=-1,this._lastTime=e,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<n&&this._clipIndex==i&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var r;this._lastUpdateAniClipIndex=this._aniClipIndex,i>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var a,s=this._templet.eventAniArr[this._aniClipIndex];if(s&&this._eventIndex<s.length&&((r=s[this._eventIndex]).time>=this._player.playStart&&r.time<=this._player.playEnd?this._player.currentPlayTime>=r.time&&(this.event("label",r),this._eventIndex++):this._eventIndex++),0==this._aniMode){if(a=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=a&&(this.graphics=a));var o=0,l=0;for(l=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,l-1)&&0<l;)l--;if(l<this._clipIndex)for(o=l;o<this._clipIndex;o++)this._createGraphics(o)}else if(1==this._aniMode){if(a=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=a&&(this.graphics=a));for(l=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,l-1)&&0<l;)l--;if(l<this._clipIndex)for(o=l;o<this._clipIndex;o++)this._createGraphics(o)}this._createGraphics()}}},t._createGraphics=function(t){void 0===t&&(t=-1),-1==t&&(t=this._clipIndex);var e,i,n=t*this._player.cacheFrameRateInterval,r=this._templet.drawOrderAniArr[this._aniClipIndex];if(r&&0<r.length)for(this._drawOrderIndex=0,e=r[this._drawOrderIndex];n>=e.time&&(this._drawOrder=e.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=r.length));)e=r[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=new N:this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=new N,i=this.graphics;var a=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],t,n);var s,o,l,h,u=this._aniSectionDic[this._aniClipIndex],c=0,_=0,d=0,f=0,p=0,m=this._templet.srcBoneMatrixArr.length;for(p=u[_=0];_<m;_++)h=this._boneList[_],l=this._templet.srcBoneMatrixArr[_],h.resultTransform.scX=l.scX*this._curOriginalData[c++],h.resultTransform.skX=l.skX+this._curOriginalData[c++],h.resultTransform.skY=l.skY+this._curOriginalData[c++],h.resultTransform.scY=l.scY*this._curOriginalData[c++],h.resultTransform.x=l.x+this._curOriginalData[c++],h.resultTransform.y=l.y+this._curOriginalData[c++],8===this._templet.tMatrixDataLen&&(h.resultTransform.skewX=l.skewX+this._curOriginalData[c++],h.resultTransform.skewY=l.skewY+this._curOriginalData[c++]);var g,v={},y={};for(p+=u[1];_<p;_++)v[(g=a[_]).name]=this._curOriginalData[c++],y[g.name]=this._curOriginalData[c++],this._curOriginalData[c++],this._curOriginalData[c++],this._curOriginalData[c++],this._curOriginalData[c++];var x,E,T={},S={};for(p+=u[2];_<p;_++)T[(g=a[_]).name]=this._curOriginalData[c++],S[g.name]=this._curOriginalData[c++],this._curOriginalData[c++],this._curOriginalData[c++],this._curOriginalData[c++],this._curOriginalData[c++];if(this._pathDic)for(p+=u[3];_<p;_++){if(g=a[_],x=this._pathDic[g.name])switch(new Ct(g.extenData).getByte()){case 1:x.position=this._curOriginalData[c++];break;case 2:x.spacing=this._curOriginalData[c++];break;case 3:x.rotateMix=this._curOriginalData[c++],x.translateMix=this._curOriginalData[c++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update(At.TEMP.identity()),this._ikArr)for(_=0,p=this._ikArr.length;_<p;_++)E=this._ikArr[_],T.hasOwnProperty(E.name)&&(E.bendDirection=T[E.name]),S.hasOwnProperty(E.name)&&(E.mix=S[E.name]),E.apply();if(this._pathDic)for(var w in this._pathDic)(x=this._pathDic[w]).apply(this._boneList,i);if(this._tfArr)for(_=0,f=this._tfArr.length;_<f;_++)this._tfArr[_].apply();for(_=0,f=this._boneList.length;_<f;_++)if(h=this._boneList[_],o=this._bindBoneBoneSlotDic[h.name],h.resultMatrix.copyTo(this._boneMatrixArray[_]),o)for(d=0,p=o.length;d<p;d++)(s=o[d])&&s.setParentMatrix(h.resultMatrix);var M,D,I,b,C={},A=this._templet.deformAniArr;if(A&&0<A.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,_=0,p=this._boneSlotArray.length;_<p;_++)(s=this._boneSlotArray[_]).deformData=null;var R,L=A[this._aniClipIndex];for(R in M=L.default,this._setDeform(M,C,this._boneSlotArray,n),L)"default"!=R&&R!=this._skinName&&(M=L[R],this._setDeform(M,C,this._boneSlotArray,n));M=L[this._skinName],this._setDeform(M,C,this._boneSlotArray,n)}if(this._drawOrder)for(_=0,p=this._drawOrder.length;_<p;_++)D=v[(s=this._boneSlotArray[this._drawOrder[_]]).name],I=y[s.name],isNaN(I)||(i.save(),i.alpha(I)),isNaN(D)||-2==D||(this._templet.attachmentNames?s.showDisplayByName(this._templet.attachmentNames[D]):s.showDisplayByIndex(D)),C[this._drawOrder[_]]?(b=C[this._drawOrder[_]],s.currDisplayData&&b[s.currDisplayData.attachmentName]?s.deformData=b[s.currDisplayData.attachmentName]:s.deformData=null):s.deformData=null,isNaN(I)?s.draw(i,this._boneMatrixArray,2==this._aniMode):s.draw(i,this._boneMatrixArray,2==this._aniMode,I),isNaN(I)||i.restore();else for(_=0,p=this._boneSlotArray.length;_<p;_++)D=v[(s=this._boneSlotArray[_]).name],I=y[s.name],isNaN(I)||(i.save(),i.alpha(I)),isNaN(D)||-2==D||(this._templet.attachmentNames?s.showDisplayByName(this._templet.attachmentNames[D]):s.showDisplayByIndex(D)),C[_]?(b=C[_],s.currDisplayData&&b[s.currDisplayData.attachmentName]?s.deformData=b[s.currDisplayData.attachmentName]:s.deformData=null):s.deformData=null,isNaN(I)?s.draw(i,this._boneMatrixArray,2==this._aniMode):s.draw(i,this._boneMatrixArray,2==this._aniMode,I),isNaN(I)||i.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,t,i):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,t,i)},t._setDeform=function(t,e,i,n){if(t){var r,a,s,o=0,l=0,h=0;if(t)for(o=0,l=t.deformSlotDataList.length;o<l;o++)for(r=t.deformSlotDataList[o],h=0;h<r.deformSlotDisplayList.length;h++)s=i[(a=r.deformSlotDisplayList[h]).slotIndex],a.apply(n,s),e[a.slotIndex]||(e[a.slotIndex]={}),e[a.slotIndex][a.attachment]=a.deformData}},t.getAnimNum=function(){return this._templet.getAnimationCount()},t.getAniNameByIndex=function(t){return this._templet.getAniNameByIndex(t)},t.getSlotByName=function(t){return this._boneSlotDic[t]},t.showSkinByName=function(t,e){void 0===e&&(e=!0),this.showSkinByIndex(this._templet.getSkinIndexByName(t),e)},t.showSkinByIndex=function(t,e){void 0===e&&(e=!0);for(var i=0;i<this._boneSlotArray.length;i++)this._boneSlotArray[i].showSlotData(null,e);if(this._templet.showSkinByIndex(this._boneSlotDic,t,e)){var n=this._templet.skinDataArray[t];this._skinIndex=t,this._skinName=n.name}this._clearCache()},t.showSlotSkinByIndex=function(t,e){if(0!=this._aniMode){var i=this.getSlotByName(t);i&&i.showDisplayByIndex(e),this._clearCache()}},t.showSlotSkinByName=function(t,e){if(0!=this._aniMode){var i=this.getSlotByName(t);i&&i.showDisplayByName(e),this._clearCache()}},t.replaceSlotSkinName=function(t,e,i){if(0!=this._aniMode){var n=this.getSlotByName(t);n&&n.replaceDisplayByName(e,i),this._clearCache()}},t.replaceSlotSkinByIndex=function(t,e,i){if(0!=this._aniMode){var n=this.getSlotByName(t);n&&n.replaceDisplayByIndex(e,i),this._clearCache()}},t.setSlotSkin=function(t,e){if(0!=this._aniMode){var i=this.getSlotByName(t);i&&i.replaceSkin(e),this._clearCache()}},t._clearCache=function(){if(1==this._aniMode)for(var t=0,e=this._graphicsCache.length;t<e;t++)this._graphicsCache[t].length=0},t.play=function(t,e,i,n,r,a){void 0===i&&(i=!0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=!0),this._indexControl=!1;var s=-1,o=NaN;if(o=e?2147483647:0,"string"==typeof t)for(var l=0,h=this._templet.getAnimationCount();l<h;l++){var u=this._templet.getAnimation(l);if(u&&t==u.name){s=l;break}}else s=t;-1<s&&s<this.getAnimNum()&&(this._aniClipIndex=s,(i||this._pause||this._currAniIndex!=s)&&(this._currAniIndex=s,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(s)),this._drawOrder=null,this._eventIndex=0,this._player.play(s,this._player.playbackRate,o,n,r),a&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=c.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},t.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},t.playbackRate=function(t){this._player&&(this._player.playbackRate=t)},t.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},t.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=c.now(),this.timer.frameLoop(1,this,this._update,null,!0))},t._getGrahicsDataWithCache=function(t,e){return this._graphicsCache[t][e]},t._setGrahicsDataWithCache=function(t,e,i){this._graphicsCache[t][e]=i},t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},n(0,t,"url",function(){return this._aniPath},function(t){this.load(t)}),n(0,t,"index",function(){return this._index},function(t){this.player&&(this._index=t,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),n(0,t,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),n(0,t,"templet",function(){return this._templet}),n(0,t,"player",function(){return this._player}),i.useSimpleMeshInCanvas=!1,i}(at),k=(function(e){function p(t){this._start=0,this._Pos=0,this._data=null,this._curIndex=0,this._preIndex=0,this._playIndex=0,this._playing=!1,this._ended=!0,this._count=0,this._ids=null,this._loadedImage={},this._idOfSprite=null,this._parentMovieClip=null,this._movieClipList=null,this._labels=null,this.basePath=null,this._atlasPath=null,this._url=null,this._isRoot=!1,this._completeHandler=null,this._endFrame=-1,this.interval=30,this.loop=!1,p.__super.call(this),this._ids={},this._idOfSprite=[],this._reset(),this._playing=!1,(this._parentMovieClip=t)?(this._isRoot=!1,this._movieClipList=t._movieClipList,this._movieClipList.push(this)):(this._movieClipList=[this],this._isRoot=!0,this._setUpNoticeType(1))}s(p,"laya.ani.swf.MovieClip",e);var t=p.prototype;t.destroy=function(t){void 0===t&&(t=!0),this._clear(),e.prototype.destroy.call(this,t)},t._setDisplay=function(t){e.prototype._setDisplay.call(this,t),this._isRoot&&this._$3__onDisplay(t)},t._$3__onDisplay=function(t){t?this.timer.loop(this.interval,this,this.updates,null,!0):this.timer.clear(this,this.updates)},t.updates=function(){if(!this._parentMovieClip){var t,e=0;for(t=this._movieClipList.length,e=0;e<t;e++)this._movieClipList[e]&&this._movieClipList[e]._update()}},t.addLabel=function(t,e){this._labels||(this._labels={}),this._labels[e]=t},t.removeLabel=function(t){if(t){if(!this._labels)for(var e in this._labels)if(this._labels[e]===t){delete this._labels[e];break}}else this._labels=null},t._update=function(){if(this._data&&this._playing){if(this._playIndex++,this._playIndex>=this._count){if(!this.loop)return this._playIndex--,void this.stop();this._playIndex=0}if(this._parse(this._playIndex),this._labels&&this._labels[this._playIndex]&&this.event("label",this._labels[this._playIndex]),-1!=this._endFrame&&this._endFrame==this._playIndex){if(this._endFrame=-1,null!=this._completeHandler){var t=this._completeHandler;this._completeHandler=null,t.run()}this.stop()}}},t.stop=function(){this._playing=!1},t.gotoAndStop=function(t){this.index=t,this.stop()},t._clear=function(){if(this.stop(),this._idOfSprite.length=0,!this._parentMovieClip){this.timer.clear(this,this.updates);var t,e=0;for(t=this._movieClipList.length,e=0;e<t;e++)this._movieClipList[e]!=this&&this._movieClipList[e]._clear();this._movieClipList.length=0}var i;for(i in this._atlasPath&&u.clearRes(this._atlasPath),this._loadedImage)this._loadedImage[i]&&(u.clearRes(i),this._loadedImage[i]=!1);this.removeChildren(),this.graphics=null,this._parentMovieClip=null},t.play=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!0),this.loop=e,this._playing=!0,this._data&&this._displayFrame(t)},t._displayFrame=function(t){void 0===t&&(t=-1),-1!=t&&(this._curIndex>t&&this._reset(),this._parse(t))},t._reset=function(t){void 0===t&&(t=!0),t&&1!=this._curIndex&&this.removeChildren(),this._preIndex=this._curIndex=-1,this._Pos=this._start},t._parse=function(t){var e,i,n,r=0,a=0,s=0,o=!1,l=this._idOfSprite,h=this._data;for(this._ended&&this._reset(),h.pos=this._Pos,this._ended=!1,this._playIndex=t,this._curIndex>t&&t<this._preIndex&&(this._reset(!0),h.pos=this._Pos);this._curIndex<=t&&!this._ended;)switch(h.getUint16()){case 12:if(r=h.getUint16(),a=this._ids[h.getUint16()],this._Pos=h.pos,h.pos=a,0==(s=h.getUint8())){var u=h.getUint16();if(!(i=l[r])){i=l[r]=new at;var c=new at;c.loadImage(this.basePath+u+".png"),this._loadedImage[this.basePath+u+".png"]=!0,i.addChild(c),c.size(h.getFloat32(),h.getFloat32());var _=h._getMatrix();c.transform=_}i.alpha=1}else 1==s&&((e=l[r])||(l[r]=e=new p(this),e.interval=this.interval,e._ids=this._ids,e.basePath=this.basePath,e._setData(h,a),e._initState(),e.play(0)),e.alpha=1);h.pos=this._Pos;break;case 3:var d=l[h.getUint16()];d&&(this.addChild(d),d.zOrder=h.getUint16(),o=!0);break;case 4:(d=l[h.getUint16()])&&d.removeSelf();break;case 5:l[h.getUint16()][p._ValueList[h.getUint16()]]=h.getFloat32();break;case 6:l[h.getUint16()].visible=0<h.getUint8();break;case 7:var f=(i=l[h.getUint16()]).transform||At.create();f.setTo(h.getFloat32(),h.getFloat32(),h.getFloat32(),h.getFloat32(),h.getFloat32(),h.getFloat32()),i.transform=f;break;case 8:l[h.getUint16()].setPos(h.getFloat32(),h.getFloat32());break;case 9:l[h.getUint16()].setSize(h.getFloat32(),h.getFloat32());break;case 10:l[h.getUint16()].alpha=h.getFloat32();break;case 11:l[h.getUint16()].setScale(h.getFloat32(),h.getFloat32());break;case 98:n=h.getString(),this.event(n),"stop"==n&&this.stop();break;case 99:this._curIndex=h.getUint16(),o&&this.updateZOrder();break;case 100:this._count=this._curIndex+1,this._ended=!0,this._playing&&(this.event("enterframe"),this.event("end"),this.event("complete")),this._reset(!1)}this._playing&&!this._ended&&this.event("enterframe"),this._Pos=h.pos},t._setData=function(t,e){this._data=t,this._start=e+3},t.load=function(t,e,i){var n;void 0===e&&(e=!1),this._url=t=y.formatURL(t),e&&(this._atlasPath=i||t.split(".swf")[0]+".json"),this.stop(),this._clear(),this._movieClipList=[this],n=[{url:t,type:"arraybuffer"}],this._atlasPath&&n.push({url:this._atlasPath,type:"atlas"}),rt.loader.load(n,h.create(this,this._onLoaded))},t._onLoaded=function(){var t;(t=u.getRes(this._url))?(this.basePath=this._atlasPath?u.getAtlas(this._atlasPath).dir:this._url.split(".swf")[0]+"/image/",this._initData(t)):this.event("error","file not find")},t._initState=function(){this._reset(),this._ended=!1;var t=this._playing;for(this._playing=!1,this._curIndex=0;!this._ended;)this._parse(++this._curIndex);this._playing=t},t._initData=function(t){this._data=new Ct(t);var e=0,i=this._data.getUint16();for(e=0;e<i;e++)this._ids[this._data.getInt16()]=this._data.getInt32();this.interval=1e3/this._data.getUint16(),this._setData(this._data,this._ids[32767]),this._initState(),this.play(0),this.event("loaded"),this._parentMovieClip||this.timer.loop(this.interval,this,this.updates,null,!0)},t.playTo=function(t,e,i){this._completeHandler=i,this._endFrame=e,this.play(t,!1)},n(0,t,"index",function(){return this._playIndex},function(t){this._playIndex=t,this._data&&this._displayFrame(this._playIndex),this._labels&&this._labels[t]&&this.event("label",this._labels[t])}),n(0,t,"count",function(){return this._count}),n(0,t,"playing",function(){return this._playing}),n(0,t,"url",null,function(t){this.load(t)}),p._ValueList=["x","y","width","height","scaleX","scaleY","rotation","alpha"]}(at),function(e){function r(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,r.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}s(r,"laya.ani.bone.Templet",e);var t=r.prototype;return t.loadAni=function(t){this._skBufferUrl=t,rt.loader.load(t,h.create(this,this.onComplete),null,"arraybuffer")},t.onComplete=function(t){if(this._isDestroyed)this.destroy();else{var e=u.getRes(this._skBufferUrl);e?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,e)):this.event("error","load failed:"+this._skBufferUrl)}},t.parseData=function(t,e,i){void 0===i&&(i=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=t,this._mainTexture&&m.isWebGL&&t.bitmap&&(t.bitmap.enableMerageInAtlas=!1),this._rate=i,this.parse(e)},t.buildArmature=function(t){return void 0===t&&(t=0),new U(this,t)},t.parse=function(t){e.prototype.parse.call(this,t),this._endLoaded(),this._aniVersion!=r.LAYA_ANIMATION_VISION&&(console.log("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+r.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},t._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var t=0;this._loadList=[];var e,i=new Ct(this.getPublicExtData()),n=0,r=0,a=0,s=i.getInt32(),o=i.readUTFString(),l=o.split("\n");for(t=0;t<s;t++)e=this._path+l[2*t],o=l[2*t+1],i.getFloat32(),i.getFloat32(),n=i.getFloat32(),r=i.getFloat32(),a=i.getFloat32(),isNaN(a)?0:a,a=i.getFloat32(),isNaN(a)?0:a,a=i.getFloat32(),isNaN(a)?n:a,a=i.getFloat32(),isNaN(a)?r:a,-1==this._loadList.indexOf(e)&&this._loadList.push(e);rt.loader.load(this._loadList,h.create(this,this._textureComplete))}},t._textureComplete=function(){for(var t,e,i=0,n=this._loadList.length;i<n;i++)e=this._loadList[i],t=this._textureDic[e]=u.getRes(e),m.isWebGL&&t&&t.bitmap&&(t.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},t._parsePublicExtData=function(){var t=0,e=0,i=0,n=0,r=0;for(t=0,r=this.getAnimationCount();t<r;t++)this._graphicsCache.push([]);var a;a="Dragon"!=this._aniClassName;var s,o,l=new Ct(this.getPublicExtData()),h=0,u=0,c=0,_=0,d=0,f=0,p=0,m=0,g=0,v=l.getInt32(),y=l.readUTFString(),x=y.split("\n");for(t=0;t<v;t++){if(s=this._mainTexture,o=this._path+x[2*t],y=x[2*t+1],null==this._mainTexture&&(s=this._textureDic[o]),!s)return this.event("error",this),void(this.isParseFail=!0);h=l.getFloat32(),u=l.getFloat32(),c=l.getFloat32(),_=l.getFloat32(),g=l.getFloat32(),d=isNaN(g)?0:g,g=l.getFloat32(),f=isNaN(g)?0:g,g=l.getFloat32(),p=isNaN(g)?c:g,g=l.getFloat32(),m=isNaN(g)?_:g,this.subTextureDic[y]=Rt.create(s,h,u,c,_,-d,-f,p,m)}this._mainTexture=s;var E,T,S,w,M,D=l.getUint16();for(t=0;t<D;t++)(E=[]).push(l.getUint16()),E.push(l.getUint16()),E.push(l.getUint16()),E.push(l.getUint16()),this.aniSectionDic[t]=E;var I,b=l.getInt16(),C={};for(t=0;t<b;t++)T=new Lt,0==t?I=T:T.root=I,T.d=a?-1:1,w=l.readUTFString(),M=l.readUTFString(),T.length=l.getFloat32(),1==l.getByte()&&(T.inheritRotation=!1),1==l.getByte()&&(T.inheritScale=!1),T.name=w,M&&((S=C[M])?S.addChild(T):this.mRootBone=T),C[w]=T,this.mBoneArr.push(T);this.tMatrixDataLen=l.getUint16();var A,R,L=l.getUint16(),O=Math.floor(L/this.tMatrixDataLen),P=this.srcBoneMatrixArr;for(t=0;t<O;t++)(A=new Xt).scX=l.getFloat32(),A.skX=l.getFloat32(),A.skY=l.getFloat32(),A.scY=l.getFloat32(),A.x=l.getFloat32(),A.y=l.getFloat32(),8===this.tMatrixDataLen&&(A.skewX=l.getFloat32(),A.skewY=l.getFloat32()),P.push(A),(T=this.mBoneArr[t]).transform=A;var N,V=l.getUint16(),F=0;for(t=0;t<V;t++){for(R=new Ut,F=l.getUint16(),e=0;e<F;e++)R.boneNames.push(l.readUTFString()),R.boneIndexs.push(l.getInt16());R.name=l.readUTFString(),R.targetBoneName=l.readUTFString(),R.targetBoneIndex=l.getInt16(),R.bendDirection=l.getFloat32(),R.mix=l.getFloat32(),R.isSpine=a,this.ikArr.push(R)}var B,U=l.getUint16(),k=0;for(t=0;t<U;t++){for(N=new Wt,k=l.getUint16(),e=0;e<k;e++)N.boneIndexs.push(l.getInt16());N.name=l.getUTFString(),N.targetIndex=l.getInt16(),N.rotateMix=l.getFloat32(),N.translateMix=l.getFloat32(),N.scaleMix=l.getFloat32(),N.shearMix=l.getFloat32(),N.offsetRotation=l.getFloat32(),N.offsetX=l.getFloat32(),N.offsetY=l.getFloat32(),N.offsetScaleX=l.getFloat32(),N.offsetScaleY=l.getFloat32(),N.offsetShearY=l.getFloat32(),this.tfArr.push(N)}var H=l.getUint16(),z=0;for(t=0;t<H;t++){for((B=new kt).name=l.readUTFString(),z=l.getUint16(),e=0;e<z;e++)B.bones.push(l.getInt16());B.target=l.readUTFString(),B.positionMode=l.readUTFString(),B.spacingMode=l.readUTFString(),B.rotateMode=l.readUTFString(),B.offsetRotation=l.getFloat32(),B.position=l.getFloat32(),B.spacing=l.getFloat32(),B.rotateMix=l.getFloat32(),B.translateMix=l.getFloat32(),this.pathArr.push(B)}var G,W,X,Y,j,Z=0,K=0,q=0,Q=NaN,J=0,$=l.getInt16();for(t=0;t<$;t++){var tt=l.getUint8(),et={};this.deformAniArr.push(et);for(var it=0;it<tt;it++)for((G=new Pt).skinName=l.getUTFString(),et[G.skinName]=G,Z=l.getInt16(),e=0;e<Z;e++)for(W=new Nt,G.deformSlotDataList.push(W),K=l.getInt16(),i=0;i<K;i++)for(X=new Vt,W.deformSlotDisplayList.push(X),X.slotIndex=l.getInt16(),X.attachment=l.getUTFString(),q=l.getInt16(),n=0;n<q;n++)for(1==l.getByte()?X.tweenKeyList.push(!0):X.tweenKeyList.push(!1),Q=l.getFloat32(),X.timeList.push(Q),Y=[],X.vectices.push(Y),J=l.getInt16(),r=0;r<J;r++)Y.push(l.getFloat32())}var nt,rt,at=l.getInt16(),st=0,ot=0;for(t=0;t<at;t++){for(st=l.getInt16(),j=[],e=0;e<st;e++){for((nt=new Ft).time=l.getFloat32(),ot=l.getInt16(),i=0;i<ot;i++)nt.drawOrder.push(l.getInt16());j.push(nt)}this.drawOrderAniArr.push(j)}var lt,ht=l.getInt16(),ut=0;for(t=0;t<ht;t++){for(ut=l.getInt16(),rt=[],e=0;e<ut;e++)(lt=new Bt).name=l.getUTFString(),lt.intValue=l.getInt32(),lt.floatValue=l.getFloat32(),lt.stringValue=l.getUTFString(),lt.time=l.getFloat32(),rt.push(lt);this.eventAniArr.push(rt)}var ct=l.getInt16();if(0<ct)for(this.attachmentNames=[],t=0;t<ct;t++)this.attachmentNames.push(l.getUTFString());var _t,dt,ft=l.getInt16();for(t=0;t<ft;t++)(_t=new Ot).name=l.readUTFString(),_t.parent=l.readUTFString(),_t.attachmentName=l.readUTFString(),_t.srcDisplayIndex=_t.displayIndex=l.getInt16(),(_t.templet=this).boneSlotDic[_t.name]=_t,null==(dt=this.bindBoneBoneSlotDic[_t.parent])&&(this.bindBoneBoneSlotDic[_t.parent]=dt=[]),dt.push(_t),this.boneSlotArray.push(_t);var pt,mt,gt,vt=l.readUTFString().split("\n"),yt=0,xt=l.getUint8(),Et=0,Tt=0,St=0,wt=0,Mt=0,Dt=0,It=0;for(t=0;t<xt;t++){for((pt=new Ht).name=vt[yt++],Et=l.getUint8(),e=0;e<Et;e++){for((mt=new Gt).name=vt[yt++],_t=this.boneSlotDic[mt.name],Tt=l.getUint8(),i=0;i<Tt;i++){if(gt=new zt,this.skinSlotDisplayDataArr.push(gt),gt.name=vt[yt++],gt.attachmentName=vt[yt++],gt.transform=new Xt,gt.transform.scX=l.getFloat32(),gt.transform.skX=l.getFloat32(),gt.transform.skY=l.getFloat32(),gt.transform.scY=l.getFloat32(),gt.transform.x=l.getFloat32(),gt.transform.y=l.getFloat32(),mt.displayArr.push(gt),gt.width=l.getFloat32(),gt.height=l.getFloat32(),gt.type=l.getUint8(),gt.verLen=l.getUint16(),0<(b=l.getUint16()))for(gt.bones=[],n=0;n<b;n++){var bt=l.getUint16();gt.bones.push(bt)}if(0<(St=l.getUint16()))for(gt.uvs=[],n=0;n<St;n++)gt.uvs.push(l.getFloat32());if(0<(wt=l.getUint16()))for(gt.weights=[],n=0;n<wt;n++)gt.weights.push(l.getFloat32());if(0<(Mt=l.getUint16()))for(gt.triangles=[],n=0;n<Mt;n++)gt.triangles.push(l.getUint16());if(0<(Dt=l.getUint16()))for(gt.vertices=[],n=0;n<Dt;n++)gt.vertices.push(l.getFloat32());if(0<(It=l.getUint16()))for(gt.lengths=[],n=0;n<It;n++)gt.lengths.push(l.getFloat32())}pt.slotArr.push(mt)}this.skinDic[pt.name]=pt,this.skinDataArray.push(pt)}1==l.getUint8()?(this.yReverseMatrix=new At(1,0,0,-1,0,0),I&&I.setTempMatrix(this.yReverseMatrix)):I&&I.setTempMatrix(new At),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},t.getTexture=function(t){var e=this.subTextureDic[t];return null==e?this._mainTexture:e},t.showSkinByIndex=function(t,e,i){if(void 0===i&&(i=!0),e<0&&e>=this.skinDataArray.length)return!1;var n,r,a=0,s=0,o=this.skinDataArray[e];if(o){for(a=0,s=o.slotArr.length;a<s;a++)(r=o.slotArr[a])&&(n=t[r.name])&&(n.showSlotData(r,i),i&&"undefined"!=n.attachmentName&&"null"!=n.attachmentName?n.showDisplayByName(n.attachmentName):n.showDisplayByIndex(n.displayIndex));return!0}return!1},t.getSkinIndexByName=function(t){for(var e=0,i=this.skinDataArray.length;e<i;e++)if(this.skinDataArray[e].name==t)return e;return-1},t.getGrahicsDataWithCache=function(t,e){return this._graphicsCache[t][e]},t.setGrahicsDataWithCache=function(t,e,i){this._graphicsCache[t][e]=i},t.destroy=function(){var t;for(var e in this._isDestroyed=!0,this.subTextureDic)(t=this.subTextureDic[e])&&t.destroy();for(e in this._textureDic)(t=this._textureDic[e])&&t.destroy();for(var i=0,n=this.skinSlotDisplayDataArr.length;i<n;i++)this.skinSlotDisplayDataArr[i].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete r.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},t.getAniNameByIndex=function(t){var e=this.getAnimation(t);return e?e.name:null},n(0,t,"rate",function(){return this._rate},function(t){this._rate=t}),r.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",r.TEMPLET_DICTIONARY=null,r}(F))}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}),function(t,e,n){n.un,n.uns,n.static;var a=n.class,s=n.getset,o=(n.__newvec,laya.utils.Browser,laya.utils.Color),i=laya.filters.ColorFilterAction,r=laya.filters.webgl.ColorFilterActionGL,l=laya.filters.Filter,h=laya.filters.webgl.FilterActionGL,u=laya.maths.Matrix,c=(laya.maths.Rectangle,laya.renders.Render),_=(laya.renders.RenderContext,laya.webgl.resource.RenderTarget2D),d=laya.utils.RunDriver,f=(laya.webgl.shader.d2.ShaderDefines2D,laya.display.Sprite,laya.resource.Texture,laya.webgl.shader.d2.value.Value2D),p=function(){function t(){this.data=null}a(t,"laya.filters.FilterAction");var e=t.prototype;return n.imps(e,{"laya.filters.IFilterAction":!0}),e.apply=function(t){return null},t}(),m=function(){function t(){}return a(t,"laya.filters.WebGLFilter"),t.enable=function(){t.isInit||(t.isInit=!0,c.isWebGL&&(d.createFilterAction=function(t){var e;switch(t){case 32:e=new r;break;case 16:e=new g;break;case 8:e=new v}return e}))},t.isInit=!1,t.__init$=function(){d.createFilterAction=function(t){var e;switch(t){case 16:case 8:e=new p;break;case 32:e=new i}return e}},t}(),g=(function(t){function e(t){this.strength=NaN,this.strength_sig2_2sig2_gauss1=[],e.__super.call(this),void 0===t&&(t=4),c.isWebGL&&m.enable(),this.strength=t,this._action=d.createFilterAction(16),this._action.data=this}a(e,"laya.filters.BlurFilter",l);var i=e.prototype;i.callNative=function(t){t.conchModel&&t.conchModel.blurFilter&&t.conchModel.blurFilter(this.strength)},s(0,i,"action",function(){return this._action}),s(0,i,"type",function(){return 16})}(),function(t){function r(t,e,i,n){this._color=null,r.__super.call(this),this._elements=new Float32Array(9),void 0===e&&(e=4),void 0===i&&(i=6),void 0===n&&(n=6),c.isWebGL&&m.enable(),this._color=new o(t),this.blur=Math.min(e,20),this.offX=i,this.offY=n,this._action=d.createFilterAction(8),this._action.data=this}a(r,"laya.filters.GlowFilter",l);var e=r.prototype;e.getColor=function(){return this._color._color},e.callNative=function(t){t.conchModel&&t.conchModel.glowFilter&&t.conchModel.glowFilter(this._color.strColor,this._elements[4],this._elements[5],this._elements[6])},s(0,e,"type",function(){return 8}),s(0,e,"action",function(){return this._action}),s(0,e,"offY",function(){return this._elements[6]},function(t){this._elements[6]=t}),s(0,e,"offX",function(){return this._elements[5]},function(t){this._elements[5]=t}),s(0,e,"blur",function(){return this._elements[4]},function(t){this._elements[4]=t})}(),function(t){function e(){this.data=null,e.__super.call(this)}a(e,"laya.filters.webgl.BlurFilterActionGL",h);var i=e.prototype;return i.setValueMix=function(t){t.defines.add(this.data.type)},i.apply3d=function(t,e,i,n,r){var a=t.getValue("bounds"),s=f.create(1,0);s.setFilters([this.data]),u.EMPTY.identity(),i.ctx.drawTarget(t,0,0,a.width,a.height,u.EMPTY,"src",s),s.setFilters(null)},i.setValue=function(t){t.strength=this.data.strength;var e=this.data.strength/3,i=e*e;this.data.strength_sig2_2sig2_gauss1[0]=this.data.strength,this.data.strength_sig2_2sig2_gauss1[1]=i,this.data.strength_sig2_2sig2_gauss1[2]=2*i,this.data.strength_sig2_2sig2_gauss1[3]=1/(2*Math.PI*i),t.strength_sig2_2sig2_gauss1=this.data.strength_sig2_2sig2_gauss1},s(0,i,"typeMix",function(){return 16}),e}()),v=function(t){function e(){this.data=null,this._initKey=!1,this._textureWidth=0,this._textureHeight=0,e.__super.call(this)}a(e,"laya.filters.webgl.GlowFilterActionGL",h);var i=e.prototype;return n.imps(i,{"laya.filters.IFilterActionGL":!0}),i.setValueMix=function(t){},i.apply3d=function(t,e,i,n,r){var a=t.getValue("bounds");t.addValue("color",this.data.getColor());var s,o=a.width,l=a.height;this._textureWidth=o,this._textureHeight=l;var h=u.TEMP;return h.identity(),(s=f.create(1,0)).setFilters([this.data]),i.ctx.drawTarget(t,0,0,this._textureWidth,this._textureHeight,h,"src",s,null),s=f.create(1,0),i.ctx.drawTarget(t,0,0,this._textureWidth,this._textureHeight,h,"src",s),null},i.setSpriteWH=function(t){this._textureWidth=t.width,this._textureHeight=t.height},i.setValue=function(t){t.u_offsetX=this.data.offX,t.u_offsetY=-this.data.offY,t.u_strength=1,t.u_blurX=this.data.blur,t.u_blurY=this.data.blur,t.u_textW=this._textureWidth,t.u_textH=this._textureHeight,t.u_color=this.data.getColor()},s(0,i,"typeMix",function(){return 8}),e.tmpTarget=function(t,e,i,n,r){var a=t.getValue("bounds");t.getValue("out").end();var s=_.create(a.width,a.height);s.start();var o=t.getValue("color");o&&s.clear(o[0],o[1],o[2],0),t.addValue("tmpTarget",s)},e.startOut=function(t,e,i,n,r){t.getValue("tmpTarget").end();var a=t.getValue("out");a.start();var s=t.getValue("color");s&&a.clear(s[0],s[1],s[2],0)},e.recycleTarget=function(t,e,i,n,r){t.getValue("src");t.getValue("tmpTarget").recycle()},e}();n.__init([m])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}),function(window,document,Laya){var __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec,Browser=laya.utils.Browser,CSSStyle=laya.display.css.CSSStyle,ClassUtils=laya.utils.ClassUtils,Event=laya.events.Event,HTMLChar=laya.utils.HTMLChar,Loader=laya.net.Loader,Node=laya.display.Node,Rectangle=laya.maths.Rectangle,Render=laya.renders.Render,RenderContext=laya.renders.RenderContext,RenderSprite=laya.renders.RenderSprite,Sprite=laya.display.Sprite,Stat=laya.utils.Stat,Text=laya.display.Text,Texture=laya.resource.Texture,URL=laya.net.URL,Utils=laya.utils.Utils,HTMLParse=function(){function d(){}return __class(d,"laya.html.utils.HTMLParse"),d.parse=function(t,e,i){e=(e="<root>"+(e=e.replace(/<br>/g,"<br/>"))+"</root>").replace(d.spacePattern,d.char255);var n=Utils.parseXMLFromString(e);d._parseXML(t,n.childNodes[0].childNodes,i)},d._parseXML=function(t,e,i,n){var r=0,a=0;if(e.join||e.item)for(r=0,a=e.length;r<a;++r)d._parseXML(t,e[r],i,n);else{var s,o,l;if(3==e.nodeType)return void(t instanceof laya.html.dom.HTMLDivElement?(null==e.nodeName&&(e.nodeName="#text"),o=e.nodeName.toLowerCase(),0<(l=e.textContent.replace(/^\s+|\s+$/g,"")).length&&(s=ClassUtils.getInstance(o))&&(t.addChild(s),s.innerTEXT=l.replace(d.char255AndOneSpacePattern," "))):0<(l=e.textContent.replace(/^\s+|\s+$/g,"")).length&&(t.innerTEXT=l.replace(d.char255AndOneSpacePattern," ")));if("#comment"==(o=e.nodeName.toLowerCase()))return;if(s=ClassUtils.getInstance(o)){(s=t.addChild(s)).URI=i,s.href=n;var h=e.attributes;if(h&&0<h.length)for(r=0,a=h.length;r<a;++r){var u=h[r],c=u.nodeName,_=u.value;s._setAttributes(c,_)}d._parseXML(s,e.childNodes,i,s.href)}else d._parseXML(t,e.childNodes,i,n)}},d.char255=String.fromCharCode(255),d.spacePattern=/&nbsp;|&#160;/g,d.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),d}(),Layout=function(){function P(){}return __class(P,"laya.html.utils.Layout"),P.later=function(t){null==P._will&&(P._will=[],Laya.stage.frameLoop(1,null,function(){if(!(P._will.length<1)){for(var t=0;t<P._will.length;t++)laya.html.utils.Layout.layout(P._will[t]);P._will.length=0}})),P._will.push(t)},P.layout=function(t){if(!t||!t._style)return null;if(0==(512&t._style._type))return null;t.getStyle()._type&=-513;var e=P._multiLineLayout(t);return Render.isConchApp&&t.layaoutCallNative&&t.layaoutCallNative(),e},P._multiLineLayout=function(t){if(Text.RightToLeft)return P._multiLineLayout2(t);var e=new Array;t._addChildsToLayout(e);var i,n,r,a,s,o=0,l=e.length,h=t._getCSSStyle(),u=h.letterSpacing,c=h.leading,_=h.lineHeight,d=h._widthAuto()||!h.wordWrap,f=d?999999:t.width,p=(t.height,0),m=h.italic?h.fontSize/3:0,g=h._getAlign(),v=h._getValign(),y=0!==v||0!==g||0!=_,x=0,E=0,T=0,S=0,w=new Array,M=w[0]=new LayoutLine,D=!1,I=!1;M.h=0,h.italic&&(f-=h.fontSize/3);var b=0,C=!0;function A(){M.y=E,E+=M.h+c,0==M.h&&(E+=_),M.mWidth=b,b=0,M=new LayoutLine,w.push(M),M.h=0,D=!(C=!(x=0))}for(o=0;o<l;o++)if(null!=(i=e[o]))if(C=!1,i instanceof laya.html.dom.HTMLBrElement)A(),M.y=E;else{if(i._isChar()){if((a=i).isWord)D=I||"\n"===a.char,M.wordStartIndex=M.elements.length;else{if(0<w.length&&f<x+T&&0<M.wordStartIndex){var R;R=M.elements.length-M.wordStartIndex+1,M.elements.length=M.wordStartIndex,o-=R,A();continue}D=!1,b+=a.width}T=a.width+u,S=a.height,I=!1,(D=D||f<x+T)&&A(),M.minTextHeight=Math.min(M.minTextHeight,i.height)}else n=i._getCSSStyle(),s=i,r=n.padding,0===n._getCssFloat()||(y=!0),D=I||n.lineElement,T=s.width*s._style._tf.scaleX+r[1]+r[3]+u,S=s.height*s._style._tf.scaleY+r[0]+r[2],I=n.lineElement,(D=D||f<x+T&&n.wordWrap)&&A();M.elements.push(i),M.h=Math.max(M.h,S),i.x=x,i.y=E,x+=T,M.w=x-u,M.y=E,p=Math.max(x+m,p)}else C||(x+=P.DIV_ELEMENT_PADDING),M.wordStartIndex=M.elements.length;if(E=M.y+M.h,y){var L=0,O=f;for(d&&0<t.width&&(O=t.width),o=0,l=w.length;o<l;o++)w[o].updatePos(0,O,o,L,g,v,_),L+=Math.max(_,w[o].h+c);E=L}return d&&(t.width=p),E>t.height&&(t.height=E),[p,E]},P._multiLineLayout2=function(t){var e=new Array;t._addChildsToLayout(e);var i,n,r,a,s,o=0,l=e.length,h=t._getCSSStyle(),u=h.letterSpacing,c=h.leading,_=h.lineHeight,d=h._widthAuto()||!h.wordWrap,f=d?999999:t.width,p=(t.height,0),m=h.italic?h.fontSize/3:0,g=2-h._getAlign(),v=h._getValign(),y=0!==v||0!==g||0!=_,x=0,E=0,T=0,S=0,w=new Array,M=w[0]=new LayoutLine,D=!1,I=!1;M.h=0,h.italic&&(f-=h.fontSize/3);var b=0,C=!0;function A(){M.y=E,E+=M.h+c,0==M.h&&(E+=_),M.mWidth=b,b=0,M=new LayoutLine,w.push(M),M.h=0,D=!(C=!(x=0))}for(o=0;o<l;o++)if(null!=(i=e[o]))if(C=!1,i instanceof laya.html.dom.HTMLBrElement)A(),M.y=E;else{if(i._isChar()){if((a=i).isWord)D=I||"\n"===a.char,M.wordStartIndex=M.elements.length;else{if(0<w.length&&f<x+T&&0<M.wordStartIndex){var R;R=M.elements.length-M.wordStartIndex+1,M.elements.length=M.wordStartIndex,o-=R,A();continue}D=!1,b+=a.width}T=a.width+u,S=a.height,I=!1,(D=D||f<x+T)&&A(),M.minTextHeight=Math.min(M.minTextHeight,i.height)}else n=i._getCSSStyle(),s=i,r=n.padding,0===n._getCssFloat()||(y=!0),D=I||n.lineElement,T=s.width*s._style._tf.scaleX+r[1]+r[3]+u,S=s.height*s._style._tf.scaleY+r[0]+r[2],I=n.lineElement,(D=D||f<x+T&&n.wordWrap)&&A();M.elements.push(i),M.h=Math.max(M.h,S),i.x=x,i.y=E,x+=T,M.w=x-u,M.y=E,p=Math.max(x+m,p)}else C||(x+=P.DIV_ELEMENT_PADDING),M.wordStartIndex=M.elements.length;if(E=M.y+M.h,y){var L=0,O=f;for(o=0,l=w.length;o<l;o++)w[o].updatePos(0,O,o,L,g,v,_),L+=Math.max(_,w[o].h+c);E=L}for(d&&(t.width=p),E>t.height&&(t.height=E),o=0,l=w.length;o<l;o++)w[o].revertOrder(f);return[p,E]},P._will=null,P.DIV_ELEMENT_PADDING=0,P}(),LayoutLine=function(){function t(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}__class(t,"laya.html.utils.LayoutLine");var e=t.prototype;return e.updatePos=function(t,e,i,n,r,a,s){var o,l=0;0<this.elements.length&&(l=(o=this.elements[this.elements.length-1]).x+o.width-this.elements[0].x);var h=0,u=NaN;1===r&&(h=(e-l)/2),2===r&&(h=e-l),0===s||0!=a||(a=1);for(var c=0,_=this.elements.length;c<_;c++){var d=(o=this.elements[c])._getCSSStyle();switch(0!==h&&(o.x+=h),d._getValign()){case 0:o.y=n;break;case 1:var f=0;99999!=this.minTextHeight&&(f=this.minTextHeight);var p=(f+s)/2;p=Math.max(p,this.h),u=(laya.html.dom.HTMLImageElement,n+p-o.height),o.y=u;break;case 2:o.y=n+(s-o.height)}}},e.revertOrder=function(t){var e;if(0<this.elements.length){var i,n=0;for(i=this.elements.length,n=0;n<i;n++)(e=this.elements[n]).x=t-e.x-e.width}},t}(),HTMLElement=function(_super){function HTMLElement(){this.URI=null,this._href=null,HTMLElement.__super.call(this),this._text=HTMLElement._EMPTYTEXT,this.setStyle(new CSSStyle(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}__class(HTMLElement,"laya.html.dom.HTMLElement",_super);var __proto=HTMLElement.prototype;return __proto.layaoutCallNative=function(){var t=0;if(this._childs&&0<(t=this._childs.length))for(var e=0;e<t;e++)this._childs[e].layaoutCallNative&&this._childs[e].layaoutCallNative();var i=this._getWords();i?laya.html.dom.HTMLElement.fillWords(this,i,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},__proto.appendChild=function(t){return this.addChild(t)},__proto._getWords2=function(){var t=this._text.text;if(!t||0===t.length)return null;var e,i,n=0,r=0;if(this._text.drawWords)i=this._text.drawWords;else{for(r=(e=t.split(" ")).length-1,i=[],n=0;n<r;n++)i.push(e[n]," ");0<=r&&i.push(e[r]),this._text.drawWords=i}var a,s=this._text.words;if(s&&s.length===i.length)return s;null===s&&(this._text.words=s=[]),s.length=i.length;var o=this.style,l=o.font;for(n=0,r=i.length;n<r;n++){a=Utils.measureText(i[n],l);var h=s[n]=new HTMLChar(i[n],a.width,a.height||o.fontSize,o);if(1<h.char.length&&(h.charNum=h.char),this.href){var u=new Sprite;this.addChild(u),h.setSprite(u)}}return s},__proto._getWords=function(){if(!Text.CharacterCache)return this._getWords2();var t=this._text.text;if(!t||0===t.length)return null;var e,i=this._text.words;if(i&&i.length===t.length)return i;null===i&&(this._text.words=i=[]),i.length=t.length;for(var n=this.style,r=n.font,a=0,s=t.length;a<s;a++){e=Utils.measureText(t.charAt(a),r);var o=i[a]=new HTMLChar(t.charAt(a),e.width,e.height||n.fontSize,n);if(this.href){var l=new Sprite;this.addChild(l),o.setSprite(l)}}return i},__proto.showLinkSprite=function(){var t=this._text.words;if(t)for(var e,i,n=[],r=0;r<t.length;r++)i=t[r],(e=new Sprite).graphics.drawRect(0,0,i.width,i.height,"#ff0000"),e.width=i.width,e.height=i.height,this.addChild(e),n.push(e)},__proto._layoutLater=function(){var t=this.style;512&t._type||(t.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&t.block?(Layout.later(this),t._type|=512):this.parent&&this.parent._layoutLater())},__proto._setAttributes=function(t,e){switch(t){case"style":return void this.style.cssText(e);case"class":return void(this.className=e)}_super.prototype._setAttributes.call(this,t,e)},__proto.updateHref=function(){if(null!=this._href){var t=this._getWords();if(t)for(var e,i,n=0;n<t.length;n++)(i=(e=t[n]).getSprite())&&(i.size(e.width,e.height),i.on("click",this,this.onLinkHandler))}},__proto.onLinkHandler=function(t){switch(t.type){case"click":for(var e=this;e;)e.event("link",[this.href]),e=e.parent}},__proto.formatURL=function(t){return this.URI?URL.formatURL(t,this.URI?this.URI.path:null):t},__getset(0,__proto,"href",function(){return this._href},function(t){null!=(this._href=t)&&(this._getCSSStyle().underLine=1,this.updateHref())}),__getset(0,__proto,"color",null,function(t){this.style.color=t}),__getset(0,__proto,"onClick",null,function(value){var fn;eval("fn=function(event){"+value+";}"),this.on("click",this,fn)}),__getset(0,__proto,"id",null,function(t){HTMLDocument.document.setElementById(t,this)}),__getset(0,__proto,"innerTEXT",function(){return this._text.text},function(t){this.text=t}),__getset(0,__proto,"style",function(){return this._style}),__getset(0,__proto,"text",function(){return this._text.text},function(t){this._text==HTMLElement._EMPTYTEXT?this._text={text:t,words:null}:(this._text.text=t,this._text.words&&(this._text.words.length=0)),Render.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),__getset(0,__proto,"parent",_super.prototype._$get_parent,function(t){if(t instanceof laya.html.dom.HTMLElement){var e=t;this.URI||(this.URI=e.URI),this.style.inherit(e.style)}Laya.superSet(Sprite,this,"parent",t)}),__getset(0,__proto,"className",null,function(t){this.style.attrs(HTMLDocument.document.styleSheets["."+t])}),HTMLElement.fillWords=function(t,e,i,n,r,a,s){t.graphics.clear();for(var o=0,l=e.length;o<l;o++){var h=e[o];t.graphics.fillText(h.char,h.x+i,h.y+n,r,a,"left",s)}},HTMLElement._EMPTYTEXT={text:null,words:null},HTMLElement}(Sprite),HTMLBrElement=function(t){function e(){e.__super.call(this),this.style.lineElement=!0,this.style.block=!0}return __class(e,"laya.html.dom.HTMLBrElement",HTMLElement),e}(),HTMLDivElement=function(t){function e(){this.contextHeight=NaN,this.contextWidth=NaN,e.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}__class(e,"laya.html.dom.HTMLDivElement",t);var i=e.prototype;return i.appendHTML=function(t){HTMLParse.parse(this,t,this.URI),this.layout()},i._addChildsToLayout=function(e){var t=this._getWords();if(null==t&&0==this._childs.length)return!1;t&&t.forEach(function(t){e.push(t)});for(var i=!0,n=0,r=this._childs.length;n<r;n++){var a=this._childs[n];i?i=!1:e.push(null),a._addToLayout(e)}return!0},i._addToLayout=function(t){this.layout()},i.layout=function(){if(this.style){this.style._type|=512;var t=Layout.layout(this);if(t){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new Rectangle);var e=this._$P.mHtmlBounds;e.x=e.y=0,e.width=this.contextWidth=t[0],e.height=this.contextHeight=t[1],this.setBounds(e)}}},__getset(0,i,"height",function(){return this._height?this._height:this.contextHeight},t.prototype._$set_height),__getset(0,i,"innerHTML",null,function(t){this.destroyChildren(),this.appendHTML(t)}),__getset(0,i,"width",function(){return this._width?this._width:this.contextWidth},function(t){var e=!1;e=0===t?t!=this._width:t!=this.width,Laya.superSet(HTMLElement,this,"width",t),e&&this.layout()}),e}(HTMLElement),HTMLDocument=function(t){function e(){this.all=new Array,this.styleSheets=CSSStyle.styleSheets,e.__super.call(this)}__class(e,"laya.html.dom.HTMLDocument",HTMLElement);var i=e.prototype;return i.getElementById=function(t){return this.all[t]},i.setElementById=function(t,e){this.all[t]=e},__static(e,["document",function(){return this.document=new e}]),e}(),HTMLImageElement=function(t){function e(){this._tex=null,this._url=null,this._renderArgs=[],e.__super.call(this),this.style.block=!0}__class(e,"laya.html.dom.HTMLImageElement",HTMLElement);var i=e.prototype;return i._addToLayout=function(t){!this._style.absolute&&t.push(this)},i.render=function(t,e,i){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||(Stat.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,t.ctx.drawTexture2(e,i,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},i.layaoutCallNative=function(){var t=0;if(this._childs&&0<(t=this._childs.length))for(var e=0;e<t;e++)this._childs[e].layaoutCallNative&&this._childs[e].layaoutCallNative()},__getset(0,i,"src",null,function(t){var e=this;if(t=this.formatURL(t),this._url!=t){this._url=t;var i=this._tex=Loader.getRes(t);i||(this._tex=i=new Texture,i.load(t),Loader.cacheRes(t,i)),i.loaded?n():i.on("loaded",null,n)}function n(){var t=e._style;t.widthed(e)||e._tex.width,t.heighted(e)||e._tex.height;t.widthed(e)||e._width==e._tex.width||(e.width=e._tex.width,e.parent&&e.parent._layoutLater()),t.heighted(e)||e._height==e._tex.height||(e.height=e._tex.height,e.parent&&e.parent._layoutLater()),Render.isConchApp&&(e._renderArgs[0]=e._tex,e._renderArgs[1]=e.x,e._renderArgs[2]=e.y,e._renderArgs[3]=e.width||e._tex.width,e._renderArgs[4]=e.height||e._tex.height,e.graphics.drawTexture(e._tex,0,0,e._renderArgs[3],e._renderArgs[4])),e.repaint(),e.parentRepaint()}}),e}(),HTMLLinkElement=function(t){function e(){this.type=null,e.__super.call(this),this.visible=!1}__class(e,"laya.html.dom.HTMLLinkElement",t);var i=e.prototype;return i._onload=function(t){switch(this.type){case"text/css":CSSStyle.parseCSS(t,this.URI)}},__getset(0,i,"href",t.prototype._$get_href,function(t){var e=this;t=this.formatURL(t),this.URI=new URL(t);var i=new Loader;i.once("complete",null,function(t){e._onload(t)}),i.load(t,"text")}),e._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g"),e}(HTMLElement),HTMLStyleElement=function(t){function e(){e.__super.call(this),this.visible=!1}return __class(e,"laya.html.dom.HTMLStyleElement",t),__getset(0,e.prototype,"text",t.prototype._$get_text,function(t){CSSStyle.parseCSS(t,null)}),e}(HTMLElement),HTMLIframeElement=function(t){function e(){e.__super.call(this),this._getCSSStyle().valign="middle"}return __class(e,"laya.html.dom.HTMLIframeElement",t),__getset(0,e.prototype,"href",t.prototype._$get_href,function(i){var n=this;i=this.formatURL(i);var t=new Loader;t.once("complete",null,function(t){var e=n.URI;n.URI=new URL(i),n.innerHTML=t,!e||(n.URI=e)}),t.load(i,"text")}),e}(HTMLDivElement)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}),function(t,e,p){p.un,p.uns;var n=p.static,a=p.class,r=p.getset,i=(p.__newvec,laya.display.Animation),m=laya.utils.Browser,g=laya.utils.ClassUtils,s=laya.filters.ColorFilter,o=laya.utils.Ease,l=laya.events.Event,h=(laya.events.EventDispatcher,laya.display.css.Font),u=laya.display.FrameAnimation,c=laya.display.Graphics,_=laya.utils.Handler,d=laya.display.Input,f=laya.net.Loader,v=(laya.display.Node,laya.maths.Point),y=laya.maths.Rectangle,x=laya.renders.Render,E=laya.display.Sprite,T=laya.display.Text,S=laya.resource.Texture,w=laya.utils.Tween,M=laya.utils.Utils,D=laya.utils.WeakObject;p.interface("laya.ui.IItem"),p.interface("laya.ui.ISelect"),p.interface("laya.ui.IRender"),p.interface("laya.ui.IComponent"),p.interface("laya.ui.IBox","IComponent");var I=function(){function t(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return a(t,"laya.ui.LayoutStyle"),n(t,["EMPTY",function(){return this.EMPTY=new t}]),t}(),b=function(){function t(){}return a(t,"laya.ui.Styles"),t.labelColor="#000000",t.buttonStateNum=3,t.scrollBarMinNum=15,t.scrollBarDelayTime=500,n(t,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),t}(),C=function(){function r(){}return a(r,"laya.ui.UIUtils"),r.fillArray=function(t,e,i){var n=t.concat();if(e)for(var r=e.split(","),a=0,s=Math.min(n.length,r.length);a<s;a++){var o=r[a];n[a]="true"==o||"false"!=o&&o,null!=i&&(n[a]=i(o))}return n},r.toColor=function(t){return M.toHexColor(t)},r.gray=function(t,e){void 0===e&&(e=!0),e?r.addFilter(t,r.grayFilter):r.clearFilter(t,s)},r.addFilter=function(t,e){var i=t.filters||[];i.push(e),t.filters=i},r.clearFilter=function(t,e){var i=t.filters;if(null!=i&&0<i.length){for(var n=i.length-1;-1<n;n--){var r=i[n];p.__typeof(r,e)&&i.splice(n,1)}t.filters=i}},r._getReplaceStr=function(t){return r.escapeSequence[t]},r.adptString=function(t){return t.replace(/\\(\w)/g,r._getReplaceStr)},r.getBindFun=function(t){var e=r._funMap.get(t);if(null==e){var i='"'+t+'"',n="(function(data){if(data==null)return;with(data){try{\nreturn "+(i=i.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";e=m.window.eval(n),r._funMap.set(t,e)}return e},n(r,["grayFilter",function(){return this.grayFilter=new s([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new D}]),r}(),A=function(){function t(){}return a(t,"UIConfig"),t.touchScrollEnable=!0,t.mouseWheelEnable=!0,t.showButtons=!0,t.popupBgColor="#000000",t.popupBgAlpha=.5,t.closeDialogOnSide=!0,t}(),R=function(e){function f(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,f.__super.call(this)}a(f,"laya.ui.AutoBitmap",e);var t=f.prototype;return t.destroy=function(){e.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},t._setChanged=function(){this._isChanged||(this._isChanged=!0,p.timer.callLater(this,this.changeSource))},t.changeSource=function(){this._isChanged=!1;var t=this._source;if(t&&t.bitmap){var e=this.width,i=this.height,n=this._sizeGrid,r=t.sourceWidth,a=t.sourceHeight;if(!n||r===e&&a===i)this.cleanByTexture(t,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,e,i);else{t.$_GID||(t.$_GID=M.getGID());var s=t.$_GID+"."+e+"."+i+"."+n.join(".");if(M.isOKCmdList(D.I.get(s)))return void(this.cmds=D.I.get(s));this.clear();var o=n[0],l=n[1],h=n[2],u=n[3],c=n[4],_=!1;if(e==r&&(u=l=0),i==a&&(o=h=0),e<u+l){var d=e;_=!0,e=u+l,this.save(),this.clipRect(0,0,d,i)}u&&o&&this.drawTexture(f.getTexture(t,0,0,u,o),0,0,u,o),l&&o&&this.drawTexture(f.getTexture(t,r-l,0,l,o),e-l,0,l,o),u&&h&&this.drawTexture(f.getTexture(t,0,a-h,u,h),0,i-h,u,h),l&&h&&this.drawTexture(f.getTexture(t,r-l,a-h,l,h),e-l,i-h,l,h),o&&this.drawBitmap(c,f.getTexture(t,u,0,r-u-l,o),u,0,e-u-l,o),h&&this.drawBitmap(c,f.getTexture(t,u,a-h,r-u-l,h),u,i-h,e-u-l,h),u&&this.drawBitmap(c,f.getTexture(t,0,o,u,a-o-h),0,o,u,i-o-h),l&&this.drawBitmap(c,f.getTexture(t,r-l,o,l,a-o-h),e-l,o,l,i-o-h),this.drawBitmap(c,f.getTexture(t,u,o,r-u-l,a-o-h),u,o,e-u-l,i-o-h),_&&this.restore(),this.autoCacheCmd&&!x.isConchApp&&D.I.set(s,this.cmds)}this._repaint()}},t.drawBitmap=function(t,e,i,n,r,a){void 0===r&&(r=0),void 0===a&&(a=0),r<.1||a<.1||(!t||e.width==r&&e.height==a?this.drawTexture(e,i,n,r,a):this.fillTexture(e,i,n,r,a))},t.clear=function(t){void 0===t&&(t=!0),e.prototype.clear.call(this,!1)},r(0,t,"sizeGrid",function(){return this._sizeGrid},function(t){this._sizeGrid=t,this._setChanged()}),r(0,t,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function(t){this._width!=t&&(this._width=t,this._setChanged())}),r(0,t,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function(t){this._height!=t&&(this._height=t,this._setChanged())}),r(0,t,"source",function(){return this._source},function(t){t?(this._source=t,this._setChanged()):(this._source=null,this.clear())}),f.getTexture=function(t,e,i,n,r){n<=0&&(n=1),r<=0&&(r=1),t.$_GID||(t.$_GID=M.getGID());var a=t.$_GID+"."+e+"."+i+"."+n+"."+r,s=D.I.get(a);return s&&s.source||(s=S.createFromTexture(t,e,i,n,r),D.I.set(a,s)),s},f}(c),L=(function(t){function e(){e.__super.call(this)}a(e,"laya.ui.UIEvent",l),e.SHOW_TIP="showtip",e.HIDE_TIP="hidetip"}(),function(e){function t(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,t.__super.call(this),this._layout=I.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}a(t,"laya.ui.Component",e);var i=t.prototype;return p.imps(i,{"laya.ui.IComponent":!0}),i.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},i.preinitialize=function(){},i.createChildren=function(){},i.initialize=function(){},i.callLater=function(t,e){p.timer.callLater(this,t,e)},i.runCallLater=function(t){p.timer.runCallLater(this,t)},i.commitMeasure=function(){},i.changeSize=function(){this.event("resize")},i.getLayout=function(){return this._layout===I.EMPTY&&(this._layout=new I),this._layout},i._setLayoutEnabled=function(t){this._layout&&this._layout.enable!=t&&(this._layout.enable=t,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},i.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},i.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},i.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},i.resetLayoutX=function(){var t=this._layout;if(isNaN(t.anchorX)||(this.pivotX=t.anchorX*this.width),this.layoutEnabled){var e=this.parent;e&&(isNaN(t.centerX)?isNaN(t.left)?isNaN(t.right)||(this.x=Math.round(e.width-this.displayWidth-t.right+this.pivotX*this.scaleX)):(this.x=Math.round(t.left+this.pivotX*this.scaleX),isNaN(t.right)||(this.width=(e._width-t.left-t.right)/(this.scaleX||.01))):this.x=Math.round(.5*(e.width-this.displayWidth)+t.centerX+this.pivotX*this.scaleX))}},i.resetLayoutY=function(){var t=this._layout;if(isNaN(t.anchorY)||(this.pivotY=t.anchorY*this.height),this.layoutEnabled){var e=this.parent;e&&(isNaN(t.centerY)?isNaN(t.top)?isNaN(t.bottom)||(this.y=Math.round(e.height-this.displayHeight-t.bottom+this.pivotY*this.scaleY)):(this.y=Math.round(t.top+this.pivotY*this.scaleY),isNaN(t.bottom)||(this.height=(e._height-t.top-t.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*(e.height-this.displayHeight)+t.centerY+this.pivotY*this.scaleY))}},i.onMouseOver=function(t){p.stage.event("showtip",this._toolTip)},i.onMouseOut=function(t){p.stage.event("hidetip",this._toolTip)},r(0,i,"displayWidth",function(){return this.width*this.scaleX}),r(0,i,"width",function(){return this._width?this._width:this.measureWidth},function(t){this._width!=t&&(this._width=t,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),r(0,i,"measureWidth",function(){var t=0;this.commitMeasure();for(var e=this.numChildren-1;-1<e;e--){var i=this.getChildAt(e);i.visible&&(t=Math.max(i.x+i.width*i.scaleX,t))}return t}),r(0,i,"displayHeight",function(){return this.height*this.scaleY}),r(0,i,"height",function(){return this._height?this._height:this.measureHeight},function(t){this._height!=t&&(this._height=t,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),r(0,i,"dataSource",function(){return this._dataSource},function(t){for(var e in this._dataSource=t,this._dataSource)this.hasOwnProperty(e)&&"function"!=typeof this[e]&&(this[e]=this._dataSource[e])}),r(0,i,"scaleY",e.prototype._$get_scaleY,function(t){p.superGet(E,this,"scaleY")!=t&&(p.superSet(E,this,"scaleY",t),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),r(0,i,"measureHeight",function(){var t=0;this.commitMeasure();for(var e=this.numChildren-1;-1<e;e--){var i=this.getChildAt(e);i.visible&&(t=Math.max(i.y+i.height*i.scaleY,t))}return t}),r(0,i,"scaleX",e.prototype._$get_scaleX,function(t){p.superGet(E,this,"scaleX")!=t&&(p.superSet(E,this,"scaleX",t),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),r(0,i,"top",function(){return this._layout.top},function(t){t!=this._layout.top&&(this.getLayout().top=t,this._setLayoutEnabled(!0)),this.resetLayoutY()}),r(0,i,"bottom",function(){return this._layout.bottom},function(t){t!=this._layout.bottom&&(this.getLayout().bottom=t,this._setLayoutEnabled(!0)),this.resetLayoutY()}),r(0,i,"left",function(){return this._layout.left},function(t){t!=this._layout.left&&(this.getLayout().left=t,this._setLayoutEnabled(!0)),this.resetLayoutX()}),r(0,i,"right",function(){return this._layout.right},function(t){t!=this._layout.right&&(this.getLayout().right=t,this._setLayoutEnabled(!0)),this.resetLayoutX()}),r(0,i,"centerX",function(){return this._layout.centerX},function(t){t!=this._layout.centerX&&(this.getLayout().centerX=t,this._setLayoutEnabled(!0)),this.resetLayoutX()}),r(0,i,"centerY",function(){return this._layout.centerY},function(t){t!=this._layout.centerY&&(this.getLayout().centerY=t,this._setLayoutEnabled(!0)),this.resetLayoutY()}),r(0,i,"anchorX",function(){return this._layout.anchorX},function(t){t!=this._layout.anchorX&&(this.getLayout().anchorX=t,this._setLayoutEnabled(!0)),this.resetLayoutX()}),r(0,i,"anchorY",function(){return this._layout.anchorY},function(t){t!=this._layout.anchorY&&(this.getLayout().anchorY=t,this._setLayoutEnabled(!0)),this.resetLayoutY()}),r(0,i,"tag",function(){return this._tag},function(t){this._tag=t}),r(0,i,"toolTip",function(){return this._toolTip},function(t){this._toolTip!=t&&(null!=(this._toolTip=t)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),r(0,i,"comXml",function(){return this._comXml},function(t){this._comXml=t}),r(0,i,"gray",function(){return this._gray},function(t){t!==this._gray&&(this._gray=t,C.gray(this,t))}),r(0,i,"disabled",function(){return this._disabled},function(t){t!==this._disabled&&(this.gray=this._disabled=t,this.mouseEnabled=!t)}),t}(E)),O=function(t){function e(){this.lockLayer=null,this.popupEffect=function(t){t.scale(1,1),w.from(t,{x:p.stage.width/2,y:p.stage.height/2,scaleX:0,scaleY:0},300,o.backOut,_.create(this,this.doOpen,[t]))},this.closeEffect=function(t,e){w.to(t,{x:p.stage.width/2,y:p.stage.height/2,scaleX:0,scaleY:0},300,o.strongOut,_.create(this,this.doClose,[t,e]))},e.__super.call(this),this.maskLayer=new E,this.popupEffectHandler=new _(this,this.popupEffect),this.closeEffectHandler=new _(this,this.closeEffect),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,p.stage.addChild(this),p.stage.on("resize",this,this._onResize),A.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}a(e,"laya.ui.DialogManager",E);var i=e.prototype;return i._closeOnSide=function(){var t=this.getChildAt(this.numChildren-1);t instanceof laya.ui.Dialog&&t.close("side")},i.setLockView=function(t){this.lockLayer||(this.lockLayer=new P,this.lockLayer.mouseEnabled=!0,this.lockLayer.size(p.stage.width,p.stage.height)),this.lockLayer.removeChildren(),t&&(t.centerX=t.centerY=0,this.lockLayer.addChild(t))},i._onResize=function(t){var e=this.maskLayer.width=p.stage.width,i=this.maskLayer.height=p.stage.height;this.lockLayer&&this.lockLayer.size(e,i),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,e,i,A.popupBgColor),this.maskLayer.alpha=A.popupBgAlpha;for(var n=this.numChildren-1;-1<n;n--){var r=this.getChildAt(n);r.popupCenter&&this._centerDialog(r)}},i._centerDialog=function(t){t.x=Math.round((p.stage.width-t.width>>1)+t.pivotX),t.y=Math.round((p.stage.height-t.height>>1)+t.pivotY)},i.open=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1),e&&this._closeAll(),t.popupCenter&&this._centerDialog(t),this.addChild(t),(t.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),i&&null!=t.popupEffect?t.popupEffect.runWith(t):this.doOpen(t),this.event("open")},i.doOpen=function(t){t.onOpened()},i.lock=function(t){this.lockLayer&&(t?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},i.close=function(t,e,i){void 0===i&&(i=!1),i&&null!=t.closeEffect?t.closeEffect.runWith([t,e]):this.doClose(t,e),this.event("close")},i.doClose=function(t,e){t.removeSelf(),t.isModal&&this._checkMask(),t.closeHandler&&t.closeHandler.runWith(e),t.onClosed(e)},i.closeAll=function(){this._closeAll(),this.event("close")},i._closeAll=function(){for(var t=this.numChildren-1;-1<t;t--){var e=this.getChildAt(t);e&&null!=e.close&&this.doClose(e)}},i.getDialogsByGroup=function(t){for(var e=[],i=this.numChildren-1;-1<i;i--){var n=this.getChildAt(i);n&&n.group===t&&e.push(n)}return e},i.closeByGroup=function(t){for(var e=[],i=this.numChildren-1;-1<i;i--){var n=this.getChildAt(i);n&&n.group===t&&(n.close(),e.push(n))}return e},i._checkMask=function(){this.maskLayer.removeSelf();for(var t=this.numChildren-1;-1<t;t--){var e=this.getChildAt(t);if(e&&e.isModal)return void this.addChildAt(this.maskLayer,t)}},e}(),P=function(t){function e(){e.__super.call(this)}a(e,"laya.ui.Box",t);var i=e.prototype;return p.imps(i,{"laya.ui.IBox":!0}),r(0,i,"dataSource",t.prototype._$get_dataSource,function(t){for(var e in this._dataSource=t){var i=this.getChildByName(e);i?i.dataSource=t[e]:this.hasOwnProperty(e)&&"function"!=typeof this[e]&&(this[e]=t[e])}}),e}(L),N=function(e){function i(t,e){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,i.__super.call(this),this._labelColors=b.buttonLabelColors,this._stateNum=b.buttonStateNum,void 0===e&&(e=""),this.skin=t,this.label=e}a(i,"laya.ui.Button",e);var t=i.prototype;return p.imps(t,{"laya.ui.ISelect":!0}),t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy(t),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},t.createChildren=function(){this.graphics=this._bitmap=new R},t.createText=function(){this._text||(this._text=new T,this._text.overflow=T.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},t.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},t.onMouse=function(t){if(!1!==this.toggle||!this._selected)return"click"===t.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=i.stateMap[t.type]))},t.changeClips=function(){var t=f.getRes(this._skin);if(t){var e=t.sourceWidth,i=t.sourceHeight/this._stateNum;t.$_GID||(t.$_GID=M.getGID());var n=t.$_GID+"-"+this._stateNum,r=D.I.get(n);if(M.isOkTextureList(r)||(r=null),r)this._sources=r;else{if(this._sources=[],1===this._stateNum)this._sources.push(t);else for(var a=0;a<this._stateNum;a++)this._sources.push(S.createFromTexture(t,0,i*a,e,i));D.I.set(n,this._sources)}this._autoSize?(this._bitmap.width=this._width||e,this._bitmap.height=this._height||i,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=e)}else console.log("lose skin",this._skin)},t.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var t=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[t]),this.label&&(this._text.color=this._labelColors[t],this._strokeColors&&(this._text.strokeColor=this._strokeColors[t]))},t._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},r(0,t,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function(t){this.createText(),this._text.strokeColor=t}),r(0,t,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),r(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this.callLater(this.changeClips),this._setStateChanged())}),r(0,t,"state",function(){return this._state},function(t){this._state!=t&&(this._state=t,this._setStateChanged())}),r(0,t,"text",function(){return this.createText(),this._text}),r(0,t,"stateNum",function(){return this._stateNum},function(t){"string"==typeof t&&(t=parseInt(t)),this._stateNum!=t&&(this._stateNum=t<1?1:3<t?3:t,this.callLater(this.changeClips))}),r(0,t,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function(t){this._strokeColors=C.fillArray(b.buttonLabelColors,t,String),this._setStateChanged()}),r(0,t,"labelColors",function(){return this._labelColors.join(",")},function(t){this._labelColors=C.fillArray(b.buttonLabelColors,t,String),this._setStateChanged()}),r(0,t,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),r(0,t,"label",function(){return this._text?this._text.text:null},function(t){(this._text||t)&&(this.createText(),this._text.text!=t&&(t&&!this._text.parent&&this.addChild(this._text),this._text.text=(t+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),r(0,t,"selected",function(){return this._selected},function(t){this._selected!=t&&(this._selected=t,this.state=this._selected?2:0,this.event("change"))}),r(0,t,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function(t){this.createText(),this._text.padding=C.fillArray(b.labelPadding,t,Number)}),r(0,t,"labelSize",function(){return this.createText(),this._text.fontSize},function(t){this.createText(),this._text.fontSize=t}),r(0,t,"labelStroke",function(){return this.createText(),this._text.stroke},function(t){this.createText(),this._text.stroke=t}),r(0,t,"labelBold",function(){return this.createText(),this._text.bold},function(t){this.createText(),this._text.bold=t}),r(0,t,"labelFont",function(){return this.createText(),this._text.font},function(t){this.createText(),this._text.font=t}),r(0,t,"labelAlign",function(){return this.createText(),this._text.align},function(t){this.createText(),this._text.align=t}),r(0,t,"clickHandler",function(){return this._clickHandler},function(t){this._clickHandler=t}),r(0,t,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=C.fillArray(b.defaultSizeGrid,t,Number)}),r(0,t,"width",e.prototype._$get_width,function(t){p.superSet(L,this,"width",t),this._autoSize&&(this._bitmap.width=t,this._text&&(this._text.width=t))}),r(0,t,"height",e.prototype._$get_height,function(t){p.superSet(L,this,"height",t),this._autoSize&&(this._bitmap.height=t,this._text&&(this._text.height=t))}),r(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.label=t+"":p.superSet(L,this,"dataSource",t)}),r(0,t,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function(t){this._bitmap._offset=t?C.fillArray([1,1],t,Number):[]}),n(i,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),i}(L),V=function(e){function n(t,e,i){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._complete=null,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,n.__super.call(this),void 0===e&&(e=1),void 0===i&&(i=1),this._clipX=e,this._clipY=i,this.skin=t}a(n,"laya.ui.Clip",e);var t=n.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},t.dispose=function(){this.destroy(!0),p.loader.clearRes(this._skin)},t.createChildren=function(){this.graphics=this._bitmap=new R},t._onDisplay=function(t){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},t.changeClip=function(){if(this._clipChanged=!1,this._skin){var t=f.getRes(this._skin);t?this.loadComplete(this._skin,t):p.loader.load(this._skin,_.create(this,this.loadComplete,[this._skin]))}},t.loadComplete=function(t,e){if(t===this._skin&&e){var i=this._clipWidth||Math.ceil(e.sourceWidth/this._clipX),n=this._clipHeight||Math.ceil(e.sourceHeight/this._clipY),r=this._skin+i+n,a=D.I.get(r);if(M.isOkTextureList(a)||(a=null),a)this._sources=a;else{this._sources=[];for(var s=0;s<this._clipY;s++)for(var o=0;o<this._clipX;o++)this._sources.push(S.createFromTexture(e,i*o,n*s,i,n));D.I.set(r,this._sources)}this.index=this._index,this.event("loaded"),this.onCompResize()}},t.play=function(t,e){void 0===t&&(t=0),void 0===e&&(e=-1),this._isPlaying=!0,this.index=t,this._toIndex=e,this._index++,p.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},t._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},t.stop=function(){this._isPlaying=!1,p.timer.clear(this,this._loop),this.event("complete")},t._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},r(0,t,"interval",function(){return this._interval},function(t){this._interval!=t&&(this._interval=t,this._isPlaying&&this.play())}),r(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&((this._skin=t)?this._setClipChanged():this._bitmap.source=null)}),r(0,t,"sources",function(){return this._sources},function(t){this._sources=t,this.index=this._index,this.event("loaded")}),r(0,t,"clipX",function(){return this._clipX},function(t){this._clipX=t||1,this._setClipChanged()}),r(0,t,"clipY",function(){return this._clipY},function(t){this._clipY=t||1,this._setClipChanged()}),r(0,t,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),r(0,t,"clipWidth",function(){return this._clipWidth},function(t){this._clipWidth=t,this._setClipChanged()}),r(0,t,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=C.fillArray(b.defaultSizeGrid,t,Number)}),r(0,t,"group",function(){return this._group},function(t){t&&this._skin&&f.setGroup(this._skin,t),this._group=t}),r(0,t,"clipHeight",function(){return this._clipHeight},function(t){this._clipHeight=t,this._setClipChanged()}),r(0,t,"width",e.prototype._$get_width,function(t){p.superSet(L,this,"width",t),this._bitmap.width=t}),r(0,t,"height",e.prototype._$get_height,function(t){p.superSet(L,this,"height",t),this._bitmap.height=t}),r(0,t,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),r(0,t,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),r(0,t,"index",function(){return this._index},function(t){this._index=t,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[t]),this.event("change")}),r(0,t,"autoPlay",function(){return this._autoPlay},function(t){this._autoPlay!=t&&((this._autoPlay=t)?this.play():this.stop())}),r(0,t,"isPlaying",function(){return this._isPlaying},function(t){this._isPlaying=t}),r(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t?this.index=parseInt(t):p.superSet(L,this,"dataSource",t)}),r(0,t,"bitmap",function(){return this._bitmap}),n}(L),F=function(e){function t(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,t.__super.call(this)}a(t,"laya.ui.ColorPicker",e);var i=t.prototype;return i.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._colorPanel&&this._colorPanel.destroy(t),this._colorButton&&this._colorButton.destroy(t),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},i.createChildren=function(){this.addChild(this._colorButton=new N),this._colorPanel=new P,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new E),this._colorPanel.addChild(this._colorBlock=new E),this._colorPanel.addChild(this._colorInput=new d)},i.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},i.onPanelMouseDown=function(t){t.stopPropagation()},i.changePanel=function(){this._panelChanged=!1;var t=this._colorPanel.graphics;t.clear(),t.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,(t=this._colorTiles.graphics).clear();for(var e=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],i=0;i<12;i++)for(var n=0;n<20;n++){var r=0;r=0===n?e[i]:1===n?0:51*(((3*i+n/6)%3<<0)+3*(i/6<<0))<<16|n%6*51<<8|(i<<0)%6*51;var a=C.toColor(r);this._colors.push(a);var s=n*this._gridSize,o=i*this._gridSize;t.drawRect(s,o,this._gridSize,this._gridSize,a,"#000000")}},i.onColorButtonClick=function(t){this._colorPanel.parent?this.close():this.open()},i.open=function(){var t=this.localToGlobal(new v),e=t.x+this._colorPanel.width<=p.stage.width?t.x:p.stage.width-this._colorPanel.width,i=t.y+this._colorButton.height;i=i+this._colorPanel.height<=p.stage.height?i:t.y-this._colorPanel.height,this._colorPanel.pos(e,i),this._colorPanel.zOrder=1001,p._currentStage.addChild(this._colorPanel),p.stage.on("mousedown",this,this.removeColorBox)},i.close=function(){p.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},i.removeColorBox=function(t){this.close()},i.onColorFieldKeyDown=function(t){13==t.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),t.stopPropagation())},i.onColorInputChange=function(t){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},i.onColorTilesClick=function(t){this.selectedColor=this.getColorByMouse(),this.close()},i.onColorTilesMouseMove=function(t){this._colorInput.focus=!1;var e=this.getColorByMouse();this._colorInput.text=e,this.drawBlock(e)},i.getColorByMouse=function(){var t=this._colorTiles.getMousePoint(),e=Math.floor(t.x/this._gridSize),i=Math.floor(t.y/this._gridSize);return this._colors[20*i+e]},i.drawBlock=function(t){var e=this._colorBlock.graphics;e.clear();var i=t||"#ffffff";e.drawRect(0,0,50,20,i,this._borderColor),t||e.drawLine(0,0,50,20,"#ff0000")},i.changeColor=function(){var t=this.graphics;t.clear();var e=this._selectedColor||"#000000";t.drawRect(0,0,this._colorButton.width,this._colorButton.height,e)},i._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},r(0,i,"inputBgColor",function(){return this._inputBgColor},function(t){this._inputBgColor=t,this._setPanelChanged()}),r(0,i,"selectedColor",function(){return this._selectedColor},function(t){this._selectedColor!=t&&(this._selectedColor=this._colorInput.text=t,this.drawBlock(t),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",l.EMPTY.setTo("change",this,this)))}),r(0,i,"skin",function(){return this._colorButton.skin},function(t){this._colorButton.skin=t,this.changeColor()}),r(0,i,"bgColor",function(){return this._bgColor},function(t){this._bgColor=t,this._setPanelChanged()}),r(0,i,"borderColor",function(){return this._borderColor},function(t){this._borderColor=t,this._setPanelChanged()}),r(0,i,"inputColor",function(){return this._inputColor},function(t){this._inputColor=t,this._setPanelChanged()}),t}(L),B=function(e){function i(t,e){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,i.__super.call(this),this._itemColors=b.comboBoxItemColors,this.skin=t,this.labels=e}a(i,"laya.ui.ComboBox",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._button&&this._button.destroy(t),this._list&&this._list.destroy(t),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},t.createChildren=function(){this.addChild(this._button=new N),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},t._createList=function(){this._list=new Z,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},t._setListEvent=function(t){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=_.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},t.onListDown=function(t){t.stopPropagation()},t.onScrollBarDown=function(t){t.stopPropagation()},t.onButtonMouseDown=function(t){this.callLater(this.switchTo,[!this._isOpen])},t.changeList=function(){this._listChanged=!1;var t=this.width-2,e=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:t,height:this._itemHeight,fontSize:this._itemSize,color:e}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},t.onlistItemMouse=function(t,e){var i=t.type;if("mouseover"===i||"mouseout"===i){if(this._isCustomList)return;var n=this._list.getCell(e);if(!n)return;var r=n.getChildByName("label");r&&(r.color="mouseover"===i?(r.bgColor=this._itemColors[0],this._itemColors[1]):(r.bgColor=null,this._itemColors[2]))}else"click"===i&&(this.selectedIndex=e,this.isOpen=!1)},t.switchTo=function(t){this.isOpen=t},t.changeOpen=function(){this.isOpen=!this._isOpen},t.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var t=this._list.graphics;t.clear(),t.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var e=this._list.array||[],i=e.length=0,n=this._labels.length;i<n;i++)e.push({label:this._labels[i]});this._list.height=this._listHeight,this._list.array=e},t.changeSelected=function(){this._button.label=this.selectedLabel},t._onStageMouseWheel=function(t){this._list&&!this._list.contains(t.target)&&this.removeList(null)},t.removeList=function(t){p.stage.off("mousedown",this,this.removeList),p.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},r(0,t,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this._selectedIndex=t,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[l.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),r(0,t,"measureHeight",function(){return this._button.height}),r(0,t,"skin",function(){return this._button.skin},function(t){this._button.skin!=t&&(this._button.skin=t,this._listChanged=!0)}),r(0,t,"measureWidth",function(){return this._button.width}),r(0,t,"width",e.prototype._$get_width,function(t){p.superSet(L,this,"width",t),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),r(0,t,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function(t){this.selectedIndex=this._labels.indexOf(t)}),r(0,t,"labels",function(){return this._labels.join(",")},function(t){0<this._labels.length&&(this.selectedIndex=-1),t?this._labels=t.split(","):this._labels.length=0,this._itemChanged=!0}),r(0,t,"height",e.prototype._$get_height,function(t){p.superSet(L,this,"height",t),this._button.height=this._height}),r(0,t,"selectHandler",function(){return this._selectHandler},function(t){this._selectHandler=t}),r(0,t,"visibleNum",function(){return this._visibleNum},function(t){this._visibleNum=t,this._listChanged=!0}),r(0,t,"labelBold",function(){return this._button.text.bold},function(t){this._button.text.bold=t}),r(0,t,"itemColors",function(){return String(this._itemColors)},function(t){this._itemColors=C.fillArray(this._itemColors,t,String),this._listChanged=!0}),r(0,t,"itemSize",function(){return this._itemSize},function(t){this._itemSize=t,this._listChanged=!0}),r(0,t,"scrollBar",function(){return this.list.scrollBar}),r(0,t,"isOpen",function(){return this._isOpen},function(t){if(this._isOpen!=t)if(this._isOpen=t,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var e=this.localToGlobal(v.TEMP.setTo(0,0)),i=e.y+this._button.height;i=i+this._listHeight<=p.stage.height?i:e.y-this._listHeight,this._list.pos(e.x,i),this._list.zOrder=1001,p._currentStage.addChild(this._list),p.stage.once("mousedown",this,this.removeList),p.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),r(0,t,"scrollBarSkin",function(){return this._scrollBarSkin},function(t){this._scrollBarSkin=t}),r(0,t,"sizeGrid",function(){return this._button.sizeGrid},function(t){this._button.sizeGrid=t}),r(0,t,"button",function(){return this._button}),r(0,t,"list",function(){return this._list||this._createList(),this._list},function(t){t&&(t.removeSelf(),this._isCustomList=!0,this._list=t,this._setListEvent(t),this._itemHeight=t.getCell(0).height+t.spaceY)}),r(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t?this.selectedIndex=parseInt(t):t instanceof Array?this.labels=t.join(","):p.superSet(L,this,"dataSource",t)}),r(0,t,"labelColors",function(){return this._button.labelColors},function(t){this._button.labelColors!=t&&(this._button.labelColors=t)}),r(0,t,"labelPadding",function(){return this._button.text.padding.join(",")},function(t){this._button.text.padding=C.fillArray(b.labelPadding,t,Number)}),r(0,t,"labelSize",function(){return this._button.text.fontSize},function(t){this._button.text.fontSize=t}),r(0,t,"labelFont",function(){return this._button.text.font},function(t){this._button.text.font=t}),r(0,t,"stateNum",function(){return this._button.stateNum},function(t){this._button.stateNum=t}),i}(L),U=function(e){function i(t){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,i.__super.call(this),this._showButtons=A.showButtons,this._touchScrollEnable=A.touchScrollEnable,this._mouseWheelEnable=A.mouseWheelEnable,this.skin=t,this.max=1}a(i,"laya.ui.ScrollBar",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),this.stopScroll(),this.target=null,e.prototype.destroy.call(this,t),this.upButton&&this.upButton.destroy(t),this.downButton&&this.downButton.destroy(t),this.slider&&this.slider.destroy(t),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},t.createChildren=function(){this.addChild(this.slider=new k),this.addChild(this.upButton=new N),this.addChild(this.downButton=new N)},t.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},t.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},t.onButtonMouseDown=function(t){var e=t.currentTarget===this.upButton;this.slide(e),p.timer.once(b.scrollBarDelayTime,this,this.startLoop,[e]),p.stage.once("mouseup",this,this.onStageMouseUp)},t.startLoop=function(t){p.timer.frameLoop(1,this,this.slide,[t])},t.slide=function(t){t?this.value-=this._scrollSize:this.value+=this._scrollSize},t.onStageMouseUp=function(t){p.timer.clear(this,this.startLoop),p.timer.clear(this,this.slide)},t.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},t.changeSize=function(){e.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},t.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},t.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},t.setScroll=function(t,e,i){this.runCallLater(this.changeSize),this.slider.setSlider(t,e,i),this.slider.bar.visible=0<e,!this._hide&&this.autoHide&&(this.visible=!1)},t.onTargetMouseWheel=function(t){this.value-=t.delta*this._scrollSize,this.target=this._target},t.onTargetMouseDown=function(t){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new v),this._lastPoint.setTo(p.stage.mouseX,p.stage.mouseY),p.timer.clear(this,this.tweenMove),w.clearTween(this),p.stage.once("mouseup",this,this.onStageMouseUp2),p.stage.once("mouseout",this,this.onStageMouseUp2),p.timer.frameLoop(1,this,this.loop)},t.loop=function(){var t=p.stage.mouseY,e=p.stage.mouseX;if(this._lastOffset=this.isVertical?t-this._lastPoint.y:e-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?p.stage._canvasTransform.getScaleY():p.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=e,this._lastPoint.y=t,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},t.onStageMouseUp2=function(t){if(p.stage.off("mouseup",this,this.onStageMouseUp2),p.stage.off("mouseout",this,this.onStageMouseUp2),p.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?w.to(this,{value:this.min},this.elasticBackTime,o.sineOut,_.create(this,this.elasticOver)):this._value>this.max&&w.to(this,{value:this.max},this.elasticBackTime,o.sineOut,_.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?p.stage.mouseY-this._lastPoint.y:p.stage.mouseX-this._lastPoint.x);for(var e=0,i=Math.min(this._offsets.length,3),n=0;n<i;n++)e+=this._offsets[this._offsets.length-1-n];if(this._lastOffset=e/i,(e=Math.abs(this._lastOffset))<2)return void this.event("end");60<e&&(this._lastOffset=0<this._lastOffset?60:-60);var r=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));p.timer.frameLoop(1,this,this.tweenMove,[r])}},t.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&w.to(this,{alpha:0},500),this.event("end")},t.tweenMove=function(t){this._lastOffset*=this.rollRatio;var e=NaN;if(0<t&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,e=.5*-(this.min-t-this.value),this._lastOffset>e&&(this._lastOffset=e)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,e=.5*-(this.max+t-this.value),this._lastOffset<e&&(this._lastOffset=e))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if(p.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?w.to(this,{value:this.min},this.elasticBackTime,o.sineOut,_.create(this,this.elasticOver)):this._value>this.max?w.to(this,{value:this.max},this.elasticBackTime,o.sineOut,_.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&w.to(this,{alpha:0},500)}},t.stopScroll=function(){this.onStageMouseUp2(null),p.timer.clear(this,this.tweenMove),w.clearTween(this)},r(0,t,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),r(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),r(0,t,"max",function(){return this.slider.max},function(t){this.slider.max=t}),r(0,t,"showButtons",function(){return this._showButtons},function(t){this._showButtons=t,this.callLater(this.changeScrollBar)}),r(0,t,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),r(0,t,"min",function(){return this.slider.min},function(t){this.slider.min=t}),r(0,t,"value",function(){return this._value},function(t){t!==this._value&&(this._value=t,this._isElastic||(this.slider._value!=t&&(this.slider._value=t,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),r(0,t,"isVertical",function(){return this.slider.isVertical},function(t){this.slider.isVertical=t}),r(0,t,"sizeGrid",function(){return this.slider.sizeGrid},function(t){this.slider.sizeGrid=t}),r(0,t,"scrollSize",function(){return this._scrollSize},function(t){this._scrollSize=t}),r(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.value=Number(t):p.superSet(L,this,"dataSource",t)}),r(0,t,"thumbPercent",function(){return this._thumbPercent},function(t){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),t=1<=t?.99:t,this._thumbPercent=t,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*t,b.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*t,b.scrollBarMinNum))}),r(0,t,"target",function(){return this._target},function(t){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=t)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),r(0,t,"hide",function(){return this._hide},function(t){this._hide=t,this.visible=!t}),r(0,t,"touchScrollEnable",function(){return this._touchScrollEnable},function(t){this._touchScrollEnable=t,this.target=this._target}),r(0,t,"mouseWheelEnable",function(){return this._mouseWheelEnable},function(t){this._mouseWheelEnable=t}),r(0,t,"tick",function(){return this.slider.tick},function(t){this.slider.tick=t}),i}(L),k=function(e){function i(t){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,i.__super.call(this),this.skin=t}a(i,"laya.ui.Slider",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._bg&&this._bg.destroy(t),this._bar&&this._bar.destroy(t),this._progress&&this._progress.destroy(t),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},t.createChildren=function(){this.addChild(this._bg=new H),this.addChild(this._bar=new N)},t.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},t.onBarMouseDown=function(t){this._globalSacle||(this._globalSacle=new v),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=p.stage.mouseX,this._ty=p.stage.mouseY,p.stage.on("mousemove",this,this.mouseMove),p.stage.once("mouseup",this,this.mouseUp),p.stage.once("mouseout",this,this.mouseUp),this.showValueText()},t.showValueText=function(){if(this.showLabel){var t=laya.ui.Slider.label;this.addChild(t),t.textField.changeText(this._value+""),this.isVertical?(t.x=this._bar.x+20,t.y=.5*(this._bar.height-t.height)+this._bar.y):(t.y=this._bar.y-20,t.x=.5*(this._bar.width-t.width)+this._bar.x)}},t.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},t.mouseUp=function(t){p.stage.off("mousemove",this,this.mouseMove),p.stage.off("mouseup",this,this.mouseUp),p.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},t.mouseMove=function(t){var e=this._value;this.isVertical?(this._bar.y+=(p.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=(p.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=p.stage.mouseX,this._ty=p.stage.mouseY;var i=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*i)/i,this._value!=e&&this.sendChangeEvent(),this.showValueText()},t.sendChangeEvent=function(t){void 0===t&&(t="change"),this.event(t),this.changeHandler&&this.changeHandler.runWith(this._value)},t.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},t.changeSize=function(){e.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},t.setSlider=function(t,e,i){this._value=-1,this._min=t,this._max=t<e?e:t,this.value=i<t?t:e<i?e:i},t.changeValue=function(){var t=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*t)/t,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var e=this._max-this._min;0===e&&(e=1),this.isVertical?(this._bar.y=(this._value-this._min)/e*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/e*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},t.onBgMouseDown=function(t){var e=this._bg.getMousePoint();this.isVertical?this.value=e.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=e.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},r(0,t,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),r(0,t,"skin",function(){return this._skin},function(t){if(this._skin!=t){this._skin=t,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var e=this._skin.replace(".png","$progress.png");f.getRes(e)&&(this._progress||(this.addChild(this._progress=new H),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=e),this.setBarPoint(),this.callLater(this.changeValue)}}),r(0,t,"allowClickBack",function(){return this._allowClickBack},function(t){this._allowClickBack!=t&&((this._allowClickBack=t)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),r(0,t,"max",function(){return this._max},function(t){this._max!=t&&(this._max=t,this.callLater(this.changeValue))}),r(0,t,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),r(0,t,"tick",function(){return this._tick},function(t){this._tick!=t&&(this._tick=t,this.callLater(this.changeValue))}),r(0,t,"sizeGrid",function(){return this._bg.sizeGrid},function(t){this._bg.sizeGrid=t,this._bar.sizeGrid=t,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),r(0,t,"min",function(){return this._min},function(t){this._min!=t&&(this._min=t,this.callLater(this.changeValue))}),r(0,t,"value",function(){return this._value},function(t){if(this._value!=t){var e=this._value;this._value=t,this.changeValue(),this._value!=e&&this.sendChangeEvent()}}),r(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.value=Number(t):p.superSet(L,this,"dataSource",t)}),r(0,t,"bar",function(){return this._bar}),n(i,["label",function(){return this.label=new z}]),i}(L),H=function(e){function i(t){this._bitmap=null,this._skin=null,this._group=null,i.__super.call(this),this.skin=t}a(i,"laya.ui.Image",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null},t.dispose=function(){this.destroy(!0),p.loader.clearRes(this._skin)},t.createChildren=function(){this.graphics=this._bitmap=new R,this._bitmap.autoCacheCmd=!1},t.setSource=function(t,e){t===this._skin&&e&&(this.source=e,this.onCompResize())},r(0,t,"source",function(){return this._bitmap.source},function(t){this._bitmap&&(this._bitmap.source=t,this.event("loaded"),this.repaint())}),r(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"string"==typeof(this._dataSource=t)?this.skin=t:p.superSet(L,this,"dataSource",t)}),r(0,t,"measureHeight",function(){return this._bitmap.height}),r(0,t,"skin",function(){return this._skin},function(t){if(this._skin!=t)if(this._skin=t){var e=f.getRes(t);e?(this.source=e,this.onCompResize()):p.loader.load(this._skin,_.create(this,this.setSource,[this._skin]),null,"image",1,!0,this._group)}else this.source=null}),r(0,t,"group",function(){return this._group},function(t){t&&this._skin&&f.setGroup(this._skin,t),this._group=t}),r(0,t,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=C.fillArray(b.defaultSizeGrid,t,Number)}),r(0,t,"measureWidth",function(){return this._bitmap.width}),r(0,t,"width",e.prototype._$get_width,function(t){p.superSet(L,this,"width",t),this._bitmap.width=0==t?1e-7:t}),r(0,t,"height",e.prototype._$get_height,function(t){p.superSet(L,this,"height",t),this._bitmap.height=0==t?1e-7:t}),i}(L),z=function(e){function i(t){this._tf=null,i.__super.call(this),void 0===t&&(t=""),h.defaultColor=b.labelColor,this.text=t}a(i,"laya.ui.Label",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._tf=null},t.createChildren=function(){this.addChild(this._tf=new T)},t.changeText=function(t){this._tf.changeText(t)},r(0,t,"padding",function(){return this._tf.padding.join(",")},function(t){this._tf.padding=C.fillArray(b.labelPadding,t,Number)}),r(0,t,"bold",function(){return this._tf.bold},function(t){this._tf.bold=t}),r(0,t,"align",function(){return this._tf.align},function(t){this._tf.align=t}),r(0,t,"text",function(){return this._tf.text},function(t){this._tf.text!=t&&(t&&(t=C.adptString(t+"")),this._tf.text=t,this.event("change"),this._width&&this._height||this.onCompResize())}),r(0,t,"italic",function(){return this._tf.italic},function(t){this._tf.italic=t}),r(0,t,"wordWrap",function(){return this._tf.wordWrap},function(t){this._tf.wordWrap=t}),r(0,t,"font",function(){return this._tf.font},function(t){this._tf.font=t}),r(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.text=t+"":p.superSet(L,this,"dataSource",t)}),r(0,t,"color",function(){return this._tf.color},function(t){this._tf.color=t}),r(0,t,"valign",function(){return this._tf.valign},function(t){this._tf.valign=t}),r(0,t,"leading",function(){return this._tf.leading},function(t){this._tf.leading=t}),r(0,t,"fontSize",function(){return this._tf.fontSize},function(t){this._tf.fontSize=t}),r(0,t,"bgColor",function(){return this._tf.bgColor},function(t){this._tf.bgColor=t}),r(0,t,"borderColor",function(){return this._tf.borderColor},function(t){this._tf.borderColor=t}),r(0,t,"stroke",function(){return this._tf.stroke},function(t){this._tf.stroke=t}),r(0,t,"strokeColor",function(){return this._tf.strokeColor},function(t){this._tf.strokeColor=t}),r(0,t,"textField",function(){return this._tf}),r(0,t,"measureWidth",function(){return this._tf.width}),r(0,t,"measureHeight",function(){return this._tf.height}),r(0,t,"width",function(){return this._width||this._tf.text?p.superGet(L,this,"width"):0},function(t){p.superSet(L,this,"width",t),this._tf.width=t}),r(0,t,"height",function(){return this._height||this._tf.text?p.superGet(L,this,"height"):0},function(t){p.superSet(L,this,"height",t),this._tf.height=t}),r(0,t,"overflow",function(){return this._tf.overflow},function(t){this._tf.overflow=t}),r(0,t,"underline",function(){return this._tf.underline},function(t){this._tf.underline=t}),r(0,t,"underlineColor",function(){return this._tf.underlineColor},function(t){this._tf.underlineColor=t}),i}(L),G=function(e){function i(t){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,i.__super.call(this),this.skin=t}a(i,"laya.ui.ProgressBar",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._bg&&this._bg.destroy(t),this._bar&&this._bar.destroy(t),this._bg=this._bar=null,this.changeHandler=null},t.createChildren=function(){this.addChild(this._bg=new H),this.addChild(this._bar=new H),this._bar._bitmap.autoCacheCmd=!1},t.changeValue=function(){if(this.sizeGrid){var t=this.sizeGrid.split(","),e=Number(t[3]),i=Number(t[1]),n=(this.width-e-i)*this._value;this._bar.width=e+i+n,this._bar.visible=this._bar.width>e+i}else this._bar.width=this.width*this._value},r(0,t,"measureHeight",function(){return this._bg.height}),r(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),r(0,t,"measureWidth",function(){return this._bg.width}),r(0,t,"height",e.prototype._$get_height,function(t){p.superSet(L,this,"height",t),this._bg.height=this._height,this._bar.height=this._height}),r(0,t,"bar",function(){return this._bar}),r(0,t,"value",function(){return this._value},function(t){this._value!=t&&(t=1<t?1:t<0?0:t,this._value=t,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith(t))}),r(0,t,"bg",function(){return this._bg}),r(0,t,"sizeGrid",function(){return this._bg.sizeGrid},function(t){this._bg.sizeGrid=this._bar.sizeGrid=t}),r(0,t,"width",e.prototype._$get_width,function(t){p.superSet(L,this,"width",t),this._bg.width=this._width,this.callLater(this.changeValue)}),r(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.value=Number(t):p.superSet(L,this,"dataSource",t)}),i}(L),W=(function(t){function i(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,i.__super.call(this),this._tipBox=new L,this._tipBox.addChild(this._tipText=new T),this._tipText.x=this._tipText.y=5,this._tipText.color=i.tipTextColor,this._defaultTipHandler=this._showDefaultTip,p.stage.on("showtip",this,this._onStageShowTip),p.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}a(i,"laya.ui.TipManager",L);var e=i.prototype;e._onStageHideTip=function(t){p.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},e._onStageShowTip=function(t){p.timer.once(i.tipDelay,this,this._showTip,[t],!0)},e._showTip=function(t){if("string"==typeof t){var e=String(t);Boolean(e)&&this._defaultTipHandler(e)}else t instanceof laya.utils.Handler?t.run():"function"==typeof t&&t.apply();p.stage.on("mousemove",this,this._onStageMouseMove),p.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},e._onStageMouseDown=function(t){this.closeAll()},e._onStageMouseMove=function(t){this._showToStage(this,i.offsetX,i.offsetY)},e._showToStage=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=t.getBounds();t.x=p.stage.mouseX+e,t.y=p.stage.mouseY+i,t.x+n.width>p.stage.width&&(t.x-=n.width+e),t.y+n.height>p.stage.height&&(t.y-=n.height+i)},e.closeAll=function(){p.timer.clear(this,this._showTip),p.stage.off("mousemove",this,this._onStageMouseMove),p.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},e.showDislayTip=function(t){this.addChild(t),this._showToStage(this),p._currentStage.addChild(this)},e._showDefaultTip=function(t){this._tipText.text=t;var e=this._tipBox.graphics;e.clear(),e.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,i.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),p._currentStage.addChild(this)},r(0,e,"defaultTipHandler",function(){return this._defaultTipHandler},function(t){this._defaultTipHandler=t}),i.offsetX=10,i.offsetY=15,i.tipTextColor="#ffffff",i.tipBackColor="#111111",i.tipDelay=200}(),function(t){var d;function f(){this._idMap=null,this._aniList=null,this._watchMap={},f.__super.call(this)}a(f,"laya.ui.View",P);var e=f.prototype;return e.createView=function(t){if(t.animations&&!this._idMap&&(this._idMap={}),f.createComp(t,this,this),t.animations){var e,i,n=[],r=t.animations,a=0,s=r.length;for(a=0;a<s;a++){switch(e=new u,i=r[a],e._setUp(this._idMap,i),(this[i.name]=e)._setControlNode(this),i.action){case 1:e.play(0,!1);break;case 2:e.play(0,!0)}n.push(e)}this._aniList=n}0<this._width&&null==t.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},e.onEvent=function(t,e){},e.loadUI=function(t){var e=f.uiMap[t];e&&this.createView(e)},e.destroy=function(t){void 0===t&&(t=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,t)},e.changeData=function(t){var e=this._watchMap[t];if(e){console.log("change",t);for(var i=0,n=e.length;i<n;i++){e[i].exe(this)}}},f._regs=function(){for(var t in f.uiClassMap)g.regClass(t,f.uiClassMap[t])},f.createComp=function(t,e,i,n){if(!(e=e||f.getCompInstance(t)))return console.warn("can not create:"+t.type),null;var r=t.child;if(r)for(var a=e instanceof laya.ui.List,s=0,o=r.length;s<o;s++){var l=r[s];if(!e.hasOwnProperty("itemRender")||"render"!=l.props.name&&"render"!==l.props.renderType)if("Graphic"==l.type)g.addGraphicsToSprite(l,e);else if(g.isDrawType(l.type))g.addGraphicToSprite(l,e,!0);else{if(a){var h=[],u=f.createComp(l,null,i,h);h.length&&(u._$bindData=h)}else u=f.createComp(l,null,i,n);"Script"==l.type?"owner"in u?u.owner=e:"target"in u&&(u.target=e):"mask"==l.props.renderType||"mask"==l.props.name?e.mask=u:u instanceof laya.display.Sprite&&e.addChild(u)}else e.itemRender=l}var c=t.props;for(var _ in c){var d=c[_];f.eventDic[_]?d&&i&&e.on(_,i,i.onEvent,[d]):f.setCompValue(e,_,d,i,n)}return p.__typeof(e,"laya.ui.IItem")&&e.initItems(),t.compId&&i&&i._idMap&&(i._idMap[t.compId]=e),e},f.setCompValue=function(t,e,i,n,r){if("string"==typeof i&&-1<i.indexOf("${")){if(f._sheet||(f._sheet=g.getClass("laya.data.Table")),!f._sheet)return void console.warn("Can not find class Sheet");if(r)r.push(t,e,i);else if(n){-1==i.indexOf("].")&&(i=i.replace(".","[0]."));var a,s,o=new d(t,e,i);o.exe(n);for(var l=i.replace(/\[.*?\]\./g,".");null!=(a=f._parseWatchData.exec(l));){for(var h=a[1];null!=(s=f._parseKeyWord.exec(h));){var u=s[0],c=n._watchMap[u]||(n._watchMap[u]=[]);c.push(o),f._sheet.I.notifer.on(u,n,n.changeData,[u])}(c=n._watchMap[h]||(n._watchMap[h]=[])).push(o),f._sheet.I.notifer.on(h,n,n.changeData,[h])}}}else if("var"===e&&n)n[i]=t;else if("onClick"==e){var _=m.window.eval("(function(){"+i+"})");t.on("click",n,_)}else t[e]="true"===i||"false"!==i&&i},f.getCompInstance=function(t){var e,i=t.props?t.props.runtime:null;return e=i?f.viewClassMap[i]||f.uiClassMap[i]||p.__classmap[i]:f.uiClassMap[t.type],t.props&&t.props.hasOwnProperty("renderType")&&"instance"==t.props.renderType?e.instance:e?new e:null},f.regComponent=function(t,e){f.uiClassMap[t]=e,g.regClass(t,e)},f.regViewRuntime=function(t,e){f.viewClassMap[t]=e},f.uiMap={},f.viewClassMap={},f._sheet=null,n(f,["uiClassMap",function(){return this.uiClassMap={ViewStack:et,LinkButton:N,TextArea:ut,ColorPicker:F,Box:P,Button:N,CheckBox:X,Clip:V,ComboBox:B,Component:L,HScrollBar:K,HSlider:J,Image:H,Label:z,List:Z,Panel:q,ProgressBar:G,Radio:$,RadioGroup:lt,ScrollBar:U,Slider:k,Tab:ht,TextInput:nt,View:f,VScrollBar:it,VSlider:rt,Tree:tt,HBox:st,VBox:ot,Sprite:E,Animation:i,Text:T,FontClip:j}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),f.__init$=function(){f._regs(),d=function(){function t(t,e,i){this.comp=null,this.prop=null,this.value=null,this.comp=t,this.prop=e,this.value=i}return a(t,""),t.prototype.exe=function(t){var e=C.getBindFun(this.value);this.comp[this.prop]=e.call(this,t)},t}()},f}()),X=function(t){function i(t,e){void 0===e&&(e=""),i.__super.call(this,t,e)}a(i,"laya.ui.CheckBox",t);var e=i.prototype;return e.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},e.initialize=function(){t.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},r(0,e,"dataSource",t.prototype._$get_dataSource,function(t){"boolean"==typeof(this._dataSource=t)?this.selected=t:"string"==typeof t?this.selected="true"===t:p.superSet(N,this,"dataSource",t)}),i}(N),Y=function(t){function e(){this._space=0,this._align="none",this._itemChanged=!1,e.__super.call(this)}a(e,"laya.ui.LayoutBox",P);var i=e.prototype;return i.addChild=function(t){return t.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,t)},i.onResize=function(t){this._setItemChanged()},i.addChildAt=function(t,e){return t.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,t,e)},i.removeChild=function(t){return t.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,t)},i.removeChildAt=function(t){return this.getChildAt(t).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,t)},i.refresh=function(){this._setItemChanged()},i.changeItems=function(){this._itemChanged=!1},i.sortItem=function(t){t&&t.sort(function(t,e){return t.y-e.y})},i._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},r(0,i,"space",function(){return this._space},function(t){this._space=t,this._setItemChanged()}),r(0,i,"align",function(){return this._align},function(t){this._align=t,this._setItemChanged()}),e}(),j=function(e){function i(t,e){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,i.__super.call(this),t&&(this.skin=t),e&&(this.sheet=e)}a(i,"laya.ui.FontClip",e);var t=i.prototype;return t.createChildren=function(){this._bitmap=new R,this.on("loaded",this,this._onClipLoaded)},t._onClipLoaded=function(){this.callLater(this.changeValue)},t.changeValue=function(){var t;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),t=this._sources[0]))){var e="horizontal"===this._direction;this._wordsH=e?(this._wordsW=this._valueArr.length*(t.sourceWidth+this.spaceX),t.sourceHeight):(this._wordsW=t.sourceWidth,(t.sourceHeight+this.spaceY)*this._valueArr.length);var i=0;if(this._width)switch(this._align){case"center":i=.5*(this._width-this._wordsW);break;case"right":i=this._width-this._wordsW;break;default:i=0}for(var n=0,r=this._valueArr.length;n<r;n++){var a=this._indexMap[this._valueArr.charAt(n)];this.sources[a]&&(t=this.sources[a],e?this.graphics.drawTexture(t,i+n*(t.sourceWidth+this.spaceX),0,t.sourceWidth,t.sourceHeight):this.graphics.drawTexture(t,0+i,n*(t.sourceHeight+this.spaceY),t.sourceWidth,t.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},t.destroy=function(t){void 0===t&&(t=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),e.prototype.destroy.call(this,t)},r(0,t,"sheet",function(){return this._sheet},function(t){t+="";var e=(this._sheet=t).split(" ");this._clipX=String(e[0]).length,this.clipY=e.length,this._indexMap={};for(var i=0;i<this._clipY;i++)for(var n=e[i].split(""),r=0,a=n.length;r<a;r++)this._indexMap[n[r]]=i*this._clipX+r}),r(0,t,"height",e.prototype._$get_height,function(t){p.superSet(V,this,"height",t),this.callLater(this.changeValue)}),r(0,t,"direction",function(){return this._direction},function(t){this._direction=t,this.callLater(this.changeValue)}),r(0,t,"value",function(){return this._valueArr?this._valueArr:""},function(t){t+="",this._valueArr=t,this.callLater(this.changeValue)}),r(0,t,"width",e.prototype._$get_width,function(t){p.superSet(V,this,"width",t),this.callLater(this.changeValue)}),r(0,t,"spaceX",function(){return this._spaceX},function(t){this._spaceX=t,"horizontal"===this._direction&&this.callLater(this.changeValue)}),r(0,t,"spaceY",function(){return this._spaceY},function(t){this._spaceY=t,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),r(0,t,"align",function(){return this._align},function(t){this._align=t,this.callLater(this.changeValue)}),r(0,t,"measureWidth",function(){return this._wordsW}),r(0,t,"measureHeight",function(){return this._wordsH}),i}(V),Z=function(t){function e(){this.selectHandler=null,this.renderHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,e.__super.call(this),this._cells=[],this._offset=new v}a(e,"laya.ui.List",t);var i=e.prototype;return p.imps(i,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),i.destroy=function(t){void 0===t&&(t=!0),this._content&&this._content.destroy(t),this._scrollBar&&this._scrollBar.destroy(t),laya.ui.Component.prototype.destroy.call(this,t),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this.selectHandler=this.renderHandler=this.mouseHandler=null},i.createChildren=function(){this.addChild(this._content=new P)},i.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=p.superGet(P,this,"cacheAs")),p.superSet(P,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},i.onScrollEnd=function(){p.superSet(P,this,"cacheAs",this._$P.cacheAs)},i._removePreScrollBar=function(){var t=this.removeChildByName("scrollBar");t&&t.destroy(!0)},i.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var t=this._getOneCell(),e=t.width+this._spaceX||1,i=t.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/e):Math.ceil(this._width/e)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/i):Math.round(this._height/i));var n=this._width?this._width:e*this.repeatX-this._spaceX,r=this._height?this._height:i*this.repeatY-this._spaceY;this._cellSize=this._isVertical?i:e,this._cellOffset=this._isVertical?i*Math.max(this._repeatY2,this._repeatY)-r-this._spaceY:e*Math.max(this._repeatX2,this._repeatX)-n-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=r:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=n),this.setContentSize(n,r);var a=this._isVertical?this.repeatX:this.repeatY,s=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,a,s),this._createdLine=s,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},i._getOneCell=function(){if(0===this._cells.length){var t=this.createItem();if(this._offset.setTo(t.x,t.y),this.cacheContent)return t;this._cells.push(t)}return this._cells[0]},i._createItems=function(t,e,i){var n=this._content,r=this._getOneCell(),a=r.width+this._spaceX,s=r.height+this._spaceY;if(this.cacheContent){var o=new P;o.cacheAsBitmap=!0,o.pos((this._isVertical?0:t)*a,(this._isVertical?t:0)*s),this._content.addChild(o),this._content.optimizeScrollRect=!0,n=o}else{for(var l=[],h=this._cells.length-1;-1<h;h--){var u=this._cells[h];u.removeSelf(),l.push(u)}this._cells.length=0}for(var c=t;c<i;c++)for(var _=0;_<e;_++)(r=l&&l.length?l.pop():this.createItem()).x=(this._isVertical?_:c)*a-n.x,r.y=(this._isVertical?c:_)*s-n.y,r.name="item"+(c*e+_),n.addChild(r),this.addCell(r)},i.createItem=function(){var t=[];if("function"==typeof this._itemRender)var e=new this._itemRender;else e=W.createComp(this._itemRender,null,null,t);if(0==t.length&&e._watchMap){var i=e._watchMap;for(var n in i)for(var r=i[n],a=0;a<r.length;a++){var s=r[a];t.push(s.comp,s.prop,s.value)}}return t.length&&(e._$bindData=t),e},i.addCell=function(t){t.on("click",this,this.onCellMouse),t.on("rightclick",this,this.onCellMouse),t.on("mouseover",this,this.onCellMouse),t.on("mouseout",this,this.onCellMouse),t.on("mousedown",this,this.onCellMouse),t.on("mouseup",this,this.onCellMouse),this._cells.push(t)},i.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var t=0,e=t=0;e<1e4;e++){var i=this.getChildByName("item"+e);if(!i)break;this.addCell(i),t++}this.repeatY=t}},i.setContentSize=function(t,e){this._content.width=t,this._content.height=e,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new y),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,t,e),this._content.scrollRect=this._content.scrollRect),this.event("resize")},i.onCellMouse=function(t){"mousedown"===t.type&&(this._isMoved=!1);var e=t.currentTarget,i=this._startIndex+this._cells.indexOf(e);i<0||("click"===t.type||"rightclick"===t.type?this.selectEnable&&!this._isMoved?this.selectedIndex=i:this.changeCellState(e,!0,0):"mouseover"!==t.type&&"mouseout"!==t.type||this._selectedIndex===i||this.changeCellState(e,"mouseover"===t.type,0),this.mouseHandler&&this.mouseHandler.runWith([t,i]))},i.changeCellState=function(t,e,i){var n=t.getChildByName("selectBox");n&&(this.selectEnable=!0,n.visible=e,n.index=i)},i.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},i.onScrollBarChange=function(t){this.runCallLater(this.changeCells);var e=this._scrollBar.value,i=this._isVertical?this.repeatX:this.repeatY,n=this._isVertical?this.repeatY:this.repeatX,r=Math.floor(e/this._cellSize);if(this.cacheContent)s=n+1,this._createdLine-r<s&&(this._createItems(this._createdLine,i,this._createdLine+s),this.renderItems(this._createdLine*i,0),this._createdLine+=s);else{var a=r*i,s=0;if(a>this._startIndex){s=a-this._startIndex;var o=!0,l=this._startIndex+i*(n+1);this._isMoved=!0}else a<this._startIndex&&(s=this._startIndex-a,o=!1,l=this._startIndex-1,this._isMoved=!0);for(var h=0;h<s;h++){if(o){var u=this._cells.shift();this._cells[this._cells.length]=u;var c=l+h}else u=this._cells.pop(),this._cells.unshift(u),c=l-h;var _=Math.floor(c/i)*this._cellSize;this._isVertical?u.y=_:u.x=_,this.renderItem(u,c)}this._startIndex=a,this.changeSelectStatus()}var d=this._content.scrollRect;this._isVertical?(d.y=e-this._offset.y,d.x=-this._offset.x):(d.y=-this._offset.y,d.x=e-this._offset.x),this._content.scrollRect=d},i.posCell=function(t,e){if(this._scrollBar){var i=this._isVertical?this.repeatX:this.repeatY,n=(this._isVertical?this.repeatY:this.repeatX,Math.floor(e/i)*this._cellSize);this._isVertical?t.y=n:t.x=n}},i.changeSelectStatus=function(){for(var t=0,e=this._cells.length;t<e;t++)this.changeCellState(this._cells[t],this._selectedIndex===this._startIndex+t,1)},i.renderItems=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);for(var i=t,n=e||this._cells.length;i<n;i++)this.renderItem(this._cells[i],this._startIndex+i);this.changeSelectStatus()},i.renderItem=function(t,e){this._array&&0<=e&&e<this._array.length?(t.visible=!0,t._$bindData?(t._dataSource=this._array[e],this._bindData(t,this._array[e])):t.dataSource=this._array[e],this.cacheContent||this.posCell(t,e),this.hasListener("render")&&this.event("render",[t,e]),this.renderHandler&&this.renderHandler.runWith([t,e])):(t.visible=!1,t.dataSource=null)},i._bindData=function(t,e){for(var i=t._$bindData,n=0,r=i.length;n<r;n++){var a=i[n++],s=i[n++],o=i[n],l=C.getBindFun(o);a[s]=l.call(this,e)}},i.refresh=function(){this.array=this._array},i.getItem=function(t){return-1<t&&t<this._array.length?this._array[t]:null},i.changeItem=function(t,e){-1<t&&t<this._array.length&&(this._array[t]=e,t>=this._startIndex&&t<this._startIndex+this._cells.length&&this.renderItem(this.getCell(t),t))},i.setItem=function(t,e){this.changeItem(t,e)},i.addItem=function(t){this._array.push(t),this.array=this._array},i.addItemAt=function(t,e){this._array.splice(e,0,t),this.array=this._array},i.deleteItem=function(t){this._array.splice(t,1),this.array=this._array},i.getCell=function(t){return this.runCallLater(this.changeCells),-1<t&&this._cells?this._cells[(t-this._startIndex)%this._cells.length]:null},i.scrollTo=function(t){if(this._scrollBar){var e=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(t/e)*this._cellSize}else this.startIndex=t},i.tweenTo=function(t,e,i){if(void 0===e&&(e=200),this._scrollBar){var n=this._isVertical?this.repeatX:this.repeatY;w.to(this._scrollBar,{value:Math.floor(t/n)*this._cellSize},e,null,i,0,!0)}else this.startIndex=t,i&&i.run()},i._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},i.commitMeasure=function(){this.runCallLater(this.changeCells)},r(0,i,"cacheAs",t.prototype._$get_cacheAs,function(t){p.superSet(P,this,"cacheAs",t),this._scrollBar&&(this._$P.cacheAs=null,"none"!==t?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),r(0,i,"content",function(){return this._content}),r(0,i,"height",t.prototype._$get_height,function(t){t!=this._height&&(p.superSet(P,this,"height",t),this._setCellChanged())}),r(0,i,"itemRender",function(){return this._itemRender},function(t){if(this._itemRender!=t){this._itemRender=t;for(var e=this._cells.length-1;-1<e;e--)this._cells[e].destroy();this._cells.length=0,this._setCellChanged()}}),r(0,i,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(t){this._removePreScrollBar();var e=new it;e.name="scrollBar",e.right=0,t&&" "!=t&&(e.skin=t),this.scrollBar=e,this.addChild(e),this._setCellChanged()}),r(0,i,"page",function(){return this._page},function(t){this._page=t,this._array&&(this._page=0<t?t:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),r(0,i,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(t){this._removePreScrollBar();var e=new K;e.name="scrollBar",e.bottom=0,t&&" "!=t&&(e.skin=t),this.scrollBar=e,this.addChild(e),this._setCellChanged()}),r(0,i,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function(t){this._repeatX=t,this._setCellChanged()}),r(0,i,"scrollBar",function(){return this._scrollBar},function(t){this._scrollBar!=t&&(this._scrollBar=t)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),r(0,i,"width",t.prototype._$get_width,function(t){t!=this._width&&(p.superSet(P,this,"width",t),this._setCellChanged())}),r(0,i,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function(t){this._repeatY=t,this._setCellChanged()}),r(0,i,"spaceX",function(){return this._spaceX},function(t){this._spaceX=t,this._setCellChanged()}),r(0,i,"spaceY",function(){return this._spaceY},function(t){this._spaceY=t,this._setCellChanged()}),r(0,i,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this._selectedIndex=t,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith(t),this.startIndex=this._startIndex)}),r(0,i,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function(t){this.selectedIndex=this._array.indexOf(t)}),r(0,i,"length",function(){return this._array?this._array.length:0}),r(0,i,"selection",function(){return this.getCell(this._selectedIndex)},function(t){this.selectedIndex=this._startIndex+this._cells.indexOf(t)}),r(0,i,"startIndex",function(){return this._startIndex},function(t){this._startIndex=0<t?t:0,this.callLater(this.renderItems)}),r(0,i,"array",function(){return this._array},function(t){this.runCallLater(this.changeCells),this._array=t||[];var e=this._array.length;if(this.totalPage=Math.ceil(e/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<e?this._selectedIndex:e-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var i=this._isVertical?this.repeatX:this.repeatY,n=this._isVertical?this.repeatY:this.repeatX,r=Math.ceil(e/i),a=0<this._cellOffset?this.totalPage+1:this.totalPage;this._scrollBar.target=(1<a?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=n/r,this._scrollBar.setScroll(0,(r-n)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._content)}}),r(0,i,"dataSource",t.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t?this.selectedIndex=parseInt(t):t instanceof Array?this.array=t:p.superSet(P,this,"dataSource",t)}),r(0,i,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),e}(P),K=function(t){function e(){e.__super.call(this)}return a(e,"laya.ui.HScrollBar",t),e.prototype.initialize=function(){t.prototype.initialize.call(this),this.slider.isVertical=!1},e}(U),q=function(t){function e(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,e.__super.call(this),this.width=this.height=100}a(e,"laya.ui.Panel",t);var i=e.prototype;return i.destroy=function(t){void 0===t&&(t=!0),laya.ui.Component.prototype.destroy.call(this,t),this._content&&this._content.destroy(t),this._vScrollBar&&this._vScrollBar.destroy(t),this._hScrollBar&&this._hScrollBar.destroy(t),this._vScrollBar=null,this._hScrollBar=null,this._content=null},i.destroyChildren=function(){this._content.destroyChildren()},i.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new P)},i.addChild=function(t){return t.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild(t)},i.onResize=function(){this._setScrollChanged()},i.addChildAt=function(t,e){return t.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt(t,e)},i.removeChild=function(t){return t.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild(t)},i.removeChildAt=function(t){return this.getChildAt(t).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt(t)},i.removeChildren=function(t,e){void 0===t&&(t=0),void 0===e&&(e=2147483647);for(var i=this._content.numChildren-1;-1<i;i--)this._content.removeChildAt(i);return this._setScrollChanged(),this},i.getChildAt=function(t){return this._content.getChildAt(t)},i.getChildByName=function(t){return this._content.getChildByName(t)},i.getChildIndex=function(t){return this._content.getChildIndex(t)},i.changeScroll=function(){this._scrollChanged=!1;var t=this.contentWidth||1,e=this.contentHeight||1,i=this._vScrollBar,n=this._hScrollBar,r=i&&e>this._height,a=n&&t>this._width,s=r?this._width-i.width:this._width,o=a?this._height-n.height:this._height;i&&(i.x=this._width-i.width,i.y=0,i.height=this._height-(a?n.height:0),i.scrollSize=Math.max(.033*this._height,1),i.thumbPercent=o/e,i.setScroll(0,e-o,i.value)),n&&(n.x=0,n.y=this._height-n.height,n.width=this._width-(r?i.width:0),n.scrollSize=Math.max(.033*this._width,1),n.thumbPercent=s/t,n.setScroll(0,t-s,n.value))},i.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},i.setContentSize=function(t,e){var i=this._content;i.width=t,i.height=e,i.scrollRect||(i.scrollRect=new y),i.scrollRect.setTo(0,0,t,e),i.scrollRect=i.scrollRect},i.onScrollBarChange=function(t){var e=this._content.scrollRect;if(e){var i=Math.round(t.value);t.isVertical?e.y=i:e.x=i,this._content.scrollRect=e}},i.scrollTo=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.vScrollBar&&(this.vScrollBar.value=e),this.hScrollBar&&(this.hScrollBar.value=t)},i.refresh=function(){this.changeScroll()},i.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=p.superGet(P,this,"cacheAs")),p.superSet(P,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},i.onScrollEnd=function(){p.superSet(P,this,"cacheAs",this._$P.cacheAs)},i._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},r(0,i,"numChildren",function(){return this._content.numChildren}),r(0,i,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(t){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new K),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=t}),r(0,i,"contentWidth",function(){for(var t=0,e=this._content.numChildren-1;-1<e;e--){var i=this._content.getChildAt(e);t=Math.max(i.x+i.width*i.scaleX,t)}return t}),r(0,i,"contentHeight",function(){for(var t=0,e=this._content.numChildren-1;-1<e;e--){var i=this._content.getChildAt(e);t=Math.max(i.y+i.height*i.scaleY,t)}return t}),r(0,i,"width",t.prototype._$get_width,function(t){p.superSet(P,this,"width",t),this._setScrollChanged()}),r(0,i,"hScrollBar",function(){return this._hScrollBar}),r(0,i,"content",function(){return this._content}),r(0,i,"height",t.prototype._$get_height,function(t){p.superSet(P,this,"height",t),this._setScrollChanged()}),r(0,i,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(t){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new it),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=t}),r(0,i,"vScrollBar",function(){return this._vScrollBar}),r(0,i,"cacheAs",t.prototype._$get_cacheAs,function(t){p.superSet(P,this,"cacheAs",t),this._$P.cacheAs=null,"none"!==t?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),e}(P),Q=function(t){function i(t,e){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,i.__super.call(this),this.skin=e,this.labels=t}a(i,"laya.ui.UIGroup",t);var e=i.prototype;return p.imps(e,{"laya.ui.IItem":!0}),e.preinitialize=function(){this.mouseEnabled=!0},e.destroy=function(t){void 0===t&&(t=!0),laya.ui.Component.prototype.destroy.call(this,t),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},e.addItem=function(t,e){void 0===e&&(e=!0);var i=t,n=this._items.length;if(i.name="item"+n,this.addChild(i),this.initItems(),e&&0<n){var r=this._items[n-1];"horizontal"==this._direction?i.x=r.x+r.width+this._space:i.y=r.y+r.height+this._space}else e&&(i.x=0,i.y=0);return n},e.delItem=function(t,e){void 0===e&&(e=!0);var i=this._items.indexOf(t);if(-1!=i){var n=t;this.removeChild(n);for(var r=i+1,a=this._items.length;r<a;r++){var s=this._items[r];s.name="item"+(r-1),e&&("horizontal"==this._direction?s.x-=n.width+this._space:s.y-=n.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var o;o=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=o}}},e.initItems=function(){this._items||(this._items=[]);for(var t=this._items.length=0;t<1e4;t++){var e=this.getChildByName("item"+t);if(null==e)break;this._items.push(e),e.selected=t===this._selectedIndex,e.clickHandler=_.create(this,this.itemClick,[t],!1)}},e.itemClick=function(t){this.selectedIndex=t},e.setSelect=function(t,e){this._items&&-1<t&&t<this._items.length&&(this._items[t].selected=e)},e.createItem=function(t,e){return null},e.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var t=0,e=0,i=this._items.length;e<i;e++){var n=this._items[e];this._skin&&(n.skin=this._skin),this._labelColors&&(n.labelColors=this._labelColors),this._labelSize&&(n.labelSize=this._labelSize),this._labelStroke&&(n.labelStroke=this._labelStroke),this._labelStrokeColor&&(n.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&(n.strokeColors=this._strokeColors),this._labelBold&&(n.labelBold=this._labelBold),this._labelPadding&&(n.labelPadding=this._labelPadding),this._labelAlign&&(n.labelAlign=this._labelAlign),this._stateNum&&(n.stateNum=this._stateNum),this._labelFont&&(n.labelFont=this._labelFont),"horizontal"===this._direction?(n.y=0,n.x=t,t+=n.width+this._space):(n.x=0,n.y=t,t+=n.height+this._space)}this.changeSize()},e.commitMeasure=function(){this.runCallLater(this.changeLabels)},e._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},r(0,e,"labelStrokeColor",function(){return this._labelStrokeColor},function(t){this._labelStrokeColor!=t&&(this._labelStrokeColor=t,this._setLabelChanged())}),r(0,e,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this._setLabelChanged())}),r(0,e,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=t,this.setSelect(t,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),r(0,e,"labels",function(){return this._labels},function(t){if(this._labels!=t){if(this._labels=t,this.removeChildren(),this._setLabelChanged(),this._labels)for(var e=this._labels.split(","),i=0,n=e.length;i<n;i++){var r=this.createItem(this._skin,e[i]);r.name="item"+i,this.addChild(r)}this.initItems()}}),r(0,e,"strokeColors",function(){return this._strokeColors},function(t){this._strokeColors!=t&&(this._strokeColors=t,this._setLabelChanged())}),r(0,e,"labelColors",function(){return this._labelColors},function(t){this._labelColors!=t&&(this._labelColors=t,this._setLabelChanged())}),r(0,e,"labelStroke",function(){return this._labelStroke},function(t){this._labelStroke!=t&&(this._labelStroke=t,this._setLabelChanged())}),r(0,e,"labelSize",function(){return this._labelSize},function(t){this._labelSize!=t&&(this._labelSize=t,this._setLabelChanged())}),r(0,e,"stateNum",function(){return this._stateNum},function(t){this._stateNum!=t&&(this._stateNum=t,this._setLabelChanged())}),r(0,e,"labelBold",function(){return this._labelBold},function(t){this._labelBold!=t&&(this._labelBold=t,this._setLabelChanged())}),r(0,e,"labelFont",function(){return this._labelFont},function(t){this._labelFont!=t&&(this._labelFont=t,this._setLabelChanged())}),r(0,e,"labelPadding",function(){return this._labelPadding},function(t){this._labelPadding!=t&&(this._labelPadding=t,this._setLabelChanged())}),r(0,e,"direction",function(){return this._direction},function(t){this._direction=t,this._setLabelChanged()}),r(0,e,"space",function(){return this._space},function(t){this._space=t,this._setLabelChanged()}),r(0,e,"items",function(){return this._items}),r(0,e,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(t){this.selectedIndex=this._items.indexOf(t)}),r(0,e,"dataSource",t.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t?this.selectedIndex=parseInt(t):t instanceof Array?this.labels=t.join(","):p.superSet(P,this,"dataSource",t)}),i}(P),J=function(t){function e(t){e.__super.call(this,t),this.isVertical=!1}return a(e,"laya.ui.HSlider",k),e}(),$=function(e){function i(t,e){this._value=null,void 0===e&&(e=""),i.__super.call(this,t,e)}a(i,"laya.ui.Radio",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._value=null},t.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},t.initialize=function(){e.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},t.onClick=function(t){this.selected=!0},r(0,t,"value",function(){return null!=this._value?this._value:this.label},function(t){this._value=t}),i}(N),tt=function(t){function e(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,e.__super.call(this),this.width=this.height=200}a(e,"laya.ui.Tree",t);var i=e.prototype;return p.imps(i,{"laya.ui.IRender":!0}),i.destroy=function(t){void 0===t&&(t=!0),laya.ui.Component.prototype.destroy.call(this,t),this._list&&this._list.destroy(t),this._list=null,this._source=null,this._renderHandler=null},i.createChildren=function(){this.addChild(this._list=new Z),this._list.renderHandler=_.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},i.onListChange=function(t){this.event("change")},i.getArray=function(){var t,e=[];for(var i in this._source)t=this._source[i],this.getParentOpenStatus(t)&&(t.x=this._spaceLeft*this.getDepth(t),e.push(t));return e},i.getDepth=function(t,e){return void 0===e&&(e=0),null==t.nodeParent?e:this.getDepth(t.nodeParent,e+1)},i.getParentOpenStatus=function(t){var e=t.nodeParent;return null==e||!!e.isOpen&&(null==e.nodeParent||this.getParentOpenStatus(e))},i.renderItem=function(t,e){var i=t.dataSource;if(i){t.left=i.x;var n=t.getChildByName("arrow");n&&(i.hasChild?(n.visible=!0,n.index=i.isOpen?1:0,n.tag=e,n.off("click",this,this.onArrowClick),n.on("click",this,this.onArrowClick)):n.visible=!1);var r=t.getChildByName("folder");r&&(2==r.clipY?r.index=i.isDirectory?0:1:r.index=i.isDirectory?i.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([t,e])}},i.onArrowClick=function(t){var e=t.currentTarget.tag;this._list.array[e].isOpen=!this._list.array[e].isOpen,this.event("open"),this._list.array=this.getArray()},i.setItemState=function(t,e){this._list.array[t]&&(this._list.array[t].isOpen=e,this._list.array=this.getArray())},i.fresh=function(){this._list.array=this.getArray(),this.repaint()},i.parseXml=function(t,e,i,n){var r,a=t.childNodes,s=a.length;if(!n){r={};var o,l=t.attributes;for(var h in l){var u=(o=l[h]).nodeName,c=o.nodeValue;r[u]="true"==c||"false"!=c&&c}r.nodeParent=i,0<s&&(r.isDirectory=!0),r.hasChild=0<s,e.push(r)}for(var _=0;_<s;_++){var d=a[_];this.parseXml(d,e,r,!1)}},i.parseOpenStatus=function(t,e){for(var i=0,n=e.length;i<n;i++){var r=e[i];if(r.isDirectory)for(var a=0,s=t.length;a<s;a++){var o=t[a];if(o.isDirectory&&this.isSameParent(o,r)&&r.label==o.label){r.isOpen=o.isOpen;break}}}},i.isSameParent=function(t,e){return null==t.nodeParent&&null==e.nodeParent||null!=t.nodeParent&&null!=e.nodeParent&&(t.nodeParent.label==e.nodeParent.label&&this.isSameParent(t.nodeParent,e.nodeParent))},i.filter=function(t){if(Boolean(t)){var e=[];this.getFilterSource(this._source,e,t),this._list.array=e}else this._list.array=this.getArray()},i.getFilterSource=function(t,e,i){var n;for(var r in i=i.toLocaleLowerCase(),t)!(n=t[r]).isDirectory&&-1<String(n.label).toLowerCase().indexOf(i)&&(n.x=0,e.push(n)),n.child&&0<n.child.length&&this.getFilterSource(n.child,e,i)},r(0,i,"spaceBottom",function(){return this._list.spaceY},function(t){this._list.spaceY=t}),r(0,i,"keepStatus",function(){return this._keepStatus},function(t){this._keepStatus=t}),r(0,i,"itemRender",function(){return this._list.itemRender},function(t){this._list.itemRender=t}),r(0,i,"array",function(){return this._list.array},function(t){this._keepStatus&&this._list.array&&t&&this.parseOpenStatus(this._list.array,t),this._source=t,this._list.array=this.getArray()}),r(0,i,"mouseHandler",function(){return this._list.mouseHandler},function(t){this._list.mouseHandler=t}),r(0,i,"dataSource",t.prototype._$get_dataSource,function(t){this._dataSource=t,p.superSet(P,this,"dataSource",t)}),r(0,i,"source",function(){return this._source}),r(0,i,"scrollBar",function(){return this._list.scrollBar}),r(0,i,"list",function(){return this._list}),r(0,i,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function(t){this._list.vScrollBarSkin=t}),r(0,i,"renderHandler",function(){return this._renderHandler},function(t){this._renderHandler=t}),r(0,i,"selectedIndex",function(){return this._list.selectedIndex},function(t){this._list.selectedIndex=t}),r(0,i,"spaceLeft",function(){return this._spaceLeft},function(t){this._spaceLeft=t}),r(0,i,"selectedItem",function(){return this._list.selectedItem},function(t){this._list.selectedItem=t}),r(0,i,"width",t.prototype._$get_width,function(t){p.superSet(P,this,"width",t),this._list.width=t}),r(0,i,"height",t.prototype._$get_height,function(t){p.superSet(P,this,"height",t),this._list.height=t}),r(0,i,"xml",null,function(t){var e=[];this.parseXml(t.childNodes[0],e,null,!0),this.array=e}),r(0,i,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),e}(P),et=function(t){function e(){this._items=null,this._selectedIndex=0,e.__super.call(this),this._setIndexHandler=_.create(this,this.setIndex,null,!1)}a(e,"laya.ui.ViewStack",t);var i=e.prototype;return p.imps(i,{"laya.ui.IItem":!0}),i.setItems=function(t){this.removeChildren();for(var e=0,i=0,n=t.length;i<n;i++){var r=t[i];r&&(r.name="item"+e,this.addChild(r),e++)}this.initItems()},i.addItem=function(t){t.name="item"+this._items.length,this.addChild(t),this.initItems()},i.initItems=function(){this._items=[];for(var t=0;t<1e4;t++){var e=this.getChildByName("item"+t);if(null==e)break;this._items.push(e),e.visible=t==this._selectedIndex}},i.setSelect=function(t,e){this._items&&-1<t&&t<this._items.length&&(this._items[t].visible=e)},i.setIndex=function(t){this.selectedIndex=t},r(0,i,"dataSource",t.prototype._$get_dataSource,function(t){if("number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t)this.selectedIndex=parseInt(t);else for(var e in this._dataSource)this.hasOwnProperty(e)&&(this[e]=this._dataSource[e])}),r(0,i,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=t,this.setSelect(this._selectedIndex,!0))}),r(0,i,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(t){this.selectedIndex=this._items.indexOf(t)}),r(0,i,"items",function(){return this._items}),r(0,i,"setIndexHandler",function(){return this._setIndexHandler},function(t){this._setIndexHandler=t}),e}(P),it=function(t){function e(){e.__super.call(this)}return a(e,"laya.ui.VScrollBar",U),e}(),nt=function(e){function i(t){this._bg=null,this._skin=null,i.__super.call(this),void 0===t&&(t=""),this.text=t,this.skin=this.skin}a(i,"laya.ui.TextInput",e);var t=i.prototype;return t.preinitialize=function(){this.mouseEnabled=!0},t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._bg&&this._bg.destroy(),this._bg=null},t.createChildren=function(){this.addChild(this._tf=new d),this._tf.padding=b.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},t._onFocus=function(){this.event("focus",this)},t._onBlur=function(){this.event("blur",this)},t._onInput=function(){this.event("input",this)},t._onEnter=function(){this.event("enter",this)},t.initialize=function(){this.width=128,this.height=22},t.select=function(){this._tf.select()},t.setSelection=function(t,e){this._tf.setSelection(t,e)},r(0,t,"text",e.prototype._$get_text,function(t){this._tf.text!=t&&(t+="",this._tf.text=t,this.event("change"))}),r(0,t,"bg",function(){return this._bg},function(t){this.graphics=this._bg=t}),r(0,t,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function(t){this._tf.inputElementYAdjuster=t}),r(0,t,"multiline",function(){return this._tf.multiline},function(t){this._tf.multiline=t}),r(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this._bg||(this.graphics=this._bg=new R),this._bg.source=f.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),r(0,t,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function(t){this._bg||(this.graphics=this._bg=new R),this._bg.sizeGrid=C.fillArray(b.defaultSizeGrid,t,Number)}),r(0,t,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function(t){this._tf.inputElementXAdjuster=t}),r(0,t,"width",e.prototype._$get_width,function(t){p.superSet(z,this,"width",t),this._bg&&(this._bg.width=t)}),r(0,t,"height",e.prototype._$get_height,function(t){p.superSet(z,this,"height",t),this._bg&&(this._bg.height=t)}),r(0,t,"editable",function(){return this._tf.editable},function(t){this._tf.editable=t}),r(0,t,"restrict",function(){return this._tf.restrict},function(t){this._tf.restrict=t}),r(0,t,"prompt",function(){return this._tf.prompt},function(t){this._tf.prompt=t}),r(0,t,"promptColor",function(){return this._tf.promptColor},function(t){this._tf.promptColor=t}),r(0,t,"maxChars",function(){return this._tf.maxChars},function(t){this._tf.maxChars=t}),r(0,t,"focus",function(){return this._tf.focus},function(t){this._tf.focus=t}),r(0,t,"type",function(){return this._tf.type},function(t){this._tf.type=t}),r(0,t,"asPassword",function(){return this._tf.asPassword},function(t){this._tf.asPassword=t}),i}(z),rt=function(t){function e(){e.__super.call(this)}return a(e,"laya.ui.VSlider",k),e}(),at=function(t){function n(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,n.__super.call(this)}a(n,"laya.ui.Dialog",t);var e=n.prototype;return e.initialize=function(){this.popupEffect=n.manager.popupEffectHandler,this.closeEffect=n.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},e._dealDragArea=function(){var t=this.getChildByName("drag");t&&(this.dragArea=t.x+","+t.y+","+t.width+","+t.height,t.removeSelf())},e._onClick=function(t){var e=t.target;if(e)switch(e.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close(e.name)}},e.show=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!0),this._open(!1,t,e)},e.popup=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!0),this._open(!0,t,e)},e._open=function(t,e,i){n.manager.lock(!1),this.isModal=t,n.manager.open(this,e,i)},e.onOpened=function(){},e.close=function(t,e){void 0===e&&(e=!0),n.manager.close(this,t,e)},e.onClosed=function(t){},e._onMouseDown=function(t){var e=this.getMousePoint();this._dragArea.contains(e.x,e.y)?this.startDrag():this.stopDrag()},r(0,e,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function(t){if(t){var e=C.fillArray([0,0,0,0],t,Number);this._dragArea=new y(e[0],e[1],e[2],e[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),r(0,e,"isPopup",function(){return null!=this.parent}),r(0,e,"zOrder",t.prototype._$get_zOrder,function(t){p.superSet(W,this,"zOrder",t),n.manager._checkMask()}),r(1,n,"manager",function(){return n._manager=n._manager||new O},function(t){n._manager=t}),n.setLockView=function(t){n.manager.setLockView(t)},n.lock=function(t){n.manager.lock(t)},n.closeAll=function(){n.manager.closeAll()},n.getDialogsByGroup=function(t){return n.manager.getDialogsByGroup(t)},n.closeByGroup=function(t){return n.manager.closeByGroup(t)},n.CLOSE="close",n.CANCEL="cancel",n.SURE="sure",n.NO="no",n.OK="ok",n.YES="yes",n._manager=null,n}(W),st=function(t){function e(){e.__super.call(this)}a(e,"laya.ui.HBox",t);var i=e.prototype;return i.sortItem=function(t){t&&t.sort(function(t,e){return t.x-e.x})},i.changeItems=function(){this._itemChanged=!1;for(var t=[],e=0,i=0,n=this.numChildren;i<n;i++){var r=this.getChildAt(i);r&&r.layoutEnabled&&(t.push(r),e=this._height?this._height:Math.max(e,r.height*r.scaleY))}this.sortItem(t);var a=0;for(i=0,n=t.length;i<n;i++)(r=t[i]).x=a,a+=r.width*r.scaleX+this._space,"top"==this._align?r.y=0:"middle"==this._align?r.y=.5*(e-r.height*r.scaleY):"bottom"==this._align&&(r.y=e-r.height*r.scaleY);this.changeSize()},r(0,i,"height",t.prototype._$get_height,function(t){this._height!=t&&(p.superSet(Y,this,"height",t),this.callLater(this.changeItems))}),e.NONE="none",e.TOP="top",e.MIDDLE="middle",e.BOTTOM="bottom",e}(Y),ot=function(t){function e(){e.__super.call(this)}a(e,"laya.ui.VBox",t);var i=e.prototype;return i.changeItems=function(){this._itemChanged=!1;for(var t=[],e=0,i=0,n=this.numChildren;i<n;i++){var r=this.getChildAt(i);r&&r.layoutEnabled&&(t.push(r),e=this._width?this._width:Math.max(e,r.width*r.scaleX))}this.sortItem(t);var a=0;for(i=0,n=t.length;i<n;i++)(r=t[i]).y=a,a+=r.height*r.scaleY+this._space,"left"==this._align?r.x=0:"center"==this._align?r.x=.5*(e-r.width*r.scaleX):"right"==this._align&&(r.x=e-r.width*r.scaleX);this.changeSize()},r(0,i,"width",t.prototype._$get_width,function(t){this._width!=t&&(p.superSet(Y,this,"width",t),this.callLater(this.changeItems))}),e.NONE="none",e.LEFT="left",e.CENTER="center",e.RIGHT="right",e}(Y),lt=function(t){function e(){e.__super.call(this)}return a(e,"laya.ui.RadioGroup",Q),e.prototype.createItem=function(t,e){return new $(t,e)},e}(),ht=function(t){function e(){e.__super.call(this)}return a(e,"laya.ui.Tab",Q),e.prototype.createItem=function(t,e){return new N(t,e)},e}(),ut=function(e){function i(t){this._vScrollBar=null,this._hScrollBar=null,void 0===t&&(t=""),i.__super.call(this,t)}a(i,"laya.ui.TextArea",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},t.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},t.onVBarChanged=function(t){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},t.onHBarChanged=function(t){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},t.changeScroll=function(){var t=this._vScrollBar&&0<this._tf.maxScrollY,e=this._hScrollBar&&0<this._tf.maxScrollX,i=t?this._width-this._vScrollBar.width:this._width,n=e?this._height-this._hScrollBar.height:this._height,r=this._tf.padding||b.labelPadding;this._tf.width=i,this._tf.height=n,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-r[2],this._vScrollBar.y=r[1],this._vScrollBar.height=this._height-(e?this._hScrollBar.height:0)-r[1]-r[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=n/Math.max(this._tf.textHeight,n),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=t),this._hScrollBar&&(this._hScrollBar.x=r[0],this._hScrollBar.y=this._height-this._hScrollBar.height-r[3],this._hScrollBar.width=this._width-(t?this._vScrollBar.width:0)-r[0]-r[2],this._hScrollBar.scrollSize=Math.max(.033*i,1),this._hScrollBar.thumbPercent=i/Math.max(this._tf.textWidth,i),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=e)},t.scrollTo=function(t){this.commitMeasure(),this._tf.scrollY=t},r(0,t,"scrollY",function(){return this._tf.scrollY}),r(0,t,"width",e.prototype._$get_width,function(t){p.superSet(nt,this,"width",t),this.callLater(this.changeScroll)}),r(0,t,"hScrollBar",function(){return this._hScrollBar}),r(0,t,"height",e.prototype._$get_height,function(t){p.superSet(nt,this,"height",t),this.callLater(this.changeScroll)}),r(0,t,"maxScrollX",function(){return this._tf.maxScrollX}),r(0,t,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(t){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new it),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=t}),r(0,t,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(t){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new K),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=t}),r(0,t,"vScrollBar",function(){return this._vScrollBar}),r(0,t,"maxScrollY",function(){return this._tf.maxScrollY}),r(0,t,"scrollX",function(){return this._tf.scrollX}),i}(nt);!function(t){function e(){this._uiView=null,this.isCloseOther=!1,e.__super.call(this)}a(e,"laya.ui.AsynDialog",at);var i=e.prototype;i.createView=function(t){this._uiView=t},i._open=function(t,e,i){this.isModal=t,this.isCloseOther=e,at.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},i.onCreated=function(){this.createUI(),this.onOpen()},i.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},i.onOpen=function(){at.manager.open(this,this.isCloseOther),at.manager.lock(!1)},i.close=function(t,e){void 0===e&&(e=!0),at.manager.close(this),this.onClose()},i.onClose=function(){},i.destroy=function(t){void 0===t&&(t=!0),laya.ui.View.prototype.destroy.call(this,t),this._uiView=null,this.onDestroy()},i.onDestroy=function(){}}();p.__init([W])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}),function(t,e,S){S.un,S.uns;var c=S.static,m=S.class,_=S.getset,w=S.__newvec,n=(laya.ani.AnimationContent,laya.ani.AnimationPlayer),r=(laya.ani.AnimationState,laya.ani.AnimationTemplet),p=laya.maths.Arith,s=laya.webgl.atlas.AtlasResourceManager,i=laya.webgl.shader.BaseShader,C=laya.utils.Browser,o=laya.webgl.utils.Buffer,x=laya.utils.Byte,l=(laya.ani.bone.canvasmesh.CacheAbleSkinMesh,laya.utils.ClassUtils),h=S.Config,a=(laya.events.Event,laya.events.EventDispatcher),I=laya.utils.Handler,Dt=laya.net.Loader,u=laya.net.LoaderManager,k=laya.maths.MathUtil,d=laya.display.Node,f=laya.renders.Render,g=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),v=laya.resource.Resource,y=laya.utils.RunDriver,E=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),T=laya.display.Sprite,M=laya.utils.Stat,D=laya.utils.StringKey,A=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),b=laya.utils.Utils,R=laya.webgl.WebGL,L=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D;S.interface("laya.d3.core.IClone"),S.interface("laya.d3.graphics.IVertex"),S.interface("laya.d3.core.render.IUpdate"),S.interface("laya.d3.core.scene.ITreeNode"),S.interface("laya.d3.core.render.IRenderable");var O=function(){function P(){}return m(P,"laya.d3.animation.AnimationClipParser01"),P.READ_DATA=function(){P._DATA.offset=P._reader.getUint32(),P._DATA.size=P._reader.getUint32()},P.READ_BLOCK=function(){for(var t=P._BLOCK.count=P._reader.getUint16(),e=P._BLOCK.blockStarts=[],i=P._BLOCK.blockLengths=[],n=0;n<t;n++)e.push(P._reader.getUint32()),i.push(P._reader.getUint32())},P.READ_STRINGS=function(){var t=P._reader.getUint32(),e=P._reader.getUint16(),i=P._reader.pos;P._reader.pos=t+P._DATA.offset;for(var n=0;n<e;n++)P._strings[n]=P._reader.readUTFString();P._reader.pos=i},P.parse=function(t,e){P._animationClip=t;(P._reader=e).__getBuffer();P.READ_DATA(),P.READ_BLOCK(),P.READ_STRINGS();for(var i=0,n=P._BLOCK.count;i<n;i++){var r=e.getUint16(),a=P._strings[r],s=P["READ_"+a];if(null==s)throw new Error("model file err,no this function:"+r+" "+a);s.call()}},P.READ_ANIMATIONS=function(){var t,e=0,i=0,n=P._reader,r=n.__getBuffer(),a=[],s=n.getUint8();for(a.length=s,e=0;e<s;e++)a[e]=n.getUint16();var o=[],l=n.getUint16();for(o.length=l,e=0;e<l;e++)o[e]=n.getFloat32();var h=P._animationClip;h.name=P._strings[n.getUint16()];var u=h._duration=n.getFloat32();h.islooping=!!n.getByte(),h._frameRate=n.getInt16();var c=n.getInt16(),_=h._nodes=new Array;_.length=c,(h._publicClipDatas=[]).length=c;var d=h._nodesMap={},f=0,p=0;for(e=0;e<c;e++){t=_[e]=new G;var m=n.getUint16(),g=t.path=[];for(g.length=m,i=0;i<m;i++)g[i]=P._strings[n.getUint16()];var v=g.join("/"),y=d[v];y||(d[v]=y=[]),y.push(t);var x=n.getInt16();-1!==x&&(t.componentType=P._strings[x]);var E=H._propertyIndexDic[P._strings[n.getUint16()]];if(null==E)throw new Error("AnimationClipParser01:unknown property name.");var T=E<4,S=!T||T&&""===g[0];(t._cacheProperty=S)?f++:p++,t.propertyNameID=E;var w=a[n.getUint8()];t.keyFrameWidth=w/4;var M=t.keyFrames=[],D=M.length=n.getUint16(),I=null,b=NaN;for(i=0;i<D;i++){var C=M[i]=new z;b=C.startTime=o[n.getUint16()];var A=n.pos;C.inTangent=new Float32Array(r.slice(A,A+w)),n.pos+=w,A=n.pos,C.outTangent=new Float32Array(r.slice(A,A+w)),n.pos+=w,A=n.pos,C.data=new Float32Array(r.slice(A,A+w)),n.pos+=w,I&&(I.next=C,I.duration=b-I.startTime),I=C}C.next=null,C.duration=u-b}var R=h._nodeToCachePropertyMap=new Int32Array(c),L=h._cachePropertyMap=new Int32Array(f),O=h._unCachePropertyMap=new Int32Array(p);for(f=p=0,e=0;e<c;e++)(t=_[e])._cacheProperty?(R[e]=f,L[f++]=e):O[p++]=e},P._animationClip=null,P._reader=null,P._strings=[],c(P,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),P}(),P=function(){function B(){}return m(B,"laya.d3.animation.AnimationClipParser02"),B.READ_DATA=function(){B._DATA.offset=B._reader.getUint32(),B._DATA.size=B._reader.getUint32()},B.READ_BLOCK=function(){for(var t=B._BLOCK.count=B._reader.getUint16(),e=B._BLOCK.blockStarts=[],i=B._BLOCK.blockLengths=[],n=0;n<t;n++)e.push(B._reader.getUint32()),i.push(B._reader.getUint32())},B.READ_STRINGS=function(){var t=B._reader.getUint32(),e=B._reader.getUint16(),i=B._reader.pos;B._reader.pos=t+B._DATA.offset;for(var n=0;n<e;n++)B._strings[n]=B._reader.readUTFString();B._reader.pos=i},B.parse=function(t,e){B._animationClip=t;(B._reader=e).__getBuffer();B.READ_DATA(),B.READ_BLOCK(),B.READ_STRINGS();for(var i=0,n=B._BLOCK.count;i<n;i++){var r=e.getUint16(),a=B._strings[r],s=B["READ_"+a];if(null==s)throw new Error("model file err,no this function:"+r+" "+a);s.call()}},B.READ_ANIMATIONS=function(){var t,e=0,i=0,n=B._reader,r=n.__getBuffer(),a=[],s=n.getUint8();for(a.length=s,e=0;e<s;e++)a[e]=n.getUint16();var o=[],l=n.getUint16();for(o.length=l,e=0;e<l;e++)o[e]=n.getFloat32();var h=B._animationClip;h.name=B._strings[n.getUint16()];var u=h._duration=n.getFloat32();h.islooping=!!n.getByte(),h._frameRate=n.getInt16();var c=n.getInt16(),_=h._nodes=new Array;_.length=c,(h._publicClipDatas=[]).length=c;var d=h._nodesMap={},f=0,p=0;for(e=0;e<c;e++){t=_[e]=new G;var m=n.getUint16(),g=t.path=[];for(g.length=m,i=0;i<m;i++)g[i]=B._strings[n.getUint16()];var v=g.join("/"),y=d[v];y||(d[v]=y=[]),y.push(t);var x=n.getInt16();-1!==x&&(t.componentType=B._strings[x]);var E=H._propertyIndexDic[B._strings[n.getUint16()]];if(null==E)throw new Error("AnimationClipParser02:unknown property name.");var T=E<4,S=!T||T&&""===g[0];(t._cacheProperty=S)?f++:p++,t.propertyNameID=E;var w=a[n.getUint8()];t.keyFrameWidth=w/4;var M=t.keyFrames=[],D=M.length=n.getUint16(),I=null,b=NaN;for(i=0;i<D;i++){var C=M[i]=new z;b=C.startTime=o[n.getUint16()];var A=n.pos;C.inTangent=new Float32Array(r.slice(A,A+w)),n.pos+=w,A=n.pos,C.outTangent=new Float32Array(r.slice(A,A+w)),n.pos+=w,A=n.pos,C.data=new Float32Array(r.slice(A,A+w)),n.pos+=w,I&&(I.next=C,I.duration=b-I.startTime),I=C}C.next=null,C.duration=u-b}var R=n.getUint16();for(e=0;e<R;e++){var L,O=new U;O.time=n.getFloat32(),O.eventName=B._strings[n.getUint16()];var P=n.getUint16();for(0<P&&(O.params=L=[]),i=0;i<P;i++){switch(n.getByte()){case 0:L.push(!!n.getByte());break;case 1:L.push(n.getInt32());break;case 2:L.push(n.getFloat32());break;case 3:L.push(B._strings[n.getUint16()]);break;default:throw new Error("unknown type.")}}h.addEvent(O)}var N=h._nodeToCachePropertyMap=new Int32Array(c),V=h._cachePropertyMap=new Int32Array(f),F=h._unCachePropertyMap=new Int32Array(p);for(f=p=0,e=0;e<c;e++)(t=_[e])._cacheProperty?(N[e]=f,V[f++]=e):F[p++]=e},B._animationClip=null,B._reader=null,B._strings=[],c(B,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),B}(),U=function(){function t(){this.time=NaN,this.eventName=null,this.params=null}return m(t,"laya.d3.animation.AnimationEvent"),t}(),H=function(){function n(){this._childs=[],this.transform=new Je(this)}m(n,"laya.d3.animation.AnimationNode");var t=n.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.addChild=function(t){t._parent=this,t.transform.setParent(this.transform),this._childs.push(t)},t.removeChild=function(t){var e=this._childs.indexOf(t);-1!==e&&this._childs.splice(e,1)},t.getChildByName=function(t){for(var e=0,i=this._childs.length;e<i;e++){var n=this._childs[e];if(n.name===t)return n}return null},t.getChildByIndex=function(t){return this._childs[t]},t.getChildCount=function(){return this._childs.length},t.cloneTo=function(t){var e=t;e.name=this.name;for(var i=0,n=this._childs.length;i<n;i++){var r=this._childs[i],a=r.clone();e.addChild(a);var s=r.transform,o=a.transform;o.setLocalPosition(s.getLocalPosition()),o.setLocalRotation(s.getLocalRotation()),o.setLocalScale(s.getLocalScale()),o._localRotationEuler=s._localRotationEuler,o._setWorldMatrixIgnoreUpdate(s.getWorldMatrix())}},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},n.__init__=function(){n.registerAnimationNodeProperty("localPosition",n._getLocalPosition,n._setLocalPosition),n.registerAnimationNodeProperty("localRotation",n._getLocalRotation,n._setLocalRotation),n.registerAnimationNodeProperty("localScale",n._getLocalScale,n._setLocalScale),n.registerAnimationNodeProperty("localRotationEuler",n._getLocalRotationEuler,n._setLocalRotationEuler),n.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",n._getParticleRenderSharedMaterialTintColor,n._setParticleRenderSharedMaterialTintColor),n.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",n._getMeshRenderSharedMaterialTilingOffset,n._setMeshRenderSharedMaterialTilingOffset),n.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",n._getMeshRenderSharedMaterialAlbedo,n._setMeshRenderSharedMaterialAlbedo),n.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",n._getSkinnedMeshRenderSharedMaterialTilingOffset,n._setSkinnedMeshRenderSharedMaterialTilingOffset),n.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",n._getSkinnedMeshRenderSharedMaterialAlbedo,n._setSkinnedMeshRenderSharedMaterialAlbedo),n.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",n._getMeshRenderSharedMaterialAlbedo,n._setMeshRenderSharedMaterialAlbedo),n.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",n._getSkinnedMeshRenderSharedMaterialAlbedo,n._setSkinnedMeshRenderSharedMaterialAlbedo)},n.registerAnimationNodeProperty=function(t,e,i){if(n._propertyIndexDic[t])throw new Error("AnimationNode: this propertyName has registered.");n._propertyIndexDic[t]=n._propertyIDCounter,n._propertyGetFuncs[n._propertyIDCounter]=e,n._propertySetFuncs[n._propertyIDCounter]=i,n._propertyIDCounter++},n._getLocalPosition=function(t,e){return t?t.transform.getLocalPosition():e._transform.localPosition.elements},n._setLocalPosition=function(t,e,i){if(t)t.transform.setLocalPosition(i);else{var n=e._transform,r=n.localPosition;r.elements=i,n.localPosition=r}},n._getLocalRotation=function(t,e){return t?t.transform.getLocalRotation():e._transform.localRotation.elements},n._setLocalRotation=function(t,e,i){if(t)t.transform.setLocalRotation(i);else{var n=e._transform,r=n.localRotation;r.elements=i,n.localRotation=r}},n._getLocalScale=function(t,e){return t?t.transform.getLocalScale():e._transform.localScale.elements},n._setLocalScale=function(t,e,i){if(t)t.transform.setLocalScale(i);else{var n=e._transform,r=n.localScale;r.elements=i,n.localScale=r}},n._getLocalRotationEuler=function(t,e){return t?t.transform.getLocalRotationEuler():e._transform.localRotationEuler.elements},n._setLocalRotationEuler=function(t,e,i){if(t)t.transform.setLocalRotationEuler(i);else{var n=e._transform,r=n.localRotationEuler;r.elements=i,n.localRotationEuler=r}},n._getMeshRenderSharedMaterialTilingOffset=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return e.meshRender.sharedMaterial.tilingOffset.elements},n._setMeshRenderSharedMaterialTilingOffset=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.meshRender.material).tilingOffset).elements=i,n.tilingOffset=r)}else(r=(n=e.meshRender.material).tilingOffset).elements=i,n.tilingOffset=r},n._getMeshRenderSharedMaterialAlbedo=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.albedoColor.elements:null}return e.meshRender.sharedMaterial.albedoColor.elements},n._setMeshRenderSharedMaterialAlbedo=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.meshRender.material).albedoColor).elements=i,n.albedoColor=r)}else(r=(n=e.meshRender.material).albedoColor).elements=i,n.albedoColor=r},n._getSkinnedMeshRenderSharedMaterialTilingOffset=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return e.skinnedMeshRender.sharedMaterial.tilingOffset.elements},n._setSkinnedMeshRenderSharedMaterialTilingOffset=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.skinnedMeshRender.material).tilingOffset).elements=i,n.tilingOffset=r)}else(r=(n=e.skinnedMeshRender.material).tilingOffset).elements=i,n.tilingOffset=r},n._getSkinnedMeshRenderSharedMaterialAlbedo=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return e.skinnedMeshRender.sharedMaterial.albedoColor.elements},n._setSkinnedMeshRenderSharedMaterialAlbedo=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.skinnedMeshRender.material).albedoColor).elements=i,n.albedoColor=r)}else(r=(n=e.skinnedMeshRender.material).albedoColor).elements=i,n.albedoColor=r},n._getParticleRenderSharedMaterialTintColor=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.particleRender.sharedMaterial.tintColor.elements:null}return e.particleRender.sharedMaterial.tintColor.elements},n._setParticleRenderSharedMaterialTintColor=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.particleRender.material).tintColor).elements=i,n.tintColor=r)}else(r=(n=e.particleRender.material).tintColor).elements=i,n.tintColor=r},n._propertyIDCounter=0,n._propertyIndexDic={},n._propertySetFuncs=[],n._propertyGetFuncs=[],n}(),z=function(){function t(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return m(t,"laya.d3.animation.Keyframe"),t}(),G=function(){function t(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return m(t,"laya.d3.animation.KeyframeNode"),t}(),N=function(){function t(){this._tempVector30=new Oe,this._tempVector31=new Oe,this._tempVector32=new Oe,this._a=new Oe,this._b=new Oe,this._c=new Oe,this._d=new Oe}m(t,"laya.d3.core.glitter.SplineCurvePositionVelocity");var e=t.prototype;return e.Init=function(t,e,i,n){t.cloneTo(this._d),e.cloneTo(this._c),Oe.scale(t,2,this._a),Oe.scale(i,2,this._tempVector30),Oe.subtract(this._a,this._tempVector30,this._a),Oe.add(this._a,e,this._a),Oe.add(this._a,n,this._a),Oe.scale(i,3,this._b),Oe.scale(t,3,this._tempVector30),Oe.subtract(this._b,this._tempVector30,this._b),Oe.subtract(this._b,n,this._b),Oe.scale(e,2,this._tempVector30),Oe.subtract(this._b,this._tempVector30,this._b)},e.Slerp=function(t,e){Oe.scale(this._a,t*t*t,this._tempVector30),Oe.scale(this._b,t*t,this._tempVector31),Oe.scale(this._c,t,this._tempVector32),Oe.add(this._tempVector30,this._tempVector31,e),Oe.add(e,this._tempVector32,e),Oe.add(e,this._d,e)},t}(),V=function(){function V(t,e,i,n){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=t,this._h=e,this._minHeight=i,this._maxHeight=n}m(V,"laya.d3.core.HeightMap");var t=V.prototype;return t._inBounds=function(t,e){return 0<=t&&t<this._h&&0<=e&&e<this._w},t.getHeight=function(t,e){return this._inBounds(t,e)?this._datas[t][e]:NaN},_(0,t,"width",function(){return this._w}),_(0,t,"height",function(){return this._h}),_(0,t,"maxHeight",function(){return this._maxHeight}),_(0,t,"minHeight",function(){return this._minHeight}),V.creatFromMesh=function(t,e,i,n){for(var r=[],a=[],s=t.getSubMeshCount(),o=0;o<s;o++){for(var l=t.getSubMesh(o),h=l._getVertexBuffer(),u=h.getData(),c=[],_=0;_<u.length;_+=h.vertexDeclaration.vertexStride/4){var d=new Oe(u[_+0],u[_+1],u[_+2]);c.push(d)}r.push(c);var f=l._getIndexBuffer();a.push(f.getData())}var p=t.boundingBox,m=p.min.x,g=p.min.z,v=p.max.x,y=p.max.z,x=p.min.y,E=p.max.y,T=v-m,S=y-g,w=n.elements[0]=T/(e-1),M=n.elements[1]=S/(i-1),D=new V(e,i,x,E),I=V._tempRay,b=I.direction.elements;b[0]=0,b[1]=-1,b[2]=0;var C=E+.1;I.origin.elements[1]=C;for(var A=0;A<i;A++){var R=g+A*M;D._datas[A]=[];for(var L=0;L<e;L++){var O=m+L*w,P=I.origin.elements;P[0]=O,P[2]=R;var N=V._getPosition(I,r,a);D._datas[A][L]=N===Number.MAX_VALUE?NaN:C-N}}return D},V.createFromImage=function(t,e,i){for(var n=t.width,r=t.height,a=new V(n,r,e,i),s=(i-e)/254,o=t.getPixels(),l=0,h=0;h<r;h++)for(var u=a._datas[h]=[],c=0;c<n;c++){var _=o[l++],d=o[l++],f=o[l++],p=o[l++];u[c]=255==_&&255==d&&255==f&&255==p?NaN:(_+d+f)/3*s+e}return a},V._getPosition=function(t,e,i){for(var n=Number.MAX_VALUE,r=0;r<e.length;r++)for(var a=e[r],s=i[r],o=0;o<s.length;o+=3){var l=a[s[o+0]],h=a[s[o+1]],u=a[s[o+2]],c=je.rayIntersectsTriangle(t,l,h,u);!isNaN(c)&&c<n&&(n=c)}return n},c(V,["_tempRay",function(){return this._tempRay=new Re(new Oe,new Oe)}]),V}(),F=function(){function r(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}m(r,"laya.d3.core.Layer");var t=r.prototype;return t._binarySearchIndex=function(){for(var t=0,e=r._collsionTestList.length-1,i=0;t<=e;){i=Math.floor((t+e)/2);var n=r._collsionTestList[i];if(n==this._number)return i;n>this._number?e=i-1:t=i+1}return t},t._addCollider=function(t){0===this._colliders.length&&r._collsionTestList.splice(this._binarySearchIndex(),0,this._number),t._isRigidbody?(this._colliders.unshift(t),this._nonRigidbodyOffset++):this._colliders.push(t)},t._removeCollider=function(t){var e=this._colliders.indexOf(t);e<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice(e,1),0===this._colliders.length&&r._collsionTestList.splice(r._collsionTestList.indexOf(this._number),1)},_(0,t,"number",function(){return this._number}),_(0,t,"visible",function(){return this._visible},function(t){this._visible=t,r._visibleLayers=t?r._visibleLayers|this.mask:r._visibleLayers&~this.mask}),_(0,t,"mask",function(){return this._mask}),_(1,r,"visibleLayers",function(){return r._visibleLayers},function(t){r._visibleLayers=t;for(var e=0,i=r._layerList.length;e<i;e++){var n=r._layerList[e];n._visible=0!=(n._mask&r._visibleLayers)}}),r.__init__=function(){r._layerList.length=31;for(var t=0;t<31;t++){var e=new r;(r._layerList[t]=e).visible=0===t?(e.name="Default Layer",!0):(e.name="Layer-"+t,!1),e._number=t,e._mask=Math.pow(2,t)}r.currentCreationLayer=r._layerList[0]},r.getLayerByNumber=function(t){if(t<0||30<t)throw new Error("无法返回指定Layer，该number超出范围！");return r._layerList[t]},r.getLayerByName=function(t){for(var e=0;e<31;e++)if(r._layerList[e].name===t)return r._layerList[e];throw new Error("无法返回指定Layer,该name不存在")},r.isVisible=function(t){return 0!=(t&r._currentCameraCullingMask&r._visibleLayers)},r._layerList=[],r._visibleLayers=2147483647,r._collsionTestList=[],r._currentCameraCullingMask=2147483647,r.maxCount=31,r.currentCreationLayer=null,r}(),It=function(){function t(t,e,i){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=t,this._minCount=e,this._maxCount=i}m(t,"laya.d3.core.particleShuriKen.module.Burst");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._time=this._time,e._minCount=this._minCount,e._maxCount=this._maxCount},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},_(0,e,"time",function(){return this._time}),_(0,e,"minCount",function(){return this._minCount}),_(0,e,"maxCount",function(){return this._maxCount}),t}(),bt=function(){function t(t){this._color=null,this.enbale=!1,this._color=t}m(t,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var e=t.prototype;return e.cloneTo=function(t){var e=t;this._color.cloneTo(e._color),e.enbale=this.enbale},e.clone=function(){var t;switch(this._color.type){case 0:t=Rt.createByConstant(this._color.constant.clone());break;case 1:t=Rt.createByGradient(this._color.gradient.clone());break;case 2:t=Rt.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:t=Rt.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e},_(0,e,"color",function(){return this._color}),t}(),B=function(){function t(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}m(t,"laya.d3.core.particleShuriKen.module.Emission");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),e._destroy=function(){this._bursts=null,this._destroyed=!0},e.getBurstsCount=function(){return this._bursts.length},e.getBurstByIndex=function(t){return this._bursts[t]},e.addBurst=function(t){var e=this._bursts.length;if(0<e)for(var i=0;i<e;i++)this._bursts[i].time>t.time&&this._bursts.splice(i,0,t);this._bursts.push(t)},e.removeBurst=function(t){var e=this._bursts.indexOf(t);-1!==e&&this._bursts.splice(e,1)},e.removeBurstByIndex=function(t){this._bursts.splice(t,1)},e.clearBurst=function(){this._bursts.length=0},e.cloneTo=function(t){var e=t,i=e._bursts;i.length=this._bursts.length;for(var n=0,r=this._bursts.length;n<r;n++){var a=i[n];a?this._bursts[n].cloneTo(a):i[n]=this._bursts[n].clone()}e._emissionRate=this._emissionRate,e.enbale=this.enbale},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},_(0,e,"destroyed",function(){return this._destroyed}),_(0,e,"emissionRate",function(){return this._emissionRate},function(t){if(t<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=t}),t}(),Ct=function(){function n(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}m(n,"laya.d3.core.particleShuriKen.module.FrameOverTime");var t=n.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(t){var e=t;e._type=this._type,e._constant=this._constant,this._overTime.cloneTo(e._overTime),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._overTimeMin.cloneTo(e._overTimeMin),this._overTimeMax.cloneTo(e._overTimeMax)},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},_(0,t,"frameOverTimeData",function(){return this._overTime}),_(0,t,"constant",function(){return this._constant}),_(0,t,"type",function(){return this._type}),_(0,t,"frameOverTimeDataMin",function(){return this._overTimeMin}),_(0,t,"constantMin",function(){return this._constantMin}),_(0,t,"frameOverTimeDataMax",function(){return this._overTimeMax}),_(0,t,"constantMax",function(){return this._constantMax}),n.createByConstant=function(t){var e=new n;return e._type=0,e._constant=t,e},n.createByOverTime=function(t){var e=new n;return e._type=1,e._overTime=t,e},n.createByRandomTwoConstant=function(t,e){var i=new n;return i._type=2,i._constantMin=t,i._constantMax=e,i},n.createByRandomTwoOverTime=function(t,e){var i=new n;return i._type=3,i._overTimeMin=t,i._overTimeMax=e,i},n}(),At=function(){function h(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}m(h,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var t=h.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(t){var e=t;e._type=this._type,e._separateAxes=this._separateAxes,e._constant=this._constant,this._constantSeparate.cloneTo(e._constantSeparate),this._gradient.cloneTo(e._gradient),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(e._constantMinSeparate),this._constantMaxSeparate.cloneTo(e._constantMaxSeparate),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},_(0,t,"gradientZ",function(){return this._gradientZ}),_(0,t,"constant",function(){return this._constant}),_(0,t,"gradient",function(){return this._gradient}),_(0,t,"separateAxes",function(){return this._separateAxes}),_(0,t,"type",function(){return this._type}),_(0,t,"constantSeparate",function(){return this._constantSeparate}),_(0,t,"gradientX",function(){return this._gradientX}),_(0,t,"gradientY",function(){return this._gradientY}),_(0,t,"gradientW",function(){return this._gradientW}),_(0,t,"gradientMin",function(){return this._gradientMin}),_(0,t,"constantMin",function(){return this._constantMin}),_(0,t,"gradientMax",function(){return this._gradientMax}),_(0,t,"constantMax",function(){return this._constantMax}),_(0,t,"gradientWMin",function(){return this._gradientWMin}),_(0,t,"constantMinSeparate",function(){return this._constantMinSeparate}),_(0,t,"constantMaxSeparate",function(){return this._constantMaxSeparate}),_(0,t,"gradientXMin",function(){return this._gradientXMin}),_(0,t,"gradientXMax",function(){return this._gradientXMax}),_(0,t,"gradientWMax",function(){return this._gradientWMax}),_(0,t,"gradientYMin",function(){return this._gradientYMin}),_(0,t,"gradientYMax",function(){return this._gradientYMax}),_(0,t,"gradientZMin",function(){return this._gradientZMin}),_(0,t,"gradientZMax",function(){return this._gradientZMax}),h.createByConstant=function(t){var e=new h;return e._type=0,e._separateAxes=!1,e._constant=t,e},h.createByConstantSeparate=function(t){var e=new h;return e._type=0,e._separateAxes=!0,e._constantSeparate=t,e},h.createByGradient=function(t){var e=new h;return e._type=1,e._separateAxes=!1,e._gradient=t,e},h.createByGradientSeparate=function(t,e,i,n){var r=new h;return r._type=1,r._separateAxes=!0,r._gradientX=t,r._gradientY=e,r._gradientZ=i,r._gradientW=n,r},h.createByRandomTwoConstant=function(t,e){var i=new h;return i._type=2,i._separateAxes=!1,i._constantMin=t,i._constantMax=e,i},h.createByRandomTwoConstantSeparate=function(t,e){var i=new h;return i._type=2,i._separateAxes=!0,i._constantMinSeparate=t,i._constantMaxSeparate=e,i},h.createByRandomTwoGradient=function(t,e){var i=new h;return i._type=3,i._separateAxes=!1,i._gradientMin=t,i._gradientMax=e,i},h.createByRandomTwoGradientSeparate=function(t,e,i,n,r,a,s,o){var l=new h;return l._type=3,l._separateAxes=!0,l._gradientXMin=t,l._gradientXMax=e,l._gradientYMin=i,l._gradientYMax=n,l._gradientZMin=r,l._gradientZMax=a,l._gradientWMin=s,l._gradientWMax=o,l},h}(),Rt=function(){function n(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}m(n,"laya.d3.core.particleShuriKen.module.GradientColor");var t=n.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(t){var e=t;e._type=this._type,this._constant.cloneTo(e._constant),this._constantMin.cloneTo(e._constantMin),this._constantMax.cloneTo(e._constantMax),this._gradient.cloneTo(e._gradient),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax)},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},_(0,t,"gradient",function(){return this._gradient}),_(0,t,"constant",function(){return this._constant}),_(0,t,"type",function(){return this._type}),_(0,t,"gradientMin",function(){return this._gradientMin}),_(0,t,"constantMin",function(){return this._constantMin}),_(0,t,"gradientMax",function(){return this._gradientMax}),_(0,t,"constantMax",function(){return this._constantMax}),n.createByConstant=function(t){var e=new n;return e._type=0,e._constant=t,e},n.createByGradient=function(t){var e=new n;return e._type=1,e._gradient=t,e},n.createByRandomTwoConstant=function(t,e){var i=new n;return i._type=2,i._constantMin=t,i._constantMax=e,i},n.createByRandomTwoGradient=function(t,e){var i=new n;return i._type=3,i._gradientMin=t,i._gradientMax=e,i},n}(),W=function(){function t(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}m(t,"laya.d3.core.particleShuriKen.module.GradientDataColor");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.addAlpha=function(t,e){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==t&&(t=1,console.log("GradientDataColor warning:the forth key is  be force set to 1.")),this._alphaElements[this._alphaCurrentLength++]=t,this._alphaElements[this._alphaCurrentLength++]=e):console.log("GradientDataColor warning:data count must lessEqual than 4")},e.addRGB=function(t,e){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==t&&(t=1,console.log("GradientDataColor warning:the forth key is  be force set to 1.")),this._rgbElements[this._rgbCurrentLength++]=t,this._rgbElements[this._rgbCurrentLength++]=e.x,this._rgbElements[this._rgbCurrentLength++]=e.y,this._rgbElements[this._rgbCurrentLength++]=e.z):console.log("GradientDataColor warning:data count must lessEqual than 4")},e.cloneTo=function(t){var e=t,i=0,n=0;e._alphaCurrentLength=this._alphaCurrentLength;var r=e._alphaElements;for(r.length=this._alphaElements.length,i=0,n=this._alphaElements.length;i<n;i++)r[i]=this._alphaElements[i];e._rgbCurrentLength=this._rgbCurrentLength;var a=e._rgbElements;for(a.length=this._rgbElements.length,i=0,n=this._rgbElements.length;i<n;i++)a[i]=this._rgbElements[i]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},_(0,e,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),_(0,e,"rgbGradientCount",function(){return this._rgbCurrentLength/4}),t}(),X=function(){function t(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}m(t,"laya.d3.core.particleShuriKen.module.GradientDataInt");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.add=function(t,e){this._currentLength<8?(6===this._currentLength&&1!==t&&(t=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=t,this._elements[this._currentLength++]=e):console.log("Warning:data count must lessEqual than 4")},e.cloneTo=function(t){var e=t;e._currentLength=this._currentLength;var i=e._elements;i.length=this._elements.length;for(var n=0,r=this._elements.length;n<r;n++)i[n]=this._elements[n]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},_(0,e,"gradientCount",function(){return this._currentLength/2}),t}(),Y=function(){function t(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}m(t,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.add=function(t,e){this._currentLength<8?(6===this._currentLength&&1!==t&&(t=1,console.log("GradientDataNumber warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=t,this._elements[this._currentLength++]=e):console.log("GradientDataNumber warning:data count must lessEqual than 4")},e.getKeyByIndex=function(t){return this._elements[2*t]},e.getValueByIndex=function(t){return this._elements[2*t+1]},e.getAverageValue=function(){for(var t=0,e=this._currentLength-2;t<e;t+=2){this._elements[t+1];this._elements[t+3],this._elements[t+2]-this._elements[t]}return 0},e.cloneTo=function(t){var e=t;e._currentLength=this._currentLength;var i=e._elements;i.length=this._elements.length;for(var n=0,r=this._elements.length;n<r;n++)i[n]=this._elements[n]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},_(0,e,"gradientCount",function(){return this._currentLength/2}),t}(),Lt=(function(){function t(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}m(t,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var e=t.prototype;S.imps(e,{"laya.d3.core.IClone":!0}),e.add=function(t,e){this._currentLength<8?(6===this._currentLength&&1!==t&&(t=1,console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=t,this._elements[this._currentLength++]=e.x,this._elements[this._currentLength++]=e.y):console.log("GradientDataVector2 warning:data count must lessEqual than 4")},e.cloneTo=function(t){var e=t;e._currentLength=this._currentLength;var i=e._elements;i.length=this._elements.length;for(var n=0,r=this._elements.length;n<r;n++)i[n]=this._elements[n]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},_(0,e,"gradientCount",function(){return this._currentLength/3})}(),function(){function o(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}m(o,"laya.d3.core.particleShuriKen.module.GradientSize");var t=o.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.getMaxSizeInGradient=function(){var t=0,e=0,i=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for(t=0,e=this._gradientX.gradientCount;t<e;t++)i=Math.max(i,this._gradientX.getValueByIndex(t));for(t=0,e=this._gradientY.gradientCount;t<e;t++)i=Math.max(i,this._gradientY.getValueByIndex(t))}else for(t=0,e=this._gradient.gradientCount;t<e;t++)i=Math.max(i,this._gradient.getValueByIndex(t));break;case 1:i=this._separateAxes?(i=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),i=Math.max(i,this._constantMinSeparate.y),Math.max(i,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for(t=0,e=this._gradientXMin.gradientCount;t<e;t++)i=Math.max(i,this._gradientXMin.getValueByIndex(t));for(t=0,e=this._gradientXMax.gradientCount;t<e;t++)i=Math.max(i,this._gradientXMax.getValueByIndex(t));for(t=0,e=this._gradientYMin.gradientCount;t<e;t++)i=Math.max(i,this._gradientYMin.getValueByIndex(t));for(t=0,e=this._gradientZMax.gradientCount;t<e;t++)i=Math.max(i,this._gradientZMax.getValueByIndex(t))}else{for(t=0,e=this._gradientMin.gradientCount;t<e;t++)i=Math.max(i,this._gradientMin.getValueByIndex(t));for(t=0,e=this._gradientMax.gradientCount;t<e;t++)i=Math.max(i,this._gradientMax.getValueByIndex(t))}}return i},t.cloneTo=function(t){var e=t;e._type=this._type,e._separateAxes=this._separateAxes,this._gradient.cloneTo(e._gradient),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(e._constantMinSeparate),this._constantMaxSeparate.cloneTo(e._constantMaxSeparate),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},_(0,t,"gradientZ",function(){return this._gradientZ}),_(0,t,"gradient",function(){return this._gradient}),_(0,t,"separateAxes",function(){return this._separateAxes}),_(0,t,"type",function(){return this._type}),_(0,t,"gradientMin",function(){return this._gradientMin}),_(0,t,"constantMin",function(){return this._constantMin}),_(0,t,"gradientX",function(){return this._gradientX}),_(0,t,"gradientY",function(){return this._gradientY}),_(0,t,"gradientMax",function(){return this._gradientMax}),_(0,t,"constantMax",function(){return this._constantMax}),_(0,t,"constantMinSeparate",function(){return this._constantMinSeparate}),_(0,t,"constantMaxSeparate",function(){return this._constantMaxSeparate}),_(0,t,"gradientXMin",function(){return this._gradientXMin}),_(0,t,"gradientXMax",function(){return this._gradientXMax}),_(0,t,"gradientYMin",function(){return this._gradientYMin}),_(0,t,"gradientYMax",function(){return this._gradientYMax}),_(0,t,"gradientZMin",function(){return this._gradientZMin}),_(0,t,"gradientZMax",function(){return this._gradientZMax}),o.createByGradient=function(t){var e=new o;return e._type=0,e._separateAxes=!1,e._gradient=t,e},o.createByGradientSeparate=function(t,e,i){var n=new o;return n._type=0,n._separateAxes=!0,n._gradientX=t,n._gradientY=e,n._gradientZ=i,n},o.createByRandomTwoConstant=function(t,e){var i=new o;return i._type=1,i._separateAxes=!1,i._constantMin=t,i._constantMax=e,i},o.createByRandomTwoConstantSeparate=function(t,e){var i=new o;return i._type=1,i._separateAxes=!0,i._constantMinSeparate=t,i._constantMaxSeparate=e,i},o.createByRandomTwoGradient=function(t,e){var i=new o;return i._type=2,i._separateAxes=!1,i._gradientMin=t,i._gradientMax=e,i},o.createByRandomTwoGradientSeparate=function(t,e,i,n,r,a){var s=new o;return s._type=2,s._separateAxes=!0,s._gradientXMin=t,s._gradientXMax=e,s._gradientYMin=i,s._gradientYMax=n,s._gradientZMin=r,s._gradientZMax=a,s},o}()),Ot=function(){function o(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}m(o,"laya.d3.core.particleShuriKen.module.GradientVelocity");var t=o.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(t){var e=t;e._type=this._type,this._constant.cloneTo(e._constant),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),this._constantMin.cloneTo(e._constantMin),this._constantMax.cloneTo(e._constantMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},_(0,t,"gradientZ",function(){return this._gradientZ}),_(0,t,"constant",function(){return this._constant}),_(0,t,"type",function(){return this._type}),_(0,t,"gradientXMax",function(){return this._gradientXMax}),_(0,t,"constantMin",function(){return this._constantMin}),_(0,t,"gradientX",function(){return this._gradientX}),_(0,t,"gradientY",function(){return this._gradientY}),_(0,t,"gradientXMin",function(){return this._gradientXMin}),_(0,t,"constantMax",function(){return this._constantMax}),_(0,t,"gradientYMin",function(){return this._gradientYMin}),_(0,t,"gradientYMax",function(){return this._gradientYMax}),_(0,t,"gradientZMin",function(){return this._gradientZMin}),_(0,t,"gradientZMax",function(){return this._gradientZMax}),o.createByConstant=function(t){var e=new o;return e._type=0,e._constant=t,e},o.createByGradient=function(t,e,i){var n=new o;return n._type=1,n._gradientX=t,n._gradientY=e,n._gradientZ=i,n},o.createByRandomTwoConstant=function(t,e){var i=new o;return i._type=2,i._constantMin=t,i._constantMax=e,i},o.createByRandomTwoGradient=function(t,e,i,n,r,a){var s=new o;return s._type=3,s._gradientXMin=t,s._gradientXMax=e,s._gradientYMin=i,s._gradientYMax=n,s._gradientZMin=r,s._gradientZMax=a,s},o}(),Pt=function(){function t(t){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=t}m(t,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this._angularVelocity.cloneTo(e._angularVelocity),e.enbale=this.enbale},e.clone=function(){var t;switch(this._angularVelocity.type){case 0:t=this._angularVelocity.separateAxes?At.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):At.createByConstant(this._angularVelocity.constant);break;case 1:t=this._angularVelocity.separateAxes?At.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):At.createByGradient(this._angularVelocity.gradient.clone());break;case 2:t=this._angularVelocity.separateAxes?At.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):At.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:t=this._angularVelocity.separateAxes?At.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):At.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e},_(0,e,"angularVelocity",function(){return this._angularVelocity}),t}(),j=function(){function t(){this.enable=!1,this.randomDirection=!1}m(t,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e._getShapeBoundBox=function(t){throw new Error("BaseShape: must override it.")},e._getSpeedBoundBox=function(t){throw new Error("BaseShape: must override it.")},e.generatePositionAndDirection=function(t,e,i,n){throw new Error("BaseShape: must override it.")},e._calculateProceduralBounds=function(t,e,i){this._getShapeBoundBox(t);var n=t.min,r=t.max;Oe.multiply(n,e,n),Oe.multiply(r,e,r);var a=new xe(new Oe,new Oe);this.randomDirection?(a.min=new Oe(-1,-1,-1),a.max=new Oe(1,1,1)):this._getSpeedBoundBox(a);var s=new xe(new Oe,new Oe),o=s.min,l=s.max;Oe.scale(a.min,i.y,o),Oe.scale(a.max,i.y,l),Oe.add(t.min,o,o),Oe.add(t.max,l,l),Oe.min(t.min,o,t.min),Oe.max(t.max,o,t.max);var h=new xe(new Oe,new Oe),u=h.min,c=h.max;Oe.scale(a.min,i.x,u),Oe.scale(a.max,i.x,c),Oe.min(h.min,c,o),Oe.max(h.min,c,l),Oe.min(t.min,o,t.min),Oe.max(t.max,o,t.max)},e.cloneTo=function(t){t.enable=this.enable},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t}(),Z=function(){function a(){}return m(a,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),a._randomPointUnitArcCircle=function(t,e,i){var n=e.elements,r=NaN;r=i?i.getFloat()*t:Math.random()*t,n[0]=Math.cos(r),n[1]=Math.sin(r)},a._randomPointInsideUnitArcCircle=function(t,e,i){var n=e.elements;a._randomPointUnitArcCircle(t,e,i);var r=NaN;r=i?Math.pow(i.getFloat(),.5):Math.pow(Math.random(),.5),n[0]=n[0]*r,n[1]=n[1]*r},a._randomPointUnitCircle=function(t,e){var i=t.elements,n=NaN;n=e?e.getFloat()*Math.PI*2:Math.random()*Math.PI*2,i[0]=Math.cos(n),i[1]=Math.sin(n)},a._randomPointInsideUnitCircle=function(t,e){var i=t.elements;a._randomPointUnitCircle(t);var n=NaN;n=e?Math.pow(e.getFloat(),.5):Math.pow(Math.random(),.5),i[0]=i[0]*n,i[1]=i[1]*n},a._randomPointUnitSphere=function(t,e){var i=t.elements,n=NaN,r=NaN;r=e?(n=i[2]=2*e.getFloat()-1,e.getFloat()*Math.PI*2):(n=i[2]=2*Math.random()-1,Math.random()*Math.PI*2);var a=Math.sqrt(1-n*n);i[0]=a*Math.cos(r),i[1]=a*Math.sin(r)},a._randomPointInsideUnitSphere=function(t,e){var i=t.elements;a._randomPointUnitSphere(t);var n=NaN;n=e?Math.pow(e.getFloat(),1/3):Math.pow(Math.random(),1/3),i[0]=i[0]*n,i[1]=i[1]*n,i[2]=i[2]*n},a._randomPointInsideHalfUnitBox=function(t,e){var i=t.elements;i[2]=e?(i[0]=e.getFloat()-.5,i[1]=e.getFloat()-.5,e.getFloat()-.5):(i[0]=Math.random()-.5,i[1]=Math.random()-.5,Math.random()-.5)},a}(),Nt=function(){function t(t){this._size=null,this.enbale=!1,this._size=t}m(t,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this._size.cloneTo(e._size),e.enbale=this.enbale},e.clone=function(){var t;switch(this._size.type){case 0:t=this._size.separateAxes?Lt.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):Lt.createByGradient(this._size.gradient.clone());break;case 1:t=this._size.separateAxes?Lt.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):Lt.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:t=this._size.separateAxes?Lt.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):Lt.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e},_(0,e,"size",function(){return this._size}),t}(),Vt=function(){function n(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}m(n,"laya.d3.core.particleShuriKen.module.StartFrame");var t=n.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(t){var e=t;e._type=this._type,e._constant=this._constant,e._constantMin=this._constantMin,e._constantMax=this._constantMax},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},_(0,t,"constant",function(){return this._constant}),_(0,t,"type",function(){return this._type}),_(0,t,"constantMin",function(){return this._constantMin}),_(0,t,"constantMax",function(){return this._constantMax}),n.createByConstant=function(t){var e=new n;return e._type=0,e._constant=t,e},n.createByRandomTwoConstant=function(t,e){var i=new n;return i._type=1,i._constantMin=t,i._constantMax=e,i},n}(),Ft=function(){function t(t,e){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new Le(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=t,this._startFrame=e}m(t,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this.tiles.cloneTo(e.tiles),e.type=this.type,e.randomRow=this.randomRow,this._frame.cloneTo(e._frame),this._startFrame.cloneTo(e._startFrame),e.cycles=this.cycles,e.enableUVChannels=this.enableUVChannels,e.enable=this.enable},e.clone=function(){var t,e;switch(this._frame.type){case 0:t=Ct.createByConstant(this._frame.constant);break;case 1:t=Ct.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:t=Ct.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:t=Ct.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:e=Vt.createByConstant(this._startFrame.constant);break;case 1:e=Vt.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var i=new this.constructor(t,e);return this.tiles.cloneTo(i.tiles),i.type=this.type,i.randomRow=this.randomRow,i.cycles=this.cycles,i.enableUVChannels=this.enableUVChannels,i.enable=this.enable,i},_(0,e,"frame",function(){return this._frame}),_(0,e,"startFrame",function(){return this._startFrame}),t}(),Bt=function(){function t(t){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=t}m(t,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this._velocity.cloneTo(e._velocity),e.enbale=this.enbale,e.space=this.space},e.clone=function(){var t;switch(this._velocity.type){case 0:t=Ot.createByConstant(this._velocity.constant.clone());break;case 1:t=Ot.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:t=Ot.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:t=Ot.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e.space=this.space,e},_(0,e,"velocity",function(){return this._velocity}),t}(),K=function(){function U(){}return m(U,"laya.d3.core.particleShuriKen.ShurikenParticleData"),U._getStartLifetimeFromGradient=function(t,e){for(var i=1,n=t.gradientCount;i<n;i++){var r=t.getKeyByIndex(i);if(e<=r){var a=t.getKeyByIndex(i-1),s=(e-a)/(r-a);return k.lerp(t.getValueByIndex(i-1),t.getValueByIndex(i),s)}}throw new Error("ShurikenParticleData: can't get value foam startLifeTimeGradient.")},U._randomInvertRoationArray=function(t,e,i,n,r){var a=NaN;n?(n.seed=r[6],a=n.getFloat(),r[6]=n.seed):a=Math.random(),e[2]=a<i?(e[0]=-t[0],e[1]=-t[1],-t[2]):(e[0]=t[0],e[1]=t[1],t[2])},U._randomInvertRoation=function(t,e,i,n){var r=NaN;return i?(i.seed=n[6],r=i.getFloat(),n[6]=i.seed):r=Math.random(),r<e&&(t=-t),t},U.create=function(t,e,i){var n=t.autoRandomSeed,r=t._rand,a=t._randomSeeds;switch(t.startColorType){case 0:var s=t.startColorConstant.elements;U.startColor[0]=s[0],U.startColor[1]=s[1],U.startColor[2]=s[2],U.startColor[3]=s[3];break;case 2:n?k.lerpVector4(t.startColorConstantMin.elements,t.startColorConstantMax.elements,Math.random(),U.startColor):(r.seed=a[3],k.lerpVector4(t.startColorConstantMin.elements,t.startColorConstantMax.elements,r.getFloat(),U.startColor),a[3]=r.seed)}var o=t.colorOverLifetime;if(o&&o.enbale){var l=o.color;switch(l.type){case 0:U.startColor[0]=U.startColor[0]*l.constant.x,U.startColor[1]=U.startColor[1]*l.constant.y,U.startColor[2]=U.startColor[2]*l.constant.z,U.startColor[3]=U.startColor[3]*l.constant.w;break;case 2:var h=NaN;n?h=Math.random():(r.seed=a[10],h=r.getFloat(),a[10]=r.seed);var u=l.constantMin,c=l.constantMax;U.startColor[0]=U.startColor[0]*k.lerp(u.x,c.x,h),U.startColor[1]=U.startColor[1]*k.lerp(u.y,c.y,h),U.startColor[2]=U.startColor[2]*k.lerp(u.z,c.z,h),U.startColor[3]=U.startColor[3]*k.lerp(u.w,c.w,h)}}var _=U.startSize;switch(t.startSizeType){case 0:if(t.threeDStartSize){var d=t.startSizeConstantSeparate;_[0]=d.x,_[1]=d.y,_[2]=d.z}else _[0]=_[1]=_[2]=t.startSizeConstant;break;case 2:if(t.threeDStartSize){var f=t.startSizeConstantMinSeparate,p=t.startSizeConstantMaxSeparate;n?(_[0]=k.lerp(f.x,p.x,Math.random()),_[1]=k.lerp(f.y,p.y,Math.random()),_[2]=k.lerp(f.z,p.z,Math.random())):(r.seed=a[4],_[0]=k.lerp(f.x,p.x,r.getFloat()),_[1]=k.lerp(f.y,p.y,r.getFloat()),_[2]=k.lerp(f.z,p.z,r.getFloat()),a[4]=r.seed)}else n?_[0]=_[1]=_[2]=k.lerp(t.startSizeConstantMin,t.startSizeConstantMax,Math.random()):(r.seed=a[4],_[0]=_[1]=_[2]=k.lerp(t.startSizeConstantMin,t.startSizeConstantMax,r.getFloat()),a[4]=r.seed)}var m=t.sizeOverLifetime;if(m&&m.enbale&&1===m.size.type){var g=m.size;if(g.separateAxes)n?(_[0]=_[0]*k.lerp(g.constantMinSeparate.x,g.constantMaxSeparate.x,Math.random()),_[1]=_[1]*k.lerp(g.constantMinSeparate.y,g.constantMaxSeparate.y,Math.random()),_[2]=_[2]*k.lerp(g.constantMinSeparate.z,g.constantMaxSeparate.z,Math.random())):(r.seed=a[11],_[0]=_[0]*k.lerp(g.constantMinSeparate.x,g.constantMaxSeparate.x,r.getFloat()),_[1]=_[1]*k.lerp(g.constantMinSeparate.y,g.constantMaxSeparate.y,r.getFloat()),_[2]=_[2]*k.lerp(g.constantMinSeparate.z,g.constantMaxSeparate.z,r.getFloat()),a[11]=r.seed);else{var v=NaN;n?v=k.lerp(g.constantMin,g.constantMax,Math.random()):(r.seed=a[11],v=k.lerp(g.constantMin,g.constantMax,r.getFloat()),a[11]=r.seed),_[0]=_[0]*v,_[1]=_[1]*v,_[2]=_[2]*v}}var y=e.renderMode;if(1!==y)switch(t.startRotationType){case 0:if(t.threeDStartRotation){var x=t.startRotationConstantSeparate,E=U._tempVector30.elements;U._randomInvertRoationArray(x.elements,E,t.randomizeRotationDirection,n?null:r,a),U.startRotation[0]=E[0],U.startRotation[1]=E[1],U.startRotation[2]=4!==y?-E[2]:E[2]}else U.startRotation[0]=U._randomInvertRoation(t.startRotationConstant,t.randomizeRotationDirection,n?null:r,a);break;case 2:if(t.threeDStartRotation){var T=t.startRotationConstantMinSeparate,S=t.startRotationConstantMaxSeparate,w=U._tempVector30.elements;n?(w[0]=k.lerp(T.x,S.x,Math.random()),w[1]=k.lerp(T.y,S.y,Math.random()),w[2]=k.lerp(T.z,S.z,Math.random())):(r.seed=a[5],w[0]=k.lerp(T.x,S.x,r.getFloat()),w[1]=k.lerp(T.y,S.y,r.getFloat()),w[2]=k.lerp(T.z,S.z,r.getFloat()),a[5]=r.seed),U._randomInvertRoationArray(w,w,t.randomizeRotationDirection,n?null:r,a),U.startRotation[0]=w[0],U.startRotation[1]=w[1],U.startRotation[2]=4!==y?-w[2]:w[2]}else n?U.startRotation[0]=U._randomInvertRoation(k.lerp(t.startRotationConstantMin,t.startRotationConstantMax,Math.random()),t.randomizeRotationDirection,n?null:r,a):(r.seed=a[5],U.startRotation[0]=U._randomInvertRoation(k.lerp(t.startRotationConstantMin,t.startRotationConstantMax,r.getFloat()),t.randomizeRotationDirection,n?null:r,a),a[5]=r.seed)}switch(t.startLifetimeType){case 0:U.startLifeTime=t.startLifetimeConstant;break;case 1:U.startLifeTime=U._getStartLifetimeFromGradient(t.startLifeTimeGradient,t.emissionTime);break;case 2:n?U.startLifeTime=k.lerp(t.startLifetimeConstantMin,t.startLifetimeConstantMax,Math.random()):(r.seed=a[7],U.startLifeTime=k.lerp(t.startLifetimeConstantMin,t.startLifetimeConstantMax,r.getFloat()),a[7]=r.seed);break;case 3:var M=t.emissionTime;n?U.startLifeTime=k.lerp(U._getStartLifetimeFromGradient(t.startLifeTimeGradientMin,M),U._getStartLifetimeFromGradient(t.startLifeTimeGradientMax,M),Math.random()):(r.seed=a[7],U.startLifeTime=k.lerp(U._getStartLifetimeFromGradient(t.startLifeTimeGradientMin,M),U._getStartLifetimeFromGradient(t.startLifeTimeGradientMax,M),r.getFloat()),a[7]=r.seed)}switch(t.startSpeedType){case 0:U.startSpeed=t.startSpeedConstant;break;case 2:n?U.startSpeed=k.lerp(t.startSpeedConstantMin,t.startSpeedConstantMax,Math.random()):(r.seed=a[8],U.startSpeed=k.lerp(t.startSpeedConstantMin,t.startSpeedConstantMax,r.getFloat()),a[8]=r.seed)}var D=t.textureSheetAnimation;if(D&&D.enable){var I=D.tiles,b=I.x,C=I.y,A=1/b,R=1/C,L=0,O=D.startFrame;switch(O.type){case 0:L=O.constant;break;case 1:n?L=k.lerp(O.constantMin,O.constantMax,Math.random()):(r.seed=a[14],L=k.lerp(O.constantMin,O.constantMax,r.getFloat()),a[14]=r.seed)}var P=D.frame;switch(P.type){case 0:L+=P.constant;break;case 2:n?L+=k.lerp(P.constantMin,P.constantMax,Math.random()):(r.seed=a[15],L+=k.lerp(P.constantMin,P.constantMax,r.getFloat()),a[15]=r.seed)}var N=0;switch(D.type){case 0:N=Math.floor(L/b);break;case 1:D.randomRow?n?N=Math.floor(Math.random()*C):(r.seed=a[13],N=Math.floor(r.getFloat()*C),a[13]=r.seed):N=D.rowIndex}var V=Math.floor(L%b);(U.startUVInfo=U.startUVInfo)[0]=A,U.startUVInfo[1]=R,U.startUVInfo[2]=V*A,U.startUVInfo[3]=N*R}else(U.startUVInfo=U.startUVInfo)[0]=1,U.startUVInfo[1]=1,U.startUVInfo[2]=0,U.startUVInfo[3]=0;switch(t.simulationSpace){case 0:var F=i.position.elements;U.simulationWorldPostion[0]=F[0],U.simulationWorldPostion[1]=F[1],U.simulationWorldPostion[2]=F[2];var B=i.rotation.elements;U.simulationWorldRotation[0]=B[0],U.simulationWorldRotation[1]=B[1],U.simulationWorldRotation[2]=B[2],U.simulationWorldRotation[3]=B[3];break;case 1:break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}},U.startLifeTime=NaN,U.startSpeed=NaN,c(U,["_tempVector30",function(){return this._tempVector30=new Oe},"_tempQuaternion",function(){return this._tempQuaternion=new Ce},"startColor",function(){return this.startColor=new Float32Array(4)},"startSize",function(){return this.startSize=new Float32Array(3)},"startRotation",function(){return this.startRotation=new Float32Array(3)},"startUVInfo",function(){return this.startUVInfo=new Float32Array(4)},"simulationWorldPostion",function(){return this.simulationWorldPostion=new Float32Array(3)},"simulationWorldRotation",function(){return this.simulationWorldRotation=new Float32Array(4)}]),U}(),q=function(){function t(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new ke,this._vb=Zi.create(t._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=ji.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=Fi.nameKey.getID("LINE"),this._shaderCompile=ui._preCompileShader[this._sharderNameID]}m(t,"laya.d3.core.PhasorSpriter3D");var e=t.prototype;return e.line=function(t,e,i,n){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t.x,t.y,t.z,e.x,e.y,e.z,e.w),this.addVertex(i.x,i.y,i.z,n.x,n.y,n.z,n.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},e.circle=function(t,e,i,n,r,a){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*e,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/e,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*t,Math.cos(this._tempNumver0)*t,0,i,n,r,a),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},e.plane=function(t,e,i,n,r,a,s,o,l){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=n/2,this._tempNumver1=r/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t-this._tempNumver0,e+this._tempNumver1,i,a,s,o,l),this.addVertex(t+this._tempNumver0,e+this._tempNumver1,i,a,s,o,l),this.addVertex(t-this._tempNumver0,e-this._tempNumver1,i,a,s,o,l),this.addVertex(t+this._tempNumver0,e-this._tempNumver1,i,a,s,o,l),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},e.box=function(t,e,i,n,r,a,s,o,l,h){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=n/2,this._tempNumver1=r/2,this._tempNumver2=a/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t-this._tempNumver0,e+this._tempNumver1,i+this._tempNumver2,s,o,l,h),this.addVertex(t+this._tempNumver0,e+this._tempNumver1,i+this._tempNumver2,s,o,l,h),this.addVertex(t-this._tempNumver0,e-this._tempNumver1,i+this._tempNumver2,s,o,l,h),this.addVertex(t+this._tempNumver0,e-this._tempNumver1,i+this._tempNumver2,s,o,l,h),this.addVertex(t+this._tempNumver0,e+this._tempNumver1,i-this._tempNumver2,s,o,l,h),this.addVertex(t-this._tempNumver0,e+this._tempNumver1,i-this._tempNumver2,s,o,l,h),this.addVertex(t+this._tempNumver0,e-this._tempNumver1,i-this._tempNumver2,s,o,l,h),this.addVertex(t-this._tempNumver0,e-this._tempNumver1,i-this._tempNumver2,s,o,l,h),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},e.cone=function(t,e,i,n,r,a,s){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*i+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*i>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/i,this.addVertexIndex(0,e,0,n,r,a,s,this._tempUint0),this.addVertexIndex(0,0,0,n,r,a,s,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<i;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex(t*this._tempNumver2,0,t*this._tempNumver3,n,r,a,s,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==i-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex(t*this._tempNumver2,0,t*this._tempNumver3,n,r,a,s,this._tempUint0+(this._tempInt0+i)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==i-1?this.addIndexes(this._tempUint1+i+2):this.addIndexes(this._tempUint1+this._tempInt0+i+1),this.addIndexes(this._tempUint1+this._tempInt0+i),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},e.boundingBoxLine=function(t,e,i,n,r,a,s,o,l,h){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t,r,a,s,o,l,h),this.addVertex(n,r,a,s,o,l,h),this.addVertex(t,e,a,s,o,l,h),this.addVertex(n,e,a,s,o,l,h),this.addVertex(n,r,i,s,o,l,h),this.addVertex(t,r,i,s,o,l,h),this.addVertex(n,e,i,s,o,l,h),this.addVertex(t,e,i,s,o,l,h),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},e.addVertex=function(t,e,i,n,r,a,s){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=t,this._vbData[this._posInVBData+1]=e,this._vbData[this._posInVBData+2]=i,this._vbData[this._posInVBData+3]=n,this._vbData[this._posInVBData+4]=r,this._vbData[this._posInVBData+5]=a,this._vbData[this._posInVBData+6]=s,this._posInVBData+=this._floatSizePerVer,this},e.addVertexIndex=function(t,e,i,n,r,a,s,o){return this._hasBegun||this.addVertexIndexException(),this._vbData[o]=t,this._vbData[o+1]=e,this._vbData[o+2]=i,this._vbData[o+3]=n,this._vbData[o+4]=r,this._vbData[o+5]=a,this._vbData[o+6]=s,(o+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=o),this},e.addIndexes=function(t){var e=arguments;this._hasBegun||this.addVertexIndexException();for(var i=0;i<e.length;i++)this._ibData[this._posInIBData]=e[i],this._posInIBData++;return this},e.begin=function(t,e){return this._hasBegun&&this.beginException0(),1!==t&&4!==t&&this.beginException1(),this._primitiveType=t,this._camera=e,this._hasBegun=!0,this},e.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},e.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes(t._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),M.drawCall++,R.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},e.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},e.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},e.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},e.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},e.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},e.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(28,[new ft(0,"vector3",0),new ft(12,"vector4",1)])}]),t}(),Q=function(){function t(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._conchSubmesh=null,this._id=++t._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new ke,f.isConchNode&&(this._conchSubmesh=new ConchSubmesh)}m(t,"laya.d3.core.render.RenderElement");var e=t.prototype;return e.getDynamicBatchBakedVertexs=function(t){for(var e=this._renderObj._getVertexBuffer(t),i=e.getData().slice(),n=e.vertexDeclaration,r=n.getVertexElementByUsage(0).offset/4,a=n.getVertexElementByUsage(3).offset/4,s=this._sprite3D.transform,o=s.worldMatrix,l=s.rotation,h=n.vertexStride/4,u=0,c=i.length;u<c;u+=h){var _=u+r,d=u+a;qe.transformVector3ArrayToVector3ArrayCoordinate(i,_,o,i,_),qe.transformVector3ArrayByQuat(i,d,l,i,d)}return i},e.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},e._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},_(0,e,"id",function(){return this._id}),_(0,e,"renderObj",function(){return this._renderObj},function(t){this._renderObj!==t&&(this._renderObj=t)}),t._uniqueIDCounter=0,t}(),J=function(){function e(t){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++e._uniqueIDCounter,this._needSort=!1,this._scene=t,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[]}m(e,"laya.d3.core.render.RenderQueue");var t=e.prototype;return t._sortOpaqueFunc=function(t,e){return t._render&&e._render?t._render._distanceForSort-e._render._distanceForSort:0},t._sortAlphaFunc=function(t,e){return t._render&&e._render?e._render._distanceForSort-t._render._distanceForSort:0},t._begainRenderElement=function(t,e,i){return!!e._beforeRender(t)},t._sortAlpha=function(t){e._cameraPosition=t,this._finalElements.sort(this._sortAlphaFunc)},t._sortOpaque=function(t){e._cameraPosition=t,this._finalElements.sort(this._sortOpaqueFunc)},t._preRender=function(t){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},t._render=function(t,e){for(var i,n,r,a,s,o,l=M.loopCount,h=this._scene,u=t.camera,c=(u.id,!1),_=0,d=this._finalElements.length;_<d;_++){var f,p,m,g=this._finalElements[_];if(null!=g._onPreRenderFunction&&g._onPreRenderFunction.call(g._sprite3D,t),0===g._type){if(t.owner=m=g._sprite3D,t.renderElement=g,m._preRenderUpdateComponents(t),f=g.renderObj,p=g._material,this._begainRenderElement(t,f,p)){if(i=f._getVertexBuffers(),r=(n=f._getVertexBuffer(0)).vertexDeclaration,c=(a=t._shader=p._getShader(h._shaderDefineValue,r.shaderDefineValue,m._shaderDefineValue)).bind()||l!==a._uploadLoopCount,i){if(a._uploadVertexBuffer!==i||c){for(var v=0;v<i.length;v++){var y=i[v];a.uploadAttributesX(y.vertexDeclaration.shaderValues.data,y)}a._uploadVertexBuffer=i}}else(a._uploadVertexBuffer!==n||c)&&(a.uploadAttributes(r.shaderValues.data,null),a._uploadVertexBuffer=n);(a._uploadScene!==h||c)&&(a.uploadSceneUniforms(h._shaderValues.data),a._uploadScene=h),(u!==a._uploadCamera||a._uploadSprite3D!==m||c)&&(a.uploadSpriteUniforms(m._shaderValues.data),a._uploadSprite3D=m),(u!==a._uploadCamera||c)&&(a.uploadCameraUniforms(u._shaderValues.data),a._uploadCamera=u),(a._uploadMaterial!==p||c)&&(p._upload(),a._uploadMaterial=p),s!==p?(p._setRenderStateBlendDepth(),p._setRenderStateFrontFace(e,m.transform),s=p,o=m):o!==m&&(p._setRenderStateFrontFace(e,m.transform),o=m),f._render(t),a._uploadLoopCount=l}m._postRenderUpdateComponents(t)}else if(2===g._type){g.renderObj;t.owner=m=g._sprite3D,t.renderElement=g,t._batchIndexStart=g._tempBatchIndexStart,t._batchIndexEnd=g._tempBatchIndexEnd,f=g.renderObj,p=g._material,this._begainRenderElement(t,f,p)&&(r=(n=f._getVertexBuffer(0)).vertexDeclaration,c=(a=t._shader=p._getShader(h._shaderDefineValue,r.shaderDefineValue,m._shaderDefineValue)).bind()||l!==a._uploadLoopCount,(a._uploadVertexBuffer!==n||c)&&(a.uploadAttributes(r.shaderValues.data,null),a._uploadVertexBuffer=n),(a._uploadScene!==h||c)&&(a.uploadSceneUniforms(h._shaderValues.data),a._uploadScene=h),(u!==a._uploadCamera||a._uploadSprite3D!==m||c)&&(a.uploadSpriteUniforms(m._shaderValues.data),a._uploadSprite3D=m),(u!==a._uploadCamera||c)&&(a.uploadCameraUniforms(u._shaderValues.data),a._uploadCamera=u),(a._uploadMaterial!==p||c)&&(p._upload(),a._uploadMaterial=p),s!==p?(p._setRenderStateBlendDepth(),p._setRenderStateFrontFace(e,m.transform),s=p,o=m):o!==m&&(p._setRenderStateFrontFace(e,m.transform),o=m),f._render(t),a._uploadLoopCount=l)}}},t._renderShadow=function(t,e){for(var i,n,r,a,s,o=M.loopCount,l=this._scene,h=t.camera,u=!1,c=0,_=this._finalElements.length;c<_;c++){var d,f,p,m=this._finalElements[c];0===m._type&&(t.owner=p=m._sprite3D,e||p._projectionViewWorldUpdateCamera===h&&p._projectionViewWorldUpdateLoopCount===M.loopCount||(p._render._renderUpdate(t._projectionViewMatrix),p._projectionViewWorldUpdateLoopCount=M.loopCount,p._projectionViewWorldUpdateCamera=h),t.renderElement=m,p._preRenderUpdateComponents(t),d=m.renderObj,f=m._material,this._begainRenderElement(t,d,null)&&(n=(i=d._getVertexBuffer(0)).vertexDeclaration,u=(r=t._shader=f._getShader(l._shaderDefineValue,n.shaderDefineValue,p._shaderDefineValue)).bind()||o!==r._uploadLoopCount,(r._uploadVertexBuffer!==i||u)&&(r.uploadAttributes(n.shaderValues.data,null),r._uploadVertexBuffer=i),(h!==r._uploadCamera||r._uploadSprite3D!==p||u)&&(r.uploadSpriteUniforms(p._shaderValues.data),r._uploadSprite3D=p),(h!==r._uploadCamera||u)&&(r.uploadCameraUniforms(h._shaderValues.data),r._uploadCamera=h),(r._uploadMaterial!==f||u)&&(f._upload(),r._uploadMaterial=f),r._uploadRenderElement,a!==f?(f._setRenderStateFrontFace(!1,p.transform),a=f,s=p):s!==p&&(f._setRenderStateFrontFace(!1,p.transform),s=p),d._render(t),r._uploadLoopCount=o),p._postRenderUpdateComponents(t))}},t._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},t._addRenderElement=function(t){this._renderElements.push(t),this._needSort=!0},t._addDynamicBatchElement=function(t){this._dynamicBatchCombineRenderElements.push(t)},_(0,t,"id",function(){return this._id}),e._uniqueIDCounter=0,e.OPAQUE=1,e.TRANSPARENT=2,e._cameraPosition=null,e}(),$=function(){function t(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return m(t,"laya.d3.core.render.RenderState"),t.clientWidth=0,t.clientHeight=0,t}(),tt=function(){function s(t,e){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new Te(new Oe,0),this._corners=[new Oe,new Oe,new Oe,new Oe,new Oe,new Oe,new Oe,new Oe],this._boundingBoxCenter=new Oe,this._children=w(8),this._objects=[],this._tempBoundBoxCorners=[new Oe,new Oe,new Oe,new Oe,new Oe,new Oe,new Oe,new Oe],this._scene=t,this._currentDepth=e}m(s,"laya.d3.core.scene.OctreeNode");var t=s.prototype;return S.imps(t,{"laya.d3.core.scene.ITreeNode":!0}),t.init=function(t,e){var i=new Oe,n=new Oe;Oe.scale(e,-.5,i),Oe.scale(e,.5,n),Oe.add(i,t,i),Oe.add(n,t,n),this.exactBox=new xe(i,n),this.relaxBox=new xe(i,n)},t.addTreeNode=function(t){1===Se.boxContainsBox(this._relaxBox,t.boundingBox)?this.addNodeDown(t,0):this.addObject(t)},t.addChild=function(t){var e=this._children[t];if(null==e){e=new s(this._scene,this._currentDepth+1),(this._children[t]=e)._parent=this,Oe.subtract(this._exactBox.max,this._exactBox.min,s.tempSize),Oe.multiply(s.tempSize,s._octreeSplit[t],s.tempCenter),Oe.add(this._exactBox.min,s.tempCenter,s.tempCenter),Oe.scale(s.tempSize,.25,s.tempSize);var i=new Oe,n=new Oe;Oe.subtract(s.tempCenter,s.tempSize,i),Oe.add(s.tempCenter,s.tempSize,n),e.exactBox=new xe(i,n),Oe.scale(s.tempSize,s.relax,s.tempSize);var r=new Oe,a=new Oe;Oe.subtract(s.tempCenter,s.tempSize,r),Oe.add(s.tempCenter,s.tempSize,a),e.relaxBox=new xe(r,a)}return e},t.addObject=function(t){(t._treeNode=this)._objects.push(t)},t.removeObject=function(t){if(t._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var e=this._objects.indexOf(t);return-1!==e&&(this._objects.splice(e,1),!0)},t.clearObject=function(){this._objects.length=0},t.addNodeUp=function(t,e){this._parent&&1!==Se.boxContainsBox(this._exactBox,t.boundingBox)?this._parent.addNodeUp(t,e-1):this.addNodeDown(t,e)},t.addNodeDown=function(t,e){if(e<this._scene.treeLevel){var i=this.inChildIndex(t.boundingBoxCenter),n=this.addChild(i);1===Se.boxContainsBox(n._relaxBox,t.boundingBox)?n.addNodeDown(t,++e):this.addObject(t)}else this.addObject(t)},t.inChildIndex=function(t){return 4*(t.z<this._boundingBoxCenter.z?0:1)+2*(t.y<this._boundingBoxCenter.y?0:1)+(t.x<this._boundingBoxCenter.x?0:1)},t.updateObject=function(t){1===Se.boxContainsBox(this._relaxBox,t.boundingBox)?(this.removeObject(t),t._treeNode=null,this.addNodeDown(t,this._currentDepth)):this._parent&&(this.removeObject(t),t._treeNode=null,this._parent.addNodeUp(t,this._currentDepth-1))},t.cullingObjects=function(t,e,i,n,r){var a,s=0,o=0,l=0,h=this._scene._dynamicBatchManager;for(s=0,a=this._objects.length;s<a;s++){var u=this._objects[s];if(F.isVisible(u._owner.layer.mask)&&u.enable){if(e&&(M.treeSpriteCollision+=1,0===t.containsBoundSphere(u.boundingSphere)))continue;u._renderUpdate(r),u._distanceForSort=Oe.distance(u.boundingSphere.center,n)+u.sortingFudge;var c=u._renderElements;for(o=0,l=c.length;o<l;o++){var _=c[o],d=_._staticBatch;if(d&&d._material===_._material)d._addBatchRenderElement(_);else{var f=_.renderObj;f.triangleCount<laya.d3.graphics.DynamicBatch.maxCombineTriangleCount&&1===f._vertexBufferCount&&f._getIndexBuffer()&&_._material.renderQueue<2&&_._canDynamicBatch&&!u._owner.isStatic?h._addPrepareRenderElement(_):this._scene.getRenderQueue(_._material.renderQueue)._addRenderElement(_)}}}}for(s=0;s<8;s++){var p=this._children[s];if(null!=p){var m=e;if(e){var g=t.containsBoundBox(p._relaxBox);if(M.treeNodeCollision+=1,0===g)continue;m=2===g}p.cullingObjects(t,m,i,n,r)}}},t.cullingShadowObjects=function(t,e,i,n,r){var a,s=0,o=0,l=0;this._scene._dynamicBatchManager;for(s=0,a=this._objects.length;s<a;s++){var h=this._objects[s];if(h.castShadow&&F.isVisible(h._owner.layer.mask)&&h.enable){if(i&&0===t[0].containsBoundSphere(h.boundingSphere))continue;for(var u=1,c=t.length;u<c;u++){var _=e[u-1];if(0!==t[u].containsBoundSphere(h.boundingSphere)){var d=h._renderElements;for(o=0,l=d.length;o<l;o++)_._addRenderElement(d[o])}}}}for(s=0;s<8;s++){var f=this._children[s];if(null!=f){var p=i;if(i){var m=t[0].containsBoundBox(f._relaxBox);if(0===m)continue;p=2===m}f.cullingShadowObjects(t,e,p,n,r)}}},t.cullingShadowObjectsOnePSSM=function(t,e,i,n,r,a){var s,o=e[0],l=0,h=0,u=0;for(l=0,s=this._objects.length;l<s;l++){var c=this._objects[l];if(c.castShadow&&F.isVisible(c._owner.layer.mask)&&c.enable){if(n&&0===t.containsBoundSphere(c.boundingSphere))continue;c._renderUpdate(i);var _=c._renderElements;for(h=0,u=_.length;h<u;h++)o._addRenderElement(_[h])}}for(l=0;l<8;l++){var d=this._children[l];if(null!=d){var f=n;if(n){var p=t.containsBoundBox(d._relaxBox);if(0===p)continue;f=2===p}d.cullingShadowObjectsOnePSSM(t,e,i,f,r,a)}}},t.renderBoudingBox=function(t){this._renderBoudingBox(t);for(var e=0;e<8;++e){var i=this._children[e];i&&i.renderBoudingBox(t)}},t.buildAllChild=function(t){if(t<this._scene.treeLevel)for(var e=0;e<8;e++){this.addChild(e).buildAllChild(t+1)}},t._renderBoudingBox=function(t){},_(0,t,"exactBox",function(){return this._exactBox},function(t){this._exactBox=t,Oe.add(t.min,t.max,this._boundingBoxCenter),Oe.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),_(0,t,"relaxBox",function(){return this._relaxBox},function(t){(this._relaxBox=t).getCorners(this._corners),Te.createfromPoints(this._corners,this._boundingSphere)}),s.debugMode=!1,s.relax=1.15,s.CHILDNUM=8,c(s,["tempVector0",function(){return this.tempVector0=new Oe},"tempSize",function(){return this.tempSize=new Oe},"tempCenter",function(){return this.tempCenter=new Oe},"_octreeSplit",function(){return this._octreeSplit=[new Oe(.25,.25,.25),new Oe(.75,.25,.25),new Oe(.25,.75,.25),new Oe(.75,.75,.25),new Oe(.25,.25,.75),new Oe(.75,.25,.75),new Oe(.25,.75,.75),new Oe(.75,.75,.75)]}]),s}(),et=(function(){function t(){}m(t,"laya.d3.core.scene.SceneManager")}(),function(){function t(t,e,i,n){this.r=NaN,this.g=NaN,this.b=NaN,this.a=NaN,this.r=t,this.g=e,this.b=i,this.a=n}return m(t,"laya.d3.core.trail.module.Color",null,"Color$1"),c(t,["RED",function(){return this.RED=new t(1,0,0,1)},"GREEN",function(){return this.GREEN=new t(0,1,0,1)},"BLUE",function(){return this.BLUE=new t(0,0,1,1)},"CYAN",function(){return this.CYAN=new t(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new t(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new t(1,0,1,1)},"GRAY",function(){return this.GRAY=new t(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new t(1,1,1,1)},"BLACK",function(){return this.BLACK=new t(0,0,0,1)}]),t}()),it=function(){function t(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}m(t,"laya.d3.core.trail.module.Gradient");var e=t.prototype;return e.setKeys=function(t,e){var i,n;this._colorKeys=t;for(var r=this.index=0;r<t.length;r++){var a=(i=t[r]).color;this._colorKeyData[this.index++]=a.r,this._colorKeyData[this.index++]=a.g,this._colorKeyData[this.index++]=a.b,this._colorKeyData[this.index++]=i.time}this._alphaKeys=e;for(var s=this.index=0;s<e.length;s++)n=e[s],this._alphaKeyData[this.index++]=n.alpha,this._alphaKeyData[this.index++]=n.time},_(0,e,"mode",function(){return this._mode},function(t){this._mode=t}),_(0,e,"colorKeys",function(){return this._colorKeys},function(t){this._colorKeys=t;for(var e=this.index=0;e<t.length;e++){var i=t[e],n=i.color;this._colorKeyData[this.index++]=n.r,this._colorKeyData[this.index++]=n.g,this._colorKeyData[this.index++]=n.b,this._colorKeyData[this.index++]=i.time}}),_(0,e,"alphaKeys",function(){return this._alphaKeys},function(t){this._alphaKeys=t;for(var e=this.index=0;e<t.length;e++){var i=t[e];this._alphaKeyData[this.index++]=i.alpha,this._alphaKeyData[this.index++]=i.time}}),t}(),nt=function(){function t(t,e){this._alpha=NaN,this._time=NaN,this._alpha=t,this._time=e}m(t,"laya.d3.core.trail.module.GradientAlphaKey");var e=t.prototype;return _(0,e,"alpha",function(){return this._alpha},function(t){this._alpha=t}),_(0,e,"time",function(){return this._time},function(t){this._time=t}),t}(),rt=function(){function t(t,e){this._color=null,this._time=NaN,this._color=t,this._time=e}m(t,"laya.d3.core.trail.module.GradientColorKey");var e=t.prototype;return _(0,e,"color",function(){return this._color},function(t){this._color=t}),_(0,e,"time",function(){return this._time},function(t){this._time=t}),t}(),at=(function(){function t(){}m(t,"laya.d3.core.trail.module.GradientMode"),t.Blend=0,t.Fixed=1}(),function(){function t(){}m(t,"laya.d3.core.trail.module.TextureMode"),t.Stretch=0,t.Tile=1}(),function(){function t(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}return m(t,"laya.d3.core.trail.module.TrailKeyFrame"),t}()),st=function(){function e(t){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new Oe,this._curPosition=new Oe,this._delVector3=new Oe,this._lastFixedVertexPosition=new Oe,this._pointAtoBVector3=new Oe,this._pointA=new Oe,this._pointB=new Oe,this._owner=t,this._id=e.renderElementCount++,0==this._id?t._owner.transform.position.cloneTo(this._lastPosition):t._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new Zi(ot.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new Zi(ot.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}m(e,"laya.d3.core.trail.TrailRenderElement");var t=e.prototype;return S.imps(t,{"laya.d3.core.render.IRenderable":!0}),t._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},t._addTrailByFirstPosition=function(t,e){Oe.subtract(e,t,this._delVector3),Oe.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),Oe.normalize(this._pointAtoBVector3,this._pointAtoBVector3),Oe.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition(t),t.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},t._addTrailByNextPosition=function(t){Oe.subtract(t,this._lastFixedVertexPosition,this._delVector3),Oe.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),Oe.normalize(this._pointAtoBVector3,this._pointAtoBVector3),Oe.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=Oe.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=we.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition(t),t.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition(t),this._virtualVerticesCount=2)},t._updateVerticesByPosition=function(t){this._pointe=t.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},t._updateVertexBuffer2=function(){var t,e=0,i=0,n=0;for(n=0,t=(this._verticesCount+this._virtualVerticesCount)/2;n<t;n++)i=0==this._owner.textureMode?(this._VerticesToTailLength[n]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[n],this._vertices2[e++]=1-i,this._vertices2[e++]=1-i;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},t._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},t._updateDisappear=function(){var t,e=0;for(e=this._curDisappearIndex,t=(this._verticesCount+this._virtualVerticesCount)/2;e<t;e++)this._owner._curtime-this._everyGroupVertexBirthTime[e]>=this._owner.time+we.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},t._beforeRender=function(t){return this._camera=t.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?Oe.equals(this._lastPosition,this._curPosition)||this._updateTrail():this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},t._render=function(t){this._isDead||(R.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),M.drawCall++,M.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},t._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer1:1===t?this._vertexBuffer2:null},t._getVertexBuffers=function(){return this._vertexBuffers},t._getIndexBuffer=function(){return null},t._renderRuntime=function(t,e,i){},t.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},t._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},_(0,t,"_vertexBufferCount",function(){return this._vertexBuffers.length}),_(0,t,"triangleCount",function(){return 0}),e.renderElementCount=0,e}(),ot=function(){function t(){}m(t,"laya.d3.core.trail.VertexTrail");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration1}),_(1,t,"vertexDeclaration1",function(){return t._vertexDeclaration1}),_(1,t,"vertexDeclaration2",function(){return t._vertexDeclaration2}),c(t,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new dt(32,[new ft(0,"vector3",0),new ft(12,"vector3",41),new ft(24,"single",33),new ft(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new dt(4,[new ft(0,"single",38)])}]),t}(),lt=function(){function x(t){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=t}m(x,"laya.d3.graphics.DynamicBatch");var t=x.prototype;return S.imps(t,{"laya.d3.core.render.IRenderable":!0}),t._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},t._getIndexBuffer=function(){return this._indexBuffer},t._getCombineRenderElementFromPool=function(t,e,i){var n=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return n||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=n=new Q,n._sprite3D=new gn),n._sprite3D._render._renderUpdate(i),n},t._getRenderElement=function(t,e,i){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*x.maxVertexCount),this._indexDatas=new Uint16Array(x.maxIndexCount),this._vertexBuffer=Zi.create(this._vertexDeclaration,x.maxVertexCount,35048),this._indexBuffer=ji.create("ushort",x.maxIndexCount,35048));for(var n=this._merageElements.length=0,r=0,a=0,s=this._combineRenderElements.length;a<s;a++){var o=this._combineRenderElements[a],l=o.getDynamicBatchBakedVertexs(0),h=o.getBakedIndices(),u=o._sprite3D.transform._isFrontFaceInvert,c=n/(this._vertexDeclaration.vertexStride/4),_=r,d=_+h.length;o._tempBatchIndexStart=_,o._tempBatchIndexEnd=d,this._indexDatas.set(h,r);var f=0;if(u)for(f=_;f<d;f+=3){this._indexDatas[f]=c+this._indexDatas[f];var p=this._indexDatas[f+1],m=this._indexDatas[f+2];this._indexDatas[f+1]=c+m,this._indexDatas[f+2]=c+p}else for(f=_;f<d;f+=3)this._indexDatas[f]=c+this._indexDatas[f],this._indexDatas[f+1]=c+this._indexDatas[f+1],this._indexDatas[f+2]=c+this._indexDatas[f+2];r+=h.length,this._vertexDatas.set(l,n),n+=l.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),a=this._combineRenderElementPoolIndex=0,s=this._materials.length;a<s;a++){var g=this._getCombineRenderElementFromPool(t,e,i);g._type=2,g._staticBatch=null;var v=(g.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[a]]._tempBatchIndexStart,y=a+1===this._materialToRenderElementsOffsets.length?r:this._combineRenderElements[this._materialToRenderElementsOffsets[a+1]]._tempBatchIndexStart;g._tempBatchIndexStart=v,g._tempBatchIndexEnd=y,g._material=this._materials[a],this._merageElements.push(g)}},t._addCombineRenderObjTest=function(t){var e=t.renderObj,i=this._currentCombineIndexCount+e._getIndexBuffer().indexCount,n=this._currentCombineVertexCount+e._getVertexBuffer().vertexCount;return!(x.maxVertexCount<n||x.maxIndexCount<i)},t._addCombineRenderObj=function(t){var e=t.renderObj;this._combineRenderElements.push(t),this._currentCombineIndexCount=this._currentCombineIndexCount+e._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+e._getVertexBuffer().vertexCount},t._addCombineMaterial=function(t){this._materials.push(t)},t._addMaterialToRenderElementOffset=function(t){this._materialToRenderElementsOffsets.push(t)},t._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},t._addToRenderQueue=function(t,e,i,n){this._getRenderElement(e,i,n);for(var r=0,a=this._materials.length;r<a;r++)t.getRenderQueue(this._materials[r].renderQueue)._addDynamicBatchElement(this._merageElements[r])},t._beforeRender=function(t){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},t._render=function(t){var e=t._batchIndexEnd-t._batchIndexStart;R.mainContext.drawElements(4,e,5123,2*t._batchIndexStart),M.drawCall++,M.trianglesFaces+=e/3},t._getVertexBuffers=function(){return null},t._renderRuntime=function(t,e,i){},_(0,t,"_vertexBufferCount",function(){return 1}),_(0,t,"triangleCount",function(){return this._indexBuffer.indexCount/3}),_(0,t,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),x.maxVertexCount=2e4,x.maxIndexCount=4e4,x.maxCombineTriangleCount=13,x}(),ht=function(){function x(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}m(x,"laya.d3.graphics.DynamicBatchManager");var t=x.prototype;return t.getDynamicBatch=function(t,e){var i,n=t.id.toString()+e;return this._dynamicBatches[n]?i=this._dynamicBatches[n]:this._dynamicBatches[n]=i=new lt(t),i},t._garbageCollection=function(){for(var t in this._dynamicBatches)0===this._dynamicBatches[t].combineRenderElementsCount&&delete this._dynamicBatches[t]},t._addPrepareRenderElement=function(t){this._prepareDynamicBatchCombineElements.push(t)},t._finishCombineDynamicBatch=function(t){var e,i,n;this._prepareDynamicBatchCombineElements.sort(x._sortPrepareDynamicBatch);for(var r,a,s,o,l,h=-1,u=!0,c=0,_=-1,d=0,f=this._prepareDynamicBatchCombineElements.length;d<f;d++){var p=(a=this._prepareDynamicBatchCombineElements[d]).renderObj._getVertexBuffer(0).vertexDeclaration,m=i!==p;m&&(c=0,i=p);var g=c!==h;if(g&&(h=c),(m||g)&&(s=this.getDynamicBatch(p,c),e=null),u)if(s._addCombineRenderObjTest(a)){if(e!==(r=a._material))o&&(t.getRenderQueue(l._material.renderQueue)._addRenderElement(l),l=o=null,_=-1),o=r,_=s.combineRenderElementsCount,l=a,e=r;else if(o){var v=l.renderObj,y=a.renderObj;v._getVertexBuffer().vertexCount+y._getVertexBuffer().vertexCount>lt.maxVertexCount||v._getIndexBuffer().indexCount+y._getIndexBuffer().indexCount>lt.maxIndexCount?(t.getRenderQueue(l._material.renderQueue)._addRenderElement(l),o=r,_=s.combineRenderElementsCount,l=a):(s._addCombineMaterial(o),s._addMaterialToRenderElementOffset(_),s._addCombineRenderObj(l),l=o=null,_=-1,s._addCombineRenderObj(a))}else s._addCombineRenderObj(a);u=!0}else o&&(t.getRenderQueue(l._material.renderQueue)._addRenderElement(l),l=o=null,_=-1),c++,u=!1;else n=this._prepareDynamicBatchCombineElements[d-1],s._addMaterialToRenderElementOffset(s.combineRenderElementsCount),e=n._material,s._addCombineMaterial(e),s._addCombineRenderObj(n),u=!0,e!==(r=a._material)?(o=r,_=s.combineRenderElementsCount,l=a):s._addCombineRenderObj(a),e=r}o&&(t.getRenderQueue(l._material.renderQueue)._addRenderElement(l),l=o=null,_=-1),this._prepareDynamicBatchCombineElements.length=0},t._clearRenderElements=function(){for(var t in this._dynamicBatches)this._dynamicBatches[t]._clearRenderElements()},t._addToRenderQueue=function(t,e,i,n){for(var r in this._dynamicBatches){var a=this._dynamicBatches[r];0<a.combineRenderElementsCount&&a._addToRenderQueue(t,e,i,n)}},t.dispose=function(){this._dynamicBatches=null},x._sortPrepareDynamicBatch=function(t,e){return t._mainSortID-e._mainSortID},x}(),ut=function(){function t(){}return m(t,"laya.d3.graphics.FrustumCulling"),t.renderShadowObjectCulling=function(t,e,i,n,r){var a=0,s=0,o=0,l=0;for(a=0,o=i.length;a<o;a++){var h=i[a];h&&h._clearRenderElements()}var u,c,_,d=t._cullingRenders;if(1<r){for(a=0,o=t._cullingRendersLength;a<o;a++)if((u=d[a]).castShadow&&F.isVisible(u._owner.layer.mask)&&u.enable)for(var f=1,p=e.length;f<p;f++)if(c=i[f-1],0!==e[f].containsBoundSphere(u.boundingSphere))for(s=0,l=(_=u._renderElements).length;s<l;s++)c._addRenderElement(_[s])}else for(a=0,o=t._cullingRendersLength;a<o;a++)if((u=d[a]).castShadow&&F.isVisible(u._owner.layer.mask)&&u.enable&&0!==e[0].containsBoundSphere(u.boundingSphere))for(u._renderUpdate(n),c=i[0],s=0,l=(_=u._renderElements).length;s<l;s++)c._addRenderElement(_[s])},t.renderShadowObjectCullingOctree=function(t,e,i,n,r){for(var a=0,s=i.length;a<s;a++){var o=i[a];o&&o._clearRenderElements()}1<r?t.treeRoot.cullingShadowObjects(e,i,!0,0,t):t.treeRoot.cullingShadowObjectsOnePSSM(e[0],i,n,!0,0,t)},t.renderObjectCulling=function(t,e,i,n,r,a){var s=0,o=0,l=0,h=0,u=e._quenes,c=e._dynamicBatchManager,_=e._cullingRenders;for(s=0,o=u.length;s<o;s++){var d=u[s];d&&d._clearRenderElements()}var f=ct._staticBatchManagers;for(s=0,o=f.length;s<o;s++)f[s]._clearRenderElements();c._clearRenderElements();var p=i.transform.position;for(s=0,o=e._cullingRendersLength;s<o;s++){var m=_[s];if(F.isVisible(m._owner.layer.mask)&&m.enable&&0!==t.containsBoundSphere(m.boundingSphere)&&m._renderUpdate(a)){m._distanceForSort=Oe.distance(m.boundingSphere.center,p)+m.sortingFudge;var g=m._renderElements;for(l=0,h=g.length;l<h;l++){var v=g[l],y=v._staticBatch;if(y&&y._material===v._material)y._addBatchRenderElement(v);else{var x=v.renderObj;x.triangleCount<laya.d3.graphics.DynamicBatch.maxCombineTriangleCount&&1===x._vertexBufferCount&&x._getIndexBuffer()&&v._material.renderQueue<2&&v._canDynamicBatch&&!m._owner.isStatic?c._addPrepareRenderElement(v):e.getRenderQueue(v._material.renderQueue)._addRenderElement(v)}}}}for(s=0,o=f.length;s<o;s++)f[s]._addToRenderQueue(e,n,r,a);c._finishCombineDynamicBatch(e),c._addToRenderQueue(e,n,r,a)},t.renderObjectCullingOctree=function(t,e,i,n,r,a){var s=0,o=0,l=e._quenes,h=e._dynamicBatchManager;for(s=0,o=l.length;s<o;s++){var u=l[s];u&&u._clearRenderElements()}var c=ct._staticBatchManagers;for(s=0,o=c.length;s<o;s++)c[s]._clearRenderElements();for(h._clearRenderElements(),e._cullingRenders.length=0,e.treeRoot.cullingObjects(t,!0,0,i.transform.position,a),s=0,o=c.length;s<o;s++)c[s]._addToRenderQueue(e,n,r,a);h._finishCombineDynamicBatch(e),h._addToRenderQueue(e,n,r,a)},t.renderObjectCullingNoBoundFrustum=function(t,e,i,n,r){var a=0,s=0,o=0,l=0,h=t._quenes,u=t._dynamicBatchManager,c=t._cullingRenders;for(a=0,s=h.length;a<s;a++){var _=h[a];_&&_._clearRenderElements()}var d=ct._staticBatchManagers;for(a=0,s=d.length;a<s;a++)d[a]._clearRenderElements();u._clearRenderElements();var f=e.transform.position;for(a=0,s=t._cullingRendersLength;a<s;a++){var p=c[a];if(F.isVisible(p._owner.layer.mask)&&p.enable){p._renderUpdate(r),p._distanceForSort=Oe.distance(p.boundingSphere.center,f)+p.sortingFudge;var m=p._renderElements;for(o=0,l=m.length;o<l;o++){var g=m[o],v=g._staticBatch;if(v&&v._material===g._material)v._addBatchRenderElement(g);else{var y=g.renderObj;y.triangleCount<laya.d3.graphics.DynamicBatch.maxCombineTriangleCount&&1===y._vertexBufferCount&&y._getIndexBuffer()&&g._material.renderQueue<2&&g._canDynamicBatch&&!p._owner.isStatic?u._addPrepareRenderElement(g):t.getRenderQueue(g._material.renderQueue)._addRenderElement(g)}}}}for(a=0,s=d.length;a<s;a++)d[a]._addToRenderQueue(t,i,n,r);u._finishCombineDynamicBatch(t),u._addToRenderQueue(t,i,n,r)},t}(),ct=function(){function a(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}m(a,"laya.d3.graphics.StaticBatchManager");var t=a.prototype;return t._finishInit=function(){for(var t in this._staticBatches)this._staticBatches[t]._finishInit();this._initBatchRenderElements.length=0},t._initStaticBatchs=function(t){throw new Error("StaticBatchManager:must override this function.")},t._addInitBatchSprite=function(t){for(var e=t._render._renderElements,i=0,n=e.length;i<n;i++)this._initBatchRenderElements.push(e[i])},t._clearRenderElements=function(){for(var t in this._staticBatches)this._staticBatches[t]._clearRenderElements()},t._garbageCollection=function(t){var e=t._staticBatch,i=e._initBatchRenderElements,n=i.indexOf(t);i.splice(n,1),0===i.length&&(e.dispose(),delete this._staticBatches[e._key])},t._addToRenderQueue=function(t,e,i,n){for(var r in this._staticBatches){var a=this._staticBatches[r];0<a._batchRenderElements.length&&a._updateToRenderQueue(t,n)}},t.dispose=function(){this._staticBatches=null},a._addToStaticBatchQueue=function(t){t instanceof laya.d3.core.RenderableSprite3D&&t._addToInitStaticBatchManager();for(var e=0,i=t.numChildren;e<i;e++)a._addToStaticBatchQueue(t._childs[e])},a.combine=function(t,e){var i,n=0,r=0;if(e)for(n=0,r=e.length;n<r;n++){e[n]._addToInitStaticBatchManager()}else t&&a._addToStaticBatchQueue(t);for(n=0,r=a._staticBatchManagers.length;n<r;n++)(i=a._staticBatchManagers[n])._initStaticBatchs(t),i._finishInit()},a._staticBatchManagers=[],a}(),_t=function(){function t(t,e,i){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=t,this._manager=e,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=i}m(t,"laya.d3.graphics.StaticBatch");var e=t.prototype;return S.imps(e,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),e._binarySearch=function(t){for(var e=0,i=this._batchRenderElements.length-1,n=0;e<=i;)n=Math.floor((e+i)/2),this._compareBatchRenderElement(this._batchRenderElements[n],t)?i=n-1:e=n+1;return e},e._compareBatchRenderElement=function(t,e){throw new Error("StaticBatch:must override this function.")},e._getVertexDecLightMap=function(t){return t===ae.vertexDeclaration?te.vertexDeclaration:t===re.vertexDeclaration?$t.vertexDeclaration:t===jt.vertexDeclaration?zt.vertexDeclaration:t===he.vertexDeclaration?null:t===wt.vertexDeclaration?Mt.vertexDeclaration:t===oe.vertexDeclaration?ie.vertexDeclaration:t===Qt.vertexDeclaration?Jt.vertexDeclaration:t===se.vertexDeclaration?ee.vertexDeclaration:t===re.vertexDeclaration?$t.vertexDeclaration:t===Zt.vertexDeclaration?Gt.vertexDeclaration:t===he.vertexDeclaration?null:t===wt.vertexDeclaration?Mt.vertexDeclaration:t===le.vertexDeclaration?ne.vertexDeclaration:t===Qt.vertexDeclaration?Jt.vertexDeclaration:t},e._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},e._addBatchRenderElement=function(t){this._batchRenderElements.splice(this._binarySearch(t),0,t)},e._updateToRenderQueue=function(t,e){this._combineRenderElementPoolIndex=0,this._getRenderElement(t.getRenderQueue(this._material.renderQueue)._renderElements,t,e)},e._getRenderElement=function(t,e,i){throw new Error("StaticBatch:must override this function.")},e._finishInit=function(){throw new Error("StaticBatch:must override this function.")},e._clearRenderElements=function(){this._batchRenderElements.length=0},e.dispose=function(){},e._getVertexBuffer=function(t){return void 0===t&&(t=0),null},e._getIndexBuffer=function(){return null},e._beforeRender=function(t){return!0},e._render=function(t){},e._getVertexBuffers=function(){return null},e._renderRuntime=function(t,e,i){},_(0,e,"_vertexBufferCount",function(){return 1}),_(0,e,"triangleCount",function(){return 0}),t.combine=function(t){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),ct.combine(t)},t.maxBatchVertexCount=65535,t}(),dt=function(){function u(t,e){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._conchVertexDeclaration=null,this._id=++u._uniqueIDCounter,this._id>u.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",u.maxVertexDeclaration);this._shaderValues=new ke,this._vertexElementsDic={},this._vertexStride=t,this._vertexElements=e,f.isConchNode&&(this._conchVertexDeclaration=new ConchVertexDeclare);for(var i=0;i<e.length;i++){var n=e[i],r=n.elementUsage;this._vertexElementsDic[r]=n;var a=[u._getTypeSize(n.elementFormat)/4,5126,!1,this._vertexStride,n.offset];switch(this._shaderValues.setValue(r,a),r){case 1:this._addShaderDefine(ui.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine(ui.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine(ui.SHADERDEFINE_UV1)}}if(f.isConchNode){for(var s=[],o=0,l=e.length;o<l;o++){var h=e[o];switch(h.elementFormat){case"vector2":s.push({offset:h.offset,elementFormat:35664,elementUsage:h.elementUsage});break;case"vector3":s.push({offset:h.offset,elementFormat:35665,elementUsage:h.elementUsage});break;case"vector4":s.push({offset:h.offset,elementFormat:35666,elementUsage:h.elementUsage})}}this._conchVertexDeclaration.setDelcare(s)}}m(u,"laya.d3.graphics.VertexDeclaration");var t=u.prototype;return t._addShaderDefine=function(t){this._shaderDefineValue|=t,this._conchVertexDeclaration&&this._conchVertexDeclaration.addShaderDefine(t)},t._removeShaderDefine=function(t){this._shaderDefineValue&=~t,this._conchVertexDeclaration&&this._conchVertexDeclaration.removeShaderDefine(t)},t.getVertexElements=function(){return this._vertexElements.slice()},t.getVertexElementByUsage=function(t){return this._vertexElementsDic[t]},t.unBinding=function(){},_(0,t,"shaderDefineValue",function(){return this._shaderDefineValue}),_(0,t,"id",function(){return this._id}),_(0,t,"vertexStride",function(){return this._vertexStride}),_(0,t,"shaderValues",function(){return this._shaderValues}),u._getTypeSize=function(t){switch(t){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},u.getVertexStride=function(t){for(var e=0,i=0;i<t.Length;i++){var n=t[i],r=n.offset+u._getTypeSize(n.elementFormat);e<r&&(e=r)}return e},u._maxVertexDeclarationBit=1e3,u._uniqueIDCounter=1,c(u,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),u}(),ft=function(){function t(t,e,i){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=t,this.elementFormat=e,this.elementUsage=i}return m(t,"laya.d3.graphics.VertexElement"),t}(),pt=(function(){function t(){}m(t,"laya.d3.graphics.VertexElementFormat"),t.Single="single",t.Vector2="vector2",t.Vector3="vector3",t.Vector4="vector4",t.Color="color",t.Byte4="byte4",t.Short2="short2",t.Short4="short4",t.NormalizedShort2="normalizedshort2",t.NormalizedShort4="normalizedshort4",t.HalfVector2="halfvector2",t.HalfVector4="halfvector4"}(),function(){function t(){}m(t,"laya.d3.graphics.VertexElementUsage"),t.POSITION0=0,t.COLOR0=1,t.TEXTURECOORDINATE0=2,t.NORMAL0=3,t.BINORMAL0=4,t.TANGENT0=5,t.BLENDINDICES0=6,t.BLENDWEIGHT0=7,t.DEPTH0=8,t.FOG0=9,t.POINTSIZE0=10,t.SAMPLE0=11,t.TESSELLATEFACTOR0=12,t.COLOR1=13,t.NEXTTEXTURECOORDINATE0=14,t.TEXTURECOORDINATE1=15,t.NEXTTEXTURECOORDINATE1=16,t.CORNERTEXTURECOORDINATE0=17,t.VELOCITY0=18,t.STARTCOLOR0=19,t.STARTSIZE=20,t.AGEADDSCALE0=21,t.STARTROTATION=22,t.ENDCOLOR0=23,t.STARTLIFETIME=24,t.TIME0=33,t.SHAPEPOSITIONSTARTLIFETIME=30,t.DIRECTIONTIME=32,t.SIZEROTATION0=27,t.RADIUS0=28,t.RADIAN0=29,t.STARTSPEED=31,t.RANDOM0=34,t.RANDOM1=35,t.SIMULATIONWORLDPOSTION=36,t.SIMULATIONWORLDROTATION=37,t.TEXTURECOORDINATE0X=38,t.TEXTURECOORDINATE0X1=39,t.TEXTURECOORDINATE0Y=40,t.OFFSETVECTOR=41}(),function(){function t(t,e,i){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=t,this._textureCoordinate0=e,this._time=i}m(t,"laya.d3.graphics.VertexGlitter");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"textureCoordinate",function(){return this._textureCoordinate0}),_(0,e,"position",function(){return this._position}),_(0,e,"time",function(){return this._time}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(24,[new ft(0,"vector3",0),new ft(12,"vector2",2),new ft(20,"single",33)])}]),t}()),mt=(function(){function t(t,e,i,n,r,a,s,o,l,h){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=t,this._position=e,this._velocity=i,this._startColor=n,this._endColor=r,this._sizeRotation=a,this._radius=s,this._radian=o,this._ageAddScale=l,this._time=h}m(t,"laya.d3.graphics.VertexParticle");var e=t.prototype;S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"endColor",function(){return this._endColor}),_(0,e,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),_(0,e,"sizeRotation",function(){return this._sizeRotation}),_(0,e,"velocity",function(){return this._velocity}),_(0,e,"position",function(){return this._position}),_(0,e,"startColor",function(){return this._startColor}),_(0,e,"radius",function(){return this._radius}),_(0,e,"radian",function(){return this._radian}),_(0,e,"ageAddScale",function(){return this._ageAddScale}),_(0,e,"time",function(){return this._time}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(116,[new ft(0,"vector4",17),new ft(16,"vector3",0),new ft(28,"vector3",18),new ft(40,"vector4",19),new ft(56,"vector4",23),new ft(72,"vector3",27),new ft(84,"vector2",28),new ft(92,"vector4",29),new ft(108,"single",24),new ft(112,"single",33)])}])}(),function(){function t(t){this._position=null,this._position=t}m(t,"laya.d3.graphics.VertexPosition");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"position",function(){return this._position}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(12,[new ft(0,"vector3",0)])}]),t}()),gt=function(){function t(t,e){this._position=null,this._normal=null,this._position=t,this._normal=e}m(t,"laya.d3.graphics.VertexPositionNormal");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(24,[new ft(0,"vector3",0),new ft(12,"vector3",3)])}]),t}(),vt=function(){function t(t,e,i){this._position=null,this._normal=null,this._color=null,this._position=t,this._normal=e,this._color=i}m(t,"laya.d3.graphics.VertexPositionNormalColor");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"color",function(){return this._color}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(40,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector4",1)])}]),t}(),yt=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._color=i,this._blendIndex=n,this._blendWeight=r}m(t,"laya.d3.graphics.VertexPositionNormalColorSkin");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"blendWeight",function(){return this._blendWeight}),_(0,e,"color",function(){return this._color}),_(0,e,"blendIndex",function(){return this._blendIndex}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(72,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector4",1),new ft(40,"vector4",7),new ft(56,"vector4",6)])}]),t}(),xt=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._tangent=n,this._blendIndex=r,this._blendWeight=a}m(t,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"tangent",function(){return this._tangent}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"blendWeight",function(){return this._blendWeight}),_(0,e,"color",function(){return this._color}),_(0,e,"blendIndex",function(){return this._blendIndex}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(88,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector4",1),new ft(40,"vector4",7),new ft(56,"vector4",6),new ft(72,"vector4",5)])}]),t}(),Et=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._tangent=n,this._blendIndex=r,this._blendWeight=a}m(t,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"tangent",function(){return this._tangent}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"blendWeight",function(){return this._blendWeight}),_(0,e,"color",function(){return this._color}),_(0,e,"blendIndex",function(){return this._blendIndex}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(84,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector4",1),new ft(40,"vector4",7),new ft(56,"vector4",6),new ft(72,"vector3",5)])}]),t}(),Tt=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._tangent=n}m(t,"laya.d3.graphics.VertexPositionNormalColorSTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"tangent",function(){return this._tangent}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"color",function(){return this._color}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(56,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector4",1),new ft(40,"vector4",5)])}]),t}(),St=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._tangent=n}m(t,"laya.d3.graphics.VertexPositionNormalColorTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"tangent",function(){return this._tangent}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"color",function(){return this._color}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(52,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector4",1),new ft(40,"vector3",5)])}]),t}(),wt=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n}m(t,"laya.d3.graphics.VertexPositionNormalColorTexture");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"textureCoordinate",function(){return this._textureCoordinate}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"color",function(){return this._color}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(48,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector4",1),new ft(40,"vector2",2)])}]),t}(),Mt=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r}m(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"color",function(){return this._color}),_(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(56,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector4",1),new ft(40,"vector2",2),new ft(48,"vector2",15)])}]),t}(),Ut=function(){function t(t,e,i,n,r,a,s){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._blendIndex=a,this._blendWeight=s}m(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"blendWeight",function(){return this._blendWeight}),_(0,e,"color",function(){return this._color}),_(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),_(0,e,"blendIndex",function(){return this._blendIndex}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(88,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector4",1),new ft(40,"vector2",2),new ft(48,"vector2",15),new ft(56,"vector4",7),new ft(72,"vector4",6)])}]),t}(),kt=function(){function t(t,e,i,n,r,a,s,o){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=a,this._blendIndex=s,this._blendWeight=o}m(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"tangent",function(){return this._tangent}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"blendWeight",function(){return this._blendWeight}),_(0,e,"color",function(){return this._color}),_(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),_(0,e,"blendIndex",function(){return this._blendIndex}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(104,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector4",1),new ft(40,"vector2",2),new ft(48,"vector2",15),new ft(56,"vector4",7),new ft(72,"vector4",6),new ft(88,"vector4",5)])}]),t}(),Ht=function(){function t(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}m(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalColorTexture0SkinTangent=function(t,e,i,n,r,a,s,o){this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=a,this._blendIndex=s,this._blendWeight=o},_(0,e,"tangent",function(){return this._tangent}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"blendWeight",function(){return this._blendWeight}),_(0,e,"color",function(){return this._color}),_(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),_(0,e,"blendIndex",function(){return this._blendIndex}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(100,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector4",1),new ft(40,"vector2",2),new ft(48,"vector2",15),new ft(56,"vector4",7),new ft(72,"vector4",6),new ft(88,"vector3",5)])}]),t}(),zt=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=a}m(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"tangent",function(){return this._tangent}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"color",function(){return this._color}),_(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(72,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector4",1),new ft(40,"vector2",2),new ft(48,"vector2",15),new ft(56,"vector4",5)])}]),t}(),Gt=function(){function t(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}m(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalColorTexture0Tangent=function(t,e,i,n,r,a){this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=a},_(0,e,"tangent",function(){return this._tangent}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"color",function(){return this._color}),_(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(68,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector4",1),new ft(40,"vector2",2),new ft(48,"vector2",15),new ft(56,"vector3",5)])}]),t}(),Wt=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._blendIndex=r,this._blendWeight=a}m(t,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"textureCoordinate",function(){return this._textureCoordinate}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"blendWeight",function(){return this._blendWeight}),_(0,e,"color",function(){return this._color}),_(0,e,"blendIndex",function(){return this._blendIndex}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(80,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector4",1),new ft(40,"vector2",2),new ft(48,"vector4",7),new ft(64,"vector4",6)])}]),t}(),Xt=function(){function t(t,e,i,n,r,a,s){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._tangent=r,this._blendIndex=a,this._blendWeight=s}m(t,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"tangent",function(){return this._tangent}),_(0,e,"textureCoordinate",function(){return this._textureCoordinate}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"blendWeight",function(){return this._blendWeight}),_(0,e,"color",function(){return this._color}),_(0,e,"blendIndex",function(){return this._blendIndex}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(96,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector4",1),new ft(40,"vector2",2),new ft(48,"vector4",7),new ft(64,"vector4",6),new ft(80,"vector4",5)])}]),t}(),Yt=function(){function t(t,e,i,n,r,a,s){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._tangent=r,this._blendIndex=a,this._blendWeight=s}m(t,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"tangent",function(){return this._tangent}),_(0,e,"textureCoordinate",function(){return this._textureCoordinate}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"blendWeight",function(){return this._blendWeight}),_(0,e,"color",function(){return this._color}),_(0,e,"blendIndex",function(){return this._blendIndex}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(92,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector4",1),new ft(40,"vector2",2),new ft(48,"vector4",7),new ft(64,"vector4",6),new ft(80,"vector3",5)])}]),t}(),jt=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._tangent=r}m(t,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"tangent",function(){return this._tangent}),_(0,e,"textureCoordinate",function(){return this._textureCoordinate}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"color",function(){return this._color}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(64,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector4",1),new ft(40,"vector2",2),new ft(48,"vector4",5)])}]),t}(),Zt=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._tangent=r}m(t,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"tangent",function(){return this._tangent}),_(0,e,"textureCoordinate",function(){return this._textureCoordinate}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"color",function(){return this._color}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(60,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector4",1),new ft(40,"vector2",2),new ft(48,"vector3",5)])}]),t}(),Kt=function(){function t(t,e,i){this._position=null,this._normal=null,this._tangent=null,this._position=t,this._normal=e,this._tangent=i}m(t,"laya.d3.graphics.VertexPositionNormalSTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"tangent",function(){return this._tangent}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(40,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector4",5)])}]),t}(),qt=function(){function t(t,e,i){this._position=null,this._normal=null,this._tangent=null,this._position=t,this._normal=e,this._tangent=i}m(t,"laya.d3.graphics.VertexPositionNormalTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"tangent",function(){return this._tangent}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(36,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector3",5)])}]),t}(),Qt=function(){function t(t,e,i){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._textureCoordinate=i}m(t,"laya.d3.graphics.VertexPositionNormalTexture");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"textureCoordinate",function(){return this._textureCoordinate}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(32,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector2",2)])}]),t}(),Jt=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n}m(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(40,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector2",2),new ft(32,"vector2",15)])}]),t}(),$t=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._blendIndex=r,this._blendWeight=a}m(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),_(0,e,"blendIndex",function(){return this._blendIndex}),_(0,e,"blendWeight",function(){return this._blendWeight}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(72,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector2",2),new ft(32,"vector2",15),new ft(40,"vector4",7),new ft(56,"vector4",6)])}]),t}(),te=function(){function t(t,e,i,n,r,a,s){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=r,this._blendIndex=a,this._blendWeight=s}m(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"tangent",function(){return this._tangent}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),_(0,e,"blendIndex",function(){return this._blendIndex}),_(0,e,"blendWeight",function(){return this._blendWeight}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(88,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector2",2),new ft(32,"vector2",15),new ft(40,"vector4",7),new ft(56,"vector4",6),new ft(72,"vector4",5)])}]),t}(),ee=function(){function t(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}m(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalTexture0SkinTangent=function(t,e,i,n,r,a,s){this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=r,this._blendIndex=a,this._blendWeight=s},_(0,e,"tangent",function(){return this._tangent}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),_(0,e,"blendIndex",function(){return this._blendIndex}),_(0,e,"blendWeight",function(){return this._blendWeight}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(84,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector2",2),new ft(32,"vector2",15),new ft(40,"vector4",7),new ft(56,"vector4",6),new ft(72,"vector3",5)])}]),t}(),ie=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=r}m(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"tangent",function(){return this._tangent}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(56,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector2",2),new ft(32,"vector2",15),new ft(40,"vector4",5)])}]),t}(),ne=function(){function t(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}m(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalTexture0Tangent=function(t,e,i,n,r){this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=r},_(0,e,"tangent",function(){return this._tangent}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(52,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector2",2),new ft(32,"vector2",15),new ft(40,"vector3",5)])}]),t}(),re=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._blendIndex=n,this._blendWeight=r}m(t,"laya.d3.graphics.VertexPositionNormalTextureSkin");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"textureCoordinate",function(){return this._textureCoordinate}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"blendIndex",function(){return this._blendIndex}),_(0,e,"blendWeight",function(){return this._blendWeight}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(64,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector2",2),new ft(32,"vector4",7),new ft(48,"vector4",6)])}]),t}(),ae=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._tangent=n,this._blendIndex=r,this._blendWeight=a}m(t,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"tangent",function(){return this._tangent}),_(0,e,"textureCoordinate",function(){return this._textureCoordinate}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"blendIndex",function(){return this._blendIndex}),_(0,e,"blendWeight",function(){return this._blendWeight}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(80,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector2",2),new ft(32,"vector4",7),new ft(48,"vector4",6),new ft(64,"vector4",5)])}]),t}(),se=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._tangent=n,this._blendIndex=r,this._blendWeight=a}m(t,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"tangent",function(){return this._tangent}),_(0,e,"textureCoordinate",function(){return this._textureCoordinate}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"blendIndex",function(){return this._blendIndex}),_(0,e,"blendWeight",function(){return this._blendWeight}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(76,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector2",2),new ft(32,"vector4",7),new ft(48,"vector4",6),new ft(64,"vector3",5)])}]),t}(),oe=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._tangent=n}m(t,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"tangent",function(){return this._tangent}),_(0,e,"textureCoordinate",function(){return this._textureCoordinate}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(48,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector2",2),new ft(32,"vector4",5)])}]),t}(),le=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._tangent=n}m(t,"laya.d3.graphics.VertexPositionNormalTextureTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"tangent",function(){return this._tangent}),_(0,e,"textureCoordinate",function(){return this._textureCoordinate}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(44,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector2",2),new ft(32,"vector3",5)])}]),t}(),he=function(){function t(t,e,i){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._textureCoordinate=i}m(t,"laya.d3.graphics.VertexPositionNTBTexture");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"textureCoordinate",function(){return this._textureCoordinate}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(56,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector3",5),new ft(36,"vector3",4),new ft(48,"vector2",2)])}]),t}(),ue=function(){function t(t,e,i,n,r,a,s,o){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=t,this._normal=e,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=a,i=i,this._blendIndex=s,this._blendWeight=o}m(t,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"tangent",function(){return this._tangent}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),_(0,e,"blendIndex",function(){return this._blendIndex}),_(0,e,"blendWeight",function(){return this._blendWeight}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(96,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector3",5),new ft(36,"vector3",4),new ft(48,"vector2",2),new ft(56,"vector2",15),new ft(64,"vector4",7),new ft(80,"vector4",6)])}]),t}(),ce=function(){function t(t,e,i){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._textureCoordinate=i}m(t,"laya.d3.graphics.VertexPositionNTBTextureSkin");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"textureCoordinate",function(){return this._textureCoordinate}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(88,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector3",5),new ft(36,"vector3",4),new ft(48,"vector2",2),new ft(56,"vector4",7),new ft(72,"vector4",6)])}]),t}(),_e=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=t,this._normal=e,this._textureCoord0=i,this._textureCoord1=n}m(t,"laya.d3.graphics.VertexPositionTerrain");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"normal",function(){return this._normal}),_(0,e,"position",function(){return this._position}),_(0,e,"textureCoord0",function(){return this._textureCoord0}),_(0,e,"textureCoord1",function(){return this._textureCoord1}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(40,[new ft(0,"vector3",0),new ft(12,"vector3",3),new ft(24,"vector2",2),new ft(32,"vector2",15)])}]),t}(),de=function(){function t(t,e){this._position=null,this._textureCoordinate0=null,this._position=t,this._textureCoordinate0=e}m(t,"laya.d3.graphics.VertexPositionTexture0");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"position",function(){return this._position}),_(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(20,[new ft(0,"vector3",0),new ft(12,"vector2",2)])}]),t}(),fe=function(){function t(t,e,i,n,r,a,s,o,l,h,u,c,_,d){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=t,this._positionStartLifeTime=e,this._velocity=i,this._startColor=n,this._startSize=r,this._startRotation0=a,this._startRotation1=s,this._startRotation2=o,this._startLifeTime=l,this._time=h,this._startSpeed=u,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=d}m(t,"laya.d3.graphics.VertexShurikenParticleBillboard");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),_(0,e,"random1",function(){return this._randoms1}),_(0,e,"startRotation2",function(){return this._startRotation2}),_(0,e,"positionStartLifeTime",function(){return this._positionStartLifeTime}),_(0,e,"velocity",function(){return this._velocity}),_(0,e,"random0",function(){return this._randoms0}),_(0,e,"startSize",function(){return this._startSize}),_(0,e,"startColor",function(){return this._startColor}),_(0,e,"startRotation0",function(){return this._startRotation0}),_(0,e,"startRotation1",function(){return this._startRotation1}),_(0,e,"startLifeTime",function(){return this._startLifeTime}),_(0,e,"time",function(){return this._time}),_(0,e,"startSpeed",function(){return this._startSpeed}),_(0,e,"simulationWorldPostion",function(){return this._simulationWorldPostion}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(152,[new ft(0,"vector4",17),new ft(16,"vector4",30),new ft(32,"vector4",32),new ft(48,"vector4",19),new ft(64,"vector3",20),new ft(76,"vector3",22),new ft(88,"single",31),new ft(92,"vector4",34),new ft(108,"vector4",35),new ft(124,"vector3",36),new ft(136,"vector4",37)])}]),t}(),pe=function(){function t(t,e,i,n,r,a,s,o,l,h,u,c,_,d){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=t,this._positionStartLifeTime=e,this._velocity=i,this._startColor=n,this._startSize=r,this._startRotation0=a,this._startRotation1=s,this._startRotation2=o,this._startLifeTime=l,this._time=h,this._startSpeed=u,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=d}m(t,"laya.d3.graphics.VertexShurikenParticleMesh");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),_(0,e,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),_(0,e,"velocity",function(){return this._velocity}),_(0,e,"position",function(){return this._positionStartLifeTime}),_(0,e,"random0",function(){return this._randoms0}),_(0,e,"startSize",function(){return this._startSize}),_(0,e,"startColor",function(){return this._startColor}),_(0,e,"startRotation0",function(){return this._startRotation0}),_(0,e,"startRotation1",function(){return this._startRotation1}),_(0,e,"random1",function(){return this._randoms1}),_(0,e,"startRotation2",function(){return this._startRotation2}),_(0,e,"startLifeTime",function(){return this._startLifeTime}),_(0,e,"time",function(){return this._time}),_(0,e,"startSpeed",function(){return this._startSpeed}),_(0,e,"simulationWorldPostion",function(){return this._simulationWorldPostion}),_(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),_(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),c(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new dt(172,[new ft(0,"vector3",0),new ft(12,"vector4",1),new ft(28,"vector2",2),new ft(36,"vector4",30),new ft(52,"vector4",32),new ft(68,"vector4",19),new ft(84,"vector3",20),new ft(96,"vector3",22),new ft(108,"single",31),new ft(112,"vector4",34),new ft(128,"vector4",35),new ft(144,"vector3",36),new ft(156,"vector4",37)])}]),t}(),me=function(){function y(t,e,i,n,r,a){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=i,this._materials=n,this._subMeshes=r,this._materialMap=a,this._version=e,this._onLoaded(t)}m(y,"laya.d3.loaders.LoadModelV01");var t=y.prototype;return t._onLoaded=function(t){this._readData=t,this.READ_BLOCK();for(var e=0;e<this._BLOCK.count;e++){var i=this._readData.getUint16(),n=this._strings[i],r=this["READ_"+n];if(null==r)throw new Error("model file err,no this function:"+i+" "+n);if(!r.call(this))break}return this._mesh},t.onError=function(){},t._readString=function(){return this._strings[this._readData.getUint16()]},t.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},t.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},t.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var t=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var e=0;e<this._STRINGS.size;e++)this._strings[e]=this._readData.readUTFString();return this._readData.pos=t,!0},t.READ_MATERIAL=function(){var t=this._readData.getUint16(),e=(this._readString(),this._readString());return this._materials[t]="null"!==e?Dt.getRes(this._materialMap[e]):new mi,!0},t.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var t,e=this._readData.__getBuffer(),i=0,n=this._readData.getUint32(),r=this._readData.getUint32(),a=(new Float32Array(e.slice(n+this._DATA.offset,n+this._DATA.offset+r)),this._readData.getUint32()),s=this._readData.getUint32(),o=new Float32Array(e.slice(a+this._DATA.offset,a+this._DATA.offset+s));for(this.mesh._inverseBindPoses=[],i=0,t=o.length;i<t;i+=16){var l=new De(o[i+0],o[i+1],o[i+2],o[i+3],o[i+4],o[i+5],o[i+6],o[i+7],o[i+8],o[i+9],o[i+10],o[i+11],o[i+12],o[i+13],o[i+14],o[i+15]);this.mesh._inverseBindPoses.push(l)}break;default:throw new Error("LoadModel:unknown version.")}return!0},t.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var t=this._readString();this._shaderAttributes=t.match(y._attrReg);var e=this._readData.getUint32(),i=this._readData.getUint32(),n=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),r=this._readData.getUint32(),a=this._readData.getUint32(),s=this._readData.getUint32(),o=this._readData.__getBuffer(),l=new Fe(this._mesh),h=this._getVertexDeclaration(),u=Zi.create(h,r/h.vertexStride,35044,!0),c=n+this._DATA.offset,_=o.slice(c,c+r);u.setData(new Float32Array(_));for(var d=(l._vertexBuffer=u).vertexDeclaration.getVertexElements(),f=0;f<d.length;f++)l._bufferUsage[d[f].elementUsage]=u;var p=ji.create("ushort",i/2,35044,!0),m=e+this._DATA.offset,g=o.slice(m,m+i);p.setData(new Uint16Array(g)),l._indexBuffer=p;var v=o.slice(a+this._DATA.offset,a+this._DATA.offset+s);return l._boneIndicesList[0]=new Uint8Array(v),this._subMeshes.push(l),!0},t.READ_DATAAREA=function(){return!1},t._getVertexDeclaration=function(){for(var t,e=!1,i=!1,n=!1,r=!1,a=!1,s=!1,o=!1,l=!1,h=!1,u=0;u<this._shaderAttributes.length;u+=8)switch(this._shaderAttributes[u]){case"POSITION":e=!0;break;case"NORMAL":i=!0;break;case"COLOR":n=!0;break;case"UV":r=!0;break;case"UV1":a=!0;break;case"BLENDWEIGHT":o=!0;break;case"BLENDINDICES":l=!0;break;case"TANGENT":s=!0;break;case"BINORMAL":h=!0}return e&&i&&n&&r&&a&&o&&l&&s?t=Ht.vertexDeclaration:e&&i&&n&&r&&a&&o&&l?t=Ut.vertexDeclaration:e&&i&&r&&a&&o&&l&&s?t=ee.vertexDeclaration:e&&i&&r&&a&&o&&l?t=$t.vertexDeclaration:e&&i&&n&&r&&o&&l&&s?t=Yt.vertexDeclaration:e&&i&&n&&r&&o&&l?t=Wt.vertexDeclaration:e&&i&&s&&h&&r&&o&&l?t=ce.vertexDeclaration:e&&i&&r&&o&&l&&s?t=se.vertexDeclaration:e&&i&&r&&o&&l?t=re.vertexDeclaration:e&&i&&n&&o&&l&&s?t=Et.vertexDeclaration:e&&i&&n&&o&&l?t=yt.vertexDeclaration:e&&i&&n&&r&&a&&s?t=Gt.vertexDeclaration:e&&i&&n&&r&&a?t=Mt.vertexDeclaration:e&&i&&r&&a&&s?t=ne.vertexDeclaration:e&&i&&r&&a?t=Jt.vertexDeclaration:e&&i&&n&&r&&s?t=Zt.vertexDeclaration:e&&i&&r&&s&&h?t=he.vertexDeclaration:e&&i&&n&&r?t=wt.vertexDeclaration:e&&i&&r&&s?t=le.vertexDeclaration:e&&i&&r?t=Qt.vertexDeclaration:e&&i&&n&&s?t=St.vertexDeclaration:e&&i&&n&&(t=vt.vertexDeclaration),t},_(0,t,"mesh",function(){return this._mesh}),y._attrReg=new RegExp("(\\w+)|([:,;])","g"),y}(),ge=function(){function S(){}return m(S,"laya.d3.loaders.LoadModelV02"),S.parse=function(t,e,i,n,r,a){S._mesh=i,S._materials=n,S._subMeshes=r,S._materialMap=a,S._version=e,S._readData=t,S.READ_DATA(),S.READ_BLOCK(),S.READ_STRINGS();for(var s=0,o=S._BLOCK.count;s<o;s++){S._readData.pos=S._BLOCK.blockStarts[s];var l=S._readData.getUint16(),h=S._strings[l],u=S["READ_"+h];if(null==u)throw new Error("model file err,no this function:"+l+" "+h);u.call()}S._strings.length=0,S._readData=null,S._version=null,S._mesh=null,S._materials=null,S._subMeshes=null,S._materialMap=null},S._readString=function(){return S._strings[S._readData.getUint16()]},S.READ_DATA=function(){S._DATA.offset=S._readData.getUint32(),S._DATA.size=S._readData.getUint32()},S.READ_BLOCK=function(){for(var t=S._BLOCK.count=S._readData.getUint16(),e=S._BLOCK.blockStarts=[],i=S._BLOCK.blockLengths=[],n=0;n<t;n++)e.push(S._readData.getUint32()),i.push(S._readData.getUint32())},S.READ_STRINGS=function(){var t=S._readData.getUint32(),e=S._readData.getUint16(),i=S._readData.pos;S._readData.pos=t+S._DATA.offset;for(var n=0;n<e;n++)S._strings[n]=S._readData.readUTFString();S._readData.pos=i},S.READ_MATERIAL=function(){S._readString(),S._readString();var t=S._readString();return""!==t&&S._materials.push(Dt.getRes(S._materialMap[t])),!0},S.READ_MESH=function(){S._readString();var t,e=S._readData.__getBuffer(),i=0,n=S._readData.getInt16(),r=S._DATA.offset;for(i=0;i<n;i++){var a=r+S._readData.getUint32(),s=S._readData.getUint32(),o=new Float32Array(e.slice(a,a+s)),l=S._readString().match(S._attrReg),h=S._getVertexDeclaration(l),u=Zi.create(h,4*o.length/h.vertexStride,35044,!0);u.setData(o),S._mesh._vertexBuffers.push(u)}var c=r+S._readData.getUint32(),_=S._readData.getUint32(),d=new Uint16Array(e.slice(c,c+_)),f=ji.create("ushort",_/2,35044,!0);f.setData(d),S._mesh._indexBuffer=f;var p=S._mesh._boneNames=[],m=S._readData.getUint16();for(p.length=m,i=0;i<m;i++)p[i]=S._strings[S._readData.getUint16()];var g=S._readData.getUint32(),v=S._readData.getUint32(),y=(new Float32Array(e.slice(r+g,r+g+v)),S._readData.getUint32()),x=S._readData.getUint32(),E=new Float32Array(e.slice(r+y,r+y+x));for(S._mesh._inverseBindPoses=[],i=0,t=E.length;i<t;i+=16){var T=new De(E[i+0],E[i+1],E[i+2],E[i+3],E[i+4],E[i+5],E[i+6],E[i+7],E[i+8],E[i+9],E[i+10],E[i+11],E[i+12],E[i+13],E[i+14],E[i+15]);S._mesh._inverseBindPoses.push(T)}return S._mesh._skinnedDatas=new Float32Array(16*E.length),!0},S.READ_SUBMESH=function(){var t=S._readData.__getBuffer(),e=new Fe(S._mesh),i=S._readData.getInt16(),n=S._readData.getUint32(),r=S._readData.getUint32();e._vertexBuffer=S._mesh._vertexBuffers[i],e._vertexStart=n,e._vertexCount=r;var a=S._readData.getUint32(),s=S._readData.getUint32(),o=S._mesh._indexBuffer;e._indexBuffer=o,e._indexStart=a,e._indexCount=s,e._indices=new Uint16Array(o.getData().buffer,2*a,s);var l=S._DATA.offset,h=e._subIndexBufferStart,u=e._subIndexBufferCount,c=e._boneIndicesList,_=S._readData.getUint16();h.length=_,u.length=_,c.length=_;for(var d=0;d<_;d++){h[d]=S._readData.getUint32(),u[d]=S._readData.getUint32();var f=S._readData.getUint32(),p=S._readData.getUint32();e._boneIndicesList[d]=new Uint8Array(t.slice(l+f,l+f+p))}return S._subMeshes.push(e),!0},S._getVertexDeclaration=function(t){for(var e,i=!1,n=!1,r=!1,a=!1,s=!1,o=!1,l=!1,h=!1,u=!1,c=0;c<t.length;c++)switch(t[c]){case"POSITION":i=!0;break;case"NORMAL":n=!0;break;case"COLOR":r=!0;break;case"UV":a=!0;break;case"UV1":s=!0;break;case"BLENDWEIGHT":l=!0;break;case"BLENDINDICES":h=!0;break;case"TANGENT":o=!0;break;case"BINORMAL":u=!0}return i&&n&&r&&a&&s&&l&&h&&o?e=Ht.vertexDeclaration:i&&n&&r&&a&&s&&l&&h?e=Ut.vertexDeclaration:i&&n&&a&&s&&l&&h&&o?e=ee.vertexDeclaration:i&&n&&a&&s&&l&&h?e=$t.vertexDeclaration:i&&n&&r&&a&&l&&h&&o?e=Yt.vertexDeclaration:i&&n&&r&&a&&l&&h?e=Wt.vertexDeclaration:i&&n&&a&&l&&h&&o?e=se.vertexDeclaration:i&&n&&a&&l&&h?e=re.vertexDeclaration:i&&n&&r&&l&&h&&o?e=Et.vertexDeclaration:i&&n&&r&&l&&h?e=yt.vertexDeclaration:i&&n&&r&&a&&s&&o?e=Gt.vertexDeclaration:i&&n&&r&&a&&s?e=Mt.vertexDeclaration:i&&n&&a&&s&&o?e=ne.vertexDeclaration:i&&n&&a&&s?e=Jt.vertexDeclaration:i&&n&&r&&a&&o?e=Zt.vertexDeclaration:i&&n&&a&&o&&u?e=he.vertexDeclaration:i&&n&&r&&a?e=wt.vertexDeclaration:i&&n&&a&&o?e=le.vertexDeclaration:i&&n&&a?e=Qt.vertexDeclaration:i&&n&&r&&o?e=St.vertexDeclaration:i&&n&&r&&(e=vt.vertexDeclaration),e},S._attrReg=new RegExp("(\\w+)|([:,;])","g"),S._strings=[],S._readData=null,S._version=null,S._mesh=null,S._materials=null,S._subMeshes=null,S._materialMap=null,c(S,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),S}(),ve=function(){function E(){}return m(E,"laya.d3.loaders.LoadModelV03"),E.parse=function(t,e,i,n,r){E._mesh=i,E._subMeshes=n,E._materialMap=r,E._version=e,E._readData=t,E.READ_DATA(),E.READ_BLOCK(),E.READ_STRINGS();for(var a=0,s=E._BLOCK.count;a<s;a++){E._readData.pos=E._BLOCK.blockStarts[a];var o=E._readData.getUint16(),l=E._strings[o],h=E["READ_"+l];if(null==h)throw new Error("model file err,no this function:"+o+" "+l);h.call()}E._strings.length=0,E._readData=null,E._version=null,E._mesh=null,E._subMeshes=null,E._materialMap=null},E._readString=function(){return E._strings[E._readData.getUint16()]},E.READ_DATA=function(){E._DATA.offset=E._readData.getUint32(),E._DATA.size=E._readData.getUint32()},E.READ_BLOCK=function(){for(var t=E._BLOCK.count=E._readData.getUint16(),e=E._BLOCK.blockStarts=[],i=E._BLOCK.blockLengths=[],n=0;n<t;n++)e.push(E._readData.getUint32()),i.push(E._readData.getUint32())},E.READ_STRINGS=function(){var t=E._readData.getUint32(),e=E._readData.getUint16(),i=E._readData.pos;E._readData.pos=t+E._DATA.offset;for(var n=0;n<e;n++)E._strings[n]=E._readData.readUTFString();E._readData.pos=i},E.READ_MESH=function(){E._readString();var t,e=E._readData.__getBuffer(),i=0,n=E._readData.getInt16(),r=E._DATA.offset;for(i=0;i<n;i++){var a,s=r+E._readData.getUint32(),o=E._readData.getUint32(),l=new Float32Array(e.slice(s,s+o)),h=E._readString();switch(E._version){case"LAYAMODEL:03":a=E._vertexDeclarationMap_Discard[h];break;case"LAYAMODEL:0301":a=E._vertexDeclarationMap[h];break;default:throw new Error("LoadModelV03: unknown version.")}if(!a)throw new Error("LoadModelV03: unknown vertexDeclaration.");var u=Zi.create(a,4*l.length/a.vertexStride,35044,!0);u.setData(l),E._mesh._vertexBuffers.push(u)}var c=r+E._readData.getUint32(),_=E._readData.getUint32(),d=new Uint16Array(e.slice(c,c+_)),f=ji.create("ushort",_/2,35044,!0);f.setData(d),E._mesh._indexBuffer=f;var p=E._mesh._boneNames=[],m=E._readData.getUint16();for(p.length=m,i=0;i<m;i++)p[i]=E._strings[E._readData.getUint16()];E._readData.pos+=8;var g=E._readData.getUint32(),v=E._readData.getUint32(),y=new Float32Array(e.slice(r+g,r+g+v));for(E._mesh._inverseBindPoses=[],i=0,t=y.length;i<t;i+=16){var x=new De(y[i+0],y[i+1],y[i+2],y[i+3],y[i+4],y[i+5],y[i+6],y[i+7],y[i+8],y[i+9],y[i+10],y[i+11],y[i+12],y[i+13],y[i+14],y[i+15]);E._mesh._inverseBindPoses.push(x)}return E._mesh._skinnedDatas=new Float32Array(16*y.length),!0},E.READ_SUBMESH=function(){var t=E._readData.__getBuffer(),e=new Fe(E._mesh),i=E._readData.getInt16(),n=E._readData.getUint32(),r=E._readData.getUint32();e._vertexBuffer=E._mesh._vertexBuffers[i],e._vertexStart=n,e._vertexCount=r;var a=E._readData.getUint32(),s=E._readData.getUint32(),o=E._mesh._indexBuffer;e._indexBuffer=o,e._indexStart=a,e._indexCount=s,e._indices=new Uint16Array(o.getData().buffer,2*a,s);var l=E._DATA.offset,h=e._subIndexBufferStart,u=e._subIndexBufferCount,c=e._boneIndicesList,_=E._readData.getUint16();h.length=_,u.length=_,c.length=_;for(var d=0;d<_;d++){h[d]=E._readData.getUint32(),u[d]=E._readData.getUint32();var f=E._readData.getUint32(),p=E._readData.getUint32();c[d]=new Uint8Array(t.slice(l+f,l+f+p))}return E._subMeshes.push(e),!0},E._strings=[],E._readData=null,E._version=null,E._mesh=null,E._subMeshes=null,E._materialMap=null,c(E,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":Ht.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":Ut.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":ue.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":ee.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":$t.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":Yt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":Wt.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":se.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":re.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":Et.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":yt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":Gt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":Mt.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":ne.vertexDeclaration,"POSITION,NORMAL,UV,UV1":Jt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":Zt.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":he.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":wt.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":le.vertexDeclaration,"POSITION,NORMAL,UV":Qt.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":St.vertexDeclaration,"POSITION,NORMAL,COLOR":vt.vertexDeclaration,"POSITION,NORMAL,TANGENT":qt.vertexDeclaration,"POSITION,NORMAL":gt.vertexDeclaration,"POSITION,UV":de.vertexDeclaration,POSITION:mt.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":kt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":Ut.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":ue.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":te.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":$t.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":Xt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":Wt.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":ae.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":re.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":xt.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":yt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":zt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":Mt.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":ie.vertexDeclaration,"POSITION,NORMAL,UV,UV1":Jt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":jt.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":he.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":wt.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":oe.vertexDeclaration,"POSITION,NORMAL,UV":Qt.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":Tt.vertexDeclaration,"POSITION,NORMAL,COLOR":vt.vertexDeclaration,"POSITION,NORMAL,TANGENT":Kt.vertexDeclaration,"POSITION,NORMAL":gt.vertexDeclaration,"POSITION,UV":de.vertexDeclaration,POSITION:mt.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),E}(),ye=function(){function o(){}return m(o,"laya.d3.loaders.MeshReader"),o.read=function(t,e,i,n,r){var a=new x(t);a.pos=0;var s=a.readUTFString();switch(s){case"LAYAMODEL:01":case"LAYASKINANI:01":o._readVersion01(a,s,e,i,n,r);break;case"LAYAMODEL:02":ge.parse(a,s,e,i,n,r);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":ve.parse(a,s,e,n,r);break;default:throw new Error("MeshReader: unknown mesh version.")}e._setSubMeshes(n)},o._readVersion01=function(t,e,i,n,r,a){new me(t,e,i,n,r,a)},o}(),xe=function(){function t(t,e){this.min=null,this.max=null,this.min=t,this.max=e}m(t,"laya.d3.math.BoundBox");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.getCorners=function(t){t.length=8;var e=this.min.elements,i=this.max.elements,n=e[0],r=e[1],a=e[2],s=i[0],o=i[1],l=i[2];t[0]=new Oe(n,o,l),t[1]=new Oe(s,o,l),t[2]=new Oe(s,r,l),t[3]=new Oe(n,r,l),t[4]=new Oe(n,o,a),t[5]=new Oe(s,o,a),t[6]=new Oe(s,r,a),t[7]=new Oe(n,r,a)},e.toDefault=function(){this.min.toDefault(),this.max.toDefault()},e.cloneTo=function(t){var e=t;this.min.cloneTo(e.min),this.max.cloneTo(e.max)},e.clone=function(){var t=new this.constructor(new Oe,new Oe);return this.cloneTo(t),t},t.createfromPoints=function(t,e){if(null==t)throw new Error("points");var i=e.min,n=e.max,r=i.elements;r[0]=Number.MAX_VALUE,r[1]=Number.MAX_VALUE,r[2]=Number.MAX_VALUE;var a=n.elements;a[0]=-Number.MAX_VALUE,a[1]=-Number.MAX_VALUE,a[2]=-Number.MAX_VALUE;for(var s=0,o=t.length;s<o;++s)Oe.min(i,t[s],i),Oe.max(n,t[s],n)},t.merge=function(t,e,i){Oe.min(t.min,e.min,i.min),Oe.max(t.max,e.max,i.max)},t}(),Ee=function(){function h(t){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=t,this._near=new be(new Oe),this._far=new be(new Oe),this._left=new be(new Oe),this._right=new be(new Oe),this._top=new be(new Oe),this._bottom=new be(new Oe),h._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}m(h,"laya.d3.math.BoundFrustum");var t=h.prototype;return t.equalsBoundFrustum=function(t){return this._matrix.equalsOtherMatrix(t.matrix)},t.equalsObj=function(t){if(t instanceof laya.d3.math.BoundFrustum){var e=t;return this.equalsBoundFrustum(e)}return!1},t.getPlane=function(t){switch(t){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},t.getCorners=function(t){h._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo(t[0]),h._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo(t[1]),h._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo(t[2]),h._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo(t[3]),h._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo(t[4]),h._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo(t[5]),h._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo(t[6]),h._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo(t[7])},t.containsPoint=function(t){for(var e=be.PlaneIntersectionType_Front,i=be.PlaneIntersectionType_Front,n=0;n<6;n++){switch(n){case 0:i=Se.intersectsPlaneAndPoint(this._near,t);break;case 1:i=Se.intersectsPlaneAndPoint(this._far,t);break;case 2:i=Se.intersectsPlaneAndPoint(this._left,t);break;case 3:i=Se.intersectsPlaneAndPoint(this._right,t);break;case 4:i=Se.intersectsPlaneAndPoint(this._top,t);break;case 5:i=Se.intersectsPlaneAndPoint(this._bottom,t)}switch(i){case be.PlaneIntersectionType_Back:return 0;case be.PlaneIntersectionType_Intersecting:e=be.PlaneIntersectionType_Intersecting}}switch(e){case be.PlaneIntersectionType_Intersecting:return 2;default:return 1}},t.containsBoundBox=function(t){for(var e,i=h._tempV30,n=h._tempV31,r=1,a=0;a<6;a++){if(e=this.getPlane(a),this._getBoxToPlanePVertexNVertex(t,e.normal,i,n),Se.intersectsPlaneAndPoint(e,i)===be.PlaneIntersectionType_Back)return 0;Se.intersectsPlaneAndPoint(e,n)===be.PlaneIntersectionType_Back&&(r=2)}return r},t.containsBoundSphere=function(t){for(var e=be.PlaneIntersectionType_Front,i=be.PlaneIntersectionType_Front,n=0;n<6;n++){switch(n){case 0:i=Se.intersectsPlaneAndSphere(this._near,t);break;case 1:i=Se.intersectsPlaneAndSphere(this._far,t);break;case 2:i=Se.intersectsPlaneAndSphere(this._left,t);break;case 3:i=Se.intersectsPlaneAndSphere(this._right,t);break;case 4:i=Se.intersectsPlaneAndSphere(this._top,t);break;case 5:i=Se.intersectsPlaneAndSphere(this._bottom,t)}switch(i){case be.PlaneIntersectionType_Back:return 0;case be.PlaneIntersectionType_Intersecting:e=be.PlaneIntersectionType_Intersecting}}switch(e){case be.PlaneIntersectionType_Intersecting:return 2;default:return 1}},t._getBoxToPlanePVertexNVertex=function(t,e,i,n){var r=t.min,a=r.elements,s=t.max,o=s.elements,l=e.elements,h=l[0],u=l[1],c=l[2];r.cloneTo(i);var _=i.elements;0<=h&&(_[0]=o[0]),0<=u&&(_[1]=o[1]),0<=c&&(_[2]=o[2]),s.cloneTo(n);var d=n.elements;0<=h&&(d[0]=a[0]),0<=u&&(d[1]=a[1]),0<=c&&(d[2]=a[2])},_(0,t,"top",function(){return this._top}),_(0,t,"matrix",function(){return this._matrix},function(t){this._matrix=t,h._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),_(0,t,"near",function(){return this._near}),_(0,t,"far",function(){return this._far}),_(0,t,"left",function(){return this._left}),_(0,t,"right",function(){return this._right}),_(0,t,"bottom",function(){return this._bottom}),h._getPlanesFromMatrix=function(t,e,i,n,r,a,s){var o=t.elements,l=o[0],h=o[1],u=o[2],c=o[3],_=o[4],d=o[5],f=o[6],p=o[7],m=o[8],g=o[9],v=o[10],y=o[11],x=o[12],E=o[13],T=o[14],S=o[15],w=e.normal.elements;w[0]=c+u,w[1]=p+f,w[2]=y+v,e.distance=S+T,e.normalize();var M=i.normal.elements;M[0]=c-u,M[1]=p-f,M[2]=y-v,i.distance=S-T,i.normalize();var D=n.normal.elements;D[0]=c+l,D[1]=p+_,D[2]=y+m,n.distance=S+x,n.normalize();var I=r.normal.elements;I[0]=c-l,I[1]=p-_,I[2]=y-m,r.distance=S-x,r.normalize();var b=a.normal.elements;b[0]=c-h,b[1]=p-d,b[2]=y-g,a.distance=S-E,a.normalize();var C=s.normal.elements;C[0]=c+h,C[1]=p+d,C[2]=y+g,s.distance=S+E,s.normalize()},h._get3PlaneInterPoint=function(t,e,i){var n=t.normal,r=e.normal,a=i.normal;Oe.cross(r,a,h._tempV30),Oe.cross(a,n,h._tempV31),Oe.cross(n,r,h._tempV32);var s=Oe.dot(n,h._tempV30),o=Oe.dot(r,h._tempV31),l=Oe.dot(a,h._tempV32);return Oe.scale(h._tempV30,-t.distance/s,h._tempV33),Oe.scale(h._tempV31,-e.distance/o,h._tempV34),Oe.scale(h._tempV32,-i.distance/l,h._tempV35),Oe.add(h._tempV33,h._tempV34,h._tempV36),Oe.add(h._tempV35,h._tempV36,h._tempV37),h._tempV37},c(h,["_tempV30",function(){return this._tempV30=new Oe},"_tempV31",function(){return this._tempV31=new Oe},"_tempV32",function(){return this._tempV32=new Oe},"_tempV33",function(){return this._tempV33=new Oe},"_tempV34",function(){return this._tempV34=new Oe},"_tempV35",function(){return this._tempV35=new Oe},"_tempV36",function(){return this._tempV36=new Oe},"_tempV37",function(){return this._tempV37=new Oe}]),h}(),Te=function(){function u(t,e){this.center=null,this.radius=NaN,this.center=t,this.radius=e}m(u,"laya.d3.math.BoundSphere");var t=u.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.toDefault=function(){this.center.toDefault(),this.radius=0},t.intersectsRayDistance=function(t){return Se.intersectsRayAndSphereRD(t,this)},t.intersectsRayPoint=function(t,e){return Se.intersectsRayAndSphereRP(t,this,e)},t.cloneTo=function(t){var e=t;this.center.cloneTo(e.center),e.radius=this.radius},t.clone=function(){var t=new this.constructor(new Oe,new Oe);return this.cloneTo(t),t},u.createFromSubPoints=function(t,e,i,n){if(null==t)throw new Error("points");if(e<0||e>=t.length)throw new Error("start"+e+"Must be in the range [0, "+(t.length-1)+"]");if(i<0||e+i>t.length)throw new Error("count"+i+"Must be in the range <= "+t.length+"}");var r=e+i,a=u._tempVector3;a.elements[0]=0,a.elements[1]=0,a.elements[2]=0;for(var s=e;s<r;++s)Oe.add(t[s],a,a);var o=n.center;Oe.scale(a,1/i,o);var l=0;for(s=e;s<r;++s){var h=Oe.distanceSquared(o,t[s]);l<h&&(l=h)}n.radius=Math.sqrt(l)},u.createfromPoints=function(t,e){if(null==t)throw new Error("points");u.createFromSubPoints(t,0,t.length,e)},c(u,["_tempVector3",function(){return this._tempVector3=new Oe}]),u}(),Se=function(){function q(){}return m(q,"laya.d3.math.Collision"),q.distancePlaneToPoint=function(t,e){return Oe.dot(t.normal,e)-t.distance},q.distanceBoxToPoint=function(t,e){var i=t.min.elements,n=i[0],r=i[1],a=i[2],s=t.max.elements,o=s[0],l=s[1],h=s[2],u=e.elements,c=u[0],_=u[1],d=u[2],f=0;return c<n&&(f+=(n-c)*(n-c)),o<c&&(f+=(o-c)*(o-c)),_<r&&(f+=(r-_)*(r-_)),l<_&&(f+=(l-_)*(l-_)),d<a&&(f+=(a-d)*(a-d)),h<d&&(f+=(h-d)*(h-d)),Math.sqrt(f)},q.distanceBoxToBox=function(t,e){var i=t.min.elements,n=i[0],r=i[1],a=i[2],s=t.max.elements,o=s[0],l=s[1],h=s[2],u=e.min.elements,c=u[0],_=u[1],d=u[2],f=e.max.elements,p=f[0],m=f[1],g=f[2],v=0,y=NaN;return p<n?v+=(y=n-p)*y:o<c&&(v+=(y=c-o)*y),m<r?v+=(y=r-m)*y:l<_&&(v+=(y=_-l)*y),g<a?v+=(y=a-g)*y:h<d&&(v+=(y=d-h)*y),Math.sqrt(v)},q.distanceSphereToPoint=function(t,e){var i=Math.sqrt(Oe.distanceSquared(t.center,e));return i-=t.radius,Math.max(i,0)},q.distanceSphereToSphere=function(t,e){var i=Math.sqrt(Oe.distanceSquared(t.center,e.center));return i-=t.radius+e.radius,Math.max(i,0)},q.intersectsRayAndTriangleRD=function(t,e,i,n,r){var a=t.origin.elements,s=a[0],o=a[1],l=a[2],h=t.direction.elements,u=h[0],c=h[1],_=h[2],d=e.elements,f=d[0],p=d[1],m=d[2],g=i.elements,v=g[0],y=g[1],x=g[2],E=n.elements,T=E[0],S=E[1],w=E[2],M=q._tempV30.elements,D=M[0],I=M[1],b=M[2];D=v-f,I=y-p,b=x-m;var C=q._tempV31.elements,A=C[0],R=C[1],L=C[2];A=T-f,R=S-p,L=w-m;var O=q._tempV32.elements,P=O[0],N=O[1],V=O[2],F=D*(P=c*L-_*R)+I*(N=_*A-u*L)+b*(V=u*R-c*A);if(we.isZero(F))return 0,!1;var B=1/F,U=q._tempV33.elements,k=U[0],H=U[1],z=U[2],G=(k=s-f)*P+(H=o-p)*N+(z=l-m)*V;if((G*=B)<0||1<G)return 0,!1;var W=q._tempV34.elements,X=W[0],Y=W[1],j=W[2],Z=u*(X=H*b-z*I)+c*(Y=z*D-k*b)+_*(j=k*I-H*D);if((Z*=B)<0||1<G+Z)return 0,!1;var K=A*X+R*Y+L*j;return(K*=B)<0?(0,!1):(K,!0)},q.intersectsRayAndTriangleRP=function(t,e,i,n,r){return q.intersectsRayAndTriangleRD(t,e,i,n,NaN)?(Oe.scale(t.direction,NaN,q._tempV30),Oe.add(t.origin,q._tempV30,r),!0):(r=Oe.ZERO,!1)},q.intersectsRayAndPoint=function(t,e){Oe.subtract(t.origin,e,q._tempV30);var i=Oe.dot(q._tempV30,t.direction),n=Oe.dot(q._tempV30,q._tempV30)-we.zeroTolerance;return!(0<n&&0<i)&&!(i*i-n<0)},q.intersectsRayAndRay=function(t,e,i){var n=t.origin,r=n.elements,a=r[0],s=r[1],o=r[2],l=t.direction,h=l.elements,u=h[0],c=h[1],_=h[2],d=e.origin,f=d.elements,p=f[0],m=f[1],g=f[2],v=e.direction,y=v.elements,x=y[0],E=y[1],T=y[2];Oe.cross(l,v,q._tempV30);var S=q._tempV30.elements,w=Oe.scalarLengthSquared(q._tempV30);if(we.isZero(w)&&we.nearEqual(p,a)&&we.nearEqual(m,s)&&we.nearEqual(g,o))return Oe.ZERO.cloneTo(i),!0;var M=p-a,D=m-s,I=g-o,b=x,C=E,A=T,R=S[0],L=S[1],O=S[2],P=(M*C*O+D*A*R+I*b*L-M*A*L-D*b*O-I*C*R)/w,N=(M*(C=c)*O+D*(A=_)*R+I*(b=u)*L-M*A*L-D*b*O-I*C*R)/w;Oe.scale(l,P,q._tempV30),Oe.scale(v,N,q._tempV31),Oe.add(n,q._tempV30,q._tempV32),Oe.add(d,q._tempV31,q._tempV33);var V=q._tempV32.elements,F=q._tempV33.elements;return we.nearEqual(F[0],V[0])&&we.nearEqual(F[1],V[1])&&we.nearEqual(F[2],V[2])?(q._tempV32.cloneTo(i),!0):(Oe.ZERO.cloneTo(i),!1)},q.intersectsPlaneAndTriangle=function(t,e,i,n){var r=q.intersectsPlaneAndPoint(t,e),a=q.intersectsPlaneAndPoint(t,i),s=q.intersectsPlaneAndPoint(t,n);return r==be.PlaneIntersectionType_Front&&a==be.PlaneIntersectionType_Front&&s==be.PlaneIntersectionType_Front?be.PlaneIntersectionType_Front:r==be.PlaneIntersectionType_Back&&a==be.PlaneIntersectionType_Back&&s==be.PlaneIntersectionType_Back?be.PlaneIntersectionType_Back:be.PlaneIntersectionType_Intersecting},q.intersectsRayAndPlaneRD=function(t,e,i){var n=e.normal,r=Oe.dot(n,t.direction);if(we.isZero(r))return 0,!1;var a=Oe.dot(n,t.origin);return!((-e.distance-a)/r<0)||(0,!1)},q.intersectsRayAndPlaneRP=function(t,e,i){return q.intersectsRayAndPlaneRD(t,e,NaN)?(Oe.scale(t.direction,NaN,q._tempV30),Oe.add(t.origin,q._tempV30,q._tempV31),q._tempV31,!0):(Oe.ZERO,!1)},q.intersectsRayAndBoxRD=function(t,e){var i=t.origin.elements,n=i[0],r=i[1],a=i[2],s=t.direction.elements,o=s[0],l=s[1],h=s[2],u=e.min.elements,c=u[0],_=u[1],d=u[2],f=e.max.elements,p=f[0],m=f[1],g=f[2],v=0,y=we.MaxValue;if(we.isZero(o)){if(n<c||p<n)return-1}else{var x=1/o,E=(c-n)*x,T=(p-n)*x;if(T<E){var S=E;E=T,T=S}if(v=Math.max(E,v),(y=Math.min(T,y))<v)return-1}if(we.isZero(l)){if(r<_||m<r)return-1}else{var w=1/l,M=(_-r)*w,D=(m-r)*w;if(D<M){var I=M;M=D,D=I}if(v=Math.max(M,v),(y=Math.min(D,y))<v)return-1}if(we.isZero(h)){if(a<d||g<a)return-1}else{var b=1/h,C=(d-a)*b,A=(g-a)*b;if(A<C){var R=C;C=A,A=R}if(v=Math.max(C,v),(y=Math.min(A,y))<v)return-1}return v},q.intersectsRayAndBoxRP=function(t,e,i){var n=q.intersectsRayAndBoxRD(t,e);return-1===n?Oe.ZERO.cloneTo(i):(Oe.scale(t.direction,n,q._tempV30),Oe.add(t.origin,q._tempV30,q._tempV31),q._tempV31.cloneTo(i)),n},q.intersectsRayAndSphereRD=function(t,e){var i=e.radius;Oe.subtract(t.origin,e.center,q._tempV30);var n=Oe.dot(q._tempV30,t.direction),r=Oe.dot(q._tempV30,q._tempV30)-i*i;if(0<r&&0<n)return-1;var a=n*n-r;if(a<0)return-1;var s=-n-Math.sqrt(a);return s<0&&(s=0),s},q.intersectsRayAndSphereRP=function(t,e,i){var n=q.intersectsRayAndSphereRD(t,e);return-1===n?Oe.ZERO.cloneTo(i):(Oe.scale(t.direction,n,q._tempV30),Oe.add(t.origin,q._tempV30,q._tempV31),q._tempV31.cloneTo(i)),n},q.intersectsSphereAndTriangle=function(t,e,i,n){var r=t.center,a=t.radius;return q.closestPointPointTriangle(r,e,i,n,q._tempV30),Oe.subtract(q._tempV30,r,q._tempV31),Oe.dot(q._tempV31,q._tempV31)<=a*a},q.intersectsPlaneAndPoint=function(t,e){var i=Oe.dot(t.normal,e)+t.distance;return 0<i?be.PlaneIntersectionType_Front:i<0?be.PlaneIntersectionType_Back:be.PlaneIntersectionType_Intersecting},q.intersectsPlaneAndPlane=function(t,e){Oe.cross(t.normal,e.normal,q._tempV30);var i=Oe.dot(q._tempV30,q._tempV30);return!we.isZero(i)},q.intersectsPlaneAndPlaneRL=function(t,e,i){var n=t.normal,r=e.normal;Oe.cross(n,r,q._tempV34);var a=Oe.dot(q._tempV34,q._tempV34);return!we.isZero(a)&&(Oe.scale(r,t.distance,q._tempV30),Oe.scale(n,e.distance,q._tempV31),Oe.subtract(q._tempV30,q._tempV31,q._tempV32),Oe.cross(q._tempV32,q._tempV34,q._tempV33),Oe.normalize(q._tempV34,q._tempV34),new Re(q._tempV33,q._tempV34),!0)},q.intersectsPlaneAndBox=function(t,e){var i=t.distance,n=t.normal,r=n.elements,a=r[0],s=r[1],o=r[2],l=e.min.elements,h=l[0],u=l[1],c=l[2],_=e.max.elements,d=_[0],f=_[1],p=_[2];q._tempV30.elements[0]=0<a?h:d,q._tempV30.elements[1]=0<s?u:f,q._tempV30.elements[2]=0<o?c:p,q._tempV31.elements[0]=0<a?d:h,q._tempV31.elements[1]=0<s?f:u,q._tempV31.elements[2]=0<o?p:c;var m=Oe.dot(n,q._tempV30);return 0<m+i?be.PlaneIntersectionType_Front:(m=Oe.dot(n,q._tempV31))+i<0?be.PlaneIntersectionType_Back:be.PlaneIntersectionType_Intersecting},q.intersectsPlaneAndSphere=function(t,e){var i=e.radius,n=Oe.dot(t.normal,e.center)+t.distance;return i<n?be.PlaneIntersectionType_Front:n<-i?be.PlaneIntersectionType_Back:be.PlaneIntersectionType_Intersecting},q.intersectsBoxAndBox=function(t,e){var i=t.min.elements,n=t.max.elements,r=e.min.elements,a=e.max.elements;return!(i[0]>a[0]||r[0]>n[0])&&(!(i[1]>a[1]||r[1]>n[1])&&!(i[2]>a[2]||r[2]>n[2]))},q.intersectsBoxAndSphere=function(t,e){var i=e.center,n=e.radius;return Oe.Clamp(i,t.min,t.max,q._tempV30),Oe.distanceSquared(i,q._tempV30)<=n*n},q.intersectsSphereAndSphere=function(t,e){var i=t.radius+e.radius;return Oe.distanceSquared(t.center,e.center)<=i*i},q.boxContainsPoint=function(t,e){var i=t.min.elements,n=t.max.elements,r=e.elements;return i[0]<=r[0]&&n[0]>=r[0]&&i[1]<=r[1]&&n[1]>=r[1]&&i[2]<=r[2]&&n[2]>=r[2]?1:0},q.boxContainsBox=function(t,e){var i=t.min.elements,n=i[0],r=i[1],a=i[2],s=t.max.elements,o=s[0],l=s[1],h=s[2],u=e.min.elements,c=u[0],_=u[1],d=u[2],f=e.max.elements,p=f[0],m=f[1],g=f[2];return o<c||p<n?0:l<_||m<r?0:h<d||g<a?0:n<=c&&p<=p&&r<=_&&m<=l&&a<=d&&g<=h?1:2},q.boxContainsSphere=function(t,e){var i=t.min,n=i.elements,r=n[0],a=n[1],s=n[2],o=t.max,l=o.elements,h=l[0],u=l[1],c=l[2],_=e.center,d=_.elements,f=d[0],p=d[1],m=d[2],g=e.radius;return Oe.Clamp(_,i,o,q._tempV30),g*g<Oe.distanceSquared(_,q._tempV30)?0:r+g<=f&&f<=h-g&&g<h-r&&a+g<=p&&p<=u-g&&g<u-a&&s+g<=m&&m<=c-g&&g<c-s?1:2},q.sphereContainsPoint=function(t,e){return Oe.distanceSquared(e,t.center)<=t.radius*t.radius?1:0},q.sphereContainsTriangle=function(t,e,i,n){var r=q.sphereContainsPoint(t,e),a=q.sphereContainsPoint(t,i),s=q.sphereContainsPoint(t,n);return 1==r&&1==a&&1==s?1:q.intersectsSphereAndTriangle(t,e,i,n)?2:0},q.sphereContainsBox=function(t,e){var i=t.center.elements,n=i[0],r=i[1],a=i[2],s=t.radius,o=e.min.elements,l=o[0],h=o[1],u=o[2],c=e.max.elements,_=c[0],d=c[1],f=c[2],p=q._tempV30.elements;p[0],p[1],p[2];if(!q.intersectsBoxAndSphere(e,t))return 0;var m=s*s;return p[0]=n-l,p[1]=r-d,p[2]=a-f,Oe.scalarLengthSquared(q._tempV30)>m?2:(p[0]=n-_,p[1]=r-d,p[2]=a-f,Oe.scalarLengthSquared(q._tempV30)>m?2:(p[0]=n-_,p[1]=r-h,p[2]=a-f,Oe.scalarLengthSquared(q._tempV30)>m?2:(p[0]=n-l,p[1]=r-h,p[2]=a-f,Oe.scalarLengthSquared(q._tempV30)>m?2:(p[0]=n-l,p[1]=r-d,p[2]=a-u,Oe.scalarLengthSquared(q._tempV30)>m?2:(p[0]=n-_,p[1]=r-d,p[2]=a-u,Oe.scalarLengthSquared(q._tempV30)>m?2:(p[0]=n-_,p[1]=r-h,p[2]=a-u,Oe.scalarLengthSquared(q._tempV30)>m?2:(p[0]=n-l,p[1]=r-h,p[2]=a-u,Oe.scalarLengthSquared(q._tempV30)>m?2:1)))))))},q.sphereContainsSphere=function(t,e){var i=t.radius,n=e.radius,r=Oe.distance(t.center,e.center);return i+n<r?0:i-n<r?2:1},q.closestPointPointTriangle=function(t,e,i,n,r){Oe.subtract(i,e,q._tempV30),Oe.subtract(n,e,q._tempV31),Oe.subtract(t,e,q._tempV32),Oe.subtract(t,i,q._tempV33),Oe.subtract(t,n,q._tempV34);var a=Oe.dot(q._tempV30,q._tempV32),s=Oe.dot(q._tempV31,q._tempV32),o=Oe.dot(q._tempV30,q._tempV33),l=Oe.dot(q._tempV31,q._tempV33),h=Oe.dot(q._tempV30,q._tempV34),u=Oe.dot(q._tempV31,q._tempV34);if(a<=0&&s<=0)e.cloneTo(r);else if(0<=o&&l<=o)i.cloneTo(r);else{var c=a*l-o*s;if(c<=0&&0<=a&&o<=0){var _=a/(a-o);return Oe.scale(q._tempV30,_,r),void Oe.add(e,r,r)}if(0<=u&&h<=u)n.cloneTo(r);else{var d=h*s-a*u;if(d<=0&&0<=s&&u<=0){var f=s/(s-u);return Oe.scale(q._tempV31,f,r),void Oe.add(e,r,r)}var p=o*u-h*l;if(p<=0&&0<=l-o&&0<=h-u){var m=(l-o)/(l-o+(h-u));return Oe.subtract(n,i,r),Oe.scale(r,m,r),void Oe.add(i,r,r)}var g=1/(p+d+c),v=d*g,y=c*g;Oe.scale(q._tempV30,v,q._tempV35),Oe.scale(q._tempV31,y,q._tempV36),Oe.add(q._tempV35,q._tempV36,r),Oe.add(e,r,r)}}},q.closestPointPlanePoint=function(t,e,i){var n=t.normal,r=Oe.dot(n,e)-t.distance;Oe.scale(n,r,q._tempV30),Oe.subtract(e,q._tempV30,i)},q.closestPointBoxPoint=function(t,e,i){Oe.max(e,t.min,q._tempV30),Oe.min(q._tempV30,t.max,i)},q.closestPointSpherePoint=function(t,e,i){var n=t.center;Oe.subtract(e,n,i),Oe.normalize(i,i),Oe.scale(i,t.radius,i),Oe.add(i,n,i)},q.closestPointSphereSphere=function(t,e,i){var n=t.center;Oe.subtract(e.center,n,i),Oe.normalize(i,i),Oe.scale(i,t.radius,i),Oe.add(i,n,i)},c(q,["_tempV30",function(){return this._tempV30=new Oe},"_tempV31",function(){return this._tempV31=new Oe},"_tempV32",function(){return this._tempV32=new Oe},"_tempV33",function(){return this._tempV33=new Oe},"_tempV34",function(){return this._tempV34=new Oe},"_tempV35",function(){return this._tempV35=new Oe},"_tempV36",function(){return this._tempV36=new Oe}]),q}(),we=(function(){function t(){}m(t,"laya.d3.math.ContainmentType"),t.Disjoint=0,t.Contains=1,t.Intersects=2}(),function(){function i(){}return m(i,"laya.d3.math.MathUtils3D"),i.isZero=function(t){return Math.abs(t)<i.zeroTolerance},i.nearEqual=function(t,e){return!!i.isZero(t-e)},i.fastInvSqrt=function(t){return i.isZero(t)?t:1/Math.sqrt(t)},c(i,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),i}()),Me=function(){function l(){var t=this.elements=new Float32Array(9);t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}m(l,"laya.d3.math.Matrix3x3");var t=l.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.determinant=function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],s=t[5],o=t[6],l=t[7],h=t[8];return e*(h*a-s*l)+i*(-h*r+s*o)+n*(l*r-a*o)},t.translate=function(t,e){var i=e.elements,n=this.elements,r=t.elements,a=n[0],s=n[1],o=n[2],l=n[3],h=n[4],u=n[5],c=n[6],_=n[7],d=n[8],f=r[0],p=r[1];i[0]=a,i[1]=s,i[2]=o,i[3]=l,i[4]=h,i[5]=u,i[6]=f*a+p*l+c,i[7]=f*s+p*h+_,i[8]=f*o+p*u+d},t.rotate=function(t,e){var i=e.elements,n=this.elements,r=n[0],a=n[1],s=n[2],o=n[3],l=n[4],h=n[5],u=n[6],c=n[7],_=n[8],d=Math.sin(t),f=Math.cos(t);i[0]=f*r+d*o,i[1]=f*a+d*l,i[2]=f*s+d*h,i[3]=f*o-d*r,i[4]=f*l-d*a,i[5]=f*h-d*s,i[6]=u,i[7]=c,i[8]=_},t.scale=function(t,e){var i=e.elements,n=this.elements,r=t.elements,a=r[0],s=r[1];i[0]=a*n[0],i[1]=a*n[1],i[2]=a*n[2],i[3]=s*n[3],i[4]=s*n[4],i[5]=s*n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8]},t.invert=function(t){var e=t.elements,i=this.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],l=i[5],h=i[6],u=i[7],c=i[8],_=c*o-l*u,d=-c*s+l*h,f=u*s-o*h,p=n*_+r*d+a*f;p||(t=null),p=1/p,e[0]=_*p,e[1]=(-c*r+a*u)*p,e[2]=(l*r-a*o)*p,e[3]=d*p,e[4]=(c*n-a*h)*p,e[5]=(-l*n+a*s)*p,e[6]=f*p,e[7]=(-u*n+r*h)*p,e[8]=(o*n-r*s)*p},t.transpose=function(t){var e=t.elements,i=this.elements;if(t===this){var n=i[1],r=i[2],a=i[5];e[1]=i[3],e[2]=i[6],e[3]=n,e[5]=i[7],e[6]=r,e[7]=a}else e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8]},t.identity=function(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},t.cloneTo=function(t){var e,i,n;if((i=this.elements)!==(n=t.elements))for(e=0;e<9;++e)n[e]=i[e]},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},l.createFromTranslation=function(t,e){e.elements;var i=t.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=i[0],e[7]=i[1],e[8]=1},l.createFromRotation=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[0]=r,i[1]=n,i[2]=0,i[3]=-n,i[4]=r,i[5]=0,i[6]=0,i[7]=0,i[8]=1},l.createFromScaling=function(t,e){var i=e.elements,n=t.elements;i[0]=n[0],i[1]=0,i[2]=0,i[3]=0,i[4]=n[1],i[5]=0,i[6]=0,i[7]=0,i[8]=1},l.createFromMatrix4x4=function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10]},l.multiply=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements,s=r[0],o=r[1],l=r[2],h=r[3],u=r[4],c=r[5],_=r[6],d=r[7],f=r[8],p=a[0],m=a[1],g=a[2],v=a[3],y=a[4],x=a[5],E=a[6],T=a[7],S=a[8];n[0]=p*s+m*h+g*_,n[1]=p*o+m*u+g*d,n[2]=p*l+m*c+g*f,n[3]=v*s+y*h+x*_,n[4]=v*o+y*u+x*d,n[5]=v*l+y*c+x*f,n[6]=E*s+T*h+S*_,n[7]=E*o+T*u+S*d,n[8]=E*l+T*c+S*f},l.lookAt=function(t,e,i,n){Oe.subtract(t,e,l._tempV30),Oe.normalize(l._tempV30,l._tempV30),Oe.cross(i,l._tempV30,l._tempV31),Oe.normalize(l._tempV31,l._tempV31),Oe.cross(l._tempV30,l._tempV31,l._tempV32);var r=l._tempV30.elements,a=l._tempV31.elements,s=l._tempV32.elements,o=n.elements;o[0]=a[0],o[3]=a[1],o[6]=a[2],o[1]=s[0],o[4]=s[1],o[7]=s[2],o[2]=r[0],o[5]=r[1],o[8]=r[2]},l.DEFAULT=new l,c(l,["_tempV30",function(){return this._tempV30=new Oe},"_tempV31",function(){return this._tempV31=new Oe},"_tempV32",function(){return this._tempV32=new Oe}]),l}(),De=function(){function M(t,e,i,n,r,a,s,o,l,h,u,c,_,d,f,p){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=1),void 0===s&&(s=0),void 0===o&&(o=0),void 0===l&&(l=0),void 0===h&&(h=0),void 0===u&&(u=1),void 0===c&&(c=0),void 0===_&&(_=0),void 0===d&&(d=0),void 0===f&&(f=0),void 0===p&&(p=1);var m=this.elements=new Float32Array(16);m[0]=t,m[1]=e,m[2]=i,m[3]=n,m[4]=r,m[5]=a,m[6]=s,m[7]=o,m[8]=l,m[9]=h,m[10]=u,m[11]=c,m[12]=_,m[13]=d,m[14]=f,m[15]=p}m(M,"laya.d3.math.Matrix4x4");var t=M.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.getElementByRowColumn=function(t,e){if(t<0||3<t)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(e<0||3<e)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*t+e]},t.setElementByRowColumn=function(t,e,i){if(t<0||3<t)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(e<0||3<e)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*t+e]=i},t.equalsOtherMatrix=function(t){var e=this.elements,i=t.elements;return we.nearEqual(e[0],i[0])&&we.nearEqual(e[1],i[1])&&we.nearEqual(e[2],i[2])&&we.nearEqual(e[3],i[3])&&we.nearEqual(e[4],i[4])&&we.nearEqual(e[5],i[5])&&we.nearEqual(e[6],i[6])&&we.nearEqual(e[7],i[7])&&we.nearEqual(e[8],i[8])&&we.nearEqual(e[9],i[9])&&we.nearEqual(e[10],i[10])&&we.nearEqual(e[11],i[11])&&we.nearEqual(e[12],i[12])&&we.nearEqual(e[13],i[13])&&we.nearEqual(e[14],i[14])&&we.nearEqual(e[15],i[15])},t.decomposeTransRotScale=function(t,e,i){var n=M._tempMatrix4x4;return this.decomposeTransRotMatScale(t,n,i)?(Ce.createFromMatrix4x4(n,e),!0):(e.identity(),!1)},t.decomposeTransRotMatScale=function(t,e,i){var n=this.elements,r=t.elements,a=e.elements,s=i.elements;r[0]=n[12],r[1]=n[13],r[2]=n[14];var o=n[0],l=n[1],h=n[2],u=n[4],c=n[5],_=n[6],d=n[8],f=n[9],p=n[10],m=s[0]=Math.sqrt(o*o+l*l+h*h),g=s[1]=Math.sqrt(u*u+c*c+_*_),v=s[2]=Math.sqrt(d*d+f*f+p*p);if(we.isZero(m)||we.isZero(g)||we.isZero(v))return a[1]=a[2]=a[3]=a[4]=a[6]=a[7]=a[8]=a[9]=a[11]=a[12]=a[13]=a[14]=0,a[0]=a[5]=a[10]=a[15]=1,!1;var y=M._tempVector0,x=y.elements;x[0]=d/v,x[1]=f/v,x[2]=p/v;var E=M._tempVector1,T=E.elements;T[0]=o/m,T[1]=l/m,T[2]=h/m;var S=M._tempVector2;Oe.cross(y,E,S);var w=M._tempVector1;return Oe.cross(S,y,w),a[3]=a[7]=a[11]=a[12]=a[13]=a[14]=0,a[15]=1,a[0]=w.x,a[1]=w.y,a[2]=w.z,a[4]=S.x,a[5]=S.y,a[6]=S.z,a[8]=y.x,a[9]=y.y,a[10]=y.z,a[0]*o+a[1]*l+a[2]*h<0&&(s[0]=-m),a[4]*u+a[5]*c+a[6]*_<0&&(s[1]=-g),a[8]*d+a[9]*f+a[10]*p<0&&(s[2]=-v),!0},t.decomposeYawPitchRoll=function(t){var e=t.elements,i=Math.asin(-this.elements[9]);e[1]=i,Math.cos(i)>we.zeroTolerance?(e[2]=Math.atan2(this.elements[1],this.elements[5]),e[0]=Math.atan2(this.elements[8],this.elements[10])):(e[2]=Math.atan2(-this.elements[4],this.elements[0]),e[0]=0)},t.normalize=function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=Math.sqrt(e*e+i*i+n*n);if(!r)return t[0]=0,t[1]=0,void(t[2]=0);1!=r&&(r=1/r,t[0]=e*r,t[1]=i*r,t[2]=n*r)},t.transpose=function(){var t,e;return e=(t=this.elements)[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},t.invert=function(t){var e=this.elements,i=t.elements,n=e[0],r=e[1],a=e[2],s=e[3],o=e[4],l=e[5],h=e[6],u=e[7],c=e[8],_=e[9],d=e[10],f=e[11],p=e[12],m=e[13],g=e[14],v=e[15],y=n*l-r*o,x=n*h-a*o,E=n*u-s*o,T=r*h-a*l,S=r*u-s*l,w=a*u-s*h,M=c*m-_*p,D=c*g-d*p,I=c*v-f*p,b=_*g-d*m,C=_*v-f*m,A=d*v-f*g,R=y*A-x*C+E*b+T*I-S*D+w*M;0!==Math.abs(R)&&(R=1/R,i[0]=(l*A-h*C+u*b)*R,i[1]=(a*C-r*A-s*b)*R,i[2]=(m*w-g*S+v*T)*R,i[3]=(d*S-_*w-f*T)*R,i[4]=(h*I-o*A-u*D)*R,i[5]=(n*A-a*I+s*D)*R,i[6]=(g*E-p*w-v*x)*R,i[7]=(c*w-d*E+f*x)*R,i[8]=(o*C-l*I+u*M)*R,i[9]=(r*I-n*C-s*M)*R,i[10]=(p*S-m*E+v*y)*R,i[11]=(_*E-c*S-f*y)*R,i[12]=(l*D-o*b-h*M)*R,i[13]=(n*b-r*D+a*M)*R,i[14]=(m*x-p*T-g*y)*R,i[15]=(c*T-_*x+d*y)*R)},t.identity=function(){var t=this.elements;t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1},t.cloneTo=function(t){var e,i,n;if((i=this.elements)!==(n=t.elements))for(e=0;e<16;++e)n[e]=i[e]},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t.getTranslationVector=function(t){var e=this.elements,i=t.elements;i[0]=e[12],i[1]=e[13],i[2]=e[14]},t.setTranslationVector=function(t){var e=this.elements,i=t.elements;e[12]=i[0],e[13]=i[1],e[14]=i[2]},t.getForward=function(t){var e=this.elements,i=t.elements;i[0]=-e[8],i[1]=-e[9],i[2]=-e[10]},t.setForward=function(t){var e=this.elements,i=t.elements;e[8]=-i[0],e[9]=-i[1],e[10]=-i[2]},M.createRotationX=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[1]=i[2]=i[3]=i[4]=i[7]=i[8]=i[11]=i[12]=i[13]=i[14]=0,i[0]=i[15]=1,i[5]=i[10]=r,i[6]=n,i[9]=-n},M.createRotationY=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[1]=i[3]=i[4]=i[6]=i[7]=i[9]=i[11]=i[12]=i[13]=i[14]=0,i[5]=i[15]=1,i[0]=i[10]=r,i[2]=-n,i[8]=n},M.createRotationZ=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[2]=i[3]=i[6]=i[7]=i[8]=i[9]=i[11]=i[12]=i[13]=i[14]=0,i[10]=i[15]=1,i[0]=i[5]=r,i[1]=n,i[4]=-n},M.createRotationYawPitchRoll=function(t,e,i,n){Ce.createFromYawPitchRoll(t,e,i,M._tempQuaternion),M.createRotationQuaternion(M._tempQuaternion,n)},M.createRotationAxis=function(t,e,i){var n=t.elements,r=n[0],a=n[1],s=n[2],o=Math.cos(e),l=Math.sin(e),h=r*r,u=a*a,c=s*s,_=r*a,d=r*s,f=a*s,p=i.elements;p[3]=p[7]=p[11]=p[12]=p[13]=p[14]=0,p[15]=1,p[0]=h+o*(1-h),p[1]=_-o*_+l*s,p[2]=d-o*d-l*a,p[4]=_-o*_-l*s,p[5]=u+o*(1-u),p[6]=f-o*f+l*r,p[8]=d-o*d+l*a,p[9]=f-o*f-l*r,p[10]=c+o*(1-c)},M.createRotationQuaternion=function(t,e){var i=t.elements,n=e.elements,r=i[0],a=i[1],s=i[2],o=i[3],l=r*r,h=a*a,u=s*s,c=r*a,_=s*o,d=s*r,f=a*o,p=a*s,m=r*o;n[3]=n[7]=n[11]=n[12]=n[13]=n[14]=0,n[15]=1,n[0]=1-2*(h+u),n[1]=2*(c+_),n[2]=2*(d-f),n[4]=2*(c-_),n[5]=1-2*(u+l),n[6]=2*(p+m),n[8]=2*(d+f),n[9]=2*(p-m),n[10]=1-2*(h+l)},M.createTranslate=function(t,e){var i=t.elements,n=e.elements;n[4]=n[8]=n[1]=n[9]=n[2]=n[6]=n[3]=n[7]=n[11]=0,n[0]=n[5]=n[10]=n[15]=1,n[12]=i[0],n[13]=i[1],n[14]=i[2]},M.createScaling=function(t,e){var i=t.elements,n=e.elements;n[0]=i[0],n[5]=i[1],n[10]=i[2],n[1]=n[4]=n[8]=n[12]=n[9]=n[13]=n[2]=n[6]=n[14]=n[3]=n[7]=n[11]=0,n[15]=1},M.multiply=function(t,e,i){var n,r,a,s,o,l,h,u;if(r=i.elements,a=t.elements,r===(s=e.elements))for(s=new Float32Array(16),n=0;n<16;++n)s[n]=r[n];for(n=0;n<4;n++)o=a[n],l=a[n+4],h=a[n+8],u=a[n+12],r[n]=o*s[0]+l*s[1]+h*s[2]+u*s[3],r[n+4]=o*s[4]+l*s[5]+h*s[6]+u*s[7],r[n+8]=o*s[8]+l*s[9]+h*s[10]+u*s[11],r[n+12]=o*s[12]+l*s[13]+h*s[14]+u*s[15]},M.createFromQuaternion=function(t,e){var i=e.elements,n=t.elements,r=n[0],a=n[1],s=n[2],o=n[3],l=r+r,h=a+a,u=s+s,c=r*l,_=a*l,d=a*h,f=s*l,p=s*h,m=s*u,g=o*l,v=o*h,y=o*u;i[0]=1-d-m,i[1]=_+y,i[2]=f-v,i[3]=0,i[4]=_-y,i[5]=1-c-m,i[6]=p+g,i[7]=0,i[8]=f+v,i[9]=p-g,i[10]=1-c-d,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1},M.createAffineTransformation=function(t,e,i,n){var r=t.elements,a=e.elements,s=i.elements,o=n.elements,l=a[0],h=a[1],u=a[2],c=a[3],_=l+l,d=h+h,f=u+u,p=l*_,m=l*d,g=l*f,v=h*d,y=h*f,x=u*f,E=c*_,T=c*d,S=c*f,w=s[0],M=s[1],D=s[2];o[0]=(1-(v+x))*w,o[1]=(m+S)*w,o[2]=(g-T)*w,o[3]=0,o[4]=(m-S)*M,o[5]=(1-(p+x))*M,o[6]=(y+E)*M,o[7]=0,o[8]=(g+T)*D,o[9]=(y-E)*D,o[10]=(1-(p+v))*D,o[11]=0,o[12]=r[0],o[13]=r[1],o[14]=r[2],o[15]=1},M.createLookAt=function(t,e,i,n){var r=n.elements,a=M._tempVector0,s=M._tempVector1,o=M._tempVector2;Oe.subtract(t,e,o),Oe.normalize(o,o),Oe.cross(i,o,a),Oe.normalize(a,a),Oe.cross(o,a,s),n.identity(),r[0]=a.x,r[4]=a.y,r[8]=a.z,r[1]=s.x,r[5]=s.y,r[9]=s.z,r[2]=o.x,r[6]=o.y,r[10]=o.z,r[12]=-Oe.dot(a,t),r[13]=-Oe.dot(s,t),r[14]=-Oe.dot(o,t)},M.createPerspective=function(t,e,i,n,r){var a=r.elements,s=1/Math.tan(t/2),o=1/(i-n);a[0]=s/e,a[5]=s,a[10]=(n+i)*o,a[11]=-1,a[14]=2*n*i*o,a[1]=a[2]=a[3]=a[4]=a[6]=a[7]=a[8]=a[9]=a[12]=a[13]=a[15]=0},M.createOrthoOffCenterRH=function(t,e,i,n,r,a,s){var o=s.elements,l=1/(t-e),h=1/(i-n),u=1/(r-a);o[1]=o[2]=o[3]=o[4]=o[6]=o[7]=o[8]=o[9]=o[11]=0,o[15]=1,o[0]=-2*l,o[5]=-2*h,o[10]=2*u,o[12]=(t+e)*l,o[13]=(n+i)*h,o[14]=(a+r)*u},M.translation=function(t,e){var i=t.elements,n=e.elements;n[0]=n[5]=n[10]=n[15]=1,n[12]=i[0],n[13]=i[1],n[14]=i[2]},c(M,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new M},"_tempVector0",function(){return this._tempVector0=new Oe},"_tempVector1",function(){return this._tempVector1=new Oe},"_tempVector2",function(){return this._tempVector2=new Oe},"_tempQuaternion",function(){return this._tempQuaternion=new Ce},"DEFAULT",function(){return this.DEFAULT=new M},"ZERO",function(){return this.ZERO=new M(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),M}(),Ie=function(){function y(t,e){this.extents=null,this.transformation=null,this.extents=t,this.transformation=e}m(y,"laya.d3.math.OrientedBoundBox");var t=y.prototype;return t.getCorners=function(t){var e=y._tempV30.elements,i=y._tempV31.elements,n=y._tempV32.elements,r=this.extents.elements;e[0]=r[0],e[1]=e[2]=0,i[1]=r[1],i[0]=i[2]=0,n[2]=r[2],n[0]=n[1]=0,Oe.TransformNormal(y._tempV30,this.transformation,y._tempV30),Oe.TransformNormal(y._tempV31,this.transformation,y._tempV31),Oe.TransformNormal(y._tempV32,this.transformation,y._tempV32);var a=y._tempV33;this.transformation.getTranslationVector(a),t.length=8,Oe.add(a,y._tempV30,y._tempV34),Oe.add(y._tempV34,y._tempV31,y._tempV34),Oe.add(y._tempV34,y._tempV32,t[0]),Oe.add(a,y._tempV30,y._tempV34),Oe.add(y._tempV34,y._tempV31,y._tempV34),Oe.subtract(y._tempV34,y._tempV32,t[1]),Oe.subtract(a,y._tempV30,y._tempV34),Oe.add(y._tempV34,y._tempV31,y._tempV34),Oe.subtract(y._tempV34,y._tempV32,t[2]),Oe.subtract(a,y._tempV30,y._tempV34),Oe.add(y._tempV34,y._tempV31,y._tempV34),Oe.add(y._tempV34,y._tempV32,t[3]),Oe.add(a,y._tempV30,y._tempV34),Oe.subtract(y._tempV34,y._tempV31,y._tempV34),Oe.add(y._tempV34,y._tempV32,t[4]),Oe.add(a,y._tempV30,y._tempV34),Oe.subtract(y._tempV34,y._tempV31,y._tempV34),Oe.subtract(y._tempV34,y._tempV32,t[5]),Oe.subtract(a,y._tempV30,y._tempV34),Oe.subtract(y._tempV34,y._tempV31,y._tempV34),Oe.subtract(y._tempV34,y._tempV32,t[6]),Oe.subtract(a,y._tempV30,y._tempV34),Oe.subtract(y._tempV34,y._tempV31,y._tempV34),Oe.add(y._tempV34,y._tempV32,t[7])},t.transform=function(t){De.multiply(this.transformation,t,this.transformation)},t.scale=function(t){Oe.multiply(this.extents,t,this.extents)},t.translate=function(t){this.transformation.getTranslationVector(y._tempV30),Oe.add(y._tempV30,t,y._tempV31),this.transformation.setTranslationVector(y._tempV31)},t.Size=function(t){Oe.scale(this.extents,2,t)},t.getSize=function(t){var e=this.extents.elements;y._tempV30.x=e[0],y._tempV31.y=e[1],y._tempV32.z=e[2],Oe.TransformNormal(y._tempV30,this.transformation,y._tempV30),Oe.TransformNormal(y._tempV31,this.transformation,y._tempV31),Oe.TransformNormal(y._tempV31,this.transformation,y._tempV32);var i=t.elements;i[0]=Oe.scalarLength(y._tempV30),i[1]=Oe.scalarLength(y._tempV31),i[2]=Oe.scalarLength(y._tempV32)},t.getSizeSquared=function(t){var e=this.extents.elements;y._tempV30.x=e[0],y._tempV31.y=e[1],y._tempV32.z=e[2],Oe.TransformNormal(y._tempV30,this.transformation,y._tempV30),Oe.TransformNormal(y._tempV31,this.transformation,y._tempV31),Oe.TransformNormal(y._tempV31,this.transformation,y._tempV32);var i=t.elements;i[0]=Oe.scalarLengthSquared(y._tempV30),i[1]=Oe.scalarLengthSquared(y._tempV31),i[2]=Oe.scalarLengthSquared(y._tempV32)},t.getCenter=function(t){this.transformation.getTranslationVector(t)},t.containsPoint=function(t){var e=this.extents.elements,i=e[0],n=e[1],r=e[2];this.transformation.invert(y._tempM0),Oe.transformCoordinate(t,y._tempM0,y._tempV30);var a=y._tempV30.elements,s=Math.abs(a[0]),o=Math.abs(a[1]),l=Math.abs(a[2]);return we.nearEqual(s,i)&&we.nearEqual(o,n)&&we.nearEqual(l,r)?2:s<i&&o<n&&l<r?1:0},t.containsPoints=function(t){var e=this.extents.elements,i=e[0],n=e[1],r=e[2];this.transformation.invert(y._tempM0);for(var a=!0,s=!1,o=0;o<t.length;o++){Oe.transformCoordinate(t[o],y._tempM0,y._tempV30);var l=y._tempV30.elements,h=Math.abs(l[0]),u=Math.abs(l[1]),c=Math.abs(l[2]);we.nearEqual(h,i)&&we.nearEqual(u,n)&&we.nearEqual(c,r)&&(s=!0),h<i&&u<n&&c<r?s=!0:a=!1}return a?1:s?2:0},t.containsSphere=function(t,e){void 0===e&&(e=!1);var i=this.extents.elements,n=i[0],r=i[1],a=i[2],s=t.radius;this.transformation.invert(y._tempM0),Oe.transformCoordinate(t.center,y._tempM0,y._tempV30);var o=NaN;if(o=e?s:(Oe.scale(Oe.UnitX,s,y._tempV31),Oe.TransformNormal(y._tempV31,y._tempM0,y._tempV31),Oe.scalarLength(y._tempV31)),Oe.scale(this.extents,-1,y._tempV32),Oe.Clamp(y._tempV30,y._tempV32,this.extents,y._tempV33),o*o<Oe.distanceSquared(y._tempV30,y._tempV33))return 0;var l=y._tempV30.elements,h=l[0],u=l[1],c=l[2],_=y._tempV32.elements,d=_[0],f=_[1],p=_[2];return d+o<=h&&h<=n-o&&o<n-d&&f+o<=u&&u<=r-o&&o<r-f&&p+o<=c&&c<=a-o&&o<a-p?1:2},t.containsOrientedBoundBox=function(t){var e=0,i=0;t.getCorners(y._corners);var n=this.containsPoints(y._corners);if(0!=n)return n;var r=this.extents.elements;t.extents.cloneTo(y._tempV35);var a=y._tempV35.elements;y._getRows(this.transformation,y._rows1),y._getRows(t.transformation,y._rows2);var s=NaN;for(e=0;e<4;e++)for(i=0;i<4;i++)3==e||3==i?(y._tempM0.setElementByRowColumn(e,i,0),y._tempM1.setElementByRowColumn(e,i,0)):(s=Oe.dot(y._rows1[e],y._rows2[i]),y._tempM0.setElementByRowColumn(e,i,s),y._tempM1.setElementByRowColumn(e,i,Math.abs(s)));t.getCenter(y._tempV34),this.getCenter(y._tempV36),Oe.subtract(y._tempV34,y._tempV36,y._tempV30);var o=y._tempV31.elements;o[0]=Oe.dot(y._tempV30,y._rows1[0]),o[1]=Oe.dot(y._tempV30,y._rows1[1]),o[2]=Oe.dot(y._tempV30,y._rows1[2]);var l=y._tempV32.elements,h=y._tempV33.elements;for(e=0;e<3;e++)if(l[0]=y._tempM1.getElementByRowColumn(e,0),l[1]=y._tempM1.getElementByRowColumn(e,1),l[2]=y._tempM1.getElementByRowColumn(e,2),r[e]+Oe.dot(y._tempV35,y._tempV32)<Math.abs(o[e]))return 0;for(i=0;i<3;i++)if(l[0]=y._tempM1.getElementByRowColumn(0,i),l[1]=y._tempM1.getElementByRowColumn(1,i),l[2]=y._tempM1.getElementByRowColumn(2,i),h[0]=y._tempM0.getElementByRowColumn(0,i),h[1]=y._tempM0.getElementByRowColumn(1,i),h[2]=y._tempM0.getElementByRowColumn(2,i),Oe.dot(this.extents,y._tempV32)+a[i]<Math.abs(Oe.dot(y._tempV31,y._tempV33)))return 0;for(e=0;e<3;e++)for(i=0;i<3;i++){var u=(e+1)%3,c=(e+2)%3,_=(i+1)%3,d=(i+2)%3;if(r[u]*y._tempM1.getElementByRowColumn(c,i)+r[c]*y._tempM1.getElementByRowColumn(u,i)+(a[_]*y._tempM1.getElementByRowColumn(e,d)+a[d]*y._tempM1.getElementByRowColumn(e,_))<Math.abs(o[c]*y._tempM0.getElementByRowColumn(u,i)-o[u]*y._tempM0.getElementByRowColumn(c,i)))return 0}return 2},t.containsLine=function(t,e){y._corners[0]=t,y._corners[1]=e;var i=this.containsPoints(y._corners);if(0!=i)return i;var n=this.extents.elements,r=n[0],a=n[1],s=n[2];this.transformation.invert(y._tempM0),Oe.transformCoordinate(t,y._tempM0,y._tempV30),Oe.transformCoordinate(e,y._tempM0,y._tempV31),Oe.add(y._tempV30,y._tempV31,y._tempV32),Oe.scale(y._tempV32,.5,y._tempV32),Oe.subtract(y._tempV30,y._tempV32,y._tempV33);var o=y._tempV33.elements,l=o[0],h=o[1],u=o[2],c=y._tempV34.elements,_=c[0]=Math.abs(o[0]),d=c[1]=Math.abs(o[1]),f=c[2]=Math.abs(o[2]),p=y._tempV32.elements,m=p[0],g=p[1],v=p[2];return Math.abs(m)>r+_?0:Math.abs(g)>a+d?0:Math.abs(v)>s+f?0:Math.abs(g*u-v*h)>a*f+s*d?0:Math.abs(m*u-v*l)>r*f+s*_?0:Math.abs(m*h-g*l)>r*d+a*_?0:2},t.containsBoundBox=function(t){var e=0,i=0,n=t.min,r=t.max;t.getCorners(y._corners);var a=this.containsPoints(y._corners);if(0!=a)return a;Oe.subtract(r,n,y._tempV30),Oe.scale(y._tempV30,.5,y._tempV30),Oe.add(n,y._tempV30,y._tempV30),Oe.subtract(r,y._tempV30,y._tempV31);var s=this.extents.elements,o=y._tempV31.elements;y._getRows(this.transformation,y._rows1),this.transformation.invert(y._tempM0);for(e=0;e<3;e++)for(i=0;i<3;i++)y._tempM1.setElementByRowColumn(e,i,Math.abs(y._tempM0.getElementByRowColumn(e,i)));this.getCenter(y._tempV35),Oe.subtract(y._tempV30,y._tempV35,y._tempV32);var l=y._tempV31.elements;l[0]=Oe.dot(y._tempV32,y._rows1[0]),l[1]=Oe.dot(y._tempV32,y._rows1[1]),l[2]=Oe.dot(y._tempV32,y._rows1[2]);var h=y._tempV33.elements,u=y._tempV34.elements;for(e=0;e<3;e++)if(h[0]=y._tempM1.getElementByRowColumn(e,0),h[1]=y._tempM1.getElementByRowColumn(e,1),h[2]=y._tempM1.getElementByRowColumn(e,2),s[e]+Oe.dot(y._tempV31,y._tempV33)<Math.abs(l[e]))return 0;for(i=0;i<3;i++)if(h[0]=y._tempM1.getElementByRowColumn(0,i),h[1]=y._tempM1.getElementByRowColumn(1,i),h[2]=y._tempM1.getElementByRowColumn(2,i),u[0]=y._tempM0.getElementByRowColumn(0,i),u[1]=y._tempM0.getElementByRowColumn(1,i),u[2]=y._tempM0.getElementByRowColumn(2,i),Oe.dot(this.extents,y._tempV33)+o[i]<Math.abs(Oe.dot(y._tempV31,y._tempV34)))return 0;for(e=0;e<3;e++)for(i=0;i<3;i++){var c=(e+1)%3,_=(e+2)%3,d=(i+1)%3,f=(i+2)%3;if(s[c]*y._tempM1.getElementByRowColumn(_,i)+s[_]*y._tempM1.getElementByRowColumn(c,i)+(o[d]*y._tempM1.getElementByRowColumn(e,f)+o[f]*y._tempM1.getElementByRowColumn(e,d))<Math.abs(l[_]*y._tempM0.getElementByRowColumn(c,i)-l[c]*y._tempM0.getElementByRowColumn(_,i)))return 0}return 2},t.intersectsRay=function(t,e){Oe.scale(this.extents,-1,y._tempV30),this.transformation.invert(y._tempM0),Oe.TransformNormal(t.direction,y._tempM0,y._ray.direction),Oe.transformCoordinate(t.origin,y._tempM0,y._ray.origin),y._boxBound1.min=y._tempV30,y._boxBound1.max=this.extents;var i=Se.intersectsRayAndBoxRP(y._ray,y._boxBound1,e);return-1!==i&&Oe.transformCoordinate(e,this.transformation,e),i},t._getLocalCorners=function(t){t.length=8;var e=this.extents.elements;y._tempV30.x=e[0],y._tempV31.y=e[1],y._tempV32.z=e[2],Oe.add(y._tempV30,y._tempV31,y._tempV33),Oe.add(y._tempV33,y._tempV32,t[0]),Oe.add(y._tempV30,y._tempV31,y._tempV33),Oe.subtract(y._tempV33,y._tempV32,t[1]),Oe.subtract(y._tempV31,y._tempV30,y._tempV33),Oe.subtract(y._tempV33,y._tempV30,t[2]),Oe.subtract(y._tempV31,y._tempV30,y._tempV33),Oe.add(y._tempV33,y._tempV32,t[3]),Oe.subtract(y._tempV30,y._tempV31,y._tempV33),Oe.add(y._tempV33,y._tempV32,t[4]),Oe.subtract(y._tempV30,y._tempV31,y._tempV33),Oe.subtract(y._tempV33,y._tempV32,t[5]),Oe.scale(t[0],-1,t[6]),Oe.subtract(y._tempV32,y._tempV30,y._tempV33),Oe.subtract(y._tempV33,y._tempV31,t[7])},t.equals=function(t){return this.extents==t.extents&&this.transformation==t.transformation},t.cloneTo=function(t){var e=t;this.extents.cloneTo(e.extents),this.transformation.cloneTo(e.transformation)},y.createByBoundBox=function(t,e){var i=t.min,n=t.max;Oe.subtract(n,i,y._tempV30),Oe.scale(y._tempV30,.5,y._tempV30),Oe.add(i,y._tempV30,y._tempV31),Oe.subtract(n,y._tempV31,y._tempV32),De.translation(y._tempV31,y._tempM0);var r=y._tempV32.clone(),a=y._tempM0.clone();e.extents=r,e.transformation=a},y.createByMinAndMaxVertex=function(t,e){return Oe.subtract(e,t,y._tempV30),Oe.scale(y._tempV30,.5,y._tempV30),Oe.add(t,y._tempV30,y._tempV31),Oe.subtract(e,y._tempV31,y._tempV32),De.translation(y._tempV31,y._tempM0),new y(y._tempV32,y._tempM0)},y._getRows=function(t,e){e.length=3;var i=t.elements,n=e[0].elements;n[0]=i[0],n[1]=i[1],n[2]=i[2];var r=e[1].elements;r[0]=i[4],r[1]=i[5],r[2]=i[6];var a=e[2].elements;a[0]=i[8],a[1]=i[9],a[2]=i[10]},y.getObbtoObbMatrix4x4=function(t,e,i,n){var r=t.transformation,a=e.transformation;if(i){y._getRows(r,y._rows1),y._getRows(a,y._rows2);for(var s=0;s<3;s++)for(var o=0;o<3;o++)n.setElementByRowColumn(s,o,Oe.dot(y._rows2[s],y._rows1[o]));e.getCenter(y._tempV30),t.getCenter(y._tempV31),Oe.subtract(y._tempV30,y._tempV31,y._tempV32);var l=n.elements;l[12]=Oe.dot(y._tempV32,y._rows1[0]),l[13]=Oe.dot(y._tempV32,y._rows1[1]),l[14]=Oe.dot(y._tempV32,y._rows1[2]),l[15]=1}else r.invert(y._tempM0),De.multiply(a,y._tempM0,n)},y.merge=function(t,e,i){var n=t.extents,r=t.transformation;y.getObbtoObbMatrix4x4(t,e,i,y._tempM0),e._getLocalCorners(y._corners),Oe.transformCoordinate(y._corners[0],y._tempM0,y._corners[0]),Oe.transformCoordinate(y._corners[1],y._tempM0,y._corners[1]),Oe.transformCoordinate(y._corners[2],y._tempM0,y._corners[2]),Oe.transformCoordinate(y._corners[3],y._tempM0,y._corners[3]),Oe.transformCoordinate(y._corners[4],y._tempM0,y._corners[4]),Oe.transformCoordinate(y._corners[5],y._tempM0,y._corners[5]),Oe.transformCoordinate(y._corners[6],y._tempM0,y._corners[6]),Oe.transformCoordinate(y._corners[7],y._tempM0,y._corners[7]),Oe.scale(n,-1,y._boxBound1.min),n.cloneTo(y._boxBound1.max),xe.createfromPoints(y._corners,y._boxBound2),xe.merge(y._boxBound2,y._boxBound1,y._boxBound3);var a=y._boxBound3.min,s=y._boxBound3.max;Oe.subtract(s,a,y._tempV30),Oe.scale(y._tempV30,.5,y._tempV30),Oe.add(a,y._tempV30,y._tempV32),Oe.subtract(s,y._tempV32,n),Oe.transformCoordinate(y._tempV32,r,y._tempV33)},c(y,["_tempV30",function(){return this._tempV30=new Oe},"_tempV31",function(){return this._tempV31=new Oe},"_tempV32",function(){return this._tempV32=new Oe},"_tempV33",function(){return this._tempV33=new Oe},"_tempV34",function(){return this._tempV34=new Oe},"_tempV35",function(){return this._tempV35=new Oe},"_tempV36",function(){return this._tempV36=new Oe},"_tempM0",function(){return this._tempM0=new De},"_tempM1",function(){return this._tempM1=new De},"_corners",function(){return this._corners=[new Oe,new Oe,new Oe,new Oe,new Oe,new Oe,new Oe,new Oe]},"_rows1",function(){return this._rows1=[new Oe,new Oe,new Oe]},"_rows2",function(){return this._rows2=[new Oe,new Oe,new Oe]},"_ray",function(){return this._ray=new Re(new Oe,new Oe)},"_boxBound1",function(){return this._boxBound1=new xe(new Oe,new Oe)},"_boxBound2",function(){return this._boxBound2=new xe(new Oe,new Oe)},"_boxBound3",function(){return this._boxBound3=new xe(new Oe,new Oe)}]),y}(),be=function(){function E(t,e){this.normal=null,this.distance=NaN,void 0===e&&(e=0),this.normal=t,this.distance=e}return m(E,"laya.d3.math.Plane"),E.prototype.normalize=function(){var t=this.normal.elements,e=t[0],i=t[1],n=t[2],r=1/Math.sqrt(e*e+i*i+n*n);t[0]=e*r,t[1]=i*r,t[2]=n*r,this.distance*=r},E.createPlaneBy3P=function(t,e,i){var n=t.elements,r=e.elements,a=i.elements,s=r[0]-n[0],o=r[1]-n[1],l=r[2]-n[2],h=a[0]-n[0],u=a[1]-n[1],c=a[2]-n[2],_=o*c-l*u,d=l*h-s*c,f=s*u-o*h,p=1/Math.sqrt(_*_+d*d+f*f),m=_*p,g=d*p,v=f*p,y=E._TEMPVec3.elements;y[0]=m,y[1]=g,y[2]=v;var x=-(m*n[0]+g*n[1]+v*n[2]);return new E(E._TEMPVec3,x)},E.PlaneIntersectionType_Back=0,E.PlaneIntersectionType_Front=1,E.PlaneIntersectionType_Intersecting=2,c(E,["_TEMPVec3",function(){return this._TEMPVec3=new Oe}]),E}(),Ce=function(){function r(t,e,i,n){this.elements=new Float32Array(4),void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),this.elements[0]=t,this.elements[1]=e,this.elements[2]=i,this.elements[3]=n}m(r,"laya.d3.math.Quaternion");var t=r.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.scaling=function(t,e){var i=e.elements,n=this.elements;i[0]=n[0]*t,i[1]=n[1]*t,i[2]=n[2]*t,i[3]=n[3]*t},t.normalize=function(t){var e=t.elements,i=this.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=n*n+r*r+a*a+s*s;0<o&&(o=1/Math.sqrt(o),e[0]=n*o,e[1]=r*o,e[2]=a*o,e[3]=s*o)},t.length=function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3];return Math.sqrt(e*e+i*i+n*n+r*r)},t.rotateX=function(t,e){var i=e.elements,n=this.elements;t*=.5;var r=n[0],a=n[1],s=n[2],o=n[3],l=Math.sin(t),h=Math.cos(t);i[0]=r*h+o*l,i[1]=a*h+s*l,i[2]=s*h-a*l,i[3]=o*h-r*l},t.rotateY=function(t,e){var i=e.elements,n=this.elements;t*=.5;var r=n[0],a=n[1],s=n[2],o=n[3],l=Math.sin(t),h=Math.cos(t);i[0]=r*h-s*l,i[1]=a*h+o*l,i[2]=s*h+r*l,i[3]=o*h-a*l},t.rotateZ=function(t,e){var i=e.elements,n=this.elements;t*=.5;var r=n[0],a=n[1],s=n[2],o=n[3],l=Math.sin(t),h=Math.cos(t);i[0]=r*h+a*l,i[1]=a*h-r*l,i[2]=s*h+o*l,i[3]=o*h-s*l},t.getYawPitchRoll=function(t){Oe.transformQuat(Oe.ForwardRH,this,r.TEMPVector31),Oe.transformQuat(Oe.Up,this,r.TEMPVector32);var e=r.TEMPVector32.elements;r.angleTo(Oe.ZERO,r.TEMPVector31,r.TEMPVector33);var i=r.TEMPVector33.elements;i[0]==Math.PI/2?(i[1]=r.arcTanAngle(e[2],e[0]),i[2]=0):i[0]==-Math.PI/2?(i[1]=r.arcTanAngle(-e[2],-e[0]),i[2]=0):(De.createRotationY(-i[1],r.TEMPMatrix0),De.createRotationX(-i[0],r.TEMPMatrix1),Oe.transformCoordinate(r.TEMPVector32,r.TEMPMatrix0,r.TEMPVector32),Oe.transformCoordinate(r.TEMPVector32,r.TEMPMatrix1,r.TEMPVector32),i[2]=r.arcTanAngle(e[1],-e[0])),i[1]<=-Math.PI&&(i[1]=Math.PI),i[2]<=-Math.PI&&(i[2]=Math.PI),i[1]>=Math.PI&&i[2]>=Math.PI&&(i[1]=0,i[2]=0,i[0]=Math.PI-i[0]);var n=t.elements;n[0]=i[1],n[1]=i[0],n[2]=i[2]},t.invert=function(t){var e=t.elements,i=this.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=n*n+r*r+a*a+s*s,l=o?1/o:0;e[0]=-n*l,e[1]=-r*l,e[2]=-a*l,e[3]=s*l},t.identity=function(){var t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=1},t.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1],this.elements[2]=t[e+2],this.elements[3]=t[e+3]},t.cloneTo=function(t){var e,i,n;if((i=this.elements)!==(n=t.elements))for(e=0;e<4;++e)n[e]=i[e]},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t.equals=function(t){var e=this.elements,i=t.elements;return we.nearEqual(e[0],i[0])&&we.nearEqual(e[1],i[1])&&we.nearEqual(e[2],i[2])&&we.nearEqual(e[3],i[3])},t.lengthSquared=function(){var t=this.elements[0],e=this.elements[1],i=this.elements[2],n=this.elements[3];return t*t+e*e+i*i+n*n},_(0,t,"x",function(){return this.elements[0]}),_(0,t,"y",function(){return this.elements[1]}),_(0,t,"z",function(){return this.elements[2]}),_(0,t,"w",function(){return this.elements[3]}),r.createFromYawPitchRoll=function(t,e,i,n){var r=.5*i,a=.5*e,s=.5*t,o=Math.sin(r),l=Math.cos(r),h=Math.sin(a),u=Math.cos(a),c=Math.sin(s),_=Math.cos(s),d=n.elements;d[0]=_*h*l+c*u*o,d[1]=c*u*l-_*h*o,d[2]=_*u*o-c*h*l,d[3]=_*u*l+c*h*o},r.multiply=function(t,e,i){var n=t.elements,r=e.elements,a=i.elements,s=n[0],o=n[1],l=n[2],h=n[3],u=r[0],c=r[1],_=r[2],d=r[3],f=o*_-l*c,p=l*u-s*_,m=s*c-o*u,g=s*u+o*c+l*_;a[0]=s*d+u*h+f,a[1]=o*d+c*h+p,a[2]=l*d+_*h+m,a[3]=h*d-g},r.arcTanAngle=function(t,e){return 0==t?1==e?Math.PI/2:-Math.PI/2:0<t?Math.atan(e/t):t<0?0<e?Math.atan(e/t)+Math.PI:Math.atan(e/t)-Math.PI:0},r.angleTo=function(t,e,i){Oe.subtract(e,t,r.TEMPVector30),Oe.normalize(r.TEMPVector30,r.TEMPVector30),i.elements[0]=Math.asin(r.TEMPVector30.y),i.elements[1]=r.arcTanAngle(-r.TEMPVector30.z,-r.TEMPVector30.x)},r.createFromAxisAngle=function(t,e,i){var n=i.elements,r=t.elements;e*=.5;var a=Math.sin(e);n[0]=a*r[0],n[1]=a*r[1],n[2]=a*r[2],n[3]=Math.cos(e)},r.createFromMatrix3x3=function(t,e){var i,n=e.elements,r=t.elements,a=r[0]+r[4]+r[8];if(0<a)i=Math.sqrt(a+1),n[3]=.5*i,i=.5/i,n[0]=(r[5]-r[7])*i,n[1]=(r[6]-r[2])*i,n[2]=(r[1]-r[3])*i;else{var s=0;r[4]>r[0]&&(s=1),r[8]>r[3*s+s]&&(s=2);var o=(s+1)%3,l=(s+2)%3;i=Math.sqrt(r[3*s+s]-r[3*o+o]-r[3*l+l]+1),n[s]=.5*i,i=.5/i,n[3]=(r[3*o+l]-r[3*l+o])*i,n[o]=(r[3*o+s]+r[3*s+o])*i,n[l]=(r[3*l+s]+r[3*s+l])*i}},r.createFromMatrix4x4=function(t,e){var i,n,r=t.elements,a=e.elements,s=r[0]+r[5]+r[10];0<s?(i=Math.sqrt(s+1),a[3]=.5*i,i=.5/i,a[0]=(r[6]-r[9])*i,a[1]=(r[8]-r[2])*i,a[2]=(r[1]-r[4])*i):r[0]>=r[5]&&r[0]>=r[10]?(n=.5/(i=Math.sqrt(1+r[0]-r[5]-r[10])),a[0]=.5*i,a[1]=(r[1]+r[4])*n,a[2]=(r[2]+r[8])*n,a[3]=(r[6]-r[9])*n):r[5]>r[10]?(n=.5/(i=Math.sqrt(1+r[5]-r[0]-r[10])),a[0]=(r[4]+r[1])*n,a[1]=.5*i,a[2]=(r[9]+r[6])*n,a[3]=(r[8]-r[2])*n):(n=.5/(i=Math.sqrt(1+r[10]-r[0]-r[5])),a[0]=(r[8]+r[2])*n,a[1]=(r[9]+r[6])*n,a[2]=.5*i,a[3]=(r[1]-r[4])*n)},r.slerp=function(t,e,i,n){var r,a,s,o,l,h=t.elements,u=e.elements,c=n.elements,_=h[0],d=h[1],f=h[2],p=h[3],m=u[0],g=u[1],v=u[2],y=u[3];return(a=_*m+d*g+f*v+p*y)<0&&(a=-a,m=-m,g=-g,v=-v,y=-y),l=1e-6<1-a?(r=Math.acos(a),s=Math.sin(r),o=Math.sin((1-i)*r)/s,Math.sin(i*r)/s):(o=1-i,i),c[0]=o*_+l*m,c[1]=o*d+l*g,c[2]=o*f+l*v,c[3]=o*p+l*y,c},r.lerp=function(t,e,i,n){var r=n.elements,a=t.elements,s=e.elements,o=a[0],l=a[1],h=a[2],u=a[3];r[0]=o+i*(s[0]-o),r[1]=l+i*(s[1]-l),r[2]=h+i*(s[2]-h),r[3]=u+i*(s[3]-u)},r.add=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]+a[0],n[1]=r[1]+a[1],n[2]=r[2]+a[2],n[3]=r[3]+a[3]},r.dot=function(t,e){var i=t.elements,n=e.elements;return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]+i[3]*n[3]},r.rotationLookAt=function(t,e,i){r.lookAt(Oe.ZERO,t,e,i)},r.lookAt=function(t,e,i,n){Me.lookAt(t,e,i,r._tempMatrix3x3),r.rotationMatrix(r._tempMatrix3x3,n)},r.invert=function(t,e){var i=t.elements,n=e.elements,r=t.lengthSquared();we.isZero(r)||(r=1/r,n[0]=-i[0]*r,n[1]=-i[1]*r,n[2]=-i[2]*r,n[3]=i[3]*r)},r.rotationMatrix=function(t,e){var i=t.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],l=i[5],h=i[6],u=i[7],c=i[8],_=e.elements,d=NaN,f=NaN,p=n+o+c;0<p?(d=Math.sqrt(p+1),_[3]=.5*d,d=.5/d,_[0]=(l-u)*d,_[1]=(h-a)*d,_[2]=(r-s)*d):_[3]=o<=n&&c<=n?(f=.5/(d=Math.sqrt(1+n-o-c)),_[0]=.5*d,_[1]=(r+s)*f,_[2]=(a+h)*f,(l-u)*f):c<o?(f=.5/(d=Math.sqrt(1+o-n-c)),_[0]=(s+r)*f,_[1]=.5*d,_[2]=(u+l)*f,(h-a)*f):(f=.5/(d=Math.sqrt(1+c-n-o)),_[0]=(h+a)*f,_[1]=(u+l)*f,_[2]=.5*d,(r-s)*f)},r.DEFAULT=new r,c(r,["TEMPVector30",function(){return this.TEMPVector30=new Oe},"TEMPVector31",function(){return this.TEMPVector31=new Oe},"TEMPVector32",function(){return this.TEMPVector32=new Oe},"TEMPVector33",function(){return this.TEMPVector33=new Oe},"TEMPMatrix0",function(){return this.TEMPMatrix0=new De},"TEMPMatrix1",function(){return this.TEMPMatrix1=new De},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new Me},"NAN",function(){return this.NAN=new r(NaN,NaN,NaN,NaN)}]),r}(),Ae=function(){function t(t){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=t,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}m(t,"laya.d3.math.Rand");var e=t.prototype;return e.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},e.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},e.getSignedFloat=function(){return 2*this.getFloat()-1},_(0,e,"seed",function(){return this.seeds[0]},function(t){this.seeds[0]=t,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),t.getFloatFromInt=function(t){return 1/8388607*(8388607&t)},t.getByteFromInt=function(t){return(8388607&t)>>>15},t}(),Re=(function(){function r(t){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!(t instanceof Array)||4!==t.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|t[0],this._state0L=0|t[1],this._state1U=0|t[2],this._state1L=0|t[3]}m(r,"laya.d3.math.RandX");var t=r.prototype;t.randomint=function(){var t=this._state0U,e=this._state0L,i=this._state1U,n=this._state1L,r=(n>>>0)+(e>>>0),a=i+t+(r/2>>>31)>>>0,s=r>>>0,o=0,l=0;o=(t^=o=t<<23|(-512&e)>>>9)^(this._state0U=i),l=(e^=l=e<<23)^(this._state0L=n);o^=t>>>18,l^=e>>>18|(262143&t)<<14;return o^=i>>>5,l^=n>>>5|(31&i)<<27,this._state1U=o,this._state1L=l,[a,s]},t.random=function(){var t=this.randomint(),e=t[0],i=1023<<20|e>>>12,n=0|(t[1]>>>12|(4095&e)<<20);return r._CONVERTION_BUFFER.setUint32(0,i,!1),r._CONVERTION_BUFFER.setUint32(4,n,!1),Ae._CONVERTION_BUFFER.getFloat64(0,!1)-1},c(r,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new Ae([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function t(t,e){this.origin=null,this.direction=null,this.origin=t,this.direction=e}return m(t,"laya.d3.math.Ray"),t}()),Le=function(){function t(t,e){this.elements=new Float32Array(2),void 0===t&&(t=0),void 0===e&&(e=0);var i=this.elements;i[0]=t,i[1]=e}m(t,"laya.d3.math.Vector2");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1]},e.cloneTo=function(t){var e=t.elements,i=this.elements;e[0]=i[0],e[1]=i[1]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},_(0,e,"x",function(){return this.elements[0]},function(t){this.elements[0]=t}),_(0,e,"y",function(){return this.elements[1]},function(t){this.elements[1]=t}),t.scale=function(t,e,i){var n=i.elements,r=t.elements;n[0]=r[0]*e,n[1]=r[1]*e},c(t,["ZERO",function(){return this.ZERO=new t(0,0)},"ONE",function(){return this.ONE=new t(1,1)}]),t}(),Oe=function(){function u(t,e,i){this.elements=new Float32Array(3),void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var n=this.elements;n[0]=t,n[1]=e,n[2]=i}m(u,"laya.d3.math.Vector3");var t=u.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1],this.elements[2]=t[e+2]},t.cloneTo=function(t){var e=t.elements,i=this.elements;e[0]=i[0],e[1]=i[1],e[2]=i[2]},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},_(0,t,"x",function(){return this.elements[0]},function(t){this.elements[0]=t}),_(0,t,"y",function(){return this.elements[1]},function(t){this.elements[1]=t}),_(0,t,"z",function(){return this.elements[2]},function(t){this.elements[2]=t}),u.distanceSquared=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],a=i[1]-n[1],s=i[2]-n[2];return r*r+a*a+s*s},u.distance=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],a=i[1]-n[1],s=i[2]-n[2];return Math.sqrt(r*r+a*a+s*s)},u.min=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=Math.min(r[0],a[0]),n[1]=Math.min(r[1],a[1]),n[2]=Math.min(r[2],a[2])},u.max=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=Math.max(r[0],a[0]),n[1]=Math.max(r[1],a[1]),n[2]=Math.max(r[2],a[2])},u.transformQuat=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements,s=r[0],o=r[1],l=r[2],h=a[0],u=a[1],c=a[2],_=a[3],d=_*s+u*l-c*o,f=_*o+c*s-h*l,p=_*l+h*o-u*s,m=-h*s-u*o-c*l;n[0]=d*_+m*-h+f*-c-p*-u,n[1]=f*_+m*-u+p*-h-d*-c,n[2]=p*_+m*-c+d*-u-f*-h},u.scalarLength=function(t){var e=t.elements,i=e[0],n=e[1],r=e[2];return Math.sqrt(i*i+n*n+r*r)},u.scalarLengthSquared=function(t){var e=t.elements,i=e[0],n=e[1],r=e[2];return i*i+n*n+r*r},u.normalize=function(t,e){var i=t.elements,n=e.elements,r=i[0],a=i[1],s=i[2],o=r*r+a*a+s*s;0<o&&(o=1/Math.sqrt(o),n[0]=i[0]*o,n[1]=i[1]*o,n[2]=i[2]*o)},u.multiply=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]*a[0],n[1]=r[1]*a[1],n[2]=r[2]*a[2]},u.scale=function(t,e,i){var n=i.elements,r=t.elements;n[0]=r[0]*e,n[1]=r[1]*e,n[2]=r[2]*e},u.lerp=function(t,e,i,n){var r=n.elements,a=t.elements,s=e.elements,o=a[0],l=a[1],h=a[2];r[0]=o+i*(s[0]-o),r[1]=l+i*(s[1]-l),r[2]=h+i*(s[2]-h)},u.transformV3ToV3=function(t,e,i){var n=u._tempVector4;u.transformV3ToV4(t,e,n);var r=n.elements,a=i.elements;a[0]=r[0],a[1]=r[1],a[2]=r[2]},u.transformV3ToV4=function(t,e,i){var n=t.elements,r=n[0],a=n[1],s=n[2],o=e.elements,l=i.elements;l[0]=r*o[0]+a*o[4]+s*o[8]+o[12],l[1]=r*o[1]+a*o[5]+s*o[9]+o[13],l[2]=r*o[2]+a*o[6]+s*o[10]+o[14],l[3]=r*o[3]+a*o[7]+s*o[11]+o[15]},u.TransformNormal=function(t,e,i){var n=t.elements,r=n[0],a=n[1],s=n[2],o=e.elements,l=i.elements;l[0]=r*o[0]+a*o[4]+s*o[8],l[1]=r*o[1]+a*o[5]+s*o[9],l[2]=r*o[2]+a*o[6]+s*o[10]},u.transformCoordinate=function(t,e,i){var n=u._tempVector4.elements,r=t.elements,a=r[0],s=r[1],o=r[2],l=e.elements;n[0]=a*l[0]+s*l[4]+o*l[8]+l[12],n[1]=a*l[1]+s*l[5]+o*l[9]+l[13],n[2]=a*l[2]+s*l[6]+o*l[10]+l[14],n[3]=1/(a*l[3]+s*l[7]+o*l[11]+l[15]);var h=i.elements;h[0]=n[0]*n[3],h[1]=n[1]*n[3],h[2]=n[2]*n[3]},u.Clamp=function(t,e,i,n){var r=t.elements,a=r[0],s=r[1],o=r[2],l=e.elements,h=l[0],u=l[1],c=l[2],_=i.elements,d=_[0],f=_[1],p=_[2],m=n.elements;a=(a=d<a?d:a)<h?h:a,s=(s=f<s?f:s)<u?u:s,o=(o=p<o?p:o)<c?c:o,m[0]=a,m[1]=s,m[2]=o},u.add=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]+a[0],n[1]=r[1]+a[1],n[2]=r[2]+a[2]},u.subtract=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]-a[0],n[1]=r[1]-a[1],n[2]=r[2]-a[2]},u.cross=function(t,e,i){var n=t.elements,r=e.elements,a=i.elements,s=n[0],o=n[1],l=n[2],h=r[0],u=r[1],c=r[2];a[0]=o*c-l*u,a[1]=l*h-s*c,a[2]=s*u-o*h},u.dot=function(t,e){var i=t.elements,n=e.elements;return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]},u.equals=function(t,e){var i=t.elements,n=e.elements;return we.nearEqual(Math.abs(i[0]),Math.abs(n[0]))&&we.nearEqual(Math.abs(i[1]),Math.abs(n[1]))&&we.nearEqual(Math.abs(i[2]),Math.abs(n[2]))},u.ZERO=new u(0,0,0),u.ONE=new u(1,1,1),u.NegativeUnitX=new u(-1,0,0),u.UnitX=new u(1,0,0),u.UnitY=new u(0,1,0),u.UnitZ=new u(0,0,1),u.ForwardRH=new u(0,0,-1),u.ForwardLH=new u(0,0,1),u.Up=new u(0,1,0),u.NAN=new u(NaN,NaN,NaN),c(u,["_tempVector4",function(){return this._tempVector4=new Pe}]),u}(),Pe=function(){function t(t,e,i,n){this.elements=new Float32Array(4),void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0);var r=this.elements;r[0]=t,r[1]=e,r[2]=i,r[3]=n}m(t,"laya.d3.math.Vector4");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1],this.elements[2]=t[e+2],this.elements[3]=t[e+3]},e.cloneTo=function(t){var e=t.elements,i=this.elements;e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},_(0,e,"x",function(){return this.elements[0]},function(t){this.elements[0]=t}),_(0,e,"y",function(){return this.elements[1]},function(t){this.elements[1]=t}),_(0,e,"z",function(){return this.elements[2]},function(t){this.elements[2]=t}),_(0,e,"w",function(){return this.elements[3]},function(t){this.elements[3]=t}),t.lerp=function(t,e,i,n){var r=n.elements,a=t.elements,s=e.elements,o=a[0],l=a[1],h=a[2],u=a[3];r[0]=o+i*(s[0]-o),r[1]=l+i*(s[1]-l),r[2]=h+i*(s[2]-h),r[3]=u+i*(s[3]-u)},t.transformByM4x4=function(t,e,i){var n=t.elements,r=n[0],a=n[1],s=n[2],o=n[3],l=e.elements,h=i.elements;h[0]=r*l[0]+a*l[4]+s*l[8]+o*l[12],h[1]=r*l[1]+a*l[5]+s*l[9]+o*l[13],h[2]=r*l[2]+a*l[6]+s*l[10]+o*l[14],h[3]=r*l[3]+a*l[7]+s*l[11]+o*l[15]},t.equals=function(t,e){var i=t.elements,n=e.elements;return we.nearEqual(Math.abs(i[0]),Math.abs(n[0]))&&we.nearEqual(Math.abs(i[1]),Math.abs(n[1]))&&we.nearEqual(Math.abs(i[2]),Math.abs(n[2]))&&we.nearEqual(Math.abs(i[3]),Math.abs(n[3]))},t.normalize=function(t,e){var i=t.elements,n=e.elements,r=t.length();0<r&&(n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n[3]=i[3]*r)},t.add=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]+a[0],n[1]=r[1]+a[1],n[2]=r[2]+a[2],n[3]=r[3]+a[3]},t.subtract=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]-a[0],n[1]=r[1]-a[1],n[2]=r[2]-a[2],n[3]=r[3]-a[3]},t.multiply=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]*a[0],n[1]=r[1]*a[1],n[2]=r[2]*a[2],n[3]=r[3]*a[3]},t.scale=function(t,e,i){var n=i.elements,r=t.elements;n[0]=r[0]*e,n[1]=r[1]*e,n[2]=r[2]*e,n[3]=r[3]*e},t.Clamp=function(t,e,i,n){var r=t.elements,a=r[0],s=r[1],o=r[2],l=r[3],h=e.elements,u=h[0],c=h[1],_=h[2],d=h[3],f=i.elements,p=f[0],m=f[1],g=f[2],v=f[3],y=n.elements;a=(a=p<a?p:a)<u?u:a,s=(s=m<s?m:s)<c?c:s,o=(o=g<o?g:o)<_?_:o,l=(l=v<l?v:l)<d?d:l,y[0]=a,y[1]=s,y[2]=o,y[3]=l},t.distanceSquared=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],a=i[1]-n[1],s=i[2]-n[2],o=i[3]-n[3];return r*r+a*a+s*s+o*o},t.distance=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],a=i[1]-n[1],s=i[2]-n[2],o=i[3]-n[3];return Math.sqrt(r*r+a*a+s*s+o*o)},t.dot=function(t,e){var i=t.elements,n=e.elements;return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]+i[3]*n[3]},t.min=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=Math.min(r[0],a[0]),n[1]=Math.min(r[1],a[1]),n[2]=Math.min(r[2],a[2]),n[3]=Math.min(r[3],a[3])},t.max=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=Math.max(r[0],a[0]),n[1]=Math.max(r[1],a[1]),n[2]=Math.max(r[2],a[2]),n[3]=Math.max(r[3],a[3])},c(t,["ZERO",function(){return this.ZERO=new t},"ONE",function(){return this.ONE=new t(1,1,1,1)},"UnitX",function(){return this.UnitX=new t(1,0,0,0)},"UnitY",function(){return this.UnitY=new t(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new t(0,0,1,0)},"UnitW",function(){return this.UnitW=new t(0,0,0,1)}]),t}(),Ne=function(){function a(t,e,i,n){this.minDepth=0,this.maxDepth=1,this.x=t,this.y=e,this.width=i,this.height=n}m(a,"laya.d3.math.Viewport");var t=a.prototype;return t.project=function(t,e,i){Oe.transformV3ToV3(t,e,i);var n=t.elements,r=e.elements,a=i.elements,s=n[0]*r[3]+n[1]*r[7]+n[2]*r[11]+r[15];1!==s&&(a[0]=a[0]/s,a[1]=a[1]/s,a[2]=a[2]/s),a[0]=.5*(a[0]+1)*this.width+this.x,a[1]=.5*(1-a[1])*this.height+this.y,a[2]=a[2]*(this.maxDepth-this.minDepth)+this.minDepth},t.unprojectFromMat=function(t,e,i){var n=t.elements,r=e.elements,a=i.elements;a[0]=(n[0]-this.x)/this.width*2-1,a[1]=-((n[1]-this.y)/this.height*2-1);var s=(this.maxDepth-this.minDepth)/2;a[2]=(n[2]-this.minDepth-s)/s;var o=a[0]*r[3]+a[1]*r[7]+a[2]*r[11]+r[15];Oe.transformV3ToV3(i,e,i),1!==o&&(a[0]=a[0]/o,a[1]=a[1]/o,a[2]=a[2]/o)},t.unprojectFromWVP=function(t,e,i,n,r){De.multiply(e,i,a._tempMatrix4x4),n&&De.multiply(a._tempMatrix4x4,n,a._tempMatrix4x4),a._tempMatrix4x4.invert(a._tempMatrix4x4),this.unprojectFromMat(t,a._tempMatrix4x4,r)},c(a,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new De}]),a}(),Ve=function(){function t(){this._alphaBlending=1,this._colorIntensity=1,this._shaderValue=new ke,f.isConchNode&&(this._conchSky=new ConchSkyMesh)}m(t,"laya.d3.resource.models.Sky");var e=t.prototype;return e._setEnvironmentDiffuse=function(){this._environmentDiffuse.loaded?this.__ownerCamera._shaderValues.setValue(7,this._environmentDiffuse):this._environmentDiffuse.on("loaded",this,this._environmentDiffuseLoaded)},e._setEnvironmentSpecular=function(){if(this._environmentSpecular.loaded){var t=this._environmentSpecular.simLodInfo;t&&t instanceof Float32Array&&this.__ownerCamera._shaderValues.setValue(9,t),this.__ownerCamera._shaderValues.setValue(8,this._environmentSpecular)}else this._environmentSpecular.on("loaded",this,this._environmentSpecularLoaded)},e._environmentDiffuseLoaded=function(){this.__ownerCamera._shaderValues.setValue(7,this._environmentDiffuse)},e._environmentSpecularLoaded=function(){var t=this._environmentSpecular.simLodInfo;t&&t instanceof Float32Array&&this.__ownerCamera._shaderValues.setValue(9,t),this.__ownerCamera._shaderValues.setValue(8,this._environmentSpecular)},e._render=function(t){},e.destroy=function(){this.__ownerCamera=null},_(0,e,"_ownerCamera",null,function(t){this.__ownerCamera=t,this._environmentDiffuse&&this._setEnvironmentDiffuse(),this._environmentSpecular&&this._setEnvironmentSpecular()}),_(0,e,"alphaBlending",function(){return this._alphaBlending},function(t){this._alphaBlending=t,this._alphaBlending<0&&(this._alphaBlending=0),1<this._alphaBlending&&(this._alphaBlending=1),this._conchSky&&this._conchSky.setShaderValue(2,this._alphaBlending,2)}),_(0,e,"envDiffuseSHBlue",null,function(t){this.__ownerCamera._shaderValues.setValue(12,t)}),_(0,e,"colorIntensity",function(){return this._colorIntensity},function(t){this._colorIntensity=t,this._colorIntensity<0&&(this._colorIntensity=0),this._conchSky&&this._conchSky.setShaderValue(1,this._colorIntensity,2)}),_(0,e,"envDiffuseSHGreen",null,function(t){this.__ownerCamera._shaderValues.setValue(11,t)}),_(0,e,"envDiffuseSHRed",null,function(t){this.__ownerCamera._shaderValues.setValue(10,t)}),_(0,e,"environmentDiffuse",function(){return this._environmentDiffuse},function(t){t.minFifter=9728,this._environmentDiffuse=t,this.__ownerCamera&&this._setEnvironmentDiffuse()}),_(0,e,"environmentSpecular",function(){return this._environmentSpecular},function(t){this._environmentSpecular=t,this.__ownerCamera&&this._setEnvironmentSpecular()}),t.MVPMATRIX=0,t.INTENSITY=1,t.ALPHABLENDING=2,t.DIFFUSETEXTURE=3,t}(),Fe=function(){function b(t){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=t,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}m(b,"laya.d3.resource.models.SubMesh");var t=b.prototype;return S.imps(t,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),t._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},t._getIndexBuffer=function(){return this._indexBuffer},t._getStaticBatchBakedVertexs=function(t,e){var i,n,r=this._vertexBuffer,a=r.vertexDeclaration,s=a.getVertexElementByUsage(0).offset/4,o=a.getVertexElementByUsage(3).offset/4,l=e.meshRender.lightmapScaleOffset,h=0,u=0,c=0,_=0,d=0,f=0;if(l)if(n=a.getVertexElementByUsage(15))c=a.vertexStride/4,i=0<this._vertexCount?r.getData().slice(this._vertexStart*c,(this._vertexStart+this._vertexCount)*c):r.getData().slice(),_=n.offset/4;else{c=(f=a.vertexStride/4)+2,i=this._vertexCount?new Float32Array(this._vertexCount*(r.vertexDeclaration.vertexStride/4+2)):new Float32Array(r.vertexCount*(r.vertexDeclaration.vertexStride/4+2)),_=(d=a.getVertexElementByUsage(2).offset/4)+2;var p=r.getData();for(h=0,u=p.length/f;h<u;h++){var m=0;m=0<this._vertexCount?(this._vertexStart+h)*f:h*f;var g=h*c,v=0;for(v=0;v<_;v++)i[g+v]=p[m+v];for(v=_;v<f;v++)i[g+v+2]=p[m+v]}}else c=a.vertexStride/4,i=this._vertexCount?r.getData().slice(this._vertexStart*c,(this._vertexStart+this._vertexCount)*c):r.getData().slice();if(t){var y=t.worldMatrix,x=b._tempMatrix4x40;y.invert(x);var E=b._tempMatrix4x41,T=e.transform.worldMatrix;De.multiply(x,T,E)}else E=e.transform.worldMatrix;var S=b._tempQuaternion0;for(E.decomposeTransRotScale(b._tempVector30,S,b._tempVector31),h=0,u=i.length/c;h<u;h++){var w=h*c+s,M=h*c+o;if(qe.transformVector3ArrayToVector3ArrayCoordinate(i,w,E,i,w),qe.transformVector3ArrayByQuat(i,M,S,i,M),l){var D=h*c+_;if(n)qe.transformLightingMapTexcoordByUV1Array(i,D,l,i,D);else{var I=h*f+d;qe.transformLightingMapTexcoordByUV0Array(p,I,l,i,D)}}}return i},t._getVertexBuffers=function(){return null},t._beforeRender=function(t){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},t._render=function(t){var e,i=0,n=t.renderElement;if(1<this._indexCount){var r=this._boneIndicesList.length;if(1<r){for(var a=0;a<r;a++)(e=n._skinAnimationDatas||this._skinAnimationDatas)&&(n._shaderValue.setValue(0,e[a]),t._shader.uploadRenderElementUniforms(n._shaderValue.data)),R.mainContext.drawElements(4,this._subIndexBufferCount[a],5123,2*this._subIndexBufferStart[a]);M.drawCall+=r}else(e=n._skinAnimationDatas||this._skinAnimationDatas)&&(n._shaderValue.setValue(0,e[0]),t._shader.uploadRenderElementUniforms(n._shaderValue.data)),R.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),M.drawCall++;i=this._indexCount}else i=this._indexBuffer.indexCount,(e=n._skinAnimationDatas||this._skinAnimationDatas)&&(n._shaderValue.setValue(0,e[0]),t._shader.uploadRenderElementUniforms(n._shaderValue.data)),R.mainContext.drawElements(4,i,5123,0),M.drawCall++;M.trianglesFaces+=i/3},t.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},t.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},t._renderRuntime=function(t,e,i){e._material,e._sprite3D;t.drawSubmesh(e._conchSubmesh,0,4,0,this._indexBuffer.indexCount)},_(0,t,"_vertexBufferCount",function(){return 1}),_(0,t,"triangleCount",function(){return this._indexBuffer.indexCount/3}),c(b,["_tempVector30",function(){return this._tempVector30=new Oe},"_tempVector31",function(){return this._tempVector31=new Oe},"_tempQuaternion0",function(){return this._tempQuaternion0=new Ce},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new De},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new De}]),b}(),Be=function(){function t(t){this.defineCounter=0,this.defines=null,this.defines=t?(this.defineCounter=t.defineCounter,t.defines.slice()):(this.defineCounter=0,[])}return m(t,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),t.prototype.registerDefine=function(t){var e=Math.pow(2,this.defineCounter++);return this.defines[e]=t,e},t}(),Ue=function(){function t(){}return m(t,"laya.d3.shader.ShaderInit3D"),t.__init__=function(){var t,e;ui._globalRegDefine("HIGHPRECISION",ui.SHADERDEFINE_HIGHPRECISION),ui._globalRegDefine("FOG",ui.SHADERDEFINE_FOG),ui._globalRegDefine("DIRECTIONLIGHT",ui.SHADERDEFINE_DIRECTIONLIGHT),ui._globalRegDefine("POINTLIGHT",ui.SHADERDEFINE_POINTLIGHT),ui._globalRegDefine("SPOTLIGHT",ui.SHADERDEFINE_SPOTLIGHT),ui._globalRegDefine("UV",ui.SHADERDEFINE_UV0),ui._globalRegDefine("COLOR",ui.SHADERDEFINE_COLOR),ui._globalRegDefine("UV1",ui.SHADERDEFINE_UV1),ui._globalRegDefine("CASTSHADOW",He.SHADERDEFINE_CAST_SHADOW),ui._globalRegDefine("SHADOWMAP_PSSM1",He.SHADERDEFINE_SHADOW_PSSM1),ui._globalRegDefine("SHADOWMAP_PSSM2",He.SHADERDEFINE_SHADOW_PSSM2),ui._globalRegDefine("SHADOWMAP_PSSM3",He.SHADERDEFINE_SHADOW_PSSM3),ui._globalRegDefine("SHADOWMAP_PCF_NO",He.SHADERDEFINE_SHADOW_PCF_NO),ui._globalRegDefine("SHADOWMAP_PCF1",He.SHADERDEFINE_SHADOW_PCF1),ui._globalRegDefine("SHADOWMAP_PCF2",He.SHADERDEFINE_SHADOW_PCF2),ui._globalRegDefine("SHADOWMAP_PCF3",He.SHADERDEFINE_SHADOW_PCF3),ui._globalRegDefine("DEPTHFOG",ui.SAHDERDEFINE_DEPTHFOG),Fi.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),Fi.addInclude("Lighting.glsl","\nstruct DirectionLight\n{\n\tvec3 Color;\n\tvec3 Direction;\n};\n\nstruct PointLight\n{\n\tvec3 Color;\n\tvec3 Position;\n\tfloat Range;\n};\n\nstruct SpotLight\n{\n\tvec3 Color;\n\tvec3 Position;\n\tvec3 Direction;\n\tfloat Spot;\n\tfloat Range;\n};\n\n// U3D中使用衰减纹理,此函数模拟并非正确\n//float U3DAttenuation(in vec3 L,in float invLightRadius)\n//{\n//\tfloat fRatio = clamp(length(L) * invLightRadius,0.0,1.0);\n//\tfRatio *= fRatio;\n//\treturn 1.0 / (1.0 + 25.0 * fRatio)* clamp(4.0*(1.0 - fRatio),0.0,1.0); //fade to black as if 4 pixel texture\n//} \n\n// Same as Just Cause 2 and Crysis 2 (you can read GPU Pro 1 book for more information)\nfloat BasicAttenuation(in vec3 L,in float invLightRadius)\n{\n\tvec3 distance = L * invLightRadius;\n\tfloat attenuation = clamp(1.0 - dot(distance, distance),0.0,1.0); // Equals float attenuation = saturate(1.0f - dot(L, L) / (lightRadius *  lightRadius)); \t\n\treturn attenuation * attenuation;\n} \n\n// Inspired on http://fools.slindev.com/viewtopic.php?f=11&t=21&view=unread#unread\t\nfloat NaturalAttenuation(in vec3 L,in float invLightRadius)\n{\n\tfloat attenuationFactor = 30.0;\n\tvec3 distance = L * invLightRadius;\n\tfloat attenuation = dot(distance, distance); // Equals float attenuation = dot(L, L) / (lightRadius *  lightRadius);\n\tattenuation = 1.0 / (attenuation * attenuationFactor + 1.0);\n\t// Second we move down the function therewith it reaches zero at abscissa 1:\n\tattenuationFactor = 1.0 / (attenuationFactor + 1.0); //attenuationFactor contains now the value we have to subtract\n\tattenuation = max(attenuation - attenuationFactor, 0.0); // The max fixes a bug.\n\t// Finally we expand the equation along the y-axis so that it starts with a function value of 1 again.\n\tattenuation /= 1.0 - attenuationFactor;\n\treturn attenuation;\n} \n\nvoid LayaAirBlinnPhongLight (in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir,in vec3 lightColor, in vec3 lightVec,out vec3 diffuseColor,out vec3 specularColor)\n{\n    mediump vec3 h = normalize(viewDir-lightVec);\n    lowp float ln = max (0.0, dot (-lightVec,normal));\n    float nh = max (0.0, dot (h,normal));\n\tdiffuseColor=lightColor * ln;\n\tspecularColor=lightColor *specColor*pow (nh, specColorIntensity*128.0) * gloss;\n}\n\nvoid LayaAirBlinnPhongDiectionLight (in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in DirectionLight light,out vec3 diffuseColor,out vec3 specularColor)\n{\n\tvec3 lightVec=normalize(light.Direction);\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.Color,lightVec,diffuseColor,specularColor);\n}\n\nvoid LayaAirBlinnPhongPointLight (in vec3 pos,in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in PointLight light,out vec3 diffuseColor,out vec3 specularColor)\n{\n\tvec3 lightVec =  pos-light.Position;\n\t//if( length(lightVec) > light.Range )\n\t//\treturn;\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.Color,lightVec/length(lightVec),diffuseColor,specularColor);\n\tfloat attenuate = BasicAttenuation(lightVec, 1.0/light.Range);\n\tdiffuseColor *= attenuate;\n\tspecularColor*= attenuate;\n}\n\nvoid LayaAirBlinnPhongSpotLight (in vec3 pos,in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in SpotLight light,out vec3 diffuseColor,out vec3 specularColor)\n{\n\tvec3 lightVec =  pos-light.Position;\n\t//if( length(lightVec) > light.Range )\n\t//\treturn;\n\tvec3 normalLightVec=lightVec/length(lightVec);\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.Color,normalLightVec,diffuseColor,specularColor);\n\tfloat spot = pow(max(dot(normalLightVec, normalize(light.Direction)), 0.0), light.Spot);\n\tfloat attenuate = spot*BasicAttenuation(lightVec, 1.0/light.Range);\n\tdiffuseColor *= attenuate;\n\tspecularColor*= attenuate;\n}\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent,vec3 binormal)\n{\n\tvec3 normalT =vec3(2.0*normalMapSample.x - 1.0,1.0-2.0*normalMapSample.y,2.0*normalMapSample.z - 1.0);\n\t\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent);\n\tvec3 B = normalize(binormal);\n\tmat3 TBN = mat3(T, B, N);\n\t\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\n"),Fi.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),Fi.addInclude("WaveFunction.glsl","\nuniform vec2 u_WaveInfoD[20];\nuniform vec4 u_WaveInfo[20];\n\nuniform float TEXWAVE_UV_SCALE ;//= 20.0; //每texwidth像素代表的实际距离\n/**\n\t这里的计算都是\n*/\n\n/**\n* 计算一个波形\n*  开始计算的时候都按照z向上，最后输出的时候，颠倒一下。\n* @param tm {float} 毫秒\n*/\nvoid calcGerstnerWave(float curtm, vec3 pos, float deep, vec2 uvpos, out vec3 opos, out vec3 B, out vec3 T, out vec3 N, out float foamS){\n\tfloat tm = curtm/1000.;\n\topos = pos;\n\tvec3 wpos=vec3(0.);\t\t//累加的位置\n\tN=vec3(0.,0.,0.);\t//输出的法线初始化一下\n\tT=vec3(0.,0.,0.);\n\tB=vec3(0.,0.,0.);\n\tvec2 cD ;//= D;\n\t//float deepAtt = max(0.,min(deep,1.0));\n\t//A*=deepAtt; //TODO\n\t\n\tfor( int i=0; i<4; i++){\n\t\tcD = u_WaveInfoD[i];//vec2(wi.winfo[0],wi.winfo[1]);// wi.vDir;\n\t\tfloat Q = u_WaveInfo[i].x;//wi.QorK;\n\t\tfloat A = u_WaveInfo[i].y;//wi.A;\n\t\tfloat W = u_WaveInfo[i].z;//wi.omega;\n\t\tfloat P = u_WaveInfo[i].w;//wi.phi;\n\t\tfloat dop = dot(cD,uvpos);\n\t\tfloat c = cos(dop*W - tm*P);//TODO 优化\n\t\tfloat s = sin(dop*W - tm*P);\n\t\tfloat AWs = A*W*s;\n\t\tfloat AWc = A*W*c;\n\t\tfloat _QxyAWs = -Q*cD.x*cD.y*AWs;\n\t\t\n\t\twpos += vec3(Q*A*cD.x*c,\n\t\t\t\t\tQ*A*cD.y*c,\n\t\t\t\t\tA*s);\n\t\tN += vec3(-cD.x*AWc,\n\t\t\t\t-cD.y*AWc,\n\t\t\t\tQ*AWs);//记得最后1-\n\t\tT += vec3(_QxyAWs,\n\t\t\t\tQ*cD.y*cD.y*AWs,//记得1-\n\t\t\t\tcD.y*AWc\n\t\t\t);\n\t\tB += vec3(Q*cD.x*cD.x*AWs,//记得1-\n\t\t\t\t_QxyAWs,\n\t\t\t\tcD.x*AWc\n\t\t\t);\n\t\t//float v1 = exp(-tan((dop*W - tm*P)/2.+1.07));//除2，+pi/2 这样正好能对齐\n#ifdef USE_FOAM\t\t\n\t\tfloat v1 = 0.5-sin((dop*W - tm*P)/1.+2.0)/2.;\n\t\tfoamS += pow(v1,9.)/4.;\n#endif\n\t}\n\tT.y=1.-T.y; B.x=1.-B.x;N.z=1.-N.z;\n\topos += vec3(wpos.x,wpos.z*min(deep/10.,1.),wpos.y);\n\t//y和z交换一下。现在根据uv计算的位置，所以直接交换yz就行。其他情况下有问题么\n\tT.xyz=T.xzy;\n\tB.xyz=B.xzy;\n\tN.xyz=N.xzy;\n}\n\n\nvoid calcWave(float curtm, vec2 uv, out vec3 B, out vec3 T, out vec3 N){\n\tfloat tm = curtm/1000.;\n\tN=vec3(0.,0.,0.);\t//输出的法线初始化一下\n\tvec2 uvpos = uv*TEXWAVE_UV_SCALE; //TODO 这个范围是什么 就是1？\n\tuvpos.y*=-1.;\n\tvec2 cD;// = D;\n\tconst int NumWaves = 4;\n\tfloat scale = 1./float(NumWaves);\n\tfor( int i=0; i<NumWaves; i++){\n\t\tcD = u_WaveInfoD[i];//vec2(wi.winfo[0],wi.winfo[1]);// wi.vDir;\n\t\tfloat k = 1.5;//u_WaveInfo[i].x;//wi.QorK; TODO  不知道为什么，这个取u_WaveInfo[i].x，在mi3w上就会闪。测试发现实际值也传过来了，就是1.5\n\t\tfloat A = u_WaveInfo[i].y;//wi.A;\n\t\tfloat W = u_WaveInfo[i].z;//wi.omega;\n\t\tfloat P = u_WaveInfo[i].w;//wi.phi;\n\t\t\n\t\tfloat dop = dot(cD,uvpos);\n\t\tfloat c = cos(dop*W - tm*P);//TODO 优化\n\t\tfloat s = sin(dop*W - tm*P);\n\t\t/*\n\t\tfloat AWs = A*W*s;\n\t\tfloat AWc = A*W*c;\n\t\tfloat _QxyAWs = -Q*cD.x*cD.y*AWs;\n\t\t\n\t\tN += vec3(-cD.x*AWc,\n\t\t\t\t-cD.y*AWc,\n\t\t\t\tQ*AWs);//记得最后1-\n\t\t*/\n\t\tfloat kWAc = scale*c;//k*W*A*c;  为了提高精度，这里只保留sin，cos部分，实际使用的时候再乘回来。\n\t\t//float kWAc = k*W*A*c;  \n\t\tN += vec3(\n\t\t\t-kWAc*cD.x*pow((s+1.)/2.,k-1.),\n\t\t\t-kWAc*cD.y*pow((s+1.)/2.,k-1.),\n\t\t\t1.\n\t\t);\n\t}\n\t//N.z=1.-N.z;\n\t//y和z交换一下。现在根据uv计算的位置，所以直接交换yz就行。其他情况下有问题么\n\tN.xyz=N.xzy;\n}\n"),Fi.addInclude("BRDF.glsl","vec4 LayaAirBRDF(in vec3 diffuseColor, in vec3 specularColor, in float oneMinusReflectivity, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in vec3 gi)\n{\n\tfloat perceptualRoughness = SmoothnessToPerceptualRoughness(smoothness);\n\tvec3 halfDir = SafeNormalize(viewDir - lightDir);\n\t\n\tfloat nv = abs(dot(normal, viewDir));\n\t\n\tfloat nl = clamp(dot(normal,   -lightDir),  0.0, 1.0);\n\tfloat nh = clamp(dot(normal,     halfDir),  0.0, 1.0);\n\tfloat lv = clamp(dot(lightDir,   viewDir),  0.0, 1.0);\n\tfloat lh = clamp(dot(lightDir,  -halfDir),  0.0, 1.0);\n\t\n\tfloat diffuseTerm = DisneyDiffuse(nv, nl, lh, perceptualRoughness) * nl;\n\t\n\tfloat roughness = PerceptualRoughnessToRoughness(perceptualRoughness);\n\t\n\t//#if UNITY_BRDF_GGX\n\tfloat V = SmithJointGGXVisibilityTerm(nl, nv, roughness);\n\tfloat D = GGXTerm(nh, roughness);\n\t\n\tfloat specularTerm = V * D * PI;\n\t\n\tspecularTerm = sqrt(max(0.0001, specularTerm));\n\tspecularTerm = max(0.0, specularTerm * nl);\n\t\n\tvec4 color;\n\tcolor.rgb = diffuseColor * (gi + lightColor * diffuseTerm) + specularTerm * lightColor * FresnelTerm (specularColor, lh);\n\t\n\tcolor.a = 1.0;\n\treturn color;\n}"),Fi.addInclude("PBRUtils.glsl","struct DirectionLight\n{\n\tvec3 Color;\n\tvec3 Direction;\n};\n\nvec3 UnpackScaleNormal(in vec2 uv0)\n{\n\t#ifdef NORMALTEXTURE\n\t\tvec3 normalT;\n\t\tvec4 normalMapSample = texture2D(u_NormalTexture, uv0);\n\t\tnormalT.x = 2.0 * normalMapSample.x - 1.0;\n\t\tnormalT.y = 1.0 - 2.0 * normalMapSample.y;\n\t\tnormalT.xy *= u_normalScale;\n\t\tnormalT.z = sqrt(1.0 - clamp(dot(normalT.xy, normalT.xy), 0.0, 1.0));\n\t\t\n\t\tvec3 T = normalize(v_Tangent);\n\t\tvec3 B = normalize(v_Binormal);\n\t\tvec3 N = normalize(v_Normal);\n\t\tmat3 TBN = mat3(T, B, N);\n\t\t\n\t\tvec3 bumpedNormal = TBN * normalize(normalT);\n\t\treturn bumpedNormal;\n\t#else\n\t\treturn normalize(v_Normal);\n\t#endif\n}\n\nvec4 DielectricSpecularColor = vec4(0.220916301, 0.220916301, 0.220916301, 1.0 - 0.220916301);\n\nfloat PI = 3.14159265359;\n\nvec3 FresnelTerm (in vec3 F0, in float cosA)\n{\n\treturn F0 + (vec3(1.0) - F0) * pow(1.0 - cosA, 5.0);\n}\n\nfloat PerceptualRoughnessToRoughness(in float perceptualRoughness)\n{\n\treturn perceptualRoughness * perceptualRoughness;\n}\n\nfloat PerceptualRoughnessToSpecularPower(in float perceptualRoughness)\n{\n\tfloat m = PerceptualRoughnessToRoughness(perceptualRoughness);\n\tfloat sq = max(0.0001, m * m);\n\tfloat n = (2.0 / sq) - 2.0;\n\tn = max(n, 0.0001);\n\treturn n;\n}\n\nfloat RoughnessToPerceptualRoughness(in float roughness)\n{\n\treturn sqrt(roughness);\n}\n\nfloat SmoothnessToRoughness(in float smoothness)\n{\n\treturn (1.0 - smoothness) * (1.0 - smoothness);\n}\n\nfloat SmoothnessToPerceptualRoughness(in float smoothness)\n{\n\treturn (1.0 - smoothness);\n}\n\nvec3 SafeNormalize(in vec3 inVec)\n{\n\tfloat dp3 = max(0.001,dot(inVec,inVec));\n\treturn inVec * (1.0 / sqrt(dp3));\n}\n\nfloat DisneyDiffuse(in float NdotV, in float NdotL, in float LdotH, in float perceptualRoughness)\n{\n\tfloat fd90 = 0.5 + 2.0 * LdotH * LdotH * perceptualRoughness;\n\tfloat lightScatter\t= (1.0 + (fd90 - 1.0) * pow(1.0 - NdotL,5.0));\n\tfloat viewScatter\t= (1.0 + (fd90 - 1.0) * pow(1.0 - NdotV,5.0));\n\n\treturn lightScatter * viewScatter;\n}\n\nfloat SmithJointGGXVisibilityTerm (float NdotL, float NdotV, float roughness)\n{\n\tfloat a = roughness;\n\tfloat lambdaV = NdotL * (NdotV * (1.0 - a) + a);\n\tfloat lambdaL = NdotV * (NdotL * (1.0 - a) + a);\n\n\treturn 0.5 / (lambdaV + lambdaL + 0.00001);\n}\n\nfloat GGXTerm (float NdotH, float roughness)\n{\n\tfloat a2 = roughness * roughness;\n\tfloat d = (NdotH * a2 - NdotH) * NdotH + 1.0;\n\treturn 0.31830988618 * a2 / (d * d + 0.0000001);\n}\n\nfloat OneMinusReflectivityFromMetallic(in float metallic)\n{\n\tfloat oneMinusDielectricSpec = DielectricSpecularColor.a;\n\treturn oneMinusDielectricSpec - metallic * oneMinusDielectricSpec;\n}\n\nfloat SpecularStrength(vec3 specular)\n{\n    //(SHADER_TARGET < 30)return specular.r; \n    return max (max (specular.r, specular.g), specular.b);\n}\n\nvec3 DiffuseAndSpecularFromMetallic(in vec3 diffuseColor, in float metallic, out vec3 specularColor, out float oneMinusReflectivity)\n{\n\tspecularColor = mix(DielectricSpecularColor.rgb, diffuseColor, metallic);\n\toneMinusReflectivity = OneMinusReflectivityFromMetallic(metallic);\n\treturn diffuseColor * oneMinusReflectivity;\n}\n\nvec3 EnergyConservationBetweenDiffuseAndSpecular(in vec3 diffuseColor, in vec3 specularColor, out float oneMinusReflectivity)\n{\n\toneMinusReflectivity = 1.0 - SpecularStrength(specularColor);\n\treturn diffuseColor * oneMinusReflectivity;\n}\n\nvec4 Occlusion(in vec2 uv0){\n\t#ifdef OCCLUSIONTEXTURE\n\t\tvec4 occlusionTextureColor = texture2D(u_OcclusionTexture, uv0);\n\t\tfloat occ = occlusionTextureColor.g;\n\t\tfloat oneMinusT = 1.0 - u_occlusionStrength;\n\t\tfloat lerpOneTo = oneMinusT + occ * u_occlusionStrength;\n\t\treturn occlusionTextureColor * lerpOneTo;\n\t#else\n\t\treturn vec4(1.0);\n\t#endif\n}\n\nvec2 ParallaxOffset(in vec3 viewDir){\n\t#ifdef PARALLAXTEXTURE\n\t\tfloat h = texture2D(u_ParallaxTexture, v_Texcoord0).g;\n\t\th = h * u_parallaxScale - u_parallaxScale / 2.0;\n\t\tvec3 v = viewDir;\n\t\tv.z += 0.42;\n\t\tvec2 offset = h * (v.xy / v.z);\n\t\treturn v_Texcoord0 + offset;\n\t#else\n\t\treturn v_Texcoord0;\n\t#endif\n}\n\n"),Fi.addInclude("PBRStandardLighting.glsl",'#include "PBRUtils.glsl"\n#include "BRDF.glsl"\n\nvec4 PBRStandardLight(in vec3 diffuseColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in vec3 gi)\n{\n\tfloat oneMinusReflectivity;\n\tvec3 specularColor;\n\tdiffuseColor = DiffuseAndSpecularFromMetallic (diffuseColor, metallic, specularColor, oneMinusReflectivity);\n\t\n\tvec4 color = LayaAirBRDF(diffuseColor, specularColor, oneMinusReflectivity, smoothness, normal, viewDir, lightDir, lightColor, gi);\n\treturn color;\n}\n\nvec4 PBRStandardDiectionLight (in vec3 diffuseColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in DirectionLight light, in vec3 gi)\n{\n\tvec3 lightVec = normalize(light.Direction);\n\treturn PBRStandardLight(diffuseColor, metallic, smoothness, normal, viewDir, lightVec, light.Color, gi);\n}\n\nvec2 MetallicGloss(in float diffuseTextureAlpha, in vec2 uv0)\n{\n\tvec2 mg;\n\t\n\t#ifdef METALLICGLOSSTEXTURE\n\t\tvec4 metallicGlossTextureColor = texture2D(u_MetallicGlossTexture, uv0);\n\t\t#ifdef SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA\n\t\t\tmg.r = metallicGlossTextureColor.r;\n\t\t\tmg.g = diffuseTextureAlpha;\n\t\t#else\n\t\t    mg = metallicGlossTextureColor.ra;\n\t\t#endif\n\t\tmg.g *= u_smoothnessScale;\n\t#else\n\t\tmg.r = u_metallic;\n\t\t#ifdef SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA\n\t\t\tmg.g = diffuseTextureAlpha * u_smoothnessScale;\n\t\t#else\n\t\t\tmg.g = u_smoothness;\n\t\t#endif\n\t#endif\n\t\n\treturn mg;\n}\n\n'),Fi.addInclude("PBRSpecularLighting.glsl",'#include "PBRUtils.glsl"\n#include "BRDF.glsl"\n\nvec4 PBRSpecularLight(in vec3 diffuseColor, in vec3 specularColor, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in vec3 gi)\n{\n\tfloat oneMinusReflectivity;\n\tdiffuseColor = EnergyConservationBetweenDiffuseAndSpecular (diffuseColor, specularColor, oneMinusReflectivity);\n\t\n\tvec4 color = LayaAirBRDF(diffuseColor, specularColor, oneMinusReflectivity, smoothness, normal, viewDir, lightDir, lightColor, gi);\n\treturn color;\n}\n\nvec4 PBRSpecularDiectionLight (in vec3 diffuseColor, in vec3 specularColor, in float smoothness, in vec3 normal, in vec3 viewDir, in DirectionLight light, in vec3 gi)\n{\n\tvec3 lightVec = normalize(light.Direction);\n\treturn PBRSpecularLight(diffuseColor, specularColor, smoothness, normal, viewDir, lightVec, light.Color, gi);\n}\n\nvec4 SpecularGloss(float diffuseTextureAlpha, in vec2 uv0)\n{\n    vec4 sg;\n\t\n\t#ifdef SPECULARTEXTURE\n\t\tvec4 specularTextureColor = texture2D(u_SpecularTexture, uv0);\n\t\t#ifdef SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA\n\t\t\tsg.rgb = specularTextureColor.rgb;\n\t\t\tsg.a = diffuseTextureAlpha;\n\t\t#else\n\t\t\tsg = specularTextureColor;\n\t\t#endif\n\t\tsg.a *= u_smoothnessScale;\n\t#else\n\t\tsg.rgb = u_SpecularColor.rgb;\n\t\t#ifdef SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA\n\t\t\tsg.a = diffuseTextureAlpha * u_smoothnessScale;\n\t\t#else\n\t\t\tsg.a = u_smoothness;\n\t\t#endif\n\t#endif\n\t\n    return sg;\n}\n\n');var i={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},n={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_ReflectTexture:[5,1],u_AlphaTestValue:[0,1],u_DiffuseColor:[6,1],u_MaterialSpecular:[8,1],u_Shininess:[9,1],u_MaterialReflect:[10,1],u_TilingOffset:[11,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Color":[4,4],"u_DirectionLight.Direction":[3,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Color":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Color":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]},r=Fi.nameKey.add("BLINNPHONG");t='attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\n\tattribute vec2 a_Texcoord0;\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(LIGHTMAP)&&defined(UV1)\n\tattribute vec2 a_Texcoord1;\n#endif\n\n#ifdef LIGHTMAP\n\tuniform vec4 u_LightmapScaleOffset;\n\tvarying vec2 v_LightMapUV;\n#endif\n\n#ifdef COLOR\n\tattribute vec4 a_Color;\n\tvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tattribute vec3 a_Normal;\n\tvarying vec3 v_Normal; \n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_ViewDir; \n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\n\tattribute vec4 a_Tangent0;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\tuniform mat4 u_WorldMat;\n\tvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform=mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position=skinTransform*a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t#endif\n\t \n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0=a_Texcoord0;\n\t#endif\n\t\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform=mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position=skinTransform*a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tmat3 worldMat;\n\t\t#ifdef BONE\n\t\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t\t#else\n\t\t\tworldMat=mat3(u_WorldMat);\n\t\t#endif  \n\t\tv_Normal=worldMat*a_Normal;//TODO:法线可以用"魔法"矩阵\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\t\tv_Tangent=worldMat*a_Tangent0.xyz;\n\t\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\n\t\t#endif\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t\t#ifdef BONE\n\t\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t\t#else\n\t\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t\t#endif\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tv_ViewDir=u_CameraPos-v_PositionWorld;\n\t#endif\n\n\t#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\t\tv_Texcoord0=a_Texcoord0;\n\t\t#ifdef TILINGOFFSET\n\t\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\t\tv_Texcoord0=vec2(v_Texcoord0.x,1.0+v_Texcoord0.y);\n\t\t#endif\n\t#endif\n\n\t#ifdef LIGHTMAP\n\t\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t\t#ifdef UV1\n\t\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t\t#else\n\t\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t\t#endif \n\t\t#else\n\t\t\t#ifdef UV1\n\t\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t\t#else\n\t\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t\t#endif \n\t\t#endif \n\t#endif\n\n\t#ifdef COLOR\n\t\tv_Color=a_Color;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}',e='#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Lighting.glsl";\n\nuniform vec4 u_DiffuseColor;\n\n#ifdef COLOR\n\tvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvarying vec3 v_ViewDir; \n#endif\n\n#ifdef ALPHATEST\n\tuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\n\tuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\n\tuniform samplerCube u_ReflectTexture;\n\tuniform vec3 u_MaterialReflect;\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#ifdef LIGHTMAP\n\tvarying vec2 v_LightMapUV;\n\tuniform sampler2D u_LightMap;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tuniform vec3 u_MaterialSpecular;\n\tuniform float u_Shininess;\n\t#ifdef SPECULARMAP \n\t\tuniform sampler2D u_SpecularTexture;\n\t#endif\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\tuniform sampler2D u_NormalTexture;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#ifdef DIRECTIONLIGHT\n\tuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n\tuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n\tuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n\tvec4 mainColor=u_DiffuseColor;\n\t#ifdef DIFFUSEMAP\n\t\tvec4 difTexColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\t\tmainColor=mainColor*difTexColor;\n\t#endif \n\t#ifdef COLOR\n\t\tmainColor=mainColor*v_Color;\n\t#endif \n    \n\t#ifdef ALPHATEST\n\t\tif(mainColor.a<u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n  \n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tvec3 normal;\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent,v_Binormal));\n\t\t#else\n\t\t\tnormal = normalize(v_Normal);\n\t\t#endif\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tvec3 viewDir= normalize(v_ViewDir);\n\t\tvec3 diffuse = vec3(0.0);\n\t\tvec3 specular= vec3(0.0);\n\t\tvec3 dif,spe;\n\t\t#ifdef SPECULARMAP\n\t\t\tvec3 gloss=texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n\t\t#else\n\t\t\t#ifdef DIFFUSEMAP\n\t\t\t\tvec3 gloss=vec3(difTexColor.a);\n\t\t\t#else\n\t\t\t\tvec3 gloss=vec3(1.0);\n\t\t\t#endif\n\t\t#endif\n\t#endif\n\n\t\n\t#ifdef DIRECTIONLIGHT\n\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_DirectionLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n \n\t#ifdef POINTLIGHT\n\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_PointLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n\n\t#ifdef SPOTLIGHT\n\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_SpotLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n\n\t\n\tvec3 finalDiffuse;\n\t#ifdef LIGHTMAP\n\t\tfinalDiffuse=texture2D(u_LightMap, v_LightMapUV).rgb*2.0;\n\t\t//float exponent = texture2D(u_LightMap, v_LightMapUV).a;\n\t\t//finalDiffuse = texture2D(u_LightMap, v_LightMapUV).rgb;\n\t\t//float ratio = pow(2.0, exponent * 255.0 - (128.0 + 8.0));\n\t\t//finalDiffuse = finalDiffuse * 255.0 * ratio;\t\n\t\t//finalDiffuse = sqrt(finalDiffuse);\n\t#else\n\t\tfinalDiffuse=vec3(0.0);\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tfinalDiffuse+=diffuse;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor =vec4(mainColor.rgb*(u_AmbientColor + finalDiffuse)*shadowValue,mainColor.a);\n\t#else\n\t\tgl_FragColor =vec4(mainColor.rgb*(u_AmbientColor + finalDiffuse),mainColor.a);\n\t#endif\n\t\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\t#ifdef RECEIVESHADOW\n\t\t\tgl_FragColor.rgb+=specular*shadowValue;\n\t\t#else\n\t\t\tgl_FragColor.rgb+=specular;\n\t\t#endif\n\t#endif\n\n\n\t#ifdef REFLECTMAP\n\t\tvec3 incident = -viewDir;\n\t\tvec3 reflectionVector = reflect(incident,normal);\n\t\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\t\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n\t#endif\n\t  \n\t#ifdef FOG\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t  main_normal();\n\t#endif  \n}\n\n';var a=ui.add(r,t,e,i,n);Bi.SHADERDEFINE_DIFFUSEMAP=a.registerMaterialDefine("DIFFUSEMAP"),Bi.SHADERDEFINE_NORMALMAP=a.registerMaterialDefine("NORMALMAP"),Bi.SHADERDEFINE_SPECULARMAP=a.registerMaterialDefine("SPECULARMAP"),Bi.SHADERDEFINE_REFLECTMAP=a.registerMaterialDefine("REFLECTMAP"),Bi.SHADERDEFINE_TILINGOFFSET=a.registerMaterialDefine("TILINGOFFSET"),Bi.SHADERDEFINE_ADDTIVEFOG=a.registerMaterialDefine("ADDTIVEFOG"),i={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},n={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var s=Fi.nameKey.add("SIMPLE");t="attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",e='#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',a=ui.add(s,t,e,i,n),Wi.SHADERDEFINE_DIFFUSEMAP=a.registerMaterialDefine("DIFFUSEMAP"),Wi.SHADERDEFINE_NORMALMAP=a.registerMaterialDefine("NORMALMAP"),Wi.SHADERDEFINE_SPECULARMAP=a.registerMaterialDefine("SPECULARMAP"),Wi.SHADERDEFINE_EMISSIVEMAP=a.registerMaterialDefine("EMISSIVEMAP"),Wi.SHADERDEFINE_AMBIENTMAP=a.registerMaterialDefine("AMBIENTMAP"),Wi.SHADERDEFINE_REFLECTMAP=a.registerMaterialDefine("REFLECTMAP"),Wi.SHADERDEFINE_UVTRANSFORM=a.registerMaterialDefine("UVTRANSFORM"),Wi.SHADERDEFINE_TILINGOFFSET=a.registerMaterialDefine("TILINGOFFSET"),Wi.SHADERDEFINE_ADDTIVEFOG=a.registerMaterialDefine("ADDTIVEFOG"),i={a_Position:0,a_Color:1},n={u_MvpMatrix:[1,2]};var o=Fi.nameKey.add("LINE");t="attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n\n\nvoid main()\n{\n  gl_Position = u_MvpMatrix * a_Position;\n  v_Color=a_Color;\n}",e="#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec4 v_Color;\n\nvoid main()\n{\n  gl_FragColor=v_Color; \n}\n\n",ui.add(o,t,e,i,n),i={a_position:0,a_normal:3,tangent:5,binormal:4,uv:2,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},n={u_Bones:[0,0],u_lodRect:[9,3],irrad_mat_red:[10,3],irrad_mat_green:[11,3],irrad_mat_blue:[12,3],u_hdrexposure:[13,3],u_aoObjPos:[14,1],texBaseColor:[1,1],texNormal:[2,1],texPbrInfo:[3,1],texPrefilterdEnv:[8,3],texHSNoise:[15,1],texPrefilterDiff:[7,3],u_AlphaTestValue:[0,1],texBRDFLUT:[4,1],u_UVAniAge:[5,1],u_roughness:[6,1],u_metaless:[7,1],u_UVMatrix:[8,1],u_UVAge:[9,1],modelMatrix:[0,2],mvp:[1,2],cameraPosition:[0,3],u_View:[1,3],u_Project:[2,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var l=Fi.nameKey.add("PBR");t="\nuniform mat4 modelMatrix;\n//uniform mat4 modelViewMatrix;\n//uniform mat4 projectionMatrix;\nuniform mat4 u_View;\nuniform mat4 u_Project;\nuniform mat4 mvp;\n//uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\nattribute vec3 a_position;\nattribute vec3 a_normal;\n#ifdef HAS_TANGENT\nattribute vec3 tangent;\nattribute vec3 binormal;\n#endif\nattribute vec2 uv;\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvarying vec2 vUv;\nvarying vec3 vWorldNorm;\nvarying vec4 vViewPos;\nvarying vec4 vWorldPos;\nvarying vec3 vLightDir;\nvarying vec3 vViewDir;\n#ifdef HAS_TANGENT\nvarying vec3 vWorldTangent;\nvarying vec3 vWorldBinormal;\n#endif\n\n#ifdef RECEIVESHADOW\nvarying float v_posViewZ;\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\nvoid main() {\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tgl_Position = mvp*skinTransform*vec4(a_position,1.);\n\tmat4 modelMat = modelMatrix*skinTransform;\n#else\n\tgl_Position = mvp*vec4(a_position,1.);\n\tmat4 modelMat = modelMatrix;\n#endif\t\n\tvWorldPos = modelMat*vec4(a_position,1.);\n\n#ifdef CASTSHADOW \n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tvUv = uv;\n\t#endif\t\n#else\n    vUv = uv;\n\tvWorldNorm = normalize((modelMat*vec4(a_normal,0.0)).xyz);\n\t#ifdef HAS_TANGENT\n\tvWorldTangent = normalize((modelMat*vec4(tangent,0.0)).xyz);\n\tvWorldBinormal = normalize((modelMat*vec4(binormal,0.0)).xyz);\n\t#endif\n    \n    vViewDir = (vWorldPos.xyz-cameraPosition);//这个不能normalize。否则无法线性差值了\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.z;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vWorldPos;\n\t#endif\n#endif\t\n#endif\n}\n",e='//#version 300 es\n\nprecision highp float;\nprecision lowp int;\n\nconst float PI = 3.14159265358979323846264;\nconst float _2PI = 6.2831853071796;\nvarying vec2 vUv;\nvarying vec3 vWorldNorm;\n#ifdef HAS_TANGENT\nvarying vec3 vWorldTangent;\nvarying vec3 vWorldBinormal;\n#endif\nvarying vec3 vViewDir;\nvarying vec4 vViewPos;\nvarying vec4 vWorldPos;\n//\nuniform sampler2D texBaseColor;\nuniform sampler2D texNormal;\n//预计算的贴图\nuniform sampler2D texPrefilterdEnv;\nuniform sampler2D texBRDFLUT;\nuniform sampler2D texPrefilterDiff;\n#ifdef HAS_PBRINFO\nuniform sampler2D texPbrInfo;   //Ao, Roughness, Metallic\n#endif\nuniform float u_hdrexposure;\nuniform float u_AlphaTestValue;\n\nuniform float u_roughness;\nuniform float u_metaless;\nconst float maxlv = 7.;\t//现在只支持512分辨率的环境贴图\nconst int nmaxlv = 9;//\n\t\t\t\t\t\t\t\nuniform mat4 irrad_mat_red;\nuniform mat4 irrad_mat_green;\nuniform mat4 irrad_mat_blue;\t\t\t\t\t\t\t\n\nvec3 speccontrib = vec3(0.);\n\nconst float _maxu8 = 255.0;\nconst float _maxu16 = 65535.0;\nconst float _shift8 = 256.0;    //平移的话是*256而不是255\nvec2 _RGBAToU16(const in vec4 rgba){\n    return vec2((rgba.r*_maxu8+rgba.g*_maxu8*_shift8)/_maxu16, (rgba.b*_maxu8+rgba.a*_maxu8*_shift8)/_maxu16);\n}\nvec3 _RGBEToRGB( const in vec4 rgba ){\n    float f = pow(2.0, rgba.w * 255.0 - (128.0 + 8.0));\n    return rgba.rgb * (255.0 * f);\n}\n\nfloat saturate(float v){\n    return min(max(v,0.),1.);\n}\n\nvec4 tex2dLod(sampler2D tex, float u, float v, float lod){\n\tvec2 uv = vec2(u,v);\n\tuv+=mod(gl_FragCoord.xy-vec2(0.5),2.0)*vec2(128.,0.);\n\treturn texture2D(tex,uv,lod-16.);\n}\n\n/*\n* 对一个全景图进行采样。假设x轴指向中心。\n*/\nvec4 texPanorama(sampler2D tex, const in vec3 dir){\n\tfloat envu = atan(dir.z,dir.x)/_2PI+0.5; \t\n\tfloat envv = acos(dir.y)/PI;//(1.0-dir.y)/2.0;\n\treturn texture2D(tex,vec2(envu,envv));\n}\n\nvec4 texPanoramaLod(sampler2D tex, const in vec3 dir, float lod){\n\tfloat envu = atan(dir.z,dir.x)/_2PI+0.5; \t\n\tfloat envv = acos(dir.y)/PI;//(1.0-dir.y)/2.0;\n\treturn tex2dLod(tex,envu,envv,lod);\n}\n\n/*\n    计算sh光照。\n    使用level=2，所以需要9个系数。\n    https://cseweb.ucsd.edu/~ravir/papers/envmap/envmap.pdf\n*/\nfloat environment_exposure = 1.0;\nvec3 diff_sh9(vec3 dir){\n\tvec4 shDir = vec4(dir.x,-dir.z,dir.y,1.0);\n  return max(vec3(0.0), vec3(\n\tdot(shDir, irrad_mat_red * shDir),\n\tdot(shDir, irrad_mat_green * shDir),\n\tdot(shDir, irrad_mat_blue * shDir)\n\t)) * environment_exposure;\t\n}\n\n#ifdef HAS_TANGENT\nvec3 applyNormalTex( vec3 norm, vec3 surf_norm ) {\n    vec3 mapN = norm * 2.0 - 1.0;\n    //mapN.xy = normalScale * mapN.xy;\n    mat3 tsn = mat3( vWorldTangent, vWorldBinormal, surf_norm );\n    return normalize( tsn * mapN );\n}\n#endif\n\nvec4 pbrlight(vec3 normal, float rough, float NoV, vec3 R){\n    vec4 basecolor = texture2D(texBaseColor,vUv);\n\tbasecolor.rgb = pow(basecolor.rgb,vec3(2.2));\n\tfloat metaless = 1.0; \t\n\tconst float ismetalinfov = (128./255.);\n\tif(basecolor.a>=ismetalinfov){//这时候表示金属度\n\t\tmetaless = (basecolor.a-ismetalinfov)*2.;\n\t\tbasecolor.a = 1.0;\n\t}else{\n\t\tmetaless = 0.;\n\t\tbasecolor.a = basecolor.a*2.0;\n\t}\n\t#ifdef FIX_METALESS\n\tmetaless = u_metaless;\n\t#endif\n\t#ifdef HAS_PBRINFO\t\n\tvec4 pbrinfo = texture2D(texPbrInfo, vUv);\n\tmetaless = pbrinfo.b;\n\trough = pbrinfo.g;\n\t#endif\n    const vec3 nonmetalF0 =vec3(0.02);\n    vec3 F0 =  mix(nonmetalF0, basecolor.rgb, metaless);\n\t\n    vec4 PrefilteredColor = texPanoramaLod(texPrefilterdEnv, R, rough*maxlv);\n    PrefilteredColor.rgb = _RGBEToRGB(PrefilteredColor);\n    vec4 EnvBRDF = texture2D(texBRDFLUT,vec2(rough , NoV));//TODO lod\n    vec2 rg = _RGBAToU16(EnvBRDF);    \n    speccontrib = (F0* rg.x + saturate( 50.0 * PrefilteredColor.g ) * rg.y);\n\tvec3 color_spec = PrefilteredColor.rgb*speccontrib;\n\t\n\tvec3 color_diff=diff_sh9(normal);\n\tvec3 outc =  color_diff*mix(basecolor.rgb,vec3(0.),metaless)*(vec3(1.0)-speccontrib)+color_spec;\n\t#ifdef HAS_PBRINFO\n\toutc*=pbrinfo.r;\n\t#endif\n\treturn vec4(outc, basecolor.a);\n}\n\nvec3 oldlight(vec4 normal, float NoV, vec3 R){\n    vec4 basecolor = texture2D(texBaseColor,vUv);\n\tconst vec3 lightdir=normalize(vec3(1.,1.,0.));\n\tconst vec3 spcecol = vec3(1.,0.8,0.8);\n\tconst vec3 amb = vec3(0.5);\n\tvec3 diffv =  (vec3(saturate(dot(lightdir,normal.xyz)))+amb);\n\t//vec3 spec = spcecol* pow(saturate(dot(R,lightdir)),(1.-pbrinfo.g)*5.);\n\treturn diffv*basecolor.rgb;//+spec;\n}\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\nvarying float v_posViewZ;\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nvoid main() {\n#ifdef CASTSHADOW\n\tgl_FragColor=packDepth(gl_FragCoord.w);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(texBaseColor,vUv).w;\n\t\tif( alpha < u_AlphaTestValue ){\n\t\t\tdiscard;\n\t\t}\n\t#endif\n#else\n\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,vWorldPos.xyz,v_posViewZ,0.0001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,vWorldPos.xyz,v_posViewZ,0.0001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.0001);\n\t\t#endif\n\t#endif\t\n\t\n    vec3 normal =  normalize(vWorldNorm);\n\tvec4 normtex = texture2D( texNormal, vUv );\n\t#ifdef HAS_TANGENT\t\n\tnormal = applyNormalTex(normtex.xyz, normal);\n\t#endif\n    vec3 view   = -normalize(vViewDir);\n    float NoV = saturate(dot( view, normal ));\n    vec3 R = 2. * NoV * normal - view;\n\tfloat roughness = normtex.a;\n\t#ifdef FIX_ROUGHNESS\n\troughness = u_roughness;\n\t#endif\n\t\n\tvec4 pbrl = pbrlight(normal,roughness,NoV,R)*u_hdrexposure;\n    gl_FragColor.rgb =  pow(pbrl.rgb,vec3(0.45455));\n\t//gl_FragColor.rgb = oldlight(normtex,NoV,R);\n\t#ifdef RECEIVESHADOW\n\tgl_FragColor.rgb *= max(shadowValue,0.7);\n\t#endif\n\t\n    gl_FragColor.a = pbrl.a;\n\n#endif\n}\n',a=ui.add(l,t,e,i,n),Hi.SHADERDEFINE_FIX_METALESS=a.registerMaterialDefine("FIX_METALESS"),Hi.SHADERDEFINE_FIX_ROUGHNESS=a.registerMaterialDefine("FIX_ROUGHNESS"),Hi.SHADERDEFINE_HAS_TANGENT=a.registerMaterialDefine("HAS_TANGENT"),Hi.SHADERDEFINE_HAS_PBRINFO=a.registerMaterialDefine("HAS_PBRINFO"),Hi.SHADERDEFINE_USE_GROUNDTRUTH=a.registerMaterialDefine("USE_GROUNDTRUTH"),Hi.SHADERDEFINE_TEST_CLIPZ=a.registerMaterialDefine("CLIPZ"),i={a_Position:0,a_Normal:3,a_Tangent0:5,a_Texcoord0:2,a_BoneWeights:7,a_BoneIndices:6},n={u_Bones:[0,0],u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_CameraPos:[0,3],u_AlphaTestValue:[0,1],u_DiffuseColor:[7,1],u_EmissionColor:[8,1],u_DiffuseTexture:[1,1],u_NormalTexture:[3,1],u_ParallaxTexture:[4,1],u_MetallicGlossTexture:[2,1],u_OcclusionTexture:[5,1],u_EmissionTexture:[6,1],u_metallic:[9,1],u_smoothness:[10,1],u_smoothnessScale:[11,1],u_occlusionStrength:[13,1],u_normalScale:[14,1],u_parallaxScale:[15,1],u_TilingOffset:[17,1],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Color":[4,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var h=Fi.nameKey.add("PBRStandard");t="attribute vec4 a_Position;\nattribute vec3 a_Normal;\nattribute vec4 a_Tangent0;\nattribute vec2 a_Texcoord0;\n\nuniform mat4 u_MvpMatrix;\nuniform mat4 u_WorldMat;\nuniform vec3 u_CameraPos;\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec3 v_PositionWorld;\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n\t  varying vec4 v_lightMVPPos;\n\t  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvoid main_castShadow()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform=mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position = skinTransform * a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t#endif\n\t \n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0 = a_Texcoord0;\n\t#endif\n\t\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tmat4 skinTransform = mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position = skinTransform * a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t\tv_PositionWorld = (u_WorldMat * position).xyz;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t\tworldMat = mat3(u_WorldMat);\n\t\tv_PositionWorld = (u_WorldMat * a_Position).xyz;\n\t#endif\n\t\n\tv_Normal = worldMat * a_Normal;\n\tv_Tangent = worldMat * a_Tangent0.xyz;\n\tv_Binormal = cross(v_Normal, v_Tangent) * a_Tangent0.w;\n  \n\tv_Texcoord0 = a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t#endif\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,1.0 + v_Texcoord0.y);\n  \n\tv_ViewDir = u_CameraPos - v_PositionWorld;\n  \n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}",e='#ifdef FSHIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\n\nuniform vec4 u_AmbientColor;\nuniform vec4 u_DiffuseColor;\n\n#ifdef DIFFUSETEXTURE\n\tuniform sampler2D u_DiffuseTexture;\n#endif\n#ifdef METALLICGLOSSTEXTURE\n\tuniform sampler2D u_MetallicGlossTexture;\n#endif\n#ifdef NORMALTEXTURE\n\tuniform sampler2D u_NormalTexture;\n\tuniform float u_normalScale;\n#endif\n#ifdef PARALLAXTEXTURE\n\tuniform sampler2D u_ParallaxTexture;\n\tuniform float u_parallaxScale;\n#endif\n#ifdef OCCLUSIONTEXTURE\n\tuniform sampler2D u_OcclusionTexture;\n\tuniform float u_occlusionStrength;\n#endif\n#ifdef EMISSION\n\t#ifdef EMISSIONTEXTURE\n\t\tuniform sampler2D u_EmissionTexture;\n\t#endif\n\tuniform vec4 u_EmissionColor;\n#endif\n\nuniform float u_AlphaTestValue;\nuniform float u_metallic;\nuniform float u_smoothness;\nuniform float u_smoothnessScale;\n\n#include "PBRStandardLighting.glsl"\n#include "ShadowHelper.glsl"\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nuniform DirectionLight u_DirectionLight;\n\nvoid main_castShadow()\n{\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\n\nvoid main_normal()\n{\t\n\tvec3 viewDir = normalize(v_ViewDir);\n\t\n\tvec2 uv0 = ParallaxOffset(viewDir);\n\t\n\tvec2 mg;\n\t#ifdef DIFFUSETEXTURE\n\t\tvec4 diffuseTextureColor = texture2D(u_DiffuseTexture, uv0);\n\t\tvec4 diffuseColor = diffuseTextureColor * u_DiffuseColor;\n\t\tmg = MetallicGloss(diffuseTextureColor.a, uv0);\n\t#else\n\t\tvec4 diffuseColor = u_DiffuseColor;\n\t\tmg = MetallicGloss(1.0, uv0);\n\t#endif\n\t\n\t#ifdef ALPHATEST\n\t\tif(diffuseColor.a < u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n\t\n\tgl_FragColor = diffuseColor;\n\t\n\tvec3 normal = UnpackScaleNormal(uv0);\n  \n\tvec3 gi = (u_AmbientColor * Occlusion(uv0)).rgb;\n  \n\tvec4 color = PBRStandardDiectionLight(diffuseColor.rgb, mg.r, mg.g, normal, viewDir, u_DirectionLight, gi);\n\t\n\tcolor.a = diffuseColor.a;\n\t\n\t#ifdef EMISSION\n\t\tvec4 emissionColor = u_EmissionColor;\n\t\t#ifdef EMISSIONTEXTURE\n\t\t\temissionColor *=  texture2D(u_EmissionTexture, uv0);\n\t\t#endif\n\t\tcolor.rgb += emissionColor.rgb;\n\t#endif\n\t\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor = vec4(color.rgb * shadowValue, color.a);\n\t#else\n\t\tgl_FragColor = color;\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif  \n}\n\n',a=ui.add(h,t,e,i,n),Gi.SHADERDEFINE_DIFFUSETEXTURE=a.registerMaterialDefine("DIFFUSETEXTURE"),Gi.SHADERDEFINE_METALLICGLOSSTEXTURE=a.registerMaterialDefine("METALLICGLOSSTEXTURE"),Gi.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=a.registerMaterialDefine("SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA"),Gi.SHADERDEFINE_NORMALTEXTURE=a.registerMaterialDefine("NORMALTEXTURE"),Gi.SHADERDEFINE_PARALLAXTEXTURE=a.registerMaterialDefine("PARALLAXTEXTURE"),Gi.SHADERDEFINE_OCCLUSIONTEXTURE=a.registerMaterialDefine("OCCLUSIONTEXTURE"),Gi.SHADERDEFINE_EMISSION=a.registerMaterialDefine("EMISSION"),Gi.SHADERDEFINE_EMISSIONTEXTURE=a.registerMaterialDefine("EMISSIONTEXTURE"),Gi.SHADERDEFINE_TILINGOFFSET=a.registerMaterialDefine("TILINGOFFSET"),i={a_Position:0,a_Normal:3,a_Tangent0:5,a_Texcoord0:2,a_BoneWeights:7,a_BoneIndices:6},n={u_Bones:[0,0],u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_CameraPos:[0,3],u_AlphaTestValue:[0,1],u_DiffuseColor:[7,1],u_SpecularColor:[8,1],u_EmissionColor:[9,1],u_DiffuseTexture:[1,1],u_NormalTexture:[3,1],u_ParallaxTexture:[4,1],u_SpecularTexture:[2,1],u_OcclusionTexture:[5,1],u_EmissionTexture:[6,1],u_smoothness:[10,1],u_smoothnessScale:[11,1],u_occlusionStrength:[13,1],u_normalScale:[14,1],u_parallaxScale:[15,1],u_TilingOffset:[17,1],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Color":[4,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var u=Fi.nameKey.add("PBRSpecular");t="attribute vec4 a_Position;\nattribute vec3 a_Normal;\nattribute vec4 a_Tangent0;\nattribute vec2 a_Texcoord0;\n\nuniform mat4 u_MvpMatrix;\nuniform mat4 u_WorldMat;\nuniform vec3 u_CameraPos;\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec3 v_PositionWorld;\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n\t  varying vec4 v_lightMVPPos;\n\t  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvoid main_castShadow()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform=mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position = skinTransform * a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t#endif\n\t \n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0 = a_Texcoord0;\n\t#endif\n\t\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tmat4 skinTransform = mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position = skinTransform * a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t\tv_PositionWorld = (u_WorldMat * position).xyz;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t\tworldMat = mat3(u_WorldMat);\n\t\tv_PositionWorld = (u_WorldMat * a_Position).xyz;\n\t#endif\n\t\n\tv_Normal = worldMat * a_Normal;\n\tv_Tangent = worldMat * a_Tangent0.xyz;\n\tv_Binormal = cross(v_Normal, v_Tangent) * a_Tangent0.w;\n  \n\tv_Texcoord0 = a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t#endif\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,1.0 + v_Texcoord0.y);\n  \n\tv_ViewDir = u_CameraPos - v_PositionWorld;\n  \n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}",e='#ifdef FSHIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\n\nuniform vec4 u_AmbientColor;\nuniform vec4 u_DiffuseColor;\nuniform vec4 u_SpecularColor;\n\n#ifdef DIFFUSETEXTURE\n\tuniform sampler2D u_DiffuseTexture;\n#endif\n#ifdef SPECULARTEXTURE\n\tuniform sampler2D u_SpecularTexture;\n#endif\n#ifdef NORMALTEXTURE\n\tuniform sampler2D u_NormalTexture;\n\tuniform float u_normalScale;\n#endif\n#ifdef PARALLAXTEXTURE\n\tuniform sampler2D u_ParallaxTexture;\n\tuniform float u_parallaxScale;\n#endif\n#ifdef OCCLUSIONTEXTURE\n\tuniform sampler2D u_OcclusionTexture;\n\tuniform float u_occlusionStrength;\n#endif\n#ifdef EMISSION\n\t#ifdef EMISSIONTEXTURE\n\t\tuniform sampler2D u_EmissionTexture;\n\t#endif\n\tuniform vec4 u_EmissionColor;\n#endif\n\nuniform float u_AlphaTestValue;\nuniform float u_metallic;\nuniform float u_smoothness;\nuniform float u_smoothnessScale;\n\n#include "PBRSpecularLighting.glsl"\n#include "ShadowHelper.glsl"\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nuniform DirectionLight u_DirectionLight;\n\nvoid main_castShadow()\n{\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\n\nvoid main_normal()\n{\t\n\tvec3 viewDir = normalize(v_ViewDir);\n\t\n\tvec2 uv0 = ParallaxOffset(viewDir);\n\t\n\tvec4 sg;\n\t#ifdef DIFFUSETEXTURE\n\t\tvec4 diffuseTextureColor = texture2D(u_DiffuseTexture, uv0);\n\t\tvec4 diffuseColor = diffuseTextureColor * u_DiffuseColor;\n\t\tsg = SpecularGloss(diffuseTextureColor.a, uv0);\n\t#else\n\t\tvec4 diffuseColor = u_DiffuseColor;\n\t\tsg = SpecularGloss(1.0, uv0);\n\t#endif\n\t\n\t#ifdef ALPHATEST\n\t\tif(diffuseColor.a < u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n  \n\tvec3 normal = UnpackScaleNormal(uv0);\n\t\n\tvec3 gi = (u_AmbientColor * Occlusion(uv0)).rgb;\n\t\n\t//float a = (sg.r+sg.g+sg.b) / 3.0;\n  \n\tvec4 color = PBRSpecularDiectionLight(diffuseColor.rgb, sg.rgb, sg.a, normal,viewDir, u_DirectionLight, gi);\n\t\n\tcolor.a = diffuseColor.a;\n\t\n\t#ifdef EMISSION\n\t\tvec4 emissionColor = u_EmissionColor;\n\t\t#ifdef EMISSIONTEXTURE\n\t\t\temissionColor *=  texture2D(u_EmissionTexture, uv0);\n\t\t#endif\n\t\tcolor.rgb += emissionColor.rgb;\n\t#endif\n\t\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor = vec4(color.rgb * shadowValue, color.a);\n\t#else\n\t\tgl_FragColor = color;\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif  \n}\n\n',a=ui.add(u,t,e,i,n),zi.SHADERDEFINE_DIFFUSETEXTURE=a.registerMaterialDefine("DIFFUSETEXTURE"),zi.SHADERDEFINE_SPECULARTEXTURE=a.registerMaterialDefine("SPECULARTEXTURE"),zi.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=a.registerMaterialDefine("SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA"),zi.SHADERDEFINE_NORMALTEXTURE=a.registerMaterialDefine("NORMALTEXTURE"),zi.SHADERDEFINE_PARALLAXTEXTURE=a.registerMaterialDefine("PARALLAXTEXTURE"),zi.SHADERDEFINE_OCCLUSIONTEXTURE=a.registerMaterialDefine("OCCLUSIONTEXTURE"),zi.SHADERDEFINE_EMISSION=a.registerMaterialDefine("EMISSION"),zi.SHADERDEFINE_EMISSIONTEXTURE=a.registerMaterialDefine("EMISSIONTEXTURE"),zi.SHADERDEFINE_TILINGOFFSET=a.registerMaterialDefine("TILINGOFFSET"),i={a_position:0,a_normal:3,uv:2},n={irrad_mat_red:[10,3],irrad_mat_green:[11,3],irrad_mat_blue:[12,3],u_hdrexposure:[13,3],texBaseColor:[1,1],texNormal:[2,1],texSky:[11,1],texUnderWater:[3,1],texPrefilterdEnv:[8,3],texPrefilterDiff:[7,3],texWaterDisp:[4,1],texWaveDetail:[9,1],texDeepColor:[10,1],texWaterInfo:[16,1],texFoam:[17,1],GEOWAVE_UV_SCALE:[18,1],modelMatrix:[0,2],mvp:[1,2],cameraPosition:[0,3],u_curTm:[8,1],u_scrsize:[15,1],u_WaveInfoD:[13,1],u_WaveInfo:[12,1],u_WaveMainDir:[14,1],u_DeepScale:[20,1],u_SeaColor:[19,1],u_View:[1,3],u_Project:[2,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4]};var c=Fi.nameKey.add("Water");t='\nuniform mat4 modelMatrix;\n//uniform mat4 modelViewMatrix;\n//uniform mat4 projectionMatrix;\nuniform mat4 u_View;\nuniform mat4 u_Project;\nuniform mat4 mvp;\n//uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\nuniform float u_curTm;\n\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 uv;\n//uniform sampler2D texWaterDisp;\n#ifdef USE_VERTEX_DEEPINFO\n#else\nuniform sampler2D texWaterInfo;\nvarying vec4 vWaterInfo;\nuniform float u_DeepScale;//texWaterInfo.r*vDeepScale\n#endif\nuniform float u_WaveMainDir;\t//主波方向\nuniform float GEOWAVE_UV_SCALE ;//= 100.0;\n\n\nvarying vec2 vUv;\nvarying vec3 vWorldNorm;\nvarying vec3 vWorldTan;\nvarying vec3 vWorldBin;\nvarying vec4 vViewPos;\nvarying vec4 vWorldPos;\nvarying vec3 vLightDir;\nvarying vec3 vViewDir;\nvarying vec3 vDisp;\nvarying float fDeep;\nvarying mat2 matUVTrans;\nvarying float fFoam;\n\nconst float PI = 3.14159265358979323846264;\n\n#include "WaveFunction.glsl"\n\nvec2 getPosFromUV(vec2 uv){\n\treturn uv*50.;\n}\n\nvoid main() {\n\tvec3 pos = a_position;\n    vUv = uv;\n\t\n\t//vDisp = texture2D(texWaterDisp,uv).rgb;\n\t//vec3 disp = vDisp;\n\t\n\t//TODO 这里有个潜规则。\n\tfloat tt = pos.y; pos.y=pos.z; pos.z=-tt;\n\t\n\t#ifdef USE_VERTEX_DEEPINFO\n\tfDeep = -pos.y;\n\tpos.y=0.0;\n\t#else\n\tvWaterInfo = texture2D(texWaterInfo,uv);\n\tfDeep = vWaterInfo.r*u_DeepScale;\n\t#endif\n\t\n\t\n\t//计算波形\n\tmat4 modelMat = modelMatrix;\n\tvec3 opos, T,B,N;\n\tfloat foams=0.;\n\tvec2 uvpos = uv*GEOWAVE_UV_SCALE+vec2(modelMat[3][0],0.);//TODO 如果有旋转缩放怎么办\n\tcalcGerstnerWave(u_curTm, pos,fDeep, uvpos,opos,B,T,N,foams);\n\tfFoam = foams;\n\tgl_Position = mvp*vec4(opos,1.);\n\tvWorldPos = modelMat*vec4(opos,1.);\n\n\tvWorldNorm = normalize((modelMatrix*vec4(N,0.0)).xyz);\n\tvWorldTan = normalize((modelMatrix*vec4(T,0.0)).xyz);\n\tvWorldBin = normalize((modelMatrix*vec4(B,0.0)).xyz);\n    vViewDir = vWorldPos.xyz-cameraPosition; //这个不能取normalize，否则会引入非线性\n\t\n\tfloat s = sin(u_WaveMainDir);\n\tfloat c = cos(u_WaveMainDir);\n\tmatUVTrans = mat2(c,-s,s,c);\n}\n',e="//#version 300 es\n\nprecision highp float;\nprecision lowp int;\n\nconst float PI = 3.14159265358979323846264;\nconst float _2PI = 6.2831853071796;\nvarying vec2 vUv;\nvarying vec3 vWorldNorm;\nvarying vec3 vWorldTan;\nvarying vec3 vWorldBin;\nvarying vec3 vViewDir;//入射。pos-cam\nvarying vec4 vViewPos;\nvarying vec4 vWorldPos;\nvarying float fDeep;\nvarying mat2 matUVTrans;\n#ifdef USE_VERTEX_DEEPINFO\n#else\nvarying vec4 vWaterInfo;\n#endif\nmat3 matTBNOff;//\n\n//\nuniform sampler2D texBaseColor;\nuniform sampler2D texNormal;\n#ifdef CUBE_ENV\nuniform samplerCube texSky;\n#else\nuniform sampler2D texSky;\n#endif\nuniform sampler2D texUnderWater;\nuniform sampler2D texWaveDetail;\n//uniform sampler2D texDeepColor;\nuniform sampler2D texFoam;\nvarying float fFoam;\nuniform float u_curTm;\nuniform vec2 u_scrsize;\nuniform vec3 u_SeaColor;//\n\nconst int NumTexWaves=4;\nconst float Amp_over_L = 0.01;\n//const vec3 SEA_COLOR1 = vec3(0.0292,0.672,0.7467);//大洋\n//const vec3 SEA_COLOR2 = vec3(0,0.927,0.43);//近海\n\nconst float _maxu8 = 255.0;\nconst float _maxu16 = 65535.0;\nconst float _shift8 = 256.0;    //平移的话是*256而不是255\nvec2 _RGBAToU16(const in vec4 rgba){\n    return vec2((rgba.r*_maxu8+rgba.g*_maxu8*_shift8)/_maxu16, (rgba.b*_maxu8+rgba.a*_maxu8*_shift8)/_maxu16);\n}\nvec3 _RGBEToRGB( const in vec4 rgba ){\n    float f = pow(2.0, rgba.w * 255.0 - (128.0 + 8.0));\n    return rgba.rgb * (255.0 * f);\n}\n\nfloat saturate(float v){\n    return min(max(v,0.),1.);\n}\n\n/*\n\t各种 ToneMap\n*/\n//Reinhard\nvec3 ReinhardToneMapping(vec3 color, float adapted_lum) {\n    const float MIDDLE_GREY = 1.;\n    color *= MIDDLE_GREY / adapted_lum;\n    return color / (1.0 + color);\n}\n\n//CE2\nvec3 CEToneMapping(vec3 color, float adapted_lum){\n    return 1. - exp(-adapted_lum * color);\n}\n\n//UC2\nvec3 F1(vec3 x){\n\tconst float A = 0.22;\n\tconst float B = 0.30;\n\tconst float C = 0.10;\n\tconst float D = 0.20;\n\tconst float E = 0.01;\n\tconst float F = 0.30;\n \n\treturn ((x * (A * x + C * B) + D * E) / (x * (A * x + B) + D * F)) - E / F;\n}\n\nvec3 Uncharted2ToneMapping(vec3 color, float adapted_lum){\n\tconst vec3 WHITE = vec3(11.2);\n\treturn F1(1.6 * adapted_lum * color) / F1(WHITE);\n}\n\n//ACES\nvec3 ACESToneMapping(vec3 color, float adapted_lum){\n\tconst float A = 2.51;\n\tconst float B = 0.03;\n\tconst float C = 2.43;\n\tconst float D = 0.59;\n\tconst float E = 0.14;\n\n\tcolor *= adapted_lum;\n\treturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\n\n/*\n* 对一个全景图进行采样。假设x轴指向中心。\n*/\nvec4 texPanorama(sampler2D tex, const in vec3 dir){\n\tfloat envu = atan(dir.z,dir.x)/_2PI+0.5; \t\n\tfloat envv = acos(dir.y)/PI;//(1.0-dir.y)/2.0;\n\treturn texture2D(tex,vec2(envu,envv));\n}\n\n/*\n\t与位于0点的测试棒的相交测试交点\n\t这个是瞎写的，只是为了测试\n*/\nbool hitClydiner(vec3 pos, vec3 dir, out vec3 hitpos, out vec3 hitnormal){\n\tconst float r = 0.5;\n\tfloat a = dir.x*dir.x+dir.z*dir.z;\n\tfloat b = 2.*dir.x*pos.x+2.*dir.z*pos.z;\n\tfloat c = pos.x*pos.x+pos.z*pos.z-r*r;\n\tfloat d = b*b-4.*a*c;\n\tif(d>=0.0){\n\t\tfloat t = (-b+sqrt(d))/2./a;\n\t\tt =min(t, (-b-sqrt(d))/2./a);\n\t\thitpos = pos+dir*t;\n\t\treturn true;\n\t}\n\t/*\n\tvec3 v1 = normalize(cross(dir,vec3(0.,1.,0.)));//公垂线\n\tfloat dist = dot(pos,v1);//最短距离\n\tif(abs(dist)<r){\n\t\treturn true;\n\t}\n\t*/\n\treturn false;\n}\n\n///* 根据散射公式来计算某个方向的颜色 *///\n//\nfloat phase_function(float costheta, float g, float g2){\n\treturn 1.5*( (1.0-g2) / (2.0+g2) ) * (1.0+costheta*costheta) / pow(1.0+g2-2.0*g*costheta, 1.5);\t\n}\n\nconst float _density = .2;\nconst vec3 _vLightDir=vec3(0.,-1.,0.);//必须是规格化的\nconst int _SAMPLENUM = 20;\nconst float _K1 = 1.0;\nconst float _g = -0.93;\n//\nvec3 calcScatter(vec3 start, vec3 dir, vec3 end){\n\tfloat len = length(end-start);\n\tfloat costheta = dot(dir,_vLightDir);\n\tfloat g2 = _g*_g;\n\tfloat K = _K1*len*_density*phase_function(costheta,_g,g2);\n\t//用分段的方式来积分\n\tfloat dlen = len/float(_SAMPLENUM);//距离平分\n\tfloat ddeep = (start.y-end.y)/float(_SAMPLENUM);//深度平分\n\tfloat sum=0.;\n\tfor( int i=0; i<_SAMPLENUM; i++){\n\t\tfloat fi = float(i);\n\t\tfloat v1 = exp(-_density*(dlen+ddeep)*fi);//TODO 应该可以用分析法计算出来\n\t\tsum += v1;\n\t}\n\treturn vec3(K*sum);\n}\n///* 根据散射公式来计算某个方向的亮度  END *///\n\nconst float cDeep = -2.;\t//假设水的深度\nvec3 getShuiDiColor(vec3 pos, vec3 dir, vec3 normal){\n\t//一个无限大的水底，黑白格纹理。纹理长度为1米\n\tfloat t = ( cDeep-pos.y )/dir.y;\n\tif(t<0.) return vec3(1.,0.,0.);//TEST\n\tbool bhit = false;\n\tvec3 hitpos;\n\tvec3 hitcolor;\n\tvec3 hn;\n\tif(hitClydiner(pos,dir,hitpos,hn) && hitpos.y>cDeep && hitpos.y<pos.y){\n\t\tbhit=true;\n\t\thitcolor = vec3(.8,.8,.8);\n\n\t}else\n\t{\n\t\thitpos = pos+dir*t;\n\t\tvec3 hp = floor(hitpos);\n\t\tfloat a = mod((hp.x+hp.z),2.);\n\t\thitcolor = (a<.9)?vec3(0.,0.,0.):vec3(1.,1.,1.);\n\t\t//hitcolor = texture2D(texUnderWater,hitpos.xz/10.).rgb;\n\t}\n\t\n\tfloat l = length(hitpos-pos);\n\t//return texture2D(texDeepColor,vec2(min(max(l/400.,0.),1.),0.5)).rgb;\n\t//return SEA_COLOR1*calcScatter(pos,dir,hitpos);\n\tfloat left = pow(0.8,l);//假设透过率为80%，则到达水底的时候的光强。\n\treturn mix(hitcolor,u_SeaColor,1.-left);\n}\n\n/*\n\tview已经normalize了\n*/\nvec3 getRefractColor(vec3 view,vec3 normal){\n\tvec3 T = refract(-view, normal, 0.7);\n\treturn getShuiDiColor(vWorldPos.xyz,T,normal); \n}\n\nvec4 calcWaterC(vec3 view, vec3 normal, float von, vec3 R, float rough){\n\t/*\n\t只有浪顶的法线向下，也就是波形形成了交叠的时候，才会这样，所以要通过参数控制避免出现这种情况，而不是在这里保护。\n\tif(dot(R,vec3(0.,1.,0.))<0.){\n\t\tR = -R;\n\t}\n\t*/\n\t//vec3 refr = getRefractColor(-view,normal);\n#ifdef USE_REFR_TEX\t\n\tvec3 refr = texture2D(texUnderWater, gl_FragCoord.xy/u_scrsize+normal.xz/8.).rgb;\n#else\n\tvec3 refr = u_SeaColor;\n#endif\n\tfloat F0=0.02;\n\t//菲涅尔，越大反射越强\n\tfloat f =  F0+(1.0-F0)*exp2((-5.55473*von-6.98316)*von);\n\t//float f = F0+(1.0-F0)*pow(1.-von,5.);\n\t//能看到水底的程度。反射剩余的*水中的衰减\n\t//float a = (1.-f)*(1.-deepk);\n#ifdef CUBE_ENV\n\tvec4 reflc = textureCube(texSky,R);\n#else\n\tvec4 reflc = texPanorama(texSky, R);\n#endif\n#ifdef HDR_ENV\n\tvec3 refl = _RGBEToRGB(reflc)*f;\n#else\n\tvec3 refl = reflc.rgb*f;\n#endif\n\t//return vec4(refl*(1.-rough),1.);\n\t\n\t//vec3 refl = reflc.rgb*f;\n\tvec3 final = mix(refr, u_SeaColor, min(fDeep/10.,1.))+refl*(max(0.,1.-rough));\n#ifdef HDR_ENV\n\tfinal = ACESToneMapping(final,1.);//TODO 这个要uniform传入\n#endif\n\treturn vec4(final,f);\n}\n\nvoid main() {\n    vec3 normal =  normalize(vWorldNorm);\n\t//如果uv=1为100米，希望每个细节纹理表示20米的小波形，则uv缩放是 100/20。细节纹理内部也要用这个值，即pos=uv*20\n\tvec2 ruv = matUVTrans*vUv;\n\tvec3 detailNorm = texture2D(texWaveDetail,fract(ruv*5.)).rgb*2.-vec3(1.);//TODO uv怎么算\n\tfloat texNormScale = 2.*PI*float(NumTexWaves)*Amp_over_L*2.5;\n\tdetailNorm *= vec3(texNormScale,1.,texNormScale);\n\t//旋转\n\t//细节纹理来自rendertarget，因此需要颠倒z\n\t\n\tmatTBNOff = mat3(matUVTrans[0][0],0.,matUVTrans[1][0],\n\t0.,1.,0.,\n\tmatUVTrans[0][1],0.,matUVTrans[1][1]\n\t);\n\t\n\t/*\n\tmatTBNOff = mat3(0.,0.,1.,\n\t0.,1.,0.,\n\t-1.,0.,0.\n\t);\n\t*/\n\n    mat3 tsn = mat3( vWorldBin, normal, vWorldTan);\t\n    //normal = normalize(tsn * matTBNOff * detailNorm);\n\tnormal = normalize(tsn * detailNorm); //这个应该更正确。因为本身方向就是根据uv算的，如果是静态图片才需要转换。\n\t//vec4 normtex = texture2D( texNormal, vUv );\n    vec3 view   = -normalize(vViewDir);//view 是指向camera的\n    float NoV = saturate(dot( view, normal ));\n    //vec3 R = 2. * NoV * normal - view;\n\t\n#ifdef USE_FOAM\t\n\tvec4 foamc = (texture2D(texFoam,vUv*50.)+texture2D(texFoam,vUv*20.))/2.;\n\tfloat nearcoast = 1.-min(fDeep/10.,1.);// 1.-vWaterInfo.r;\n\tfloat foams = (nearcoast/4.+fFoam)*2.*nearcoast;\n#else\n\tfloat foams =0.;\n#endif\n\t\n\tvec3 R = reflect(-view,normal);\n\tvec4 wc = calcWaterC(view, normal,NoV,R, foams);\n\n\tgl_FragColor.rgb = wc.rgb;//normalize(detailNorm).rrr;//((normal)+vec3(0.0))/1.;//normalize(normal).rgb;//texture2D(texWaveDetail,vUv).rgb;// fracColor * texture2D(texUnderWater, vUv*20.0).rgb;// vec3(1.0);//pbrl.rgb;\n    gl_FragColor.a = 1.0;//wc.a;\n#ifdef USE_FOAM\n\tgl_FragColor.rgb = mix(gl_FragColor.rgb,vec3(1.),foamc.a*foams);\n\tgl_FragColor.a = foamc.r;\n#endif\n\t//if(mod(vUv.x*100.,1.0)<0.02 || mod(vUv.y*100.,1.0)<0.02) gl_FragColor.rgb=vec3(0.5,.5,.5);\n\t//gl_FragColor.rgb = detailNorm;\n}\n",a=ui.add(c,t,e,i,n),Yi.SHADERDEFINE_CUBE_ENV=a.registerMaterialDefine("CUBE_ENV"),Yi.SHADERDEFINE_HDR_ENV=a.registerMaterialDefine("HDR_ENV"),Yi.SHADERDEFINE_SHOW_NORMAL=a.registerMaterialDefine("SHOW_NORMAL"),Yi.SHADERDEFINE_USEVERTEXHEIGHT=a.registerMaterialDefine("USE_VERTEX_DEEPINFO"),Yi.SHADERDEFINE_USE_FOAM=a.registerMaterialDefine("USE_FOAM"),Yi.SHADERDEFINE_USE_REFRACT_TEX=a.registerMaterialDefine("USE_REFR_TEX"),i={a_CornerTextureCoordinate:17,a_MeshPosition:0,a_MeshColor:1,a_MeshTextureCoordinate:2,a_ShapePositionStartLifeTime:30,a_DirectionTime:32,a_StartColor:19,a_EndColor:23,a_StartSize:20,a_StartRotation0:22,a_StartSpeed:31,a_Random0:34,a_Random1:35,a_SimulationWorldPostion:36,a_SimulationWorldRotation:37},n={u_Tintcolor:[2,1],u_TilingOffset:[3,1],u_texture:[1,1],u_WorldPosition:[0,2],u_WorldRotation:[1,2],u_PositionScale:[4,2],u_SizeScale:[5,2],u_ScalingMode:[6,2],u_Gravity:[7,2],u_ThreeDStartRotation:[8,2],u_StretchedBillboardLengthScale:[9,2],u_StretchedBillboardSpeedScale:[10,2],u_SimulationSpace:[11,2],u_CurrentTime:[12,2],u_ColorOverLifeGradientAlphas:[22,2],u_ColorOverLifeGradientColors:[23,2],u_MaxColorOverLifeGradientAlphas:[24,2],u_MaxColorOverLifeGradientColors:[25,2],u_VOLVelocityConst:[13,2],u_VOLVelocityGradientX:[14,2],u_VOLVelocityGradientY:[15,2],u_VOLVelocityGradientZ:[16,2],u_VOLVelocityConstMax:[17,2],u_VOLVelocityGradientMaxX:[18,2],u_VOLVelocityGradientMaxY:[19,2],u_VOLVelocityGradientMaxZ:[20,2],u_VOLSpaceType:[21,2],u_SOLSizeGradient:[26,2],u_SOLSizeGradientX:[27,2],u_SOLSizeGradientY:[28,2],u_SOLSizeGradientZ:[29,2],u_SOLSizeGradientMax:[30,2],u_SOLSizeGradientMaxX:[31,2],u_SOLSizeGradientMaxY:[32,2],u_SOLSizeGradientMaxZ:[33,2],u_ROLAngularVelocityConst:[34,2],u_ROLAngularVelocityConstSeprarate:[35,2],u_ROLAngularVelocityGradient:[36,2],u_ROLAngularVelocityGradientX:[37,2],u_ROLAngularVelocityGradientY:[38,2],u_ROLAngularVelocityGradientZ:[39,2],u_ROLAngularVelocityGradientW:[40,2],u_ROLAngularVelocityConstMax:[41,2],u_ROLAngularVelocityConstMaxSeprarate:[42,2],u_ROLAngularVelocityGradientMax:[43,2],u_ROLAngularVelocityGradientMaxX:[44,2],u_ROLAngularVelocityGradientMaxY:[45,2],u_ROLAngularVelocityGradientMaxZ:[46,2],u_ROLAngularVelocityGradientMaxW:[47,2],u_TSACycles:[48,2],u_TSASubUVLength:[49,2],u_TSAGradientUVs:[50,2],u_TSAMaxGradientUVs:[51,2],u_CameraPosition:[0,3],u_CameraDirection:[5,3],u_CameraUp:[6,3],u_View:[1,3],u_Projection:[2,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4]};var _=Fi.nameKey.add("PARTICLESHURIKEN");t="#ifdef HIGHPRECISION\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\n#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\n\tattribute vec4 a_CornerTextureCoordinate;\n#endif\n#ifdef RENDERMODE_MESH\n\tattribute vec3 a_MeshPosition;\n\tattribute vec4 a_MeshColor;\n\tattribute vec2 a_MeshTextureCoordinate;\n\tvarying vec4 v_MeshColor;\n#endif\n\nattribute vec4 a_ShapePositionStartLifeTime;\nattribute vec4 a_DirectionTime;\nattribute vec4 a_StartColor;\nattribute vec3 a_StartSize;\nattribute vec3 a_StartRotation0;\nattribute float a_StartSpeed;\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n  attribute vec4 a_Random0;\n#endif\n#if defined(TEXTURESHEETANIMATIONRANDOMCURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  attribute vec4 a_Random1;\n#endif\nattribute vec3 a_SimulationWorldPostion;\nattribute vec4 a_SimulationWorldRotation;\n\nvarying float v_Discard;\nvarying vec4 v_Color;\n#ifdef DIFFUSEMAP\n\tvarying vec2 v_TextureCoordinate;\n#endif\n\nuniform float u_CurrentTime;\nuniform vec3 u_Gravity;\n\nuniform vec3 u_WorldPosition;\nuniform vec4 u_WorldRotation;\nuniform bool u_ThreeDStartRotation;\nuniform int u_ScalingMode;\nuniform vec3 u_PositionScale;\nuniform vec3 u_SizeScale;\nuniform mat4 u_View;\nuniform mat4 u_Projection;\n\n#ifdef STRETCHEDBILLBOARD\n\tuniform vec3 u_CameraPosition;\n#endif\nuniform vec3 u_CameraDirection;//TODO:只有几种广告牌模式需要用\nuniform vec3 u_CameraUp;\n\nuniform  float u_StretchedBillboardLengthScale;\nuniform  float u_StretchedBillboardSpeedScale;\nuniform int u_SimulationSpace;\n\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  uniform  int  u_VOLSpaceType;\n#endif\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)\n  uniform  vec3 u_VOLVelocityConst;\n#endif\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  uniform  vec2 u_VOLVelocityGradientX[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientY[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientZ[4];//x为key,y为速度\n#endif\n#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n  uniform  vec3 u_VOLVelocityConstMax;\n#endif\n#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n  uniform  vec2 u_VOLVelocityGradientMaxX[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientMaxY[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientMaxZ[4];//x为key,y为速度\n#endif\n\n#ifdef COLOROVERLIFETIME\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n#endif\n#ifdef RANDOMCOLOROVERLIFETIME\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n  uniform  vec4 u_MaxColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_MaxColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n#endif\n\n\n#if defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMERANDOMCURVES)\n  uniform  vec2 u_SOLSizeGradient[4];//x为key,y为尺寸\n#endif\n#ifdef SIZEOVERLIFETIMERANDOMCURVES\n  uniform  vec2 u_SOLSizeGradientMax[4];//x为key,y为尺寸\n#endif\n#if defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\n  uniform  vec2 u_SOLSizeGradientX[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientY[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientZ[4];//x为key,y为尺寸\n#endif\n#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n  uniform  vec2 u_SOLSizeGradientMaxX[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientMaxY[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientMaxZ[4];//x为key,y为尺寸\n#endif\n\n\n#ifdef ROTATIONOVERLIFETIME\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\n    uniform  float u_ROLAngularVelocityConst;\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n    uniform  float u_ROLAngularVelocityConstMax;\n  #endif\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n    uniform  vec2 u_ROLAngularVelocityGradient[4];//x为key,y为旋转\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n    uniform  vec2 u_ROLAngularVelocityGradientMax[4];//x为key,y为旋转\n  #endif\n#endif\n#ifdef ROTATIONOVERLIFETIMESEPERATE\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\n    uniform  vec3 u_ROLAngularVelocityConstSeprarate;\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n    uniform  vec3 u_ROLAngularVelocityConstMaxSeprarate;\n  #endif\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n    uniform  vec2 u_ROLAngularVelocityGradientX[4];\n    uniform  vec2 u_ROLAngularVelocityGradientY[4];\n    uniform  vec2 u_ROLAngularVelocityGradientZ[4];\n\tuniform  vec2 u_ROLAngularVelocityGradientW[4];\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n    uniform  vec2 u_ROLAngularVelocityGradientMaxX[4];\n    uniform  vec2 u_ROLAngularVelocityGradientMaxY[4];\n    uniform  vec2 u_ROLAngularVelocityGradientMaxZ[4];\n\tuniform  vec2 u_ROLAngularVelocityGradientMaxW[4];\n  #endif\n#endif\n\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\n  uniform  float u_TSACycles;\n  uniform  vec2 u_TSASubUVLength;\n  uniform  vec2 u_TSAGradientUVs[4];//x为key,y为frame\n#endif\n#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\n  uniform  vec2 u_TSAMaxGradientUVs[4];//x为key,y为frame\n#endif\n\n#ifdef FOG\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvec3 rotationByEuler(in vec3 vector,in vec3 rot)\n{\n\tfloat halfRoll = rot.z * 0.5;\n    float halfPitch = rot.x * 0.5;\n\tfloat halfYaw = rot.y * 0.5;\n\n\tfloat sinRoll = sin(halfRoll);\n\tfloat cosRoll = cos(halfRoll);\n\tfloat sinPitch = sin(halfPitch);\n\tfloat cosPitch = cos(halfPitch);\n\tfloat sinYaw = sin(halfYaw);\n\tfloat cosYaw = cos(halfYaw);\n\n\tfloat quaX = (cosYaw * sinPitch * cosRoll) + (sinYaw * cosPitch * sinRoll);\n\tfloat quaY = (sinYaw * cosPitch * cosRoll) - (cosYaw * sinPitch * sinRoll);\n\tfloat quaZ = (cosYaw * cosPitch * sinRoll) - (sinYaw * sinPitch * cosRoll);\n\tfloat quaW = (cosYaw * cosPitch * cosRoll) + (sinYaw * sinPitch * sinRoll);\n\t\n\t//vec4 q=vec4(quaX,quaY,quaZ,quaW);\n\t//vec3 temp = cross(q.xyz, vector) + q.w * vector;\n\t//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\n\t\n\tfloat x = quaX + quaX;\n    float y = quaY + quaY;\n    float z = quaZ + quaZ;\n    float wx = quaW * x;\n    float wy = quaW * y;\n    float wz = quaW * z;\n\tfloat xx = quaX * x;\n    float xy = quaX * y;\n\tfloat xz = quaX * z;\n    float yy = quaY * y;\n    float yz = quaY * z;\n    float zz = quaZ * z;\n\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\n\t\n}\n\n//假定axis已经归一化\nvec3 rotationByAxis(in vec3 vector,in vec3 axis, in float angle)\n{\n\tfloat halfAngle = angle * 0.5;\n\tfloat sin = sin(halfAngle);\n\t\n\tfloat quaX = axis.x * sin;\n\tfloat quaY = axis.y * sin;\n\tfloat quaZ = axis.z * sin;\n\tfloat quaW = cos(halfAngle);\n\t\n\t//vec4 q=vec4(quaX,quaY,quaZ,quaW);\n\t//vec3 temp = cross(q.xyz, vector) + q.w * vector;\n\t//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\n\t\n\tfloat x = quaX + quaX;\n    float y = quaY + quaY;\n    float z = quaZ + quaZ;\n    float wx = quaW * x;\n    float wy = quaW * y;\n    float wz = quaW * z;\n\tfloat xx = quaX * x;\n    float xy = quaX * y;\n\tfloat xz = quaX * z;\n    float yy = quaY * y;\n    float yz = quaY * z;\n    float zz = quaZ * z;\n\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\n\t\n}\n\nvec3 rotationByQuaternions(in vec3 v,in vec4 q) \n{\n\treturn v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n}\n\n \n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\nfloat getCurValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\n{\n\tfloat curValue;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientNumber=gradientNumbers[i];\n\t\tfloat key=gradientNumber.x;\n\t\tif(key>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientNumber=gradientNumbers[i-1];\n\t\t\tfloat lastKey=lastGradientNumber.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\tcurValue=mix(lastGradientNumber.y,gradientNumber.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn curValue;\n}\n#endif\n\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\nfloat getTotalValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\n{\n\tfloat totalValue=0.0;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientNumber=gradientNumbers[i];\n\t\tfloat key=gradientNumber.x;\n\t\tvec2 lastGradientNumber=gradientNumbers[i-1];\n\t\tfloat lastValue=lastGradientNumber.y;\n\t\t\n\t\tif(key>=normalizedAge){\n\t\t\tfloat lastKey=lastGradientNumber.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\ttotalValue+=(lastValue+mix(lastValue,gradientNumber.y,age))/2.0*a_ShapePositionStartLifeTime.w*(normalizedAge-lastKey);\n\t\t\tbreak;\n\t\t}\n\t\telse{\n\t\t\ttotalValue+=(lastValue+gradientNumber.y)/2.0*a_ShapePositionStartLifeTime.w*(key-lastGradientNumber.x);\n\t\t}\n\t}\n\treturn totalValue;\n}\n#endif\n\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)\nvec4 getColorFromGradient(in vec2 gradientAlphas[4],in vec4 gradientColors[4],in float normalizedAge)\n{\n\tvec4 overTimeColor;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientAlpha=gradientAlphas[i];\n\t\tfloat alphaKey=gradientAlpha.x;\n\t\tif(alphaKey>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientAlpha=gradientAlphas[i-1];\n\t\t\tfloat lastAlphaKey=lastGradientAlpha.x;\n\t\t\tfloat age=(normalizedAge-lastAlphaKey)/(alphaKey-lastAlphaKey);\n\t\t\toverTimeColor.a=mix(lastGradientAlpha.y,gradientAlpha.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\t\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec4 gradientColor=gradientColors[i];\n\t\tfloat colorKey=gradientColor.x;\n\t\tif(colorKey>=normalizedAge)\n\t\t{\n\t\t\tvec4 lastGradientColor=gradientColors[i-1];\n\t\t\tfloat lastColorKey=lastGradientColor.x;\n\t\t\tfloat age=(normalizedAge-lastColorKey)/(colorKey-lastColorKey);\n\t\t\toverTimeColor.rgb=mix(gradientColors[i-1].yzw,gradientColor.yzw,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn overTimeColor;\n}\n#endif\n\n\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\nfloat getFrameFromGradient(in vec2 gradientFrames[4],in float normalizedAge)\n{\n\tfloat overTimeFrame;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientFrame=gradientFrames[i];\n\t\tfloat key=gradientFrame.x;\n\t\tif(key>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientFrame=gradientFrames[i-1];\n\t\t\tfloat lastKey=lastGradientFrame.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\toverTimeFrame=mix(lastGradientFrame.y,gradientFrame.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn floor(overTimeFrame);\n}\n#endif\n\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\nvec3 computeParticleLifeVelocity(in float normalizedAge)\n{\n  vec3 outLifeVelocity;\n  #ifdef VELOCITYOVERLIFETIMECONSTANT\n\t outLifeVelocity=u_VOLVelocityConst; \n  #endif\n  #ifdef VELOCITYOVERLIFETIMECURVE\n     outLifeVelocity= vec3(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\n  #endif\n  #ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n\t outLifeVelocity=mix(u_VOLVelocityConst,u_VOLVelocityConstMax,vec3(a_Random1.y,a_Random1.z,a_Random1.w)); \n  #endif\n  #ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n     outLifeVelocity=vec3(mix(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y),\n\t                 mix(getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z),\n\t\t\t\t\t mix(getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\n  #endif\n\t\t\t\t\t\n  return outLifeVelocity;\n} \n#endif\n\nvec3 computeParticlePosition(in vec3 startVelocity, in vec3 lifeVelocity,in float age,in float normalizedAge,vec3 gravityVelocity,vec4 worldRotation)\n{\n   vec3 startPosition;\n   vec3 lifePosition;\n   #if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t#ifdef VELOCITYOVERLIFETIMECONSTANT\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=lifeVelocity*age;\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMECURVE\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=vec3(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=lifeVelocity*age;\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=vec3(mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y)\n\t      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z)\n\t      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\n\t#endif\n\t\n\tvec3 finalPosition;\n\tif(u_VOLSpaceType==0){\n\t  if(u_ScalingMode!=2)\n\t   finalPosition =rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition),worldRotation);\n\t  else\n\t   finalPosition =rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition,worldRotation);\n\t}\n\telse{\n\t  if(u_ScalingMode!=2)\n\t    finalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation)+lifePosition;\n\t  else\n\t    finalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation)+lifePosition;\n\t}\n  #else\n\t startPosition=startVelocity*age;\n\t vec3 finalPosition;\n\t if(u_ScalingMode!=2)\n\t   finalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation);\n\t else\n\t   finalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation);\n  #endif\n  \n  if(u_SimulationSpace==0)\n    finalPosition=finalPosition+a_SimulationWorldPostion;\n  else if(u_SimulationSpace==1) \n    finalPosition=finalPosition+u_WorldPosition;\n  \n  finalPosition+=0.5*gravityVelocity*age;\n \n  return  finalPosition;\n}\n\n\nvec4 computeParticleColor(in vec4 color,in float normalizedAge)\n{\n\t#ifdef COLOROVERLIFETIME\n\t  color*=getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge);\n\t#endif\n\t\n\t#ifdef RANDOMCOLOROVERLIFETIME\n\t  color*=mix(getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge),getColorFromGradient(u_MaxColorOverLifeGradientAlphas,u_MaxColorOverLifeGradientColors,normalizedAge),a_Random0.y);\n\t#endif\n\n    return color;\n}\n\nvec2 computeParticleSizeBillbard(in vec2 size,in float normalizedAge)\n{\n\t#ifdef SIZEOVERLIFETIMECURVE\n\t\tsize*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVES\n\t    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \n\t#endif\n\t#ifdef SIZEOVERLIFETIMECURVESEPERATE\n\t\tsize*=vec2(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge));\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n\t    size*=vec2(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\n\t    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z));\n\t#endif\n\treturn size;\n}\n\n#ifdef RENDERMODE_MESH\nvec3 computeParticleSizeMesh(in vec3 size,in float normalizedAge)\n{\n\t#ifdef SIZEOVERLIFETIMECURVE\n\t\tsize*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVES\n\t    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \n\t#endif\n\t#ifdef SIZEOVERLIFETIMECURVESEPERATE\n\t\tsize*=vec3(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge));\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n\t    size*=vec3(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\n\t    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z)\n\t\t,mix(getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxZ,normalizedAge),a_Random0.z));\n\t#endif\n\treturn size;\n}\n#endif\n\nfloat computeParticleRotationFloat(in float rotation,in float age,in float normalizedAge)\n{ \n\t#ifdef ROTATIONOVERLIFETIME\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConst*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\n\t\t#endif\n\t#endif\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConstSeprarate.z*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConstSeprarate.z,u_ROLAngularVelocityConstMaxSeprarate.z,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\n\t\t#endif\n\t#endif\n\treturn rotation;\n}\n\n\n#if defined(RENDERMODE_MESH)&&(defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE))\nvec3 computeParticleRotationVec3(in vec3 rotation,in float age,in float normalizedAge)\n{ \n\t#ifdef ROTATIONOVERLIFETIME\n\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConst*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\n\t\t#endif\n\t#endif\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tvec3 ageRot=u_ROLAngularVelocityConstSeprarate*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=vec3(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge));\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tvec3 ageRot=mix(u_ROLAngularVelocityConstSeprarate,u_ROLAngularVelocityConstMaxSeprarate,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=vec3(mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxX,normalizedAge),a_Random0.w)\n\t        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxY,normalizedAge),a_Random0.w)\n\t        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\n\t\t#endif\n\t#endif\n\treturn rotation;\n}\n#endif\n\nvec2 computeParticleUV(in vec2 uv,in float normalizedAge)\n{ \n\t#ifdef TEXTURESHEETANIMATIONCURVE\n\t\tfloat cycleNormalizedAge=normalizedAge*u_TSACycles;\n\t\tfloat frame=getFrameFromGradient(u_TSAGradientUVs,cycleNormalizedAge-floor(cycleNormalizedAge));\n\t\tfloat totalULength=frame*u_TSASubUVLength.x;\n\t\tfloat floorTotalULength=floor(totalULength);\n\t    uv.x+=totalULength-floorTotalULength;\n\t\tuv.y+=floorTotalULength*u_TSASubUVLength.y;\n    #endif\n\t#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\n\t\tfloat cycleNormalizedAge=normalizedAge*u_TSACycles;\n\t\tfloat uvNormalizedAge=cycleNormalizedAge-floor(cycleNormalizedAge);\n\t    float frame=floor(mix(getFrameFromGradient(u_TSAGradientUVs,uvNormalizedAge),getFrameFromGradient(u_TSAMaxGradientUVs,uvNormalizedAge),a_Random1.x));\n\t\tfloat totalULength=frame*u_TSASubUVLength.x;\n\t\tfloat floorTotalULength=floor(totalULength);\n\t    uv.x+=totalULength-floorTotalULength;\n\t\tuv.y+=floorTotalULength*u_TSASubUVLength.y;\n    #endif\n\treturn uv;\n}\n\nvoid main()\n{\n\tfloat age = u_CurrentTime - a_DirectionTime.w;\n\tfloat normalizedAge = age/a_ShapePositionStartLifeTime.w;\n\tvec3 lifeVelocity;\n\tif(normalizedAge<1.0){ \n\tvec3 startVelocity=a_DirectionTime.xyz*a_StartSpeed;\n\t#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t\tlifeVelocity= computeParticleLifeVelocity(normalizedAge);//计算粒子生命周期速度\n\t#endif \n\tvec3 gravityVelocity=u_Gravity*age;\n\t\n\tvec4 worldRotation;\n\tif(u_SimulationSpace==0)\n\t\tworldRotation=a_SimulationWorldRotation;\n\telse\n\t\tworldRotation=u_WorldRotation;\n\t\n\tvec3 center=computeParticlePosition(startVelocity, lifeVelocity, age, normalizedAge,gravityVelocity,worldRotation);//计算粒子位置\n   \n   \n   #ifdef SPHERHBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        vec3 cameraUpVector =normalize(u_CameraUp);//TODO:是否外面归一化\n        vec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\n        vec3 upVector = normalize(cross(sideVector,u_CameraDirection));\n\t    corner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tvec3 rotation=vec3(a_StartRotation0.xy,computeParticleRotationFloat(a_StartRotation0.z,age,normalizedAge));\n\t\t\t\tcenter += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,rotation);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\t\tfloat c = cos(rot);\n\t\t\t\tfloat s = sin(rot);\n\t\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\t\tcorner=rotation*corner;\n\t\t\t\tcenter += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\n\t\t\t}\n\t\t#else\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tcenter += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,a_StartRotation0);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tfloat c = cos(a_StartRotation0.x);\n\t\t\t\tfloat s = sin(a_StartRotation0.x);\n\t\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\t\tcorner=rotation*corner;\n\t\t\t\tcenter += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\n\t\t\t}\n\t\t#endif\n   #endif\n   \n   #ifdef STRETCHEDBILLBOARD\n\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n\tvec3 velocity;\n\t#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t    if(u_VOLSpaceType==0)\n\t\t  velocity=rotationByQuaternions(u_SizeScale*(startVelocity+lifeVelocity),worldRotation)+gravityVelocity;\n\t    else\n\t\t  velocity=rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+lifeVelocity+gravityVelocity;\n    #else\n\t    velocity= rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+gravityVelocity;\n    #endif\t\n\t\tvec3 cameraUpVector = normalize(velocity);\n\t\tvec3 direction = normalize(center-u_CameraPosition);\n        vec3 sideVector = normalize(cross(direction,normalize(velocity)));\n\t\t\n\t\tsideVector=u_SizeScale.xzy*sideVector;\n\t\tcameraUpVector=length(vec3(u_SizeScale.x,0.0,0.0))*cameraUpVector;\n\t\t\n\t    vec2 size=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t\n\t    const mat2 rotaionZHalfPI=mat2(0.0, -1.0, 1.0, 0.0);\n\t    corner=rotaionZHalfPI*corner;\n\t    corner.y=corner.y-abs(corner.y);\n\t\t\n\t    float speed=length(velocity);//TODO:\n\t    center +=sign(u_SizeScale.x)*(sign(u_StretchedBillboardLengthScale)*size.x*corner.x*sideVector+(speed*u_StretchedBillboardSpeedScale+size.y*u_StretchedBillboardLengthScale)*corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef HORIZONTALBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        const vec3 cameraUpVector=vec3(0.0,0.0,1.0);\n\t    const vec3 sideVector = vec3(-1.0,0.0,0.0);\n\t\t\n\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n        float c = cos(rot);\n        float s = sin(rot);\n        mat2 rotation= mat2(c, -s, s, c);\n\t    corner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\n\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n        center +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef VERTICALBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        const vec3 cameraUpVector =vec3(0.0,1.0,0.0);\n        vec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\n\t\t\n\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n        float c = cos(rot);\n        float s = sin(rot);\n        mat2 rotation= mat2(c, -s, s, c);\n\t    corner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\n\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n        center +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef RENDERMODE_MESH\n\t    vec3 size=computeParticleSizeMesh(a_StartSize,normalizedAge);\n\t\t#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tvec3 rotation=vec3(a_StartRotation0.xy,-computeParticleRotationFloat(a_StartRotation0.z, age,normalizedAge));\n\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,rotation),worldRotation);\n\t\t\t}\n\t\t\telse{\n\t\t\t\t#ifdef ROTATIONOVERLIFETIME\n\t\t\t\t\tfloat angle=computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\t\t\tif(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\n\t\t\t\t\t\tcenter+= (rotationByQuaternions(rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),angle),worldRotation));//已验证\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\t#ifdef SHAPE\n\t\t\t\t\t\t\tcenter+= u_SizeScale.xzy*(rotationByQuaternions(rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),angle),worldRotation));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\t\tcenter+=rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle);//已验证\n\t\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\t\tcenter+=rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle),worldRotation);//已验证\n\t\t\t\t\t\t#endif\n\t\t\t\t\t}\n\t\t\t\t#endif\n\t\t\t\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t\t\t\t//TODO:是否应合并if(u_ThreeDStartRotation)分支代码,待测试\n\t\t\t\t\tvec3 angle=computeParticleRotationVec3(vec3(0.0,0.0,a_StartRotation0.z), age,normalizedAge);\n\t\t\t\t\tcenter+= (rotationByQuaternions(rotationByEuler(u_SizeScale*a_MeshPosition*size,vec3(angle.x,angle.y,angle.z)),worldRotation));//已验证\n\t\t\t\t#endif\t\n\t\t\t}\n\t\t#else\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,a_StartRotation0),worldRotation);//已验证\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\n\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\tcenter+= rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x);\n\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\tcenter+= (rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x),worldRotation));//已验证\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\t#ifdef SHAPE\n\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\tcenter+= u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x);\n\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x),worldRotation);\t\n\t\t\t\t\t#else\n\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\tcenter+= rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x);\n\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x),worldRotation);//已验证\n\t\t\t\t\t#endif\n\t\t\t\t}\n\t\t\t}\n\t\t#endif\n\t\tv_MeshColor=a_MeshColor;\n   #endif\n   \n    gl_Position=u_Projection*u_View*vec4(center,1.0);\n    v_Color = computeParticleColor(a_StartColor, normalizedAge);\n\t#ifdef DIFFUSEMAP\n\t\t#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\n\t\t\tv_TextureCoordinate =computeParticleUV(a_CornerTextureCoordinate.zw, normalizedAge);\n\t\t#endif\n\t\t#ifdef RENDERMODE_MESH\n\t\t\tv_TextureCoordinate =computeParticleUV(a_MeshTextureCoordinate, normalizedAge);\n\t\t#endif\n\t\t\n\t\t#ifdef TILINGOFFSET\n\t\t\tv_TextureCoordinate=vec2(v_TextureCoordinate.x,1.0-v_TextureCoordinate.y)*u_TilingOffset.xy+vec2(u_TilingOffset.z,-u_TilingOffset.w);//需要特殊处理\n\t\t\tv_TextureCoordinate=vec2(v_TextureCoordinate.x,1.0-v_TextureCoordinate.y);//需要特殊处理\n\t\t#endif\n\t#endif\n    v_Discard=0.0;\n\t  \n\t#ifdef FOG\n\t\tv_PositionWorld=center;\n\t#endif\n   }\n   else\n\t{\n\t\tv_Discard=1.0;\n\t}\n}\n\n",e="#ifdef HIGHPRECISION\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\nvarying float v_Discard;\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\nuniform sampler2D u_texture;\nuniform vec4 u_Tintcolor;\n\n#ifdef RENDERMODE_MESH\n\tvarying vec4 v_MeshColor;\n#endif\n\n#ifdef FOG\n\tvarying vec3 v_PositionWorld;\n\tuniform vec3 u_CameraPosition;\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\nvoid main()\n{\t\n\t#ifdef RENDERMODE_MESH\n\t\tgl_FragColor=v_MeshColor;\n\t#else\n\t\tgl_FragColor=vec4(1.0);\t\n\t#endif\n\t\t\n\t#ifdef DIFFUSEMAP\n\t\tif(v_Discard!=0.0)\n\t\t\tdiscard;\n\t\t#ifdef TINTCOLOR\n\t\t\tgl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*u_Tintcolor*2.0*v_Color;\n\t\t#else\n\t\t\tgl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*v_Color;\n\t\t#endif\n\t#else\n\t\t#ifdef TINTCOLOR\n\t\t\tgl_FragColor*=u_Tintcolor*2.0*v_Color;\n\t\t#else\n\t\t\tgl_FragColor*=v_Color;\n\t\t#endif\n\t#endif\n\t\n\t#ifdef FOG\n\t\tvec3 toEye=u_CameraPosition-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t\t\n\t\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t\t#endif\n\t#endif\n}",a=ui.add(_,t,e,i,n),Ki.SHADERDEFINE_DIFFUSEMAP=a.registerMaterialDefine("DIFFUSEMAP"),Ki.SHADERDEFINE_TINTCOLOR=a.registerMaterialDefine("TINTCOLOR"),Ki.SHADERDEFINE_ADDTIVEFOG=a.registerMaterialDefine("ADDTIVEFOG"),Ki.SHADERDEFINE_TILINGOFFSET=a.registerMaterialDefine("TILINGOFFSET"),vn.SHADERDEFINE_RENDERMODE_BILLBOARD=a.registerSpriteDefine("SPHERHBILLBOARD"),vn.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD=a.registerSpriteDefine("STRETCHEDBILLBOARD"),vn.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD=a.registerSpriteDefine("HORIZONTALBILLBOARD"),vn.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD=a.registerSpriteDefine("VERTICALBILLBOARD"),vn.SHADERDEFINE_COLOROVERLIFETIME=a.registerSpriteDefine("COLOROVERLIFETIME"),vn.SHADERDEFINE_RANDOMCOLOROVERLIFETIME=a.registerSpriteDefine("RANDOMCOLOROVERLIFETIME"),vn.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT=a.registerSpriteDefine("VELOCITYOVERLIFETIMECONSTANT"),vn.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE=a.registerSpriteDefine("VELOCITYOVERLIFETIMECURVE"),vn.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT=a.registerSpriteDefine("VELOCITYOVERLIFETIMERANDOMCONSTANT"),vn.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE=a.registerSpriteDefine("VELOCITYOVERLIFETIMERANDOMCURVE"),vn.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE=a.registerSpriteDefine("TEXTURESHEETANIMATIONCURVE"),vn.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE=a.registerSpriteDefine("TEXTURESHEETANIMATIONRANDOMCURVE"),vn.SHADERDEFINE_ROTATIONOVERLIFETIME=a.registerSpriteDefine("ROTATIONOVERLIFETIME"),vn.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE=a.registerSpriteDefine("ROTATIONOVERLIFETIMESEPERATE"),vn.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT=a.registerSpriteDefine("ROTATIONOVERLIFETIMECONSTANT"),vn.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE=a.registerSpriteDefine("ROTATIONOVERLIFETIMECURVE"),vn.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS=a.registerSpriteDefine("ROTATIONOVERLIFETIMERANDOMCONSTANTS"),vn.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES=a.registerSpriteDefine("ROTATIONOVERLIFETIMERANDOMCURVES"),vn.SHADERDEFINE_SIZEOVERLIFETIMECURVE=a.registerSpriteDefine("SIZEOVERLIFETIMECURVE"),vn.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE=a.registerSpriteDefine("SIZEOVERLIFETIMECURVESEPERATE"),vn.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES=a.registerSpriteDefine("SIZEOVERLIFETIMERANDOMCURVES"),vn.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE=a.registerSpriteDefine("SIZEOVERLIFETIMERANDOMCURVESSEPERATE"),vn.SHADERDEFINE_RENDERMODE_MESH=a.registerSpriteDefine("RENDERMODE_MESH"),vn.SHADERDEFINE_SHAPE=a.registerSpriteDefine("SHAPE"),i={a_Position:0,a_Texcoord0:2,a_Time:33},n={u_Texture:[1,1],u_Albedo:[2,1],u_Color:[3,1],u_CurrentTime:[2,2],u_Duration:[3,2],u_MvpMatrix:[1,2]};var d=Fi.nameKey.add("GLITTER");t="attribute vec4 a_Position;\nattribute vec2 a_Texcoord0;\nattribute float a_Time;\n\nuniform mat4 u_MvpMatrix;\nuniform  float u_CurrentTime;\nuniform  vec4 u_Color;\nuniform float u_Duration;\n\nvarying vec2 v_Texcoord;\nvarying vec4 v_Color;\n\n\nvoid main()\n{\n  gl_Position = u_MvpMatrix * a_Position;\n  \n  float age = u_CurrentTime-a_Time;\n  float normalizedAge = clamp(age / u_Duration,0.0,1.0);\n   \n  v_Texcoord=a_Texcoord0;\n  \n  v_Color=u_Color;\n  v_Color.a*=1.0-normalizedAge;\n}\n",e="#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nuniform vec4 u_Albedo;\nuniform sampler2D u_Texture;\n\nvarying vec2 v_Texcoord;\nvarying vec4 v_Color;\n\n\nvoid main()\n{\t\n  gl_FragColor=texture2D(u_Texture, v_Texcoord)*v_Color;\n  gl_FragColor=gl_FragColor*u_Albedo;\n}\n\n",a=ui.add(d,t,e,i,n),i={a_Position:0},n={u_Intensity:[1,1],u_AlphaBlending:[2,1],u_CubeTexture:[3,1],u_MvpMatrix:[4,3]};var f=Fi.nameKey.add("SkyBox");t="attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\nvarying vec3 v_Texcoord;\n\n\nvoid main()\n{\n  gl_Position = (u_MvpMatrix*a_Position).xyww;\n  v_Texcoord=a_Position.xyz;\n}\n",e="#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform float u_Intensity;\nuniform float u_AlphaBlending;\nuniform samplerCube u_CubeTexture;\n\nvarying vec3 v_Texcoord;\n\n\nvoid main()\n{\t\n  gl_FragColor=vec4(textureCube(u_CubeTexture, v_Texcoord).rgb*u_Intensity,u_AlphaBlending);\n}\n\n",ui.add(f,t,e,i,n),i={a_Position:0,a_Texcoord0:2},n={u_Intensity:[1,1],u_AlphaBlending:[2,1],u_texture:[3,1],u_MvpMatrix:[4,3]};var p=Fi.nameKey.add("SkyDome");t="attribute vec4 a_Position;\nattribute vec2 a_Texcoord0;\nuniform mat4 u_MvpMatrix;\nvarying vec2 v_Texcoord;\n\n\nvoid main()\n{\n  gl_Position = (u_MvpMatrix*a_Position).xyww;\n  v_Texcoord = a_Texcoord0;\n}\n",e="#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform float u_Intensity;\nuniform float u_AlphaBlending;\nuniform sampler2D u_texture;\n\nvarying vec2 v_Texcoord;\n\n\nvoid main()\n{\t\n  gl_FragColor=vec4(texture2D(u_texture, v_Texcoord).rgb*u_Intensity,u_AlphaBlending);\n}\n\n",ui.add(p,t,e,i,n),i={a_Position:0,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15},n={u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_SplatAlphaTexture:[0,1],u_NormalTexture:[1,1],u_DiffuseTexture1:[2,1],u_DiffuseTexture2:[3,1],u_DiffuseTexture3:[4,1],u_DiffuseTexture4:[5,1],u_DiffuseScale1:[6,1],u_DiffuseScale2:[7,1],u_DiffuseScale3:[8,1],u_DiffuseScale4:[9,1],u_MaterialDiffuse:[11,1],u_MaterialAmbient:[10,1],u_MaterialSpecular:[12,1],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var m=Fi.nameKey.add("Terrain");t="attribute vec4 a_Position;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(LIGHTMAP)\n\tattribute vec3 a_Normal;\n\tvarying vec3 v_Normal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n\tuniform mat4 u_WorldMat;\n\tvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef LIGHTMAP\n\tuniform vec4 u_LightmapScaleOffset;\n\tvarying vec2 v_LightMapUV;\n#endif\n\nattribute vec2 a_Texcoord0;\nattribute vec2 a_Texcoord1;\nvarying vec2 v_Texcoord0;\nvarying vec2 v_Texcoord1;\nuniform mat4 u_MvpMatrix;\n\nvoid main()\n{\n\tgl_Position = u_MvpMatrix * a_Position;\n\tv_Texcoord0=a_Texcoord0;\n\tv_Texcoord1=a_Texcoord1;\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tv_Normal=a_Normal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n#endif\n\n#ifdef LIGHTMAP\n\t//这个地方使用a_Normal 并不是真的代表normal，其实凑巧法线图的uv正好是符合 light_Map的UV\n\tv_LightMapUV=vec2(a_Normal.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,(a_Normal.y-1.0)*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1\n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n\n}",e='#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tuniform vec3 u_MaterialDiffuse;\n\tuniform vec4 u_MaterialSpecular;\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_Normal;\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(LIGHTMAP)\n\tuniform vec3 u_MaterialAmbient;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\n\n#ifdef DIRECTIONLIGHT\n\tuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n\tuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n\tuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\nuniform sampler2D u_SplatAlphaTexture;\nuniform sampler2D u_NormalTexture;\nuniform sampler2D u_DiffuseTexture1;\nuniform sampler2D u_DiffuseTexture2;\nuniform sampler2D u_DiffuseTexture3;\nuniform sampler2D u_DiffuseTexture4;\nuniform vec2 u_DiffuseScale1;\nuniform vec2 u_DiffuseScale2;\nuniform vec2 u_DiffuseScale3;\nuniform vec2 u_DiffuseScale4;\nvarying vec2 v_Texcoord0;\nvarying vec2 v_Texcoord1;\n\n#ifdef LIGHTMAP\n\tuniform sampler2D u_LightMap;\n\tvarying vec2 v_LightMapUV;\n#endif\n\nvoid main()\n{\n#ifdef DETAIL_NUM1\n\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord1/u_DiffuseScale1);\n\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\tgl_FragColor.xyz = color1.xyz;\n#endif\n#ifdef DETAIL_NUM2\n\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord1/u_DiffuseScale1);\n\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord1/u_DiffuseScale2);\n\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\tgl_FragColor.xyz = color1.xyz * (1.0-splatAlpha.r) + color2.xyz * splatAlpha.r;\n#endif\n#ifdef DETAIL_NUM3\n\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord1/u_DiffuseScale1);\n\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord1/u_DiffuseScale2);\n\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord1/u_DiffuseScale3);\n\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\tgl_FragColor.xyz = color1.xyz * (1.0-(splatAlpha.r+splatAlpha.g)) + color2.xyz * splatAlpha.r + color3.xyz * splatAlpha.g;\n#endif\n#ifdef DETAIL_NUM4\n\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord1/u_DiffuseScale1);\n\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord1/u_DiffuseScale2);\n\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord1/u_DiffuseScale3);\n\tvec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord1/u_DiffuseScale4);\n\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\tgl_FragColor.xyz = color1.xyz * (1.0-(splatAlpha.r+splatAlpha.g+splatAlpha.b))+ color2.xyz * splatAlpha.r + color3.xyz * splatAlpha.g + color4.xyz * splatAlpha.b;\n#endif\n\tgl_FragColor.w = splatAlpha.a;\n\t\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n    vec3 normal = texture2D(u_NormalTexture,v_Normal.xy).xyz;\n\tnormal = normal*2.0 - vec3(1.0);\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb);\n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb);\n\t\t#endif\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular * shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular, gl_FragColor.a);\n\t#endif\n#endif\n\n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\n';var g=ui.add(m,t,e,i,n);Xi.SHADERDEFINE_DETAIL_NUM1=g.registerMaterialDefine("DETAIL_NUM1"),Xi.SHADERDEFINE_DETAIL_NUM2=g.registerMaterialDefine("DETAIL_NUM2"),Xi.SHADERDEFINE_DETAIL_NUM4=g.registerMaterialDefine("DETAIL_NUM4"),Xi.SHADERDEFINE_DETAIL_NUM3=g.registerMaterialDefine("DETAIL_NUM3"),i={a_Position:0,a_Normal:3,a_Texcoord0:2},n={u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_CameraPos:[0,3],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_SplatAlphaTexture:[0,1],u_DiffuseTexture1:[1,1],u_DiffuseTexture2:[2,1],u_DiffuseTexture3:[3,1],u_DiffuseTexture4:[4,1],u_DiffuseTexture5:[5,1],u_DiffuseScaleOffset1:[6,1],u_DiffuseScaleOffset2:[7,1],u_DiffuseScaleOffset3:[8,1],u_DiffuseScaleOffset4:[9,1],u_DiffuseScaleOffset5:[10,1],u_MaterialAlbedo:[14,1],u_MaterialDiffuse:[12,1],u_MaterialAmbient:[11,1],u_MaterialSpecular:[13,1],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var v=Fi.nameKey.add("ExtendTerrain");t="attribute vec4 a_Position;\nattribute vec2 a_Texcoord0;\n\nuniform mat4 u_MvpMatrix;\n\nvarying vec2 v_Texcoord0;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(LIGHTMAP)\n\tattribute vec3 a_Normal;\n\tvarying vec3 v_Normal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n\tuniform mat4 u_WorldMat;\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef LIGHTMAP\n\tvarying vec2 v_LightMapUV;\n\tuniform vec4 u_LightmapScaleOffset;\n#endif\n\n#ifdef RECEIVESHADOW\n\tvarying float v_posViewZ;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n#endif\n\nvoid main()\n{\n\tgl_Position = u_MvpMatrix * a_Position;\n  \n\tv_Texcoord0 = a_Texcoord0;\n  \n\t#ifdef LIGHTMAP\n\t\tv_LightMapUV = vec2(a_Texcoord0.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,(a_Texcoord0.y-1.0)*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t#endif\n  \n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tv_Normal = a_Normal;\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n}",e='#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\n\tuniform vec3 u_MaterialDiffuse;\n\tuniform vec4 u_MaterialSpecular;\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_Normal;\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\n\n#ifdef DIRECTIONLIGHT\n\tuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n\tuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n\tuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\nuniform sampler2D u_SplatAlphaTexture;\n\nuniform sampler2D u_DiffuseTexture1;\nuniform sampler2D u_DiffuseTexture2;\nuniform sampler2D u_DiffuseTexture3;\nuniform sampler2D u_DiffuseTexture4;\nuniform sampler2D u_DiffuseTexture5;\n\nuniform vec4 u_DiffuseScaleOffset1;\nuniform vec4 u_DiffuseScaleOffset2;\nuniform vec4 u_DiffuseScaleOffset3;\nuniform vec4 u_DiffuseScaleOffset4;\nuniform vec4 u_DiffuseScaleOffset5;\n\nvarying vec2 v_Texcoord0;\n\nuniform vec3 u_MaterialAmbient;\nuniform vec4 u_MaterialAlbedo;\n\n#ifdef LIGHTMAP\n\tuniform sampler2D u_LightMap;\n\tvarying vec2 v_LightMapUV;\n#endif\n\nvoid main()\n{\n\t#ifdef ExtendTerrain_DETAIL_NUM1\n\t\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r;\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM2\n\t\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r + color2.xyz * (1.0 - splatAlpha.r);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM3\n\t\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * (1.0 - splatAlpha.r - splatAlpha.g);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM4\n\t\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tvec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord0 * u_DiffuseScaleOffset4.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * splatAlpha.b + color4.xyz * (1.0 - splatAlpha.r - splatAlpha.g - splatAlpha.b);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM5\n\t\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tvec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord0 * u_DiffuseScaleOffset4.xy);\n\t\tvec4 color5 = texture2D(u_DiffuseTexture5, v_Texcoord0 * u_DiffuseScaleOffset5.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * splatAlpha.b + color4.xyz * splatAlpha.a + color5.xyz * (1.0 - splatAlpha.r - splatAlpha.g - splatAlpha.b - splatAlpha.a);\n\t#endif\n\t\tgl_FragColor.w = splatAlpha.a;\n\t\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n    vec3 normal = v_Normal;\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb);\n\t#else\n\t\t#if defined(RECEIVESHADOW)\t\t\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t\t//vec3 tColor= u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue + mix(vec3(0.15,0.15,0.15),vec3(0.0),shadowValue);\n\t\t\t//gl_FragColor.rgb*=tColor;\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb);\n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_MaterialAlbedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor = vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular * shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular, gl_FragColor.a);\n\t#endif\n#endif\n\n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\n\n\n\n\n';var y=ui.add(v,t,e,i,n);y.addSpriteDefines(_n.shaderDefines),y.addSpriteDefines(Ui.shaderDefines),i={a_Position:0,a_OffsetVector:41,a_Texcoord0X:38,a_Texcoord0Y:40,a_BirthTime:33},n={u_MvpMatrix:[1,2],u_VMatrix:[1,3],u_PMatrix:[2,3],u_TilingOffset:[3,1],u_MainTexture:[1,1],u_MainColor:[2,1],u_CurTime:[3,2],u_LifeTime:[4,2],u_WidthCurve:[5,2],u_WidthCurveKeyLength:[6,2],u_GradientColorkey:[7,2],u_GradientAlphakey:[8,2]};var x=Fi.nameKey.add("Trail");t="attribute vec3 a_Position;\nattribute vec3 a_OffsetVector;\nattribute vec4 a_Color;\nattribute float a_Texcoord0X;\nattribute float a_Texcoord0Y;\nattribute float a_BirthTime;\n\nuniform mat4 u_VMatrix;\nuniform mat4 u_PMatrix;\n\nuniform vec4 u_TilingOffset;\n\nuniform float u_CurTime;\nuniform float u_LifeTime;\nuniform vec4 u_WidthCurve[10];\nuniform int u_WidthCurveKeyLength;\n\nuniform vec4 u_GradientColorkey[10];\nuniform vec2 u_GradientAlphakey[10];\n\nvarying vec2 v_Texcoord0;\nvarying vec4 v_Color;\n\nfloat hermiteInterpolate(float t, float outTangent, float inTangent, float duration, float value1, float value2)\n{\n\tfloat t2 = t * t;\n\tfloat t3 = t2 * t;\n\tfloat a = 2.0 * t3 - 3.0 * t2 + 1.0;\n\tfloat b = t3 - 2.0 * t2 + t;\n\tfloat c = t3 - t2;\n\tfloat d = -2.0 * t3 + 3.0 * t2;\n\treturn a * value1 + b * outTangent * duration + c * inTangent * duration + d * value2;\n}\n\nfloat getCurWidth(in float normalizeTime)\n{\n\tif(normalizeTime == 0.0){\n\t\treturn u_WidthCurve[0].w;\n\t}\n\telse if(normalizeTime >= 1.0){\n\t\treturn u_WidthCurve[u_WidthCurveKeyLength - 1].w;\n\t}\n\telse{\n\t\tfor(int i = 0; i < 10; i ++ )\n\t\t{\n\t\t\tif(normalizeTime == u_WidthCurve[i].x)\n\t\t\t{\n\t\t\t\treturn u_WidthCurve[i].w;\n\t\t\t}\n\t\t\t\n\t\t\tvec4 lastFrame = u_WidthCurve[i];\n\t\t\tvec4 nextFrame = u_WidthCurve[i + 1];\n\t\t\tif(normalizeTime > lastFrame.x && normalizeTime < nextFrame.x)\n\t\t\t{\n\t\t\t\tfloat duration = nextFrame.x - lastFrame.x;\n\t\t\t\tfloat t = (normalizeTime - lastFrame.x) / duration;\n\t\t\t\tfloat outTangent = lastFrame.z;\n\t\t\t\tfloat inTangent = nextFrame.y;\n\t\t\t\tfloat value1 = lastFrame.w;\n\t\t\t\tfloat value2 = nextFrame.w;\n\t\t\t\treturn hermiteInterpolate(t, outTangent, inTangent, duration, value1, value2);\n\t\t\t}\n\t\t}\t\n\t}\n}\t\n\nvec4 getColorFromGradientByBlend(in vec4 gradientColors[10], in vec2 gradientAlphas[10], in float normalizeTime)\n{\n\tvec4 color;\n\tfor(int i = 1; i < 10; i++)\n\t{\n\t\tvec4 gradientColor = gradientColors[i];\n\t\tfloat colorKey = gradientColor.w;\n\t\tif(colorKey >= normalizeTime)\n\t\t{\n\t\t\tvec4 lastGradientColor = gradientColors[i-1];\n\t\t\tfloat lastColorKey = lastGradientColor.w;\n\t\t\tfloat age = (normalizeTime - lastColorKey) / (colorKey - lastColorKey);\n\t\t\tcolor.rgb = mix(gradientColors[i-1].xyz, gradientColor.xyz, age);\n\t\t\tbreak;\n\t\t}\n\t}\n\tfor(int i = 1; i < 10; i++)\n\t{\n\t\tvec2 gradientAlpha = gradientAlphas[i];\n\t\tfloat alphaKey = gradientAlpha.y;\n\t\tif(alphaKey >= normalizeTime)\n\t\t{\n\t\t\tvec2 lastGradientAlpha = gradientAlphas[i-1];\n\t\t\tfloat lastAlphaKey = lastGradientAlpha.y;\n\t\t\tfloat age = (normalizeTime - lastAlphaKey) / (alphaKey - lastAlphaKey);\n\t\t\tcolor.a = mix(lastGradientAlpha.x, gradientAlpha.x, age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn color;\n}\n\nvec4 getColorFromGradientByFixed(in vec4 gradientColors[10], in vec2 gradientAlphas[10], in float normalizeTime)\n{\n\tvec4 color;\n\tfor(int i = 1; i < 10; i++)\n\t{\n\t\tvec4 gradientColor = gradientColors[i];\n\t\tif(gradientColor.w >= normalizeTime)\n\t\t{\n\t\t\tcolor.rgb = gradientColor.xyz;\n\t\t\tbreak;\n\t\t}\n\t}\n\tfor(int i = 1; i < 10; i++)\n\t{\n\t\tvec2 gradientAlpha = gradientAlphas[i];\n\t\tif(gradientAlpha.y >= normalizeTime)\n\t\t{\n\t\t\tcolor.a = gradientAlpha.x;\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn color;\n}\n\nvoid main()\n{\n\tfloat normalizeTime = (u_CurTime - a_BirthTime) / u_LifeTime;\n\t\n\tgl_Position = u_PMatrix * u_VMatrix * vec4(a_Position + a_OffsetVector * getCurWidth(normalizeTime),1.0);\n\t\n\tv_Texcoord0 = vec2(a_Texcoord0X, a_Texcoord0Y);\n\t\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0 = (vec2(v_Texcoord0.x, v_Texcoord0.y) * u_TilingOffset.xy) + u_TilingOffset.zw;\n\t#endif\n\t\tv_Texcoord0 = vec2(v_Texcoord0.x, v_Texcoord0.y);\n\t\t\n\tv_Texcoord0 = (vec2(v_Texcoord0.x, v_Texcoord0.y) * u_TilingOffset.xy) + u_TilingOffset.zw;\n\t\n\t#ifdef GRADIENTMODE_BLEND\n\t\tv_Color = getColorFromGradientByBlend(u_GradientColorkey, u_GradientAlphakey, normalizeTime);\n\t#else\n\t\tv_Color = getColorFromGradientByFixed(u_GradientColorkey, u_GradientAlphakey, normalizeTime);\n\t#endif\n}\n\n\n\n",e="#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nuniform sampler2D u_MainTexture;\nuniform vec4 u_MainColor;\n\nvarying vec2 v_Texcoord0;\nvarying vec4 v_Color;\n\nvoid main()\n{\t\n\tvec4 color = 2.0 * u_MainColor * v_Color;\n\t#ifdef DIFFUSETEXTURE\n\t\tvec4 mainTextureColor = texture2D(u_MainTexture, v_Texcoord0);\n\t\tcolor *= mainTextureColor;\n\t#endif\n\tgl_FragColor = color;\n}\n\n";var E=ui.add(x,t,e,i,n);qi.SHADERDEFINE_DIFFUSETEXTURE=E.registerMaterialDefine("DIFFUSETEXTURE"),qi.SHADERDEFINE_TILINGOFFSET=E.registerSpriteDefine("TILINGOFFSET"),xn.SHADERDEFINE_GRADIENTMODE_BLEND=E.registerSpriteDefine("GRADIENTMODE_BLEND")},t}(),ke=function(){function t(){this._data=null,this._data=[]}m(t,"laya.d3.shader.ValusArray");var e=t.prototype;return e.setValue=function(t,e){this._data[t]=e},_(0,e,"data",function(){return this._data}),t}(),He=function(){function g(){this._currentPSSM=-1,this._numberOfPSSM=3,this._maxDistance=200,this._ratioOfDistance=1/this._numberOfPSSM,this._statesDirty=!0,this._lightCulling=null,this._renderTarget=null,this._lightVPMatrix=null,this._lightCameras=null,this._shadowQuenes=null,this._shadowMapTextureSize=1024,this._scene=null,this._PCFType=0,this._shaderValueLightVP=null,this._shaderValueVPs=null,this._spiltDistance=new Array(4),this._globalParallelLightDir=new Oe(0,-1,0),this._boundingSphere=new Array(4),this._boundingBox=new Array(4),this._frustumPos=new Array(16),this._uniformDistance=new Array(4),this._logDistance=new Array(4),this._dimension=new Array(4),this._tempLookAt3=new Oe,this._tempLookAt4=new Pe,this._tempValue=new Pe,this._tempPos=new Oe,this._tempLightUp=new Oe,this._tempMin=new Pe,this._tempMax=new Pe,this._tempMatrix44=new De,this._splitFrustumCulling=new Ee(De.DEFAULT),this._tempScaleMatrix44=new De,this._shadowPCFOffset=new Le(1/1024,1/1024),this._shaderValueDistance=new Pe;var t=0;for(t=0;t<this._spiltDistance.length;t++)this._spiltDistance[t]=0;for(t=0;t<this._dimension.length;t++)this._dimension[t]=new Le;for(t=0;t<this._frustumPos.length;t++)this._frustumPos[t]=new Oe;for(t=0;t<this._boundingBox.length;t++)this._boundingBox[t]=new xe(new Oe,new Oe);for(t=0;t<this._boundingSphere.length;t++)this._boundingSphere[t]=new Te(new Oe,0);De.createScaling(new Oe(.5,.5,1),this._tempScaleMatrix44),this._tempScaleMatrix44.elements[12]=.5,this._tempScaleMatrix44.elements[13]=.5}m(g,"laya.d3.shadowMap.ParallelSplitShadowMap");var t=g.prototype;return t.setInfo=function(t,e,i,n,r,a){3<r&&(this._numberOfPSSM=3),this._scene=t,this._maxDistance=e,this.PSSMNum=r,this._globalParallelLightDir=i,this._ratioOfDistance=1/this._numberOfPSSM;for(var s=0;s<this._spiltDistance.length;s++)this._spiltDistance[s]=0;this._shadowMapTextureSize=n,this._shadowPCFOffset.x=1/this._shadowMapTextureSize,this._shadowPCFOffset.y=1/this._shadowMapTextureSize,this.setPCFType(a),this._statesDirty=!0},t.setPCFType=function(t){switch(this._PCFType=t,this._PCFType){case 0:this._scene.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF_NO),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF1),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF2),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF3);break;case 1:this._scene.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF1),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF_NO),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF2),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF3);break;case 2:this._scene.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF2),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF_NO),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF1),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF3);break;case 3:this._scene.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF3),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF_NO),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF1),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF2)}},t.getPCFType=function(){return this._PCFType},t.setFarDistance=function(t){this._maxDistance!=t&&(this._maxDistance=t,this._statesDirty=!0)},t.getFarDistance=function(){return this._maxDistance},t._setGlobalParallelLightDir=function(t){this._globalParallelLightDir=t},t.getGlobalParallelLightDir=function(){return this._globalParallelLightDir},t.getCurrentPSSM=function(){return this._currentPSSM},t.getLightCamera=function(t){return this._lightCameras[t]},t._beginSampler=function(t,e){if(t<0||t>this._numberOfPSSM)throw new Error("ParallelSplitShadowMap: beginSample invalid index");this._currentPSSM=t,this._update(e)},t.endSampler=function(t){this._currentPSSM=-1},t._calcAllLightCameraInfo=function(t){if(1===this._numberOfPSSM)this._beginSampler(0,t),this.endSampler(t);else for(var e=0,i=this._numberOfPSSM+1;e<i;e++)this._beginSampler(e,t),this.endSampler(t)},t._recalculate=function(t,e,i){this._calcSplitDistance(t),this._calcBoundingBox(e,i),this._rebuildRenderInfo()},t._update=function(t){var e=t.nearPlane,i=t.fieldOfView,n=t.aspectRatio;(this._statesDirty||this.lastNearPlane!==e||this.lastFieldOfView!==i||this.lastAspectRatio!==n)&&(this._recalculate(e,i,n),this._uploadShaderValue(),this._statesDirty=!1,this.lastNearPlane=e,this.lastFieldOfView=i,this.lastAspectRatio=n),this._calcLightViewProject(t)},t._uploadShaderValue=function(){var t=this._scene;switch(this._numberOfPSSM){case 1:t.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM1),t.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM2),t.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM3);break;case 2:t.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM2),t.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM1),t.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM3);break;case 3:t.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM3),t.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM1),t.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM2)}var e=t._shaderValues;switch(e.setValue(15,this._shaderValueDistance.elements),e.setValue(16,this._shaderValueLightVP),e.setValue(17,this._shadowPCFOffset.elements),this._numberOfPSSM){case 3:e.setValue(18,this.getRenderTarget(1)),e.setValue(19,this.getRenderTarget(2)),e.setValue(20,this.getRenderTarget(3));break;case 2:e.setValue(18,this.getRenderTarget(1)),e.setValue(19,this.getRenderTarget(2));break;case 1:e.setValue(18,this.getRenderTarget(1))}},t._calcSplitDistance=function(t){var e=this._maxDistance,i=1/this._numberOfPSSM,n=0;for(n=0;n<=this._numberOfPSSM;n++)this._uniformDistance[n]=t+(e-t)*n*i;var r=e/t;for(n=0;n<=this._numberOfPSSM;n++){var a=Math.pow(r,n*i);this._logDistance[n]=t*a}for(n=0;n<=this._numberOfPSSM;n++)this._spiltDistance[n]=this._uniformDistance[n]*this._ratioOfDistance+this._logDistance[n]*(1-this._ratioOfDistance);this._shaderValueDistance.x=this._spiltDistance[1],this._shaderValueDistance.y=this._spiltDistance[2],this._shaderValueDistance.z=this._spiltDistance[3],this._shaderValueDistance.w=this._spiltDistance[4]},t._calcBoundingBox=function(t,e){var i,n,r,a,s=3.1415926*t/180,o=Math.tan(s/2),l=NaN,h=NaN,u=NaN,c=0;for(c=0;c<=this._numberOfPSSM;c++){h=(l=(u=this._spiltDistance[c])*o)*e;var _=this._frustumPos[4*c+0].elements;_[0]=-h,_[1]=-l,_[2]=-u,(_=this._frustumPos[4*c+1].elements)[0]=h,_[1]=-l,_[2]=-u,(_=this._frustumPos[4*c+2].elements)[0]=-h,_[1]=l,_[2]=-u,(_=this._frustumPos[4*c+3].elements)[0]=h,_[1]=l,_[2]=-u,(_=this._dimension[c].elements)[0]=h,_[1]=l}for(c=1;c<=this._numberOfPSSM;c++)i=this._dimension[c].elements,(n=this._boundingBox[c].min.elements)[0]=-i[0],n[1]=-i[1],n[2]=-this._spiltDistance[c],(r=this._boundingBox[c].max.elements)[0]=i[0],r[1]=i[1],r[2]=-this._spiltDistance[c-1],(a=this._boundingSphere[c].center.elements)[0]=.5*(n[0]+r[0]),a[1]=.5*(n[1]+r[1]),a[2]=.5*(n[2]+r[2]),this._boundingSphere[c].radius=.5*Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2)+Math.pow(r[2]-n[2],2));n=this._boundingBox[0].min.elements,i=this._dimension[this._numberOfPSSM].elements,n[0]=-i[0],n[1]=-i[1],n[2]=-this._spiltDistance[this._numberOfPSSM],(r=this._boundingBox[0].max.elements)[0]=i[0],r[1]=i[1],r[2]=-this._spiltDistance[0],(a=this._boundingSphere[0].center.elements)[0]=.5*(n[0]+r[0]),a[1]=.5*(n[1]+r[1]),a[2]=.5*(n[2]+r[2]),this._boundingSphere[0].radius=.5*Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2)+Math.pow(r[2]-n[2],2))},t.calcSplitFrustum=function(t){0<this._currentPSSM?De.createPerspective(3.1416*t.fieldOfView/180,t.aspectRatio,this._spiltDistance[this._currentPSSM-1],this._spiltDistance[this._currentPSSM],this._tempMatrix44):De.createPerspective(3.1416*t.fieldOfView/180,t.aspectRatio,this._spiltDistance[0],this._spiltDistance[this._numberOfPSSM],this._tempMatrix44),De.multiply(this._tempMatrix44,t.viewMatrix,this._tempMatrix44),this._splitFrustumCulling.matrix=this._tempMatrix44},t._rebuildRenderInfo=function(){var t=this._numberOfPSSM+1,e=0;if(null==this._renderTarget)for(this._renderTarget=w(t),this._renderTarget[0]=null,e=1;e<t;e++)this._renderTarget[e]=new an(this._shadowMapTextureSize,this._shadowMapTextureSize,6408,5121,33189,!1,!1,9728,9728);else if(this._renderTarget.length!=t)for(this.disposeAllRenderTarget(),this._renderTarget.length=t,this._renderTarget[0]=null,e=1;e<t;e++)this._renderTarget[e]=new an(this._shadowMapTextureSize,this._shadowMapTextureSize,6408,5121,33189,!1,!1,9728,9728);else for(e=1;e<t;e++)null!=this._renderTarget[e]&&this._renderTarget[e].width==this._shadowMapTextureSize&&this._renderTarget[e].height==this._shadowMapTextureSize||(null!=this._renderTarget[e]&&this._renderTarget[e].destroy(),this._renderTarget[e]=new an(this._shadowMapTextureSize,this._shadowMapTextureSize,6408,5121,33189,!1,!1,9728,9728));if(null==this._lightCulling||this._lightCulling.length!=t)for(this._lightCulling?this._lightCulling.length=t:this._lightCulling=w(t),e=0;e<this._lightCulling.length;e++)this._lightCulling[e]=new Ee(De.DEFAULT);if(null==this._lightVPMatrix||this._lightVPMatrix.length!=t)for(this._lightVPMatrix?this._lightVPMatrix.length=t:this._lightVPMatrix=w(t),e=0;e<this._lightVPMatrix.length;e++)this._lightVPMatrix[e]=new De;if(null==this._lightCameras||this._lightCameras.length!=t)for(this._lightCameras?this._lightCameras.length=t:this._lightCameras=w(t),e=0;e<this._lightCameras.length;e++)this._lightCameras[e]=new pn,this._lightCameras[e].name="lightCamera"+e;if(null==this._shadowQuenes||this._shadowQuenes.length!=this._numberOfPSSM)for(this._shadowQuenes?this._shadowQuenes.length=this._numberOfPSSM:this._shadowQuenes=w(this._numberOfPSSM),e=0;e<this._shadowQuenes.length;e++)this._shadowQuenes[e]=new J(this._scene);if(null==this._shaderValueVPs||this._shaderValueVPs.length!=t)for(this._shaderValueVPs?this._shaderValueVPs.length=t:this._shaderValueVPs=w(t),this._shaderValueLightVP=new Float32Array(16*t),e=0;e<t;e++)this._shaderValueVPs[e]=new Float32Array(this._shaderValueLightVP.buffer,64*e)},t._calcLightViewProject=function(t){var e=this._boundingSphere[this._currentPSSM],i=t.transform.worldMatrix;e.radius;e.center.cloneTo(this._tempLookAt3),Oe.transformV3ToV4(this._tempLookAt3,i,this._tempLookAt4);var n=this._tempLookAt3.elements,r=this._tempLookAt4.elements;n[0]=r[0],n[1]=r[1],n[2]=r[2];var a=this._tempLightUp.elements,s=t.forward.elements;a[0]=s[0],a[1]=1,a[2]=s[2],Oe.normalize(this._tempLightUp,this._tempLightUp),Oe.scale(this._globalParallelLightDir,4*e.radius,this._tempPos),Oe.subtract(this._tempLookAt3,this._tempPos,this._tempPos);var o=this._lightCameras[this._currentPSSM];o.transform.position=this._tempPos,o.transform.lookAt(this._tempLookAt3,this._tempLightUp,!1);var l=this._tempMax.elements,h=this._tempMin.elements;l[0]=l[1]=l[2]=-1e5,l[3]=1,h[0]=h[1]=h[2]=1e5,h[3]=1,De.multiply(o.viewMatrix,i,this._tempMatrix44);var u=this._tempValue.elements,c=[];c.length=8,this._boundingBox[this._currentPSSM].getCorners(c);for(var _=0;_<8;_++){var d=c[_].elements;u[0]=d[0],u[1]=d[1],u[2]=d[2],u[3]=1,Pe.transformByM4x4(this._tempValue,this._tempMatrix44,this._tempValue),h[0]=u[0]<h[0]?u[0]:h[0],h[1]=u[1]<h[1]?u[1]:h[1],h[2]=u[2]<h[2]?u[2]:h[2],l[0]=u[0]>l[0]?u[0]:l[0],l[1]=u[1]>l[1]?u[1]:l[1],l[2]=u[2]>l[2]?u[2]:l[2]}Pe.add(this._tempMax,this._tempMin,this._tempValue),u[0]*=.5,u[1]*=.5,u[2]*=.5,u[3]=1,Pe.transformByM4x4(this._tempValue,o.transform.worldMatrix,this._tempValue);var f=Math.abs(-this._tempMax.z),p=f>this._maxDistance?f:this._maxDistance;Oe.scale(this._globalParallelLightDir,p,this._tempPos);var m=this._tempPos.elements;m[0]=u[0]-m[0],m[1]=u[1]-m[1],m[2]=u[2]-m[2],o.transform.position=this._tempPos,o.transform.lookAt(this._tempLookAt3,this._tempLightUp,!1),De.createOrthoOffCenterRH(h[0],l[0],h[1],l[1],1,p+.5*(l[2]-h[2]),o.projectionMatrix),o.projectionViewMatrix.cloneTo(this._lightVPMatrix[this._currentPSSM]),this._lightCulling[this._currentPSSM].matrix=this._lightVPMatrix[this._currentPSSM],g.multiplyMatrixOutFloat32Array(this._tempScaleMatrix44,this._lightVPMatrix[this._currentPSSM],this._shaderValueVPs[this._currentPSSM])},t.getLightFrustumCulling=function(t){return this._lightCulling[t]},t.getSplitFrustumCulling=function(){return this._splitFrustumCulling},t.getSplitDistance=function(t){return this._spiltDistance[t]},t.setShadowMapTextureSize=function(t){t!==this._shadowMapTextureSize&&(this._shadowMapTextureSize=t,this._shadowPCFOffset.x=1/this._shadowMapTextureSize,this._shadowPCFOffset.y=1/this._shadowMapTextureSize,this._statesDirty=!0)},t.getShadowMapTextureSize=function(){return this._shadowMapTextureSize},t.beginRenderTarget=function(t){this._renderTarget[t].start()},t.endRenderTarget=function(t){this._renderTarget[t].end()},t.getRenderTarget=function(t){return this._renderTarget[t]},t.disposeAllRenderTarget=function(){for(var t=0,e=this._numberOfPSSM+1;t<e;t++)this._renderTarget[t]&&(this._renderTarget[t].destroy(),this._renderTarget[t]=null)},_(0,t,"PSSMNum",function(){return this._numberOfPSSM},function(t){t=(t=0<t?t:1)<=3?t:3,this._numberOfPSSM!=t&&(this._numberOfPSSM=t,this._ratioOfDistance=1/this._numberOfPSSM,this._statesDirty=!0)}),g.multiplyMatrixOutFloat32Array=function(t,e,i){var n,r,a,s,o,l,h;for(r=t.elements,a=e.elements,n=0;n<4;n++)s=r[n],o=r[n+4],l=r[n+8],h=r[n+12],i[n]=s*a[0]+o*a[1]+l*a[2]+h*a[3],i[n+4]=s*a[4]+o*a[5]+l*a[6]+h*a[7],i[n+8]=s*a[8]+o*a[9]+l*a[10]+h*a[11],i[n+12]=s*a[12]+o*a[13]+l*a[14]+h*a[15]},g.SHADERDEFINE_RECEIVE_SHADOW=1,g.SHADERDEFINE_CAST_SHADOW=512,g.SHADERDEFINE_SHADOW_PSSM1=1024,g.SHADERDEFINE_SHADOW_PSSM2=2048,g.SHADERDEFINE_SHADOW_PSSM3=4096,g.SHADERDEFINE_SHADOW_PCF_NO=8192,g.SHADERDEFINE_SHADOW_PCF1=16384,g.SHADERDEFINE_SHADOW_PCF2=32768,g.SHADERDEFINE_SHADOW_PCF3=65536,g.MAX_PSSM_COUNT=3,g}(),ze=function(){function T(){this._boundingSphere=null,this._boundingBox=null,this._sizeOfY=null,this._currentLODLevel=0,this._lastDistanceToEye=NaN,this._originalBoundingSphere=null,this._originalBoundingBox=null,this._originalBoundingBoxCorners=null,this._bUseStrip=!1,this._gridSize=NaN,this._beginGridX=0,this._beginGridZ=0,this._LODError=null,T.__init__(),this._currentLODLevel=0}m(T,"laya.d3.terrain.TerrainLeaf");var t=T.prototype;return t.calcVertextNorml=function(t,e,i,n,r,a){var s=0,o=0;o=-1*T.getHeightFromTerrainHeightData(t-1,e-1,i,n,r),o+=-1*T.getHeightFromTerrainHeightData(t-1,e,i,n,r),o+=-1*T.getHeightFromTerrainHeightData(t-1,e+1,i,n,r),o+=1*T.getHeightFromTerrainHeightData(t+1,e-1,i,n,r),o+=1*T.getHeightFromTerrainHeightData(t+1,e,i,n,r),o+=1*T.getHeightFromTerrainHeightData(t+1,e+1,i,n,r),s=-1*T.getHeightFromTerrainHeightData(t-1,e-1,i,n,r),s+=-1*T.getHeightFromTerrainHeightData(t,e-1,i,n,r),s+=-1*T.getHeightFromTerrainHeightData(t+1,e-1,i,n,r),s+=1*T.getHeightFromTerrainHeightData(t-1,e+1,i,n,r),s+=1*T.getHeightFromTerrainHeightData(t,e+1,i,n,r),s+=1*T.getHeightFromTerrainHeightData(t+1,e+1,i,n,r),a.x=-o,a.y=6,a.z=-s,Oe.normalize(a,a)},t.calcVertextNormlUV=function(t,e,i,n,r){r.x=t/i,r.y=e/n,r.z=e/n},t.calcVertextBuffer=function(t,e,i,n,r,a,s,o,l,h,u,c){if(1==c&&!T.__ADAPT_MATRIX__){T.__ADAPT_MATRIX__=new De;var _=new De;De.createRotationY(Math.PI,T.__ADAPT_MATRIX__),De.createTranslate(new Oe(0,0,(u-1)*r),_),De.multiply(_,T.__ADAPT_MATRIX__,T.__ADAPT_MATRIX__),T.__ADAPT_MATRIX_INV__=new De,T.__ADAPT_MATRIX__.invert(T.__ADAPT_MATRIX_INV__)}this._gridSize=r,this._beginGridX=t*T.CHUNK_GRID_NUM+i,this._beginGridZ=e*T.CHUNK_GRID_NUM+n;for(var d=s*o,f=2147483647,p=-2147483648,m=new Oe,g=0,v=T.LEAF_GRID_NUM+1;g<v;g++)for(var y=0,x=T.LEAF_GRID_NUM+1;y<x;y++)T.__VECTOR3__.x=(this._beginGridX+y)*this._gridSize,T.__VECTOR3__.z=(this._beginGridZ+g)*this._gridSize,T.__VECTOR3__.y=l[(this._beginGridZ+g)*h+(this._beginGridX+y)],f=T.__VECTOR3__.y<f?T.__VECTOR3__.y:f,p=T.__VECTOR3__.y>p?T.__VECTOR3__.y:p,T.__ADAPT_MATRIX__&&Oe.transformV3ToV3(T.__VECTOR3__,T.__ADAPT_MATRIX__,T.__VECTOR3__),a[d]=T.__VECTOR3__.x,a[++d]=T.__VECTOR3__.y,a[++d]=T.__VECTOR3__.z,d++,this.calcVertextNormlUV(this._beginGridX+y,this._beginGridZ+g,h,u,m),a[d]=m.x,a[++d]=m.y,a[++d]=m.z,a[++d]=(i+y)/T.CHUNK_GRID_NUM,a[++d]=(n+g)/T.CHUNK_GRID_NUM,a[++d]=this._beginGridX+y,a[++d]=this._beginGridZ+g,d++;this._sizeOfY=new Le(f-1,p+1),this.calcLODErrors(l,h,u),this.calcOriginalBoudingBoxAndSphere()},t.calcSkirtVertextBuffer=function(t,e,i,n,r,a,s,o,l,h,u){this._gridSize=r,this._beginGridX=t*T.CHUNK_GRID_NUM+i,this._beginGridZ=e*T.CHUNK_GRID_NUM+n;var c=s*o,_=0,d=0,f=T.LEAF_GRID_NUM+1,p=new Oe,m=0,g=0;for(_=0;_<2;_++)for(d=0;d<f;d++)T.__VECTOR3__.x=(this._beginGridX+d)*this._gridSize,T.__VECTOR3__.y=1==_?l[this._beginGridZ*h+(this._beginGridX+d)]:-this._gridSize,T.__VECTOR3__.z=(this._beginGridZ+0)*this._gridSize,T.__ADAPT_MATRIX__&&Oe.transformV3ToV3(T.__VECTOR3__,T.__ADAPT_MATRIX__,T.__VECTOR3__),a[c]=T.__VECTOR3__.x,a[++c]=T.__VECTOR3__.y,a[++c]=T.__VECTOR3__.z,c++,m=0==_?this._beginGridZ-1:this._beginGridZ,this.calcVertextNormlUV(this._beginGridX+d,m,h,u,p),a[c]=p.x,a[++c]=p.y,a[++c]=p.z,a[++c]=(i+d)/T.CHUNK_GRID_NUM,a[++c]=(n+0)/T.CHUNK_GRID_NUM,a[++c]=this._beginGridX+d,a[++c]=m,c++;for(_=0;_<2;_++)for(d=0;d<f;d++)T.__VECTOR3__.x=(this._beginGridX+d)*this._gridSize,T.__VECTOR3__.y=0==_?l[(this._beginGridZ+T.LEAF_GRID_NUM)*h+(this._beginGridX+d)]:-this._gridSize,T.__VECTOR3__.z=(this._beginGridZ+T.LEAF_GRID_NUM)*this._gridSize,T.__ADAPT_MATRIX__&&Oe.transformV3ToV3(T.__VECTOR3__,T.__ADAPT_MATRIX__,T.__VECTOR3__),a[c]=T.__VECTOR3__.x,a[++c]=T.__VECTOR3__.y,a[++c]=T.__VECTOR3__.z,c++,m=0==_?this._beginGridZ+T.LEAF_GRID_NUM:this._beginGridZ+T.LEAF_GRID_NUM+1,this.calcVertextNormlUV(this._beginGridX+d,m,h,u,p),a[c]=p.x,a[++c]=p.y,a[++c]=p.z,a[++c]=(i+d)/T.CHUNK_GRID_NUM,a[++c]=(n+T.LEAF_GRID_NUM)/T.CHUNK_GRID_NUM,a[++c]=this._beginGridX+d,a[++c]=m,c++;for(_=0;_<2;_++)for(d=0;d<f;d++)T.__VECTOR3__.x=(this._beginGridX+0)*this._gridSize,T.__VECTOR3__.y=0==_?l[(this._beginGridZ+d)*h+(this._beginGridX+0)]:-this._gridSize,T.__VECTOR3__.z=(this._beginGridZ+d)*this._gridSize,T.__ADAPT_MATRIX__&&Oe.transformV3ToV3(T.__VECTOR3__,T.__ADAPT_MATRIX__,T.__VECTOR3__),a[c]=T.__VECTOR3__.x,a[++c]=T.__VECTOR3__.y,a[++c]=T.__VECTOR3__.z,c++,g=0==_?this._beginGridX:this._beginGridX-1,this.calcVertextNormlUV(g,this._beginGridZ+d,h,u,p),a[c]=p.x,a[++c]=p.y,a[++c]=p.z,a[++c]=(i+0)/T.CHUNK_GRID_NUM,a[++c]=(n+d)/T.CHUNK_GRID_NUM,a[++c]=g,a[++c]=this._beginGridZ+d,c++;for(_=0;_<2;_++)for(d=0;d<f;d++)T.__VECTOR3__.x=(this._beginGridX+T.LEAF_GRID_NUM)*this._gridSize,T.__VECTOR3__.y=1==_?l[(this._beginGridZ+d)*h+(this._beginGridX+T.LEAF_GRID_NUM)]:-this._gridSize,T.__VECTOR3__.z=(this._beginGridZ+d)*this._gridSize,T.__ADAPT_MATRIX__&&Oe.transformV3ToV3(T.__VECTOR3__,T.__ADAPT_MATRIX__,T.__VECTOR3__),a[c]=T.__VECTOR3__.x,a[++c]=T.__VECTOR3__.y,a[++c]=T.__VECTOR3__.z,c++,g=0==_?this._beginGridX+T.LEAF_GRID_NUM+1:this._beginGridX+T.LEAF_GRID_NUM,this.calcVertextNormlUV(g,this._beginGridZ+d,h,u,p),a[c]=p.x,a[++c]=p.y,a[++c]=p.z,a[++c]=(i+T.LEAF_GRID_NUM)/T.CHUNK_GRID_NUM,a[++c]=(n+d)/T.CHUNK_GRID_NUM,a[++c]=g,a[++c]=this._beginGridZ+d,c++},t.calcOriginalBoudingBoxAndSphere=function(){var t=new Oe(this._beginGridX*this._gridSize,this._sizeOfY.x,this._beginGridZ*this._gridSize),e=new Oe((this._beginGridX+T.LEAF_GRID_NUM)*this._gridSize,this._sizeOfY.y,(this._beginGridZ+T.LEAF_GRID_NUM)*this._gridSize);T.__ADAPT_MATRIX__&&(Oe.transformV3ToV3(t,T.__ADAPT_MATRIX__,t),Oe.transformV3ToV3(e,T.__ADAPT_MATRIX__,e)),this._originalBoundingBox=new xe(t,e);var i=new Oe;Oe.subtract(e,t,i),Oe.scale(i,.5,i);var n=new Oe;Oe.add(t,i,n),this._originalBoundingSphere=new Te(n,Oe.scalarLength(i)),this._originalBoundingBoxCorners=w(8,null),this._originalBoundingBox.getCorners(this._originalBoundingBoxCorners),this._boundingBox=new xe(new Oe(-.5,-.5,-.5),new Oe(.5,.5,.5)),this._boundingSphere=new Te(new Oe(0,0,0),1)},t.calcLeafBoudingBox=function(t){for(var e=0;e<8;e++)Oe.transformCoordinate(this._originalBoundingBoxCorners[e],t,ei._tempBoundBoxCorners[e]);xe.createfromPoints(ei._tempBoundBoxCorners,this._boundingBox)},t.calcLeafBoudingSphere=function(t,e){Oe.transformCoordinate(this._originalBoundingSphere.center,t,this._boundingSphere.center),this._boundingSphere.radius=this._originalBoundingSphere.radius*e},t.calcLODErrors=function(t,e,i){this._LODError=new Float32Array(T._maxLODLevel+1);for(var n=1,r=0,a=T._maxLODLevel+1;r<a;r++){for(var s=0,o=0,l=T.LEAF_GRID_NUM;o<l;o+=n)for(var h=0,u=T.LEAF_GRID_NUM;h<u;h+=n)for(var c=t[(this._beginGridZ+o)*e+(this._beginGridX+h)],_=t[(this._beginGridZ+o)*e+(this._beginGridX+h)+n],d=t[(this._beginGridZ+o+n)*e+(this._beginGridX+h)],f=t[(this._beginGridZ+o+n)*e+(this._beginGridX+h)+n],p=0;p<n;p++)for(var m=p/n,g=0;g<n;g++){var v=g/n,y=t[(this._beginGridZ+o+p)*e+(this._beginGridX+h)+g],x=v+m<=1?c+(_-c)*v+(d-c)*m:f+(d-f)*(1-v)+(_-f)*(1-m),E=Math.abs(x-y);s=Math.max(s,E)}n*=2,this._LODError[r]=s}},t.determineLod=function(t,e,i,n){var r=Oe.distance(t,this._boundingSphere.center),a=T._maxLODLevel;if(!n){if(this._lastDistanceToEye==r)return this._currentLODLevel;this._lastDistanceToEye>r&&(a=this._currentLODLevel)}for(var s=a;1<=s;s--)if(fn.LOD_DISTANCE_FACTOR*this._LODError[s]/r*e<i){this._currentLODLevel=s;break}return this._lastDistanceToEye=r,this._currentLODLevel},T.__init__=function(){if(!T._bInit){var t=T.CHUNK_GRID_NUM/T.LEAF_GRID_NUM*(T.CHUNK_GRID_NUM/T.LEAF_GRID_NUM);T._planeLODIndex=w(t);var e=0,i=0,n=0,r=0,a=0,s=0,o=null,l=null;for(e=0;e<t;e++)T._planeLODIndex[e]=new Array(T._maxLODLevel+1);for(e=0,r=T._maxLODLevel+1;e<r;e++)T._planeLODIndex[0][e]=T.calcPlaneLODIndex(e);for(e=1;e<t;e++)for(s=e*T.LEAF_PLANE_VERTEXT_COUNT,i=0,a=T._maxLODLevel+1;i<a;i++){for(o=T._planeLODIndex[0][i],l=new Uint16Array(o.length),n=0;n<o.length;n++)l[n]=o[n]+s;T._planeLODIndex[e][i]=l}for(T._skirtLODIndex=w(t),e=0;e<t;e++)T._skirtLODIndex[e]=new Array(T._maxLODLevel+1);for(e=0,r=T._maxLODLevel+1;e<r;e++)T._skirtLODIndex[0][e]=T.calcSkirtLODIndex(e);for(e=1;e<t;e++)for(s=e*T.LEAF_SKIRT_VERTEXT_COUNT,i=0,a=T._maxLODLevel+1;i<a;i++){for(o=T._skirtLODIndex[0][i],l=new Uint16Array(o.length),n=0;n<o.length;n++)l[n]=o[n]+s;T._skirtLODIndex[e][i]=l}T._bInit=!0}},T.getPlaneLODIndex=function(t,e){return T._planeLODIndex[t][e]},T.getSkirtLODIndex=function(t,e){return T._skirtLODIndex[t][e]},T.calcPlaneLODIndex=function(t){T._maxLODLevel<t&&(t=T._maxLODLevel);var e=T.LEAF_GRID_NUM+1,i=0,n=null,r=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/Math.pow(2,t);n=new Uint16Array(r*r*6);for(var a=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/r,s=0;s<T.LEAF_GRID_NUM;s+=a)for(var o=0;o<T.LEAF_GRID_NUM;o+=a)n[i]=(s+a)*e+o,n[++i]=s*e+o,n[++i]=s*e+o+a,n[++i]=s*e+o+a,n[++i]=(s+a)*e+o+a,n[++i]=(s+a)*e+o,i++;return n},T.calcSkirtLODIndex=function(t){T._maxLODLevel<t&&(t=T._maxLODLevel);var e=T.CHUNK_GRID_NUM/T.LEAF_GRID_NUM*(T.CHUNK_GRID_NUM/T.LEAF_GRID_NUM)*T.LEAF_PLANE_VERTEXT_COUNT,i=T.LEAF_GRID_NUM+1,n=0,r=null,a=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/Math.pow(2,t);r=new Uint16Array(4*a*6);for(var s=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/a,o=0;o<4;o++){for(var l=0;l<T.LEAF_GRID_NUM;l+=s)r[n]=e+i+l,r[++n]=e+l,r[++n]=e+l+s,r[++n]=e+l+s,r[++n]=e+i+l+s,r[++n]=e+i+l,n++;e+=2*i}return r},T.getHeightFromTerrainHeightData=function(t,e,i,n,r){return i[(e=r<=(e=e<0?0:e)?r-1:e)*n+(t=n<=(t=t<0?0:t)?n-1:t)]},T.CHUNK_GRID_NUM=64,T.LEAF_GRID_NUM=32,T.__ADAPT_MATRIX__=null,T.__ADAPT_MATRIX_INV__=null,T._planeLODIndex=null,T._skirtLODIndex=null,T._bInit=!1,c(T,["LEAF_PLANE_VERTEXT_COUNT",function(){return this.LEAF_PLANE_VERTEXT_COUNT=(T.LEAF_GRID_NUM+1)*(T.LEAF_GRID_NUM+1)},"LEAF_SKIRT_VERTEXT_COUNT",function(){return this.LEAF_SKIRT_VERTEXT_COUNT=2*(T.LEAF_GRID_NUM+1)*4},"LEAF_VERTEXT_COUNT",function(){return this.LEAF_VERTEXT_COUNT=T.LEAF_PLANE_VERTEXT_COUNT+T.LEAF_SKIRT_VERTEXT_COUNT},"LEAF_PLANE_MAX_INDEX_COUNT",function(){return this.LEAF_PLANE_MAX_INDEX_COUNT=T.LEAF_GRID_NUM*T.LEAF_GRID_NUM*6},"LEAF_SKIRT_MAX_INDEX_COUNT",function(){return this.LEAF_SKIRT_MAX_INDEX_COUNT=4*T.LEAF_GRID_NUM*6},"LEAF_MAX_INDEX_COUNT",function(){return this.LEAF_MAX_INDEX_COUNT=T.LEAF_PLANE_MAX_INDEX_COUNT+T.LEAF_SKIRT_MAX_INDEX_COUNT},"__VECTOR3__",function(){return this.__VECTOR3__=new Oe},"_maxLODLevel",function(){return this._maxLODLevel=Math.log2(T.LEAF_GRID_NUM)}]),T}(),Ge=function(){function t(){this.alphaMap=null,this.detailID=null,this.normalMap=null}return m(t,"laya.d3.terrain.unit.ChunkInfo"),t}(),We=function(){function t(){this.diffuseTexture=null,this.normalTexture=null,this.scale=null,this.offset=null}return m(t,"laya.d3.terrain.unit.DetailTextureInfo"),t}(),Xe=function(){function t(){this.ambientColor=null,this.diffuseColor=null,this.specularColor=null}return m(t,"laya.d3.terrain.unit.MaterialInfo"),t}(),Ye=function(){function _(){}return m(_,"laya.d3.utils.Physics"),_.__init__=function(){_._layerCollsionMatrix.length=31;for(var t=0;t<31;t++){var e=[],i=31-t;e.length=i;for(var n=0;n<i;n++)e[n]=n===i-1;_._layerCollsionMatrix[t]=e}},_.setLayerCollision=function(t,e,i){_._layerCollsionMatrix[t.number][30-e.number]=i},_.getLayerCollision=function(t,e){return _._layerCollsionMatrix[t.number][30-e.number]},_.setColliderCollision=function(t,e,i){i?(delete t._ignoreCollisonMap[e.id],delete e._ignoreCollisonMap[t.id]):(t._ignoreCollisonMap[e.id]=e)._ignoreCollisonMap[t.id]=t},_.getIColliderCollision=function(t,e){return!!t._ignoreCollisonMap[e.id]},_.rayCast=function(t,e,i,n){void 0===i&&(i=179e306),void 0===n&&(n=0),_._outHitAllInfo.length=0;for(var r=F.getLayerByNumber(n)._colliders,a=0,s=r.length;a<s;a++){var o=r[a];if(o.enable&&(o.raycast(t,_._outHitInfo,i),-1!==_._outHitInfo.distance&&_._outHitInfo.distance<=i)){var l=new Ze;_._outHitInfo.cloneTo(l),_._outHitAllInfo.push(l)}}if(0==_._outHitAllInfo.length)return e.sprite3D=null,void(e.distance=-1);for(var h=Number.MAX_VALUE,u=0,c=0;c<_._outHitAllInfo.length;c++)_._outHitAllInfo[c].distance<h&&(h=_._outHitAllInfo[c].distance,u=c);_._outHitAllInfo[u].cloneTo(e)},_.rayCastAll=function(t,e,i,n){void 0===i&&(i=179e306),void 0===n&&(n=0),e.length=0;for(var r=F.getLayerByNumber(n)._colliders,a=0,s=r.length;a<s;a++){var o=r[a];if(o.enable&&(_._outHitInfo.distance=-1,_._outHitInfo.sprite3D=null,o.raycast(t,_._outHitInfo,i),-1!==_._outHitInfo.distance&&_._outHitInfo.distance<=i)){var l=new Ze;_._outHitInfo.cloneTo(l),e.push(l)}}},_._outHitAllInfo=[],_._layerCollsionMatrix=[],c(_,["_outHitInfo",function(){return this._outHitInfo=new Ze},"collisionManager",function(){return this.collisionManager=new ni},"gravity",function(){return this.gravity=new Oe(0,-9.81,0)}]),_}(),je=function(){function j(){}return m(j,"laya.d3.utils.Picker"),j.calculateCursorRay=function(t,e,i,n,r,a){var s=t.elements[0],o=t.elements[1],l=j._tempVector30,h=l.elements;h[0]=s,h[1]=o,h[2]=e.minDepth;var u=j._tempVector31,c=u.elements;c[0]=s,c[1]=o,c[2]=e.maxDepth;var _=a.origin,d=j._tempVector32;e.unprojectFromWVP(l,i,n,r,_),e.unprojectFromWVP(u,i,n,r,d);var f=a.direction.elements;f[0]=d.x-_.x,f[1]=d.y-_.y,f[2]=d.z-_.z,Oe.normalize(a.direction,a.direction)},j.rayIntersectsPositionsAndIndices=function(t,e,i,n,r){for(var a=i.vertexStride/4,s=i.getVertexElementByUsage(0).offset/4,o=Number.MAX_VALUE,l=-1,h=-1,u=-1,c=0;c<n.length;c+=3){var _=j._tempVector35,d=_.elements,f=n[c]*a,p=f+s;d[0]=e[p],d[1]=e[p+1],d[2]=e[p+2];var m=j._tempVector36,g=m.elements,v=n[c+1]*a,y=v+s;g[0]=e[y],g[1]=e[y+1],g[2]=e[y+2];var x=j._tempVector37,E=x.elements,T=n[c+2]*a,S=T+s;E[0]=e[S],E[1]=e[S+1],E[2]=e[S+2];var w=laya.d3.utils.Picker.rayIntersectsTriangle(t,_,m,x);!isNaN(w)&&w<o&&(o=w,l=f,h=v,u=T)}if(o===Number.MAX_VALUE)return r.position.toDefault(),r.distance=Number.MAX_VALUE,r.trianglePositions[0].toDefault(),r.trianglePositions[1].toDefault(),r.trianglePositions[2].toDefault(),r.triangleNormals[0].toDefault(),r.triangleNormals[1].toDefault(),r.triangleNormals[2].toDefault(),!1;r.distance=o,Oe.scale(t.direction,o,r.position),Oe.add(t.origin,r.position,r.position);var M=r.trianglePositions,D=M[0],I=M[1],b=M[2],C=D.elements,A=I.elements,R=b.elements,L=l+s;C[0]=e[L],C[1]=e[L+1],C[2]=e[L+2];var O=h+s;A[0]=e[O],A[1]=e[O+1],A[2]=e[O+2];var P=u+s;R[0]=e[P],R[1]=e[P+1],R[2]=e[P+2];var N=i.getVertexElementByUsage(3);if(N){var V=N.offset/4,F=r.triangleNormals,B=F[0],U=F[1],k=F[2],H=B.elements,z=U.elements,G=k.elements,W=l+V;H[0]=e[W],H[1]=e[W+1],H[2]=e[W+2];var X=h+V;z[0]=e[X],z[1]=e[X+1],z[2]=e[X+2];var Y=u+V;G[0]=e[Y],G[1]=e[Y+1],G[2]=e[Y+2]}return!0},j.rayIntersectsTriangle=function(t,e,i,n){var r=j._tempVector30,a=j._tempVector31;Oe.subtract(i,e,r),Oe.subtract(n,e,a);var s,o=j._tempVector32;if(Oe.cross(t.direction,a,o),(s=Oe.dot(r,o))>-Number.MIN_VALUE&&s<Number.MIN_VALUE)return Number.NaN;var l,h=1/s,u=j._tempVector33;if(Oe.subtract(t.origin,e,u),l=Oe.dot(u,o),(l*=h)<0||1<l)return Number.NaN;var c,_,d=j._tempVector34;return Oe.cross(u,r,d),c=Oe.dot(t.direction,d),(c*=h)<0||1<l+c?Number.NaN:(_=Oe.dot(a,d),(_*=h)<0?Number.NaN:_)},c(j,["_tempVector30",function(){return this._tempVector30=new Oe},"_tempVector31",function(){return this._tempVector31=new Oe},"_tempVector32",function(){return this._tempVector32=new Oe},"_tempVector33",function(){return this._tempVector33=new Oe},"_tempVector34",function(){return this._tempVector34=new Oe},"_tempVector35",function(){return this._tempVector35=new Oe},"_tempVector36",function(){return this._tempVector36=new Oe},"_tempVector37",function(){return this._tempVector37=new Oe}]),j}(),Ze=function(){function t(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new Oe,new Oe,new Oe],this.trianglePositions.length=3,this.triangleNormals=[new Oe,new Oe,new Oe],this.triangleNormals.length=3,this.position=new Oe}return m(t,"laya.d3.utils.RaycastHit"),t.prototype.cloneTo=function(t){t.distance=this.distance,this.trianglePositions[0].cloneTo(t.trianglePositions[0]),this.trianglePositions[1].cloneTo(t.trianglePositions[1]),this.trianglePositions[2].cloneTo(t.trianglePositions[2]),this.triangleNormals[0].cloneTo(t.triangleNormals[0]),this.triangleNormals[1].cloneTo(t.triangleNormals[1]),this.triangleNormals[2].cloneTo(t.triangleNormals[2]),this.position.cloneTo(t.position),t.sprite3D=this.sprite3D},t}(),Ke=function(){function t(t,e){this._width=0,this._height=0,this._width=t,this._height=e}m(t,"laya.d3.utils.Size");var e=t.prototype;return _(0,e,"width",function(){return-1===this._width?$.clientWidth:this._width}),_(0,e,"height",function(){return-1===this._height?$.clientHeight:this._height}),_(1,t,"fullScreen",function(){return new t(-1,-1)}),t}(),qe=function(){function L(){}return m(L,"laya.d3.utils.Utils3D"),L._rotationTransformScaleSkinAnimation=function(t,e,i,n,r,a,s,o,l,h,u,c){var _,d,f,p,m,g=L._tempArray16_0,v=L._tempArray16_1,y=L._tempArray16_2,x=n+n,E=r+r,T=a+a,S=n*x,w=r*x,M=r*E,D=a*x,I=a*E,b=a*T,C=s*x,A=s*E,R=s*T;for(g[15]=1,g[0]=1-M-b,g[1]=w+R,g[2]=D-A,g[4]=w-R,g[5]=1-S-b,g[6]=I+C,g[8]=D+A,g[9]=I-C,g[10]=1-S-M,v[15]=1,v[0]=o,v[5]=l,v[10]=h,_=0;_<4;_++)d=g[_],f=g[_+4],p=g[_+8],m=g[_+12],y[_]=d,y[_+4]=f,y[_+8]=p,y[_+12]=d*t+f*e+p*i+m;for(_=0;_<4;_++)d=y[_],f=y[_+4],p=y[_+8],m=y[_+12],u[_+c]=d*v[0]+f*v[1]+p*v[2]+m*v[3],u[_+c+4]=d*v[4]+f*v[5]+p*v[6]+m*v[7],u[_+c+8]=d*v[8]+f*v[9]+p*v[10]+m*v[11],u[_+c+12]=d*v[12]+f*v[13]+p*v[14]+m*v[15]},L._createNodeByJson=function(t,e,i,n){if(!i)switch(e.type){case"Sprite3D":i=new Vi;break;case"MeshSprite3D":i=new gn;break;case"SkinnedMeshSprite3D":i=new yn;break;case"ShuriKenParticle3D":i=new vn;break;case"TrailSprite3D":i=new xn;break;case"Terrain":i=new fn;break;case"Camera":i=new pn;break;case"DirectionLight":i=new mn;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var r=e.props;if(r)for(var a in r)i[a]=r[a];var s=e.customProps;s&&(i instanceof laya.d3.core.Sprite3D?(i._parseBaseCustomProps(s),i._parseCustomProps(t,n,s,e),i._parseCustomComponent(t,n,e.components)):i._parseCustomProps(t,n,s,e));var o=e.child;if(o)for(var l=0,h=o.length;l<h;l++){var u=L._createNodeByJson(t,o[l],null,n);i.addChild(u)}return i},L._computeBoneAndAnimationDatasByBindPoseMatrxix=function(t,e,i,n,r,a){var s,o,l=0,h=0,u=t.length;for(s=0;s<u;l+=t[s].keyframeWidth,h+=16,s++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(e[l+0],e[l+1],e[l+2],e[l+3],e[l+4],e[l+5],e[l+6],e[l+7],e[l+8],e[l+9],n,h),0!=s&&(o=16*t[s].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(n,o,n,h,n,h));var c=i.length;for(s=0;s<c;s++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(n,16*a[s],i[s],r,16*s)},L._computeAnimationDatasByArrayAndMatrixFast=function(t,e,i,n){for(var r=0,a=t.length;r<a;r++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(e,16*n[r],t[r],i,16*r)},L._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function(t,e,i,n,r){var a,s,o=0,l=0,h=t.length;for(a=0;a<h;o+=t[a].keyframeWidth,l+=16,a++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(e[o+7],e[o+8],e[o+9],e[o+3],e[o+4],e[o+5],e[o+6],e[o+0],e[o+1],e[o+2],n,l),0!=a&&(s=16*t[a].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(n,s,n,l,n,l));var u=i.length;for(a=0;a<u;a++){var c=16*a;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(n,c,i[a],r,c)}},L._computeAnimationDatasByArrayAndMatrixFastOld=function(t,e,i){for(var n=t.length,r=0;r<n;r++){var a=16*r;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(e,a,t[r],i,a)}},L._computeRootAnimationData=function(t,e,i){for(var n=0,r=0,a=0,s=t.length;n<s;r+=t[n].keyframeWidth,a+=16,n++)laya.d3.utils.Utils3D.createAffineTransformationArray(e[r+0],e[r+1],e[r+2],e[r+3],e[r+4],e[r+5],e[r+6],e[r+7],e[r+8],e[r+9],i,a)},L.transformVector3ArrayByQuat=function(t,e,i,n,r){var a=i.elements,s=t[e],o=t[e+1],l=t[e+2],h=a[0],u=a[1],c=a[2],_=a[3],d=_*s+u*l-c*o,f=_*o+c*s-h*l,p=_*l+h*o-u*s,m=-h*s-u*o-c*l;n[r]=d*_+m*-h+f*-c-p*-u,n[r+1]=f*_+m*-u+p*-h-d*-c,n[r+2]=p*_+m*-c+d*-u-f*-h},L.mulMatrixByArray=function(t,e,i,n,r,a){var s,o,l,h,u;if(r===i){for(i=L._tempArray16_3,s=0;s<16;++s)i[s]=r[a+s];n=0}for(s=0;s<4;s++)o=t[e+s],l=t[e+s+4],h=t[e+s+8],u=t[e+s+12],r[a+s]=o*i[n+0]+l*i[n+1]+h*i[n+2]+u*i[n+3],r[a+s+4]=o*i[n+4]+l*i[n+5]+h*i[n+6]+u*i[n+7],r[a+s+8]=o*i[n+8]+l*i[n+9]+h*i[n+10]+u*i[n+11],r[a+s+12]=o*i[n+12]+l*i[n+13]+h*i[n+14]+u*i[n+15]},L.mulMatrixByArrayFast=function(t,e,i,n,r,a){var s,o,l,h,u;for(s=0;s<4;s++)o=t[e+s],l=t[e+s+4],h=t[e+s+8],u=t[e+s+12],r[a+s]=o*i[n+0]+l*i[n+1]+h*i[n+2]+u*i[n+3],r[a+s+4]=o*i[n+4]+l*i[n+5]+h*i[n+6]+u*i[n+7],r[a+s+8]=o*i[n+8]+l*i[n+9]+h*i[n+10]+u*i[n+11],r[a+s+12]=o*i[n+12]+l*i[n+13]+h*i[n+14]+u*i[n+15]},L.mulMatrixByArrayAndMatrixFast=function(t,e,i,n,r){var a,s,o,l,h,u=i.elements,c=u[0],_=u[1],d=u[2],f=u[3],p=u[4],m=u[5],g=u[6],v=u[7],y=u[8],x=u[9],E=u[10],T=u[11],S=u[12],w=u[13],M=u[14],D=u[15],I=e,b=e+4,C=e+8,A=e+12,R=r,L=r+4,O=r+8,P=r+12;for(a=0;a<4;a++)s=t[I+a],o=t[b+a],l=t[C+a],h=t[A+a],n[R+a]=s*c+o*_+l*d+h*f,n[L+a]=s*p+o*m+l*g+h*v,n[O+a]=s*y+o*x+l*E+h*T,n[P+a]=s*S+o*w+l*M+h*D},L.createAffineTransformationArray=function(t,e,i,n,r,a,s,o,l,h,u,c){var _=n+n,d=r+r,f=a+a,p=n*_,m=n*d,g=n*f,v=r*d,y=r*f,x=a*f,E=s*_,T=s*d,S=s*f;u[c+0]=(1-(v+x))*o,u[c+1]=(m+S)*o,u[c+2]=(g-T)*o,u[c+3]=0,u[c+4]=(m-S)*l,u[c+5]=(1-(p+x))*l,u[c+6]=(y+E)*l,u[c+7]=0,u[c+8]=(g+T)*h,u[c+9]=(y-E)*h,u[c+10]=(1-(p+v))*h,u[c+11]=0,u[c+12]=t,u[c+13]=e,u[c+14]=i,u[c+15]=1},L.transformVector3ArrayToVector3ArrayCoordinate=function(t,e,i,n,r){var a=L._tempArray4_0,s=t[e+0],o=t[e+1],l=t[e+2],h=i.elements;a[0]=s*h[0]+o*h[4]+l*h[8]+h[12],a[1]=s*h[1]+o*h[5]+l*h[9]+h[13],a[2]=s*h[2]+o*h[6]+l*h[10]+h[14],a[3]=1/(s*h[3]+o*h[7]+l*h[11]+h[15]),n[r+0]=a[0]*a[3],n[r+1]=a[1]*a[3],n[r+2]=a[2]*a[3]},L.transformLightingMapTexcoordByUV0Array=function(t,e,i,n,r){var a=i.elements;n[r+0]=t[e+0]*a[0]+a[2],n[r+1]=(t[e+1]-1)*a[1]+a[3]},L.transformLightingMapTexcoordByUV1Array=function(t,e,i,n,r){var a=i.elements;n[r+0]=t[e+0]*a[0]+a[2],n[r+1]=1+t[e+1]*a[1]+a[3]},L.getURLVerion=function(t){var e=t.indexOf("?");return 0<=e?t.substr(e):null},L._quaternionCreateFromYawPitchRollArray=function(t,e,i,n){var r=.5*i,a=.5*e,s=.5*t,o=Math.sin(r),l=Math.cos(r),h=Math.sin(a),u=Math.cos(a),c=Math.sin(s),_=Math.cos(s);n[0]=_*h*l+c*u*o,n[1]=c*u*l-_*h*o,n[2]=_*u*o-c*h*l,n[3]=_*u*l+c*h*o},L._createAffineTransformationArray=function(t,e,i,n){var r=e[0],a=e[1],s=e[2],o=e[3],l=r+r,h=a+a,u=s+s,c=r*l,_=r*h,d=r*u,f=a*h,p=a*u,m=s*u,g=o*l,v=o*h,y=o*u,x=i[0],E=i[1],T=i[2];n[0]=(1-(f+m))*x,n[1]=(_+y)*x,n[2]=(d-v)*x,n[3]=0,n[4]=(_-y)*E,n[5]=(1-(c+m))*E,n[6]=(p+g)*E,n[7]=0,n[8]=(d+v)*T,n[9]=(p-g)*T,n[10]=(1-(c+f))*T,n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1},L._mulMatrixArray=function(t,e,i,n){var r,a,s,o,l,h=e.elements,u=h[0],c=h[1],_=h[2],d=h[3],f=h[4],p=h[5],m=h[6],g=h[7],v=h[8],y=h[9],x=h[10],E=h[11],T=h[12],S=h[13],w=h[14],M=h[15],D=n,I=n+4,b=n+8,C=n+12;for(r=0;r<4;r++)a=t[r],s=t[r+4],o=t[r+8],l=t[r+12],i[D+r]=a*u+s*c+o*_+l*d,i[I+r]=a*f+s*p+o*m+l*g,i[b+r]=a*v+s*y+o*x+l*E,i[C+r]=a*T+s*S+o*w+l*M},L.getYawPitchRoll=function(t,e){L.transformQuat(Oe.ForwardRH,t,Ce.TEMPVector31),L.transformQuat(Oe.Up,t,Ce.TEMPVector32);var i=Ce.TEMPVector32.elements;L.angleTo(Oe.ZERO,Ce.TEMPVector31,Ce.TEMPVector33);var n=Ce.TEMPVector33.elements;n[0]==Math.PI/2?(n[1]=L.arcTanAngle(i[2],i[0]),n[2]=0):n[0]==-Math.PI/2?(n[1]=L.arcTanAngle(-i[2],-i[0]),n[2]=0):(De.createRotationY(-n[1],Ce.TEMPMatrix0),De.createRotationX(-n[0],Ce.TEMPMatrix1),Oe.transformCoordinate(Ce.TEMPVector32,Ce.TEMPMatrix0,Ce.TEMPVector32),Oe.transformCoordinate(Ce.TEMPVector32,Ce.TEMPMatrix1,Ce.TEMPVector32),n[2]=L.arcTanAngle(i[1],-i[0])),n[1]<=-Math.PI&&(n[1]=Math.PI),n[2]<=-Math.PI&&(n[2]=Math.PI),n[1]>=Math.PI&&n[2]>=Math.PI&&(n[1]=0,n[2]=0,n[0]=Math.PI-n[0]),e[0]=n[1],e[1]=n[0],e[2]=n[2]},L.arcTanAngle=function(t,e){return 0==t?1==e?Math.PI/2:-Math.PI/2:0<t?Math.atan(e/t):t<0?0<e?Math.atan(e/t)+Math.PI:Math.atan(e/t)-Math.PI:0},L.angleTo=function(t,e,i){Oe.subtract(e,t,Ce.TEMPVector30),Oe.normalize(Ce.TEMPVector30,Ce.TEMPVector30),i.elements[0]=Math.asin(Ce.TEMPVector30.y),i.elements[1]=L.arcTanAngle(-Ce.TEMPVector30.z,-Ce.TEMPVector30.x)},L.transformQuat=function(t,e,i){var n=i.elements,r=t.elements,a=e,s=r[0],o=r[1],l=r[2],h=a[0],u=a[1],c=a[2],_=a[3],d=_*s+u*l-c*o,f=_*o+c*s-h*l,p=_*l+h*o-u*s,m=-h*s-u*o-c*l;n[0]=d*_+m*-h+f*-c-p*-u,n[1]=f*_+m*-u+p*-h-d*-c,n[2]=p*_+m*-c+d*-u-f*-h},L.quaterionNormalize=function(t,e){var i=t[0],n=t[1],r=t[2],a=t[3],s=i*i+n*n+r*r+a*a;0<s&&(s=1/Math.sqrt(s),e[0]=i*s,e[1]=n*s,e[2]=r*s,e[3]=a*s)},L.matrix4x4MultiplyFFF=function(t,e,i){var n,r,a,s,o;if(i===e)for(e=new Float32Array(16),n=0;n<16;++n)e[n]=i[n];for(n=0;n<4;n++)r=t[n],a=t[n+4],s=t[n+8],o=t[n+12],i[n]=r*e[0]+a*e[1]+s*e[2]+o*e[3],i[n+4]=r*e[4]+a*e[5]+s*e[6]+o*e[7],i[n+8]=r*e[8]+a*e[9]+s*e[10]+o*e[11],i[n+12]=r*e[12]+a*e[13]+s*e[14]+o*e[15]},L.matrix4x4MultiplyMFM=function(t,e,i){L.matrix4x4MultiplyFFF(t.elements,e,i.elements)},L._tempVector3_0=new Oe,L._tempVector3_1=new Oe,L._tempVector3_2=new Oe,L._tempVector3_3=new Oe,L._tempVector3_4=new Oe,L._tempVector3_5=new Oe,L._tempVector3_6=new Oe,L._tempArray4_0=new Float32Array(4),L._tempArray16_0=new Float32Array(16),L._tempArray16_1=new Float32Array(16),L._tempArray16_2=new Float32Array(16),L._tempArray16_3=new Float32Array(16),c(L,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}}]),L}(),Qe=function(){function b(){}return m(b,"Laya3D"),b._cancelLoadByUrl=function(t){S.loader.cancelLoadByUrl(t),b._innerFirstLevelLoaderManager.cancelLoadByUrl(t),b._innerSecondLevelLoaderManager.cancelLoadByUrl(t),b._innerThirdLevelLoaderManager.cancelLoadByUrl(t),b._innerFourthLevelLoaderManager.cancelLoadByUrl(t)},b._changeWebGLSize=function(t,e){R.onStageResize(t,e),$.clientWidth=t,$.clientHeight=e},b.__init__=function(){var t=u.createMap;t.lh=[Vi,"SPRITE3DHIERARCHY"],t.ls=[Ni,"SPRITE3DHIERARCHY"],t.lm=[rn,"MESH"],t.lmat=[Wi,"MATERIAL"],t.lpbr=[Hi,"MATERIAL"],t.ltc=[hn,"TEXTURECUBE"],t.jpg=[ln,"nativeimage"],t.jpeg=[ln,"nativeimage"],t.png=[ln,"nativeimage"],t.pkm=[ln,"arraybuffer"],t.lsani=[r,"arraybuffer"],t.lrani=[r,"arraybuffer"],t.raw=[en,"arraybuffer"],t.mipmaps=[en,"arraybuffer"],t.thdata=[yi,"arraybuffer"],t.lt=[xi,"TERRAIN"],t.lani=[fi,"arraybuffer"],t.lav=[pi,"json"],t.ani=[r,"arraybuffer"],Dt.parserMap.SPRITE3DHIERARCHY=b._loadHierarchy,Dt.parserMap.MESH=b._loadMesh,Dt.parserMap.MATERIAL=b._loadMaterial,Dt.parserMap.TEXTURECUBE=b._loadTextureCube,Dt.parserMap.TERRAIN=b._loadTerrain,b._innerFirstLevelLoaderManager.on("error",null,b._eventLoadManagerError),b._innerSecondLevelLoaderManager.on("error",null,b._eventLoadManagerError),b._innerThirdLevelLoaderManager.on("error",null,b._eventLoadManagerError),b._innerFourthLevelLoaderManager.on("error",null,b._eventLoadManagerError)},b.READ_BLOCK=function(){return b._readData.pos+=4,!0},b.READ_DATA=function(){return b._DATA.offset=b._readData.getUint32(),b._DATA.size=b._readData.getUint32(),!0},b.READ_STRINGS=function(){var t=[],e={offset:0,size:0};e.offset=b._readData.getUint16(),e.size=b._readData.getUint16();b._readData.pos;b._readData.pos=e.offset+b._DATA.offset;for(var i=0;i<e.size;i++){var n=b._readData.readUTFString();-1===n.lastIndexOf(".lmat")&&-1===n.lastIndexOf(".lpbr")||t.push(n)}return t},b.formatRelativePath=function(t,e){if("."!==e.charAt(0))return t+e;for(var i=(t+e).split("/"),n=0,r=i.length;n<r;n++)if(".."==i[n]){var a=n-1;0<a&&".."!==i[a]&&(i.splice(a,2),n-=2)}return i.join("/")},b._eventLoadManagerError=function(t){S.loader.event("error",t)},b._addHierarchyInnerUrls=function(t,e,i,n,r,a){var s=b.formatRelativePath(n,r);i&&(s+=i),t.push({url:s,clas:a}),e[r]=s},b._getSprite3DHierarchyInnerUrls=function(t,e,i,n,r,a,s){var o,l=0,h=0;switch(t.type){case"Scene":var u=t.customProps.lightmaps;for(l=0,h=u.length;l<h;l++){var c=u[l].replace(".exr",".png");b._addHierarchyInnerUrls(n,r,a,s,c,ln)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var _;if(t.instanceParams)(_=t.instanceParams.loadPath)&&b._addHierarchyInnerUrls(e,r,a,s,_,rn);else{(_=(o=t.customProps).meshPath)&&b._addHierarchyInnerUrls(e,r,a,s,_,rn);var d=o.materials;if(d)for(l=0,h=d.length;l<h;l++){var f=d[l],p=f.type.split("."),m=C.window;if(p.forEach(function(t){m=m[t]}),"function"!=typeof m)throw"_getSprite3DHierarchyInnerUrls 错误: "+f.type+" 不是类";b._addHierarchyInnerUrls(i,r,a,s,f.path,m)}}break;case"ShuriKenParticle3D":var g=(o=t.customProps).meshPath;g&&b._addHierarchyInnerUrls(e,r,a,s,g,rn);var v=o.material;if(v)b._addHierarchyInnerUrls(i,r,a,s,v.path,dou.scene.ShurikenParticleMaterialExp);else{var y=o.materialPath;if(y)b._addHierarchyInnerUrls(i,r,a,s,y,Ki);else{var x=o.texturePath;x&&b._addHierarchyInnerUrls(n,r,a,s,x,ln)}}break;case"Terrain":b._addHierarchyInnerUrls(n,r,a,s,t.customProps.dataPath,xi)}var E=t.components;for(var T in E){var S=E[T];switch(T){case"Animator":var w=S.avatarPath;if(w)b._addHierarchyInnerUrls(n,r,a,s,w,pi);else{var M=S.avatar;M&&b._addHierarchyInnerUrls(n,r,a,s,M.path,pi)}var D=S.clipPaths;for(l=0,h=D.length;l<h;l++)b._addHierarchyInnerUrls(n,r,a,s,D[l],fi)}}var I=t.child;for(l=0,h=I.length;l<h;l++)b._getSprite3DHierarchyInnerUrls(I[l],e,i,n,r,a,s)},b._loadHierarchy=function(t){t.on("loaded",null,b._onHierarchylhLoaded,[t,t._class._getGroup()]),t.load(t.url,"json",!1,null,!0)},b._onHierarchylhLoaded=function(t,e,i){if(t._class.destroyed)t.endLoad();else{var n=t.url,r=qe.getURLVerion(n),a=A.getPath(n),s=[],o=[],l=[],h={};b._getSprite3DHierarchyInnerUrls(i,s,o,l,h,r,a);var u=s.length+o.length+l.length,c=u+1,_=1/c;if(b._onProcessChange(t,0,_,1),0<l.length){var d=u/c,f=I.create(null,b._onProcessChange,[t,_,d],!1);b._innerFourthLevelLoaderManager.create(l,I.create(null,b._onHierarchyInnerForthLevResouLoaded,[t,e,f,i,h,s,o,_+d*l.length,d]),f,null,null,1,!0,e)}else b._onHierarchyInnerForthLevResouLoaded(t,e,null,i,h,s,o,_,d)}},b._onHierarchyInnerForthLevResouLoaded=function(t,e,i,n,r,a,s,o,l){if(t._class.destroyed)t.endLoad();else if(i&&i.recover(),0<s.length){var h=I.create(null,b._onProcessChange,[t,o,l],!1);b._innerSecondLevelLoaderManager.create(s,I.create(null,b._onHierarchyInnerSecondLevResouLoaded,[t,e,h,n,r,a,o+l*s.length,l]),i,null,null,1,!0,e)}else b._onHierarchyInnerSecondLevResouLoaded(t,e,null,n,r,a,o,l)},b._onHierarchyInnerSecondLevResouLoaded=function(t,e,i,n,r,a,s,o){if(t._class.destroyed)t.endLoad();else if(i&&i.recover(),0<a.length){var l=I.create(null,b._onProcessChange,[t,s,o],!1);b._innerFirstLevelLoaderManager.create(a,I.create(null,b._onHierarchyInnerFirstLevResouLoaded,[t,l,n,r]),i,null,null,1,!0,e)}else b._onHierarchyInnerFirstLevResouLoaded(t,null,n,r)},b._onHierarchyInnerFirstLevResouLoaded=function(t,e,i,n){e&&e.recover(),t.endLoad([i,n])},b._loadTerrain=function(t){t.on("loaded",null,b._onTerrainLtLoaded,[t,t._class._getGroup()]),t.load(t.url,"json",!1,null,!0)},b._onTerrainLtLoaded=function(t,e,i){if(t._class.destroyed)t.endLoad();else{var n,r,a=t.url,s=qe.getURLVerion(a),o=A.getPath(a),l=[],h={},u=0,c=0,_=i.heightData;n=_.url,r=b.formatRelativePath(o,n),s&&(r+=s),n=h[n]=r;var d=i.detailTexture;for(u=0,c=d.length;u<c;u++)l.push({url:d[u].diffuse});var f=i.normalMap;for(u=0,c=f.length;u<c;u++)l.push({url:f[u]});var p=i.alphaMap;for(u=0,c=p.length;u<c;u++)l.push({url:p[u],params:[!1,!1,6408,!0]});for(u=0,c=l.length;u<c;u++){var m=l[u].url;r=b.formatRelativePath(o,m),s&&(r+=s),l[u].url=r,h[m]=r}var g=l.length,v=g+2,y=1/v;b._onProcessChange(t,0,y,1);var x={heightMapLoaded:!1,texturesLoaded:!1},E=I.create(null,b._onProcessChange,[t,y,y],!1);b._innerFourthLevelLoaderManager.create(n,I.create(null,b._onTerrainHeightMapLoaded,[t,E,i,h,x]),E,null,[_.numX,_.numZ,_.bitType,_.value],1,!0,e);var T=I.create(null,b._onProcessChange,[t,2*y,g/v],!1);b._innerFourthLevelLoaderManager.create(l,I.create(null,b._onTerrainTexturesLoaded,[t,T,i,h,x]),T,null,null,1,!0,e)}},b._onTerrainHeightMapLoaded=function(t,e,i,n,r){r.heightMapLoaded=!0,r.texturesLoaded&&(t.endLoad([i,n]),e.recover())},b._onTerrainTexturesLoaded=function(t,e,i,n,r){r.texturesLoaded=!0,r.heightMapLoaded&&(t.endLoad([i,n]),e.recover())},b._loadMesh=function(t){t.on("loaded",null,b._onMeshLmLoaded,[t,t._class._getGroup()]),t.load(t.url,"arraybuffer",!1,null,!0)},b._onMeshLmLoaded=function(t,e,i){if(t._class.destroyed)t.endLoad();else{var n,r,a,s=t.url,o=qe.getURLVerion(s),l=A.getPath(s),h={},u=0,c=0;switch((b._readData=new x(i)).pos=0,b._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var _=b._readData.getUint32();b._readData.pos=b._readData.pos+4,c=b._readData.getUint16(),b._readData.pos=b._readData.pos+8*c;var d=b._readData.getUint32();for(c=b._readData.getUint16(),b._readData.pos=_+d,n=[],u=0;u<c;u++){var f=b._readData.readUTFString();-1!==f.lastIndexOf(".lmat")&&n.push(f)}break;default:for(b.READ_BLOCK(),u=0;u<2;u++){var p=b._readData.getUint16(),m=b._strings[p],g=b["READ_"+m];if(null==g)throw new Error("model file err,no this function:"+p+" "+m);1===u?n=g.call():g.call()}}for(u=0,a=n.length;u<a;u++){var v=n[u];r=b.formatRelativePath(l,v),o&&(r+=o),n[u]=r,h[v]=r}if(0<n.length){b._onProcessChange(t,0,.5,1);var y=I.create(null,b._onProcessChange,[t,.5,.5],!1);b._innerSecondLevelLoaderManager.create(n,I.create(null,b._onMeshMateialLoaded,[t,y,i,h]),y,null,null,1,!0,e)}else t.endLoad([i,h])}},b._onMeshMateialLoaded=function(t,e,i,n){t.endLoad([i,n]),e.recover()},b._getMaterialTexturePath=function(t,e,i){var n=t.length-4;return t.indexOf(".dds")!=n&&t.indexOf(".tga")!=n&&t.indexOf(".exr")!=n&&t.indexOf(".DDS")!=n&&t.indexOf(".TGA")!=n&&t.indexOf(".EXR")!=n||(t=t.substr(0,n)+".png"),t=b.formatRelativePath(i,t),e&&(t+=e),t},b._loadMaterial=function(t){t.on("loaded",null,b._onMaterilLmatLoaded,[t,t._class._getGroup()]),t.load(t.url,"json",!1,null,!0)},b._onMaterilLmatLoaded=function(t,e,i){if(t._class.destroyed)t.endLoad();else{var n,r=t.url,a=qe.getURLVerion(r),s=A.getPath(r),o=[],l={},h=i.customProps,u=i.version;if(u)switch(u){case"LAYAMATERIAL:01":for(var c=i.props.textures,_=0,d=c.length;_<d;_++){var f=c[_],p=f.path;if(p){var m=p.length-4;p.indexOf(".exr")!=m&&p.indexOf(".EXR")!=m||(p=p.substr(0,m)+".png"),n=b.formatRelativePath(s,p),a&&(n+=a),o.push({url:n,params:f.params}),l[p]=n}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var g=h.diffuseTexture.texture2D;if(g&&(n=b._getMaterialTexturePath(g,a,s),o.push(n),l[g]=n),h.normalTexture){var v=h.normalTexture.texture2D;v&&(n=b._getMaterialTexturePath(v,a,s),o.push(n),l[v]=n)}if(h.specularTexture){var y=h.specularTexture.texture2D;y&&(n=b._getMaterialTexturePath(y,a,s),o.push(n),l[y]=n)}if(h.emissiveTexture){var x=h.emissiveTexture.texture2D;x&&(n=b._getMaterialTexturePath(x,a,s),o.push(n),l[x]=n)}if(h.ambientTexture){var E=h.ambientTexture.texture2D;E&&(n=b._getMaterialTexturePath(E,a,s),o.push(n),l[E]=n)}if(h.reflectTexture){var T=h.reflectTexture.texture2D;T&&(n=b._getMaterialTexturePath(T,a,s),o.push(n),l[T]=n)}}var S=o.length,w=S+1,M=1/w;if(b._onProcessChange(t,0,M,1),0<S){var D=I.create(null,b._onProcessChange,[t,M,S/w],!1);b._innerFourthLevelLoaderManager.create(o,I.create(null,b._onMateialTexturesLoaded,[t,D,i,l]),D,ln,null,1,!0,e)}else b._onMateialTexturesLoaded(t,null,i,null)}},b._onMateialTexturesLoaded=function(t,e,i,n){t.endLoad([i,n]),e&&e.recover()},b._loadTextureCube=function(t){t.on("loaded",null,b._onTextureCubeLtcLoaded,[t]),t.load(t.url,"json",!1,null,!0)},b._onTextureCubeLtcLoaded=function(t,e){if(t._class.destroyed)t.endLoad();else{var i=A.getPath(t.url),n=[b.formatRelativePath(i,e.left),b.formatRelativePath(i,e.right),b.formatRelativePath(i,e.up),b.formatRelativePath(i,e.down),b.formatRelativePath(i,e.front),b.formatRelativePath(i,e.back)];b._onProcessChange(t,0,1/7,1);var r=I.create(null,b._onProcessChange,[t,1/7,6/7],!1);b._innerFourthLevelLoaderManager.load(n,I.create(null,b._onTextureCubeImagesLoaded,[t,n,r]),r,"nativeimage")}},b._onTextureCubeImagesLoaded=function(t,e,i){var n=[];n.length=6;for(var r=0;r<6;r++){var a=e[r];n[r]=Dt.getRes(a),Dt.clearRes(a)}t.endLoad(n),i.recover()},b._onProcessChange=function(t,e,i,n){(n=e+n*i)<1&&t.event("progress",n)},b.init=function(t,e,i,n,r,a){void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===r&&(r=!0),void 0===a&&(a=!0),y.update3DLoop=function(){ni._triggerCollision()},y.cancelLoadByUrl=function(t){b._cancelLoadByUrl(t)},h.isAntialias=i,h.isAlpha=n,h.premultipliedAlpha=r,h.isStencil=a,f.isConchNode||R.enable()?(y.changeWebGLSize=b._changeWebGLSize,f.is3DMode=!0,S.init(t,e),F.__init__(),Ye.__init__(),Ue.__init__(),gn.__init__(),H.__init__(),b.__init__(),s.maxTextureCount=2,(b.debugMode||tt.debugMode)&&(b._debugPhasorSprite=new q)):alert("Laya3D init error,must support webGL!")},b.HIERARCHY="SPRITE3DHIERARCHY",b.MESH="MESH",b.MATERIAL="MATERIAL",b.PBRMATERIAL="PBRMTL",b.TEXTURECUBE="TEXTURECUBE",b.TERRAIN="TERRAIN",b._readData=null,b._debugPhasorSprite=null,b.debugMode=!1,c(b,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new u},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new u},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new u},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new u}]),b}(),Je=function(t){function r(t){r.__super.call(this),this._owner=t,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}m(r,"laya.d3.animation.AnimationTransform3D",a);var e=r.prototype;return e._getlocalMatrix=function(){return this._localUpdate&&(qe._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},e._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldTransform()}},e._setWorldMatrixAndUpdate=function(t){if(this._worldMatrix=t,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var e=this._getlocalMatrix(),i=0;i<16;++i)this._worldMatrix[i]=e[i];else qe.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},e._setWorldMatrixNoUpdate=function(t){this._worldMatrix=t},e._setWorldMatrixIgnoreUpdate=function(t){this._worldMatrix=t,this._worldUpdate=!1},e.getLocalPosition=function(){return this._localPosition},e.setLocalPosition=function(t){if(this._parent)this._localPosition=t,this._localUpdate=!0,this._onWorldTransform();else{var e=this._entity.owner._transform,i=this._entity.localPosition,n=i.elements;n[0]=t[0],n[1]=t[1],n[2]=t[2],e.localPosition=i}},e.getLocalRotation=function(){if(this._localQuaternionUpdate){var t=this._localRotationEuler;qe._quaternionCreateFromYawPitchRollArray(t[1]/r._angleToRandin,t[0]/r._angleToRandin,t[2]/r._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},e.setLocalRotation=function(t){if(this._parent)this._localRotation=t,qe.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var e=this._entity.owner._transform,i=this._entity.localRotation,n=i.elements;n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],e.localRotation=i}},e.getLocalScale=function(){return this._localScale},e.setLocalScale=function(t){if(this._parent)this._localScale=t,this._localUpdate=!0,this._onWorldTransform();else{var e=this._entity.owner._transform,i=this._entity.localScale,n=i.elements;n[0]=t[0],n[1]=t[1],n[2]=t[2],e.localScale=i}},e.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){qe.getYawPitchRoll(this._localRotation,r._tempVector3);var t=r._tempVector3,e=this._localRotationEuler;e[0]=t[1]*r._angleToRandin,e[1]=t[0]*r._angleToRandin,e[2]=t[2]*r._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},e.setLocalRotationEuler=function(t){if(this._parent)qe._quaternionCreateFromYawPitchRollArray(t[1]/r._angleToRandin,t[0]/r._angleToRandin,t[2]/r._angleToRandin,this._localRotation),this._localRotationEuler=t,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var e=this._entity.owner._transform,i=this._entity.localRotationEuler,n=i.elements;n[0]=t[0],n[1]=t[1],n[2]=t[2],e.localRotationEuler=i}},e.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)qe.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var t=this._getlocalMatrix(),e=0;e<16;++e)this._worldMatrix[e]=t[e];this._worldUpdate=!1}return this._worldMatrix},e.setParent=function(t){if(this._parent!==t){if(this._parent){var e=this._parent._childs,i=e.indexOf(this);e.splice(i,1)}t&&(t._childs.push(this),t&&this._onWorldTransform()),this._parent=t}},c(r,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),r}(),$e=function(t){function e(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,e.__super.call(this),this._destroyed=!1,this._id=e._uniqueIDCounter,e._uniqueIDCounter++}m(e,"laya.d3.component.Component3D",a);var i=e.prototype;return S.imps(i,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),i._initialize=function(t){this._owner=t,this._enable=!0,this.started=!1,this._load(t)},i._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},i._load=function(t){},i._start=function(t){},i._update=function(t){},i._lateUpdate=function(t){},i._preRenderUpdate=function(t){},i._postRenderUpdate=function(t){},i._unload=function(t){this.offAll()},i._cloneTo=function(t){},_(0,i,"id",function(){return this._id}),_(0,i,"destroyed",function(){return this._destroyed}),_(0,i,"owner",function(){return this._owner}),_(0,i,"enable",function(){return this._enable},function(t){this._enable!==t&&(this._enable=t,this.event("enablechanged",this._enable))}),_(0,i,"isSingleton",function(){return e._isSingleton}),e._isSingleton=!0,e._uniqueIDCounter=1,e}(),ti=function(t){function e(){this._destroyed=!1,e.__super.call(this),this._destroyed=!1}m(e,"laya.d3.core.GeometryFilter",a);var i=e.prototype;return S.imps(i,{"laya.resource.IDestroy":!0}),i._destroy=function(){this.offAll(),this._destroyed=!0},_(0,i,"_isAsyncLoaded",function(){return!0}),_(0,i,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),_(0,i,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),_(0,i,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),_(0,i,"destroyed",function(){return this._destroyed}),e}(),ei=function(t){function n(t){n.__super.call(this),this._id=++n._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new xe(new Oe,new Oe),this._boundingBoxCenter=new Oe,this._boundingSphere=new Te(new Oe,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=t,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}m(n,"laya.d3.core.render.BaseRender",a);var e=n.prototype;return S.imps(e,{"laya.resource.IDestroy":!0}),e._changeMaterialReference=function(t,e){t&&t._removeReference(),e._addReference()},e._getInstanceMaterial=function(t,e){var i=new t.constructor;return t.cloneTo(i),i.name=i.name+"(Instance)",this._materialsInstance[e]=!0,this._changeMaterialReference(this._materials[e],i),this._materials[e]=i},e._setShaderValuelightMap=function(t){this._setShaderValueTexture(3,t)},e._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},e._renderRenderableBoundBox=function(){var t=Qe._debugPhasorSprite,e=this.boundingBox,i=n._tempBoundBoxCorners;e.getCorners(i),t.line(i[0],n._greenColor,i[1],n._greenColor),t.line(i[2],n._greenColor,i[3],n._greenColor),t.line(i[4],n._greenColor,i[5],n._greenColor),t.line(i[6],n._greenColor,i[7],n._greenColor),t.line(i[0],n._greenColor,i[3],n._greenColor),t.line(i[1],n._greenColor,i[2],n._greenColor),t.line(i[2],n._greenColor,i[6],n._greenColor),t.line(i[3],n._greenColor,i[7],n._greenColor),t.line(i[0],n._greenColor,i[4],n._greenColor),t.line(i[1],n._greenColor,i[5],n._greenColor),t.line(i[4],n._greenColor,i[7],n._greenColor),t.line(i[5],n._greenColor,i[6],n._greenColor)},e._calculateBoundingSphere=function(){throw"BaseRender: must override it."},e._calculateBoundingBox=function(){throw"BaseRender: must override it."},e._setShaderValueTexture=function(t,e){this._owner._shaderValues.setValue(t,e)},e._setShaderValueMatrix4x4=function(t,e){this._owner._shaderValues.setValue(t,e?e.elements:null)},e._setShaderValueColor=function(t,e){this._owner._shaderValues.setValue(t,e?e.elements:null)},e._setShaderValueBuffer=function(t,e){this._owner._shaderValues.setValue(t,e)},e._setShaderValueInt=function(t,e){this._owner._shaderValues.setValue(t,e)},e._setShaderValueBool=function(t,e){this._owner._shaderValues.setValue(t,e)},e._setShaderValueNumber=function(t,e){this._owner._shaderValues.setValue(t,e)},e._setShaderValueVector2=function(t,e){this._owner._shaderValues.setValue(t,e?e.elements:null)},e._addShaderDefine=function(t){this._owner._shaderDefineValue|=t},e._removeShaderDefine=function(t){this._owner._shaderDefineValue&=~t},e._renderUpdate=function(t){return!0},e._applyLightMapParams=function(){if(0<=this._lightmapIndex){var t=this._owner.scene;if(t){var e=t.getlightmaps()[this._lightmapIndex];e?(this._addShaderDefine(_n.SAHDERDEFINE_LIGHTMAP),e.loaded?this._setShaderValuelightMap(e):e.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine(_n.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(_n.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(_n.SAHDERDEFINE_LIGHTMAP)},e._updateOctreeNode=function(){var t=this._treeNode;t&&this._octreeNodeNeedChange&&(t.updateObject(this),this._octreeNodeNeedChange=!1)},e._destroy=function(){this.offAll();var t=0,e=0;for(t=0,e=this._renderElements.length;t<e;t++)this._renderElements[t]._destroy();for(t=0,e=this._materials.length;t<e;t++)this._materials[t]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},_(0,e,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),_(0,e,"id",function(){return this._id}),_(0,e,"material",function(){var t=this._materials[0];if(t&&!this._materialsInstance[0]){var e=this._getInstanceMaterial(t,0);this.event("materialchanged",[this,0,e])}return this._materials[0]},function(t){this.sharedMaterial=t}),_(0,e,"sharedMaterial",function(){return this._materials[0]},function(t){var e=this._materials[0];e!==t&&(this._materials[0]=t,this._materialsInstance[0]=!1,this._changeMaterialReference(e,t),this.event("materialchanged",[this,0,t]))}),_(0,e,"lightmapIndex",function(){return this._lightmapIndex},function(t){this._lightmapIndex=t,this._applyLightMapParams()}),_(0,e,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function(t){this._lightmapScaleOffset=t,this._setShaderValueColor(2,t),this._addShaderDefine(_n.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),_(0,e,"enable",function(){return this._enable},function(t){this._enable=t,this.event("enablechanged",[this,t])}),_(0,e,"materials",function(){for(var t=0,e=this._materials.length;t<e;t++)if(!this._materialsInstance[t]){var i=this._getInstanceMaterial(this._materials[t],t);this.event("materialchanged",[this,t,i])}return this._materials.slice()},function(t){this.sharedMaterials=t}),_(0,e,"sharedMaterials",function(){return this._materials.slice()},function(t){if(!t)throw new Error("MeshRender: shadredMaterials value can't be null.");var e=t.length;this._materialsInstance.length=e;for(var i=0;i<e;i++){var n=this._materials[i];n!==t[i]&&(this._materialsInstance[i]=!1,this._changeMaterialReference(n,t[i]),this.event("materialchanged",[this,i,t[i]]))}this._materials=t}),_(0,e,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),_(0,e,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var t=this.boundingBox;Oe.add(t.min,t.max,this._boundingBoxCenter),Oe.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),_(0,e,"receiveShadow",function(){return this._receiveShadow},function(t){this._receiveShadow!==t&&((this._receiveShadow=t)?this._addShaderDefine(He.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine(He.SHADERDEFINE_RECEIVE_SHADOW))}),_(0,e,"destroyed",function(){return this._destroyed}),n._uniqueIDCounter=0,c(n,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new Oe,new Oe,new Oe,new Oe,new Oe,new Oe,new Oe,new Oe]},"_greenColor",function(){return this._greenColor=new Pe(0,1,0,1)}]),n}(),ii=function(t){function o(t){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,o.__super.call(this),this._localPosition=new Oe,this._localRotation=new Ce(0,0,0,1),this._localScale=new Oe(1,1,1),this._localRotationEuler=new Oe,this._localMatrix=new De,this._position=new Oe,this._rotation=new Ce(0,0,0,1),this._scale=new Oe(1,1,1),this._worldMatrix=new De,this._forward=new Oe,this._up=new Oe,this._right=new Oe,this._owner=t,this._childs=[]}m(o,"laya.d3.core.Transform3D",a);var e=o.prototype;return e._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)De.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var t=o._tempVector30;Oe.multiply(this.pivot,this._localScale,t);var e=o._tempVector31;Oe.subtract(t,this.pivot,e);var i=o._tempVector32,n=this.localRotation;Oe.transformQuat(t,n,i),Oe.subtract(i,t,i);var r=o._tempVector33;Oe.subtract(this._localPosition,e,r),Oe.subtract(r,i,r),De.createAffineTransformation(r,n,this._localScale,this._localMatrix)}},e._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldPositionRotationTransform()}},e._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldPositionScaleTransform()}},e._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldPositionTransform()}},e._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldPositionRotationTransform()}},e._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldPositionScaleTransform()}},e._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldTransform()}},e.translate=function(t,e){void 0===e&&(e=!0),e?(De.createFromQuaternion(this.localRotation,o._tempMatrix0),Oe.transformCoordinate(t,o._tempMatrix0,o._tempVector30),Oe.add(this.localPosition,o._tempVector30,this._localPosition),this.localPosition=this._localPosition):(Oe.add(this.position,t,this._position),this.position=this._position)},e.rotate=function(t,e,i){var n;void 0===e&&(e=!0),void 0===i&&(i=!0),n=i?t:(Oe.scale(t,Math.PI/180,o._tempVector30),o._tempVector30),Ce.createFromYawPitchRoll(n.y,n.x,n.z,o._tempQuaternion0),e?(Ce.multiply(this._localRotation,o._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(Ce.multiply(o._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},e.lookAt=function(t,e,i){void 0===i&&(i=!1);var n,r=t.elements;if(i){if(n=this._localPosition.elements,Math.abs(n[0]-r[0])<we.zeroTolerance&&Math.abs(n[1]-r[1])<we.zeroTolerance&&Math.abs(n[2]-r[2])<we.zeroTolerance)return;Ce.lookAt(this._localPosition,t,e,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var a=this.position;if(n=a.elements,Math.abs(n[0]-r[0])<we.zeroTolerance&&Math.abs(n[1]-r[1])<we.zeroTolerance&&Math.abs(n[2]-r[2])<we.zeroTolerance)return;Ce.lookAt(a,t,e,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},_(0,e,"_isFrontFaceInvert",function(){var t=this.scale,e=t.x<0;return t.y<0&&(e=!e),t.z<0&&(e=!e),e}),_(0,e,"owner",function(){return this._owner}),_(0,e,"localRotation",function(){if(this._localQuaternionUpdate){var t=this._localRotationEuler.elements;Ce.createFromYawPitchRoll(t[1]/o._angleToRandin,t[0]/o._angleToRandin,t[2]/o._angleToRandin,this._localRotation)}return this._localRotation},function(t){this._localRotation=t,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),_(0,e,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?De.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function(t){null===this._parent?t.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),De.multiply(this._localMatrix,t,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=t,this._worldUpdate=!1}),_(0,e,"worldNeedUpdate",function(){return this._worldUpdate}),_(0,e,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function(t){this._localMatrix=t,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),_(0,e,"dummy",function(){return this._dummy},function(t){this._dummy!==t&&(this._dummy&&(this._dummy._entity=null),t&&(t._entity=this),this._dummy=t)}),_(0,e,"localPosition",function(){return this._localPosition},function(t){this._localPosition=t,this._localUpdate=!0,this._onWorldPositionTransform()}),_(0,e,"position",function(){if(this._positionUpdate){if(null!=this._parent){var t=this._parent.position;Oe.multiply(this._localPosition,this._parent.scale,o._tempVector30),Oe.transformQuat(o._tempVector30,this._parent.rotation,o._tempVector30),Oe.add(t,o._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function(t){if(null!=this._parent){Oe.subtract(t,this._parent.position,this._localPosition);var e=this._parent.scale.elements,i=e[0],n=e[1],r=e[2];if(1!==i||1!==n||1!==r){var a=o._tempVector30,s=a.elements;s[0]=1/i,s[1]=1/n,s[2]=1/r,Oe.multiply(this._localPosition,a,this._localPosition)}this._parent.rotation.invert(o._tempQuaternion0),Oe.transformQuat(this._localPosition,o._tempQuaternion0,this._localPosition)}else t.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=t,this._positionUpdate=!1}),_(0,e,"localScale",function(){return this._localScale},function(t){this._localScale=t,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),_(0,e,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll(o._tempVector30);var t=o._tempVector30.elements,e=this._localRotationEuler.elements;e[0]=t[1]*o._angleToRandin,e[1]=t[0]*o._angleToRandin,e[2]=t[2]*o._angleToRandin}return this._localRotationEuler},function(t){this._localRotationEuler=t,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),_(0,e,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?Ce.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function(t){null!=this._parent?(this._parent.rotation.invert(o._tempQuaternion0),Ce.multiply(t,o._tempQuaternion0,this._localRotation)):t.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=t,this._rotationUpdate=!1}),_(0,e,"scale",function(){return this._scaleUpdate&&(null!==this._parent?Oe.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function(t){if(null!==this._parent){var e=this._parent.scale.elements,i=o._tempVector30.elements;i[0]=1/e[0],i[1]=1/e[1],i[2]=1/e[2],Oe.multiply(t,o._tempVector30,this._localScale)}else t.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=t,this._scaleUpdate=!1}),_(0,e,"rotationEuler",null,function(t){Ce.createFromYawPitchRoll(t.y,t.x,t.z,this._rotation),this.rotation=this._rotation}),_(0,e,"forward",function(){var t=this.worldMatrix.elements;return this._forward.elements[0]=-t[8],this._forward.elements[1]=-t[9],this._forward.elements[2]=-t[10],this._forward}),_(0,e,"up",function(){var t=this.worldMatrix.elements;return this._up.elements[0]=t[4],this._up.elements[1]=t[5],this._up.elements[2]=t[6],this._up}),_(0,e,"right",function(){var t=this.worldMatrix.elements;return this._right.elements[0]=t[0],this._right.elements[1]=t[1],this._right.elements[2]=t[2],this._right}),_(0,e,"parent",function(){return this._parent},function(t){if(this._parent!==t){if(this._parent){var e=this._parent._childs,i=e.indexOf(this);e.splice(i,1)}t&&(t._childs.push(this),t&&this._onWorldTransform()),this._parent=t}}),c(o,["_tempVector30",function(){return this._tempVector30=new Oe},"_tempVector31",function(){return this._tempVector31=new Oe},"_tempVector32",function(){return this._tempVector32=new Oe},"_tempVector33",function(){return this._tempVector33=new Oe},"_tempQuaternion0",function(){return this._tempQuaternion0=new Ce},"_tempMatrix0",function(){return this._tempMatrix0=new De},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),o}(),ni=(function(t){function e(){this._rotation=0,this._matNeedUpdte=!1,e.__super.call(this),this._matrix=new De,this._offset=new Le,this._tiling=new Le(1,1)}m(e,"laya.d3.core.TransformUV",a);var i=e.prototype;S.imps(i,{"laya.d3.core.IClone":!0}),i._updateMatrix=function(){e._tempOffsetV3.elements[0]=this._offset.x,e._tempOffsetV3.elements[1]=this._offset.y,Ce.createFromYawPitchRoll(0,0,this._rotation,e._tempRotationQua),e._tempTitlingV3.elements[0]=this._tiling.x,e._tempTitlingV3.elements[1]=this._tiling.y,De.createAffineTransformation(e._tempOffsetV3,e._tempRotationQua,e._tempTitlingV3,this._matrix)},i.cloneTo=function(t){t._matrix=this._matrix.clone(),t._offset=this._offset.clone(),t._rotation=this._rotation,t._tiling=this._tiling.clone()},i.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},_(0,i,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),_(0,i,"tiling",function(){return this._tiling},function(t){this._tiling=t,this._matNeedUpdte=!0}),_(0,i,"offset",function(){return this._offset},function(t){this._offset=t,this._matNeedUpdte=!0}),_(0,i,"rotation",function(){return this._rotation},function(t){this._rotation=t,this._matNeedUpdte=!0}),c(e,["_tempOffsetV3",function(){return this._tempOffsetV3=new Oe(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new Ce},"_tempTitlingV3",function(){return this._tempTitlingV3=new Oe(1,1,1)}])}(),function(t){function x(){x.__super.call(this)}return m(x,"laya.d3.utils.CollisionManager",a),x._onTrigger=function(t,e,i,n,r){var a=0,s=0,o=t.id,l=e.id;if(!t._ignoreCollisonMap[l]){var h=Ye.collisionManager,u=t._runtimeCollisonTestMap[l];if(null!=u)if(u)if(t._collisonTo(e))if(t._runtimeCollisonMap[l]){for(a=0,s=i.length;a<s;a++)i[a].onTriggerStay(e);for(a=0,s=n.length;a<s;a++)n[a].onTriggerStay(t);h.event("triggerstay",[t,e])}else{for(t._runtimeCollisonMap[l]=e,t._runtimeCollisonTestMap[l]=!1,e._runtimeCollisonMap[o]=t,r&&(e._runtimeCollisonTestMap[o]=!1),a=0,s=i.length;a<s;a++)i[a].onTriggerEnter(e);for(a=0,s=n.length;a<s;a++)n[a].onTriggerEnter(t);h.event("triggerenter",[t,e])}else{var c=t._runtimeCollisonMap;if(c[l]){for(delete c[l],delete t._runtimeCollisonTestMap[l],delete e._runtimeCollisonMap[o],r&&delete e._runtimeCollisonTestMap[o],a=0,s=i.length;a<s;a++)i[a].onTriggerExit(e);for(a=0,s=n.length;a<s;a++)n[a].onTriggerExit(t);h.event("triggerexit",[t,e])}}else{for(a=0,s=i.length;a<s;a++)i[a].onTriggerStay(e);for(a=0,s=n.length;a<s;a++)n[a].onTriggerStay(t);h.event("triggerstay",[t,e])}else if(t._collisonTo(e)){for(t._runtimeCollisonMap[l]=e,t._runtimeCollisonTestMap[l]=!1,e._runtimeCollisonMap[o]=t,r&&(e._runtimeCollisonTestMap[o]=!1),a=0,s=i.length;a<s;a++)i[a].onTriggerEnter(e);for(a=0,s=n.length;a<s;a++)n[a].onTriggerEnter(t);h.event("triggerenter",[t,e])}}},x._triggerCollision=function(){for(var t=F._collsionTestList,e=t.length,i=Ye._layerCollsionMatrix,n=0;n<e;n++)for(var r=t[n],a=F.getLayerByNumber(r),s=a._colliders,o=a._nonRigidbodyOffset,l=e-1;n<=l;l--){var h=t[l];if(i[r][30-h]){var u,c,_,d=0,f=0,p=0,m=0,g=F.getLayerByNumber(h),v=g._colliders,y=g._nonRigidbodyOffset;if(a!==g){for(d=0;d<o;d++)if((u=s[d]).enable){for(_=u.owner._scripts,p=0,m=y;p<m;p++)(c=v[p]).enable&&x._onTrigger(u,c,_,c.owner._scripts,!0);for(p=y,m=v.length;p<m;p++)(c=v[p]).enable&&x._onTrigger(u,c,_,c.owner._scripts,!1)}for(d=o,f=s.length;d<f;d++)if((u=s[d]).enable)for(_=u.owner._scripts,p=0,m=g._nonRigidbodyOffset;p<m;p++)(c=v[p]).enable&&x._onTrigger(c,u,_,c.owner._scripts,!1)}else for(d=0;d<o;d++)if((u=s[d]).enable){for(_=u.owner._scripts,p=d+1,m=o;p<m;p++)(c=v[p]).enable&&x._onTrigger(u,c,_,c.owner._scripts,!0);for(p=o,m=s.length;p<m;p++)(c=v[p]).enable&&x._onTrigger(u,c,_,c.owner._scripts,!1)}}}},x}()),ri=(function(r){function t(){t.__super.call(this)}m(t,"laya.d3.core.glitter.SplineCurvePosition",r);var e=t.prototype;e._CalcVelocity=function(t,e,i){Oe.subtract(t,e,i),Oe.scale(i,.5,i)},e.Init=function(t,e,i,n){this._CalcVelocity(e,t,this._tempVector30),this._CalcVelocity(n,i,this._tempVector31),r.prototype.Init.call(this,e,this._tempVector30,n,this._tempVector31)}}(N),function(i){function t(){this.x=NaN,this.y=NaN,this.z=NaN,t.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}m(t,"laya.d3.core.particleShuriKen.module.shape.BoxShape",i);var e=t.prototype;return e._getShapeBoundBox=function(t){var e=t.min.elements;e[0]=.5*-this.x,e[1]=.5*-this.y,e[2]=.5*-this.z;var i=t.max.elements;i[0]=.5*this.x,i[1]=.5*this.y,i[2]=.5*this.z},e._getSpeedBoundBox=function(t){var e=t.min.elements;e[0]=0,e[1]=0,e[2]=0;var i=t.max.elements;i[0]=0,i[1]=1,i[2]=0},e.generatePositionAndDirection=function(t,e,i,n){var r=t.elements,a=e.elements;i?(i.seed=n[16],Z._randomPointInsideHalfUnitBox(t,i),n[16]=i.seed):Z._randomPointInsideHalfUnitBox(t),r[0]=this.x*r[0],r[1]=this.y*r[1],r[2]=this.z*r[2],this.randomDirection?i?(i.seed=n[17],Z._randomPointUnitSphere(e,i),n[17]=i.seed):Z._randomPointUnitSphere(e):(a[0]=0,a[1]=0,a[2]=1)},e.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;e.x=this.x,e.y=this.y,e.z=this.z,e.randomDirection=this.randomDirection},t}(j)),ai=function(i){function s(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,s.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}m(s,"laya.d3.core.particleShuriKen.module.shape.CircleShape",i);var t=s.prototype;return t._getShapeBoundBox=function(t){var e=t.min.elements;e[0]=e[2]=-this.radius,e[1]=0;var i=t.max.elements;i[0]=i[2]=this.radius,i[1]=0},t._getSpeedBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=-1,e[2]=0;var i=t.max.elements;i[0]=i[1]=1,i[2]=0},t.generatePositionAndDirection=function(t,e,i,n){var r=t.elements,a=s._tempPositionPoint.elements;i?(i.seed=n[16],this.emitFromEdge?Z._randomPointUnitArcCircle(this.arc,s._tempPositionPoint,i):Z._randomPointInsideUnitArcCircle(this.arc,s._tempPositionPoint,i),n[16]=i.seed):this.emitFromEdge?Z._randomPointUnitArcCircle(this.arc,s._tempPositionPoint):Z._randomPointInsideUnitArcCircle(this.arc,s._tempPositionPoint),r[0]=-a[0],r[1]=a[1],r[2]=0,Oe.scale(t,this.radius,t),this.randomDirection?i?(i.seed=n[17],Z._randomPointUnitSphere(e,i),n[17]=i.seed):Z._randomPointUnitSphere(e):t.cloneTo(e)},t.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;e.radius=this.radius,e.arc=this.arc,e.emitFromEdge=this.emitFromEdge,e.randomDirection=this.randomDirection},c(s,["_tempPositionPoint",function(){return this._tempPositionPoint=new Le}]),s}(j),si=function(i){function _(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,_.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}m(_,"laya.d3.core.particleShuriKen.module.shape.ConeShape",i);var t=_.prototype;return t._getShapeBoundBox=function(t){var e=this.radius+this.length*Math.sin(this.angle),i=this.length*Math.cos(this.angle),n=t.min.elements;n[0]=n[1]=-e,n[2]=0;var r=t.max.elements;r[0]=r[1]=e,r[2]=i},t._getSpeedBoundBox=function(t){var e=Math.sin(this.angle),i=t.min.elements;i[0]=i[1]=-e,i[2]=0;var n=t.max.elements;n[0]=i[1]=e,n[2]=1},t.generatePositionAndDirection=function(t,e,i,n){var r,a=t.elements,s=e.elements,o=_._tempPositionPoint.elements,l=NaN,h=NaN,u=Math.cos(this.angle),c=Math.sin(this.angle);switch(this.emitType){case 0:i?(i.seed=n[16],Z._randomPointInsideUnitCircle(_._tempPositionPoint,i),n[16]=i.seed):Z._randomPointInsideUnitCircle(_._tempPositionPoint),l=o[0],h=o[1],a[0]=l*this.radius,a[1]=h*this.radius,a[2]=0,this.randomDirection?(i?(i.seed=n[17],Z._randomPointInsideUnitCircle(_._tempDirectionPoint,i),n[17]=i.seed):Z._randomPointInsideUnitCircle(_._tempDirectionPoint),r=_._tempDirectionPoint.elements,s[0]=r[0]*c,s[1]=r[1]*c):(s[0]=l*c,s[1]=h*c),s[2]=u;break;case 1:i?(i.seed=n[16],Z._randomPointUnitCircle(_._tempPositionPoint,i),n[16]=i.seed):Z._randomPointUnitCircle(_._tempPositionPoint),l=o[0],h=o[1],a[0]=l*this.radius,a[1]=h*this.radius,a[2]=0,this.randomDirection?(i?(i.seed=n[17],Z._randomPointInsideUnitCircle(_._tempDirectionPoint,i),n[17]=i.seed):Z._randomPointInsideUnitCircle(_._tempDirectionPoint),r=_._tempDirectionPoint.elements,s[0]=r[0]*c,s[1]=r[1]*c):(s[0]=l*c,s[1]=h*c),s[2]=u;break;case 2:i?(i.seed=n[16],Z._randomPointInsideUnitCircle(_._tempPositionPoint,i)):Z._randomPointInsideUnitCircle(_._tempPositionPoint),l=o[0],h=o[1],a[0]=l*this.radius,a[1]=h*this.radius,s[a[2]=0]=l*c,s[1]=h*c,s[2]=u,Oe.normalize(e,e),i?(Oe.scale(e,this.length*i.getFloat(),e),n[16]=i.seed):Oe.scale(e,this.length*Math.random(),e),Oe.add(t,e,t),this.randomDirection&&(i?(i.seed=n[17],Z._randomPointUnitSphere(e,i),n[17]=i.seed):Z._randomPointUnitSphere(e));break;case 3:i?(i.seed=n[16],Z._randomPointUnitCircle(_._tempPositionPoint,i)):Z._randomPointUnitCircle(_._tempPositionPoint),l=o[0],h=o[1],a[0]=l*this.radius,a[1]=h*this.radius,s[a[2]=0]=l*c,s[1]=h*c,s[2]=u,Oe.normalize(e,e),i?(Oe.scale(e,this.length*i.getFloat(),e),n[16]=i.seed):Oe.scale(e,this.length*Math.random(),e),Oe.add(t,e,t),this.randomDirection&&(i?(i.seed=n[17],Z._randomPointUnitSphere(e,i),n[17]=i.seed):Z._randomPointUnitSphere(e));break;default:throw new Error("ConeShape:emitType is invalid.")}},t.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;e.angle=this.angle,e.radius=this.radius,e.length=this.length,e.emitType=this.emitType,e.randomDirection=this.randomDirection},c(_,["_tempPositionPoint",function(){return this._tempPositionPoint=new Le},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new Le}]),_}(j),oi=function(i){function t(){this.radius=NaN,this.emitFromShell=!1,t.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}m(t,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",i);var e=t.prototype;return e._getShapeBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=e[2]=-this.radius;var i=t.max.elements;i[0]=i[1]=this.radius,i[2]=0},e._getSpeedBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=-1,e[2]=0;var i=t.max.elements;i[0]=i[1]=i[2]=1},e.generatePositionAndDirection=function(t,e,i,n){var r=t.elements;i?(i.seed=n[16],this.emitFromShell?Z._randomPointUnitSphere(t,i):Z._randomPointInsideUnitSphere(t,i),n[16]=i.seed):this.emitFromShell?Z._randomPointUnitSphere(t):Z._randomPointInsideUnitSphere(t),Oe.scale(t,this.radius,t);var a=r[2];a<0&&(r[2]=-1*a),this.randomDirection?i?(i.seed=n[17],Z._randomPointUnitSphere(e,i),n[17]=i.seed):Z._randomPointUnitSphere(e):t.cloneTo(e)},e.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;e.radius=this.radius,e.emitFromShell=this.emitFromShell,e.randomDirection=this.randomDirection},t}(j),li=function(i){function t(){this.radius=NaN,this.emitFromShell=!1,t.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}m(t,"laya.d3.core.particleShuriKen.module.shape.SphereShape",i);var e=t.prototype;return e._getShapeBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=e[2]=-this.radius;var i=t.max.elements;i[0]=i[1]=i[2]=this.radius},e._getSpeedBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=e[2]=-1;var i=t.max.elements;i[0]=i[1]=i[2]=1},e.generatePositionAndDirection=function(t,e,i,n){i?(i.seed=n[16],this.emitFromShell?Z._randomPointUnitSphere(t,i):Z._randomPointInsideUnitSphere(t,i),n[16]=i.seed):this.emitFromShell?Z._randomPointUnitSphere(t):Z._randomPointInsideUnitSphere(t),Oe.scale(t,this.radius,t),this.randomDirection?i?(i.seed=n[17],Z._randomPointUnitSphere(e,i),n[17]=i.seed):Z._randomPointUnitSphere(e):t.cloneTo(e)},e.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;e.radius=this.radius,e.emitFromShell=this.emitFromShell,e.randomDirection=this.randomDirection},t}(j),hi=function(t){function e(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,e.__super.call(this)}return m(e,"laya.d3.core.render.SubMeshRenderElement",Q),e}(),ui=function(t){function g(t,e,i,n,r,a){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=t,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[He.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[_n.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[_n.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[yn.SHADERDEFINE_BONE]="BONE",this._materialInt2name[mi.SHADERDEFINE_ALPHATEST]="ALPHATEST";g.__super.call(this,t,e,i,null,{}),this._attributeMap=n;var s;for(s in r){var o=r[s];switch(o[1]){case 0:this._renderElementUniformMap[s]=o[0];break;case 1:this._materialUniformMap[s]=o[0];break;case 2:this._spriteUniformMap[s]=o[0];break;case 3:this._cameraUniformMap[s]=o[0];break;case 4:this._sceneUniformMap[s]=o[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}if(f.isConchNode){this._conchShader=new ConchShader,this._conchShader.setSrc(this._VS.sd,this._PS.sd),delete this._VS.sd,delete this._PS.sd;var l=[];for(s in this._attributeMap)l.push({name:s,elementUsage:this._attributeMap[s]});this._conchShader.setAttrDeclare(l);var h=[];for(s in r){var u=r[s];h.push({name:s,elementUsage:u[0],periodType:u[1]})}this._conchShader.setUniformDeclare(h)}}m(g,"laya.d3.shader.ShaderCompile3D",E);var e=g.prototype;return e._definesToNameDic=function(t,e){for(var i={},n=1,r=0;r<32&&!(t<(n=1<<r));r++)if(t&n){var a=e[n];a&&(i[a]="")}return i},e.withCompile=function(t,e,i){var n,r,a;if(r=this.sharders[t])if(a=r[e]){if(n=a[i])return n}else a=r[e]=[];else a=(r=this.sharders[t]=[])[e]=[];var s,o=this._definesToNameDic(t,g._globalInt2name),l=this._definesToNameDic(e,this._spriteInt2name),h=this._definesToNameDic(i,this._materialInt2name);if(laya.d3.shader.ShaderCompile3D.debugMode){var u="";for(s in o)u+=s+" ";var c="";for(s in l)c+=s+" ";var _="";for(s in h)_+=s+" ";console.log("ShaderCompile3DDebugMode---(Name:"+Fi.nameKey.getName(this._name)+" PublicDefine:"+t+" SpriteDefine:"+e+" MaterialDefine:"+i+" PublicDefineGroup:"+u+" SpriteDefineGroup:"+c+"MaterialDefineGroup: "+_+")---ShaderCompile3DDebugMode")}var d={},f="";if(o)for(s in o)f+="#define "+s+"\n",d[s]=!0;if(l)for(s in l)f+="#define "+s+"\n",d[s]=!0;if(h)for(s in h)f+="#define "+s+"\n",d[s]=!0;var p=this._VS.toscript(d,[]),m=this._PS.toscript(d,[]);return n=Fi.create(f+p.join("\n"),f+m.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap),a[i]=n},e.precompileShaderWithShaderDefine=function(t,e,i){this.withCompile(t,e,i)},e.addMaterialDefines=function(t){var e=t.defines;for(var i in e){var n=e[i],r=parseInt(i);this._materialInt2name[r]=n,this._materialName2Int[n]=r}},e.addSpriteDefines=function(t){var e=t.defines;for(var i in e){var n=e[i],r=parseInt(i);this._spriteInt2name[r]=n,this._spriteName2Int[n]=r}},e.getMaterialDefineByName=function(t){return this._materialName2Int[t]},e.registerMaterialDefine=function(t){var e=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[e]=t,this._materialName2Int[t]=e},e.registerSpriteDefine=function(t){var e=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[e]=t,this._spriteName2Int[t]=e},g._globalRegDefine=function(t,e){g._globalInt2name[e]=t},g.add=function(t,e,i,n,r){return laya.d3.shader.ShaderCompile3D._preCompileShader[t]=new g(t,e,i,n,r,E.includes)},g.get=function(t){return laya.d3.shader.ShaderCompile3D._preCompileShader[Fi.nameKey.getID(t)]},g._preCompileShader={},g._globalInt2name=[],g.debugMode=!1,g.SHADERDEFINE_HIGHPRECISION=1,g.SHADERDEFINE_FOG=4,g.SHADERDEFINE_DIRECTIONLIGHT=8,g.SHADERDEFINE_POINTLIGHT=16,g.SHADERDEFINE_SPOTLIGHT=32,g.SHADERDEFINE_UV0=64,g.SHADERDEFINE_COLOR=128,g.SHADERDEFINE_UV1=256,g.SAHDERDEFINE_DEPTHFOG=131072,g}(),ci=function(t){function f(){f.__super.call(this)}m(f,"laya.d3.graphics.MeshSprite3DStaticBatchManager",ct);var e=f.prototype;return e._getStaticBatch=function(t,e,i,n){var r,a;return a=t?t.id.toString()+i.id.toString()+e.id.toString()+n.toString():i.id.toString()+e.id.toString()+n.toString(),this._staticBatches[a]?r=this._staticBatches[a]:this._staticBatches[a]=r=new _i(a,this,t,e,i),r},e._initStaticBatchs=function(t){var e,i;this._initBatchRenderElements.sort(f._sortPrepareStaticBatch);for(var n,r=!1,a=0,s=0,o=this._initBatchRenderElements.length;s<o;s++){var l,h=this._initBatchRenderElements[s],u=h.renderObj._getVertexBuffer(0);h._sprite3D;if(i===u.vertexDeclaration&&e===h._material)if(r)n._addCombineBatchRenderObjTest(h)?(l=h._staticBatch)!==n&&(l&&l._deleteCombineBatchRenderObj(h),n._addCombineBatchRenderObj(h)):(r=!1,a++);else{var c=this._initBatchRenderElements[s-1],_=c.renderObj,d=h.renderObj;r=!(65535<_._getVertexBuffer().vertexCount+d._getVertexBuffer().vertexCount)&&(n=this._getStaticBatch(t,i,e,a),(l=c._staticBatch)!==n&&(l&&l._deleteCombineBatchRenderObj(c),n._addCombineBatchRenderObj(c)),(l=h._staticBatch)!==n&&(l&&l._deleteCombineBatchRenderObj(h),n._addCombineBatchRenderObj(h)),!0)}else r=!1,a=0;e=h._material,i=u.vertexDeclaration}},f._sortPrepareStaticBatch=function(t,e){var i=t._render,n=e._render,r=i.lightmapIndex-n.lightmapIndex;if(0!==r)return r;var a=i.receiveShadow-n.receiveShadow;if(0!==a)return a;var s=t._mainSortID-e._mainSortID;return 0===s?t.renderObj.triangleCount-e.renderObj.triangleCount:s},f}(),_i=function(t){function a(t,e,i,n,r){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,a.__super.call(this,t,e,i),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=n,this._material=r}m(a,"laya.d3.graphics.SubMeshStaticBatch",_t);var e=a.prototype;return e._compareBatchRenderElement=function(t,e){return t._batchIndexStart>e._batchIndexStart},e._addCombineBatchRenderObjTest=function(t){var e=t.renderObj._vertexCount;return!(65535<(0<e?this._currentCombineVertexCount+e:this._currentCombineVertexCount+t.renderObj._getVertexBuffer().vertexCount))},e._addCombineBatchRenderObj=function(t){var e=t.renderObj,i=e._vertexCount;this._initBatchRenderElements.push(t),t._staticBatch=this,0<i?(this._currentCombineIndexCount+=e._indexCount,this._currentCombineVertexCount+=i):(this._currentCombineIndexCount=this._currentCombineIndexCount+e._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+e._getVertexBuffer().vertexCount),this._needFinishCombine=!0},e._deleteCombineBatchRenderObj=function(t){var e=t.renderObj,i=this._initBatchRenderElements.indexOf(t);if(-1!==i){this._initBatchRenderElements.splice(i,1),t._staticBatch=null;var n=e._vertexCount;this._currentCombineVertexCount=0<n?(this._currentCombineIndexCount=this._currentCombineIndexCount-e._indexCount,this._currentCombineVertexCount-n):(this._currentCombineIndexCount=this._currentCombineIndexCount-e._getIndexBuffer().indexCount,this._currentCombineVertexCount-e._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},e._finishInit=function(){if(this._needFinishCombine){var t=0,e=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var i=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),n=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=Zi.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=ji.create("ushort",this._currentCombineIndexCount,35044);for(var r=0,a=this._initBatchRenderElements.length;r<a;r++){var s=this._initBatchRenderElements[r],o=s.renderObj,l=o._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,s._sprite3D),h=o.getIndices(),u=s._sprite3D.transform._isFrontFaceInvert,c=t/(this._vertexDeclaration.vertexStride/4)-o._vertexStart,_=e,d=_+h.length;s._batchIndexStart=_,s._batchIndexEnd=d,n.set(h,e);var f=0;if(u)for(f=_;f<d;f+=3){n[f]=c+n[f];var p=n[f+1],m=n[f+2];n[f+1]=c+m,n[f+2]=c+p}else for(f=_;f<d;f+=3)n[f]=c+n[f],n[f+1]=c+n[f+1],n[f+2]=c+n[f+2];e+=h.length,i.set(l,t),t+=l.length}this._vertexBuffer.setData(i),this._indexBuffer.setData(n),this._needFinishCombine=!1}},e._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new hi)},e._getRenderElement=function(t,e,i){for(var n,r,a=this._batchRenderElements.length,s=!0,o=0;o<a;o++){var l,h,u=(r=this._batchRenderElements[o])._sprite3D._render;if(0!==o&&(s=(l=(n=this._batchRenderElements[o-1])._sprite3D._render).lightmapIndex!==u.lightmapIndex||l.receiveShadow!==u.receiveShadow||n._batchIndexEnd!==r._batchIndexStart),s){(h=this._getCombineRenderElementFromPool()).renderObj=this,h._material=this._material,h._batchIndexStart=r._batchIndexStart,h._batchIndexEnd=r._batchIndexEnd;var c=u.lightmapIndex,_=c+1,d=this._batchOwnerIndices[_];d||(d=this._batchOwnerIndices[_]=[]);var f,p=d[r._render.receiveShadow?1:0];void 0===p?(d[u.receiveShadow?1:0]=this._batchOwners.length,(f=new gn(null,"StaticBatchMeshSprite3D"))._scene=e,f._transform=this._rootOwner?this._rootOwner._transform:null,f._render.lightmapIndex=c,f._render.receiveShadow=r._render.receiveShadow,this._batchOwners.push(f)):f=this._batchOwners[p],f._render._renderUpdate(i),h._sprite3D=f,t.push(h)}else h._batchIndexEnd=r._batchIndexEnd}},e._beforeRender=function(t){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},e._render=function(t){var e=t.renderElement,i=e._batchIndexStart,n=e._batchIndexEnd-i;R.mainContext.drawElements(4,n,5123,2*i),M.drawCall++,M.trianglesFaces+=n/3},e.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},e._getVertexBuffer=function(t){return void 0===t&&(t=0),this._vertexBuffer},a}(),di=(function(t){function d(){d.__super.call(this),d._nameNumber++,this.loadShaderParams(),this.createResource(),this.alphaBlending=1,this.colorIntensity=1}m(d,"laya.d3.resource.models.SkyBox",t);var e=d.prototype;e._getShader=function(t){var e=t.scene._shaderDefineValue;return this._shader=this._shaderCompile.withCompile(e,0,0),this._shader},e.createResource=function(){this._numberVertices=36,this._numberIndices=36;var t=new Uint16Array(this._numberIndices),e=d._vertexDeclaration.vertexStride/4,i=new Float32Array(this._numberVertices*e),n=new Oe(-.5,.5,.5),r=new Oe(-.5,-.5,.5),a=new Oe(.5,.5,.5),s=new Oe(.5,-.5,.5),o=new Oe(-.5,.5,-.5),l=new Oe(.5,.5,-.5),h=new Oe(-.5,-.5,-.5),u=new Oe(.5,-.5,-.5),c=0;c=this._addVertex(i,c,n),c=this._addVertex(i,c,r),c=this._addVertex(i,c,a),c=this._addVertex(i,c,r),c=this._addVertex(i,c,s),c=this._addVertex(i,c,a),c=this._addVertex(i,c,o),c=this._addVertex(i,c,l),c=this._addVertex(i,c,h),c=this._addVertex(i,c,h),c=this._addVertex(i,c,l),c=this._addVertex(i,c,u),c=this._addVertex(i,c,n),c=this._addVertex(i,c,l),c=this._addVertex(i,c,o),c=this._addVertex(i,c,n),c=this._addVertex(i,c,a),c=this._addVertex(i,c,l),c=this._addVertex(i,c,r),c=this._addVertex(i,c,h),c=this._addVertex(i,c,u),c=this._addVertex(i,c,r),c=this._addVertex(i,c,u),c=this._addVertex(i,c,s),c=this._addVertex(i,c,n),c=this._addVertex(i,c,h),c=this._addVertex(i,c,r),c=this._addVertex(i,c,o),c=this._addVertex(i,c,h),c=this._addVertex(i,c,n),c=this._addVertex(i,c,a),c=this._addVertex(i,c,s),c=this._addVertex(i,c,u),c=this._addVertex(i,c,l),c=this._addVertex(i,c,a),c=this._addVertex(i,c,u);for(var _=0;_<36;_++)t[_]=_;this._vertexBuffer=new Zi(d._vertexDeclaration,this._numberVertices,35044,!0),this._indexBuffer=new ji("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(i),this._indexBuffer.setData(t)},e._addVertex=function(t,e,i){var n=i.elements;return t[e+0]=n[0],t[e+1]=n[1],t[e+2]=n[2],e+3},e.loadShaderParams=function(){this._sharderNameID=Fi.nameKey.getID("SkyBox"),this._shaderCompile=ui._preCompileShader[this._sharderNameID]},e._render=function(t){this._textureCube&&this._textureCube.loaded&&(this._vertexBuffer._bind(),this._indexBuffer._bind(),this._shader=this._getShader(t),this._shader.bind(),t.camera.transform.worldMatrix.cloneTo(d._tempMatrix4x40),d._tempMatrix4x40.transpose(),De.multiply(t._projectionMatrix,d._tempMatrix4x40,d._tempMatrix4x41),t.camera._shaderValues.setValue(4,d._tempMatrix4x41.elements),this._shader.uploadCameraUniforms(t.camera._shaderValues.data),this._shaderValue.setValue(1,this._colorIntensity),this._shaderValue.setValue(2,this._alphaBlending),this._shaderValue.setValue(3,this.textureCube),this._shader.uploadAttributes(d._vertexDeclaration.shaderValues.data,null),this._shader.uploadMaterialUniforms(this._shaderValue.data),R.mainContext.drawElements(4,36,5123,0),M.trianglesFaces+=12,M.drawCall++)},e.destroy=function(){t.prototype.destroy.call(this),this._textureCube&&(this._textureCube._removeReference(),this._textureCube=null)},_(0,e,"textureCube",function(){return this._textureCube},function(t){this._textureCube!==t&&(this._textureCube&&this._textureCube._removeReference(),(this._textureCube=t)&&t._addReference())}),d._nameNumber=1,c(d,["_tempMatrix4x40",function(){return this._tempMatrix4x40=new De},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new De},"_vertexDeclaration",function(){return this._vertexDeclaration=new dt(12,[new ft(0,"vector3",0)])}])}(Ve),function(t){function p(){this._stacks=16,this._slices=16,this._radius=1,p.__super.call(this),p._nameNumber++,this.loadShaderParams(),this.recreateResource(),this.alphaBlending=1,this.colorIntensity=1}m(p,"laya.d3.resource.models.SkyDome",t);var e=p.prototype;e._getShader=function(t){var e=t.scene._shaderDefineValue;return this._shader=this._shaderCompile.withCompile(e,0,0),this._shader},e.recreateResource=function(){this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=3*this._stacks*(this._slices+1)*2;for(var t=new Uint16Array(this._numberIndices),e=p._vertexDeclaration.vertexStride/4,i=new Float32Array(this._numberVertices*e),n=Math.PI/this._stacks,r=2*Math.PI/this._slices,a=0,s=0,o=0,l=0;l<this._stacks+1;l++)for(var h=Math.sin(l*n),u=Math.cos(l*n),c=0;c<this._slices+1;c++){var _=h*Math.sin(c*r),d=h*Math.cos(c*r);i[s+0]=_*this._radius,i[s+1]=u*this._radius,i[s+2]=d*this._radius,i[s+3]=-c/this._slices+.75,i[s+4]=l/this._stacks,s+=e,l!=this._stacks-1&&(t[o++]=a+1,t[o++]=a,t[o++]=a+(this._slices+1),t[o++]=a+(this._slices+1),t[o++]=a,t[o++]=a+this._slices,a++)}if(this._vertexBuffer=new Zi(p._vertexDeclaration,this._numberVertices,35044),this._indexBuffer=new ji("ushort",this._numberIndices,35044),this._vertexBuffer.setData(i),this._indexBuffer.setData(t),this._conchSky){this._conchSky.setVBIB(p._vertexDeclaration._conchVertexDeclaration,i,t),this._sharderNameID=Fi.nameKey.getID("SkyDome");var f=ui._preCompileShader[this._sharderNameID];this._conchSky.setShader(f._conchShader)}},e.loadShaderParams=function(){this._sharderNameID=Fi.nameKey.getID("SkyDome"),this._shaderCompile=ui._preCompileShader[this._sharderNameID]},e._render=function(t){this._texture&&this._texture.loaded&&(this._vertexBuffer._bind(),this._indexBuffer._bind(),this._shader=this._getShader(t),this._shader.bind(),t.camera.transform.worldMatrix.cloneTo(p._tempMatrix4x40),p._tempMatrix4x40.transpose(),De.multiply(t._projectionMatrix,p._tempMatrix4x40,p._tempMatrix4x41),t.camera._shaderValues.setValue(4,p._tempMatrix4x41.elements),this._shader.uploadCameraUniforms(t.camera._shaderValues.data),this._shaderValue.setValue(1,this._colorIntensity),this._shaderValue.setValue(2,this._alphaBlending),this._shaderValue.setValue(3,this.texture),this._shader.uploadAttributes(p._vertexDeclaration.shaderValues.data,null),this._shader.uploadMaterialUniforms(this._shaderValue.data),R.mainContext.drawElements(4,this._indexBuffer.indexCount,5123,0),M.trianglesFaces+=this._numberIndices/3,M.drawCall++)},e.onEnvDescLoaded=function(t){var e="",i=Math.max(t.lastIndexOf("/"),t.lastIndexOf("\\"));0<i&&(e=t.substr(0,i+1));var n=S.loader.getRes(t);null!=n.ev&&this.__ownerCamera?this.__ownerCamera._shaderValues.setValue(13,Math.pow(2,n.ev)):this.__ownerCamera._shaderValues.setValue(13,Math.pow(2,0)),this.texture=ln.load(e+n.skytex),this.environmentSpecular=en.load(e+n.prefiltedEnv);var r=new Float32Array(n.IrradianceMat);this.envDiffuseSHRed=r.slice(0,16),this.envDiffuseSHGreen=r.slice(16,32),this.envDiffuseSHBlue=r.slice(32,48)},e.loadEnvInfo=function(t){S.loader.load(t,I.create(this,this.onEnvDescLoaded,[t]))},e.destroy=function(){t.prototype.destroy.call(this),this._texture&&(this._texture._removeReference(),this._texture=null)},_(0,e,"texture",function(){return this._texture},function(t){this._texture!==t&&(this._texture&&this._texture._removeReference(),(this._texture=t)&&t._addReference())}),p._nameNumber=1,c(p,["_tempMatrix4x40",function(){return this._tempMatrix4x40=new De},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new De},"_vertexDeclaration",function(){return this._vertexDeclaration=new dt(20,[new ft(0,"vector3",0),new ft(12,"vector2",2)])}])}(Ve),function(t){function e(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,e.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}m(e,"laya.d3.core.ComponentNode",d);var i=e.prototype;return i.addComponent=function(t){var e,i=this._componentsMap.indexOf(t);if(-1===i)e=[],this._componentsMap.push(t),this._typeComponentsIndices.push(e);else if(e=this._typeComponentsIndices[i],this._components[e[0]].isSingleton)throw new Error("无法单实例创建"+t+"组件，"+t+"组件已存在！");var n=l.getInstance(t);return e.push(this._components.length),this._components.push(n),n instanceof laya.d3.component.Script&&this._scripts.push(n),n._initialize(this),n},i._removeComponent=function(t,e){var i=this._typeComponentsIndices[t],n=i[e],r=this._components[n];this._components.splice(n,1),r instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(r),1),i.splice(e,1),0===i.length&&(this._typeComponentsIndices.splice(t,1),this._componentsMap.splice(t,1));for(var a=0,s=this._componentsMap.length;a<s;a++)for(var o=(i=this._typeComponentsIndices[a]).length-1;0<=o;o--){var l=i[o];if(!(n<l))break;i[o]=--l}r._destroy()},i.getComponentByType=function(t,e){void 0===e&&(e=0);var i=this._componentsMap.indexOf(t);return-1===i?null:this._components[this._typeComponentsIndices[i][e]]},i.getComponentsByType=function(t,e){var i=this._componentsMap.indexOf(t);if(-1!==i){var n=this._typeComponentsIndices[i],r=n.length;e.length=r;for(var a=0;a<r;a++)e[a]=this._components[n[a]]}else e.length=0},i.getComponentByIndex=function(t){return this._components[t]},i.removeComponentByType=function(t,e){void 0===e&&(e=0);var i=this._componentsMap.indexOf(t);-1!==i&&this._removeComponent(i,e)},i.removeComponentsByType=function(t){var e=this._componentsMap.indexOf(t);if(-1!==e)for(var i=this._typeComponentsIndices[e],n=0,r=i.length;n<r;i.length<r?r--:n++)this._removeComponent(e,n)},i.removeAllComponent=function(){for(var t=0,e=this._componentsMap.length;t<e;this._componentsMap.length<e?e--:t++)this.removeComponentsByType(this._componentsMap[t])},i._updateComponents=function(t){for(var e=0,i=this._components.length;e<i;e++){var n=this._components[e];!n.started&&(n._start(t),n.started=!0),n.enable&&n._update(t)}},i._lateUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._lateUpdate(t)}},i._preRenderUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._preRenderUpdate(t)}},i._postRenderUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._postRenderUpdate(t)}},e}()),fi=function(t){function e(){this._realTimeCurrentFrameIndexes=null,this._realTimeCurrentTimes=null,this._fullKeyframeIndicesCache=null,this._animationDatasCache=null,this._avatarDatasCache=null,this._skinnedDatasCache=null,this._version=null,this._nodes=null,this._nodesMap=null,this._cachePropertyMap=null,this._nodeToCachePropertyMap=null,this._unCachePropertyMap=null,this._duration=NaN,this._frameRate=0,this._animationEvents=null,this._publicClipDatas=null,this.islooping=!1,e.__super.call(this),this._fullKeyframeIndicesCache={},this._animationDatasCache=[],this._avatarDatasCache=[],this._skinnedDatasCache=[],this._animationEvents=[]}m(e,"laya.d3.animation.AnimationClip",v);var i=e.prototype;return i.duration=function(){return this._duration},i._hermiteInterpolate=function(t,e,i,n){for(var r=t.data,a=t.outTangent,s=t.next,o=s.data,l=s.inTangent,h=!1,u=NaN,c=NaN,_=NaN,d=NaN,f=0,p=n.length;f<p;f++){var m=a[f],g=l[f];if(Number.isFinite(m)&&Number.isFinite(g)){if(!h){var v=e*e,y=v*e;u=2*y-3*v+1,c=y-2*v+e,_=y-v,d=-2*y+3*v,h=!0}n[f]=u*r[f]+c*m*i+_*g*i+d*o[f]}else n[f]=r[f]}},i._getFullKeyframeIndicesWithCache=function(t){return this._fullKeyframeIndicesCache[t]},i._cacheFullKeyframeIndices=function(t,e){this._fullKeyframeIndicesCache[t]=e},i._getAnimationDataWithCache=function(t,e){var i=this._animationDatasCache[t];return i?i[e]:null},i._cacheAnimationData=function(t,e,i){(this._animationDatasCache[t]||(this._animationDatasCache[t]=[]))[e]=i},i._getAvatarDataWithCache=function(t,e,i){var n=this._avatarDatasCache[t.id];if(n){var r=n[e];return r?r[i]:null}return null},i._cacheAvatarData=function(t,e,i,n){var r=this._avatarDatasCache[t.id]||(this._avatarDatasCache[t.id]=[]);(r[e]||(r[e]=[]))[i]=n},i._evaluateAnimationlDatasCacheMode=function(t,e,i,n,r){for(var a=0,s=0,o=0,l=r?r.length:this._nodes.length;o<l;o++){var h=r?r[o]:o,u=this._nodes[h],c=u._cacheProperty;if(t[h]){var _,d=e[h],f=d[i.currentFrameIndex],p=0;if(-1!==f){var m=u.keyFrames[f];if(m.next){r&&!c?(_=n[h])||(_=n[h]=new Float32Array(u.keyFrameWidth)):(_=new Float32Array(u.keyFrameWidth),n[o]=_);var g=NaN,v=m.duration;g=0!==v?(i.currentFrameTime-m.startTime)/v:0,this._hermiteInterpolate(m,g,v,_)}else{if(r&&!c)(_=n[h])||(_=n[h]=new Float32Array(u.keyFrameWidth));else{if(-1!==(p=i._lastFrameIndex)&&d[p]===f)continue;_=new Float32Array(u.keyFrameWidth),n[o]=_}var y=m.data;for(a=0,s=_.length;a<s;a++)_[a]=y[a]}}else{if(r&&!c)(_=n[h])||(_=n[h]=new Float32Array(u.keyFrameWidth));else{if(-1!==(p=i._lastFrameIndex)&&d[p]===f)continue;_=new Float32Array(u.keyFrameWidth),n[o]=_}var x=u.keyFrames[0].data;for(a=0,s=_.length;a<s;a++)_[a]=x[a]}}}},i._evaluateAnimationlDatasRealTime=function(t,e,i,n){var r=0,a=0,s=this._nodes;if(!this._realTimeCurrentFrameIndexes){for(this._realTimeCurrentFrameIndexes=new Int32Array(s.length),r=0,a=s.length;r<a;r++)this._realTimeCurrentFrameIndexes[r]=-1;this._realTimeCurrentTimes=new Float32Array(s.length)}for(r=0,a=n?n.length:this._nodes.length;r<a;r++){var o=n?n[r]:r,l=s[o];e<this._realTimeCurrentTimes[o]&&(this._realTimeCurrentFrameIndexes[o]=-1),this._realTimeCurrentTimes[o]=e;for(var h=this._realTimeCurrentFrameIndexes[o]+1,u=l.keyFrames,c=u.length;h<c;){if(u[h].startTime>e){this._realTimeCurrentFrameIndexes[o]=h-1;break}h++}h===c&&(this._realTimeCurrentFrameIndexes[o]=c-1);var _=0,d=0,f=i[o];f||(f=i[o]=new Float32Array(l.keyFrameWidth));var p=u[this._realTimeCurrentFrameIndexes[o]];if(p){if(p.next){var m=p.duration,g=NaN;g=0!==m?(e-p.startTime)/m:0,this._hermiteInterpolate(p,g,m,f)}else{var v=p.data;for(_=0,d=f.length;_<d;_++)f[_]=v[_]}}else{var y=l.keyFrames[0].data;for(_=0,d=f.length;_<d;_++)f[_]=y[_]}var x=t[o];x&&(n?H._propertySetFuncs[l.propertyNameID](x,null,f):H._propertySetFuncs[l.propertyNameID](null,x,f))}},i._binarySearchEventIndex=function(t){for(var e=0,i=this._animationEvents.length-1,n=0;e<=i;){n=Math.floor((e+i)/2);var r=this._animationEvents[n].time;if(r==t)return n;t<r?i=n-1:e=n+1}return e},i.addEvent=function(t){var e=this._binarySearchEventIndex(t.time);this._animationEvents.splice(e,0,t)},i.onAsynLoaded=function(t,e,i){var n=new x(e);switch(this._version=n.readUTFString(),this._version){case"LAYAANIMATION:01":O.parse(this,n);break;case"LAYAANIMATION:02":P.parse(this,n)}this.completeCreate(),this._endLoaded()},i.disposeResource=function(){this._realTimeCurrentFrameIndexes=null,this._realTimeCurrentTimes=null,this._fullKeyframeIndicesCache=null,this._animationDatasCache=null,this._avatarDatasCache=null,this._skinnedDatasCache=null,this._version=null,this._nodes=null,this._nodesMap=null,this._cachePropertyMap=null,this._nodeToCachePropertyMap=null,this._unCachePropertyMap=null,this._publicClipDatas=null},e.load=function(t){return S.loader.create(t,null,null,e)},e}(),pi=function(t){function e(){e.__super.call(this)}m(e,"laya.d3.core.Avatar",v);var i=e.prototype;return S.imps(i,{"laya.d3.core.IClone":!0}),i._initCloneToAnimator=function(t,e){e._avatarNodeMap[t.name]=t,e._avatarNodes.push(t);for(var i=0,n=t.getChildCount();i<n;i++)this._initCloneToAnimator(t.getChildByIndex(i),e)},i._parseNode=function(t,e){var i=t.props.name;if(e.name=i,e._parent){var n=t.customProps,r=e.transform;r._localRotationEuler=new Float32Array(3),r.setLocalPosition(new Float32Array(n.translate)),r.setLocalRotation(new Float32Array(n.rotation)),r.setLocalScale(new Float32Array(n.scale)),r._setWorldMatrixAndUpdate(new Float32Array(16))}for(var a=t.child,s=0,o=a.length;s<o;s++){var l=a[s],h=new H;e.addChild(h),this._parseNode(l,h)}},i.onAsynLoaded=function(t,e,i){if(this._rootNode=new H,e.version){this._version=e.version;var n=e.rootNode;n&&this._parseNode(n,this._rootNode)}else this._parseNode(e,this._rootNode);this._endLoaded()},i._cloneDatasToAnimator=function(t){var e=this._rootNode.clone();e.transform._setWorldMatrixIgnoreUpdate(null);t._avatarNodeMap={},t._avatarNodes=[],this._initCloneToAnimator(e,t)},i.cloneTo=function(t){var e=t,i=this._rootNode.clone();e._rootNode=i},i.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e.load=function(t){return S.loader.create(t,null,null,e)},e}(),mi=function(n){function t(){t.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new ke,this._values=[],this.renderQueue=1,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new Pe(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}m(t,"laya.d3.core.material.BaseMaterial",n);var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e._addShaderDefine=function(t){this._shaderDefineValue|=t},e._removeShaderDefine=function(t){this._shaderDefineValue&=~t},e._addDisablePublicShaderDefine=function(t){this._disablePublicShaderDefine|=t},e._removeDisablePublicShaderDefine=function(t){this._disablePublicShaderDefine&=~t},e._setBuffer=function(t,e){this._shaderValues.setValue(t,e),this._values[t]=e},e._getBuffer=function(t){return this._values[t]},e._setMatrix4x4=function(t,e){this._shaderValues.setValue(t,e?e.elements:null),this._values[t]=e},e._getMatrix4x4=function(t){return this._values[t]},e._setInt=function(t,e){this._shaderValues.setValue(t,e),this._values[t]=e},e._getInt=function(t){return this._values[t]},e._setNumber=function(t,e){this._shaderValues.setValue(t,e),this._values[t]=e},e._getNumber=function(t){return this._values[t]},e._setBool=function(t,e){this._shaderValues.setValue(t,e),this._values[t]=e},e._getBool=function(t){return this._values[t]},e._setVector2=function(t,e){this._shaderValues.setValue(t,e?e.elements:null),this._values[t]=e},e._getVector2=function(t){return this._values[t]},e._setColor=function(t,e){this._shaderValues.setValue(t,e?e.elements:null),this._values[t]=e},e._getColor=function(t){return this._values[t]},e._setTexture=function(t,e){var i=this._values[t];this._values[t]=e,this._shaderValues.setValue(t,e),0<this.referenceCount&&(i&&i._removeReference(),e&&e._addReference())},e._getTexture=function(t){return this._values[t]},e._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},e._getShader=function(t,e,i){var n=(t|e)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile(n,i,this._shaderDefineValue),this._shader},e._setRenderStateBlendDepth=function(){var t=R.mainContext;switch(L.setDepthMask(t,this.depthWrite),0===this.depthTest?L.setDepthTest(t,!1):(L.setDepthTest(t,!0),L.setDepthFunc(t,this.depthTest)),this.blend){case 0:L.setBlend(t,!1);break;case 1:L.setBlend(t,!0),L.setBlendFunc(t,this.srcBlend,this.dstBlend);break;case 2:L.setBlend(t,!0)}},e._setRenderStateFrontFace=function(t,e){var i=R.mainContext,n=0;switch(this.cull){case 0:L.setCullFace(i,!1);break;case 1:L.setCullFace(i,!0),n=t?e&&e._isFrontFaceInvert?2305:2304:e&&e._isFrontFaceInvert?2304:2305,L.setFrontFace(i,n);break;case 2:L.setCullFace(i,!0),n=t?e&&e._isFrontFaceInvert?2304:2305:e&&e._isFrontFaceInvert?2305:2304,L.setFrontFace(i,n)}},e.onAsynLoaded=function(t,e,i){var n=e[0],r=e[1];switch(n.version){case"LAYAMATERIAL:01":var a=0,s=0,o=n.props;for(var l in o)switch(l){case"vectors":var h=o[l];for(a=0,s=h.length;a<s;a++){var u=h[a],c=u.value;switch(c.length){case 2:this[u.name]=new Le(c[0],c[1]);break;case 3:this[u.name]=new Oe(c[0],c[1],c[2]);break;case 4:this[u.name]=new Pe(c[0],c[1],c[2],c[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var _=o[l];for(a=0,s=_.length;a<s;a++){var d=_[a],f=d.path;f&&(this[d.name]=Dt.getRes(r[f]))}break;case"defines":var p=o[l];for(a=0,s=p.length;a<s;a++){var m=this._shaderCompile.getMaterialDefineByName(p[a]);this._addShaderDefine(m)}break;default:this[l]=o[l]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},e._addReference=function(){n.prototype._addReference.call(this);for(var t=0,e=this._values.length;t<e;t++){var i=this._values[t];i&&i instanceof laya.d3.resource.BaseTexture&&i._addReference()}},e._removeReference=function(){n.prototype._removeReference.call(this);for(var t=0,e=this._values.length;t<e;t++){var i=this._values[t];i&&i instanceof laya.d3.resource.BaseTexture&&i._removeReference()}},e.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null;for(var t=0,e=this._values.length;t<e;t++){var i=this._values[t];i&&i instanceof laya.d3.resource.BaseTexture&&i._removeReference()}this._values=null},e.setShaderName=function(t){var e=Fi.nameKey.getID(t);if(-1===e)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=ui._preCompileShader[e]},e.cloneTo=function(t){var e=t;e.name=this.name,e.cull=this.cull,e.blend=this.blend,e.srcBlend=this.srcBlend,e.dstBlend=this.dstBlend,e.srcBlendRGB=this.srcBlendRGB,e.dstBlendRGB=this.dstBlendRGB,e.srcBlendAlpha=this.srcBlendAlpha,e.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo(e.blendConstColor),e.blendEquation=this.blendEquation,e.blendEquationRGB=this.blendEquationRGB,e.blendEquationAlpha=this.blendEquationAlpha,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.renderQueue=this.renderQueue,e._shader=this._shader,e._disablePublicShaderDefine=this._disablePublicShaderDefine,e._shaderDefineValue=this._shaderDefineValue;var i,n=0,r=e._shaderValues;e._shaderValues.data.length=this._shaderValues.data.length;var a=this._values.length,s=e._values;for(n=0,i=s.length=a;n<i;n++){var o=this._values[n];if(o)if("number"==typeof o)s[n]=o,r.data[n]=o;else if("number"==typeof o&&Math.floor(o)==o)s[n]=o,r.data[n]=o;else if("boolean"==typeof o)s[n]=o,r.data[n]=o;else if(o instanceof laya.d3.math.Vector2){var l=s[n]||(s[n]=new Le);o.cloneTo(l),r.data[n]=l.elements}else if(o instanceof laya.d3.math.Vector3){var h=s[n]||(s[n]=new Oe);o.cloneTo(h),r.data[n]=h.elements}else if(o instanceof laya.d3.math.Vector4){var u=s[n]||(s[n]=new Pe);o.cloneTo(u),r.data[n]=u.elements}else if(o instanceof laya.d3.math.Matrix4x4){var c=s[n]||(s[n]=new De);o.cloneTo(c),r.data[n]=c.elements}else o instanceof laya.d3.resource.BaseTexture&&(s[n]=o,r.data[n]=o)}},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},_(0,e,"alphaTestValue",function(){return this._getNumber(0)},function(t){this._setNumber(0,t)}),_(0,e,"alphaTest",function(){return this._alphaTest},function(t){(this._alphaTest=t)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),t.__init__=function(){t.SHADERDEFINE_ALPHATEST=t.shaderDefines.registerDefine("ALPHATEST")},t.CULL_NONE=0,t.CULL_FRONT=1,t.CULL_BACK=2,t.BLEND_DISABLE=0,t.BLEND_ENABLE_ALL=1,t.BLEND_ENABLE_SEPERATE=2,t.BLENDPARAM_ZERO=0,t.BLENDPARAM_ONE=1,t.BLENDPARAM_SRC_COLOR=768,t.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,t.BLENDPARAM_DST_COLOR=774,t.BLENDPARAM_ONE_MINUS_DST_COLOR=775,t.BLENDPARAM_SRC_ALPHA=770,t.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,t.BLENDPARAM_DST_ALPHA=772,t.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,t.BLENDPARAM_SRC_ALPHA_SATURATE=776,t.BLENDEQUATION_ADD=0,t.BLENDEQUATION_SUBTRACT=1,t.BLENDEQUATION_REVERSE_SUBTRACT=2,t.DEPTHTEST_OFF=0,t.DEPTHTEST_NEVER=512,t.DEPTHTEST_LESS=513,t.DEPTHTEST_EQUAL=514,t.DEPTHTEST_LEQUAL=515,t.DEPTHTEST_GREATER=516,t.DEPTHTEST_NOTEQUAL=517,t.DEPTHTEST_GEQUAL=518,t.DEPTHTEST_ALWAYS=519,t.SHADERDEFINE_ALPHATEST=1,t.ALPHATESTVALUE=0,c(t,["shaderDefines",function(){return this.shaderDefines=new Be}]),t}(v),gi=function(t){function e(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,e.__super.call(this),this._conchTexture,f.isConchNode&&(this._conchTexture=new ConchTexture),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}m(e,"laya.d3.resource.BaseTexture",v);var i=e.prototype;return _(0,i,"width",function(){return this._width}),_(0,i,"format",function(){return this._format}),_(0,i,"repeat",function(){return this._repeat},function(t){if(this._repeat!==t&&(this._repeat=t,this._source)){var e=R.mainContext;L.bindTexture(e,this._type,this._source),p.isPOT(this._width,this._height)&&this._repeat?(e.texParameteri(this._type,10242,10497),e.texParameteri(this._type,10243,10497)):(e.texParameteri(this._type,10242,33071),e.texParameteri(this._type,10243,33071))}}),_(0,i,"height",function(){return this._height}),_(0,i,"magFifter",function(){return this._magFifter},function(t){(this._magFifter=t)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter(t)}),_(0,i,"size",function(){return this._size}),_(0,i,"mipmap",function(){return this._mipmap},function(t){this._mipmap=t,this._mipmap!=t&&this._conchTexture&&this._conchTexture.setMipMap(t)}),_(0,i,"minFifter",function(){return this._minFifter},function(t){this._minFifter=t,this._minFifter!=t&&this._conchTexture&&this._conchTexture.setMinFifter(t)}),_(0,i,"source",function(){return this.activeResource(),this._source}),_(0,i,"defaulteTexture",function(){return sn.grayTexture}),e}(),vi=function(t){function e(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,e.__super.call(this),this._boundingBoxCorners=w(8,null)}m(e,"laya.d3.resource.models.BaseMesh",v);var i=e.prototype;return i._getPositions=function(){throw new Error("未Override,请重载该属性！")},i._generateBoundingObject=function(){this._boundingSphere=new Te(new Oe,0),Te.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new xe(new Oe,new Oe),xe.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},i.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},i.getRenderElement=function(t){throw new Error("未Override,请重载该属性！")},_(0,i,"subMeshCount",function(){return this._subMeshCount}),_(0,i,"boundingBox",function(){return this._boundingBox}),_(0,i,"boundingBoxCorners",function(){return this._boundingBoxCorners}),_(0,i,"boundingSphere",function(){return this._boundingSphere}),e}(),yi=function(t){function a(){this._terrainHeightData=null,this._width=0,this._height=0,this._bitType=0,this._value=NaN,a.__super.call(this)}return m(a,"laya.d3.terrain.TerrainHeightData",v),a.prototype.onAsynLoaded=function(t,e,i){var n;this._width=i[0],this._height=i[1],this._bitType=i[2],this._value=i[3];var r=NaN;8==this._bitType?(n=new Uint8Array(e),r=1/255):16==this._bitType&&(n=new Int16Array(e),r=1/32766),this._terrainHeightData=new Float32Array(this._height*this._width);for(var a=0,s=this._height*this._width;a<s;a++)this._terrainHeightData[a]=n[a]*r*this._value/2;this._endLoaded()},a.load=function(t,e,i,n,r){return S.loader.create(t,null,null,a,[e,i,n,r],1,!1)},a}(),xi=function(t){function e(){this._version=NaN,this._cameraCoordinateInverse=!1,this._gridSize=NaN,this._chunkNumX=0,this._chunkNumZ=0,this._heightDataX=0,this._heightDataZ=0,this._heightDataBitType=0,this._heightDataValue=NaN,this._heightDataUrl=null,this._detailTextureInfos=null,this._chunkInfos=null,this._heightData=null,this._materialInfo=null,this._alphaMaps=null,this._normalMaps=null,e.__super.call(this)}m(e,"laya.d3.terrain.TerrainRes",v);var i=e.prototype;return i.parseData=function(t){var e=t[0],i=t[1];if(this._version=e.version,1==this._version){this._cameraCoordinateInverse=e.cameraCoordinateInverse,this._gridSize=e.gridSize,this._chunkNumX=e.chunkNumX,this._chunkNumZ=e.chunkNumZ;var n=e.heightData;if(this._heightDataX=n.numX,this._heightDataZ=n.numZ,this._heightDataBitType=n.bitType,this._heightDataValue=n.value,this._heightDataUrl=i[n.url],this._materialInfo=new Xe,e.material){var r=e.material.ambient,a=e.material.diffuse,s=e.material.specular;this._materialInfo.ambientColor=new Oe(r[0],r[1],r[2]),this._materialInfo.diffuseColor=new Oe(a[0],a[1],a[2]),this._materialInfo.specularColor=new Pe(s[0],s[1],s[2],s[3])}var o=e.detailTexture;this._detailTextureInfos=w(o.length);for(var l=0;l<o.length;l++){var h=o[l],u=new We;u.diffuseTexture=i[h.diffuse],u.normalTexture=h.normal?i[h.normal]:null,h.scale?u.scale=new Le(h.scale[0],h.scale[1]):u.scale=new Le(1,1),h.offset?u.offset=new Le(h.offset[0],h.offset[1]):u.offset=new Le(0,0),this._detailTextureInfos[l]=u}var c=e.alphaMap;for(this._alphaMaps=w(c.length),l=0;l<this._alphaMaps.length;l++)this._alphaMaps[l]=e.alphaMap[l];var _=e.normalMap;for(this._normalMaps=w(_.length),l=0;l<this._normalMaps.length;l++)this._normalMaps[l]=e.normalMap[l];var d=e.chunkInfo;if(this._chunkNumX*this._chunkNumZ!=d.length)return alert("terrain data error"),!1;for(this._chunkInfos=w(d.length),l=0;l<d.length;l++){var f=d[l],p=new Ge,m=f.alphaMap.length,g=f.detailID.length;if(m!=g)return alert("terrain chunk data error"),!1;p.alphaMap=w(m),p.detailID=w(g),p.normalMap=i[this._normalMaps[f.normalMap]];for(var v=0;v<m;v++){p.alphaMap[v]=i[this._alphaMaps[f.alphaMap[v]]];var y=f.detailID[v],x=y.length;p.detailID[v]=new Uint8Array(x);for(var E=0;E<x;E++)p.detailID[v][E]=y[E]}this._chunkInfos[l]=p}this._heightData=Dt.getRes(this._heightDataUrl),this.onLoadTerrainComplete(this._heightData)}return!0},i.onLoadTerrainComplete=function(t){this._endLoaded()},i.onAsynLoaded=function(t,e,i){this.parseData(e)},e.load=function(t){return S.loader.create(t,null,null,e,null,1,!1)},e}(),Ei=function(e){function t(){this._player=null,this._templet=null,t.__super.call(this),this._player=new n}m(t,"laya.d3.component.animation.KeyframeAnimations",e);var i=t.prototype;return i._updateAnimtionPlayer=function(){this._player._update(S.timer.delta)},i._addUpdatePlayerToTimer=function(){S.timer.frameLoop(1,this,this._updateAnimtionPlayer)},i._removeUpdatePlayerToTimer=function(){S.timer.clear(this,this._updateAnimtionPlayer)},i._onOwnerActiveHierarchyChanged=function(t){this._owner.displayedInStage&&(t?this._addUpdatePlayerToTimer():this._removeUpdatePlayerToTimer())},i._load=function(t){t.activeInHierarchy&&this._addUpdatePlayerToTimer(),t.on("activeinhierarchychanged",this,this._onOwnerActiveHierarchyChanged)},i._unload=function(t){e.prototype._unload.call(this,t),t.activeInHierarchy&&this._removeUpdatePlayerToTimer(),t.off("activeinhierarchychanged",this,this._onOwnerActiveHierarchyChanged),this._player._destroy(),this._player=null,this._templet=null},_(0,i,"url",null,function(t){console.log("Warning: discard property,please use templet property instead.");var e=S.loader.create(t,null,null,r);this._templet!==e&&(0!==this._player.state&&this._player.stop(!0),this._templet=e,this._player.templet=e,this.event("animationchanged",this))}),_(0,i,"player",function(){return this._player}),_(0,i,"templet",function(){return this._templet},function(t){this._templet!==t&&(0!==this._player.state&&this._player.stop(!0),this._templet=t,this._player.templet=t,this.event("animationchanged",this))}),_(0,i,"currentFrameIndex",function(){return this._player.currentKeyframeIndex}),_(0,i,"currentAnimationClipIndex",function(){return this._player.currentAnimationClipIndex}),_(0,i,"nodeCount",function(){return this._templet.getNodeCount(this._player.currentAnimationClipIndex)}),t}($e),Ti=function(i){function u(){u.__super.call(this),this._clipNames=[],this._clips=[],this._playStartFrames=[],this._playEndFrames=[],this._cacheNodesSpriteOwners=[],this._cacheNodesAvatarOwners=[],this._cacheNodesDefaultlValues=[],this._cacheNodesToSpriteMap=[],this._cacheSpriteToNodesMap=[],this._cacheFullFrames=[],this._publicClipsDatas=[],this._playEventIndex=-1,this._updateTransformPropertyLoopCount=-1,this._lastFrameIndex=-1,this._defaultClipIndex=-1,this._cachePlayRate=1,this._currentPlayClip=null,this._currentFrameIndex=-1,this._currentTime=0,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this.isCache=!0,this.cacheFrameRate=60,this.playbackRate=1,this.playOnWake=!0}m(u,"laya.d3.component.Animator",i);var t=u.prototype;return S.imps(t,{"laya.resource.IDestroy":!0}),t._getAvatarOwnersByClip=function(t){var e=this._clips[t]._nodes,i=e.length,n=this._cacheNodesAvatarOwners[t];n.length=i;var r=this._cacheNodesDefaultlValues[t];r.length=i;for(var a=0;a<i;a++){for(var s=this._avatarNodes[0],o=e[a],l=o.path,h=0,u=l.length;h<u;h++){var c=l[h];if(""===c)break;if(!(s=s.getChildByName(c)))break}if(s){n[a]=s;var _=H._propertyGetFuncs[o.propertyNameID](s);if(_){var d=new Float32Array(o.keyFrameWidth);for(r[a]=d,h=0,u=_.length;h<u;h++)d[h]=_[h]}}}},t._handleSpriteOwnersByClip=function(t){var e=this._clips[t]._nodes,i=e.length,n=this._cacheNodesSpriteOwners[t];n.length=i;var r=this._cacheNodesDefaultlValues[t];r.length=i;for(var a=0;a<i;a++){var s=this._owner,o=e[a],l=o.path,h=0,u=0;for(h=0,u=l.length;h<u;h++){var c=l[h];if(""===c)break;if(!(s=s.getChildByName(c)))break}if(s){n[a]=s;var _=H._propertyGetFuncs[o.propertyNameID](null,s);if(_){var d=new Float32Array(o.keyFrameWidth);for(r[a]=d,h=0,u=_.length;h<u;h++)d[h]=_[h]}}}},t._offClipAndAvatarRelateEvent=function(t,e){t.loaded?e.loaded||e.off("loaded",this,this._getAvatarOwnersByClip):t.off("loaded",this,this._getAvatarOwnersAndInitDatasAsync)},t._getAvatarOwnersByClipAsync=function(t,e){e.loaded?this._getAvatarOwnersByClip(t):e.once("loaded",this,this._getAvatarOwnersByClip,[t])},t._offGetSpriteOwnersByClipAsyncEvent=function(t){t.loaded||t.off("loaded",this,this._getSpriteOwnersByClipAsync)},t._getSpriteOwnersByClipAsync=function(t,e){e.loaded?this._handleSpriteOwnersByClip(t):e.once("loaded",this,this._handleSpriteOwnersByClip,[t])},t._getAvatarOwnersAndInitDatasAsync=function(){for(var t=0,e=this._clips.length;t<e;t++)this._getAvatarOwnersByClipAsync(t,this._clips[t]);for(this._avatar._cloneDatasToAnimator(this),t=0,e=this._avatarNodes.length;t<e;t++)this._checkAnimationNode(this._avatarNodes[t],this._owner)},t._offGetClipCacheFullKeyframeIndicesEvent=function(t){t.loaded||t.off("loaded",this,this._computeCacheFullKeyframeIndices)},t._computeCacheFullKeyframeIndices=function(t){var e=this._clips[t],i=this._cacheFrameRateInterval*this._cachePlayRate,n=e._getFullKeyframeIndicesWithCache(i);if(n)this._cacheFullFrames[t]=n;else{n=this._cacheFullFrames[t]=[];var r=e._nodes,a=r.length;n.length=a;for(var s=Math.ceil(e._duration/i-1e-5)+1,o=0;o<a;o++){var l=r[o],h=new Int32Array(s);h.fill(-1);for(var u=l.keyFrames,c=0,_=u.length;c<_;c++)for(var d=u[c],f=d.startTime,p=f+d.duration;f<=p;){h[Math.ceil(f/i-1e-5)]=c,f+=i}n[o]=h}e._cacheFullKeyframeIndices(i,n)}},t._updateAnimtionPlayer=function(){this._updatePlayer(S.timer.delta/1e3)},t._onOwnerActiveHierarchyChanged=function(){this._owner.activeInHierarchy?(S.timer.frameLoop(1,this,this._updateAnimtionPlayer),this.playOnWake&&this.clip&&this.play()):(0!==this.playState&&(this._stoped=!0),S.timer.clear(this,this._updateAnimtionPlayer))},t._eventScript=function(t,e){for(var i=this._currentPlayClip._animationEvents,n=i.length;this._playEventIndex<n;this._playEventIndex++){var r=i[this._playEventIndex],a=r.time;if(!(t<=a&&a<e))break;for(var s=this._owner._scripts,o=0,l=s.length;o<l;o++){var h=s[o],u=h[r.eventName];u&&u.apply(h,r.params)}}},t._setPlayParams=function(t,e){var i=this._currentTime;this._currentTime=t,this._currentFrameIndex=Math.max(Math.floor(this.currentPlayTime/e-1e-5),0),this._currentFrameTime=this._currentFrameIndex*e,this._eventScript(i,t)},t._setPlayParamsWhenStop=function(t,e){var i=this._currentTime;this._currentTime=t,this._currentFrameIndex=Math.max(Math.floor(t/e-1e-5),0),this._currentFrameTime=this._currentFrameIndex*e,this._eventScript(i,t),this._currentPlayClip=null},t._revertKeyframeNodes=function(t,e){var i=this._cacheNodesDefaultlValues[e],n=t._nodes;if(this._avatar)for(var r=this._cacheNodesAvatarOwners[e],a=0,s=r.length;a<s;a++){var o=r[a];o&&H._propertySetFuncs[n[a].propertyNameID](o,null,i[a])}else{var l=this._cacheNodesSpriteOwners[e];for(a=0,s=l.length;a<s;a++){var h=l[a];h&&H._propertySetFuncs[n[a].propertyNameID](null,h,i[a])}}},t._onAnimationStop=function(){var t,e,i,n=0,r=0;this._lastFrameIndex=-1;var a=this._currentPlayClip._nodes;if(this._avatar){var s=this._cacheNodesAvatarOwners[this._currentPlayClipIndex];for(n=0,r=s.length;n<r;n++){var o=s[n];i=(e=(t=a[n]).keyFrames)[e.length-1].data,o&&H._propertySetFuncs[t.propertyNameID](o,null,i)}}else{var l=this._cacheNodesSpriteOwners[this._currentPlayClipIndex];for(n=0,r=l.length;n<r;n++){var h=l[n];i=(e=(t=a[n]).keyFrames)[e.length-1].data,h&&H._propertySetFuncs[t.propertyNameID](null,h,i)}}},t._setAnimationClipPropertyToAnimationNode=function(t,e,i){for(var n=0,r=e.length;n<r;n++){var a=e[n],s=t[a];if(s){var o=this._currentPlayClip._nodes[a],l=i[a];l&&H._propertySetFuncs[o.propertyNameID](s,null,l)}}},t._setAnimationClipPropertyToSprite3D=function(t,e){for(var i=0,n=t.length;i<n;i++){var r=t[i];if(r){var a=this._currentPlayClip._nodes[i],s=e[i];s&&H._propertySetFuncs[a.propertyNameID](null,r,s)}}},t._handleSpriteOwnersBySprite=function(t,e,i,n){var r=this._clips[t],a=i.join("/"),s=r._nodesMap[a];if(s)for(var o=this._cacheNodesSpriteOwners[t],l=r._nodes,h=this._cacheNodesDefaultlValues[t],u=0,c=s.length;u<c;u++){var _=s[u],d=l.indexOf(_);if(e){o[d]=n;var f=H._propertyGetFuncs[_.propertyNameID](null,n);if(f){var p=h[d];p||(h[d]=p=new Float32Array(_.keyFrameWidth));for(var m=0,g=f.length;m<g;m++)p[m]=f[m]}}else o[d]=null}},t._evaluateAvatarNodesCacheMode=function(t,e,i,n,r){e._evaluateAnimationlDatasCacheMode(t,this._cacheFullFrames[this._currentPlayClipIndex],this,i,r),this._setAnimationClipPropertyToAnimationNode(t,r,i);for(var a=0,s=this._avatarNodes.length;a<s;a++){var o=this._avatarNodes[a].transform;if(o._worldUpdate){var l=new Float32Array(16);n[a]=l,o._setWorldMatrixAndUpdate(l)}else{var h=o.getWorldMatrix();n[a]=h||u.deafaultMatrix}}},t._evaluateAvatarNodesRealTime=function(t,e,i,n,r){e._evaluateAnimationlDatasRealTime(t,this.currentPlayTime,i,r),this._setAnimationClipPropertyToAnimationNode(t,r,i);for(var a=0,s=this._avatarNodes.length;a<s;a++){var o=this._avatarNodes[a].transform;o._worldUpdate?o._setWorldMatrixNoUpdate(n[a]):n[a]=u.deafaultMatrix}},t._updateAvatarNodesToSpriteCacheMode=function(t,e){for(var i=0,n=this._cacheSpriteToNodesMap.length;i<n;i++){var r=this._cacheSpriteToNodesMap[i],a=e[r];if(a!==u.deafaultMatrix){var s=this._avatarNodes[r].transform._entity,o=s.worldMatrix;qe.matrix4x4MultiplyMFM(this._owner._transform.worldMatrix,a,o),s.worldMatrix=o}}},t._updateAvatarNodesToSpriteRealTime=function(){for(var t=0,e=this._cacheSpriteToNodesMap.length;t<e;t++){var i=this._avatarNodes[this._cacheSpriteToNodesMap[t]],n=i.transform._entity,r=i.transform;if(r._worldUpdate){var a=u._tempMatrix4x40;r._setWorldMatrixAndUpdate(a);var s=n.worldMatrix;qe.matrix4x4MultiplyMFM(this._owner._transform.worldMatrix,a,s),n.worldMatrix=s}}},t._updatePlayer=function(t){if(null!=this._currentPlayClip&&!this._stoped&&this._currentPlayClip.loaded){var e=this._cacheFrameRateInterval*this._cachePlayRate,i=0;this._startUpdateLoopCount!==M.loopCount&&(i=t*this.playbackRate,this._elapsedPlaybackTime+=i);var n=this._currentPlayClip._frameRate,r=this._playStartFrames[this._currentPlayClipIndex]/n,a=Math.min(this._playEndFrames[this._currentPlayClipIndex]/n,this._currentPlayClip._duration)-r;if(!this._currentPlayClip.islooping&&this._elapsedPlaybackTime>=a)return this._onAnimationStop(),this._setPlayParamsWhenStop(a,e),void this.event("stopped");if(i+=this._currentTime,0<a)if(a<=i)for(;(i-=a)<a&&(this._setPlayParams(i,e),this.event("complete")),this._playEventIndex=0,this._eventScript(0,i),a<=i;);else this._setPlayParams(i,e);else this._currentTime=this._currentFrameTime=this._currentFrameIndex=this._playEventIndex=0,this.event("complete")}},t._update=function(t){var e=this._currentPlayClip;if(2===this.playState&&e&&e.loaded){var i=this.playbackRate*S.timer.scale,n=this._cachePlayRate;this._canCache=this.isCache&&n<=i;var r,a=-1;if(this._canCache){if(a=this._currentFrameIndex,this._lastFrameIndex===a)return;if(r=e._getAnimationDataWithCache(n,a),this._avatar){var s=this._cacheNodesAvatarOwners[this._currentPlayClipIndex],o=e._cachePropertyMap,l=o.length;0<l&&(r||((r=[]).length=l,e._cacheAnimationData(n,a,r),e._evaluateAnimationlDatasCacheMode(s,this._cacheFullFrames[this._currentPlayClipIndex],this,r,o)),this._setAnimationClipPropertyToAnimationNode(s,o,r)),this._curAvatarNodeDatas=e._getAvatarDataWithCache(this._avatar,this._cachePlayRate,a),this._curAvatarNodeDatas||(this._curAvatarNodeDatas=[],this._curAvatarNodeDatas.length=this._avatarNodes.length,e._cacheAvatarData(this._avatar,this._cachePlayRate,a,this._curAvatarNodeDatas),this._evaluateAvatarNodesCacheMode(s,e,e._publicClipDatas,this._curAvatarNodeDatas,e._unCachePropertyMap)),this._updateAvatarNodesToSpriteCacheMode(e,this._curAvatarNodeDatas)}else{var h=this._cacheNodesSpriteOwners[this._currentPlayClipIndex];r||((r=[]).length=this._currentPlayClip._nodes.length,e._evaluateAnimationlDatasCacheMode(h,this._cacheFullFrames[this._currentPlayClipIndex],this,r,null),e._cacheAnimationData(n,a,r)),this._setAnimationClipPropertyToSprite3D(h,r)}}else if(r=e._publicClipDatas,this._avatar){if(e._evaluateAnimationlDatasRealTime(this._cacheNodesAvatarOwners[this._currentPlayClipIndex],this.currentPlayTime,r,e._cachePropertyMap),!this._publicAvatarNodeDatas){this._publicAvatarNodeDatas=[];var u=this._avatarNodes.length;this._publicAvatarNodeDatas.length=u;for(var c=1;c<u;c++)this._publicAvatarNodeDatas[c]=new Float32Array(16)}this._curAvatarNodeDatas=this._publicAvatarNodeDatas,this._evaluateAvatarNodesRealTime(this._cacheNodesAvatarOwners[this._currentPlayClipIndex],e,r,this._curAvatarNodeDatas,e._unCachePropertyMap),this._updateAvatarNodesToSpriteRealTime()}else e._evaluateAnimationlDatasRealTime(this._cacheNodesSpriteOwners[this._currentPlayClipIndex],this.currentPlayTime,r,null);this._lastFrameIndex=a}},t._checkAnimationNode=function(t,e){t.name!==e.name||e._transform.dummy||e._isLinkSpriteToAnimationNode(this,t,!0);for(var i=0,n=e._childs.length;i<n;i++)this._checkAnimationNode(t,e.getChildAt(i))},t._load=function(t){t.activeInHierarchy&&S.timer.frameLoop(1,this,this._updateAnimtionPlayer),this._owner.on("activeinhierarchychanged",this,this._onOwnerActiveHierarchyChanged)},t._unload=function(t){i.prototype._unload.call(this,t),t.activeInHierarchy&&S.timer.clear(this,this._updateAnimtionPlayer),this._owner.off("activeinhierarchychanged",this,this._onOwnerActiveHierarchyChanged),this._curAvatarNodeDatas=null},t._destroy=function(){i.prototype._destroy.call(this);for(var t=0,e=this._clips.length;t<e;t++)this._clips[t]._removeReference();this._currentPlayClip=null,this._clipNames=null,this._cacheNodesSpriteOwners=null,this._cacheNodesAvatarOwners=null,this._cacheNodesDefaultlValues=null,this._clips=null,this._cacheFullFrames=null},t._cloneTo=function(t){var e=t;e.avatar=this.avatar;this._clips.length;for(var i=0,n=this._clips.length;i<n;i++)e.addClip(this._clips[i]);this.clip&&(e.clip=this.clip)},t.addClip=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=4294967295),e=e||t.name;var r=this._clipNames.indexOf(e);if(-1!==r){if(this._clips[r]!==t)throw new Error("Animation:this playName has exist with another clip.")}else{var a=this._clips.indexOf(t);if(i<0||n<0)throw new Error("Animator:startFrame and endFrame must large than zero.");if(n<i)throw new Error("Animator:startFrame must less than endFrame.");this._clipNames.push(e),this._clips.push(t),this._playStartFrames.push(i),this._playEndFrames.push(n),this._cacheNodesSpriteOwners.push([]),this._cacheNodesAvatarOwners.push([]),this._cacheNodesDefaultlValues.push([]),this._publicClipsDatas.push([]),t._addReference(),a=this._clips.length-1,this._avatar?this._avatar.loaded?this._getAvatarOwnersByClipAsync(a,t):this._avatar.once("loaded",this,this._getAvatarOwnersByClipAsync,[a,t]):this._getSpriteOwnersByClipAsync(a,t),t.loaded?this._computeCacheFullKeyframeIndices(a):t.once("loaded",this,this._computeCacheFullKeyframeIndices,[a])}},t.removeClip=function(t){var e=this._clips.indexOf(t);-1!==e&&(this._avatar?this._offClipAndAvatarRelateEvent(this._avatar,t):this._offGetSpriteOwnersByClipAsyncEvent(t),this._offGetClipCacheFullKeyframeIndicesEvent(t),this._clipNames.splice(e,1),this._clips.splice(e,1),this._playStartFrames.splice(e,1),this._playEndFrames.splice(e,1),this._cacheNodesSpriteOwners.splice(e,1),this._cacheNodesAvatarOwners.splice(e,1),this._cacheNodesDefaultlValues.splice(e,1),this._publicClipsDatas.splice(e,1),t._removeReference())},t.removeClipByName=function(t){var e=this._clipNames.indexOf(t);if(-1!==e){var i=this._clips[e];this._avatar?this._offClipAndAvatarRelateEvent(this._avatar,i):this._offGetSpriteOwnersByClipAsyncEvent(i),this._offGetClipCacheFullKeyframeIndicesEvent(i),this._clipNames.splice(e,1),this._clips.splice(e,1),this._playStartFrames.splice(e,1),this._playEndFrames.splice(e,1),this._cacheNodesSpriteOwners.splice(e,1),this._cacheNodesAvatarOwners.splice(e,1),this._cacheNodesDefaultlValues.splice(e,1),this._publicClipsDatas.splice(e,1)}},t.getClip=function(t){var e=this._clipNames.indexOf(t);return-1!==e?this._clips[e]:null},t.getClipCount=function(){return this._clips.length},t.play=function(t,e){if(void 0===e&&(e=1),!t&&-1==this._defaultClipIndex)throw new Error("Animator:must have  default clip value,please set clip property.");this._currentPlayClip=t?(this._currentPlayClipIndex=this._clipNames.indexOf(t),this._clips[this._currentPlayClipIndex]):(this._currentPlayClipIndex=this._defaultClipIndex,this._clips[this._defaultClipIndex]),this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this._playEventIndex=0,this.playbackRate=e,this._stoped=!1,this._currentFrameIndex=0,this._startUpdateLoopCount=M.loopCount,this._lastPlayAnimationClip&&this._lastPlayAnimationClip!==this._currentPlayClip&&this._revertKeyframeNodes(this._lastPlayAnimationClip,this._lastPlayAnimationClipIndex),this._updatePlayer(0),this._lastPlayAnimationClip=this._currentPlayClip,this._lastPlayAnimationClipIndex=this._currentPlayClipIndex},t.stop=function(){0!==this.playState&&(this._stoped=!0,this.event("stopped"))},t.linkSprite3DToAvatarNode=function(t,e){if(this._avatar){var i=this._avatarNodeMap[t];return!!i&&(e._isLinkSpriteToAnimationNode(this,i,!0),!0)}return!1},t.unLinkSprite3DToAvatarNode=function(t){if(this._avatar){var e=t.transform.dummy;if(e){var i=this._avatarNodeMap[e._owner.name];return t._isLinkSpriteToAnimationNode(this,i,!1),!0}return!1}return!1},_(0,t,"playState",function(){return null==this._currentPlayClip?0:this._stoped?0:2}),_(0,t,"avatar",function(){return this._avatar},function(t){if(this._avatar!==t){var e=this._avatar;this._avatar=t;for(var i=this._clips.length,n=0;n<i;n++)this._offClipAndAvatarRelateEvent(e,this._clips[n]);t&&(t.loaded?this._getAvatarOwnersAndInitDatasAsync():t.once("loaded",this,this._getAvatarOwnersAndInitDatasAsync))}}),_(0,t,"cacheFrameRate",function(){return this._cacheFrameRate},function(t){if(this._cacheFrameRate!==t){this._cacheFrameRate=t,this._cacheFrameRateInterval=1/this._cacheFrameRate;for(var e=0,i=this._clips.length;e<i;e++)this._clips[e].loaded&&this._computeCacheFullKeyframeIndices(e)}}),_(0,t,"clip",function(){return this._clips[this._defaultClipIndex]},function(t){var e=t?this._clips.indexOf(t):-1;this._defaultClipIndex!==e&&(-1!==this._defaultClipIndex&&this.removeClip(this._clips[this._defaultClipIndex]),-1!==e&&this.addClip(t,t.name),this._defaultClipIndex=e)}),_(0,t,"currentFrameIndex",function(){return this._currentFrameIndex}),_(0,t,"cachePlayRate",function(){return this._cachePlayRate},function(t){if(this._cachePlayRate!==t){this._cachePlayRate=t;for(var e=0,i=this._clips.length;e<i;e++)this._clips[e].loaded&&this._computeCacheFullKeyframeIndices(e)}}),_(0,t,"currentFrameTime",function(){return this._currentFrameTime}),_(0,t,"currentPlayClip",function(){return this._currentPlayClip}),_(0,t,"currentPlayTime",function(){return this._currentTime+this._playStartFrames[this._currentPlayClipIndex]/this._currentPlayClip._frameRate}),_(0,t,"playbackTime",null,function(t){if(null!=this._currentPlayClip&&this._currentPlayClip&&this._currentPlayClip.loaded){this._startUpdateLoopCount=M.loopCount;var e=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=t,this._currentFrameIndex=Math.floor(this.currentPlayTime/e),this._currentFrameTime=this._currentFrameIndex*e}}),_(0,t,"paused",function(){return this._stoped},function(t){(this._stoped=t)&&this.event("paused")}),c(u,["deafaultMatrix",function(){return this.deafaultMatrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new Float32Array(16)}]),u}($e),Si=(function(e){function t(){this._attachSkeleton=null,this._extenData=null,this.attachBones=null,this.matrixs=null,t.__super.call(this),this.attachBones=[],this.matrixs=[]}m(t,"laya.d3.component.AttachPoint",e);var i=t.prototype;i._load=function(t){e.prototype._load.call(this,t),this._attachSkeleton=t.getComponentByType(Qi)},i._update=function(t){if(this._attachSkeleton&&!this._attachSkeleton.destroyed&&0!==this._attachSkeleton.player.state&&this._attachSkeleton.curBonesDatas){var e=this._attachSkeleton.player,i=this._attachSkeleton.templet;this.matrixs.length=this.attachBones.length;for(var n=this._attachSkeleton.curBonesDatas,r=this.owner.transform.worldMatrix,a=0,s=this.attachBones.length;a<s;a++){var o=16*i.getNodeIndexWithName(e.currentAnimationClipIndex,this.attachBones[a]),l=this.matrixs[a];l||(l=this.matrixs[a]=new De);for(var h=l.elements,u=0;u<16;u++)h[u]=n[o+u];De.multiply(r,l,l)}this.event("complete")}}}($e),function(t){function e(){e.__super.call(this),this._isRigidbody=!1,this._runtimeCollisonMap={},this._runtimeCollisonTestMap={},this._ignoreCollisonMap={},this.isTrigger=!0}m(e,"laya.d3.component.physics.Collider",t);var i=e.prototype;return i._clearCollsionMap=function(){for(var t in this._runtimeCollisonMap){var e=this._runtimeCollisonMap[t];delete e._runtimeCollisonMap[this.id],e._isRigidbody&&delete e._runtimeCollisonTestMap[this.id];var i=e.id;delete this._runtimeCollisonMap[i],this._isRigidbody&&delete this._runtimeCollisonTestMap[i]}},i._unload=function(t){for(var e in this._runtimeCollisonMap){var i=this._runtimeCollisonMap[e];delete i._runtimeCollisonMap[this.id],i._isRigidbody&&delete i._runtimeCollisonTestMap[this.id],delete this._ignoreCollisonMap[e]._ignoreCollisonMap[this.id]}},i._setIsRigidbody=function(t){if(this._isRigidbody!==t){this._isRigidbody=t;var e=this._owner;if(e.displayedInStage){var i=e.layer;i._removeCollider(this),i._addCollider(this)}}},i._getType=function(){return-1},i._collisonTo=function(t){return!1},i.raycast=function(t,e,i){throw void 0===i&&(i=179e306),new Error("Collider:Must override it.")},_(0,i,"enable",t.prototype._$get_enable,function(t){this._enable!==t&&(this._owner.displayedInStage&&(t||this._clearCollsionMap()),this._enable=t,this.event("enablechanged",this._enable))}),_(0,i,"isSingleton",function(){return e._isSingleton}),e._isSingleton=!1,e}($e)),wi=function(t){function e(){e.__super.call(this)}return m(e,"laya.d3.component.Rigidbody",t),_(0,e.prototype,"enable",t.prototype._$get_enable,function(t){if(this._enable!==t){for(var e=this._owner._colliders,i=0,n=e.length;i<n;i++){var r=e[i];r._setIsRigidbody(t);var a=r._runtimeCollisonMap,s=r._runtimeCollisonTestMap;if(!t)for(var o in a)delete s[o]}this._enable=t,this.event("enablechanged",this._enable)}}),e}($e),Mi=(function(t){function e(){e.__super.call(this)}m(e,"laya.d3.component.Script",$e);var i=e.prototype;i.onTriggerEnter=function(t){},i.onTriggerExit=function(t){},i.onTriggerStay=function(t){},_(0,i,"isSingleton",function(){return e._isSingleton}),e._isSingleton=!1}(),function(t){function e(t){e.__super.call(this,t)}m(e,"laya.d3.core.GlitterRender",ei);var i=e.prototype;return i._calculateBoundingBox=function(){var t=this._boundingBox.min.elements;t[0]=-Number.MAX_VALUE,t[1]=-Number.MAX_VALUE,t[2]=-Number.MAX_VALUE;var e=this._boundingBox.min.elements;e[0]=Number.MAX_VALUE,e[1]=Number.MAX_VALUE,e[2]=Number.MAX_VALUE},i._calculateBoundingSphere=function(){var t=this._boundingSphere.center.elements;t[0]=0,t[1]=0,t[2]=0,this._boundingSphere.radius=Number.MAX_VALUE},i._renderUpdate=function(t){this._setShaderValueMatrix4x4(0,this._owner.transform.worldMatrix);var e=this._owner.getProjectionViewWorldMatrix(t);this._setShaderValueMatrix4x4(1,e);var i=this._owner.templet;return this._setShaderValueNumber(3,i.lifeTime),this._setShaderValueNumber(2,i._currentTime),!0},e}()),Di=function(t){function e(t){this._owner=null,this._sharedMesh=null,e.__super.call(this),this._owner=t}m(e,"laya.d3.core.MeshFilter",t);var i=e.prototype;return i._sharedMeshLoaded=function(){this.event("loaded")},i._destroy=function(){t.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},_(0,i,"sharedMesh",function(){return this._sharedMesh},function(t){var e=this._sharedMesh;e&&e._removeReference(),(this._sharedMesh=t)._addReference(),this.event("meshchanged",[this,e,t]),t.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),_(0,i,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),_(0,i,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),_(0,i,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),_(0,i,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),e}(ti),Ii=function(t){function e(t){e.__super.call(this,t),t.meshFilter.on("meshchanged",this,this._onMeshChanged)}m(e,"laya.d3.core.MeshRender",ei);var i=e.prototype;return i._onMeshChanged=function(t,e,i){i.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:i.once("loaded",this,this._onMeshLoaed)},i._onMeshLoaed=function(t,e){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},i._calculateBoundingSphereByInitSphere=function(t){var e=NaN,i=this._owner.transform,n=i.scale.elements,r=Math.abs(n[0]),a=Math.abs(n[1]),s=Math.abs(n[2]);e=a<=r&&s<=r?r:s<=a?a:s,Oe.transformCoordinate(t.center,i.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=t.radius*e},i._calculateBoundBoxByInitCorners=function(t){for(var e=this._owner.transform.worldMatrix,i=0;i<8;i++)Oe.transformCoordinate(t[i],e,ei._tempBoundBoxCorners[i]);xe.createfromPoints(ei._tempBoundBoxCorners,this._boundingBox)},i._calculateBoundingSphere=function(){var t=this._owner.meshFilter.sharedMesh;null==t||null==t.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(t.boundingSphere)},i._calculateBoundingBox=function(){var t=this._owner.meshFilter.sharedMesh;null==t||null==t.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(t.boundingBoxCorners)},i._renderUpdate=function(t){var e=this._owner.transform;if(e){this._setShaderValueMatrix4x4(0,e.worldMatrix);var i=this._owner.getProjectionViewWorldMatrix(t);this._setShaderValueMatrix4x4(1,i)}else this._setShaderValueMatrix4x4(0,De.DEFAULT),this._setShaderValueMatrix4x4(1,t);return Qe.debugMode&&this._renderRenderableBoundBox(),!0},e}(),bi=function(t){function Z(t){Z.__super.call(this),this._tempRotationMatrix=new De,this._uvLength=new Le,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._owner=t,this._ownerRender=t.particleRender,this._boundingBoxCorners=w(8,null),this._boundingSphere=new Te(new Oe,Number.MAX_VALUE),this._boundingBox=new xe(new Oe(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),new Oe(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)),this._currentTime=0,this._isEmitting=!1,this._isPlaying=!1,this._isPaused=!1,this._burstsIndex=0,this._frameRateTime=0,this._emissionTime=0,this._totalDelayTime=0,this._simulateUpdate=!1,this._bufferMaxParticles=1,this.duration=5,this.looping=!0,this.prewarm=!1,this.startDelayType=0,this.startDelay=0,this.startDelayMin=0,this.startDelayMax=0,this._startLifetimeType=0,this._startLifetimeConstant=5,this._startLifeTimeGradient=new Y,this._startLifetimeConstantMin=0,this._startLifetimeConstantMax=5,this._startLifeTimeGradientMin=new Y,this._startLifeTimeGradientMax=new Y,this._maxStartLifetime=5,this.startSpeedType=0,this.startSpeedConstant=5,this.startSpeedConstantMin=0,this.startSpeedConstantMax=5,this.threeDStartSize=!1,this.startSizeType=0,this.startSizeConstant=1,this.startSizeConstantSeparate=new Oe(1,1,1),this.startSizeConstantMin=0,this.startSizeConstantMax=1,this.startSizeConstantMinSeparate=new Oe(0,0,0),this.startSizeConstantMaxSeparate=new Oe(1,1,1),this.threeDStartRotation=!1,this.startRotationType=0,this.startRotationConstant=0,this.startRotationConstantSeparate=new Oe(0,0,0),this.startRotationConstantMin=0,this.startRotationConstantMax=0,this.startRotationConstantMinSeparate=new Oe(0,0,0),this.startRotationConstantMaxSeparate=new Oe(0,0,0),this.randomizeRotationDirection=0,this.startColorType=0,this.startColorConstant=new Pe(1,1,1,1),this.startColorConstantMin=new Pe(1,1,1,1),this.startColorConstantMax=new Pe(1,1,1,1),this.gravityModifier=0,this.simulationSpace=1,this.scaleMode=0,this.playOnAwake=!0,this._rand=new Ae(0),this.autoRandomSeed=!0,this.randomSeed=new Uint32Array(1),this._randomSeeds=new Uint32Array(Z._RANDOMOFFSET.length),this.isPerformanceMode=!0,this._emission=new B,this._emission.enbale=!0,this._owner.on("activeinhierarchychanged",this,this._onOwnerActiveHierarchyChanged)}m(Z,"laya.d3.core.particleShuriKen.ShurikenParticleSystem",t);var e=Z.prototype;return S.imps(e,{"laya.d3.core.render.IRenderable":!0,"laya.d3.core.IClone":!0}),e._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},e._getIndexBuffer=function(){return this._indexBuffer},e._generateBoundingSphere=function(){var t=this._boundingSphere.center.elements;t[0]=0,t[1]=0,t[2]=0,this._boundingSphere.radius=Number.MAX_VALUE},e._generateBoundingBox=function(){var t=this._owner.particleRender,e=this._boundingBox.min,i=this._boundingBox.max,n=0,r=0,a=NaN;switch(this.startLifetimeType){case 0:a=this.startLifetimeConstant;break;case 1:a=-Number.MAX_VALUE;var s=s;for(n=0,r=s.gradientCount;n<r;n++)a=Math.max(a,s.getValueByIndex(n));break;case 2:a=Math.max(this.startLifetimeConstantMin,this.startLifetimeConstantMax);break;case 3:a=-Number.MAX_VALUE;var o=o;for(n=0,r=o.gradientCount;n<r;n++)a=Math.max(a,o.getValueByIndex(n));var l=l;for(n=0,r=l.gradientCount;n<r;n++)a=Math.max(a,l.getValueByIndex(n))}var h,u,c,_,d=NaN,f=NaN;switch(this.startSpeedType){case 0:d=f=this.startSpeedConstant;break;case 1:break;case 2:d=this.startLifetimeConstantMin,f=this.startLifetimeConstantMax}this._shape&&this._shape.enable||(h=u=Oe.ZERO,c=Oe.ZERO,_=Oe.UnitZ);var p,m,g=new Oe(c.x*d,c.y*d,c.z*d),v=new Oe(_.x*f,_.y*f,_.z*f);if(this._velocityOverLifetime&&this._velocityOverLifetime.enbale){var y=this._velocityOverLifetime.velocity;switch(y.type){case 0:y.constant;break;case 1:new Oe(y.gradientX.getAverageValue(),y.gradientY.getAverageValue(),y.gradientZ.getAverageValue());break;case 2:y.constantMin,y.constantMax;break;case 3:new Oe(y.gradientXMin.getAverageValue(),y.gradientYMin.getAverageValue(),y.gradientZMin.getAverageValue()),new Oe(y.gradientXMax.getAverageValue(),y.gradientYMax.getAverageValue(),y.gradientZMax.getAverageValue())}}var x,E,T=this._owner.transform,S=T.position,w=Z._tempVector39,M=w.elements,D=t.renderMode;switch(this.scaleMode){case 0:var I=T.scale;p=I,M[0]=I.x,M[1]=I.z,M[2]=I.y,1===D&&(m=I);break;case 1:var b=T.localScale;p=b,M[0]=b.x,M[1]=b.z,M[2]=b.y,1===D&&(m=b);break;case 2:p=T.scale,M[0]=M[1]=M[2]=1,1===D&&(m=Oe.ONE)}switch(this._velocityOverLifetime&&this._velocityOverLifetime.enbale||(x=new Oe(g.x*a,g.y*a,g.z*a),E=new Oe(v.x*a,v.y*a,v.z*a),2!=this.scaleMode?(Oe.add(h,x,e),Oe.multiply(p,e,e),Oe.add(u,E,i),Oe.multiply(p,i,i)):(Oe.multiply(p,h,e),Oe.add(e,x,e),Oe.multiply(p,u,i),Oe.add(i,E,i))),this.simulationSpace){case 0:break;case 1:Oe.add(e,S,e),Oe.add(i,S,i)}var C=NaN,A=NaN;switch(this.startSizeType){case 0:if(this.threeDStartSize){var R=R;C=Math.max(R.x,R.y),1===D&&(A=R.y)}else C=this.startSizeConstant,1===D&&(A=this.startSizeConstant);break;case 1:break;case 2:if(this.threeDStartSize){var L=L;C=Math.max(L.x,L.y),1===D&&(A=L.y)}else C=this.startSizeConstantMax,1===D&&(A=this.startSizeConstantMax)}if(this._sizeOverLifetime&&this._sizeOverLifetime.enbale){this._sizeOverLifetime.size;C*=this._sizeOverLifetime.size.getMaxSizeInGradient()}var O=Z._tempVector30,P=O.elements,N=NaN,V=NaN;switch(D){case 0:N=C*Z.halfKSqrtOf2,Oe.scale(w,C,O),Oe.subtract(e,O,e),Oe.add(i,O,i);break;case 1:var F=Z._tempVector31,B=Z._tempVector32,U=Z._tempVector33,k=Z._tempVector34;this._velocityOverLifetime&&this._velocityOverLifetime.enbale||(Oe.multiply(m,v,B),Oe.multiply(m,g,U));var H=A*t.stretchedBillboardLengthScale,z=Oe.scalarLength(B)*t.stretchedBillboardSpeedScale+H,G=Oe.scalarLength(U)*t.stretchedBillboardSpeedScale+H,W=Z._tempVector35,X=Z._tempVector36;Oe.normalize(B,W),Oe.scale(W,z,k),Oe.subtract(E,k,k),Oe.normalize(U,X),Oe.scale(X,G,F),Oe.add(x,F,F),N=C*Z.halfKSqrtOf2,Oe.scale(w,N,O);var Y=Z._tempVector37,j=Z._tempVector38;Oe.scale(W,.5,Y),Oe.scale(X,.5,j),Oe.multiply(Y,w,Y),Oe.multiply(j,w,j),Oe.add(e,j,e),Oe.min(e,k,e),Oe.subtract(e,O,e),Oe.subtract(i,Y,i),Oe.max(i,F,i),Oe.add(i,O,i);break;case 2:V=.5*(C*=Math.cos(.7853981633974483)),P[0]=w.x*V,P[1]=w.z*V,Oe.subtract(e,O,e),Oe.add(i,O,i);break;case 3:V=.5*(C*=Math.cos(.7853981633974483)),Oe.scale(w,V,O),Oe.subtract(e,O,e),Oe.add(i,O,i)}this._boundingBox.getCorners(this._boundingBoxCorners)},e._updateEmission=function(){if(S.stage.isVisibility&&this.isAlive)if(this._simulateUpdate)this._simulateUpdate=!1;else{var t=this._startUpdateLoopCount===M.loopCount||this._isPaused?0:S.timer.delta/1e3;t=Math.min(Z._maxElapsedTime,t),this._updateParticles(t)}},e._updateParticles=function(t){(4!==this._ownerRender.renderMode||this._ownerRender.mesh)&&(this._currentTime+=t,this._retireActiveParticles(),this._freeRetiredParticles(),this._totalDelayTime+=t,this._totalDelayTime<this._playStartDelay||this._emission.enbale&&this._isEmitting&&!this._isPaused&&this._advanceTime(t,this._currentTime))},e._updateParticlesSimulationRestart=function(t){this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._burstsIndex=0,this._frameRateTime=t,this._emissionTime=0,this._totalDelayTime=0;var e=this._currentTime=t;e<this._playStartDelay?this._totalDelayTime=e:this._emission.enbale&&this._advanceTime(t,t)},e._addUpdateEmissionToTimer=function(){S.timer.frameLoop(1,this,this._updateEmission)},e._removeUpdateEmissionToTimer=function(){S.timer.clear(this,this._updateEmission)},e._onOwnerActiveHierarchyChanged=function(t){this._owner.displayedInStage&&(t?this._addUpdateEmissionToTimer():this._removeUpdateEmissionToTimer())},e._retireActiveParticles=function(){for(;this._firstActiveElement!=this._firstNewElement;){var t=this._firstActiveElement*this._floatCountPerVertex*this._vertexStride,e=t+this._timeIndex;if(this._currentTime-this._vertices[e]+1e-4<this._vertices[t+this._startLifeTimeIndex])break;this._vertices[e]=this._drawCounter,this._firstActiveElement++,this._firstActiveElement>=this._bufferMaxParticles&&(this._firstActiveElement=0)}},e._freeRetiredParticles=function(){for(;this._firstRetiredElement!=this._firstActiveElement;){var t=this._drawCounter-this._vertices[this._firstRetiredElement*this._floatCountPerVertex*this._vertexStride+this._timeIndex];if(this.isPerformanceMode&&t<3)break;this._firstRetiredElement++,this._firstRetiredElement>=this._bufferMaxParticles&&(this._firstRetiredElement=0)}},e._burst=function(t,e){for(var i=0,n=this._emission._bursts,r=n.length;this._burstsIndex<r;this._burstsIndex++){var a=n[this._burstsIndex],s=a.time;if(!(t<=s&&s<e))break;var o=0;this.autoRandomSeed?o=k.lerp(a.minCount,a.maxCount,Math.random()):(this._rand.seed=this._randomSeeds[0],o=k.lerp(a.minCount,a.maxCount,this._rand.getFloat()),this._randomSeeds[0]=this._rand.seed),i+=o}return i},e._advanceTime=function(t,e){var i=0,n=this._emissionTime;this._emissionTime+=t;var r=0;if(this._emissionTime>this.duration){if(!this.looping){for(r=Math.min(this.maxParticles-this.aliveParticleCount,r),i=0;i<r;i++)this.emit(e);return this._isPlaying=!1,void this.stop()}r+=this._burst(n,this._emissionTime),this._emissionTime-=this.duration,this.event("complete"),this._burstsIndex=0,r+=this._burst(0,this._emissionTime)}else r+=this._burst(n,this._emissionTime);for(r=Math.min(this.maxParticles-this.aliveParticleCount,r),i=0;i<r;i++)this.emit(e);var a=this.emission.emissionRate;if(0<a){var s=1/a;for(this._frameRateTime+=s,this._frameRateTime=this._currentTime-(this._currentTime-this._frameRateTime)%this._maxStartLifetime;this._frameRateTime<=e&&this.emit(this._frameRateTime);)this._frameRateTime+=s;this._frameRateTime=Math.floor(e/s)*s}},e._initBufferDatas=function(){this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy());var t=this._ownerRender,e=t.renderMode;if(-1!==e&&0<this.maxParticles){var i,n,r=0,a=0,s=0,o=0,l=0,h=t.mesh;if(4===e){if(h){if(1<h._vertexBuffers.length)throw new Error("ShurikenParticleSystem: submesh Count mesh be One or all subMeshes have the same vertexDeclaration.");n=pe.vertexDeclaration,this._floatCountPerVertex=n.vertexStride/4,this._startLifeTimeIndex=12,this._timeIndex=16,this._vertexStride=h._vertexBuffers[0].vertexCount;var u=this._bufferMaxParticles*this._vertexStride,c=u%65535;if(1<Math.floor(u/65535)+1)throw new Error("ShurikenParticleSystem:the maxParticleCount multiply mesh vertexCount is large than 65535.");this._vertexBuffer=Zi.create(n,c,35048),this._vertices=new Float32Array(this._floatCountPerVertex*c),this._indexStride=h._indexBuffer.indexCount;var _=h._indexBuffer.getData(),d=this._bufferMaxParticles*this._indexStride;for(this._indexBuffer=ji.create("ushort",d,35044),i=new Uint16Array(d),r=o=0;r<this._bufferMaxParticles;r++){var f=r*this._vertexStride;for(a=0,s=_.length;a<s;a++)i[o++]=f+_[a]}this._indexBuffer.setData(i)}}else{for(n=fe.vertexDeclaration,this._floatCountPerVertex=n.vertexStride/4,this._startLifeTimeIndex=7,this._timeIndex=11,this._vertexStride=4,this._vertexBuffer=Zi.create(n,this._bufferMaxParticles*this._vertexStride,35048),this._vertices=new Float32Array(this._floatCountPerVertex*this._bufferMaxParticles*this._vertexStride),r=0;r<this._bufferMaxParticles;r++)l=r*this._floatCountPerVertex*this._vertexStride,this._vertices[l]=-.5,this._vertices[l+1]=-.5,this._vertices[l+2]=0,this._vertices[l+3]=1,l+=this._floatCountPerVertex,this._vertices[l]=.5,this._vertices[l+1]=-.5,this._vertices[l+2]=1,this._vertices[l+3]=1,l+=this._floatCountPerVertex,this._vertices[l]=.5,this._vertices[l+1]=.5,this._vertices[l+2]=1,this._vertices[l+3]=0,l+=this._floatCountPerVertex,this._vertices[l]=-.5,this._vertices[l+1]=.5,this._vertices[l+2]=0,this._vertices[l+3]=0;for(this._indexStride=6,this._indexBuffer=ji.create("ushort",6*this._bufferMaxParticles,35044),i=new Uint16Array(6*this._bufferMaxParticles),r=0;r<this._bufferMaxParticles;r++){o=6*r;var p=r*this._vertexStride,m=p+2;i[o++]=p,i[o++]=m,i[o++]=p+1,i[o++]=p,i[o++]=p+3,i[o++]=m}this._indexBuffer.setData(i)}}},e._destroy=function(){t.prototype._destroy.call(this),this._owner.activeInHierarchy&&this._removeUpdateEmissionToTimer(),this._vertexBuffer.destroy(),this._indexBuffer.destroy(),this._emission._destroy(),this._owner=null,this._vertices=null,this._vertexBuffer=null,this._indexBuffer=null,this._emission=null,this._shape=null,this.startLifeTimeGradient=null,this.startLifeTimeGradientMin=null,this.startLifeTimeGradientMax=null,this.startSizeConstantSeparate=null,this.startSizeConstantMinSeparate=null,this.startSizeConstantMaxSeparate=null,this.startRotationConstantSeparate=null,this.startRotationConstantMinSeparate=null,this.startRotationConstantMaxSeparate=null,this.startColorConstant=null,this.startColorConstantMin=null,this.startColorConstantMax=null,this._velocityOverLifetime=null,this._colorOverLifetime=null,this._sizeOverLifetime=null,this._rotationOverLifetime=null,this._textureSheetAnimation=null},e.emit=function(t){var e=Z._tempPosition,i=Z._tempDirection;if(this._shape&&this._shape.enable)this.autoRandomSeed?this._shape.generatePositionAndDirection(e,i):this._shape.generatePositionAndDirection(e,i,this._rand,this._randomSeeds);else{var n=e.elements,r=i.elements;n[0]=n[1]=n[2]=0,r[0]=r[1]=0,r[2]=1}return this.addParticle(e,i,t)},e.addParticle=function(t,e,i){Oe.normalize(e,e);var n=this._firstFreeElement+1;if(n>=this._bufferMaxParticles&&(n=0),n===this._firstRetiredElement)return!1;if(K.create(this,this._ownerRender,this._owner.transform),this._currentTime-i>=K.startLifeTime)return!0;var r=NaN,a=NaN,s=NaN,o=NaN,l=NaN,h=NaN,u=NaN,c=this._velocityOverLifetime&&this._velocityOverLifetime.enbale;if(c){var _=this._velocityOverLifetime.velocity.type;2===_||3===_?this.autoRandomSeed?(r=Math.random(),a=Math.random(),s=Math.random()):(this._rand.seed=this._randomSeeds[9],r=this._rand.getFloat(),a=this._rand.getFloat(),s=this._rand.getFloat(),this._randomSeeds[9]=this._rand.seed):c=!1}else c=!1;var d=this._colorOverLifetime&&this._colorOverLifetime.enbale;d?3===this._colorOverLifetime.color.type?this.autoRandomSeed?o=Math.random():(this._rand.seed=this._randomSeeds[10],o=this._rand.getFloat(),this._randomSeeds[10]=this._rand.seed):d=!1:d=!1;var f=this._sizeOverLifetime&&this._sizeOverLifetime.enbale;f?3===this._sizeOverLifetime.size.type?this.autoRandomSeed?l=Math.random():(this._rand.seed=this._randomSeeds[11],l=this._rand.getFloat(),this._randomSeeds[11]=this._rand.seed):f=!1:f=!1;var p=this._rotationOverLifetime&&this._rotationOverLifetime.enbale;if(p){var m=this._rotationOverLifetime.angularVelocity.type;2===m||3===m?this.autoRandomSeed?h=Math.random():(this._rand.seed=this._randomSeeds[12],h=this._rand.getFloat(),this._randomSeeds[12]=this._rand.seed):p=!1}else p=!1;var g=this._textureSheetAnimation&&this._textureSheetAnimation.enable;g?3===this._textureSheetAnimation.frame.type?this.autoRandomSeed?u=Math.random():(this._rand.seed=this._randomSeeds[15],u=this._rand.getFloat(),this._randomSeeds[15]=this._rand.seed):g=!1:g=!1;var v,y=this._firstFreeElement*this._floatCountPerVertex*this._vertexStride,x=K.startUVInfo[0],E=K.startUVInfo[1],T=K.startUVInfo[2],S=K.startUVInfo[3],w=t.elements,M=e.elements,D=0,I=0,b=0,C=0,A=0,R=this._ownerRender;if(4===R.renderMode){var L=R.mesh._vertexBuffers[0];v=L.getData();var O=L.vertexDeclaration;I=O.getVertexElementByUsage(0).offset/4;var P=O.getVertexElementByUsage(1);b=P?P.offset/4:-1;var N=O.getVertexElementByUsage(2);C=N?N.offset/4:-1,D=O.vertexStride/4,A=0}else{this._vertices[y+2]=T,this._vertices[y+3]=S+E;var V=y+this._floatCountPerVertex;this._vertices[V+2]=T+x,this._vertices[V+3]=S+E;var F=V+this._floatCountPerVertex;this._vertices[F+2]=T+x,this._vertices[F+3]=S;var B=F+this._floatCountPerVertex;this._vertices[B+2]=T,this._vertices[B+3]=S}for(var U=y,k=y+this._floatCountPerVertex*this._vertexStride;U<k;U+=this._floatCountPerVertex){var H=0;if(4===R.renderMode){H=U;var z=D*A++,G=z+I;this._vertices[H++]=v[G++],this._vertices[H++]=v[G++],this._vertices[H++]=v[G],this._vertices[H++]=-1===b?(this._vertices[H++]=1,this._vertices[H++]=1,this._vertices[H++]=1):(G=z+b,this._vertices[H++]=v[G++],this._vertices[H++]=v[G++],this._vertices[H++]=v[G++],v[G]),this._vertices[H++]=-1===C?this._vertices[H++]=0:(G=z+C,this._vertices[H++]=T+v[G++]*x,S+v[G]*E)}else H=U+4;switch(this._vertices[H++]=w[0],this._vertices[H++]=w[1],this._vertices[H++]=w[2],this._vertices[H++]=K.startLifeTime,this._vertices[H++]=M[0],this._vertices[H++]=M[1],this._vertices[H++]=M[2],this._vertices[H++]=i,this._vertices[H++]=K.startColor[0],this._vertices[H++]=K.startColor[1],this._vertices[H++]=K.startColor[2],this._vertices[H++]=K.startColor[3],this._vertices[H++]=K.startSize[0],this._vertices[H++]=K.startSize[1],this._vertices[H++]=K.startSize[2],this._vertices[H++]=K.startRotation[0],this._vertices[H++]=K.startRotation[1],this._vertices[H++]=K.startRotation[2],this._vertices[H++]=K.startSpeed,d&&(this._vertices[H+1]=o),f&&(this._vertices[H+2]=l),p&&(this._vertices[H+3]=h),g&&(this._vertices[H+4]=u),c&&(this._vertices[H+5]=r,this._vertices[H+6]=a,this._vertices[H+7]=s),this.simulationSpace){case 0:H+=8,this._vertices[H++]=K.simulationWorldPostion[0],this._vertices[H++]=K.simulationWorldPostion[1],this._vertices[H++]=K.simulationWorldPostion[2],this._vertices[H++]=K.simulationWorldRotation[0],this._vertices[H++]=K.simulationWorldRotation[1],this._vertices[H++]=K.simulationWorldRotation[2],this._vertices[H++]=K.simulationWorldRotation[3];break;case 1:break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}}return this._firstFreeElement=n,!0},e.addNewParticlesToVertexBuffer=function(){var t=0;this._firstNewElement<this._firstFreeElement?(t=this._firstNewElement*this._vertexStride*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,t,t,(this._firstFreeElement-this._firstNewElement)*this._vertexStride*this._floatCountPerVertex)):(t=this._firstNewElement*this._vertexStride*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,t,t,(this._bufferMaxParticles-this._firstNewElement)*this._vertexStride*this._floatCountPerVertex),0<this._firstFreeElement&&this._vertexBuffer.setData(this._vertices,0,0,this._firstFreeElement*this._vertexStride*this._floatCountPerVertex)),this._firstNewElement=this._firstFreeElement},e._beforeRender=function(t){return this._firstNewElement!=this._firstFreeElement&&this.addNewParticlesToVertexBuffer(),this._drawCounter++,this._firstActiveElement!=this._firstFreeElement&&(this._vertexBuffer._bind(),this._indexBuffer._bind(),!0)},e._render=function(t){var e=0,i=R.mainContext;this._firstActiveElement<this._firstFreeElement?(e=(this._firstFreeElement-this._firstActiveElement)*this._indexStride,i.drawElements(4,e,5123,2*this._firstActiveElement*this._indexStride),M.trianglesFaces+=e/3,M.drawCall++):(e=(this._bufferMaxParticles-this._firstActiveElement)*this._indexStride,i.drawElements(4,e,5123,2*this._firstActiveElement*this._indexStride),M.trianglesFaces+=e/3,M.drawCall++,0<this._firstFreeElement&&(e=this._firstFreeElement*this._indexStride,i.drawElements(4,e,5123,0),M.trianglesFaces+=e/3,M.drawCall++))},e.play=function(){if(this._burstsIndex=0,this._isEmitting=!0,this._isPlaying=!0,this._isPaused=!1,this._emissionTime=0,this._totalDelayTime=0,!this.autoRandomSeed)for(var t=0,e=this._randomSeeds.length;t<e;t++)this._randomSeeds[t]=this.randomSeed[0]+Z._RANDOMOFFSET[t];switch(this.startDelayType){case 0:this._playStartDelay=this.startDelay;break;case 1:this.autoRandomSeed?this._playStartDelay=k.lerp(this.startDelayMin,this.startDelayMax,Math.random()):(this._rand.seed=this._randomSeeds[2],this._playStartDelay=k.lerp(this.startDelayMin,this.startDelayMax,this._rand.getFloat()),this._randomSeeds[2]=this._rand.seed);break;default:throw new Error("Utils3D: startDelayType is invalid.")}this._frameRateTime=this._currentTime+this._playStartDelay,this._startUpdateLoopCount=M.loopCount,this.event("played")},e.pause=function(){this._isPaused=!0,this.event("paused")},e.simulate=function(t,e){void 0===e&&(e=!0),this._simulateUpdate=!0,e?this._updateParticlesSimulationRestart(t):(this._isPaused=!1,this._updateParticles(t)),this.pause()},e.stop=function(){this._burstsIndex=0,this._isEmitting=!1,this._emissionTime=0,this.event("stopped")},e.cloneTo=function(t){var e=t;e.duration=this.duration,e.looping=this.looping,e.prewarm=this.prewarm,e.startDelayType=this.startDelayType,e.startDelay=this.startDelay,e.startDelayMin=this.startDelayMin,e.startDelayMax=this.startDelayMax,e._maxStartLifetime=this._maxStartLifetime,e.startLifetimeType=this.startLifetimeType,e.startLifetimeConstant=this.startLifetimeConstant,this.startLifeTimeGradient.cloneTo(e.startLifeTimeGradient),e.startLifetimeConstantMin=this.startLifetimeConstantMin,e.startLifetimeConstantMax=this.startLifetimeConstantMax,this.startLifeTimeGradientMin.cloneTo(e.startLifeTimeGradientMin),this.startLifeTimeGradientMax.cloneTo(e.startLifeTimeGradientMax),e.startSpeedType=this.startSpeedType,e.startSpeedConstant=this.startSpeedConstant,e.startSpeedConstantMin=this.startSpeedConstantMin,e.startSpeedConstantMax=this.startSpeedConstantMax,e.threeDStartSize=this.threeDStartSize,e.startSizeType=this.startSizeType,e.startSizeConstant=this.startSizeConstant,this.startSizeConstantSeparate.cloneTo(e.startSizeConstantSeparate),e.startSizeConstantMin=this.startSizeConstantMin,e.startSizeConstantMax=this.startSizeConstantMax,this.startSizeConstantMinSeparate.cloneTo(e.startSizeConstantMinSeparate),this.startSizeConstantMaxSeparate.cloneTo(e.startSizeConstantMaxSeparate),e.threeDStartRotation=this.threeDStartRotation,e.startRotationType=this.startRotationType,e.startRotationConstant=this.startRotationConstant,this.startRotationConstantSeparate.cloneTo(e.startRotationConstantSeparate),e.startRotationConstantMin=this.startRotationConstantMin,e.startRotationConstantMax=this.startRotationConstantMax,this.startRotationConstantMinSeparate.cloneTo(e.startRotationConstantMinSeparate),this.startRotationConstantMaxSeparate.cloneTo(e.startRotationConstantMaxSeparate),e.randomizeRotationDirection=this.randomizeRotationDirection,e.startColorType=this.startColorType,this.startColorConstant.cloneTo(e.startColorConstant),this.startColorConstantMin.cloneTo(e.startColorConstantMin),this.startColorConstantMax.cloneTo(e.startColorConstantMax),e.gravityModifier=this.gravityModifier,e.simulationSpace=this.simulationSpace,e.scaleMode=this.scaleMode,e.playOnAwake=this.playOnAwake,e.maxParticles=this.maxParticles,this._emission&&(e._emission=this._emission.clone()),this.shape&&(e.shape=this.shape.clone()),this.velocityOverLifetime&&(e.velocityOverLifetime=this.velocityOverLifetime.clone()),this.colorOverLifetime&&(e.colorOverLifetime=this.colorOverLifetime.clone()),this.sizeOverLifetime&&(e.sizeOverLifetime=this.sizeOverLifetime.clone()),this.rotationOverLifetime&&(e.rotationOverLifetime=this.rotationOverLifetime.clone()),this.textureSheetAnimation&&(e.textureSheetAnimation=this.textureSheetAnimation.clone()),e.isPerformanceMode=this.isPerformanceMode,e._isEmitting=this._isEmitting,e._isPlaying=this._isPlaying,e._isPaused=this._isPaused,e._playStartDelay=this._playStartDelay,e._frameRateTime=this._frameRateTime,e._emissionTime=this._emissionTime,e._totalDelayTime=this._totalDelayTime,e._burstsIndex=this._burstsIndex},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e._getVertexBuffers=function(){return null},e._renderRuntime=function(t,e,i){},_(0,e,"maxParticles",function(){return this._bufferMaxParticles-1},function(t){var e=t+1;e!==this._bufferMaxParticles&&(this._bufferMaxParticles=e,this._initBufferDatas())}),_(0,e,"isEmitting",function(){return this._isEmitting}),_(0,e,"isAlive",function(){return!!(this._isPlaying||0<this.aliveParticleCount)}),_(0,e,"shape",function(){return this._shape},function(t){this._shape!==t&&(t&&t.enable?this._ownerRender._addShaderDefine(vn.SHADERDEFINE_SHAPE):this._ownerRender._removeShaderDefine(vn.SHADERDEFINE_SHAPE),this._shape=t)}),_(0,e,"rotationOverLifetime",function(){return this._rotationOverLifetime},function(t){var e=this._ownerRender;if(t){var i=t.angularVelocity;if(!i)return;var n=i.separateAxes,r=i.type;if(t.enbale)switch(n?e._addShaderDefine(vn.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE):e._addShaderDefine(vn.SHADERDEFINE_ROTATIONOVERLIFETIME),r){case 0:e._addShaderDefine(vn.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT);break;case 1:e._addShaderDefine(vn.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE);break;case 2:e._addShaderDefine(vn.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS);break;case 3:e._addShaderDefine(vn.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES)}else e._removeShaderDefine(vn.SHADERDEFINE_ROTATIONOVERLIFETIME),e._removeShaderDefine(vn.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE),e._removeShaderDefine(vn.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT),e._removeShaderDefine(vn.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE),e._removeShaderDefine(vn.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS),e._removeShaderDefine(vn.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES);switch(r){case 0:n?e._setShaderValueColor(35,i.constantSeparate):e._setShaderValueNumber(34,i.constant);break;case 1:n?(e._setShaderValueBuffer(37,i.gradientX._elements),e._setShaderValueBuffer(38,i.gradientY._elements),e._setShaderValueBuffer(39,i.gradientZ._elements),e._setShaderValueBuffer(40,i.gradientW._elements)):e._setShaderValueBuffer(36,i.gradient._elements);break;case 2:n?(e._setShaderValueColor(35,i.constantMinSeparate),e._setShaderValueColor(42,i.constantMaxSeparate)):(e._setShaderValueNumber(34,i.constantMin),e._setShaderValueNumber(41,i.constantMax));break;case 3:n?(e._setShaderValueBuffer(37,i.gradientXMin._elements),e._setShaderValueBuffer(44,i.gradientXMax._elements),e._setShaderValueBuffer(38,i.gradientYMin._elements),e._setShaderValueBuffer(45,i.gradientYMax._elements),e._setShaderValueBuffer(39,i.gradientZMin._elements),e._setShaderValueBuffer(46,i.gradientZMax._elements),e._setShaderValueBuffer(40,i.gradientWMin._elements),e._setShaderValueBuffer(47,i.gradientWMax._elements)):(e._setShaderValueBuffer(36,i.gradientMin._elements),e._setShaderValueBuffer(43,i.gradientMax._elements))}}else e._removeShaderDefine(vn.SHADERDEFINE_ROTATIONOVERLIFETIME),e._removeShaderDefine(vn.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE),e._removeShaderDefine(vn.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT),e._removeShaderDefine(vn.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE),e._removeShaderDefine(vn.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS),e._removeShaderDefine(vn.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES),e._setShaderValueColor(35,null),e._setShaderValueColor(42,null),e._setShaderValueNumber(34,void 0),e._setShaderValueNumber(41,void 0),e._setShaderValueBuffer(37,null),e._setShaderValueBuffer(44,null),e._setShaderValueBuffer(38,null),e._setShaderValueBuffer(45,null),e._setShaderValueBuffer(39,null),e._setShaderValueBuffer(46,null),e._setShaderValueBuffer(40,null),e._setShaderValueBuffer(47,null),e._setShaderValueBuffer(36,null),e._setShaderValueBuffer(43,null);this._rotationOverLifetime=t}),_(0,e,"emission",function(){return this._emission}),_(0,e,"emissionTime",function(){return this._emissionTime>this.duration?this.duration:this._emissionTime}),_(0,e,"aliveParticleCount",function(){return this._firstNewElement>=this._firstRetiredElement?this._firstNewElement-this._firstRetiredElement:this._bufferMaxParticles-this._firstRetiredElement+this._firstNewElement}),_(0,e,"isPlaying",function(){return this._isPlaying}),_(0,e,"isPaused",function(){return this._isPaused}),_(0,e,"startLifetimeType",function(){return this._startLifetimeType},function(t){var e=0,i=0;switch(this.startLifetimeType){case 0:this._maxStartLifetime=this.startLifetimeConstant;break;case 1:this._maxStartLifetime=-Number.MAX_VALUE;var n=n;for(e=0,i=n.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,n.getValueByIndex(e));break;case 2:this._maxStartLifetime=Math.max(this.startLifetimeConstantMin,this.startLifetimeConstantMax);break;case 3:this._maxStartLifetime=-Number.MAX_VALUE;var r=r;for(e=0,i=r.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,r.getValueByIndex(e));var a=a;for(e=0,i=a.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,a.getValueByIndex(e))}this._startLifetimeType=t}),_(0,e,"_originalBoundingSphere",function(){return this._boundingSphere}),_(0,e,"startLifetimeConstant",function(){return this._startLifetimeConstant},function(t){0===this._startLifetimeType&&(this._maxStartLifetime=t),this._startLifetimeConstant=t}),_(0,e,"startLifetimeConstantMin",function(){return this._startLifetimeConstantMin},function(t){2===this._startLifetimeType&&(this._maxStartLifetime=Math.max(t,this._startLifetimeConstantMax)),this._startLifetimeConstantMin=t}),_(0,e,"startLifeTimeGradient",function(){return this._startLifeTimeGradient},function(t){if(1===this._startLifetimeType){this._maxStartLifetime=-Number.MAX_VALUE;for(var e=0,i=t.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e))}this._startLifeTimeGradient=t}),_(0,e,"startLifetimeConstantMax",function(){return this._startLifetimeConstantMax},function(t){2===this._startLifetimeType&&(this._maxStartLifetime=Math.max(this._startLifetimeConstantMin,t)),this._startLifetimeConstantMax=t}),_(0,e,"startLifeTimeGradientMin",function(){return this._startLifeTimeGradientMin},function(t){if(3===this._startLifetimeType){var e=0,i=0;for(this._maxStartLifetime=-Number.MAX_VALUE,e=0,i=t.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e));for(e=0,i=this._startLifeTimeGradientMax.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,this._startLifeTimeGradientMax.getValueByIndex(e))}this._startLifeTimeGradientMin=t}),_(0,e,"startLifeTimeGradientMax",function(){return this._startLifeTimeGradientMax},function(t){if(3===this._startLifetimeType){var e=0,i=0;for(this._maxStartLifetime=-Number.MAX_VALUE,e=0,i=this._startLifeTimeGradientMin.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,this._startLifeTimeGradientMin.getValueByIndex(e));for(e=0,i=t.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e))}this._startLifeTimeGradientMax=t}),_(0,e,"velocityOverLifetime",function(){return this._velocityOverLifetime},function(t){var e=this._ownerRender;if(t){var i=t.velocity,n=i.type;if(t.enbale)switch(n){case 0:e._addShaderDefine(vn.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT);break;case 1:e._addShaderDefine(vn.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE);break;case 2:e._addShaderDefine(vn.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT);break;case 3:e._addShaderDefine(vn.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE)}else e._removeShaderDefine(vn.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT),e._removeShaderDefine(vn.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE),e._removeShaderDefine(vn.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT),e._removeShaderDefine(vn.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE);switch(n){case 0:e._setShaderValueColor(13,i.constant);break;case 1:e._setShaderValueBuffer(14,i.gradientX._elements),e._setShaderValueBuffer(15,i.gradientY._elements),e._setShaderValueBuffer(16,i.gradientZ._elements);break;case 2:e._setShaderValueColor(13,i.constantMin),e._setShaderValueColor(17,i.constantMax);break;case 3:e._setShaderValueBuffer(14,i.gradientXMin._elements),e._setShaderValueBuffer(18,i.gradientXMax._elements),e._setShaderValueBuffer(15,i.gradientYMin._elements),e._setShaderValueBuffer(19,i.gradientYMax._elements),e._setShaderValueBuffer(16,i.gradientZMin._elements),e._setShaderValueBuffer(20,i.gradientZMax._elements)}e._setShaderValueInt(21,t.space)}else e._removeShaderDefine(vn.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT),e._removeShaderDefine(vn.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE),e._removeShaderDefine(vn.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT),e._removeShaderDefine(vn.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE),e._setShaderValueColor(13,null),e._setShaderValueBuffer(14,null),e._setShaderValueBuffer(15,null),e._setShaderValueBuffer(16,null),e._setShaderValueColor(13,null),e._setShaderValueColor(17,null),e._setShaderValueBuffer(14,null),e._setShaderValueBuffer(18,null),e._setShaderValueBuffer(15,null),e._setShaderValueBuffer(19,null),e._setShaderValueBuffer(16,null),e._setShaderValueBuffer(20,null),e._setShaderValueInt(21,void 0);this._velocityOverLifetime=t}),_(0,e,"colorOverLifetime",function(){return this._colorOverLifetime},function(t){var e=this._ownerRender;if(t){var i=t.color;if(t.enbale)switch(i.type){case 1:e._addShaderDefine(vn.SHADERDEFINE_COLOROVERLIFETIME);break;case 3:e._addShaderDefine(vn.SHADERDEFINE_RANDOMCOLOROVERLIFETIME)}else e._removeShaderDefine(vn.SHADERDEFINE_COLOROVERLIFETIME),e._removeShaderDefine(vn.SHADERDEFINE_RANDOMCOLOROVERLIFETIME);switch(i.type){case 1:var n=i.gradient;e._setShaderValueBuffer(22,n._alphaElements),e._setShaderValueBuffer(23,n._rgbElements);break;case 3:var r=i.gradientMin,a=i.gradientMax;e._setShaderValueBuffer(22,r._alphaElements),e._setShaderValueBuffer(23,r._rgbElements),e._setShaderValueBuffer(24,a._alphaElements),e._setShaderValueBuffer(25,a._rgbElements)}}else e._removeShaderDefine(vn.SHADERDEFINE_COLOROVERLIFETIME),e._removeShaderDefine(vn.SHADERDEFINE_RANDOMCOLOROVERLIFETIME),e._setShaderValueBuffer(22,n._alphaElements),e._setShaderValueBuffer(23,n._rgbElements),e._setShaderValueBuffer(22,r._alphaElements),e._setShaderValueBuffer(23,r._rgbElements),e._setShaderValueBuffer(24,a._alphaElements),e._setShaderValueBuffer(25,a._rgbElements);this._colorOverLifetime=t}),_(0,e,"sizeOverLifetime",function(){return this._sizeOverLifetime},function(t){var e=this._ownerRender;if(t){var i=t.size,n=i.separateAxes,r=i.type;if(t.enbale)switch(r){case 0:n?e._addShaderDefine(vn.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE):e._addShaderDefine(vn.SHADERDEFINE_SIZEOVERLIFETIMECURVE);break;case 2:n?e._addShaderDefine(vn.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE):e._addShaderDefine(vn.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES)}else e._removeShaderDefine(vn.SHADERDEFINE_SIZEOVERLIFETIMECURVE),e._removeShaderDefine(vn.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE),e._removeShaderDefine(vn.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES),e._removeShaderDefine(vn.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE);switch(r){case 0:n?(e._setShaderValueBuffer(27,i.gradientX._elements),e._setShaderValueBuffer(28,i.gradientY._elements),e._setShaderValueBuffer(29,i.gradientZ._elements)):e._setShaderValueBuffer(26,i.gradient._elements);break;case 2:n?(e._setShaderValueBuffer(27,i.gradientXMin._elements),e._setShaderValueBuffer(31,i.gradientXMax._elements),e._setShaderValueBuffer(28,i.gradientYMin._elements),e._setShaderValueBuffer(32,i.gradientYMax._elements),e._setShaderValueBuffer(29,i.gradientZMin._elements),e._setShaderValueBuffer(33,i.gradientZMax._elements)):(e._setShaderValueBuffer(26,i.gradientMin._elements),e._setShaderValueBuffer(30,i.gradientMax._elements))}}else e._removeShaderDefine(vn.SHADERDEFINE_SIZEOVERLIFETIMECURVE),e._removeShaderDefine(vn.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE),e._removeShaderDefine(vn.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES),e._removeShaderDefine(vn.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE),e._setShaderValueBuffer(27,null),e._setShaderValueBuffer(31,null),e._setShaderValueBuffer(28,null),e._setShaderValueBuffer(32,null),e._setShaderValueBuffer(29,null),e._setShaderValueBuffer(33,null),e._setShaderValueBuffer(26,null),e._setShaderValueBuffer(30,null);this._sizeOverLifetime=t}),_(0,e,"textureSheetAnimation",function(){return this._textureSheetAnimation},function(t){var e=this._ownerRender;if(t){var i=t.frame,n=i.type;if(t.enable)switch(n){case 1:e._addShaderDefine(vn.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE);break;case 3:e._addShaderDefine(vn.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE)}else e._removeShaderDefine(vn.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE),e._removeShaderDefine(vn.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE);if(1===n||3===n){e._setShaderValueInt(48,t.cycles);var r=t.tiles,a=this._uvLength.elements;a[0]=1/r.x,a[1]=1/r.y,e._setShaderValueVector2(49,this._uvLength)}switch(n){case 1:e._setShaderValueBuffer(50,i.frameOverTimeData._elements);break;case 3:e._setShaderValueBuffer(50,i.frameOverTimeDataMin._elements),e._setShaderValueBuffer(51,i.frameOverTimeDataMax._elements)}}else e._removeShaderDefine(vn.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE),e._removeShaderDefine(vn.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE),e._setShaderValueInt(48,void 0),e._setShaderValueVector2(49,null),e._setShaderValueBuffer(50,null),e._setShaderValueBuffer(51,null);this._textureSheetAnimation=t}),_(0,e,"_vertexBufferCount",function(){return 1}),_(0,e,"triangleCount",function(){return this._indexBuffer?this._indexBuffer.indexCount/3:0}),_(0,e,"_originalBoundingBox",function(){return this._boundingBox}),_(0,e,"_originalBoundingBoxCorners",function(){return this._boundingBoxCorners}),Z.halfKSqrtOf2=.71,c(Z,["_RANDOMOFFSET",function(){return this._RANDOMOFFSET=new Uint32Array([592910910,3276756734,322376503,306581307,1793934638,3737431713,2527743459,2368504881,4085612399,3774601268,326370691,1494990940,1089181156,3159510623,2941263940,2786374529,271901988,4233252447])},"_maxElapsedTime",function(){return this._maxElapsedTime=1/3},"_tempVector30",function(){return this._tempVector30=new Oe},"_tempVector31",function(){return this._tempVector31=new Oe},"_tempVector32",function(){return this._tempVector32=new Oe},"_tempVector33",function(){return this._tempVector33=new Oe},"_tempVector34",function(){return this._tempVector34=new Oe},"_tempVector35",function(){return this._tempVector35=new Oe},"_tempVector36",function(){return this._tempVector36=new Oe},"_tempVector37",function(){return this._tempVector37=new Oe},"_tempVector38",function(){return this._tempVector38=new Oe},"_tempVector39",function(){return this._tempVector39=new Oe},"_tempPosition",function(){return this._tempPosition=new Oe},"_tempDirection",function(){return this._tempDirection=new Oe}]),Z}(ti),Ci=function(t){function e(t){this._finalGravity=new Oe,this._tempRotationMatrix=new De,e.__super.call(this,t),this._defaultBoundBox=new xe(new Oe,new Oe),this._renderMode=-1,this.stretchedBillboardCameraSpeedScale=0,this.stretchedBillboardSpeedScale=0,this.stretchedBillboardLengthScale=1}m(e,"laya.d3.core.particleShuriKen.ShurikenParticleRender",t);var i=e.prototype;return i._calculateBoundingBox=function(){var t=this._boundingBox.min.elements;t[0]=-Number.MAX_VALUE,t[1]=-Number.MAX_VALUE,t[2]=-Number.MAX_VALUE;var e=this._boundingBox.min.elements;e[0]=Number.MAX_VALUE,e[1]=Number.MAX_VALUE,e[2]=Number.MAX_VALUE},i._calculateBoundingSphere=function(){var t=this._owner.particleSystem._boundingSphere,e=NaN,i=this._owner.transform,n=i.scale.elements,r=Math.abs(n[0]),a=Math.abs(n[1]),s=Math.abs(n[2]);e=a<=r&&s<=r?r:s<=a?a:s,Oe.transformCoordinate(t.center,i.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=t.radius*e},i._renderUpdate=function(t){var e=this._owner.particleSystem;if(!S.stage.isVisibility||!e.isAlive)return!1;var i=this._owner.transform;switch(e.simulationSpace){case 0:break;case 1:this._setShaderValueColor(0,i.position),this._setShaderValueColor(1,i.rotation);break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}switch(e.scaleMode){case 0:var n=i.scale;this._setShaderValueColor(4,n),this._setShaderValueColor(5,n);break;case 1:var r=i.localScale;this._setShaderValueColor(4,r),this._setShaderValueColor(5,r);break;case 2:this._setShaderValueColor(4,i.scale),this._setShaderValueColor(5,Oe.ONE)}var a=this._finalGravity.elements,s=Ye.gravity.elements,o=e.gravityModifier;return a[0]=s[0]*o,a[1]=s[1]*o,a[2]=s[2]*o,this._setShaderValueBuffer(7,a),this._setShaderValueInt(11,e.simulationSpace),this._setShaderValueBool(8,e.threeDStartRotation),this._setShaderValueInt(6,e.scaleMode),this._setShaderValueInt(9,this.stretchedBillboardLengthScale),this._setShaderValueInt(10,this.stretchedBillboardSpeedScale),this._setShaderValueNumber(12,e._currentTime),Qe.debugMode&&this._renderRenderableBoundBox(),!0},i._destroy=function(){t.prototype._destroy.call(this),this._mesh&&(this._mesh._removeReference(),this._mesh=null)},_(0,i,"boundingBox",function(){return this._owner.particleSystem.isAlive?(this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox):this._defaultBoundBox}),_(0,i,"renderMode",function(){return this._renderMode},function(t){if(this._renderMode!==t){switch(this._renderMode){case 0:this._removeShaderDefine(vn.SHADERDEFINE_RENDERMODE_BILLBOARD);break;case 1:this._removeShaderDefine(vn.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);break;case 2:this._removeShaderDefine(vn.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);break;case 3:this._removeShaderDefine(vn.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);break;case 4:this._removeShaderDefine(vn.SHADERDEFINE_RENDERMODE_MESH)}switch(this._renderMode=t){case 0:this._addShaderDefine(vn.SHADERDEFINE_RENDERMODE_BILLBOARD);break;case 1:this._addShaderDefine(vn.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);break;case 2:this._addShaderDefine(vn.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);break;case 3:this._addShaderDefine(vn.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);break;case 4:this._addShaderDefine(vn.SHADERDEFINE_RENDERMODE_MESH);break;default:throw new Error("ShurikenParticleRender: unknown renderMode Value.")}this._owner.particleSystem._initBufferDatas()}}),_(0,i,"mesh",function(){return this._mesh},function(t){this._mesh!==t&&(this._mesh&&this._mesh._removeReference(),(this._mesh=t)&&t._addReference(),this._owner.particleSystem._initBufferDatas())}),e}(ei),Ai=function(e){function i(t){this._owner=null,this._trailRenderElements=null,this._minVertexDistance=NaN,this._widthMultiplier=NaN,this._time=NaN,this._widthCurve=null,this._colorGradient=null,this._textureMode=0,this._curtime=0,this._curSubTrailFinishCurTime=0,this._curSubTrailFinished=!1,this._hasLifeSubTrail=!1,this._trailTotalLength=0,this._trailSupplementLength=0,this._trailDeadLength=0,this._trailRenderElementIndex=0,i.__super.call(this),this._curSubTrailFinishPosition=new Oe,this._curSubTrailFinishDirection=new Oe,this._owner=t,this._trailRenderElements=[],this.addRenderElement()}m(i,"laya.d3.core.trail.TrailFilter",e);var t=i.prototype;return t.getRenderElementsCount=function(){return this._trailRenderElements.length},t.addRenderElement=function(){for(var t=0;t<this._trailRenderElements.length;t++)if(1==this._trailRenderElements[t]._isDead)return this._trailRenderElements[t].reActivate(),t;var e=new st(this);return this._trailRenderElements.push(e),this._trailRenderElements.length-1},t.getRenderElement=function(t){return this._trailRenderElements[t]},t._update=function(t){this._curtime+=t.elapsedTime/1e3,this._owner._render._setShaderValueNumber(3,this._curtime),this._curSubTrailFinished&&(this._curSubTrailFinished=!1,this._trailRenderElementIndex=this.addRenderElement(),this.event("trailfilterchange",[this._trailRenderElementIndex,this._trailRenderElements[this._trailRenderElementIndex]]))},t._destroy=function(){e.prototype._destroy.call(this);for(var t=0;t<this._trailRenderElements.length;t++)this._trailRenderElements[t]._destroy();this._trailRenderElements=null,this._widthCurve=null,this._colorGradient=null,this._curSubTrailFinishPosition=null,this._curSubTrailFinishDirection=null},_(0,t,"widthMultiplier",function(){return this._widthMultiplier},function(t){this._widthMultiplier=t}),_(0,t,"time",function(){return this._time},function(t){this._time=t,this._owner._render._setShaderValueNumber(4,t)}),_(0,t,"widthCurve",function(){return this._widthCurve},function(t){this._widthCurve=t;var e,i=new Float32Array(4*t.length),n=0,r=0;for(n=0,e=t.length;n<e;n++)i[r++]=t[n].time,i[r++]=t[n].inTangent,i[r++]=t[n].outTangent,i[r++]=t[n].value;this._owner._render._setShaderValueBuffer(5,i),this._owner._render._setShaderValueInt(6,t.length)}),_(0,t,"minVertexDistance",function(){return this._minVertexDistance},function(t){this._minVertexDistance=t}),_(0,t,"colorGradient",function(){return this._colorGradient},function(t){this._colorGradient=t,this._owner._render._setShaderValueBuffer(7,t._colorKeyData),this._owner._render._setShaderValueBuffer(8,t._alphaKeyData),0==t.mode?this._owner._render._addShaderDefine(xn.SHADERDEFINE_GRADIENTMODE_BLEND):this._owner._render._removeShaderDefine(xn.SHADERDEFINE_GRADIENTMODE_BLEND)}),_(0,t,"textureMode",function(){return this._textureMode},function(t){this._textureMode=t}),i}(ti),Ri=function(t){function e(t){e.__super.call(this,t)}m(e,"laya.d3.core.trail.TrailRenderer",ei);var i=e.prototype;return i._calculateBoundingBox=function(){var t=this._boundingBox.min.elements;t[0]=-Number.MAX_VALUE,t[1]=-Number.MAX_VALUE,t[2]=-Number.MAX_VALUE;var e=this._boundingBox.min.elements;e[0]=Number.MAX_VALUE,e[1]=Number.MAX_VALUE,e[2]=Number.MAX_VALUE},i._calculateBoundingSphere=function(){var t=this._boundingSphere.center.elements;t[0]=0,t[1]=0,t[2]=0,this._boundingSphere.radius=Number.MAX_VALUE},i._renderUpdate=function(t){return!0},e}(),Li=function(t){function e(t){this._floatCountPerVertex=6,this._owner=null,this._vertices=null,this._vertexBuffer=null,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._currentTime=NaN,this._drawCounter=0,this.scLeft=null,this.scRight=null,this._numPositionMode=0,this._numPositionVelocityMode=0,this._lastTime=NaN,this._needPatch=!1,this._lastPatchAddPos0=null,this._lastPatchAddPos1=null,this._lastPatchAddTime=NaN,this.lifeTime=NaN,this.minSegmentDistance=NaN,this.minInterpDistance=NaN,this.maxSlerpCount=0,this._maxSegments=0,e.__super.call(this),this._tempVector0=new Oe,this._tempVector1=new Oe,this._tempVector2=new Oe,this._tempVector3=new Oe,this._posModeLastPosition0=new Oe,this._posModeLastPosition1=new Oe,this._posModePosition0=new Oe,this._posModePosition1=new Oe,this._posVelModePosition0=new Oe,this._posVelModeVelocity0=new Oe,this._posVelModePosition1=new Oe,this._posVelModeVelocity1=new Oe,this._owner=t,this._lastTime=0,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._currentTime=0,this._drawCounter=0,this._needPatch=!1,this._lastPatchAddPos0=new Oe,this._lastPatchAddPos1=new Oe,this.scLeft=new N,this.scRight=new N,this.lifeTime=.5,this.minSegmentDistance=.1,this.minInterpDistance=.6,this.maxSlerpCount=128,this._maxSegments=200,this._owner.on("activeinhierarchychanged",this,this._onActiveHierarchyChanged)}m(e,"laya.d3.resource.tempelet.GlitterTemplet",t);var i=e.prototype;return S.imps(i,{"laya.d3.core.render.IRenderable":!0}),i._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},i._getIndexBuffer=function(){return null},i._initialize=function(){this._vertexBuffer=Zi.create(pt.vertexDeclaration,2*this.maxSegments,35048),this._vertices=new Float32Array(this.maxSegments*this._floatCountPerVertex*2)},i._onActiveHierarchyChanged=function(t){t||(this._numPositionMode=0,this._numPositionVelocityMode=0,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._currentTime=0,this._drawCounter=0)},i._updateTextureCoordinates=function(){this._firstActiveElement<this._firstFreeElement?this._updateSubTextureCoordinates(this._firstActiveElement,2*(this._firstFreeElement-this._firstActiveElement)):(this._updateSubTextureCoordinates(this._firstActiveElement,2*(this.maxSegments-this._firstActiveElement)),0<this._firstFreeElement&&this._updateSubTextureCoordinates(0,2*this._firstFreeElement))},i._updateSubTextureCoordinates=function(t,e){for(var i=2*t,n=0;n<e;n+=2){var r=i+n,a=r*this._floatCountPerVertex,s=(r+1)*this._floatCountPerVertex;this._vertices[a+3]=this._vertices[s+3]=(this._vertices[a+5]-this._currentTime)/this.lifeTime}},i._retireActiveGlitter=function(){for(var t=this.lifeTime,e=2*this._floatCountPerVertex;this._firstActiveElement!=this._firstNewElement;){var i=this._firstActiveElement*e+5;if(this._currentTime-this._vertices[i]<t)break;this._vertices[i]=this._drawCounter,this._firstActiveElement++,this._firstActiveElement>=this.maxSegments&&(this._firstActiveElement=0)}},i._freeRetiredGlitter=function(){for(var t=2*this._floatCountPerVertex;this._firstRetiredElement!=this._firstActiveElement;){if(this._drawCounter-this._vertices[this._firstRetiredElement*t+5]<3)break;this._firstRetiredElement++,this._firstRetiredElement>=this.maxSegments&&(this._firstRetiredElement=0)}},i._calcVelocity=function(t,e,i){Oe.subtract(t,e,i),Oe.scale(i,.5,i)},i._addNewGlitterSegementToVertexBuffer=function(){var t=0;this._firstActiveElement<this._firstFreeElement?(t=2*this._firstActiveElement*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,t,t,2*(this._firstFreeElement-this._firstActiveElement)*this._floatCountPerVertex)):(t=2*this._firstActiveElement*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,t,t,2*(this.maxSegments-this._firstActiveElement)*this._floatCountPerVertex),0<this._firstFreeElement&&this._vertexBuffer.setData(this._vertices,0,0,2*this._firstFreeElement*this._floatCountPerVertex)),this._firstNewElement=this._firstFreeElement},i._addGlitter=function(t,e,i){this._needPatch&&(this._needPatch=!1,this._addGlitter(this._lastPatchAddPos0,this._lastPatchAddPos1,this._lastPatchAddTime));var n=this._firstFreeElement+1;n>=this.maxSegments&&(n=0,t.cloneTo(this._lastPatchAddPos0),e.cloneTo(this._lastPatchAddPos1),this._lastPatchAddTime=i,this._needPatch=!0),n===this._firstRetiredElement&&console.log("GlitterTemplet:current segement count have large than maxSegments,please adjust the  value of maxSegments or add Glitter Vertex Frequency.");var r=t.elements,a=e.elements,s=0,o=this._firstFreeElement*this._floatCountPerVertex*2;for(s=0;s<3;s++)this._vertices[o+s]=r[s];this._vertices[o+3]=0,this._vertices[o+4]=0,this._vertices[o+5]=i;var l=o+this._floatCountPerVertex;for(s=0;s<3;s++)this._vertices[l+s]=a[s];this._vertices[l+3]=0,this._vertices[l+4]=1,this._vertices[l+5]=i,this._firstFreeElement=n},i._update=function(t){this._currentTime+=t/1e3,this._retireActiveGlitter(),this._freeRetiredGlitter(),this._firstActiveElement==this._firstFreeElement&&(this._currentTime=0),this._firstRetiredElement==this._firstActiveElement&&(this._drawCounter=0),this._updateTextureCoordinates()},i._beforeRender=function(t){return this._firstNewElement!=this._firstFreeElement&&this._addNewGlitterSegementToVertexBuffer(),this._drawCounter++,this._firstActiveElement!=this._firstFreeElement&&(this._vertexBuffer.bindWithIndexBuffer(null),!0)},i._render=function(t){var e=0,i=R.mainContext;this._firstActiveElement<this._firstFreeElement?(e=2*(this._firstFreeElement-this._firstActiveElement),i.drawArrays(5,2*this._firstActiveElement,e),M.trianglesFaces+=e-2,M.drawCall++):(e=2*(this.maxSegments-this._firstActiveElement),i.drawArrays(5,2*this._firstActiveElement,e),M.trianglesFaces+=e-2,M.drawCall++,0<this._firstFreeElement&&(e=2*this._firstFreeElement,i.drawArrays(5,0,e),M.trianglesFaces+=e-2,M.drawCall++))},i.addVertexPosition=function(t,e){if(this._owner.activeInHierarchy)if(this._numPositionMode<2)0===this._numPositionMode?(t.cloneTo(this._posModeLastPosition0),e.cloneTo(this._posModeLastPosition1)):(t.cloneTo(this._posModePosition0),e.cloneTo(this._posModePosition1)),this._numPositionMode++;else{var i=this._tempVector2;this._calcVelocity(t,this._posModeLastPosition0,i);var n=this._tempVector3;this._calcVelocity(e,this._posModeLastPosition1,n),this.addVertexPositionVelocity(this._posModePosition0,i,this._posModePosition1,n),this._posModePosition0.cloneTo(this._posModeLastPosition0),this._posModePosition1.cloneTo(this._posModeLastPosition1),t.cloneTo(this._posModePosition0),e.cloneTo(this._posModePosition1)}},i.addVertexPositionVelocity=function(t,e,i,n){if(this._owner.activeInHierarchy){if(0===this._numPositionVelocityMode)this._numPositionVelocityMode++;else{var r=this._tempVector0;Oe.subtract(t,this._posVelModePosition0,r);var a=Oe.scalarLength(r);Oe.subtract(i,this._posVelModePosition1,r);var s=Oe.scalarLength(r),o=0,l=l;if(a<l&&s<l)return;if(1===(o=1+Math.floor(Math.max(a,s)/this.minInterpDistance)))this._addGlitter(t,i,this._currentTime);else{o=Math.min(o,this.maxSlerpCount),this.scLeft.Init(this._posVelModePosition0,this._posVelModeVelocity0,t,e),this.scRight.Init(this._posVelModePosition1,this._posVelModeVelocity1,i,n);for(var h=1/o,u=h,c=this._currentTime-this._lastTime,_=1;_<=o;_++){var d=this._tempVector0;this.scLeft.Slerp(u,d);var f=this._tempVector1;this.scRight.Slerp(u,f);var p=this._lastTime+c*_/o;this._addGlitter(d,f,p),u+=h}}}this._lastTime=this._currentTime,t.cloneTo(this._posVelModePosition0),e.cloneTo(this._posVelModeVelocity0),i.cloneTo(this._posVelModePosition1),n.cloneTo(this._posVelModeVelocity1)}},i._destroy=function(){t.prototype._destroy.call(this),this._tempVector0=null,this._tempVector1=null,this._tempVector2=null,this._tempVector3=null,this._owner=null,this._vertices=null,this._vertexBuffer.destroy(),this._vertexBuffer=null,this.scLeft=null,this.scRight=null,this._posModeLastPosition0=null,this._posModeLastPosition1=null,this._posModePosition0=null,this._posModePosition1=null,this._posVelModePosition0=null,this._posVelModeVelocity0=null,this._posVelModePosition1=null,this._posVelModeVelocity1=null,this._lastPatchAddPos0=null,this._lastPatchAddPos1=null},i._getVertexBuffers=function(){return null},i._renderRuntime=function(t,e,i){},_(0,i,"maxSegments",function(){return this._maxSegments-1},function(t){var e=t+1;e!==this._maxSegments&&(this._maxSegments=e,this._vertexBuffer&&this._vertexBuffer.destroy(),this._initialize())}),_(0,i,"_vertexBufferCount",function(){return 1}),_(0,i,"triangleCount",function(){var t=0;return this._firstActiveElement<this._firstFreeElement?t=2*(this._firstFreeElement-this._firstActiveElement)-2:(t=2*(this.maxSegments-this._firstActiveElement)-2,t+=2*this._firstFreeElement-2),t}),_(0,i,"_originalBoundingSphere",function(){return S.superGet(ti,this,"_originalBoundingSphere")}),_(0,i,"_originalBoundingBox",function(){return S.superGet(ti,this,"_originalBoundingBox")}),e}(ti),Oi=function(t){function h(t,e,i,n,r,a,s,o){this._owner=null,this._gridSize=NaN,this.memorySize=0,this._numberVertices=0,this._maxNumberIndices=0,this._currentNumberIndices=0,this._numberTriangle=0,this._vertexBuffer=null,this._indexBuffer=null,this._boundingSphere=null,this._boundingBox=null,this._indexArrayBuffer=null,this._boundingBoxCorners=null,this._leafs=null,this._leafNum=0,this._terrainHeightData=null,this._terrainHeightDataWidth=0,this._terrainHeightDataHeight=0,this._chunkOffsetX=0,this._chunkOffsetZ=0,this._cameraCoordinateInverse=!1,this._cameraPos=null,this._currentLOD=0,this._perspectiveFactor=NaN,this._LODTolerance=0,h.__super.call(this),this._owner=t,this._cameraPos=new Oe,this._chunkOffsetX=e,this._chunkOffsetZ=i,this._gridSize=n,this._terrainHeightData=r,this._terrainHeightDataWidth=a,this._terrainHeightDataHeight=s,this._leafNum=ze.CHUNK_GRID_NUM/ze.LEAF_GRID_NUM*(ze.CHUNK_GRID_NUM/ze.LEAF_GRID_NUM),this._leafs=w(this._leafNum),this._cameraCoordinateInverse=o;for(var l=0;l<this._leafNum;l++)this._leafs[l]=new ze;this.recreateResource()}m(h,"laya.d3.terrain.TerrainFilter",t);var e=h.prototype;return S.imps(e,{"laya.d3.core.render.IRenderable":!0}),e._destroy=function(){t.prototype._destroy.call(this),this._owner=null,this._vertexBuffer&&this._vertexBuffer.destroy(),this._indexBuffer&&this._indexBuffer.destroy()},e.recreateResource=function(){this._currentNumberIndices=0,this._numberTriangle=0;var t=ze.LEAF_VERTEXT_COUNT,e=ze.LEAF_MAX_INDEX_COUNT;this._numberVertices=t*this._leafNum,this._maxNumberIndices=e*this._leafNum,this._indexArrayBuffer=new Uint16Array(this._maxNumberIndices);var i=_e.vertexDeclaration,n=i.vertexStride/4,r=new Float32Array(this._numberVertices*n),a=ze.CHUNK_GRID_NUM/ze.LEAF_GRID_NUM,s=0,o=0,l=0;for(s=0;s<this._leafNum;s++)o=s%a,l=Math.floor(s/a),this._leafs[s].calcVertextBuffer(this._chunkOffsetX,this._chunkOffsetZ,o*ze.LEAF_GRID_NUM,l*ze.LEAF_GRID_NUM,this._gridSize,r,s*ze.LEAF_PLANE_VERTEXT_COUNT,n,this._terrainHeightData,this._terrainHeightDataWidth,this._terrainHeightDataHeight,this._cameraCoordinateInverse);for(s=0;s<this._leafNum;s++)o=s%a,l=Math.floor(s/a),this._leafs[s].calcSkirtVertextBuffer(this._chunkOffsetX,this._chunkOffsetZ,o*ze.LEAF_GRID_NUM,l*ze.LEAF_GRID_NUM,this._gridSize,r,this._leafNum*ze.LEAF_PLANE_VERTEXT_COUNT+s*ze.LEAF_SKIRT_VERTEXT_COUNT,n,this._terrainHeightData,this._terrainHeightDataWidth,this._terrainHeightDataHeight);this.assembleIndexInit(),this._vertexBuffer=new Zi(i,this._numberVertices,35044,!1),this._indexBuffer=new ji("ushort",this._maxNumberIndices,35044,!1),this._vertexBuffer.setData(r),this._indexBuffer.setData(this._indexArrayBuffer),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.calcOriginalBoudingBoxAndSphere()},e.setLODLevel=function(t){if(4!=t.length)return!0;var e=(t[0]+1<<24)+(t[1]+1<<16)+(t[2]+1<<8)+(t[3]+1);return this._currentLOD!=e&&(this._currentLOD=e,!0)},e.assembleIndexInit=function(){this._currentNumberIndices=0;for(var t=this._numberTriangle=0,e=0;e<this._leafNum;e++){var i=ze.getPlaneLODIndex(e,0);this._indexArrayBuffer.set(i,t),t+=i.length;var n=ze.getSkirtLODIndex(e,0);this._indexArrayBuffer.set(n,t),t+=n.length,this._currentNumberIndices+=i.length+n.length}this._numberTriangle=this._currentNumberIndices/3},e.isNeedAssemble=function(t,e){var i=Math.min(t.viewport.width,t.viewport.height)/(2*Math.tan(Math.PI*t.fieldOfView/180));return this._perspectiveFactor!=i?(this._perspectiveFactor=i,1):this._LODTolerance!=fn.LOD_TOLERANCE_VALUE?(this._LODTolerance=fn.LOD_TOLERANCE_VALUE,1):0==Oe.equals(e,this._cameraPos)?(this._cameraPos.x=e.x,this._cameraPos.y=e.y,this._cameraPos.z=e.z,2):0},e.assembleIndex=function(t,e){var i=this.isNeedAssemble(t,e);if(0<i){for(var n=0;n<this._leafNum;n++)h._TEMP_ARRAY_BUFFER[n]=this._leafs[n].determineLod(e,this._perspectiveFactor,fn.LOD_TOLERANCE_VALUE,1==i);if(this.setLODLevel(h._TEMP_ARRAY_BUFFER)){this._currentNumberIndices=0;var r=this._numberTriangle=0;for(n=0;n<this._leafNum;n++){var a=h._TEMP_ARRAY_BUFFER[n],s=ze.getPlaneLODIndex(n,a);this._indexArrayBuffer.set(s,r),r+=s.length;var o=ze.getSkirtLODIndex(n,a);this._indexArrayBuffer.set(o,r),r+=o.length,this._currentNumberIndices+=s.length+o.length}return this._numberTriangle=this._currentNumberIndices/3,!0}}return!1},e.calcOriginalBoudingBoxAndSphere=function(){for(var t=new Le(2147483647,-2147483647),e=0;e<this._leafNum;e++)t.x=this._leafs[e]._sizeOfY.x<t.x?this._leafs[e]._sizeOfY.x:t.x,t.y=this._leafs[e]._sizeOfY.y>t.y?this._leafs[e]._sizeOfY.y:t.y;var i=new Oe(this._chunkOffsetX*ze.CHUNK_GRID_NUM*this._gridSize,t.x,this._chunkOffsetZ*ze.CHUNK_GRID_NUM*this._gridSize),n=new Oe((this._chunkOffsetX+1)*ze.CHUNK_GRID_NUM*this._gridSize,t.y,(this._chunkOffsetZ+1)*ze.CHUNK_GRID_NUM*this._gridSize);ze.__ADAPT_MATRIX__&&(Oe.transformV3ToV3(i,ze.__ADAPT_MATRIX__,i),Oe.transformV3ToV3(n,ze.__ADAPT_MATRIX__,n)),this._boundingBox=new xe(i,n);var r=new Oe;Oe.subtract(n,i,r),Oe.scale(r,.5,r);var a=new Oe;Oe.add(i,r,a),this._boundingSphere=new Te(a,Oe.scalarLength(r)),this._boundingBoxCorners=w(8,null),this._boundingBox.getCorners(this._boundingBoxCorners)},e.calcLeafBoudingBox=function(t){for(var e=0;e<this._leafNum;e++)this._leafs[e].calcLeafBoudingBox(t)},e.calcLeafBoudingSphere=function(t,e){for(var i=0;i<this._leafNum;i++)this._leafs[i].calcLeafBoudingSphere(t,e)},e._getVertexBuffer=function(t){return void 0===t&&(t=0),0==t?this._vertexBuffer:null},e._getIndexBuffer=function(){return this._indexBuffer},e._beforeRender=function(t){if(this._vertexBuffer._bind(),this._indexBuffer._bind(),0==t.renderElement._material.blend){var e=t.camera;this.assembleIndex(e,e.position)&&this._indexBuffer.setData(this._indexArrayBuffer)}return!0},e._getVertexBuffers=function(){return null},e._render=function(t){R.mainContext.drawElements(fn.RENDER_LINE_MODEL?1:4,this._currentNumberIndices,5123,0),M.trianglesFaces+=this._numberTriangle,M.drawCall++},e._renderRuntime=function(t,e,i){},_(0,e,"_originalBoundingSphere",function(){return this._boundingSphere}),_(0,e,"_originalBoundingBox",function(){return this._boundingBox}),_(0,e,"_vertexBufferCount",function(){return this._numberVertices}),_(0,e,"triangleCount",function(){return this._numberTriangle}),c(h,["_TEMP_ARRAY_BUFFER",function(){return this._TEMP_ARRAY_BUFFER=new Uint32Array(ze.CHUNK_GRID_NUM/ze.LEAF_GRID_NUM*ze.CHUNK_GRID_NUM/ze.LEAF_GRID_NUM)}]),h}(ti),Pi=function(t){function e(t){this._terrainSprite3DOwner=null,e.__super.call(this,t),this._terrainSprite3DOwner=t}m(e,"laya.d3.terrain.TerrainRender",t);var i=e.prototype;return i._calculateBoundingSphere=function(){var t=this._terrainSprite3DOwner.terrainFilter;if(null==t)this._boundingSphere.toDefault();else{var e=t._originalBoundingSphere,i=NaN,n=this._terrainSprite3DOwner.transform,r=n.scale;i=r.x>=r.y&&r.x>=r.z?r.x:r.y>=r.z?r.y:r.z,Oe.transformCoordinate(e.center,n.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=e.radius*i,t.calcLeafBoudingSphere(n.worldMatrix,i)}},i._calculateBoundingBox=function(){var t=this._terrainSprite3DOwner.terrainFilter;if(null==t)this._boundingBox.toDefault();else{for(var e=this._terrainSprite3DOwner.transform.worldMatrix,i=t._boundingBoxCorners,n=0;n<8;n++)Oe.transformCoordinate(i[n],e,ei._tempBoundBoxCorners[n]);xe.createfromPoints(ei._tempBoundBoxCorners,this._boundingBox),t.calcLeafBoudingBox(e)}},i._renderUpdate=function(t){this._setShaderValueMatrix4x4(0,this._owner.transform.worldMatrix);var e=this._owner.getProjectionViewWorldMatrix(t);return this._setShaderValueMatrix4x4(1,e),!0},i._destroy=function(){t.prototype._destroy.call(this),this._terrainSprite3DOwner=null},e}(ei),Ni=(function(t){function e(t){e.__super.call(this,t)}m(e,"laya.d3.water.WaterRender",t);var i=e.prototype;i._calculateBoundingSphere=function(){},i._calculateBoundingBox=function(){},i._destroy=function(){t.prototype._destroy.call(this)}}(ei),function(e){function n(){this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,n.__super.call(this),this._renderState=new $,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new ke,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new ht,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new Oe(.7,.7,.7),this.ambientColor=new Oe(.212,.227,.259),R.shaderHighPrecision&&this.addShaderDefine(ui.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}m(n,"laya.d3.core.scene.Scene",e);var t=n.prototype;return S.imps(t,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),t._setUrl=function(t){this._url=t},t._getGroup=function(){return this._group},t._setGroup=function(t){this._group=t},t._display=function(){S.stage._scenes.push(this),S.stage._scenes.sort(n._sortScenes);for(var t=0,e=this._childs.length;t<e;t++){var i=this._childs[t];i.active&&i._activeHierarchy()}},t._unDisplay=function(){var t=S.stage._scenes;t.splice(t.indexOf(this),1);for(var e=0,i=this._childs.length;e<i;e++){var n=this._childs[e];n.active&&n._inActiveHierarchy()}},t._addChild3D=function(t){t.transform._onWorldTransform(),t._setBelongScene(this),this.displayedInStage&&t.active&&t._activeHierarchy()},t._removeChild3D=function(t){t.transform.parent=null,this.displayedInStage&&t.active&&t._inActiveHierarchy(),t._setUnBelongScene()},t.initOctree=function(t,e,i,n,r){void 0===r&&(r=6),this.treeSize=new Oe(t,e,i),this.treeLevel=r,this.treeRoot=new tt(this,0),this.treeRoot.init(n,this.treeSize)},t._prepareUpdateToRenderState=function(t,e){e.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,e.scene=this},t._prepareSceneToRender=function(t){var e=this._lights.length;if(0<e)for(var i=0,n=0;n<e&&!(this._lights[n]._prepareToScene(t)&&++i>=this._enableLightCount);n++);},t._updateChilds=function(t){for(var e=0,i=this._childs.length;e<i;++e)this._childs[e]._update(t)},t._updateChildsConch=function(t){for(var e=0,i=this._childs.length;e<i;++e)this._childs[e]._updateConch(t)},t._preRenderScene=function(t,e,i){var n,r=e._viewMatrix,a=e._projectionMatrix,s=e._projectionViewMatrix,o=0,l=e.camera;for(l.useOcclusionCulling?this.treeRoot?ut.renderObjectCullingOctree(i,this,l,r,a,s):ut.renderObjectCulling(i,this,l,r,a,s):ut.renderObjectCullingNoBoundFrustum(this,l,r,a,s),o=0,n=this._quenes.length;o<n;o++)this._quenes[o]&&this._quenes[o]._preRender(e)},t._clear=function(t,e){var i=e._viewport,n=e.camera,r=i.x,a=n.renderTargetSize.height-i.y-i.height,s=i.width,o=i.height;t.viewport(r,a,s,o);var l=256,h=n.renderTarget;switch(n.clearFlag){case 0:var u=n.clearColor;if(u){t.enable(3089),t.scissor(r,a,s,o);var c=u.elements;t.clearColor(c[0],c[1],c[2],c[3]),l|=16384}if(h)switch(u||(l=16384),h.depthStencilFormat){case 33189:l|=256;break;case 36168:l|=1024;break;case 34041:l|=256,l|=1024}t.clear(l),u&&t.disable(3089);break;case 1:case 2:if(h)switch(l=16384,h.depthStencilFormat){case 33189:l|=256;break;case 36168:l|=1024;break;case 34041:l|=256,l|=1024}t.clear(l);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},t._renderScene=function(t,e){var i,n,r=e.camera,a=0;for(a=0;a<2;a++)(n=this._quenes[a])&&(r.renderTarget?n._render(e,!0):n._render(e,!1));if(1===r.clearFlag){var s=r.sky;s&&(L.setCullFace(t,!1),L.setDepthFunc(t,515),L.setDepthMask(t,!1),s._render(e),L.setDepthFunc(t,513),L.setDepthMask(t,!0))}for(a=2,i=this._quenes.length;a<i;a++)(n=this._quenes[a])&&(n._sortAlpha(e.camera.transform.position),r.renderTarget?n._render(e,!0):n._render(e,!1))},t._set3DRenderConfig=function(t){t.disable(3042),L._blend=!1,t.blendFunc(770,771),L._sFactor=770,L._dFactor=771,t.disable(2929),L._depthTest=!1,t.enable(2884),L._cullFace=!0,t.depthMask(1),L._depthMask=!0,t.frontFace(2304),L._frontFace=2304},t._set2DRenderConfig=function(t){L.setBlend(t,!0),L.setBlendFunc(t,1,771),L.setDepthTest(t,!1),L.setCullFace(t,!1),L.setDepthMask(t,!0),L.setFrontFace(t,2305),t.viewport(0,0,g.width,g.height)},t._parseCustomProps=function(t,e,i,n){var r=n.customProps.lightmaps,a=r.length,s=this._lightmaps;s.length=a;for(var o=0;o<a;o++)s[o]=Dt.getRes(e[r[o].replace(".exr",".png")]);this.setlightmaps(s);var l=n.customProps.ambientColor;l&&(this.ambientColor=new Oe(l[0],l[1],l[2]));var h=n.customProps.fogColor;h&&(this.fogColor=new Oe(h[0],h[1],h[2]))},t._addLight=function(t){this._lights.indexOf(t)<0&&this._lights.push(t)},t._removeLight=function(t){var e=this._lights.indexOf(t);0<=e&&this._lights.splice(e,1)},t._updateScene=function(){var t=this._renderState;this._prepareUpdateToRenderState(R.mainContext,t),this._updateComponents(t),this._updateChilds(t),this._lateUpdateComponents(t)},t._updateSceneConch=function(){var t=this._renderState;this._prepareUpdateToRenderState(R.mainContext,t),this._updateComponents(t),this._updateChildsConch(t),this._lateUpdateComponents(t),this._prepareSceneToRender(t);for(var e=0,i=this._cameraPool.length;e<i;e++){var n=this._cameraPool[e];(t.camera=n)._prepareCameraToRender()}},t._preRenderShadow=function(t,e,i,n,r){this.treeRoot?ut.renderShadowObjectCullingOctree(this,e,i,n,r):ut.renderShadowObjectCulling(this,e,i,n,r);for(var a=0,s=i.length;a<s;a++)i[a]&&i[a]._preRender(t)},t._renderShadowMap=function(t,e,i){var n=this.parallelSplitShadowMaps[0];n._calcAllLightCameraInfo(i);var r,a,s,o=n.PSSMNum;if(this._preRenderShadow(e,n._lightCulling,n._shadowQuenes,n._lightVPMatrix[0],o),this.addShaderDefine(He.SHADERDEFINE_CAST_SHADOW),1<o)for(var l=0;l<o;l++)r=n.getRenderTarget(l+1),n.beginRenderTarget(l+1),t.clearColor(1,1,1,1),t.clear(16640),t.viewport(0,0,r.width,r.height),e.camera=s=n.getLightCamera(l),s._prepareCameraToRender(),s._prepareCameraViewProject(s.viewMatrix,s.projectionMatrix),e._projectionViewMatrix=n._lightVPMatrix[l+1],(a=n._shadowQuenes[l])._preRender(e),a._renderShadow(e,!1),n.endRenderTarget(l+1);else r=n.getRenderTarget(1),n.beginRenderTarget(1),t.clearColor(1,1,1,1),t.clear(16640),t.viewport(0,0,r.width,r.height),e.camera=s=n.getLightCamera(0),s._prepareCameraToRender(),s._prepareCameraViewProject(s.viewMatrix,s.projectionMatrix),e._projectionViewMatrix=n._lightVPMatrix[0],(a=n._shadowQuenes[0])._preRender(e),a._renderShadow(e,!0),n.endRenderTarget(1);this.removeShaderDefine(He.SHADERDEFINE_CAST_SHADOW)},t.addTreeNode=function(t){this.treeRoot.addTreeNode(t)},t.removeTreeNode=function(t){this.treeSize&&t._treeNode&&t._treeNode.removeObject(t)},t.setlightmaps=function(t){this._lightmaps=t;for(var e=0,i=this._renderableSprite3Ds.length;e<i;e++)this._renderableSprite3Ds[e]._render._applyLightMapParams()},t.getlightmaps=function(){return this._lightmaps},t.addChildAt=function(t,e){if(!(t instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),0<=e&&e<=this._childs.length){if(t._parent===this){var i=this.getChildIndex(t);this._childs.splice(i,1),this._childs.splice(e,0,t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,e)),this._childChanged()}else t.parent&&t.parent.removeChild(t),this._childs===d.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(e,0,t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,e),(t.parent=this)._addChild3D(t);return t}throw new Error("appendChildAt:The index is out of bounds")},t.addChild=function(t){if(!(t instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),t._parent===this){var e=this.getChildIndex(t);e!==this._childs.length-1&&(this._childs.splice(e,1),this._childs.push(t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,this._childs.length-1)),this._childChanged())}else t.parent&&t.parent.removeChild(t),this._childs===d.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,this._childs.length-1),(t.parent=this)._childChanged(),this._addChild3D(t);return t},t.removeChildAt=function(t){var e=this.getChildAt(t);return e&&(this._removeChild3D(e),this._childs.splice(t,1),this.conchModel&&this.conchModel.removeChild(e.conchModel),e.parent=null),e},t.removeChildren=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=2147483647),this._childs&&0<this._childs.length){var i=this._childs;if(0===t&&a<=e){var n=i;this._childs=d.ARRAY_EMPTY}else n=i.splice(t,e-t);for(var r=0,a=n.length;r<a;r++)this._removeChild3D(n[r]),n[r].parent=null,this.conchModel&&this.conchModel.removeChild(n[r].conchModel)}return this},t.addFrustumCullingObject=function(t){this.treeRoot?this.addTreeNode(t):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push(t):this._cullingRenders[this._cullingRendersLength]=t,t._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},t.removeFrustumCullingObject=function(t){if(this.treeRoot)this.removeTreeNode(t);else{this._cullingRendersLength--;var e=t._indexInSceneFrustumCullingObjects;if(e!==this._cullingRendersLength){var i=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[e]=i)._indexInSceneFrustumCullingObjects=e,t._indexInSceneFrustumCullingObjects=-1}}},t.getRenderQueue=function(t){return this._quenes[t]||(this._quenes[t]=new J(this))},t.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new J(this)},t.addShaderDefine=function(t){this._shaderDefineValue|=t},t.removeShaderDefine=function(t){this._shaderDefineValue&=~t},t.addScript=function(t){return this._addComponent(t)},t.getScriptByType=function(t,e){return void 0===e&&(e=0),this._getComponentByType(t,e)},t.getScriptsByType=function(t,e){this._getComponentsByType(t,e)},t.getScriptByIndex=function(t){return this._getComponentByIndex(t)},t.removeScriptByType=function(t,e){void 0===e&&(e=0),this._removeComponentByType(t,e)},t.removeScriptsByType=function(t){this._removeComponentByType(t)},t.removeAllScript=function(){this._removeAllComponent()},t.render=function(t,e,i){(f._context.ctx._renderKey=0)<this._childs.length&&t.addRenderObject(this)},t.renderSubmit=function(){var t=R.mainContext,e=this._renderState;this._set3DRenderConfig(t),this._prepareSceneToRender(this._renderState);var i,n=0,r=0;if(Qe.debugMode||tt.debugMode)for(n=0,r=this._cameraPool.length;n<r;n++)i=this._cameraPool[n],Qe._debugPhasorSprite.begin(1,i),i.activeInHierarchy&&i._renderCamera(t,e,this),Qe._debugPhasorSprite.end();else for(n=0,r=this._cameraPool.length;n<r;n++)(i=this._cameraPool[n]).activeInHierarchy&&i._renderCamera(t,e,this);return this._set2DRenderConfig(t),1},t.onAsynLoaded=function(t,e,i){var n=e[0];if("Scene"!==n.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var r=e[1];qe._createNodeByJson(this,n,this,r),this.event("hierarchyloaded",[this]),this.__loaded=!0},t.destroy=function(t){void 0===t&&(t=!0),this.destroyed||(e.prototype.destroy.call(this,t),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,Dt.clearRes(this.url),this.loaded||Qe._cancelLoadByUrl(this.url))},t.getRenderType=function(){return 0},t.releaseRender=function(){},t.createConchModel=function(){var t=new ConchScene;return t.init(512,512,512,4),t},t._addComponent=function(t){var e,i=this._componentsMap.indexOf(t);if(-1===i)e=[],this._componentsMap.push(t),this._typeComponentsIndices.push(e);else if(e=this._typeComponentsIndices[i],this._components[e[0]].isSingleton)throw new Error("无法单实例创建"+t+"组件，"+t+"组件已存在！");var n=l.getInstance(t);e.push(this._components.length),this._components.push(n);return n._initialize(this),n},t._removeComponent=function(t,e){var i=this._typeComponentsIndices[t],n=i[e],r=this._components[n];this._components.splice(n,1),i.splice(e,1),0===i.length&&(this._typeComponentsIndices.splice(t,1),this._componentsMap.splice(t,1));for(var a=0,s=this._componentsMap.length;a<s;a++)for(var o=(i=this._typeComponentsIndices[a]).length-1;0<=o;o--){var l=i[o];if(!(n<l))break;i[o]=--l}r._destroy()},t._getComponentByType=function(t,e){void 0===e&&(e=0);var i=this._componentsMap.indexOf(t);return-1===i?null:this._components[this._typeComponentsIndices[i][e]]},t._getComponentsByType=function(t,e){var i=this._componentsMap.indexOf(t);if(-1!==i){var n=this._typeComponentsIndices[i],r=n.length;e.length=r;for(var a=0;a<r;a++)e[a]=this._components[n[a]]}else e.length=0},t._getComponentByIndex=function(t){return this._components[t]},t._removeComponentByType=function(t,e){void 0===e&&(e=0);var i=this._componentsMap.indexOf(t);-1!==i&&this._removeComponent(i,e)},t._removeComponentsByType=function(t){var e=this._componentsMap.indexOf(t);if(-1!==e)for(var i=this._typeComponentsIndices[e],n=0,r=i.length;n<r;i.length<r?r--:n++)this._removeComponent(e,n)},t._removeAllComponent=function(){for(var t=0,e=this._componentsMap.length;t<e;this._componentsMap.length<e?e--:t++)this._removeComponentsByType(this._componentsMap[t])},t._updateComponents=function(t){for(var e=0,i=this._components.length;e<i;e++){var n=this._components[e];!n.started&&(n._start(t),n.started=!0),n.enable&&n._update(t)}},t._lateUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._lateUpdate(t)}},t._preRenderUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._preRenderUpdate(t)}},t._postRenderUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._postRenderUpdate(t)}},_(0,t,"_loaded",null,function(t){this.__loaded=t}),_(0,t,"fogColor",function(){return this._fogColor},function(t){this._fogColor=t,this._shaderValues.setValue(0,t.elements)}),_(0,t,"enableFog",function(){return this._enableFog},function(t){this._enableFog!==t&&((this._enableFog=t)?(this.addShaderDefine(ui.SHADERDEFINE_FOG),this.removeShaderDefine(ui.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine(ui.SHADERDEFINE_FOG))}),_(0,t,"url",function(){return this._url}),_(0,t,"loaded",function(){return this.__loaded}),_(0,t,"enableDepthFog",function(){return this._enableDepthFog},function(t){this._enableDepthFog!=t&&((this._enableDepthFog=t)?(this.addShaderDefine(ui.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine(ui.SHADERDEFINE_FOG)):this.removeShaderDefine(ui.SAHDERDEFINE_DEPTHFOG))}),_(0,t,"fogStart",function(){return this._fogStart},function(t){this._fogStart=t,this._shaderValues.setValue(1,t)}),_(0,t,"fogRange",function(){return this._fogRange},function(t){this._fogRange=t,this._shaderValues.setValue(2,t)}),_(0,t,"ambientColor",function(){return this._ambientColor},function(t){this._ambientColor=t,this._shaderValues.setValue(21,t.elements)}),_(0,t,"scene",function(){return this}),_(0,t,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),n._sortScenes=function(t,e){if(t.parent!==S.stage||e.parent!==S.stage)return t.parent!==S.stage&&e.parent!==S.stage?n._sortScenes(t.parent,e.parent):t.parent===S.stage?-1:1;var i=S.stage._childs;return i.indexOf(t)-i.indexOf(e)},n.load=function(t){return S.loader.create(t,null,null,n)},n.FOGCOLOR=0,n.FOGSTART=1,n.FOGRANGE=2,n.LIGHTDIRECTION=3,n.LIGHTDIRCOLOR=4,n.POINTLIGHTPOS=5,n.POINTLIGHTRANGE=6,n.POINTLIGHTATTENUATION=7,n.POINTLIGHTCOLOR=8,n.SPOTLIGHTPOS=9,n.SPOTLIGHTDIRECTION=10,n.SPOTLIGHTSPOT=11,n.SPOTLIGHTRANGE=12,n.SPOTLIGHTATTENUATION=13,n.SPOTLIGHTCOLOR=14,n.SHADOWDISTANCE=15,n.SHADOWLIGHTVIEWPROJECT=16,n.SHADOWMAPPCFOFFSET=17,n.SHADOWMAPTEXTURE1=18,n.SHADOWMAPTEXTURE2=19,n.SHADOWMAPTEXTURE3=20,n.AMBIENTCOLOR=21,n}(T)),Vi=function(t){function e(t){e.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new De,this._shaderValues=new ke,this._colliders=[],this._id=++e._uniqueIDCounter,this._transform=new ii(this),this.name=t||"Sprite3D-"+e._nameNumberCounter++,this.layer=F.currentCreationLayer,this.active=!0}m(e,"laya.d3.core.Sprite3D",di);var i=e.prototype;return S.imps(i,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),i._setUrl=function(t){this._url=t},i._getGroup=function(){return this._group},i._setGroup=function(t){this._group=t},i._addChild3D=function(t){t.transform.parent=this.transform,this._hierarchyAnimator&&(!t._hierarchyAnimator&&t._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(t,!0,[t.name])),this._scene&&(t._setBelongScene(this._scene),this._activeInHierarchy&&t._active&&t._activeHierarchy())},i._removeChild3D=function(t){t.transform.parent=null,this._scene&&(this._activeInHierarchy&&t._active&&t._inActiveHierarchy(),t._setUnBelongScene()),this._hierarchyAnimator&&(t._hierarchyAnimator==this._hierarchyAnimator&&t._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(t,!1,[t.name]))},i._parseBaseCustomProps=function(t){var e=this.transform.localPosition;e.fromArray(t.translate),this.transform.localPosition=e;var i=this.transform.localRotation;i.fromArray(t.rotation),this.transform.localRotation=i;var n=this.transform.localScale;n.fromArray(t.scale),this.transform.localScale=n;var r=t.layer;null!=r&&(this.layer=F.getLayerByNumber(r))},i._parseCustomComponent=function(t,e,i){for(var n in i){var r=i[n];switch(n){case"Animator":var a=this.addComponent(Ti);if(r.avatarPath)a.avatar=Dt.getRes(e[r.avatarPath]);else{var s=r.avatar;if(s){a.avatar=Dt.getRes(e[s.path]);var o=s.linkSprites;o&&t.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[a,o])}}for(var l=r.clipPaths,h=l.length,u=0;u<h;u++)a.addClip(Dt.getRes(e[l[u]]));a.clip=Dt.getRes(e[l[0]]);var c=r.playOnWake;void 0!==c&&(a.playOnWake=c);break;case"Rigidbody":this.addComponent(wi);break;case"SphereCollider":var _=this.addComponent(tn);_.isTrigger=r.isTrigger;var d=_.center;d.fromArray(r.center),_.center=d,_.radius=r.radius;break;case"BoxCollider":var f=this.addComponent(Ji);f.isTrigger=r.isTrigger,f.center.fromArray(r.center);var p=f.size;p.fromArray(r.size),f.size=p;break;case"MeshCollider":this.addComponent($i)}}},i._onRootNodeHierarchyLoaded=function(t,e){for(var i in e){for(var n=this,r=e[i],a=0,s=r.length;a<s;a++){var o=r[a];if(""===o)break;if(!(n=n.getChildByName(o)))break}n&&t.linkSprite3DToAvatarNode(i,n)}},i._setHierarchyAnimator=function(t,e){this._changeHierarchyAnimator(t);for(var i=0,n=this._childs.length;i<n;i++){var r=this._childs[i];r._hierarchyAnimator==e&&r._setHierarchyAnimator(t,e)}},i._clearHierarchyAnimator=function(t,e){this._changeHierarchyAnimator(e);for(var i=0,n=this._childs.length;i<n;i++){var r=this._childs[i];r._hierarchyAnimator==t&&r._clearHierarchyAnimator(t,e)}},i._getAnimatorToLinkSprite3D=function(t,e,i){var n=this.getComponentByType(Ti);if(n&&(n.avatar?n.avatar._version||t._setAnimatorToLinkAvatar(n,e):t._setAnimatorToLinkSprite3DNoAvatar(n,e,i)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){i.unshift(this._parent.name);var r=this._parent;r._hierarchyAnimator&&r._getAnimatorToLinkSprite3D(t,e,i)}},i._setAnimatorToLinkSprite3DNoAvatar=function(t,e,i){var n=0,r=0;for(n=0,r=t.getClipCount();n<r;n++)t._handleSpriteOwnersBySprite(n,e,i,this);for(n=0,r=this._childs.length;n<r;n++){var a=this._childs[n],s=i.length;i.push(a.name),a._setAnimatorToLinkSprite3DNoAvatar(t,e,i),i.splice(s,1)}},i._changeHierarchyAnimator=function(t){this._hierarchyAnimator=t},i._isLinkSpriteToAnimationNode=function(t,e,i){var n=t._avatarNodes.indexOf(e),r=t._cacheSpriteToNodesMap;if(i)this._transform.dummy=e.transform,t._cacheNodesToSpriteMap[n]=r.length,r.push(n);else{this._transform.dummy=null;var a=t._cacheNodesToSpriteMap[n];t._cacheNodesToSpriteMap[n]=null,r.splice(a,1)}},i._setBelongScene=function(t){this._scene=t;for(var e=0,i=this._childs.length;e<i;e++)this._childs[e]._setBelongScene(t)},i._setUnBelongScene=function(){this._scene=null;for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._setUnBelongScene()},i._activeHierarchy=function(){var t=0,e=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),t=0,e=this._colliders.length;t<e;t++)this._layer._addCollider(this._colliders[t]);for(this.event("activeinhierarchychanged",!0),t=0,e=this._childs.length;t<e;t++){var i=this._childs[t];i._active&&i._activeHierarchy()}},i._inActiveHierarchy=function(){var t=0,e=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),t=0,e=this._colliders.length;t<e;t++){var i=this._colliders[t];i._clearCollsionMap(),this._layer._removeCollider(i)}for(this.event("activeinhierarchychanged",!1),t=0,e=this._childs.length;t<e;t++){var n=this._childs[t];n._active&&n._inActiveHierarchy()}},i.addComponent=function(t){var e,i=this._componentsMap.indexOf(t);if(-1===i)e=[],this._componentsMap.push(t),this._typeComponentsIndices.push(e);else if(e=this._typeComponentsIndices[i],this._components[e[0]].isSingleton)throw new Error("无法单实例创建"+t+"组件，"+t+"组件已存在！");var n=l.getInstance(t);if(e.push(this._components.length),this._components.push(n),n instanceof laya.d3.component.physics.Collider)this.getComponentByType(wi)&&(n._isRigidbody=!0),this._activeInHierarchy&&this._layer._addCollider(n),this._colliders.push(n);else if(n instanceof laya.d3.component.Animator){var r=n;this._setHierarchyAnimator(r,this._parent?this._parent._hierarchyAnimator:null),this._setAnimatorToLinkSprite3DNoAvatar(r,!0,[])}else if(n instanceof laya.d3.component.Rigidbody)for(var a=0,s=this._colliders.length;a<s;a++)this._colliders[a]._setIsRigidbody(!0);return n instanceof laya.d3.component.Script&&this._scripts.push(n),n._initialize(this),n},i._removeComponent=function(t,e){var i=0,n=0,r=this._typeComponentsIndices[t],a=r[e],s=this._components[a];if(s instanceof laya.d3.component.physics.Collider){var o=s;this._activeInHierarchy&&this._layer._removeCollider(o),this._colliders.splice(this._colliders.indexOf(o),1)}else if(s instanceof laya.d3.component.Animator){var l=s;this._clearHierarchyAnimator(l,this._parent?this._parent._hierarchyAnimator:null)}else if(s instanceof laya.d3.component.Rigidbody)for(i=0,n=this._colliders.length;i<n;i++){var h=this._colliders[i];h._setIsRigidbody(!1);var u=h._runtimeCollisonMap,c=h._runtimeCollisonTestMap;for(var _ in u)delete c[_]}for(this._components.splice(a,1),s instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(s),1),r.splice(e,1),0===r.length&&(this._typeComponentsIndices.splice(t,1),this._componentsMap.splice(t,1)),i=0,n=this._componentsMap.length;i<n;i++)for(var d=(r=this._typeComponentsIndices[i]).length-1;0<=d;d--){var f=r[d];if(!(a<f))break;r[d]=--f}s._destroy()},i.createConchModel=function(){return null},i._clearSelfRenderObjects=function(){},i._addSelfRenderObjects=function(){},i._parseCustomProps=function(t,e,i,n){},i._updateChilds=function(t){var e=this._childs.length;if(0!==e)for(var i=0;i<e;++i)this._childs[i]._update(t)},i._updateChildsConch=function(t){var e=this._childs.length;if(0!==e)for(var i=0;i<e;++i)this._childs[i]._update(t)},i._getSortID=function(t,e){return 1e3*e.id+t._getVertexBuffer().vertexDeclaration.id},i._update=function(t){(t.owner=this)._activeInHierarchy&&(this._updateComponents(t),this._lateUpdateComponents(t),M.spriteCount++,this._childs.length&&this._updateChilds(t))},i._updateConch=function(t){(t.owner=this)._activeInHierarchy&&(this._updateComponents(t),this._lateUpdateComponents(t),M.spriteCount++,this._childs.length&&this._updateChilds(t))},i.getProjectionViewWorldMatrix=function(t){return De.multiply(t,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},i.loadHierarchy=function(t){this.addChild(laya.d3.core.Sprite3D.load(t))},i.addChildAt=function(t,e){if(!(t instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),0<=e&&e<=this._childs.length){if(t._parent===this){var i=this.getChildIndex(t);this._childs.splice(i,1),this._childs.splice(e,0,t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,e)),this._childChanged()}else t.parent&&t.parent.removeChild(t),this._childs===d.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(e,0,t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,e),(t.parent=this)._addChild3D(t);return t}throw new Error("appendChildAt:The index is out of bounds")},i.addChild=function(t){if(!(t instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),t._parent===this){var e=this.getChildIndex(t);e!==this._childs.length-1&&(this._childs.splice(e,1),this._childs.push(t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,this._childs.length-1)),this._childChanged())}else t.parent&&t.parent.removeChild(t),this._childs===d.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,this._childs.length-1),(t.parent=this)._childChanged(),this._addChild3D(t);return t},i.removeChildAt=function(t){var e=this.getChildAt(t);return e&&(this._removeChild3D(e),this._childs.splice(t,1),this.conchModel&&this.conchModel.removeChild(e.conchModel),e.parent=null),e},i.removeChildren=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=2147483647),this._childs&&0<this._childs.length){var i=this._childs;if(0===t&&a<=e){var n=i;this._childs=d.ARRAY_EMPTY}else n=i.splice(t,e-t);for(var r=0,a=n.length;r<a;r++)this._removeChild3D(n[r]),n[r].parent=null,this.conchModel&&this.conchModel.removeChild(n[r].conchModel)}return this},i.onAsynLoaded=function(t,e,i){var n=e[0];if("Sprite3D"!==n.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var r=e[1];qe._createNodeByJson(this,n,this,r),this.event("hierarchyloaded",[this]),this.__loaded=!0},i.cloneTo=function(t){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var e=t;e.name=this.name,e._destroyed=this._destroyed,e.timer=this.timer,e._$P=this._$P,e.active=this._active;var i=e.transform.localPosition;this.transform.localPosition.cloneTo(i),e.transform.localPosition=i;var n=e.transform.localRotation;this.transform.localRotation.cloneTo(n),e.transform.localRotation=n;var r=e.transform.localScale;this.transform.localScale.cloneTo(r),e.transform.localScale=r,e.isStatic=this.isStatic;var a=0,s=0;for(a=0,s=this._componentsMap.length;a<s;a++){var o=e.addComponent(this._componentsMap[a]);this._components[a]._cloneTo(o)}for(a=0,s=this._childs.length;a<s;a++)e.addChild(this._childs[a].clone())},i.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},i.destroy=function(t){if(void 0===t&&(t=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,t);var e,i=0;for(i=0,e=this._components.length;i<e;i++)this._components[i]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,Dt.clearRes(this.url),this.loaded||Qe._cancelLoadByUrl(this.url)}},i._handleSpriteToAvatar=function(t,e){t._avatarNodes;var i=t._avatarNodeMap[this.name];i&&i.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode(t,i,e)},i._setAnimatorToLinkAvatar=function(t,e){this._handleSpriteToAvatar(t,e);for(var i=0,n=this._childs.length;i<n;i++){this._childs[i]._setAnimatorToLinkAvatar(t,e)}},_(0,i,"activeInHierarchy",function(){return this._activeInHierarchy}),_(0,i,"_loaded",null,function(t){this.__loaded=t}),_(0,i,"active",function(){return this._active},function(t){this._active!==t&&(this._active=t,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&(t?this._activeHierarchy():this._inActiveHierarchy()))}),_(0,i,"componentsCount",function(){return this._components.length}),_(0,i,"loaded",function(){return this.__loaded}),_(0,i,"id",function(){return this._id}),_(0,i,"url",function(){return this._url}),_(0,i,"layer",function(){return this._layer},function(t){if(this._layer!==t){if(!t)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var e=0,i=this._colliders.length;if(this._layer)for(e=0;e<i;e++)this._layer._removeCollider(this._colliders[e]);for(e=0;e<i;e++)t._addCollider(this._colliders[e])}this._layer=t,this.event("layerchanged",t)}}),_(0,i,"scene",function(){return this._scene}),_(0,i,"transform",function(){return this._transform}),e.instantiate=function(t,e,i,n,r){void 0===i&&(i=!0);var a=t.clone();e&&e.addChild(a);var s=a.transform;if(i){var o=s.worldMatrix;t.transform.worldMatrix.cloneTo(o),s.worldMatrix=o}else n&&(s.position=n),r&&(s.rotation=r);return a},e.load=function(t){return S.loader.create(t,null,null,e)},e.WORLDMATRIX=0,e.MVPMATRIX=1,e._uniqueIDCounter=0,e._nameNumberCounter=0,e}(),Fi=function(t){function u(t,e,i,n,r,a,s,o){if(this.customCompile=!1,this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],u.__super.call(this),!t||!e)throw"Shader Error";(f.isConchApp||f.isFlash)&&(this.customCompile=!0),this._id=++u._count,this._vs=t,this._ps=e,this._attributeMap=i,this._sceneUniformMap=n,this._cameraUniformMap=r,this._spriteUniformMap=a,this._materialUniformMap=s,this._renderElementUniformMap=o,this.recreateResource()}m(u,"laya.d3.shader.Shader3D",i);var e=u.prototype;return e.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},e.disposeResource=function(){R.mainContext.deleteShader(this._vshader),R.mainContext.deleteShader(this._pshader),R.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},e._compile=function(){if(this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var t,e=[this._vs,this._ps],i=R.mainContext;if(this._program=i.createProgram(),this._vshader=u._createShader(i,e[0],35633),this._pshader=u._createShader(i,e[1],35632),i.attachShader(this._program,this._vshader),i.attachShader(this._program,this._pshader),i.linkProgram(this._program),ui.debugMode&&!this.customCompile&&!i.getProgramParameter(this._program,35714))throw i.getProgramInfoLog(this._program);var n,r=0,a=0,s=this.customCompile?t.attributes.length:i.getProgramParameter(this._program,35721);for(r=0;r<s;r++){var o=this.customCompile?t.attributes[r]:i.getActiveAttrib(this._program,r);n={vartype:"attribute",ivartype:0,attrib:o,location:i.getAttribLocation(this._program,o.name),name:o.name,type:o.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push(n)}var l=this.customCompile?t.uniforms.length:i.getProgramParameter(this._program,35718);for(r=0;r<l;r++){var h=this.customCompile?t.uniforms[r]:i.getActiveUniform(this._program,r);0<(n={vartype:"uniform",ivartype:1,attrib:o,location:i.getUniformLocation(this._program,h.name),name:h.name,type:h.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(n.name=n.name.substr(0,n.name.length-3),n.isArray=!0,n.location=i.getUniformLocation(this._program,n.name)),this._uniformParams.push(n)}for(r=0,a=this._attributeParams.length;r<a;r++)(n=this._attributeParams[r]).indexOfParams=r,n.index=1,n.value=[n.location,null],n.codename=n.name,n.name=null!=this._attributeMap[n.codename]?this._attributeMap[n.codename]:n.codename,this._attributeParamsMap.push(n.name),this._attributeParamsMap.push(n),n._this=this,n.uploadedValue=[],n.fun=this._attribute;for(r=0,a=this._uniformParams.length;r<a;r++)switch((n=this._uniformParams[r]).indexOfParams=r,n.index=1,n.value=[n.location,null],n.codename=n.name,null!=this._sceneUniformMap[n.codename]?(n.name=this._sceneUniformMap[n.codename],this._sceneUniformParamsMap.push(n.name),this._sceneUniformParamsMap.push(n)):null!=this._cameraUniformMap[n.codename]?(n.name=this._cameraUniformMap[n.codename],this._cameraUniformParamsMap.push(n.name),this._cameraUniformParamsMap.push(n)):null!=this._spriteUniformMap[n.codename]?(n.name=this._spriteUniformMap[n.codename],this._spriteUniformParamsMap.push(n.name),this._spriteUniformParamsMap.push(n)):null!=this._materialUniformMap[n.codename]?(n.name=this._materialUniformMap[n.codename],this._materialUniformParamsMap.push(n.name),this._materialUniformParamsMap.push(n)):null!=this._renderElementUniformMap[n.codename]?(n.name=this._renderElementUniformMap[n.codename],this._renderElementUniformParamsMap.push(n.name),this._renderElementUniformParamsMap.push(n)):console.log("Shader:can't find uinform name:"+n.codename+" in shader file."),n._this=this,n.uploadedValue=[],n.type){case 5124:n.fun=n.isArray?this._uniform1iv:this._uniform1i;break;case 5126:n.fun=n.isArray?this._uniform1fv:this._uniform1f;break;case 35664:n.fun=n.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:n.fun=n.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:n.fun=n.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:n.fun=this._uniform_sampler2D;break;case 35680:n.fun=this._uniform_samplerCube;break;case 35676:n.fun=this._uniformMatrix4fv;break;case 35670:n.fun=this._uniform1i;break;case 35674:n.fun=this._uinformMatrix2fv;break;case 35675:n.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},e._attribute=function(t,e){var i=R.mainContext,n=o._enableAtributes,r=t.location;return n[r]||i.enableVertexAttribArray(r),i.vertexAttribPointer(r,e[0],e[1],e[2],e[3],e[4]),n[r]=o._bindVertexBuffer,1},e._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!==e?(R.mainContext.uniform1f(t.location,i[0]=e),1):0},e._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(R.mainContext.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return R.mainContext.uniform1fv(t.location,e),1},e._uniform_vec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(R.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(R.mainContext.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return R.mainContext.uniform2fv(t.location,e),1},e._uniform_vec3=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(R.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3v=function(t,e){return R.mainContext.uniform3fv(t.location,e),1},e._uniform_vec4=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(R.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4v=function(t,e){return R.mainContext.uniform4fv(t.location,e),1},e._uniformMatrix2fv=function(t,e){return R.mainContext.uniformMatrix2fv(t.location,!1,e),1},e._uniformMatrix3fv=function(t,e){return R.mainContext.uniformMatrix3fv(t.location,!1,e),1},e._uniformMatrix4fv=function(t,e){return R.mainContext.uniformMatrix4fv(t.location,!1,e),1},e._uinformMatrix2fv=function(t,e){return R.mainContext.uniformMatrix2fv(t.location,!1,e),1},e._uinformMatrix3fv=function(t,e){return R.mainContext.uniformMatrix3fv(t.location,!1,e),1},e._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!==e?(R.mainContext.uniform1i(t.location,i[0]=e),1):0},e._uniform1iv=function(t,e){return R.mainContext.uniform1iv(t.location,e),1},e._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(R.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_ivec2v=function(t,e){return R.mainContext.uniform2iv(t.location,e),1},e._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(R.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3vi=function(t,e){return R.mainContext.uniform3iv(t.location,e),1},e._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(R.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4vi=function(t,e){return R.mainContext.uniform4iv(t.location,e),1},e._uniform_sampler2D=function(t,e){var i=e.source||e.defaulteTexture.source,n=R.mainContext,r=t.uploadedValue;if(null!=r[0])return n.activeTexture(u._TEXTURES[r[0]]),i&&L.bindTexture(n,3553,i),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return r[0]=this._curActTexIndex,n.uniform1i(t.location,this._curActTexIndex),n.activeTexture(u._TEXTURES[this._curActTexIndex]),i&&L.bindTexture(n,3553,i),this._curActTexIndex++,1},e._uniform_samplerCube=function(t,e){var i=e.source||e.defaulteTexture.source,n=R.mainContext,r=t.uploadedValue;if(null!=r[0])return n.activeTexture(u._TEXTURES[r[0]]),i?L.bindTexture(n,34067,i):L.bindTexture(n,34067,on.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return r[0]=this._curActTexIndex,n.uniform1i(t.location,this._curActTexIndex),n.activeTexture(u._TEXTURES[this._curActTexIndex]),i?L.bindTexture(n,34067,i):L.bindTexture(n,34067,on.grayTexture.source),this._curActTexIndex++,1},e._noSetValue=function(t){console.log("no....:"+t.name)},e.bind=function(){return i.activeShader=this,(i.bindShader=this).activeResource(),L.UseProgram(this._program)},e.uploadAttributes=function(t,e){for(var i,n,r=0,a=0,s=this._attributeParamsMap.length;a<s;a+=2)n=this._attributeParamsMap[a+1],null!=(i=t[this._attributeParamsMap[a]])&&(e&&e[n.name]&&e[n.name].bind(),r+=n.fun.call(this,n,i));M.shaderCall+=r},e.uploadAttributesX=function(t,e){for(var i,n,r=0,a=0,s=this._attributeParamsMap.length;a<s;a+=2)n=this._attributeParamsMap[a+1],null!=(i=t[this._attributeParamsMap[a]])&&(e._bind(),r+=n.fun.call(this,n,i));M.shaderCall+=r},e.uploadSceneUniforms=function(t){for(var e,i,n=0,r=0,a=this._sceneUniformParamsMap.length;r<a;r+=2)i=this._sceneUniformParamsMap[r+1],null!=(e=t[this._sceneUniformParamsMap[r]])&&(n+=i.fun.call(this,i,e));M.shaderCall+=n},e.uploadCameraUniforms=function(t){for(var e,i,n=0,r=0,a=this._cameraUniformParamsMap.length;r<a;r+=2)i=this._cameraUniformParamsMap[r+1],null!=(e=t[this._cameraUniformParamsMap[r]])&&(n+=i.fun.call(this,i,e));M.shaderCall+=n},e.uploadSpriteUniforms=function(t){for(var e,i,n=0,r=0,a=this._spriteUniformParamsMap.length;r<a;r+=2)i=this._spriteUniformParamsMap[r+1],null!=(e=t[this._spriteUniformParamsMap[r]])&&(n+=i.fun.call(this,i,e));M.shaderCall+=n},e.uploadMaterialUniforms=function(t){for(var e,i,n=0,r=0,a=this._materialUniformParamsMap.length;r<a;r+=2)i=this._materialUniformParamsMap[r+1],null!=(e=t[this._materialUniformParamsMap[r]])&&(n+=i.fun.call(this,i,e));M.shaderCall+=n},e.uploadRenderElementUniforms=function(t){for(var e,i,n=0,r=0,a=this._renderElementUniformParamsMap.length;r<a;r+=2)i=this._renderElementUniformParamsMap[r+1],null!=(e=t[this._renderElementUniformParamsMap[r]])&&(n+=i.fun.call(this,i,e));M.shaderCall+=n},u.create=function(t,e,i,n,r,a,s,o){return new u(t,e,i,n,r,a,s,o)},u.addInclude=function(t,e){E.addInclude(t,e)},u._createShader=function(t,e,i){var n=t.createShader(i);if(t.shaderSource(n,e),t.compileShader(n),ui.debugMode&&!t.getShaderParameter(n,35713))throw t.getShaderInfoLog(n);return n},u.PERIOD_RENDERELEMENT=0,u.PERIOD_MATERIAL=1,u.PERIOD_SPRITE=2,u.PERIOD_CAMERA=3,u.PERIOD_SCENE=4,u._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],u._count=0,c(u,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new D}]),u}(),Bi=function(t){function e(){e.__super.call(this),this.setShaderName("BLINNPHONG"),this._albedoIntensity=1,this._albedoColor=new Pe(1,1,1,1),this._setColor(6,new Pe(1,1,1,1)),this._setColor(8,new Oe(1,1,1)),this._setNumber(9,.078125),this._setColor(10,new Oe(1,1,1)),this._setNumber(0,.5),this._setColor(11,new Pe(1,1,0,0)),this._enableLighting=!0,this.renderMode=0}m(e,"laya.d3.core.material.BlinnPhongMaterial",mi);var i=e.prototype;return i.disableLight=function(){this._addDisablePublicShaderDefine(ui.SHADERDEFINE_POINTLIGHT|ui.SHADERDEFINE_SPOTLIGHT|ui.SHADERDEFINE_DIRECTIONLIGHT)},i.disableFog=function(){this._addDisablePublicShaderDefine(ui.SHADERDEFINE_FOG)},_(0,i,"renderMode",null,function(t){switch(t){case 0:this.renderQueue=1,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this.depthTest=513,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 1:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=1,this.alphaTest=!0,this.depthTest=513,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this.depthTest=513,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.renderQueue=2,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this.depthTest=513,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)}),_(0,i,"normalTexture",function(){return this._getTexture(2)},function(t){t?this._addShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,t)}),_(0,i,"reflectColor",function(){return this._getColor(10)},function(t){this._setColor(10,t)}),_(0,i,"tilingOffset",function(){return this._getColor(11)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(11,t)}),_(0,i,"specularColor",function(){return this._getColor(8)},function(t){this._setColor(8,t)}),_(0,i,"albedoColor",function(){return this._albedoColor},function(t){var e=this._getColor(6);Pe.scale(t,this._albedoIntensity,e),this._albedoColor=t}),_(0,i,"albedoIntensity",function(){return this._albedoIntensity},function(t){if(this._albedoIntensity!==t){var e=this._getColor(6);Pe.scale(this._albedoColor,t,e),this._albedoIntensity=t}}),_(0,i,"albedoTexture",function(){return this._getTexture(1)},function(t){t?this._addShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,t)}),_(0,i,"shininess",function(){return this._getNumber(9)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(9,t)}),_(0,i,"specularTexture",function(){return this._getTexture(3)},function(t){t?this._addShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,t)}),_(0,i,"reflectTexture",function(){return this._getTexture(5)},function(t){t?this._addShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(5,t)}),_(0,i,"enableLighting",function(){return this._enableLighting},function(t){this._enableLighting!==t&&(t?this._removeDisablePublicShaderDefine(ui.SHADERDEFINE_POINTLIGHT|ui.SHADERDEFINE_SPOTLIGHT|ui.SHADERDEFINE_DIRECTIONLIGHT):this._addDisablePublicShaderDefine(ui.SHADERDEFINE_POINTLIGHT|ui.SHADERDEFINE_SPOTLIGHT|ui.SHADERDEFINE_DIRECTIONLIGHT),this._enableLighting=t)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSEMAP=e.shaderDefines.registerDefine("DIFFUSEMAP"),e.SHADERDEFINE_NORMALMAP=e.shaderDefines.registerDefine("NORMALMAP"),e.SHADERDEFINE_SPECULARMAP=e.shaderDefines.registerDefine("SPECULARMAP"),e.SHADERDEFINE_REFLECTMAP=e.shaderDefines.registerDefine("REFLECTMAP"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET"),e.SHADERDEFINE_ADDTIVEFOG=e.shaderDefines.registerDefine("ADDTIVEFOG")},e.load=function(t){return S.loader.create(t,null,null,e)},e.SPECULARSOURCE_DIFFUSEMAPALPHA=0,e.SPECULARSOURCE_SPECULARMAP=0,e.RENDERMODE_OPAQUE=0,e.RENDERMODE_CUTOUT=1,e.RENDERMODE_TRANSPARENT=2,e.RENDERMODE_ADDTIVE=3,e.SHADERDEFINE_DIFFUSEMAP=0,e.SHADERDEFINE_NORMALMAP=0,e.SHADERDEFINE_SPECULARMAP=0,e.SHADERDEFINE_REFLECTMAP=0,e.SHADERDEFINE_TILINGOFFSET=0,e.SHADERDEFINE_ADDTIVEFOG=0,e.ALBEDOTEXTURE=1,e.NORMALTEXTURE=2,e.SPECULARTEXTURE=3,e.EMISSIVETEXTURE=4,e.REFLECTTEXTURE=5,e.ALBEDOCOLOR=6,e.MATERIALSPECULAR=8,e.SHININESS=9,e.MATERIALREFLECT=10,e.TILINGOFFSET=11,c(e,["defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new Be(mi.shaderDefines)}]),e}(),Ui=function(t){function e(){e.__super.call(this),this.setShaderName("ExtendTerrain"),this.renderMode=1}m(e,"laya.d3.core.material.ExtendTerrainMaterial",mi);var i=e.prototype;return i._setDetailNum=function(t){switch(t){case 1:this._addShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 2:this._addShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 3:this._addShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 4:this._addShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 5:this._addShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4)}},i.disableLight=function(){this._addDisablePublicShaderDefine(ui.SHADERDEFINE_POINTLIGHT|ui.SHADERDEFINE_SPOTLIGHT|ui.SHADERDEFINE_DIRECTIONLIGHT)},_(0,i,"diffuseScaleOffset2",null,function(t){this._setColor(7,t)}),_(0,i,"splatAlphaTexture",function(){return this._getTexture(0)},function(t){this._setTexture(0,t)}),_(0,i,"diffuseScaleOffset3",null,function(t){this._setColor(8,t)}),_(0,i,"diffuseTexture1",null,function(t){this._setTexture(1,t),this._setDetailNum(1)}),_(0,i,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=1,this.depthWrite=!0,this.cull=2,this.blend=0,this.depthTest=513;break;case 2:this.renderQueue=1,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.depthTest=515;break;default:throw new Error("ExtendTerrainMaterial:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)}),_(0,i,"diffuseTexture2",function(){return this._getTexture(2)},function(t){this._setTexture(2,t),this._setDetailNum(2)}),_(0,i,"diffuseScaleOffset1",null,function(t){this._setColor(6,t)}),_(0,i,"diffuseTexture3",function(){return this._getTexture(3)},function(t){this._setTexture(3,t),this._setDetailNum(3)}),_(0,i,"diffuseTexture4",function(){return this._getTexture(4)},function(t){this._setTexture(4,t),this._setDetailNum(4)}),_(0,i,"diffuseTexture5",function(){return this._getTexture(5)},function(t){this._setTexture(5,t),this._setDetailNum(5)}),_(0,i,"diffuseScaleOffset4",null,function(t){this._setColor(9,t)}),_(0,i,"diffuseScaleOffset5",null,function(t){this._setColor(10,t)}),_(0,i,"albedo",function(){return this._getColor(14)},function(t){this._setColor(14,t)}),_(0,i,"ambientColor",function(){return this._getColor(11)},function(t){this._setColor(11,t)}),_(0,i,"diffuseColor",function(){return this._getColor(12)},function(t){this._setColor(12,t)}),_(0,i,"specularColor",function(){return this._getColor(13)},function(t){this._setColor(13,t)}),e.__init__=function(){e.SHADERDEFINE_DETAIL_NUM1=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM1"),e.SHADERDEFINE_DETAIL_NUM2=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM2"),e.SHADERDEFINE_DETAIL_NUM3=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM3"),e.SHADERDEFINE_DETAIL_NUM4=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM4"),e.SHADERDEFINE_DETAIL_NUM5=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM5")},e.RENDERMODE_OPAQUE=1,e.RENDERMODE_TRANSPARENT=2,e.SPLATALPHATEXTURE=0,e.DIFFUSETEXTURE1=1,e.DIFFUSETEXTURE2=2,e.DIFFUSETEXTURE3=3,e.DIFFUSETEXTURE4=4,e.DIFFUSETEXTURE5=5,e.DIFFUSESCALEOFFSET1=6,e.DIFFUSESCALEOFFSET2=7,e.DIFFUSESCALEOFFSET3=8,e.DIFFUSESCALEOFFSET4=9,e.DIFFUSESCALEOFFSET5=10,e.MATERIALAMBIENT=11,e.MATERIALDIFFUSE=12,e.MATERIALSPECULAR=13,e.MATERIALALBEDO=14,e.SHADERDEFINE_DETAIL_NUM1=0,e.SHADERDEFINE_DETAIL_NUM2=0,e.SHADERDEFINE_DETAIL_NUM3=0,e.SHADERDEFINE_DETAIL_NUM4=0,e.SHADERDEFINE_DETAIL_NUM5=0,c(e,["shaderDefines",function(){return this.shaderDefines=new Be(mi.shaderDefines)}]),e}(),ki=function(e){function i(){i.__super.call(this),this.setShaderName("GLITTER"),this.renderMode=1,this._setColor(3,new Pe(1,1,1,1)),this._setColor(2,new Pe(1,1,1,1))}m(i,"laya.d3.core.material.GlitterMaterial",e);var t=i.prototype;return t.setShaderName=function(t){e.prototype.setShaderName.call(this,t)},_(0,t,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=1,this.depthWrite=!0,this.cull=2,this.blend=0;break;case 2:this.renderQueue=1,this.depthWrite=!0,this.cull=0,this.blend=0;break;case 13:this.renderQueue=2,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 14:this.renderQueue=2,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 15:this.renderQueue=2,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;case 16:this.renderQueue=2,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;case 5:this.renderQueue=2,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 6:this.renderQueue=2,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 7:this.renderQueue=2,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;case 8:this.renderQueue=2,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;case 9:this.renderQueue=2,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 10:this.renderQueue=2,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 11:this.renderQueue=2,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;case 12:this.renderQueue=2,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)}),_(0,t,"diffuseTexture",function(){return this._getTexture(1)},function(t){this._setTexture(1,t)}),_(0,t,"albedo",function(){return this._getColor(2)},function(t){this._setColor(2,t)}),_(0,t,"color",function(){return this._getColor(3)},function(t){this._setColor(3,t)}),i.load=function(t){return S.loader.create(t,null,null,i)},i.RENDERMODE_OPAQUE=1,i.RENDERMODE_OPAQUEDOUBLEFACE=2,i.RENDERMODE_TRANSPARENT=13,i.RENDERMODE_TRANSPARENTDOUBLEFACE=14,i.RENDERMODE_ADDTIVE=15,i.RENDERMODE_ADDTIVEDOUBLEFACE=16,i.RENDERMODE_DEPTHREAD_TRANSPARENT=5,i.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,i.RENDERMODE_DEPTHREAD_ADDTIVE=7,i.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,i.RENDERMODE_NONDEPTH_TRANSPARENT=9,i.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,i.RENDERMODE_NONDEPTH_ADDTIVE=11,i.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,i.DIFFUSETEXTURE=1,i.ALBEDO=2,i.UNICOLOR=3,c(i,["defaultMaterial",function(){return this.defaultMaterial=new i}]),i}(mi),Hi=function(n){function i(){if(this._transformUV=null,i.__super.call(this),!laya.d3.core.material.PBRMaterial.pbrlutTex){var t=C.window.__pbrlutdata;if(!t)throw alert("no pbr lutdata, need pbrlut.js"),"no pbr lutdata, need pbrlut.js";var e=en.create(new Uint32Array(t).buffer,256,256,9728,9728,!1);laya.d3.core.material.PBRMaterial.pbrlutTex=e}this._setTexture(4,laya.d3.core.material.PBRMaterial.pbrlutTex),this.setShaderName("PBR"),this._setNumber(0,.5),this.use_groundtruth=!1}m(i,"laya.d3.core.material.PBRMaterial",n);var t=i.prototype;return t.disableLight=function(){this._addDisablePublicShaderDefine(ui.SHADERDEFINE_POINTLIGHT|ui.SHADERDEFINE_SPOTLIGHT|ui.SHADERDEFINE_DIRECTIONLIGHT)},t.disableFog=function(){this._addDisablePublicShaderDefine(ui.SHADERDEFINE_FOG)},t.onAsynLoaded=function(t,e,i){n.prototype.onAsynLoaded.call(this,t,e,i)},t.radicalInverse_VdC=function(t){var e,i=new Uint32Array(1);return e=(16711935&(e=(252645135&(e=(858993459&(e=(1431655765&(e=(e=t)<<16|e>>>16))<<1|(2863311530&e)>>>1))<<2|(3435973836&e)>>>2))<<4|(4042322160&e)>>>4))<<8|(4278255360&e)>>>8,i[0]=e,2.3283064365386963e-10*i[0]},t.createHammersleyTex=function(t,e){var i=new Uint8Array(t*e*4),n=0,r=0;for(r=0;r<t*e;r++){var a=this.radicalInverse_VdC(r);i[n++]=255*a,i[n++]=0,i[n++]=0,i[n++]=255}return i},_(0,t,"normalTexture",function(){return this._getTexture(2)},function(t){this._setTexture(2,t)}),_(0,t,"has_tangent",null,function(t){this._addShaderDefine(i.SHADERDEFINE_HAS_TANGENT)}),_(0,t,"roughness",function(){return this._getNumber(6)},function(t){this._setNumber(6,t),this._addShaderDefine(i.SHADERDEFINE_FIX_ROUGHNESS)}),_(0,t,"metaless",function(){return this._getNumber(7)},function(t){this._setNumber(7,t),this._addShaderDefine(i.SHADERDEFINE_FIX_METALESS)}),_(0,t,"pbrlutTexture",function(){return this._getTexture(4)},function(t){this._setTexture(4,t)}),_(0,t,"use_groundtruth",null,function(t){if(t){if(this._addShaderDefine(i.SHADERDEFINE_USE_GROUNDTRUTH),!laya.d3.core.material.PBRMaterial.HammersleyNoiseTex){var e=this.createHammersleyTex(32,32);laya.d3.core.material.PBRMaterial.HammersleyNoiseTex=en.create(e.buffer,32,32,9728,9728,!1)}this._setTexture(15,i.HammersleyNoiseTex)}else laya.d3.core.material.PBRMaterial.HammersleyNoiseTex=null,this._removeShaderDefine(i.SHADERDEFINE_USE_GROUNDTRUTH)}),_(0,t,"transformUV",function(){return this._transformUV},function(t){this._transformUV=t,this._setMatrix4x4(8,t.matrix),this._conchMaterial&&this._conchMaterial.setShaderValue(8,t.matrix.elements,0)}),_(0,t,"diffuseTexture",function(){return this._getTexture(1)},function(t){this._setTexture(1,t)}),_(0,t,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=1,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1;break;case 2:this.renderQueue=1,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1;break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=1;break;case 13:this.renderQueue=2,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;default:throw new Error("PBRMaterial:renderMode value error.")}}),_(0,t,"pbrInfoTexture",function(){return this._getTexture(3)},function(t){this._setTexture(3,t),this._addShaderDefine(i.SHADERDEFINE_HAS_PBRINFO)}),_(0,t,"testClipZ",null,function(t){this._addShaderDefine(i.SHADERDEFINE_TEST_CLIPZ)}),i.__init__=function(){i.SHADERDEFINE_FIX_METALESS=i.shaderDefines.registerDefine("FIX_METALESS"),i.SHADERDEFINE_FIX_ROUGHNESS=i.shaderDefines.registerDefine("FIX_ROUGHNESS"),i.SHADERDEFINE_HAS_TANGENT=i.shaderDefines.registerDefine("HAS_TANGENT"),i.SHADERDEFINE_HAS_PBRINFO=i.shaderDefines.registerDefine("HAS_PBRINFO"),i.SHADERDEFINE_USE_GROUNDTRUTH=i.shaderDefines.registerDefine("USE_GROUNDTRUTH"),i.SHADERDEFINE_TEST_CLIPZ=i.shaderDefines.registerDefine("CLIPZ")},i.load=function(t){return S.loader.create(t,null,null,i)},i.DIFFUSETEXTURE=1,i.NORMALTEXTURE=2,i.PBRINFOTEXTURE=3,i.PBRLUTTEXTURE=4,i.UVANIAGE=5,i.MATERIALROUGHNESS=6,i.MATERIALMETALESS=7,i.UVMATRIX=8,i.UVAGE=9,i.AOOBJPOS=14,i.HSNOISETEXTURE=15,i.SHADERDEFINE_FIX_ROUGHNESS=0,i.SHADERDEFINE_FIX_METALESS=0,i.SHADERDEFINE_HAS_TANGENT=0,i.SHADERDEFINE_TEST_CLIPZ=0,i.SHADERDEFINE_HAS_PBRINFO=0,i.SHADERDEFINE_USE_GROUNDTRUTH=0,i.RENDERMODE_OPAQUE=1,i.RENDERMODE_OPAQUEDOUBLEFACE=2,i.RENDERMODE_CUTOUT=3,i.RENDERMODE_CUTOUTDOUBLEFACE=4,i.RENDERMODE_TRANSPARENT=13,i.pbrlutTex=null,i.HammersleyNoiseTex=null,c(i,["defaultMaterial",function(){return this.defaultMaterial=new i},"shaderDefines",function(){return this.shaderDefines=new Be(mi.shaderDefines)}]),i}(mi),zi=function(t){function e(){e.__super.call(this),this.setShaderName("PBRSpecular"),this._setColor(7,new Pe(1,1,1,1)),this._setColor(9,new Pe(0,0,0,0)),this._setColor(8,new Pe(.2,.2,.2,.2)),this._setNumber(10,.5),this._setNumber(11,1),this._setNumber(12,0),this._setNumber(13,1),this._setNumber(14,1),this._setNumber(15,.001),this._setBool(16,!1),this._setNumber(0,.5)}m(e,"laya.d3.core.material.PBRSpecularMaterial",mi);var i=e.prototype;return _(0,i,"albedoColor",function(){return this._getColor(7)},function(t){this._setColor(7,t)}),_(0,i,"specularTexture",function(){return this._getTexture(2)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SPECULARTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SPECULARTEXTURE),this._setTexture(2,t)}),_(0,i,"albedoTexture",function(){return this._getTexture(1)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_DIFFUSETEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_DIFFUSETEXTURE),this._setTexture(1,t)}),_(0,i,"occlusionTexture",function(){return this._getTexture(5)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_OCCLUSIONTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_OCCLUSIONTEXTURE),this._setTexture(5,t)}),_(0,i,"normalTexture",function(){return this._getTexture(3)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_NORMALTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_NORMALTEXTURE),this._setTexture(3,t)}),_(0,i,"parallaxTexture",function(){return this._getTexture(4)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_PARALLAXTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_PARALLAXTEXTURE),this._setTexture(4,t)}),_(0,i,"emissionColor",function(){return this._getColor(9)},function(t){this._setColor(9,t)}),_(0,i,"normalTextureScale",function(){return this._getNumber(14)},function(t){this._setNumber(14,t)}),_(0,i,"parallaxTextureScale",function(){return this._getNumber(15)},function(t){t=Math.max(.005,Math.min(.08,t)),this._setNumber(15,t)}),_(0,i,"occlusionTextureStrength",function(){return this._getNumber(13)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(13,t)}),_(0,i,"specularColor",function(){return this._getColor(8)},function(t){this._setColor(8,t)}),_(0,i,"smoothness",function(){return this._getNumber(10)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(10,t)}),_(0,i,"smoothnessTextureScale",function(){return this._getNumber(11)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(11,t)}),_(0,i,"smoothnessSource",function(){return this._getNumber(12)},function(t){1==t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA):(this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA),t=0),this._setNumber(12,t)}),_(0,i,"enableEmission",function(){return this._getBool(16)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSION):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSION),this._setBool(16,t)}),_(0,i,"emissionTexture",function(){return this._getTexture(6)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSIONTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSIONTEXTURE),this._setTexture(6,t)}),_(0,i,"tilingOffset",function(){return this._getColor(17)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(17,t)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSETEXTURE=e.shaderDefines.registerDefine("DIFFUSETEXTURE"),e.SHADERDEFINE_SPECULARTEXTURE=e.shaderDefines.registerDefine("SPECULARTEXTURE"),e.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=e.shaderDefines.registerDefine("SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA"),e.SHADERDEFINE_NORMALTEXTURE=e.shaderDefines.registerDefine("NORMALTEXTURE"),e.SHADERDEFINE_PARALLAXTEXTURE=e.shaderDefines.registerDefine("PARALLAXTEXTURE"),e.SHADERDEFINE_OCCLUSIONTEXTURE=e.shaderDefines.registerDefine("OCCLUSIONTEXTURE"),e.SHADERDEFINE_EMISSION=e.shaderDefines.registerDefine("EMISSION"),e.SHADERDEFINE_EMISSIONTEXTURE=e.shaderDefines.registerDefine("EMISSIONTEXTURE"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET")},e.SmoothnessSource_MetallicGlossTexture_Alpha=0,e.SmoothnessSource_DiffuseTexture_Alpha=1,e.SHADERDEFINE_DIFFUSETEXTURE=0,e.SHADERDEFINE_NORMALTEXTURE=0,e.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=0,e.SHADERDEFINE_SPECULARTEXTURE=0,e.SHADERDEFINE_OCCLUSIONTEXTURE=0,e.SHADERDEFINE_PARALLAXTEXTURE=0,e.SHADERDEFINE_EMISSION=0,e.SHADERDEFINE_EMISSIONTEXTURE=0,e.SHADERDEFINE_TILINGOFFSET=0,e.DIFFUSETEXTURE=1,e.SPECULARTEXTURE=2,e.NORMALTEXTURE=3,e.PARALLAXTEXTURE=4,e.OCCLUSIONTEXTURE=5,e.EMISSIONTEXTURE=6,e.DIFFUSECOLOR=7,e.SPECULARCOLOR=8,e.EMISSIONCOLOR=9,e.SMOOTHNESS=10,e.SMOOTHNESSSCALE=11,e.SMOOTHNESSSOURCE=12,e.OCCLUSIONSTRENGTH=13,e.NORMALSCALE=14,e.PARALLAXSCALE=15,e.ENABLEEMISSION=16,e.TILINGOFFSET=17,c(e,["shaderDefines",function(){return this.shaderDefines=new Be(mi.shaderDefines)}]),e}(),Gi=function(t){function e(){e.__super.call(this),this.setShaderName("PBRStandard"),this._setColor(7,new Pe(1,1,1,1)),this._setColor(8,new Pe(0,0,0,0)),this._setNumber(9,0),this._setNumber(10,.5),this._setNumber(11,1),this._setNumber(12,0),this._setNumber(13,1),this._setNumber(14,1),this._setNumber(15,.001),this._setBool(16,!1),this._setNumber(0,.5)}m(e,"laya.d3.core.material.PBRStandardMaterial",mi);var i=e.prototype;return _(0,i,"albedoColor",function(){return this._getColor(7)},function(t){this._setColor(7,t)}),_(0,i,"albedoTexture",function(){return this._getTexture(1)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_DIFFUSETEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_DIFFUSETEXTURE),this._setTexture(1,t)}),_(0,i,"enableEmission",function(){return this._getBool(16)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSION):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSION),this._setBool(16,t)}),_(0,i,"metallicGlossTexture",function(){return this._getTexture(2)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_METALLICGLOSSTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_METALLICGLOSSTEXTURE),this._setTexture(2,t)}),_(0,i,"occlusionTexture",function(){return this._getTexture(5)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_OCCLUSIONTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_OCCLUSIONTEXTURE),this._setTexture(5,t)}),_(0,i,"normalTexture",function(){return this._getTexture(3)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_NORMALTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_NORMALTEXTURE),this._setTexture(3,t)}),_(0,i,"parallaxTexture",function(){return this._getTexture(4)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_PARALLAXTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_PARALLAXTEXTURE),this._setTexture(4,t)}),_(0,i,"emissionColor",function(){return this._getColor(8)},function(t){this._setColor(8,t)}),_(0,i,"normalTextureScale",function(){return this._getNumber(14)},function(t){this._setNumber(14,t)}),_(0,i,"parallaxTextureScale",function(){return this._getNumber(15)},function(t){t=Math.max(.005,Math.min(.08,t)),this._setNumber(15,t)}),_(0,i,"occlusionTextureStrength",function(){return this._getNumber(13)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(13,t)}),_(0,i,"metallic",function(){return this._getNumber(9)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(9,t)}),_(0,i,"smoothness",function(){return this._getNumber(10)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(10,t)}),_(0,i,"smoothnessTextureScale",function(){return this._getNumber(11)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(11,t)}),_(0,i,"smoothnessSource",function(){return this._getNumber(12)},function(t){1==t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA):(this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA),t=0),this._setNumber(12,t)}),_(0,i,"emissionTexture",function(){return this._getTexture(6)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSIONTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSIONTEXTURE),this._setTexture(6,t)}),_(0,i,"tilingOffset",function(){return this._getColor(17)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(17,t)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSETEXTURE=e.shaderDefines.registerDefine("DIFFUSETEXTURE"),e.SHADERDEFINE_METALLICGLOSSTEXTURE=e.shaderDefines.registerDefine("METALLICGLOSSTEXTURE"),e.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=e.shaderDefines.registerDefine("SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA"),e.SHADERDEFINE_NORMALTEXTURE=e.shaderDefines.registerDefine("NORMALTEXTURE"),e.SHADERDEFINE_PARALLAXTEXTURE=e.shaderDefines.registerDefine("PARALLAXTEXTURE"),e.SHADERDEFINE_OCCLUSIONTEXTURE=e.shaderDefines.registerDefine("OCCLUSIONTEXTURE"),e.SHADERDEFINE_EMISSION=e.shaderDefines.registerDefine("EMISSION"),e.SHADERDEFINE_EMISSIONTEXTURE=e.shaderDefines.registerDefine("EMISSIONTEXTURE"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET")},e.SmoothnessSource_MetallicGlossTexture_Alpha=0,e.SmoothnessSource_DiffuseTexture_Alpha=1,e.SHADERDEFINE_DIFFUSETEXTURE=0,e.SHADERDEFINE_NORMALTEXTURE=0,e.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=0,e.SHADERDEFINE_METALLICGLOSSTEXTURE=0,e.SHADERDEFINE_OCCLUSIONTEXTURE=0,e.SHADERDEFINE_PARALLAXTEXTURE=0,e.SHADERDEFINE_EMISSION=0,e.SHADERDEFINE_EMISSIONTEXTURE=0,e.SHADERDEFINE_TILINGOFFSET=0,e.DIFFUSETEXTURE=1,e.METALLICGLOSSTEXTURE=2,e.NORMALTEXTURE=3,e.PARALLAXTEXTURE=4,e.OCCLUSIONTEXTURE=5,e.EMISSIONTEXTURE=6,e.DIFFUSECOLOR=7,e.EMISSIONCOLOR=8,e.METALLIC=9,e.SMOOTHNESS=10,e.SMOOTHNESSSCALE=11,e.SMOOTHNESSSOURCE=12,e.OCCLUSIONSTRENGTH=13,e.NORMALSCALE=14,e.PARALLAXSCALE=15,e.ENABLEEMISSION=16,e.TILINGOFFSET=17,c(e,["shaderDefines",function(){return this.shaderDefines=new Be(mi.shaderDefines)}]),e}(),Wi=function(o){function l(){this._transformUV=null,l.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new Oe(.6,.6,.6)),this._setColor(10,new Oe(1,1,1)),this._setColor(11,new Pe(1,1,1,8)),this._setColor(12,new Oe(1,1,1)),this._setColor(7,new Pe(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new Pe(1,1,0,0)),this.renderMode=1}m(l,"laya.d3.core.material.StandardMaterial",o);var t=l.prototype;return t.disableLight=function(){this._addDisablePublicShaderDefine(ui.SHADERDEFINE_POINTLIGHT|ui.SHADERDEFINE_SPOTLIGHT|ui.SHADERDEFINE_DIRECTIONLIGHT)},t.disableFog=function(){this._addDisablePublicShaderDefine(ui.SHADERDEFINE_FOG)},t.onAsynLoaded=function(t,e,i){var n=e[0];if(n.version)o.prototype.onAsynLoaded.call(this,t,e,i);else{var r=e[1],a=n.props;for(var s in a)this[s]=a[s];l._parseStandardMaterial(r,this,n),this._endLoaded()}},t.cloneTo=function(t){o.prototype.cloneTo.call(this,t);var e=t;this._transformUV&&(e._transformUV=this._transformUV.clone())},_(0,t,"ambientColor",function(){return this._getColor(9)},function(t){this._setColor(9,t)}),_(0,t,"ambientTexture",function(){return this._getTexture(5)},function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,t)}),_(0,t,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=1,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=1,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=1,this.alphaTest=!0,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=1,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=2,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=2,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=2,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=2,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=2,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=2,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=2,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=2,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=2,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=2,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=2,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=2,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)}),_(0,t,"reflectColor",function(){return this._getColor(12)},function(t){this._setColor(12,t)}),_(0,t,"tilingOffset",function(){return this._getColor(15)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,t)}),_(0,t,"albedo",function(){return this._getColor(7)},function(t){this._setColor(7,t)}),_(0,t,"diffuseColor",function(){return this._getColor(10)},function(t){this._setColor(10,t)}),_(0,t,"albedoColor",function(){return this._getColor(7)},function(t){this._setColor(7,t)}),_(0,t,"specularColor",function(){return this._getColor(11)},function(t){this._setColor(11,t)}),_(0,t,"diffuseTexture",function(){return this._getTexture(1)},function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,t)}),_(0,t,"normalTexture",function(){return this._getTexture(2)},function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,t)}),_(0,t,"specularTexture",function(){return this._getTexture(3)},function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,t)}),_(0,t,"emissiveTexture",function(){return this._getTexture(4)},function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,t)}),_(0,t,"reflectTexture",function(){return this._getTexture(6)},function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,t)}),_(0,t,"transformUV",function(){return this._transformUV},function(t){this._transformUV=t,this._setMatrix4x4(13,t.matrix),t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,t.matrix.elements,0)}),l.__init__=function(){l.SHADERDEFINE_DIFFUSEMAP=l.shaderDefines.registerDefine("DIFFUSEMAP"),l.SHADERDEFINE_NORMALMAP=l.shaderDefines.registerDefine("NORMALMAP"),l.SHADERDEFINE_SPECULARMAP=l.shaderDefines.registerDefine("SPECULARMAP"),l.SHADERDEFINE_EMISSIVEMAP=l.shaderDefines.registerDefine("EMISSIVEMAP"),l.SHADERDEFINE_AMBIENTMAP=l.shaderDefines.registerDefine("AMBIENTMAP"),l.SHADERDEFINE_REFLECTMAP=l.shaderDefines.registerDefine("REFLECTMAP"),l.SHADERDEFINE_UVTRANSFORM=l.shaderDefines.registerDefine("UVTRANSFORM"),l.SHADERDEFINE_TILINGOFFSET=l.shaderDefines.registerDefine("TILINGOFFSET"),l.SHADERDEFINE_ADDTIVEFOG=l.shaderDefines.registerDefine("ADDTIVEFOG")},l.load=function(t){return S.loader.create(t,null,null,l)},l._parseStandardMaterial=function(t,e,i){var n=i.customProps,r=n.ambientColor;e.ambientColor=new Oe(r[0],r[1],r[2]);var a=n.diffuseColor;e.diffuseColor=new Oe(a[0],a[1],a[2]);var s=n.specularColor;e.specularColor=new Pe(s[0],s[1],s[2],s[3]);var o=n.reflectColor;e.reflectColor=new Oe(o[0],o[1],o[2]);var l=n.albedoColor;l&&(e.albedo=new Pe(l[0],l[1],l[2],l[3]));var h=n.diffuseTexture.texture2D;h&&(e.diffuseTexture=Dt.getRes(t[h]));var u=n.normalTexture.texture2D;u&&(e.normalTexture=Dt.getRes(t[u]));var c=n.specularTexture.texture2D;c&&(e.specularTexture=Dt.getRes(t[c]));var _=n.emissiveTexture.texture2D;_&&(e.emissiveTexture=Dt.getRes(t[_]));var d=n.ambientTexture.texture2D;d&&(e.ambientTexture=Dt.getRes(t[d]));var f=n.reflectTexture.texture2D;f&&(e.reflectTexture=Dt.getRes(t[f]))},l.RENDERMODE_OPAQUE=1,l.RENDERMODE_OPAQUEDOUBLEFACE=2,l.RENDERMODE_CUTOUT=3,l.RENDERMODE_CUTOUTDOUBLEFACE=4,l.RENDERMODE_TRANSPARENT=13,l.RENDERMODE_TRANSPARENTDOUBLEFACE=14,l.RENDERMODE_ADDTIVE=15,l.RENDERMODE_ADDTIVEDOUBLEFACE=16,l.RENDERMODE_DEPTHREAD_TRANSPARENT=5,l.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,l.RENDERMODE_DEPTHREAD_ADDTIVE=7,l.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,l.RENDERMODE_NONDEPTH_TRANSPARENT=9,l.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,l.RENDERMODE_NONDEPTH_ADDTIVE=11,l.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,l.SHADERDEFINE_DIFFUSEMAP=0,l.SHADERDEFINE_NORMALMAP=0,l.SHADERDEFINE_SPECULARMAP=0,l.SHADERDEFINE_EMISSIVEMAP=0,l.SHADERDEFINE_AMBIENTMAP=0,l.SHADERDEFINE_REFLECTMAP=0,l.SHADERDEFINE_UVTRANSFORM=0,l.SHADERDEFINE_TILINGOFFSET=0,l.SHADERDEFINE_ADDTIVEFOG=0,l.DIFFUSETEXTURE=1,l.NORMALTEXTURE=2,l.SPECULARTEXTURE=3,l.EMISSIVETEXTURE=4,l.AMBIENTTEXTURE=5,l.REFLECTTEXTURE=6,l.ALBEDO=7,l.UVANIAGE=8,l.MATERIALAMBIENT=9,l.MATERIALDIFFUSE=10,l.MATERIALSPECULAR=11,l.MATERIALREFLECT=12,l.UVMATRIX=13,l.UVAGE=14,l.TILINGOFFSET=15,c(l,["defaultMaterial",function(){return this.defaultMaterial=new l},"shaderDefines",function(){return this.shaderDefines=new Be(mi.shaderDefines)}]),l}(mi),Xi=function(e){function i(){this._diffuseScale1=null,this._diffuseScale2=null,this._diffuseScale3=null,this._diffuseScale4=null,i.__super.call(this),this.setShaderName("Terrain"),this.renderMode=1,this._diffuseScale1=new Le,this._diffuseScale2=new Le,this._diffuseScale3=new Le,this._diffuseScale4=new Le,this.ambientColor=new Oe(.6,.6,.6),this.diffuseColor=new Oe(1,1,1),this.specularColor=new Pe(.2,.2,.2,32)}m(i,"laya.d3.core.material.TerrainMaterial",e);var t=i.prototype;return t.setDiffuseScale1=function(t,e){this._diffuseScale1.x=t,this._diffuseScale1.y=e,this._setColor(6,this._diffuseScale1)},t.setDiffuseScale2=function(t,e){this._diffuseScale2.x=t,this._diffuseScale2.y=e,this._setColor(7,this._diffuseScale2)},t.setDiffuseScale3=function(t,e){this._diffuseScale3.x=t,this._diffuseScale3.y=e,this._setColor(8,this._diffuseScale3)},t.setDiffuseScale4=function(t,e){this._diffuseScale4.x=t,this._diffuseScale4.y=e,this._setColor(9,this._diffuseScale4)},t.setDetailNum=function(t){switch(t){case 1:this._addShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4);break;case 2:this._addShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4);break;case 3:this._addShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4);break;case 4:this._addShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3)}},t.disableLight=function(){this._addDisablePublicShaderDefine(ui.SHADERDEFINE_POINTLIGHT|ui.SHADERDEFINE_SPOTLIGHT|ui.SHADERDEFINE_DIRECTIONLIGHT)},t.setShaderName=function(t){e.prototype.setShaderName.call(this,t)},_(0,t,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=1,this.depthWrite=!0,this.cull=2,this.blend=0,this.depthTest=513;break;case 2:this.renderQueue=1,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.depthTest=515;break;default:throw new Error("TerrainMaterial:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)}),_(0,t,"diffuseTexture2",function(){return this._getTexture(3)},function(t){this._setTexture(3,t)}),_(0,t,"ambientColor",function(){return this._getColor(10)},function(t){this._setColor(10,t)}),_(0,t,"diffuseTexture4",function(){return this._getTexture(5)},function(t){this._setTexture(5,t)}),_(0,t,"diffuseColor",function(){return this._getColor(11)},function(t){this._setColor(11,t)}),_(0,t,"diffuseTexture1",function(){return this._getTexture(2)},function(t){this._setTexture(2,t)}),_(0,t,"specularColor",function(){return this._getColor(12)},function(t){this._setColor(12,t)}),_(0,t,"diffuseTexture3",function(){return this._getTexture(4)},function(t){this._setTexture(4,t)}),_(0,t,"splatAlphaTexture",function(){return this._getTexture(0)},function(t){this._setTexture(0,t)}),_(0,t,"normalTexture",function(){return this._getTexture(1)},function(t){this._setTexture(1,t)}),i.__init__=function(){i.SHADERDEFINE_DETAIL_NUM1=i.shaderDefines.registerDefine("DETAIL_NUM1"),i.SHADERDEFINE_DETAIL_NUM2=i.shaderDefines.registerDefine("DETAIL_NUM2"),i.SHADERDEFINE_DETAIL_NUM4=i.shaderDefines.registerDefine("DETAIL_NUM4"),i.SHADERDEFINE_DETAIL_NUM3=i.shaderDefines.registerDefine("DETAIL_NUM3")},i.load=function(t){return S.loader.create(t,null,null,i)},i.RENDERMODE_OPAQUE=1,i.RENDERMODE_TRANSPARENT=2,i.SPLATALPHATEXTURE=0,i.NORMALTEXTURE=1,i.DIFFUSETEXTURE1=2,i.DIFFUSETEXTURE2=3,i.DIFFUSETEXTURE3=4,i.DIFFUSETEXTURE4=5,i.DIFFUSESCALE1=6,i.DIFFUSESCALE2=7,i.DIFFUSESCALE3=8,i.DIFFUSESCALE4=9,i.MATERIALAMBIENT=10,i.MATERIALDIFFUSE=11,i.MATERIALSPECULAR=12,i.SHADERDEFINE_DETAIL_NUM1=0,i.SHADERDEFINE_DETAIL_NUM2=0,i.SHADERDEFINE_DETAIL_NUM3=0,i.SHADERDEFINE_DETAIL_NUM4=0,c(i,["defaultMaterial",function(){return this.defaultMaterial=new i},"shaderDefines",function(){return this.shaderDefines=new Be(mi.shaderDefines)}]),i}(mi),Yi=function(n){function e(){this._useVertexDeep=!1,e.__super.call(this),this.setShaderName("Water")}m(e,"laya.d3.core.material.WaterMaterial",n);var t=e.prototype;return t.disableFog=function(){this._addDisablePublicShaderDefine(ui.SHADERDEFINE_FOG)},t.onAsynLoaded=function(t,e,i){n.prototype.onAsynLoaded.call(this,t,e,i)},_(0,t,"diffuseTexture",function(){return this._getTexture(1)},function(t){this._setTexture(1,t)}),_(0,t,"normalTexture",function(){return this._getTexture(2)},function(t){this._setTexture(2,t)}),_(0,t,"underWaterTexture",function(){return this._getTexture(3)},function(t){this._setTexture(3,t)}),_(0,t,"deepColorTexture",function(){return this._getTexture(10)},function(t){this._setTexture(10,t)}),_(0,t,"useFoam",null,function(t){t?this._addShaderDefine(e.SHADERDEFINE_USE_FOAM):this._removeShaderDefine(e.SHADERDEFINE_USE_FOAM)}),_(0,t,"skyTexture",function(){return this._getTexture(11)},function(t){this._setTexture(11,t)}),_(0,t,"deepScale",function(){return this._getNumber(20)},function(t){this._setNumber(20,t)}),_(0,t,"detailTexture",function(){return this._getTexture(9)},function(t){this._setTexture(9,t)}),_(0,t,"foamTexture",function(){return this._getTexture(17)},function(t){this._setTexture(17,t)}),_(0,t,"waterInfoTexture",function(){return this._getTexture(16)},function(t){this._setTexture(16,t)}),_(0,t,"vertexDispTexture",function(){return this._getTexture(4)},function(t){this._setTexture(4,t)}),_(0,t,"currentTm",function(){return this._getNumber(8)},function(t){this._setNumber(8,t)}),_(0,t,"waveInfo",function(){return this._getBuffer(12)},function(t){this._setBuffer(12,t)}),_(0,t,"waveInfoD",function(){return this._getBuffer(13)},function(t){this._setBuffer(13,t)}),_(0,t,"waveMainDir",function(){return this._getNumber(14)},function(t){this._setNumber(14,t*Math.PI/180)}),_(0,t,"geoWaveUVScale",function(){return this._getNumber(18)},function(t){this._setNumber(18,t)}),_(0,t,"windSpeed",function(){return 0},function(t){}),_(0,t,"scrsize",null,function(t){this._setBuffer(15,t)}),_(0,t,"seaColor",function(){return this._getBuffer(19)},function(t){this._setBuffer(19,t)}),_(0,t,"useVertexDeep",function(){return this._useVertexDeep},function(t){(this._useVertexDeep=t)?this._addShaderDefine(e.SHADERDEFINE_USEVERTEXHEIGHT):this._removeShaderDefine(e.SHADERDEFINE_USEVERTEXHEIGHT)}),_(0,t,"windDir",function(){return 0},function(t){}),_(0,t,"useRefractTexture",null,function(t){t?this._addShaderDefine(e.SHADERDEFINE_USE_REFRACT_TEX):this._removeShaderDefine(e.SHADERDEFINE_USE_REFRACT_TEX)}),_(0,t,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=1,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1;break;case 2:this.renderQueue=1,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1;break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=1;break;case 13:this.renderQueue=2,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;default:throw new Error("PBRMaterial:renderMode value error.")}}),e.__init__=function(){e.SHADERDEFINE_CUBE_ENV=e.shaderDefines.registerDefine("CUBE_ENV"),e.SHADERDEFINE_HDR_ENV=e.shaderDefines.registerDefine("HDR_ENV"),e.SHADERDEFINE_SHOW_NORMAL=e.shaderDefines.registerDefine("SHOW_NORMAL"),e.SHADERDEFINE_USEVERTEXHEIGHT=e.shaderDefines.registerDefine("USE_VERTEX_DEEPINFO"),e.SHADERDEFINE_USE_FOAM=e.shaderDefines.registerDefine("USE_FOAM"),e.SHADERDEFINE_USE_REFRACT_TEX=e.shaderDefines.registerDefine("USE_REFR_TEX")},e.load=function(t){return S.loader.create(t,null,null,e)},e.DIFFUSETEXTURE=1,e.NORMALTEXTURE=2,e.UNDERWATERTEXTURE=3,e.VERTEXDISPTEXTURE=4,e.UVANIAGE=5,e.UVMATRIX=6,e.UVAGE=7,e.CURTM=8,e.DETAILTEXTURE=9,e.DEEPCOLORTEXTURE=10,e.SKYTEXTURE=11,e.WAVEINFO=12,e.WAVEINFOD=13,e.WAVEMAINDIR=14,e.SCRSIZE=15,e.WATERINFO=16,e.FOAMTEXTURE=17,e.GEOWAVE_UV_SCALE=18,e.SEA_COLOR=19,e.WAVEINFODEEPSCALE=20,e.SHADERDEFINE_SHOW_NORMAL=0,e.SHADERDEFINE_CUBE_ENV=0,e.SHADERDEFINE_HDR_ENV=0,e.SHADERDEFINE_USE_FOAM=0,e.SHADERDEFINE_USE_REFRACT_TEX=0,e.SHADERDEFINE_USEVERTEXHEIGHT=0,e.RENDERMODE_OPAQUE=1,e.RENDERMODE_OPAQUEDOUBLEFACE=2,e.RENDERMODE_CUTOUT=3,e.RENDERMODE_CUTOUTDOUBLEFACE=4,e.RENDERMODE_TRANSPARENT=13,c(e,["defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new Be(mi.shaderDefines)}]),e}(mi),ji=function(t){function a(t,e,i,n){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===i&&(i=35044),void 0===n&&(n=!1),a.__super.call(this),this._indexType=t,this._indexCount=e,this._bufferUsage=i,this._bufferType=34963,this._canRead=n;var r;if("ushort"==t)this._indexTypeByteCount=2;else{if("ubyte"!=t)throw new Error("unidentification index type.");this._indexTypeByteCount=1}r=this._indexTypeByteCount*e,this._byteLength=r,f.isConchNode||(this._bind(),o._gl.bufferData(this._bufferType,r,this._bufferUsage)),this.memorySize=n?("ushort"==t?this._buffer=new Uint16Array(e):"ubyte"==t&&(this._buffer=new Uint8Array(e)),2*r):r}m(a,"laya.d3.graphics.IndexBuffer3D",t);var e=a.prototype;return e.setData=function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=4294967295);var r=0;if("ushort"==this._indexType?(r=2,0===i&&4294967295===n||(t=new Uint16Array(t.buffer,i*r,n))):"ubyte"==this._indexType&&(r=1,0===i&&4294967295===n||(t=new Uint8Array(t.buffer,i*r,n))),f.isConchNode||(this._bind(),o._gl.bufferSubData(this._bufferType,e*r,t)),this._canRead)if(0!==e||0!==i||4294967295!==n){var a=this._buffer.length-e;a<n&&(n=a);for(var s=0;s<n;s++)this._buffer[e+s]=t[s]}else this._buffer=t},e.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},e.disposeResource=function(){t.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},_(0,e,"indexType",function(){return this._indexType}),_(0,e,"indexTypeByteCount",function(){return this._indexTypeByteCount}),_(0,e,"indexCount",function(){return this._indexCount}),_(0,e,"canRead",function(){return this._canRead}),a.INDEXTYPE_UBYTE="ubyte",a.INDEXTYPE_USHORT="ushort",a.create=function(t,e,i,n){return void 0===i&&(i=35044),void 0===n&&(n=!1),new a(t,e,i,n)},a}(o),Zi=function(a){function r(t,e,i,n){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===n&&(n=!1),r.__super.call(this),this._vertexDeclaration=t,this._vertexCount=e,this._bufferUsage=i,this._bufferType=34962,this._canRead=n,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*e,f.isConchNode||(this._bind(),o._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage)),n&&(this._buffer=new Float32Array(this._byteLength/4))}m(r,"laya.d3.graphics.VertexBuffer3D",a);var t=r.prototype;return t.bindWithIndexBuffer=function(t){t&&t._bind(),this._bind()},t.setData=function(t,e,i,n){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=4294967295),0===i&&4294967295===n||(t=new Float32Array(t.buffer,4*i,n)),f.isConchNode||(this._bind(),o._gl.bufferSubData(this._bufferType,4*e,t)),this._canRead)if(0!==e||0!==i||4294967295!==n){var r=this._buffer.length-e;r<n&&(n=r);for(var a=0;a<n;a++)this._buffer[e+a]=t[a]}else this._buffer=t},t.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},t.disposeResource=function(){for(var t=R.mainContext,e=this._vertexDeclaration.getVertexElements(),i=o._enableAtributes,n=0,r=e.length;n<r;n++)i[n]===this._glBuffer&&(t.disableVertexAttribArray(n),i[n]=null);a.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},_(0,t,"vertexDeclaration",function(){return this._vertexDeclaration}),_(0,t,"vertexCount",function(){return this._vertexCount}),_(0,t,"canRead",function(){return this._canRead}),r.create=function(t,e,i,n){return void 0===i&&(i=35044),void 0===n&&(n=!1),new r(t,e,i,n)},r}(o),Ki=function(o){function l(){l.__super.call(this),this.setShaderName("PARTICLESHURIKEN"),this.renderMode=6}m(l,"laya.d3.core.particleShuriKen.ShurikenParticleMaterial",o);var t=l.prototype;return t.onAsynLoaded=function(t,e,i){var n=e[0];if(n.version)o.prototype.onAsynLoaded.call(this,t,e,i);else{var r=e[1],a=n.props;for(var s in a)this[s]=a[s];l._parseShurikenParticleMaterial(r,this,n),this._endLoaded()}},_(0,t,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=1,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=1,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=1,this.alphaTest=!0,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=1,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=2,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=2,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=2,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=2,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=2,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=2,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=2,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=2,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=2,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=2,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=2,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=2,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)}),_(0,t,"tintColor",function(){return this._getColor(2)},function(t){t?this._addShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TINTCOLOR):this._removeShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TINTCOLOR),this._setColor(2,t)}),_(0,t,"tilingOffset",function(){return this._getColor(3)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(3,t)}),_(0,t,"diffuseTexture",function(){return this._getTexture(1)},function(t){t?this._addShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,t)}),l.__init__=function(){l.SHADERDEFINE_DIFFUSEMAP=l.shaderDefines.registerDefine("DIFFUSEMAP"),l.SHADERDEFINE_TINTCOLOR=l.shaderDefines.registerDefine("TINTCOLOR"),l.SHADERDEFINE_ADDTIVEFOG=l.shaderDefines.registerDefine("ADDTIVEFOG"),l.SHADERDEFINE_TILINGOFFSET=l.shaderDefines.registerDefine("TILINGOFFSET")},l.load=function(t){return S.loader.create(t,null,null,l)},l._parseShurikenParticleMaterial=function(t,e,i){var n=i.customProps,r=n.diffuseTexture.texture2D;r&&(e.diffuseTexture=Dt.getRes(t[r]));var a=n.tintColor;a&&(e.tintColor=new Pe(a[0],a[1],a[2],a[3]))},l.RENDERMODE_OPAQUE=1,l.RENDERMODE_OPAQUEDOUBLEFACE=2,l.RENDERMODE_CUTOUT=3,l.RENDERMODE_CUTOUTDOUBLEFACE=4,l.RENDERMODE_TRANSPARENT=13,l.RENDERMODE_TRANSPARENTDOUBLEFACE=14,l.RENDERMODE_ADDTIVE=15,l.RENDERMODE_ADDTIVEDOUBLEFACE=16,l.RENDERMODE_DEPTHREAD_TRANSPARENT=5,l.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,l.RENDERMODE_DEPTHREAD_ADDTIVE=7,l.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,l.RENDERMODE_NONDEPTH_TRANSPARENT=9,l.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,l.RENDERMODE_NONDEPTH_ADDTIVE=11,l.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,l.SHADERDEFINE_DIFFUSEMAP=0,l.SHADERDEFINE_TINTCOLOR=0,l.SHADERDEFINE_TILINGOFFSET=0,l.SHADERDEFINE_ADDTIVEFOG=0,l.DIFFUSETEXTURE=1,l.TINTCOLOR=2,l.TILINGOFFSET=3,c(l,["defaultMaterial",function(){return this.defaultMaterial=new l},"shaderDefines",function(){return this.shaderDefines=new Be(mi.shaderDefines)}]),l}(mi),qi=function(t){function e(){e.__super.call(this),this.setShaderName("Trail"),this._setColor(2,new Pe(1,1,1,1))}m(e,"laya.d3.core.trail.TrailMaterial",mi);var i=e.prototype;return _(0,i,"tintColor",function(){return this._getColor(2)},function(t){this._setColor(2,t)}),_(0,i,"diffuseTexture",function(){return this._getTexture(1)},function(t){t?this._addShaderDefine(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_DIFFUSETEXTURE):this._removeShaderDefine(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_DIFFUSETEXTURE),this._setTexture(1,t)}),_(0,i,"tilingOffset",function(){return this._getColor(3)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(3,t)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSETEXTURE=e.shaderDefines.registerDefine("DIFFUSETEXTURE"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET")},e.load=function(t){return S.loader.create(t,null,null,e)},e.SHADERDEFINE_DIFFUSETEXTURE=0,e.SHADERDEFINE_TILINGOFFSET=0,e.DIFFUSETEXTURE=1,e.TINTCOLOR=2,e.TILINGOFFSET=3,c(e,["defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new Be(mi.shaderDefines)}]),e}(),Qi=(function(t){function e(){this._startTm=0,e.__super.call(this),laya.d3.water.WaterDetailMaterial.init(),this.setShaderName("WaterDetail"),this.cull=0,this._startTm=S.timer.currTimer}m(e,"laya.d3.water.WaterDetailMaterial",mi);var i=e.prototype;_(0,i,"currentTm",function(){return this._getNumber(1)},function(t){this._setNumber(1,t-this._startTm)}),_(0,i,"waveInfo",function(){return this._getBuffer(12)},function(t){this._setBuffer(12,t)}),_(0,i,"waveInfoD",function(){return this._getBuffer(13)},function(t){this._setBuffer(13,t)}),_(0,i,"texWaveUVScale",function(){return this._getNumber(15)},function(t){this._setNumber(15,t)}),e.init=function(){if(!laya.d3.water.WaterDetailMaterial._bInited){laya.d3.water.WaterDetailMaterial._bInited=!0;var t=Fi.nameKey.add("WaterDetail");ui.add(t,"\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 uv;\n\nvarying vec2 vUv;\nvarying vec3 vWorldNorm;\nvarying vec3 vWorldTangent;\nvarying vec3 vWorldBinormal;\n\n\nvoid main() {\n\tvec3 pos = a_position;\n\tif(pos.z!=0.)pos.y=pos.z;\n\tpos.z=0.5;\n\tgl_Position = vec4(pos,1.);\n    vUv = uv;\n\t//vWorldNorm = normalize((modelMat*vec4(a_normal,0.0)).xyz);\n\t//vWorldTangent = normalize((modelMat*vec4(tangent,0.0)).xyz);\n\t//vWorldBinormal = normalize((modelMat*vec4(binormal,0.0)).xyz);\n}\n",'precision highp float;\nprecision lowp int;\n\nconst float PI = 3.14159265358979323846264;\nconst float _2PI = 6.2831853071796;\nvarying vec2 vUv;\nvarying vec3 vWorldNorm;\nvarying vec3 vWorldTangent;\nvarying vec3 vWorldBinormal;\n\nuniform float u_curTm;\n\n#include "WaveFunction.glsl"\n\nvoid main() {\n\tvec3 wave_N,wave_B,wave_T;\n\tcalcWave(u_curTm, vUv,wave_B,wave_T,wave_N);\n\tgl_FragColor.rgb = normalize(wave_N)*0.5+vec3(0.5);// vec3(0.1,.4,0.1);\n    gl_FragColor.a = 1.0;\n}\n',{a_position:0,a_normal:3,uv:2},{u_curTm:[1,1],u_WaveInfo:[12,1],u_WaveInfoD:[13,1],TEXWAVE_UV_SCALE:[15,1]})}},e.CURTM=1,e.WAVEINFO=12,e.WAVEINFOD=13,e.WAVEMAINDIR=14,e.TEXWAVE_UV_SCALE=15,e._bInited=!1}(),function(e){function t(){this._animationSprites=null,this._animationSpritesInitLocalMatrix=null,this._tempCurAnimationData=null,this._curOriginalData=null,this._lastFrameIndex=-1,this._curAnimationDatas=null,t.__super.call(this),this._animationSprites=[],this._animationSpritesInitLocalMatrix=[]}m(t,"laya.d3.component.animation.RigidAnimations",e);var i=t.prototype;i._init=function(){for(var t=this._templet.getNodes(this.currentAnimationClipIndex),e=this._owner,i=t.length,n=0,r=new Uint16Array(this._templet.getPublicExtData()),a=0;a<i;a++){var s=r.slice(n+1,n+1+r[n]);n+=r[n]+1;for(var o=1;o<s.length;o++){s[o];e=e._childs[s[o]]}var l=e.getChildByName(t[a].name);if(!l)break;this._animationSprites[a]=l;var h=this._animationSpritesInitLocalMatrix[a];h||(h=this._animationSpritesInitLocalMatrix[a]=new De),l.transform.localMatrix.cloneTo(h),e=this._owner}},i._animtionPlay=function(){this._templet.loaded?this._init():this._templet.once("loaded",this,this._init)},i._animtionStop=function(){if(this._lastFrameIndex=-1,this._player.returnToZeroStopped){this._curAnimationDatas=null;for(var t=0;t<this._animationSprites.length;t++)this._animationSprites[t].transform.localMatrix=this._animationSpritesInitLocalMatrix[t]}},i._effectAnimation=function(t){for(var e=0,i=this._animationSprites.length;e<i;e++){for(var n=this._animationSprites[e],r=n.transform.localMatrix,a=r.elements,s=0;s<16;s++)a[s]=this._curAnimationDatas[16*e+s];n.transform.localMatrix=r}},i._load=function(t){e.prototype._load.call(this,t),this._player.on("stopped",this,this._animtionStop),this._player.on("played",this,this._animtionPlay)},i._update=function(t){if(2===this._player.state&&this._templet&&this._templet.loaded){var e=this._player.playbackRate*S.timer.scale,i=this._player.cachePlayRate,n=this._player.isCache&&i<=e,r=n?this.currentFrameIndex:-1;if(-1===r||this._lastFrameIndex!==r){var a=this.currentAnimationClipIndex,s=this._templet.getNodes(a),o=this._templet._animationDatasCache;if(n){var l=this._templet.getAnimationDataWithCache(i,o,a,r);if(l)return this._curAnimationDatas=l,this._lastFrameIndex=r,void this._effectAnimation(s)}var h=16*s.length;this._curAnimationDatas=n?new Float32Array(h):(this._tempCurAnimationData||(this._tempCurAnimationData=new Float32Array(h)),this._tempCurAnimationData),this._curOriginalData||(this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(a))),n?this._templet.getOriginalData(a,this._curOriginalData,this._player._fullFrames[a],r,this._player.currentFrameTime):this._templet.getOriginalDataUnfixedRate(a,this._curOriginalData,this._player.currentPlayTime),qe._computeRootAnimationData(s,this._curOriginalData,this._curAnimationDatas),n&&this._templet.setAnimationDataWithCache(i,o,a,r,this._curAnimationDatas),this._lastFrameIndex=r,this._effectAnimation(s)}}},i._unload=function(t){e.prototype._unload.call(this,t),this._animationSprites=null,this._animationSpritesInitLocalMatrix=null,this._tempCurAnimationData=null,this._curOriginalData=null,this._curAnimationDatas=null},_(0,i,"url",null,function(t){console.log("Warning: discard property,please use templet property instead.");var e=S.loader.create(t,null,null,r);this._templet!==e&&(0!==this._player.state&&this._player.stop(!0),this._templet=e,this._player.templet=e,this._curOriginalData=null,this._curAnimationDatas=null,this._tempCurAnimationData=null,this._templet._animationDatasCache||(this._templet._animationDatasCache=[]),this.event("animationchanged",this))}),_(0,i,"templet",e.prototype._$get_templet,function(t){this._templet!==t&&(0!==this._player.state&&this._player.stop(!0),this._templet=t,this._player.templet=t,this._curOriginalData=null,this._curAnimationDatas=null,this._tempCurAnimationData=null,this._templet._animationDatasCache||(this._templet._animationDatasCache=[]),this.event("animationchanged",this))})}(Ei),function(i){function T(){this._tempCurAnimationData=null,this._tempCurBonesData=null,this._curOriginalData=null,this._lastFrameIndex=-1,this._curMeshAnimationData=null,this._curBonesDatas=null,this._curAnimationDatas=null,this._ownerMesh=null,this._boneIndexToMeshList=null,this._oldVersion=!1,T.__super.call(this),this._boneIndexToMeshList=[]}m(T,"laya.d3.component.animation.SkinAnimations",i);var t=T.prototype;return t._computeBoneIndexToMeshOnTemplet=function(){this._templet.loaded?this._computeBoneIndexToMeshOnMesh():this._templet.once("loaded",this,this._computeBoneIndexToMeshOnMesh)},t._computeBoneIndexToMeshOnMesh=function(){"LAYAANIMATION:02"===this._templet._aniVersion?this._oldVersion=!1:this._oldVersion=!0;var t=this._owner.meshFilter.sharedMesh;t.loaded?this._computeBoneIndexToMesh(t):t.on("loaded",this,this._computeBoneIndexToMesh)},t._computeBoneIndexToMesh=function(t){var e=t._boneNames;if(e)for(var i=e.length,n=this._templet._anis,r=0,a=n.length;r<a;r++){var s=this._boneIndexToMeshList[r];s||(s=this._boneIndexToMeshList[r]=[]),s.length=i;for(var o=n[r],l=0;l<i;l++)s[l]=o.bone3DMap[e[l]]}},t._getAnimationDatasWithCache=function(t,e,i,n,r){var a=i[n];if(a){var s=a[t];if(s){var o=s[e.id];return o?o[r]:null}return null}return null},t._setAnimationDatasWithCache=function(t,e,i,n,r,a){var s=i[n]||(i[n]={}),o=s[t]||(s[t]={});(o[e.id]||(o[e.id]=[]))[r]=a},t._onAnimationPlayMeshLoaded=function(){for(var t=this._ownerMesh.meshRender._renderElements,e=0,i=t.length;e<i;e++)t[e]._canDynamicBatch=!1},t._onAnimationPlay=function(){this._ownerMesh._render._addShaderDefine(yn.SHADERDEFINE_BONE);var t=this._ownerMesh.meshFilter.sharedMesh;t.loaded?this._onAnimationPlayMeshLoaded():t.once("loaded",this,this._onAnimationPlayMeshLoaded)},t._onAnimationStop=function(){this._lastFrameIndex=-1,this._player.returnToZeroStopped&&(this._curBonesDatas=null,this._curAnimationDatas=null,this._ownerMesh._render._removeShaderDefine(yn.SHADERDEFINE_BONE));for(var t=this._ownerMesh.meshRender._renderElements,e=0,i=t.length;e<i;e++)t[e]._canDynamicBatch=!0},t._load=function(t){i.prototype._load.call(this,t),this._ownerMesh=t,this._player.on("played",this,this._onAnimationPlay),this._player.on("stopped",this,this._onAnimationStop),this._owner.meshFilter.on("meshchanged",this,this._computeBoneIndexToMeshOnTemplet)},t._update=function(t){var e=this._ownerMesh.meshFilter.sharedMesh;if(2===this._player.state&&this._templet&&this._templet.loaded&&e.loaded){var i=this._player.playbackRate*S.timer.scale,n=this._player.cachePlayRate,r=this._player.isCache&&n<=i,a=r?this.currentFrameIndex:-1;if(-1===a||this._lastFrameIndex!==a){var s=this.currentAnimationClipIndex,o=this._templet._animationDatasCache[0],l=this._templet._animationDatasCache[1];if(r){var h=this._getAnimationDatasWithCache(n,e,l,s,a);if(h)return this._curAnimationDatas=h,this._curBonesDatas=this._templet.getAnimationDataWithCache(n,o,s,a),void(this._lastFrameIndex=a)}var u=!1;r&&(this._curBonesDatas=this._templet.getAnimationDataWithCache(n,o,s,a),u=!!this._curBonesDatas);var c=this._templet.getNodes(s),_=16*c.length,d=e.InverseAbsoluteBindPoses;this._oldVersion?this._curMeshAnimationData||(this._curMeshAnimationData=new Float32Array(_)):this._curMeshAnimationData||(this._curMeshAnimationData=new Float32Array(16*d.length));var f,p,m=0,g=0,v=0,y=e.getSubMeshCount();if(r){for(this._curAnimationDatas=[],this._curAnimationDatas.length=y,m=0;m<y;m++)for(f=this._curAnimationDatas[m]=[],v=(p=e.getSubMesh(m))._boneIndicesList.length,f.length=v,g=0;g<v;g++)f[g]=new Float32Array(16*p._boneIndicesList[g].length);u||(this._curBonesDatas=new Float32Array(_))}else{if(!this._tempCurAnimationData)for(this._tempCurAnimationData=[],this._tempCurAnimationData.length=y,m=0;m<y;m++)for(f=this._tempCurAnimationData[m]=[],v=(p=e.getSubMesh(m))._boneIndicesList.length,f.length=v,g=0;g<v;g++)f[g]=new Float32Array(16*p._boneIndicesList[g].length);this._tempCurBonesData||(this._tempCurBonesData=new Float32Array(_)),this._curAnimationDatas=this._tempCurAnimationData,this._curBonesDatas=this._tempCurBonesData}if(this._curOriginalData||(this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(s))),r?this._templet.getOriginalData(s,this._curOriginalData,this._player._fullFrames[s],a,this._player.currentFrameTime):this._templet.getOriginalDataUnfixedRate(s,this._curOriginalData,this._player.currentPlayTime),this._oldVersion)r&&u?qe._computeAnimationDatasByArrayAndMatrixFastOld(d,this._curBonesDatas,this._curMeshAnimationData):qe._computeBoneAndAnimationDatasByBindPoseMatrxixOld(c,this._curOriginalData,d,this._curBonesDatas,this._curMeshAnimationData);else{var x=this._boneIndexToMeshList[s];r&&u?qe._computeAnimationDatasByArrayAndMatrixFast(d,this._curBonesDatas,this._curMeshAnimationData,x):qe._computeBoneAndAnimationDatasByBindPoseMatrxix(c,this._curOriginalData,d,this._curBonesDatas,this._curMeshAnimationData,x)}for(m=0;m<y;m++){var E=e.getSubMesh(m)._boneIndicesList;for(v=E.length,f=this._curAnimationDatas[m],g=0;g<v;g++)T._splitAnimationDatas(E[g],this._curMeshAnimationData,f[g])}r&&(this._setAnimationDatasWithCache(n,e,l,s,a,this._curAnimationDatas),u||this._templet.setAnimationDataWithCache(n,o,s,a,this._curBonesDatas)),this._lastFrameIndex=a}}},t._preRenderUpdate=function(t){var e=t.renderElement.renderObj;this._curAnimationDatas?e._skinAnimationDatas=this._curAnimationDatas[e._indexInMesh]:e._skinAnimationDatas=null},t._unload=function(t){2==this.player.state&&this._ownerMesh._render._removeShaderDefine(yn.SHADERDEFINE_BONE),this._templet&&!this._templet.loaded&&this._templet.off("loaded",this,this._computeBoneIndexToMeshOnMesh);var e=this._ownerMesh.meshFilter.sharedMesh;e.loaded||e.off("loaded",this,this._onAnimationPlayMeshLoaded),i.prototype._unload.call(this,t),this._tempCurAnimationData=null,this._tempCurBonesData=null,this._curOriginalData=null,this._curMeshAnimationData=null,this._curBonesDatas=null,this._curAnimationDatas=null,this._ownerMesh=null},_(0,t,"curBonesDatas",function(){return this._curBonesDatas}),_(0,t,"templet",i.prototype._$get_templet,function(t){this._templet!==t&&(0!==this._player.state&&this._player.stop(!0),this._templet=t,this._player.templet=t,this._computeBoneIndexToMeshOnTemplet(),this._curOriginalData=null,this._curMeshAnimationData=null,this._tempCurBonesData=null,this._tempCurAnimationData=null,this._templet._animationDatasCache||(this._templet._animationDatasCache=[[],[]]),this.event("animationchanged",this))}),T._splitAnimationDatas=function(t,e,i){for(var n=0,r=t.length,a=0;n<r;n++)for(var s=0;s<16;s++,a++)i[a]=e[(t[n]<<4)+s]},T}(Ei)),Ji=function(t){function l(){this._size=null,this._transformOrientedBoundBox=null,this.center=null,l.__super.call(this),this._needUpdate=!1}m(l,"laya.d3.component.physics.BoxCollider",Si);var e=l.prototype;return e._updateCollider=function(){if(this._needUpdate){var t=this._transformOrientedBoundBox.transformation,e=this._owner.transform,i=e.rotation,n=e.scale,r=this.center.elements;0===r[0]&&0===r[1]&&0===r[2]?De.createAffineTransformation(e.position,i,Oe.ONE,t):(Oe.multiply(this.center,n,l._deviationV3),Oe.transformQuat(l._deviationV3,i,l._deviationV3),Oe.add(e.position,l._deviationV3,l._deviationV3),De.createAffineTransformation(l._deviationV3,i,Oe.ONE,t)),this._transformOrientedBoundBox.transformation=t;var a=this._transformOrientedBoundBox.extents.elements,s=this._size.elements,o=n.elements;a[0]=.5*s[0]*o[0],a[1]=.5*s[1]*o[1],a[2]=.5*s[2]*o[2],this._needUpdate=!1}},e._onWorldMatrixChanged=function(){for(var t in this._needUpdate=!0,this._runtimeCollisonMap)this._runtimeCollisonTestMap[t]=!0,this._runtimeCollisonMap[t]._runtimeCollisonTestMap[this.id]=!0},e._initialize=function(t){laya.d3.component.Component3D.prototype._initialize.call(this,t),this._transformOrientedBoundBox=new Ie(new Oe,new De),this._size=new Oe,this.center=new Oe,t.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged),this._needUpdate=!0},e._getType=function(){return 1},e._collisonTo=function(t){switch(t._getType()){case 0:return 0!==this.boundBox.containsSphere(t.boundSphere);case 1:return 0!==this.boundBox.containsOrientedBoundBox(t.boundBox);case 2:var e=t;if(0===this.boundBox.containsBoundBox(e._boundBox))return!1;for(var i=t.mesh._positions,n=0,r=i.length;n<r;n++)if(1===this.boundBox.containsPoint(i[n]))return!0;return!1;default:throw new Error("BoxCollider:unknown collider type.")}},e._cloneTo=function(t){var e=t,i=e.size;this.size.cloneTo(i),e.size=i,this.center.cloneTo(e.center)},e.raycast=function(t,e,i){void 0===i&&(i=179e306),this._updateCollider();var n=this._transformOrientedBoundBox.intersectsRay(t,e.position);return-1!==n&&n<=i?(e.distance=n,e.sprite3D=this._owner,!0):(e.distance=-1,e.sprite3D=null,!1)},e.setFromBoundBox=function(t){Ie.createByBoundBox(t,this._transformOrientedBoundBox);var e=this._transformOrientedBoundBox.extents;this._size=new Oe(2*e.x,2*e.y,2*e.z),this.center=new Oe,Oe.add(t.min,t.max,this.center),Oe.scale(this.center,.5,this.center),this._needUpdate=!0},_(0,e,"boundBox",function(){return this._updateCollider(),this._transformOrientedBoundBox}),_(0,e,"size",function(){return this._size},function(t){this._size=t,this._needUpdate=!0}),c(l,["_deviationV3",function(){return this._deviationV3=new Oe},"_obbCenterV3",function(){return this._obbCenterV3=new Oe}]),l}(),$i=function(t){function E(){this._transformBoundingBox=null,this._mesh=null,E.__super.call(this),this._transformBoundingBox=new xe(new Oe,new Oe),this._needUpdate=!1}m(E,"laya.d3.component.physics.MeshCollider",Si);var e=E.prototype;return e._updateBoundBoxCollider=function(){if(this._needUpdate){for(var t=this._owner.transform.worldMatrix,e=this._mesh.boundingBoxCorners,i=0;i<8;i++)Oe.transformCoordinate(e[i],t,E._tempBoundBoxCorners[i]);xe.createfromPoints(E._tempBoundBoxCorners,this._transformBoundingBox),this._needUpdate=!1}},e._raycastMesh=function(t,e,i,n){void 0===n&&(n=179e306);var r=e.transform.worldMatrix,a=E._tempMatrix4x40;r.invert(a);var s=t.origin,o=t.direction,l=E._tempRay0;Oe.transformCoordinate(s,a,l.origin),Oe.TransformNormal(o,a,l.direction);for(var h=Number.MAX_VALUE,u=0,c=this._mesh.getRenderElementsCount();u<c;u++){var _=this._mesh.getRenderElement(u),d=_._getVertexBuffer(0),f=d.getData(),p=_._getIndexBuffer().getData(),m=E._tempRaycastHit;if(je.rayIntersectsPositionsAndIndices(l,f,d.vertexDeclaration,p,m)){Oe.transformCoordinate(m.position,r,m.position);var g=E._tempVector30;Oe.subtract(s,m.position,g);var v=Oe.scalarLength(g);if(v<n&&v<h){m.distance=v,m.sprite3D=e;var y=m.trianglePositions;Oe.transformCoordinate(y[0],r,y[0]),Oe.transformCoordinate(y[1],r,y[1]),Oe.transformCoordinate(y[2],r,y[2]);var x=m.triangleNormals;return Oe.transformCoordinate(x[0],r,x[0]),Oe.transformCoordinate(x[1],r,x[1]),Oe.transformCoordinate(x[2],r,x[2]),h=v,m.cloneTo(i),!0}return!1}}return!1},e._onWorldMatrixChanged=function(){this._needUpdate=!0},e._initialize=function(t){laya.d3.component.Component3D.prototype._initialize.call(this,t),t.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged),this._needUpdate=!0},e._getType=function(){return 2},e._collisonTo=function(t){var e=0,i=0,n=this.mesh._positions;switch(t._getType()){case 0:var r=t;if(0===Se.sphereContainsBox(r.boundSphere,this._boundBox))return!1;for(e=0,i=n.length;e<i;e++)if(1===Se.sphereContainsPoint(r.boundSphere,n[e]))return!0;return!1;case 1:var a=t;if(0===a.boundBox.containsBoundBox(this._boundBox))return!1;for(e=0,i=n.length;e<i;e++)if(1===a.boundBox.containsPoint(n[e]))return!0;return!1;case 2:var s=t;return 1!==Se.intersectsBoxAndBox(s._boundBox,this._boundBox);default:throw new Error("MeshCollider:unknown collider type.")}},e._cloneTo=function(t){t.mesh=this._mesh},e.raycast=function(t,e,i){if(void 0===i&&(i=179e306),null==this._mesh||!this._mesh.loaded)return!1;var n=Se.intersectsRayAndBoxRD(t,this._boundBox);return!!(-1!==n&&n<=i&&this._raycastMesh(t,this._owner,e,i))||(e.distance=-1,e.sprite3D=null,!1)},_(0,e,"_boundBox",function(){return this._updateBoundBoxCollider(),this._transformBoundingBox}),_(0,e,"mesh",function(){return this._mesh},function(t){this._mesh=t}),c(E,["_tempRay0",function(){return this._tempRay0=new Re(new Oe,new Oe)},"_tempVector30",function(){return this._tempVector30=new Oe},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new De},"_tempRaycastHit",function(){return this._tempRaycastHit=new Ze},"_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new Oe,new Oe,new Oe,new Oe,new Oe,new Oe,new Oe,new Oe]}]),E}(),tn=function(t){function e(){this._originalBoundSphere=null,this._transformBoundSphere=null,e.__super.call(this),this._needUpdate=!1}m(e,"laya.d3.component.physics.SphereCollider",Si);var i=e.prototype;return i._updateCollider=function(){if(this._needUpdate){var t=NaN,e=this._owner.transform,i=e.scale;t=i.x>=i.y&&i.x>=i.z?i.x:i.y>=i.z?i.y:i.z,Oe.transformCoordinate(this._originalBoundSphere.center,e.worldMatrix,this._transformBoundSphere.center),this._transformBoundSphere.radius=this._originalBoundSphere.radius*t,this._needUpdate=!1}},i._onWorldMatrixChanged=function(){for(var t in this._needUpdate=!0,this._runtimeCollisonMap)this._runtimeCollisonTestMap[t]=!0,this._runtimeCollisonMap[t]._runtimeCollisonTestMap[this.id]=!0},i._initialize=function(t){laya.d3.component.Component3D.prototype._initialize.call(this,t),this._originalBoundSphere=new Te(new Oe(0,0,0),.5),this._transformBoundSphere=new Te(new Oe(0,0,0),.5),t.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged),this._needUpdate=!0,this._tempVector32=new Oe},i._getType=function(){return 0},i._collisonTo=function(t){switch(t._getType()){case 0:return 0!==Se.sphereContainsSphere(this.boundSphere,t.boundSphere);case 1:return 0!==t.boundBox.containsSphere(this.boundSphere);case 2:var e=t;if(0===Se.sphereContainsBox(this.boundSphere,e._boundBox))return!1;for(var i=e.mesh._positions,n=0,r=i.length;n<r;n++)if(Oe.add(e.owner.transform.position,i[n],this._tempVector32),1===Se.sphereContainsPoint(this.boundSphere,this._tempVector32))return!0;return!1;default:throw new Error("SphereCollider:unknown collider type.")}},i._cloneTo=function(t){var e=t;e.radius=this.radius;var i=e.center;this.center.cloneTo(i),e.center=i},i.raycast=function(t,e,i){void 0===i&&(i=179e306),this._updateCollider();var n=this._transformBoundSphere.intersectsRayPoint(t,e.position);return-1!==n&&n<=i?(e.distance=n,e.sprite3D=this._owner,!0):(e.distance=-1,e.sprite3D=null,!1)},_(0,i,"center",function(){return this._originalBoundSphere.center},function(t){this._originalBoundSphere.center=t}),_(0,i,"radius",function(){return this._originalBoundSphere.radius},function(t){this._originalBoundSphere.radius=t}),_(0,i,"boundSphere",function(){return this._updateCollider(),this._transformBoundSphere}),e}(),en=function(t){function f(){this.simLodInfo=null,this._src=null,this._buffer=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,f.__super.call(this),this._type=3553}m(f,"laya.d3.resource.DataTexture2D",gi);var e=f.prototype;return e.genDebugMipmaps=function(){var t=[];return t.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),t.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),t.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),t.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),t.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),t.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),t.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),t.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),t.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),t.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),t},e._onTextureLoaded=function(t){},e._createWebGlTexture=function(){if(!this._buffer&&!this._mipmaps)throw"create GLTextur err:no data";var t=R.mainContext;t.getExtension("EXT_shader_texture_lod");var e=this._source=t.createTexture(),i=this._width,n=this._height,r=L.curBindTexTarget,a=L.curBindTexValue;if(L.bindTexture(t,this._type,e),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var s=0;t.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var o=0;o<this._mipmaps.length;o++){if(this._mipmaps[o].byteLength!=l*h*4)throw"mipmap size error  level:"+o;t.texSubImage2D(this._type,0,f.simLodRect[s++],f.simLodRect[s++],f.simLodRect[s++],f.simLodRect[s++],6408,5121,new Uint8Array(this._mipmaps[o]))}this.minFifter=9729,this.magFifter=9729}else{var l=this._width,h=this._height;for(s=0,t.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),o=0;o<this._mipmaps.length;o++){if(this._mipmaps[o].byteLength!=l*h*4)throw"mipmap size error  level:"+o;t.texImage2D(this._type,o,6408,l,h,0,6408,5121,new Uint8Array(this._mipmaps[o])),(l/=2)<1&&(l=1),(h/=2)<1&&(h=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else t.texImage2D(this._type,0,6408,i,n,0,6408,5121,new Uint8Array(this._buffer));var u=this._minFifter,c=this._magFifter,_=this._repeat?10497:33071,d=p.isPOT(i,n);if(!d)throw"data texture must be POT";this._mipmap||this._mipmaps?-1!==u||(u=9987):-1!==u||(u=9729),-1!==c||(c=9729),t.texParameteri(this._type,10241,u),t.texParameteri(this._type,10240,c),t.texParameteri(this._type,10242,_),this._mipmaps?t.texParameteri(this._type,10243,33071):t.texParameteri(this._type,10243,_),this._mipmap&&t.generateMipmap(this._type),r&&a&&L.bindTexture(t,r,a),this.src&&0<this.src.length&&(this._buffer=null),this.memorySize=d?i*n*4*(1+1/3):i*n*4,this._recreateLock=!1},e.recreateResource=function(){if(this._buffer||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0}},e.onAsynLoaded=function(t,e,i){var n;i&&(n=i[0].call(this,e)),n&&(this._width=n.width,this._height=n.height,this._buffer=n.data),this._src=t,this._size=new Ke(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},e.getPixels=function(){return new Uint8Array(this._buffer)},e.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(R.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this.memorySize=0)},_(0,e,"src",function(){return this._src}),f.create=function(t,e,i,n,r,a){if(void 0===n&&(n=9729),void 0===r&&(r=9729),void 0===a&&(a=!0),!t||t.byteLength<e*i*4)throw"DataTexture2D create error";var s=new f;return s._buffer=t,s._width=e,s._height=i,s._mipmap=a,s._magFifter=n,s._minFifter=r,s._size=new Ke(s._width,s._height),s._conchTexture?alert("怎么给runtime传递datatexture数据"):s.activeResource(),s},f.load=function(t,e,i,n,r){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=9729),void 0===r&&(r=9729),"mipmaps"===b.getFileExtension(t)){var a=S.loader.create(t,null,null,f,[function(t){this._mipmaps=[];var e=new Uint32Array(t);this._width=e[0];var i=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,i=1024),this._width!=i)throw console.error("现在只支持512x256的环境贴图。当前的是"+e[0]),"现在只支持512x256的环境贴图。当前的是"+e[0];this._height=e[1];for(var n=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,r=this._height,a=8;;){var s=n*r*4;if(a+s>t.byteLength)throw"load mipmaps data size error ";var o=new Uint8Array(t,a,s);if(this._mipmaps.push(o),a+=s,1==n&&1==r)break;(n/=2)<1&&(n=1),(r/=2)<1&&(r=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){a.simLodInfo=new Float32Array(40);for(var s=0;s<a.simLodInfo.length;)a.simLodInfo[s]=(f.simLodRect[s]+.5)/1024,s++,a.simLodInfo[s]=(f.simLodRect[s]+.5)/256,s++,a.simLodInfo[s]=Math.max(f.simLodRect[s]-1,.1)/1024,s++,a.simLodInfo[s]=Math.max(f.simLodRect[s]-1.5,.1)/256,s++}return a}if("number"==typeof e)return S.loader.create(t,null,null,f,[function(t){return this._width=e,this._height=i,this._buffer=t,null}]);if("function"==typeof e)return S.loader.create(t,null,null,f,[e]);throw new Error("unknown params.")},f.lodasatlas=!1,c(f,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),f}(),nn=function(t){function e(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,e.__super.call(this)}m(e,"laya.d3.resource.models.PrimitiveMesh",vi);var i=e.prototype;return S.imps(i,{"laya.d3.core.render.IRenderable":!0}),i._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},i._getVertexBuffers=function(){return null},i._getIndexBuffer=function(){return this._indexBuffer},i._getPositions=function(){var t,e=[],i=this._vertexBuffer.vertexDeclaration.getVertexElements(),n=0;for(n=0;n<i.length;n++){var r=i[n];if("vector3"===r.elementFormat&&0===r.elementUsage){t=r;break}}var a=this._vertexBuffer.getData();for(n=0;n<a.length;n+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var s=n+t.offset/4,o=new Oe(a[s+0],a[s+1],a[s+2]);e.push(o)}return e},i.getRenderElement=function(t){return this},i.getRenderElementsCount=function(){return 1},i.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer.destroy(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer.destroy(),this._indexBuffer=null),this.memorySize=0},i._beforeRender=function(t){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},i._render=function(t){R.mainContext.drawElements(4,this._numberIndices,5123,0),M.drawCall++,M.trianglesFaces+=this._numberIndices/3},i._renderRuntime=function(t,e,i){t.drawSubmesh(e._conchSubmesh,0,4,0,this._numberIndices)},_(0,i,"_vertexBufferCount",function(){return 1}),_(0,i,"triangleCount",function(){return this._indexBuffer.indexCount/3}),e}(),rn=function(t){function e(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,e.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}m(e,"laya.d3.resource.models.Mesh",vi);var i=e.prototype;return i._getPositions=function(){var t,e,i,n,r,a=[],s=0,o=0,l=0;if(0!==this._vertexBuffers.length){var h=this._vertexBuffers.length;for(s=0;s<h;s++){for(i=(t=this._vertexBuffers[s]).vertexDeclaration.getVertexElements(),o=0;o<i.length;o++)if("vector3"===(n=i[o]).elementFormat&&0===n.elementUsage){e=n;break}for(r=t.getData(),o=0;o<r.length;o+=t.vertexDeclaration.vertexStride/4)l=o+e.offset/4,a.push(new Oe(r[l+0],r[l+1],r[l+2]))}}else{var u=this._subMeshes.length;for(s=0;s<u;s++){for(i=(t=this._subMeshes[s]._getVertexBuffer()).vertexDeclaration.getVertexElements(),o=0;o<i.length;o++)if("vector3"===(n=i[o]).elementFormat&&0===n.elementUsage){e=n;break}for(r=t.getData(),o=0;o<r.length;o+=t.vertexDeclaration.vertexStride/4)l=o+e.offset/4,a.push(new Oe(r[l+0],r[l+1],r[l+2]))}}return a},i._setSubMeshes=function(t){this._subMeshes=t,this._subMeshCount=t.length;for(var e=0;e<this._subMeshCount;e++)t[e]._indexInMesh=e;this._positions=this._getPositions(),this._generateBoundingObject()},i.onAsynLoaded=function(t,e,i){var n=e[0],r=e[1];ye.read(n,this,this._materials,this._subMeshes,r),this.completeCreate(),this._endLoaded()},i.getSubMesh=function(t){return this._subMeshes[t]},i.getSubMeshCount=function(){return this._subMeshes.length},i.getRenderElementsCount=function(){return this._subMeshes.length},i.getRenderElement=function(t){return this._subMeshes[t]},i.disposeResource=function(){for(var t=0;t<this._subMeshes.length;t++)this._subMeshes[t].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},_(0,i,"materials",function(){return this._materials.slice()}),_(0,i,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),e.load=function(t){return S.loader.create(t,null,null,e)},e}(),an=function(t){function h(t,e,i,n,r,a,s,o,l){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===i&&(i=6408),void 0===n&&(n=5121),void 0===r&&(r=33189),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===o&&(o=-1),void 0===l&&(l=-1),h.__super.call(this),this._type=3553,this._width=t,this._height=e,this._size=new Ke(t,e),this._surfaceFormat=i,this._surfaceType=n,this._depthStencilFormat=r,this._mipmap=a,this._repeat=s,this._minFifter=o,this._magFifter=l,this.activeResource(),this._alreadyResolved=!0}m(h,"laya.d3.resource.RenderTexture",gi);var e=h.prototype;return e.recreateResource=function(){var t=R.mainContext;this._frameBuffer=t.createFramebuffer(),this._source=t.createTexture();var e=L.curBindTexTarget,i=L.curBindTexValue;L.bindTexture(t,this._type,this._source),t.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var n=this._minFifter,r=this._magFifter,a=this._repeat?10497:33071;if(p.isPOT(this._width,this._height)?(this._mipmap?-1!==n||(n=9987):-1!==n||(n=9729),-1!==r||(r=9729),t.texParameteri(this._type,10241,n),t.texParameteri(this._type,10240,r),t.texParameteri(this._type,10242,a),t.texParameteri(this._type,10243,a),this._mipmap&&t.generateMipmap(this._type)):(-1!==n||(n=9729),-1!==r||(r=9729),t.texParameteri(this._type,10241,n),t.texParameteri(this._type,10240,r),t.texParameteri(this._type,10242,33071),t.texParameteri(this._type,10243,33071)),t.bindFramebuffer(36160,this._frameBuffer),t.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,this._depthStencilBuffer),t.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),this._depthStencilFormat){case 33189:t.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:t.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:t.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}t.bindFramebuffer(36160,null),e&&i&&L.bindTexture(t,e,i),t.bindRenderbuffer(36161,null),this.memorySize=this._width*this._height*4,this.completeCreate()},e.start=function(){R.mainContext.bindFramebuffer(36160,this.frameBuffer),(h._currentRenderTarget=this)._alreadyResolved=!1},e.end=function(){R.mainContext.bindFramebuffer(36160,null),h._currentRenderTarget=null,this._alreadyResolved=!0},e.getData=function(t,e,i,n){var r=R.mainContext;if(r.bindFramebuffer(36160,this._frameBuffer),!(36053===r.checkFramebufferStatus(36160)))return r.bindFramebuffer(36160,null),null;var a=new Uint8Array(this._width*this._height*4);return r.readPixels(t,e,i,n,this._surfaceFormat,this._surfaceType,a),r.bindFramebuffer(36160,null),a},e.disposeResource=function(){if(this._frameBuffer){var t=R.mainContext;t.deleteTexture(this._source),t.deleteFramebuffer(this._frameBuffer),t.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},_(0,e,"surfaceFormat",function(){return this._surfaceFormat}),_(0,e,"surfaceType",function(){return this._surfaceType}),_(0,e,"depthStencilFormat",function(){return this._depthStencilFormat}),_(0,e,"source",function(){return this._alreadyResolved?S.superGet(gi,this,"source"):null}),_(0,e,"depthStencilBuffer",function(){return this._depthStencilBuffer}),_(0,e,"frameBuffer",function(){return this._frameBuffer}),h._currentRenderTarget=null,h}(),sn=function(t){function e(t){this._color=null,this._pixels=null,e.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new Ke(this.width,this.height),this._color=t,this._pixels=new Uint8Array([255*t.x,255*t.y,255*t.z,255*t.w])}m(e,"laya.d3.resource.SolidColorTexture2D",gi);var i=e.prototype;return i._createWebGlTexture=function(){var t=R.mainContext,e=this._source=t.createTexture(),i=this._width,n=this._height,r=L.curBindTexTarget,a=L.curBindTexValue;L.bindTexture(t,this._type,e),t.texImage2D(this._type,0,6408,i,n,0,6408,5121,this._pixels);var s=this._minFifter,o=this._magFifter,l=this._repeat?10497:33071,h=p.isPOT(i,n);h?(this._mipmap?-1!==s||(s=9987):-1!==s||(s=9729),-1!==o||(o=9729),t.texParameteri(this._type,10241,s),t.texParameteri(this._type,10240,o),t.texParameteri(this._type,10242,l),t.texParameteri(this._type,10243,l),this._mipmap&&t.generateMipmap(this._type)):(-1!==s||(s=9729),-1!==o||(o=9729),t.texParameteri(this._type,10241,s),t.texParameteri(this._type,10240,o),t.texParameteri(this._type,10242,33071),t.texParameteri(this._type,10243,33071)),r&&a&&L.bindTexture(t,r,a),this.memorySize=h?i*n*4*(1+1/3):i*n*4},i.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},i.disposeResource=function(){this._source&&(R.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},c(e,["magentaTexture",function(){return this.magentaTexture=new e(new Pe(1,0,1,1))},"grayTexture",function(){return this.grayTexture=new e(new Pe(.5,.5,.5,1))}]),e}(),on=function(t){function e(t){this._color=null,this._pixels=null,this._texCount=6,e.__super.call(this),this._type=34067,this._width=1,this._height=1,this._size=new Ke(this.width,this.height),this._color=t,this._pixels=new Uint8Array([255*t.x,255*t.y,255*t.z,255*t.w])}m(e,"laya.d3.resource.SolidColorTextureCube",gi);var i=e.prototype;return i._createWebGlTexture=function(){var t=R.mainContext,e=this._source=t.createTexture(),i=this._width,n=this._height,r=L.curBindTexTarget,a=L.curBindTexValue;L.bindTexture(t,this._type,e),t.texImage2D(34069,0,6408,i,n,0,6408,5121,this._pixels),t.texImage2D(34070,0,6408,i,n,0,6408,5121,this._pixels),t.texImage2D(34071,0,6408,i,n,0,6408,5121,this._pixels),t.texImage2D(34072,0,6408,i,n,0,6408,5121,this._pixels),t.texImage2D(34073,0,6408,i,n,0,6408,5121,this._pixels),t.texImage2D(34074,0,6408,i,n,0,6408,5121,this._pixels);var s=this.minFifter,o=this.magFifter,l=this._repeat?10497:33071,h=p.isPOT(i,n);h?(this.mipmap?-1!==s||(s=9987):-1!==s||(s=9729),-1!==o||(o=9729),t.texParameteri(this._type,10241,s),t.texParameteri(this._type,10240,o),t.texParameteri(this._type,10242,l),t.texParameteri(this._type,10243,l),this.mipmap&&t.generateMipmap(this._type)):(-1!==s||(s=9729),-1!==o||(o=9729),t.texParameteri(this._type,10241,s),t.texParameteri(this._type,10240,o),t.texParameteri(this._type,10242,33071),t.texParameteri(this._type,10243,33071)),r&&a&&L.bindTexture(t,r,a),this.memorySize=h?i*n*4*(1+1/3)*this._texCount:i*n*4*this._texCount},i.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},i.disposeResource=function(){this._source&&(R.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},c(e,["magentaTexture",function(){return this.magentaTexture=new e(new Pe(1,0,1,1))},"grayTexture",function(){return this.grayTexture=new e(new Pe(.5,.5,.5,1))}]),e}(),ln=function(t){function r(t,e,i,n){this._canRead=!1,this._image=null,this._pixels=null,void 0===t&&(t=!1),void 0===e&&(e=!0),void 0===i&&(i=6408),void 0===n&&(n=!0),r.__super.call(this),this._type=3553,this._repeat=e,this._canRead=t,this._format=i,this._mipmap=n}m(r,"laya.d3.resource.Texture2D",gi);var e=r.prototype;return e._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var t=R.mainContext,e=this._source=t.createTexture(),i=this._width,n=this._height,r=L.curBindTexTarget,a=L.curBindTexValue;switch(L.bindTexture(t,this._type,e),this._format){case 6407:case 6408:this._canRead?t.texImage2D(this._type,0,this._format,i,n,0,this._format,5121,this._pixels):t.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case R.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:t.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image)}var s=this._minFifter,o=this._magFifter,l=this._repeat?10497:33071,h=p.isPOT(i,n);h?(this._mipmap?-1!==s||(s=9987):-1!==s||(s=9729),-1!==o||(o=9729),t.texParameteri(this._type,10241,s),t.texParameteri(this._type,10240,o),t.texParameteri(this._type,10242,l),t.texParameteri(this._type,10243,l),this._mipmap&&t.generateMipmap(this._type)):(-1!==s||(s=9729),-1!==o||(o=9729),t.texParameteri(this._type,10241,s),t.texParameteri(this._type,10240,o),t.texParameteri(this._type,10242,33071),t.texParameteri(this._type,10243,33071)),r&&a&&L.bindTexture(t,r,a),this._image.onload=null,this._image=null,this.memorySize=h?i*n*4*(1+1/3):i*n*4},e.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},e.onAsynLoaded=function(t,e,i){if(i){var n=i[0];void 0!==n&&(this._canRead=n);var r=i[1];void 0!==r&&(this._repeat=r);var a=i[2];void 0!==a&&(this._format=a);var s=i[3];void 0!==s&&(this._mipmap=s)}switch(this._format){case 6407:case 6408:var o=(this._image=e).width,l=e.height;this._width=o,this._height=l,this._size=new Ke(o,l),this._canRead&&(C.canvas.size(o,l),C.canvas.clear(),C.context.drawImage(e,0,0,o,l),this._pixels=new Uint8Array(C.context.getImageData(0,0,o,l).data.buffer));break;case R.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var h=new x(e);h.readUTFBytes(4),h.readUTFBytes(2),h.getInt16();h.endian="bigEndian",this._width=h.getInt16(),this._height=h.getInt16(),this._size=new Ke(this._width,this._height);h.getInt16(),h.getInt16();this._image=new Uint8Array(e,h.pos)}this.recreateResource(),this._endLoaded()},e.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},e.disposeResource=function(){this._source&&(R.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},_(0,e,"_src",function(){return this.url}),_(0,e,"src",function(){return this.url}),r.load=function(t){return S.loader.create(t,null,null,r)},r}(),hn=function(t){function e(){e.__super.call(this),this._type=34067}m(e,"laya.d3.resource.TextureCube",gi);var i=e.prototype;return i._onTextureLoaded=function(t){this._images=t;for(var e=2147483647,i=2147483647,n=0;n<6;n++){var r=t[n];e=Math.min(e,r.width),i=Math.min(i,r.height)}this._width=e,this._height=i,this._size=new Ke(e,i)},i._createWebGlTexture=function(){var t=0;for(t=0;t<6;t++)if(!this._images[t])throw"create GLTextur err:no data:"+this._images[t];var e=R.mainContext,i=this._source=e.createTexture(),n=this._width,r=this._height,a=L.curBindTexTarget,s=L.curBindTexValue;L.bindTexture(e,this._type,i),e.texImage2D(34069,0,6408,6408,5121,this._images[0]),e.texImage2D(34070,0,6408,6408,5121,this._images[1]),e.texImage2D(34071,0,6408,6408,5121,this._images[2]),e.texImage2D(34072,0,6408,6408,5121,this._images[3]),e.texImage2D(34073,0,6408,6408,5121,this._images[4]),e.texImage2D(34074,0,6408,6408,5121,this._images[5]);var o=this.minFifter,l=this.magFifter,h=this._repeat?10497:33071,u=p.isPOT(n,r);for(u?(this.mipmap?-1!==o||(o=9987):-1!==o||(o=9729),-1!==l||(l=9729),e.texParameteri(this._type,10241,o),e.texParameteri(this._type,10240,l),e.texParameteri(this._type,10242,h),e.texParameteri(this._type,10243,h),this.mipmap&&e.generateMipmap(this._type)):(-1!==o||(o=9729),-1!==l||(l=9729),e.texParameteri(this._type,10241,o),e.texParameteri(this._type,10240,l),e.texParameteri(this._type,10242,33071),e.texParameteri(this._type,10243,33071)),a&&s&&L.bindTexture(e,a,s),t=0;t<6;t++)this._images[t].onload=null,this._images[t]=null;this.memorySize=u?n*r*4*(1+1/3)*6:n*r*4*6},i.recreateResource=function(){null!=this._url&&(this._createWebGlTexture(),this.completeCreate())},i.onAsynLoaded=function(t,e,i){this._onTextureLoaded(e),this.activeResource(),this._endLoaded()},i.disposeResource=function(){this._source&&(R.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},_(0,i,"defaulteTexture",function(){return on.grayTexture}),e.load=function(t){return S.loader.create(t,null,null,e)},e}(),un=function(t){function g(t){this._hasIndependentBound=!0,g.__super.call(this,t),this._owner.transform.off("worldmatrixneedchanged",this,this._onWorldMatNeedChange),this._cacheAnimationNodeIndex=[],this._cacheAnimationNode=[],this._localBoundingBoxCorners=w(8,null),this._owner.meshFilter.on("meshchanged",this,this._$3__onMeshChanged)}m(g,"laya.d3.core.SkinnedMeshRender",t);var e=g.prototype;return e._getCacheAnimationNodes=function(){var t=this._cacheMesh._boneNames,e=t.length;this._cacheAnimationNode.length=e,this._cacheAnimationNodeIndex.length=e;for(var i=this._cacheAnimator._avatarNodes,n=this._cacheAnimator._avatarNodeMap,r=0;r<e;r++){var a=n[t[r]];this._cacheAnimationNode[r]=a,this._cacheAnimationNodeIndex[r]=i.indexOf(a)}},e._offComputeBoneIndexToMeshEvent=function(t,e){t.loaded?e.loaded||e.off("loaded",this,this._getCacheAnimationNodes):t.off("loaded",this,this._computeBoneIndexToMeshWithAsyncMesh)},e._computeBoneIndexToMeshWithAsyncAvatar=function(){this._cacheAvatar.loaded?this._computeBoneIndexToMeshWithAsyncMesh():this._cacheAvatar.once("loaded",this,this._computeBoneIndexToMeshWithAsyncMesh)},e._computeBoneIndexToMeshWithAsyncMesh=function(){this._cacheMesh.loaded?this._getCacheAnimationNodes():this._cacheMesh.on("loaded",this,this._getCacheAnimationNodes)},e._$3__onMeshChanged=function(t,e,i){this._cacheMesh=i,e&&!e.loaded&&i.off("loaded",this,this._onMeshLoaded),i.loaded?this._onMeshLoaded(i):i.on("loaded",this,this._onMeshLoaded),this._cacheAvatar&&(e&&this._offComputeBoneIndexToMeshEvent(this._cacheAvatar,e),i&&this._computeBoneIndexToMeshWithAsyncAvatar())},e._onMeshLoaded=function(t){var e=t.subMeshCount;this._subSkinnedDatas=[],this._subSkinnedDatas.length=e;for(var i=0;i<e;i++)for(var n=this._subSkinnedDatas[i]=[],r=t.getSubMesh(i)._boneIndicesList,a=0,s=r.length;a<s;a++)n[a]=new Float32Array(16*r[a].length)},e._setCacheAnimator=function(t){this._cacheAnimator=t,this._rootBone&&(this._rootIndex=t._avatarNodes.indexOf(t._avatarNodeMap[this._rootBone]))},e._setRootBone=function(t){this._rootBone=t,this._cacheAnimator&&(this._rootIndex=this._cacheAnimator._avatarNodes.indexOf(this._cacheAnimator._avatarNodeMap[t]))},e._setCacheAvatar=function(t){this._cacheAvatar!==t&&(this._cacheMesh?(this._cacheAvatar&&this._offComputeBoneIndexToMeshEvent(this._cacheAvatar,this._cacheMesh),(this._cacheAvatar=t)&&(this._addShaderDefine(yn.SHADERDEFINE_BONE),this._computeBoneIndexToMeshWithAsyncAvatar())):this._cacheAvatar=t)},e._calculateBoundingBox=function(){this._hasIndependentBound?this._cacheAnimator&&(null==this._cacheAnimator._avatarNodeMap[this._rootBone]||null==this._localBoundBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(this._localBoundingBoxCorners)):t.prototype._calculateBoundingBox.call(this)},e._calculateBoundingSphere=function(){this._hasIndependentBound?this._cacheAnimator&&(null==this._cacheAnimator._avatarNodeMap[this._rootBone]||null==this.localBoundSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(this.localBoundSphere)):t.prototype._calculateBoundingSphere.call(this)},e._updateOctreeNode=function(){var t=this._treeNode;t&&t.updateObject(this)},e._renderUpdate=function(t){var e,i=this._cacheAnimator,n=this._cacheMesh.subMeshCount,r=this._owner.transform;if(i){var a=i._canCache,s=this._cacheAnimator._curAvatarNodeDatas;if(this._hasIndependentBound){var o=r.worldMatrix;a?qe.matrix4x4MultiplyMFM(this._cacheAnimator.owner.transform.worldMatrix,s[this._rootIndex],o):qe.matrix4x4MultiplyMFM(this._cacheAnimator.owner.transform.worldMatrix,i._avatarNodeMap[this._rootBone].transform.getWorldMatrix(),o),r.worldMatrix=o}var l=i.owner;if(this._setShaderValueMatrix4x4(0,l._transform.worldMatrix),e=l.getProjectionViewWorldMatrix(t),this._setShaderValueMatrix4x4(1,e),this._cacheMesh&&this._cacheMesh.loaded&&this._cacheAvatar&&this._cacheAvatar.loaded){var h=0,u=0,c=this._cacheMesh._inverseBindPoses,_=this._cacheMesh._skinnedDatas;if(a)for(h=0,u=c.length;h<u;h++)qe._mulMatrixArray(s[this._cacheAnimationNodeIndex[h]],c[h],_,16*h);else for(h=0,u=c.length;h<u;h++)qe._mulMatrixArray(this._cacheAnimationNode[h].transform.getWorldMatrix(),c[h],_,16*h);for(h=0;h<n;h++){for(var d=this._cacheMesh.getSubMesh(h)._boneIndicesList,f=d.length,p=this._subSkinnedDatas[h],m=0;m<f;m++)g._splitAnimationDatas(d[m],_,p[m]);this._renderElements[h]._skinAnimationDatas=p}}}else this._setShaderValueMatrix4x4(0,r.worldMatrix),e=this._owner.getProjectionViewWorldMatrix(t),this._setShaderValueMatrix4x4(1,e);return Qe.debugMode&&this._renderRenderableBoundBox(),!0},_(0,e,"localBoundBox",function(){return this._localBoundBox},function(t){(this._localBoundBox=t).getCorners(this._localBoundingBoxCorners)}),_(0,e,"boundingSphere",function(){return this._calculateBoundingSphere(),this._boundingSphere}),_(0,e,"boundingBox",function(){return this._calculateBoundingBox(),this._boundingBox}),_(0,e,"boundingBoxCenter",function(){var t=this.boundingBox;return Oe.add(t.min,t.max,this._boundingBoxCenter),Oe.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenter}),g._splitAnimationDatas=function(t,e,i){for(var n=0,r=t.length,a=0;n<r;n++)for(var s=t[n]<<4,o=0;o<16;o++,a++)i[a]=e[s+o]},g}(Ii),cn=function(e){function i(t,e){i.__super.call(this),void 0===t&&(t=.3),void 0===e&&(e=1e3),this._tempVector3=new Oe,this._position=new Oe,this._up=new Oe,this._forward=new Oe,this._right=new Oe,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=Ke.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=t,this._farPlane=e,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),S.stage.on("resize",this,this._onScreenSizeChanged)}m(i,"laya.d3.core.BaseCamera",e);var t=i.prototype;return t.createConchModel=function(){return new ConchCamera},t._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var t=this.scene._cameraPool,e=t.length-1,i=0;i<e;i++)if(t[i].renderingOrder>t[e].renderingOrder){var n=t[i];t[i]=t[e],t[e]=n}},t._calculateProjectionMatrix=function(){},t._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},t._prepareCameraToRender=function(){F._currentCameraCullingMask=this.cullingMask;var t=this._shaderValues;t.setValue(0,this.transform.position.elements),t.setValue(5,this.forward.elements),t.setValue(6,this.up.elements)},t._prepareCameraViewProject=function(t,e){var i=this._shaderValues;i.setValue(1,t.elements),i.setValue(2,e.elements)},t._renderCamera=function(t,e,i){},t.addLayer=function(t){29!==t.number&&30!=t.number&&(this.cullingMask=this.cullingMask|t.mask)},t.removeLayer=function(t){29!==t.number&&30!=t.number&&(this.cullingMask=this.cullingMask&~t.mask)},t.addAllLayers=function(){this.cullingMask=2147483647},t.removeAllLayers=function(){this.cullingMask=0|F.getLayerByNumber(29).mask|F.getLayerByNumber(30).mask},t.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},t.moveForward=function(t){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=t,this.transform.translate(this._tempVector3)},t.moveRight=function(t){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=t,this.transform.translate(this._tempVector3)},t.moveVertical=function(t){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=t,this.transform.translate(this._tempVector3,!1)},t._addSelfRenderObjects=function(){var t=this.scene._cameraPool,e=t.length;if(0<e){for(var i=e-1;0<=i;i--)if(this.renderingOrder<=t[i].renderingOrder){t.splice(i+1,0,this);break}}else t.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},t._clearSelfRenderObjects=function(){var t=this.scene._cameraPool;t.splice(t.indexOf(this),1)},t.destroy=function(t){void 0===t&&(t=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,S.stage.off("resize",this,this._onScreenSizeChanged),e.prototype.destroy.call(this,t)},_(0,t,"sky",function(){return this._sky},function(t){((this._sky=t)._ownerCamera=this).conchModel&&this.conchModel.setSkyMesh(this._sky._conchSky)}),_(0,t,"forward",function(){var t=this.transform.worldMatrix.elements,e=this._forward.elements;return e[0]=-t[8],e[1]=-t[9],e[2]=-t[10],this._forward}),_(0,t,"position",function(){var t=this.transform.worldMatrix.elements,e=this._position.elements;return e[0]=t[12],e[1]=t[13],e[2]=t[14],this._position}),_(0,t,"renderTarget",function(){return this._renderTarget},function(t){null!=(this._renderTarget=t)&&(this._renderTargetSize=t.size)}),_(0,t,"up",function(){var t=this.transform.worldMatrix.elements,e=this._up.elements;return e[0]=t[4],e[1]=t[5],e[2]=t[6],this._up}),_(0,t,"right",function(){var t=this.transform.worldMatrix.elements,e=this._right.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],this._right}),_(0,t,"renderTargetSize",function(){return this._renderTargetSize},function(t){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=t,this._calculateProjectionMatrix()}),_(0,t,"fieldOfView",function(){return this._fieldOfView},function(t){this._fieldOfView=t,this._calculateProjectionMatrix()}),_(0,t,"nearPlane",function(){return this._nearPlane},function(t){this._nearPlane=t,this._calculateProjectionMatrix()}),_(0,t,"farPlane",function(){return this._farPlane},function(t){this._farPlane=t,this._calculateProjectionMatrix()}),_(0,t,"orthographic",function(){return this._orthographic},function(t){this._orthographic=t,this._calculateProjectionMatrix()}),_(0,t,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function(t){this._orthographicVerticalSize=t,this._calculateProjectionMatrix()}),_(0,t,"renderingOrder",function(){return this._renderingOrder},function(t){this._renderingOrder=t,this._sortCamerasByRenderingOrder()}),i.CAMERAPOS=0,i.VIEWMATRIX=1,i.PROJECTMATRIX=2,i.VPMATRIX=3,i.VPMATRIX_NO_TRANSLATE=4,i.CAMERADIRECTION=5,i.CAMERAUP=6,i.ENVIRONMENTDIFFUSE=7,i.ENVIRONMENTSPECULAR=8,i.SIMLODINFO=9,i.DIFFUSEIRRADMATR=10,i.DIFFUSEIRRADMATG=11,i.DIFFUSEIRRADMATB=12,i.HDREXPOSURE=13,i.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",i.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",i.CLEARFLAG_SOLIDCOLOR=0,i.CLEARFLAG_SKY=1,i.CLEARFLAG_DEPTHONLY=2,i.CLEARFLAG_NONE=3,c(i,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new De(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new De},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new De}]),i}(Vi),_n=function(i){function e(t){this._render=null,this._geometryFilter=null,e.__super.call(this,t)}m(e,"laya.d3.core.RenderableSprite3D",i);var t=e.prototype;return t._addToInitStaticBatchManager=function(){},t._setBelongScene=function(t){i.prototype._setBelongScene.call(this,t),t._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},t._setUnBelongScene=function(){var t=this._scene._renderableSprite3Ds,e=t.indexOf(this);t.splice(e,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),i.prototype._setUnBelongScene.call(this)},t._update=function(t){(t.owner=this)._activeInHierarchy&&(this._updateComponents(t),this._render._updateOctreeNode(),this._lateUpdateComponents(t),M.spriteCount++,this._childs.length&&this._updateChilds(t))},t.destroy=function(t){void 0===t&&(t=!0),i.prototype.destroy.call(this,t),this._render._destroy(),this._render=null},t._updateConch=function(t){(t.owner=this)._activeInHierarchy&&(this._updateComponents(t),this._render._updateOctreeNode(),this._lateUpdateComponents(t),M.spriteCount++,this._childs.length&&this._updateChildsConch(t))},e.__init__=function(){e.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=e.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),e.SAHDERDEFINE_LIGHTMAP=e.shaderDefines.registerDefine("LIGHTMAP")},e.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,e.SAHDERDEFINE_LIGHTMAP=4,e.LIGHTMAPSCALEOFFSET=2,e.LIGHTMAP=3,c(e,["shaderDefines",function(){return this.shaderDefines=new Be}]),e}(Vi),dn=function(t){function e(){this._intensityColor=null,this._intensity=NaN,this._shadow=!1,this._shadowFarPlane=0,this._shadowMapSize=0,this._shadowMapCount=0,this._shadowMapPCFType=0,this._parallelSplitShadowMap=null,this._lightmapBakedType=0,this.color=null,e.__super.call(this),this._intensity=1,this._intensityColor=new Oe,this.color=new Oe(1,1,1),this._shadow=!1,this._shadowFarPlane=8,this._shadowMapSize=512,this._shadowMapCount=1,this._shadowMapPCFType=0,this._lightmapBakedType=e.LIGHTMAPBAKEDTYPE_REALTIME}m(e,"laya.d3.core.light.LightSprite",Vi);var i=e.prototype;return i._parseCustomProps=function(t,e,i,n){var r=i.color,a=this.color.elements;a[0]=r[0],a[1]=r[1],a[2]=r[2]},i._addSelfRenderObjects=function(){this.lightmapBakedType!==e.LIGHTMAPBAKEDTYPE_BAKED&&this._scene._addLight(this)},i._clearSelfRenderObjects=function(){this.lightmapBakedType!==e.LIGHTMAPBAKEDTYPE_BAKED&&this._scene._removeLight(this)},i._prepareToScene=function(t){return!1},_(0,i,"lightmapBakedType",function(){return this._lightmapBakedType},function(t){this._lightmapBakedType!==t&&(this._lightmapBakedType=t,this._activeInHierarchy&&(t!==e.LIGHTMAPBAKEDTYPE_BAKED?this._scene._addLight(this):this._scene._removeLight(this)))}),_(0,i,"shadowPCFType",function(){return this._shadowMapPCFType},function(t){this._shadowMapPCFType=t,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setPCFType(t)}),_(0,i,"intensity",function(){return this._intensity},function(t){this._intensity=t}),_(0,i,"shadow",function(){return this._shadow},function(t){throw new Error("LightSprite: must override it.")}),_(0,i,"shadowDistance",function(){return this._shadowFarPlane},function(t){this._shadowFarPlane=t,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setFarDistance(t)}),_(0,i,"shadowPSSMCount",function(){return this._shadowMapCount},function(t){this._shadowMapCount=t,this._parallelSplitShadowMap&&(this._parallelSplitShadowMap.PSSMNum=t)}),_(0,i,"shadowResolution",function(){return this._shadowMapSize},function(t){this._shadowMapSize=t,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setShadowMapTextureSize(t)}),_(0,i,"diffuseColor",function(){return console.log("LightSprite: discard property,please use color property instead."),this.color},function(t){console.log("LightSprite: discard property,please use color property instead."),this.color=t}),e.LIGHTMAPBAKEDTYPE_REALTIME=0,e.LIGHTMAPBAKEDTYPE_MIXED=1,e.LIGHTMAPBAKEDTYPE_BAKED=2,e}(),fn=function(t){function h(t){this._terrainRes=null,this._lightmapScaleOffset=null,h.__super.call(this),this._lightmapScaleOffset=new Pe(1,1,0,0),t&&((this._terrainRes=t).loaded?this.buildTerrain(t):t.once("loaded",this,this.buildTerrain))}m(h,"laya.d3.terrain.Terrain",Vi);var e=h.prototype;return e._parseCustomProps=function(t,e,i,n){this.terrainRes=Dt.getRes(e[i.dataPath]);var r=i.lightmapIndex;null!=r&&this.setLightmapIndex(r);var a=i.lightmapScaleOffset;a&&this.setLightmapScaleOffset(new Pe(a[0],a[1],a[2],a[3]))},e.setLightmapIndex=function(t){for(var e=0;e<this._childs.length;e++){this._childs[e].terrainRender.lightmapIndex=t}},e.setLightmapScaleOffset=function(t){if(t){t.cloneTo(this._lightmapScaleOffset);for(var e=0;e<this._childs.length;e++){this._childs[e].terrainRender.lightmapScaleOffset=this._lightmapScaleOffset}}},e.disableLight=function(){for(var t=0,e=this._childs.length;t<e;t++)for(var i=this._childs[t],n=0,r=i._render.sharedMaterials.length;n<r;n++){i._render.sharedMaterials[n].disableLight()}},e.buildTerrain=function(t){for(var e=t._chunkNumX,i=t._chunkNumZ,n=t._heightData,r=0,a=0;a<i;a++)for(var s=0;s<e;s++){for(var o=new En(s,a,t._gridSize,n._terrainHeightData,n._width,n._height,t._cameraCoordinateInverse),l=t._chunkInfos[r++],h=0;h<l.alphaMap.length;h++){var u=l.detailID[h].length,c=0<u?t._detailTextureInfos[l.detailID[h][0]].diffuseTexture:null,_=1<u?t._detailTextureInfos[l.detailID[h][1]].diffuseTexture:null,d=2<u?t._detailTextureInfos[l.detailID[h][2]].diffuseTexture:null,f=3<u?t._detailTextureInfos[l.detailID[h][3]].diffuseTexture:null,p=0<u?t._detailTextureInfos[l.detailID[h][0]].scale:null,m=1<u?t._detailTextureInfos[l.detailID[h][1]].scale:null,g=2<u?t._detailTextureInfos[l.detailID[h][2]].scale:null,v=3<u?t._detailTextureInfos[l.detailID[h][3]].scale:null;o.buildRenderElementAndMaterial(u,l.normalMap,l.alphaMap[h],c,_,d,f,t._materialInfo.ambientColor,t._materialInfo.diffuseColor,t._materialInfo.specularColor,p?p.x:1,p?p.y:1,m?m.x:1,m?m.y:1,g?g.x:1,g?g.y:1,v?v.x:1,v?v.y:1)}o.terrainRender.receiveShadow=!0,o.terrainRender.lightmapScaleOffset=this._lightmapScaleOffset,this.addChild(o)}},e.width=function(){return this._terrainRes._chunkNumX*ze.CHUNK_GRID_NUM*this._terrainRes._gridSize},e.depth=function(){return this._terrainRes._chunkNumZ*ze.CHUNK_GRID_NUM*this._terrainRes._gridSize},e.getHeightXZ=function(t,e){if(!this._terrainRes||!this._terrainRes.loaded)return NaN;if(t-=this.transform.position.x,e-=this.transform.position.z,h.__VECTOR3__||(h.__VECTOR3__=new Oe),h.__VECTOR3__.elements[0]=t,h.__VECTOR3__.elements[1]=0,h.__VECTOR3__.elements[2]=e,Oe.transformV3ToV3(h.__VECTOR3__,ze.__ADAPT_MATRIX_INV__,h.__VECTOR3__),t=h.__VECTOR3__.elements[0],e=h.__VECTOR3__.elements[2],t<0||t>this.width()||e<0||e>this.depth())return NaN;var i=this._terrainRes._gridSize,n=parseInt(""+t/i),r=parseInt(""+e/i),a=t-n*i,s=e-r*i,o=NaN,l=this._terrainRes._heightData;return i<a+s?(o=l._terrainHeightData[(r+1-1)*l._width+n+1])+(l._terrainHeightData[(r+1-1)*l._width+n]-o)*((i-a)/i)+(l._terrainHeightData[(r-1)*l._width+n+1]-o)*((i-s)/i):(o=l._terrainHeightData[Math.max(0,r-1)*l._width+n])+(l._terrainHeightData[Math.min(l._width*l._height-1,(r+1-1)*l._width+n)]-o)*(s/i)+(l._terrainHeightData[Math.min(l._width*l._height-1,Math.max(0,r-1)*l._width+n+1)]-o)*(a/i)},_(0,e,"terrainRes",null,function(t){t&&((this._terrainRes=t).loaded?this.buildTerrain(t):t.once("loaded",this,this.buildTerrain))}),h.load=function(t){return S.loader.create(t,null,null,h,null,1,!1)},h.RENDER_LINE_MODEL=!1,h.LOD_TOLERANCE_VALUE=4,h.LOD_DISTANCE_FACTOR=2,h.__VECTOR3__=null,h}(),pn=(function(t){function n(t,e,i){this._long=NaN,this._width=NaN,this._height=NaN,void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),n.__super.call(this),this._long=t,this._width=e,this._height=i,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}m(n,"laya.d3.resource.models.BoxMesh",nn);var e=n.prototype;e.recreateResource=function(){this._numberVertices=24,this._numberIndices=36;var t=Qt.vertexDeclaration,e=(t.vertexStride,this._long/2),i=this._height/2,n=this._width/2,r=new Float32Array([-e,i,-n,0,1,0,0,0,e,i,-n,0,1,0,1,0,e,i,n,0,1,0,1,1,-e,i,n,0,1,0,0,1,-e,-i,-n,0,-1,0,0,1,e,-i,-n,0,-1,0,1,1,e,-i,n,0,-1,0,1,0,-e,-i,n,0,-1,0,0,0,-e,i,-n,-1,0,0,0,0,-e,i,n,-1,0,0,1,0,-e,-i,n,-1,0,0,1,1,-e,-i,-n,-1,0,0,0,1,e,i,-n,1,0,0,1,0,e,i,n,1,0,0,0,0,e,-i,n,1,0,0,0,1,e,-i,-n,1,0,0,1,1,-e,i,n,0,0,1,0,0,e,i,n,0,0,1,1,0,e,-i,n,0,0,1,1,1,-e,-i,n,0,0,1,0,1,-e,i,-n,0,0,-1,1,0,e,i,-n,0,0,-1,0,0,e,-i,-n,0,0,-1,0,1,-e,-i,-n,0,0,-1,1,1]),a=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new Zi(t,this._numberVertices,35044,!0),this._indexBuffer=new ji("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(r),this._indexBuffer.setData(a),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},_(0,e,"long",function(){return this._long},function(t){this._long!==t&&(this._long=t,this.releaseResource(),this.activeResource())}),_(0,e,"width",function(){return this._width},function(t){this._width!==t&&(this._width=t,this.releaseResource(),this.activeResource())}),_(0,e,"height",function(){return this._height},function(t){this._height!==t&&(this._height=t,this.releaseResource(),this.activeResource())})}(),function(t){function r(t,e,i,n){this._radius=NaN,this._height=NaN,this._slices=0,void(this._stacks=0)===t&&(t=.5),void 0===e&&(e=2),void 0===i&&(i=16),void 0===n&&(n=32),r.__super.call(this),this._radius=t,this._height=e<2*t?2*t:e,this._stacks=i,this._slices=n,this.recreateResource(),this._positions=this._getPositions(),this._generateBoundingObject()}m(r,"laya.d3.resource.models.CapsuleMesh",nn);var e=r.prototype;e.recreateResource=function(){this._numberVertices=(this._stacks+1)*(this.slices+1)*2+2*(this._slices+1),this._numberIndices=3*this._stacks*(this._slices+1)*2*2+2*this._slices*3;var t=Qt.vertexDeclaration,e=t.vertexStride/4,i=new Float32Array(this._numberVertices*e),n=new Uint16Array(this._numberIndices),r=Math.PI/2/this._stacks,a=2*Math.PI/this._slices,s=this._height/2-this._radius,o=0,l=0,h=0,u=0,c=0,_=0,d=0,f=0;for(d=0;d<=this._stacks;d++)for(f=0;f<=this._slices;f++)o=this._radius*Math.cos(d*r)*Math.cos(f*a+Math.PI),l=this._radius*Math.sin(d*r),h=this._radius*Math.cos(d*r)*Math.sin(f*a+Math.PI),i[u++]=o,i[u++]=l+s,i[u++]=h,i[u++]=o,i[u++]=l,i[u++]=h,i[u++]=1-f/this._slices,i[u++]=(1-d/this._stacks)*(Math.PI*this._radius/2/(this._height+Math.PI*this._radius)),d<this._stacks&&(n[c++]=d*(this._slices+1)+f+(this._slices+1),n[c++]=d*(this._slices+1)+f,n[c++]=d*(this._slices+1)+f+1,n[c++]=d*(this._slices+1)+f+this._slices,n[c++]=d*(this._slices+1)+f,n[c++]=d*(this._slices+1)+f+(this._slices+1));for(_+=(this._stacks+1)*(this._slices+1),d=0;d<=this._stacks;d++)for(f=0;f<=this._slices;f++)o=this._radius*Math.cos(d*r)*Math.cos(f*a+Math.PI),l=this._radius*Math.sin(-d*r),h=this._radius*Math.cos(d*r)*Math.sin(f*a+Math.PI),i[u++]=o,i[u++]=l-s,i[u++]=h,i[u++]=o,i[u++]=l,i[u++]=h,i[u++]=1-f/this._slices,i[u++]=(d/this._stacks*(Math.PI*this._radius/2)+(this._height+Math.PI*this._radius/2))/(this._height+Math.PI*this._radius),d<this._stacks&&(n[c++]=_+d*(this._slices+1)+f,n[c++]=_+d*(this._slices+1)+f+(this._slices+1),n[c++]=_+d*(this._slices+1)+f+1,n[c++]=_+d*(this._slices+1)+f,n[c++]=_+d*(this._slices+1)+f+this._slices,n[c++]=_+d*(this._slices+1)+f+(this._slices+1));for(_+=(this._stacks+1)*(this._slices+1),f=0;f<=this._slices;f++)o=this._radius*Math.cos(f*a+Math.PI),l=s,h=this._radius*Math.sin(f*a+Math.PI),i[u++]=o,i[u+8*(this._slices+1)-1]=o,i[u++]=l,i[u+8*(this._slices+1)-1]=-l,i[u++]=h,i[u+8*(this._slices+1)-1]=h,i[u++]=o,i[u+8*(this._slices+1)-1]=o,i[u++]=0,i[u+8*(this._slices+1)-1]=0,i[u++]=h,i[u+8*(this._slices+1)-1]=h,i[u++]=1-1*f/this._slices,i[u+8*(this._slices+1)-1]=1-1*f/this._slices,i[u++]=Math.PI*this._radius/2/(this._height+Math.PI*this._radius),i[u+8*(this._slices+1)-1]=(Math.PI*this._radius/2+this._height)/(this._height+Math.PI*this._radius);for(f=0;f<this._slices;f++)n[c++]=f+_+(this._slices+1),n[c++]=f+_+1,n[c++]=f+_,n[c++]=f+_+(this._slices+1),n[c++]=f+_+(this._slices+1)+1,n[c++]=f+_+1;_+=2*(this._slices+1),this._vertexBuffer=new Zi(t,this._numberVertices,35044,!0),this._indexBuffer=new ji("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(i),this._indexBuffer.setData(n),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},_(0,e,"radius",function(){return this._radius},function(t){this._radius!==t&&(this._radius=t,this.releaseResource(),this.activeResource())}),_(0,e,"height",function(){return this._height},function(t){this._height!==t&&(this._height=t,this.releaseResource(),this.activeResource())}),_(0,e,"stacks",function(){return this._stacks},function(t){this._stacks!==t&&(this._stacks=t,this.releaseResource(),this.activeResource())}),_(0,e,"slices",function(){return this._slices},function(t){this._slices!==t&&(this._slices=t,this.releaseResource(),this.activeResource())})}(),function(t){function n(t,e,i){this._radius=NaN,this._height=NaN,void(this._slices=0)===t&&(t=.5),void 0===e&&(e=2),void 0===i&&(i=32),n.__super.call(this),this._radius=t,this._height=e,this._slices=i,this.recreateResource(),this._positions=this._getPositions(),this._generateBoundingObject()}m(n,"laya.d3.resource.models.CylinderMesh",nn);var e=n.prototype;e.recreateResource=function(){this._numberVertices=this._slices+1+1+2*(this._slices+1)+(this._slices+1+1),this._numberIndices=3*this._slices+6*this._slices+3*this._slices;for(var t=Qt.vertexDeclaration,e=t.vertexStride/4,i=new Float32Array(this._numberVertices*e),n=new Uint16Array(this._numberIndices),r=2*Math.PI/this._slices,a=this._height/2,s=0,o=0,l=0,h=0,u=0,c=0,_=0,d=0;d<=this._slices;d++)0===d&&(i[c++]=0,i[c++]=a,i[c++]=0,i[c++]=0,i[c++]=1,i[c++]=0,i[c++]=.5,i[c++]=.5),s=d*r,l=Math.cos(s)*this._radius,h=a,u=Math.sin(s)*this._radius,i[c++]=l,i[c++]=h,i[c++]=u,i[c++]=0,i[c++]=1,i[c++]=0,i[c++]=.5+.5*Math.cos(s),i[c++]=.5+.5*Math.sin(s);for(var f=0;f<this._slices;f++)n[_++]=0,n[_++]=f+1,n[_++]=f+2;o+=this._slices+1+1;for(var p=0;p<=this._slices;p++)s=p*r,l=Math.cos(s+Math.PI)*this._radius,h=a,u=Math.sin(s+Math.PI)*this._radius,i[c++]=l,i[c+8*(this._slices+1)-1]=l,i[c++]=h,i[c+8*(this._slices+1)-1]=-h,i[c++]=u,i[c+8*(this._slices+1)-1]=u,i[c++]=l,i[c+8*(this._slices+1)-1]=l,i[c++]=0,i[c+8*(this._slices+1)-1]=0,i[c++]=u,i[c+8*(this._slices+1)-1]=u,i[c++]=1-1*p/this._slices,i[c+8*(this._slices+1)-1]=1-1*p/this._slices,i[c++]=0,i[c+8*(this._slices+1)-1]=1;c+=8*(this._slices+1);for(var m=0;m<this._slices;m++)n[_++]=m+o+(this._slices+1),n[_++]=m+o+1,n[_++]=m+o,n[_++]=m+o+(this._slices+1),n[_++]=m+o+(this._slices+1)+1,n[_++]=m+o+1;o+=2*(this._slices+1);for(var g=0;g<=this._slices;g++)0===g&&(i[c++]=0,i[c++]=-a,i[c++]=0,i[c++]=0,i[c++]=-1,i[c++]=0,i[c++]=.5,i[c++]=.5),s=g*r,l=Math.cos(s+Math.PI)*this._radius,h=-a,u=Math.sin(s+Math.PI)*this._radius,i[c++]=l,i[c++]=h,i[c++]=u,i[c++]=0,i[c++]=-1,i[c++]=0,i[c++]=.5+.5*Math.cos(s),i[c++]=.5+.5*Math.sin(s);for(var v=0;v<this._slices;v++)n[_++]=0+o,n[_++]=v+2+o,n[_++]=v+1+o;o+=this._slices+1+1,this._vertexBuffer=new Zi(t,this._numberVertices,35044,!0),this._indexBuffer=new ji("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(i),this._indexBuffer.setData(n),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},_(0,e,"radius",function(){return this._radius},function(t){this._radius!==t&&(this._radius=t,this.releaseResource(),this.activeResource())}),_(0,e,"height",function(){return this._height},function(t){this._height!==t&&(this._height=t,this.releaseResource(),this.activeResource())}),_(0,e,"slices",function(){return this._slices},function(t){this._slices!==t&&(this._slices=t,this.releaseResource(),this.activeResource())})}(),function(t){function r(t,e,i,n){this._long=NaN,this._width=NaN,this._stacks=0,void(this._slices=0)===t&&(t=10),void 0===e&&(e=10),void 0===i&&(i=10),void 0===n&&(n=10),r.__super.call(this),this._long=t,this._width=e,this._stacks=i,this._slices=n,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}m(r,"laya.d3.resource.models.PlaneMesh",nn);var e=r.prototype;e.recreateResource=function(){this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=this._stacks*this._slices*2*3;for(var t=new Uint16Array(this._numberIndices),e=Qt.vertexDeclaration,i=e.vertexStride/4,n=new Float32Array(this._numberVertices*i),r=this._long/2,a=this._width/2,s=this._long/this._stacks,o=this._width/this._slices,l=0,h=0;h<=this._slices;h++)for(var u=0;u<=this._stacks;u++)n[l++]=u*s-r,n[l++]=0,n[l++]=h*o-a,n[l++]=0,n[l++]=1,n[l++]=0,n[l++]=1*u/this._stacks,n[l++]=1*h/this._slices;var c=0;for(h=0;h<this._slices;h++)for(u=0;u<this._stacks;u++)t[c++]=(h+1)*(this._stacks+1)+u,t[c++]=h*(this._stacks+1)+u,t[c++]=(h+1)*(this._stacks+1)+u+1,t[c++]=h*(this._stacks+1)+u,t[c++]=h*(this._stacks+1)+u+1,t[c++]=(h+1)*(this._stacks+1)+u+1;this._vertexBuffer=new Zi(e,this._numberVertices,35044,!0),this._indexBuffer=new ji("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(n),this._indexBuffer.setData(t),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},_(0,e,"long",function(){return this._long},function(t){this._long!==t&&(this._long=t,this.releaseResource(),this.activeResource())}),_(0,e,"width",function(){return this._width},function(t){this._width!==t&&(this._width=t,this.releaseResource(),this.activeResource())}),_(0,e,"stacks",function(){return this._stacks},function(t){this._stacks!==t&&(this._stacks=t,this.releaseResource(),this.activeResource())}),_(0,e,"slices",function(){return this._slices},function(t){this._slices!==t&&(this._slices=t,this.releaseResource(),this.activeResource())})}(),function(t){function i(t,e){this._long=NaN,this._width=NaN,void 0===t&&(t=1),void 0===e&&(e=1),i.__super.call(this),this._long=t,this._width=e,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}m(i,"laya.d3.resource.models.QuadMesh",nn);var e=i.prototype;e.recreateResource=function(){this._numberVertices=4,this._numberIndices=6;var t=Qt.vertexDeclaration,e=(t.vertexStride,this._long/2),i=this._width/2,n=new Float32Array([-e,i,0,0,0,1,0,0,e,i,0,0,0,1,1,0,-e,-i,0,0,0,1,0,1,e,-i,0,0,0,1,1,1]),r=new Uint16Array([0,1,2,3,2,1]);this._vertexBuffer=new Zi(t,this._numberVertices,35044,!0),this._indexBuffer=new ji("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(n),this._indexBuffer.setData(r),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},_(0,e,"long",function(){return this._long},function(t){this._long!==t&&(this._long=t,this.releaseResource(),this.activeResource())}),_(0,e,"width",function(){return this._width},function(t){this._width!==t&&(this._width=t,this.releaseResource(),this.activeResource())})}(),function(t){function n(t,e,i){this._radius=NaN,this._slices=0,void(this._stacks=0)===t&&(t=.5),void 0===e&&(e=32),void 0===i&&(i=32),n.__super.call(this),this._radius=t,this._stacks=e,this._slices=i,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}m(n,"laya.d3.resource.models.SphereMesh",nn);var e=n.prototype;e.recreateResource=function(){this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=3*this._stacks*(this._slices+1)*2;for(var t=new Uint16Array(this._numberIndices),e=Qt.vertexDeclaration,i=e.vertexStride/4,n=new Float32Array(this._numberVertices*i),r=Math.PI/this._stacks,a=2*Math.PI/this._slices,s=0,o=0,l=0,h=0;h<this._stacks+1;h++)for(var u=Math.sin(h*r),c=Math.cos(h*r),_=0;_<this._slices+1;_++){var d=u*Math.sin(_*a+1*Math.PI/2),f=u*Math.cos(_*a+1*Math.PI/2);n[o+0]=d*this._radius,n[o+1]=c*this._radius,n[o+2]=f*this._radius,n[o+3]=d,n[o+4]=c,n[o+5]=f,n[o+6]=_/this._slices,n[o+7]=h/this._stacks,o+=i,h!=this._stacks-1&&(t[l++]=s+(this._slices+1),t[l++]=s,t[l++]=s+1,t[l++]=s+this._slices,t[l++]=s,t[l++]=s+(this._slices+1),s++)}this._vertexBuffer=new Zi(e,this._numberVertices,35044,!0),this._indexBuffer=new ji("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(n),this._indexBuffer.setData(t),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},_(0,e,"radius",function(){return this._radius},function(t){this._radius!==t&&(this._radius=t,this.releaseResource(),this.activeResource())}),_(0,e,"slices",function(){return this._slices},function(t){this._slices!==t&&(this._slices=t,this.releaseResource(),this.activeResource())}),_(0,e,"stacks",function(){return this._stacks},function(t){this._stacks!==t&&(this._stacks=t,this.releaseResource(),this.activeResource())})}(),function(t){function s(t,e,i){void 0===t&&(t=0),void 0===e&&(e=.3),void 0===i&&(i=1e3),this._viewMatrix=new De,this._projectionMatrix=new De,this._projectionViewMatrix=new De,this._viewport=new Ne(0,0,0,0),this._normalizedViewport=new Ne(0,0,1,1),this._aspectRatio=t,this._boundFrustumUpdate=!0,this._boundFrustum=new Ee(De.DEFAULT),s.__super.call(this,e,i),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}m(s,"laya.d3.core.Camera",cn);var e=s.prototype;return e._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},e._parseCustomProps=function(t,e,i,n){var r=i.clearColor;this.clearColor=new Pe(r[0],r[1],r[2],r[3]);var a=i.viewport;this.normalizedViewport=new Ne(a[0],a[1],a[2],a[3])},e._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var t=this.orthographicVerticalSize*this.aspectRatio*.5,e=.5*this.orthographicVerticalSize;De.createOrthoOffCenterRH(-t,t,-e,e,this.nearPlane,this.farPlane,this._projectionMatrix)}else De.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},e._update=function(t){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,t)},e._renderCamera=function(t,e,i){var n,r;i.parallelSplitShadowMaps[0]&&i._renderShadowMap(t,e,this),(e.camera=this)._prepareCameraToRender(),i._preRenderUpdateComponents(e),n=e._viewMatrix=this.viewMatrix;var a=this._renderTarget;e._projectionViewMatrix=a?(a.start(),De.multiply(cn._invertYScaleMatrix,this._projectionMatrix,cn._invertYProjectionMatrix),De.multiply(cn._invertYScaleMatrix,this.projectionViewMatrix,cn._invertYProjectionViewMatrix),r=e._projectionMatrix=cn._invertYProjectionMatrix,cn._invertYProjectionViewMatrix):(r=e._projectionMatrix=this._projectionMatrix,this.projectionViewMatrix),this._prepareCameraViewProject(n,r),e._viewport=this.viewport,i._preRenderScene(t,e,this.boundFrustum),i._clear(t,e),i._renderScene(t,e),i._postRenderUpdateComponents(e),a&&a.end()},e.viewportPointToRay=function(t,e){je.calculateCursorRay(t,this.viewport,this._projectionMatrix,this.viewMatrix,null,e)},e.normalizedViewportPointToRay=function(t,e){var i=s._tempVector20,n=this.viewport,r=t.elements,a=i.elements;a[0]=r[0]*n.width,a[1]=r[1]*n.height,je.calculateCursorRay(i,this.viewport,this._projectionMatrix,this.viewMatrix,null,e)},e.worldToViewportPoint=function(t,e){De.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project(t,this._projectionViewMatrix,e);var i=e.elements;e.z<0||1<e.z?i[0]=i[1]=i[2]=NaN:(i[0]=i[0]/S.stage.clientScaleX,i[1]=i[1]/S.stage.clientScaleY)},e.worldToNormalizedViewportPoint=function(t,e){De.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project(t,this._projectionViewMatrix,e);var i=e.elements;e.z<0||1<e.z?i[0]=i[1]=i[2]=NaN:(i[0]=i[0]/S.stage.clientScaleX,i[1]=i[1]/S.stage.clientScaleY)},e.convertScreenCoordToOrthographicCoord=function(t,e){if(this._orthographic){var i=$.clientWidth,n=$.clientHeight,r=this.orthographicVerticalSize*this.aspectRatio/i,a=this.orthographicVerticalSize/n,s=t.elements,o=e.elements;return o[0]=(-i/2+s[0])*r,o[1]=(n/2-s[1])*a,o[2]=(this.nearPlane-this.farPlane)*(s[2]+1)/2-this.nearPlane,Oe.transformCoordinate(e,this.transform.worldMatrix,e),!0}return!1},_(0,e,"projectionViewMatrix",function(){return De.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),_(0,e,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var t=this.viewport;return t.width/t.height},function(t){if(t<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=t,this._calculateProjectionMatrix()}),_(0,e,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),_(0,e,"needViewport",function(){var t=this.normalizedViewport;return 0===t.x&&0===t.y&&1===t.width&&1===t.height}),_(0,e,"viewport",function(){if(this._viewportExpressedInClipSpace){var t=this._normalizedViewport,e=this.renderTargetSize,i=e.width,n=e.height;this._viewport.x=t.x*i,this._viewport.y=t.y*n,this._viewport.width=t.width*i,this._viewport.height=t.height*n}return this._viewport},function(t){if(null!=this.renderTarget&&(t.x<0||t.y<0||0==t.width||0==t.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=t,this._calculateProjectionMatrix()}),_(0,e,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var t=this._viewport,e=this.renderTargetSize,i=e.width,n=e.height;this._normalizedViewport.x=t.x/i,this._normalizedViewport.y=t.y/n,this._normalizedViewport.width=t.width/i,this._normalizedViewport.height=t.height/n}return this._normalizedViewport},function(t){t.x<0&&(t.x=0,console.warn("Camera: viewport.x must large than 0.0.")),t.y<0&&(t.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<t.x+t.width&&(t.width=1-t.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<t.y+t.height&&(t.height=1-t.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=t,this._calculateProjectionMatrix()}),_(0,e,"projectionMatrix",function(){return this._projectionMatrix},function(t){this._projectionMatrix=t,this._useUserProjectionMatrix=!0}),_(0,e,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),c(s,["_tempVector20",function(){return this._tempVector20=new Le}]),s}()),mn=(function(e){function i(){i.__super.call(this),this._render=new Mi(this),this._render.on("materialchanged",this,this._onMaterialChanged);var t=new ki;this._render.sharedMaterial=t,this._geometryFilter=new Li(this),t.renderMode=8,this._changeRenderObject(0)}m(i,"laya.d3.core.glitter.Glitter",e);var t=i.prototype;t._changeRenderObject=function(t){var e=this._render._renderElements,i=e[t];i||(i=e[t]=new Q),i._render=this._render;var n=this._render.sharedMaterials[t];n||(n=ki.defaultMaterial);var r=this._geometryFilter;return i._mainSortID=0,i._sprite3D=this,i.renderObj=r,i._material=n,i},t._onMaterialChanged=function(t,e,i){e<t._renderElements.length&&this._changeRenderObject(e)},t._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},t._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},t._update=function(t){this._geometryFilter._update(t.elapsedTime),e.prototype._update.call(this,t)},t.addGlitterByPositions=function(t,e){this._geometryFilter.addVertexPosition(t,e)},t.addGlitterByPositionsVelocitys=function(t,e,i,n){this._geometryFilter.addVertexPositionVelocity(t,e,i,n)},t.cloneTo=function(t){var e=t,i=e.templet,n=this._geometryFilter;i.lifeTime=n.lifeTime,i.minSegmentDistance=n.minSegmentDistance,i.minInterpDistance=n.minInterpDistance,i.maxSlerpCount=n.maxSlerpCount,i._maxSegments=n._maxSegments;var r=e._render,a=this._render;r.sharedMaterials=a.sharedMaterials,r.enable=a.enable,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,t)},t.destroy=function(t){void 0===t&&(t=!0),this.destroyed||(e.prototype.destroy.call(this,t),this._geometryFilter._destroy(),this._geometryFilter=null)},_(0,t,"templet",function(){return this._geometryFilter}),_(0,t,"glitterRender",function(){return this._render}),i.CURRENTTIME=2,i.DURATION=3}(_n),function(t){function e(){this._direction=null,this._updateDirection=!1,e.__super.call(this),this._updateDirection=!1,this._direction=new Oe,this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChange)}m(e,"laya.d3.core.light.DirectionLight",t);var i=e.prototype;return i._initShadow=function(){if(this._shadow)this._parallelSplitShadowMap=new He,this.scene.parallelSplitShadowMaps.push(this._parallelSplitShadowMap),this.transform.worldMatrix.getForward(this._direction),Oe.normalize(this._direction,this._direction),this._parallelSplitShadowMap.setInfo(this.scene,this._shadowFarPlane,this._direction,this._shadowMapSize,this._shadowMapCount,this._shadowMapPCFType);else{var t=this.scene.parallelSplitShadowMaps;t.splice(t.indexOf(this._parallelSplitShadowMap),1),this._parallelSplitShadowMap.disposeAllRenderTarget(),this._parallelSplitShadowMap=null,this.scene.removeShaderDefine(He.SHADERDEFINE_SHADOW_PSSM1),this.scene.removeShaderDefine(He.SHADERDEFINE_SHADOW_PSSM2),this.scene.removeShaderDefine(He.SHADERDEFINE_SHADOW_PSSM3)}},i._addSelfRenderObjects=function(){t.prototype._addSelfRenderObjects.call(this),this._shadow&&this._initShadow()},i._clearSelfRenderObjects=function(){var t=this.scene,e=t._shaderValues;e.setValue(4,null),e.setValue(3,null),t.removeShaderDefine(ui.SHADERDEFINE_DIRECTIONLIGHT)},i._prepareToScene=function(t){var e=t.scene;if(e.enableLight&&this._activeInHierarchy){var i=e._shaderValues;return e.addShaderDefine(ui.SHADERDEFINE_DIRECTIONLIGHT),Oe.scale(this.color,this._intensity,this._intensityColor),i.setValue(4,this._intensityColor.elements),this.transform.worldMatrix.getForward(this._direction),Oe.normalize(this._direction,this._direction),i.setValue(3,this._direction.elements),!0}return e.removeShaderDefine(ui.SHADERDEFINE_DIRECTIONLIGHT),!1},i._onWorldMatrixChange=function(){this._updateDirection=!0},_(0,i,"shadow",t.prototype._$get_shadow,function(t){this._shadow!==t&&(this._shadow=t,this.scene&&this._initShadow())}),_(0,i,"direction",function(){return console.log("Warning: discard property,please use transform's property instead."),this._updateDirection&&(this.transform.worldMatrix.getForward(this._direction),Oe.normalize(this._direction,this._direction),this._updateDirection=!1),this._direction},function(t){console.log("Warning: discard property,please use transform's property instead.");var e=this.transform.worldMatrix;e.setForward(t),this.transform.worldMatrix=e,Oe.normalize(t,t),this._direction=t,this.shadow&&this._parallelSplitShadowMap&&this._parallelSplitShadowMap._setGlobalParallelLightDir(this._direction)}),e}(dn)),gn=(function(t){function e(){this._range=NaN,this._attenuation=null,e.__super.call(this),this._range=6,this._attenuation=new Oe(.6,.6,.6)}m(e,"laya.d3.core.light.PointLight",dn);var i=e.prototype;i._clearSelfRenderObjects=function(){var t=this.scene,e=t._shaderValues;e.setValue(8,null),e.setValue(5,null),e.setValue(6,null),e.setValue(7,null),t.removeShaderDefine(ui.SHADERDEFINE_POINTLIGHT)},i._prepareToScene=function(t){var e=t.scene;if(e.enableLight&&this._activeInHierarchy){var i=e._shaderValues;return e.addShaderDefine(ui.SHADERDEFINE_POINTLIGHT),Oe.scale(this.color,this._intensity,this._intensityColor),i.setValue(8,this._intensityColor.elements),i.setValue(5,this.transform.position.elements),i.setValue(6,this.range),i.setValue(7,this.attenuation.elements),!0}return e.removeShaderDefine(ui.SHADERDEFINE_POINTLIGHT),!1},_(0,i,"range",function(){return this._range},function(t){this._range=t}),_(0,i,"attenuation",function(){return this._attenuation},function(t){this._attenuation=t})}(),function(t){function e(){this._updateDirection=!1,this._direction=null,this._spot=NaN,this._range=NaN,this._attenuation=null,e.__super.call(this),this._updateDirection=!1,this.direction=new Oe(0,-1,-1),this._attenuation=new Oe(.6,.6,.6),this._spot=96,this._range=6,this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChange)}m(e,"laya.d3.core.light.SpotLight",dn);var i=e.prototype;i._onWorldMatrixChange=function(){this._updateDirection=!0},i._clearSelfRenderObjects=function(){var t=this.scene,e=t._shaderValues;e.setValue(14,null),e.setValue(9,null),e.setValue(10,null),e.setValue(12,null),e.setValue(11,null),e.setValue(13,null),t.removeShaderDefine(ui.SHADERDEFINE_SPOTLIGHT)},i._prepareToScene=function(t){var e=t.scene;if(e.enableLight&&this._activeInHierarchy){var i=e._shaderValues;return e.addShaderDefine(ui.SHADERDEFINE_SPOTLIGHT),Oe.scale(this.color,this._intensity,this._intensityColor),i.setValue(14,this._intensityColor.elements),i.setValue(9,this.transform.position.elements),this.transform.worldMatrix.getForward(this._direction),Oe.normalize(this._direction,this._direction),i.setValue(10,this._direction.elements),i.setValue(12,this.range),i.setValue(11,this.spot),i.setValue(13,this.attenuation.elements),!0}return e.removeShaderDefine(ui.SHADERDEFINE_SPOTLIGHT),!1},_(0,i,"spot",function(){return this._spot},function(t){this._spot=t}),_(0,i,"direction",function(){return console.log("Warning: discard property,please use transform's property instead."),this._updateDirection&&(this.transform.worldMatrix.getForward(this._direction),this._updateDirection=!1),this._direction},function(t){console.log("Warning: discard property,please use transform's property instead.");var e=this.transform.worldMatrix;e.setForward(t),this.transform.worldMatrix=e,this._direction=t}),_(0,i,"range",function(){return this._range},function(t){this._range=t}),_(0,i,"attenuation",function(){return this._attenuation},function(t){this._attenuation=t})}(),function(i){function n(t,e){n.__super.call(this,e),this._geometryFilter=new Di(this),this._render=new Ii(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),t&&(this._geometryFilter.sharedMesh=t)instanceof laya.d3.resource.models.Mesh&&(t.loaded?this._render.sharedMaterials=t.materials:t.once("loaded",this,this._applyMeshMaterials))}m(n,"laya.d3.core.MeshSprite3D",i);var t=n.prototype;return t._changeRenderObjectByMesh=function(t){var e=this._render._renderElements,i=e[t];i||(i=e[t]=new hi),i._render=this._render;var n=this._render.sharedMaterials[t];n||(n=Wi.defaultMaterial);var r=this._geometryFilter.sharedMesh.getRenderElement(t);if(i._mainSortID=this._getSortID(r,n),i._sprite3D=this,i.renderObj=r,i._material=n,f.isConchNode){var a=r._getVertexBuffer();i._conchSubmesh.setVBIB(a.vertexDeclaration._conchVertexDeclaration,a.getData(),r._getIndexBuffer().getData())}return i},t._changeRenderObjectByMaterial=function(t,e){var i=this._render._renderElements[t];e||(e=Wi.defaultMaterial);var n=this._geometryFilter.sharedMesh.getRenderElement(t);return i._mainSortID=this._getSortID(n,e),i._sprite3D=this,i.renderObj=n,i._material=e,f.isConchNode&&i._conchSubmesh.setMaterial(e._conchMaterial),i},t._changeRenderObjectsByMesh=function(){f.isConchNode;var t=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=t;for(var e=0;e<t;e++)this._changeRenderObjectByMesh(e)},t._onMeshChanged=function(t){var e=t.sharedMesh;e.loaded?this._changeRenderObjectsByMesh():e.once("loaded",this,this._onMeshLoaded)},t._onMeshLoaded=function(t){t===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},t._onMaterialChanged=function(t,e,i){e<this._render._renderElements.length&&this._changeRenderObjectByMaterial(e,i)},t._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},t._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},t._parseCustomProps=function(t,e,i,n){var r=this.meshRender,a=i.lightmapIndex;null!=a&&(r.lightmapIndex=a);var s,o,l=i.lightmapScaleOffset;if(l&&(r.lightmapScaleOffset=new Pe(l[0],l[1],l[2],l[3])),n.instanceParams)(s=n.instanceParams.loadPath)&&(o=Dt.getRes(e[s]),(this.meshFilter.sharedMesh=o).loaded?r.sharedMaterials=o.materials:o.once("loaded",this,this._applyMeshMaterials));else{(s=i.meshPath)&&(o=Dt.getRes(e[s]),this.meshFilter.sharedMesh=o);var h=i.materials;if(h){var u=r.sharedMaterials,c=h.length;u.length=c;for(var _=0;_<c;_++)u[_]=Dt.getRes(e[h[_].path]);r.sharedMaterials=u}}},t._applyMeshMaterials=function(t){for(var e=this._render.sharedMaterials,i=t.materials,n=0,r=i.length;n<r;n++)e[n]||(e[n]=i[n]);this._render.sharedMaterials=e},t._addToInitStaticBatchManager=function(){n._staticBatchManager._addInitBatchSprite(this)},t.cloneTo=function(t){var e=t;e._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var i=this._render,n=e._render;n.enable=i.enable,n.sharedMaterials=i.sharedMaterials,n.castShadow=i.castShadow;var r=i.lightmapScaleOffset;r&&(n.lightmapScaleOffset=r.clone()),n.lightmapIndex=i.lightmapIndex,n.receiveShadow=i.receiveShadow,n.sortingFudge=i.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,t)},t.destroy=function(t){if(void 0===t&&(t=!0),!this.destroyed){var e=this.meshFilter.sharedMesh;e.loaded||e.off("loaded",this,this._applyMeshMaterials),i.prototype.destroy.call(this,t),this._geometryFilter._destroy()}},t.createConchModel=function(){return null},_(0,t,"meshFilter",function(){return this._geometryFilter}),_(0,t,"meshRender",function(){return this._render}),n.__init__=function(){ct._staticBatchManagers.push(n._staticBatchManager)},n.load=function(t){return S.loader.create(t,null,null,n)},c(n,["_staticBatchManager",function(){return this._staticBatchManager=new ci}]),n}(_n)),vn=function(e){function Mt(t){Mt.__super.call(this),this._render=new Ci(this),this._render.on("materialchanged",this,this._onMaterialChanged),this._geometryFilter=new bi(this),this._createRenderElement(0),t&&(this._render.sharedMaterial=t)}m(Mt,"laya.d3.core.particleShuriKen.ShuriKenParticle3D",e);var t=Mt.prototype;return t._initParticleVelocity=function(t){for(var e=new Y,i=t.velocitys,n=0,r=i.length;n<r;n++){var a=i[n];e.add(a.key,a.value)}return e},t._initParticleColor=function(t){var e=new W,i=t.alphas,n=0,r=0;for(n=0,r=i.length;n<r;n++){var a=i[n];e.addAlpha(a.key,a.value)}var s=t.rgbs;for(n=0,r=s.length;n<r;n++){var o=s[n],l=o.value;e.addRGB(o.key,new Oe(l[0],l[1],l[2]))}return e},t._initParticleSize=function(t){for(var e=new Y,i=t.sizes,n=0,r=i.length;n<r;n++){var a=i[n];e.add(a.key,a.value)}return e},t._initParticleRotation=function(t){for(var e=new Y,i=t.angularVelocitys,n=0,r=i.length;n<r;n++){var a=i[n];e.add(a.key,a.value/180*Math.PI)}return e},t._initParticleFrame=function(t){for(var e=new X,i=t.frames,n=0,r=i.length;n<r;n++){var a=i[n];e.add(a.key,a.value)}return e},t._createRenderElement=function(t){var e=this._render._renderElements[t]=new Q;e._render=this._render;var i=this._render.sharedMaterials[t];i||(i=Ki.defaultMaterial);var n=this._geometryFilter;e._mainSortID=0,e._sprite3D=this,e.renderObj=n,e._material=i},t._onMaterialChanged=function(t,e,i){var n=t._renderElements;e<n.length&&(n[e]._material=i||Ki.defaultMaterial)},t._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},t._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},t._parseCustomProps=function(t,e,i,n){var r,a=Math.PI/180,s=0,o=0,l=this.particleRender,h=i.material;if(h)r=Dt.getRes(e[h.path]);else{var u=i.materialPath;u?r=Dt.getRes(e[u]):(r=new Ki).diffuseTexture=e?Dt.getRes(e[i.texturePath]):ln.load(i.texturePath)}l.sharedMaterial=r;var c=i.meshPath;c&&(l.mesh=Dt.getRes(e[c])),l.renderMode=i.renderMode,l.stretchedBillboardCameraSpeedScale=i.stretchedBillboardCameraSpeedScale,l.stretchedBillboardSpeedScale=i.stretchedBillboardSpeedScale,l.stretchedBillboardLengthScale=i.stretchedBillboardLengthScale,l.sortingFudge=i.sortingFudge?i.sortingFudge:0;var _=this.particleSystem;_.isPerformanceMode=i.isPerformanceMode,_.duration=i.duration,_.looping=i.looping,_.prewarm=i.prewarm,_.startDelayType=i.startDelayType,_.startDelay=i.startDelay,_.startDelayMin=i.startDelayMin,_.startDelayMax=i.startDelayMax,_.startLifetimeType=i.startLifetimeType,_.startLifetimeConstant=i.startLifetimeConstant,_.startLifeTimeGradient=Mt._initStartLife(i.startLifetimeGradient),_.startLifetimeConstantMin=i.startLifetimeConstantMin,_.startLifetimeConstantMax=i.startLifetimeConstantMax,_.startLifeTimeGradientMin=Mt._initStartLife(i.startLifetimeGradientMin),_.startLifeTimeGradientMax=Mt._initStartLife(i.startLifetimeGradientMax),_.startSpeedType=i.startSpeedType,_.startSpeedConstant=i.startSpeedConstant,_.startSpeedConstantMin=i.startSpeedConstantMin,_.startSpeedConstantMax=i.startSpeedConstantMax,_.threeDStartSize=i.threeDStartSize,_.startSizeType=i.startSizeType,_.startSizeConstant=i.startSizeConstant;var d=i.startSizeConstantSeparate,f=_.startSizeConstantSeparate.elements;f[0]=d[0],f[1]=d[1],f[2]=d[2],_.startSizeConstantMin=i.startSizeConstantMin,_.startSizeConstantMax=i.startSizeConstantMax;var p=i.startSizeConstantMinSeparate,m=_.startSizeConstantMinSeparate.elements;m[0]=p[0],m[1]=p[1],m[2]=p[2];var g=i.startSizeConstantMaxSeparate,v=_.startSizeConstantMaxSeparate.elements;v[0]=g[0],v[1]=g[1],v[2]=g[2],_.threeDStartRotation=i.threeDStartRotation,_.startRotationType=i.startRotationType,_.startRotationConstant=i.startRotationConstant*a;var y=i.startRotationConstantSeparate,x=_.startRotationConstantSeparate.elements;x[0]=y[0]*a,x[1]=y[1]*a,x[2]=y[2]*a,_.startRotationConstantMin=i.startRotationConstantMin*a,_.startRotationConstantMax=i.startRotationConstantMax*a;var E=i.startRotationConstantMinSeparate,T=_.startRotationConstantMinSeparate.elements;T[0]=E[0]*a,T[1]=E[1]*a,T[2]=E[2]*a;var S=i.startRotationConstantMaxSeparate,w=_.startRotationConstantMaxSeparate.elements;w[0]=S[0]*a,w[1]=S[1]*a,w[2]=S[2]*a,_.randomizeRotationDirection=i.randomizeRotationDirection,_.startColorType=i.startColorType;var M=i.startColorConstant,D=_.startColorConstant.elements;D[0]=M[0],D[1]=M[1],D[2]=M[2],D[3]=M[3];var I=i.startColorConstantMin,b=_.startColorConstantMin.elements;b[0]=I[0],b[1]=I[1],b[2]=I[2],b[3]=I[3];var C=i.startColorConstantMax,A=_.startColorConstantMax.elements;A[0]=C[0],A[1]=C[1],A[2]=C[2],A[3]=C[3],_.gravityModifier=i.gravityModifier,_.simulationSpace=i.simulationSpace,_.scaleMode=i.scaleMode,_.playOnAwake=i.playOnAwake,_.maxParticles=i.maxParticles;var R=i.autoRandomSeed;null!=R&&(_.autoRandomSeed=R);var L=i.randomSeed;null!=L&&(_.randomSeed[0]=L);var O=i.emission;if(O){var P=_.emission;P.emissionRate=O.emissionRate;var N=O.bursts;if(N)for(s=0,o=N.length;s<o;s++){var V=N[s];P.addBurst(new It(V.time,V.min,V.max))}P.enbale=O.enable}else P.enbale=!1;var F=i.shape;if(F){var B;switch(F.shapeType){case 0:var U;B=U=new li,U.radius=F.sphereRadius,U.emitFromShell=F.sphereEmitFromShell,U.randomDirection=F.sphereRandomDirection;break;case 1:var k;B=k=new oi,k.radius=F.hemiSphereRadius,k.emitFromShell=F.hemiSphereEmitFromShell,k.randomDirection=F.hemiSphereRandomDirection;break;case 2:var H;B=H=new si,H.angle=F.coneAngle*a,H.radius=F.coneRadius,H.length=F.coneLength,H.emitType=F.coneEmitType,H.randomDirection=F.coneRandomDirection;break;case 3:var z;B=z=new ri,z.x=F.boxX,z.y=F.boxY,z.z=F.boxZ,z.randomDirection=F.boxRandomDirection;break;case 7:var G;B=G=new ai,G.radius=F.circleRadius,G.arc=F.circleArc*a,G.emitFromEdge=F.circleEmitFromEdge,G.randomDirection=F.circleRandomDirection;break;default:var W;B=W=new ai,W.radius=F.circleRadius,W.arc=F.circleArc*a,W.emitFromEdge=F.circleEmitFromEdge,W.randomDirection=F.circleRandomDirection}B.enable=F.enable,_.shape=B}var X=i.velocityOverLifetime;if(X){var Y,j=X.velocity;switch(j.type){case 0:var Z=j.constant;Y=Ot.createByConstant(new Oe(Z[0],Z[1],Z[2]));break;case 1:Y=Ot.createByGradient(this._initParticleVelocity(j.gradientX),this._initParticleVelocity(j.gradientY),this._initParticleVelocity(j.gradientZ));break;case 2:var K=j.constantMin,q=j.constantMax;Y=Ot.createByRandomTwoConstant(new Oe(K[0],K[1],K[2]),new Oe(q[0],q[1],q[2]));break;case 3:Y=Ot.createByRandomTwoGradient(this._initParticleVelocity(j.gradientXMin),this._initParticleVelocity(j.gradientXMax),this._initParticleVelocity(j.gradientYMin),this._initParticleVelocity(j.gradientYMax),this._initParticleVelocity(j.gradientZMin),this._initParticleVelocity(j.gradientZMax))}var Q=new Bt(Y);Q.space=X.space,Q.enbale=X.enable,_.velocityOverLifetime=Q}var J=i.colorOverLifetime;if(J){var $,tt=J.color;switch(tt.type){case 0:var et=tt.constant;$=Rt.createByConstant(new Pe(et[0],et[1],et[2],et[3]));break;case 1:$=Rt.createByGradient(this._initParticleColor(tt.gradient));break;case 2:var it=tt.constantMin,nt=tt.constantMax;$=Rt.createByRandomTwoConstant(new Pe(it[0],it[1],it[2],it[3]),new Pe(nt[0],nt[1],nt[2],nt[3]));break;case 3:$=Rt.createByRandomTwoGradient(this._initParticleColor(tt.gradientMin),this._initParticleColor(tt.gradientMax))}var rt=new bt($);rt.enbale=J.enable,_.colorOverLifetime=rt}var at=i.sizeOverLifetime;if(at){var st,ot=at.size;switch(ot.type){case 0:st=ot.separateAxes?Lt.createByGradientSeparate(this._initParticleSize(ot.gradientX),this._initParticleSize(ot.gradientY),this._initParticleSize(ot.gradientZ)):Lt.createByGradient(this._initParticleSize(ot.gradient));break;case 1:if(ot.separateAxes){var lt=ot.constantMinSeparate,ht=ot.constantMaxSeparate;st=Lt.createByRandomTwoConstantSeparate(new Oe(lt[0],lt[1],lt[2]),new Oe(ht[0],ht[1],ht[2]))}else st=Lt.createByRandomTwoConstant(ot.constantMin,ot.constantMax);break;case 2:st=ot.separateAxes?Lt.createByRandomTwoGradientSeparate(this._initParticleSize(ot.gradientXMin),this._initParticleSize(ot.gradientYMin),this._initParticleSize(ot.gradientZMin),this._initParticleSize(ot.gradientXMax),this._initParticleSize(ot.gradientYMax),this._initParticleSize(ot.gradientZMax)):Lt.createByRandomTwoGradient(this._initParticleSize(ot.gradientMin),this._initParticleSize(ot.gradientMax))}var ut=new Nt(st);ut.enbale=at.enable,_.sizeOverLifetime=ut}var ct=i.rotationOverLifetime;if(ct){var _t,dt=ct.angularVelocity;switch(dt.type){case 0:dt.separateAxes||(_t=At.createByConstant(dt.constant*a));break;case 1:dt.separateAxes||(_t=At.createByGradient(this._initParticleRotation(dt.gradient)));break;case 2:if(dt.separateAxes){var ft=dt.constantMinSeparate,pt=dt.constantMaxSeparate;_t=At.createByRandomTwoConstantSeparate(new Oe(ft[0]*a,ft[1]*a,ft[2]*a),new Oe(pt[0]*a,pt[1]*a,pt[2]*a))}else _t=At.createByRandomTwoConstant(dt.constantMin*a,dt.constantMax*a);break;case 3:dt.separateAxes||(_t=At.createByRandomTwoGradient(this._initParticleRotation(dt.gradientMin),this._initParticleRotation(dt.gradientMax)))}var mt=new Pt(_t);mt.enbale=ct.enable,_.rotationOverLifetime=mt}var gt=i.textureSheetAnimation;if(gt){var vt,yt=gt.frame;switch(yt.type){case 0:vt=Ct.createByConstant(yt.constant);break;case 1:vt=Ct.createByOverTime(this._initParticleFrame(yt.overTime));break;case 2:vt=Ct.createByRandomTwoConstant(yt.constantMin,yt.constantMax);break;case 3:vt=Ct.createByRandomTwoOverTime(this._initParticleFrame(yt.overTimeMin),this._initParticleFrame(yt.overTimeMax))}var xt,Et=gt.startFrame;switch(Et.type){case 0:xt=Vt.createByConstant(Et.constant);break;case 1:xt=Vt.createByRandomTwoConstant(Et.constantMin,Et.constantMax)}var Tt=new Ft(vt,xt);Tt.enable=gt.enable;var St=gt.tiles;Tt.tiles=new Le(St[0],St[1]),Tt.type=gt.type,Tt.randomRow=gt.randomRow;var wt=gt.rowIndex;void 0!==wt&&(Tt.rowIndex=wt),Tt.cycles=gt.cycles,_.textureSheetAnimation=Tt}},t._activeHierarchy=function(){laya.d3.core.Sprite3D.prototype._activeHierarchy.call(this),this.particleSystem.playOnAwake&&this.particleSystem.play()},t._inActiveHierarchy=function(){laya.d3.core.Sprite3D.prototype._inActiveHierarchy.call(this),this.particleSystem.isAlive&&this.particleSystem.simulate(0,!0)},t.cloneTo=function(t){var e=t,i=e._geometryFilter;this._geometryFilter.cloneTo(i);var n=e._render,r=this._render;n.sharedMaterials=r.sharedMaterials,n.enable=r.enable,n.renderMode=r.renderMode,n.mesh=r.mesh,n.stretchedBillboardCameraSpeedScale=r.stretchedBillboardCameraSpeedScale,n.stretchedBillboardSpeedScale=r.stretchedBillboardSpeedScale,n.stretchedBillboardLengthScale=r.stretchedBillboardLengthScale,n.sortingFudge=r.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,t)},t.destroy=function(t){void 0===t&&(t=!0),this.destroyed||(e.prototype.destroy.call(this,t),this._geometryFilter._destroy(),this._geometryFilter=null)},_(0,t,"particleSystem",function(){return this._geometryFilter}),_(0,t,"particleRender",function(){return this._render}),Mt.__init__=function(){Mt.SHADERDEFINE_RENDERMODE_BILLBOARD=Mt.shaderDefines.registerDefine("SPHERHBILLBOARD"),Mt.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD=Mt.shaderDefines.registerDefine("STRETCHEDBILLBOARD"),Mt.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD=Mt.shaderDefines.registerDefine("HORIZONTALBILLBOARD"),Mt.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD=Mt.shaderDefines.registerDefine("VERTICALBILLBOARD"),Mt.SHADERDEFINE_COLOROVERLIFETIME=Mt.shaderDefines.registerDefine("COLOROVERLIFETIME"),Mt.SHADERDEFINE_RANDOMCOLOROVERLIFETIME=Mt.shaderDefines.registerDefine("RANDOMCOLOROVERLIFETIME"),Mt.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT=Mt.shaderDefines.registerDefine("VELOCITYOVERLIFETIMECONSTANT"),Mt.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE=Mt.shaderDefines.registerDefine("VELOCITYOVERLIFETIMECURVE"),Mt.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT=Mt.shaderDefines.registerDefine("VELOCITYOVERLIFETIMERANDOMCONSTANT"),Mt.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE=Mt.shaderDefines.registerDefine("VELOCITYOVERLIFETIMERANDOMCURVE"),Mt.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE=Mt.shaderDefines.registerDefine("TEXTURESHEETANIMATIONCURVE"),Mt.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE=Mt.shaderDefines.registerDefine("TEXTURESHEETANIMATIONRANDOMCURVE"),Mt.SHADERDEFINE_ROTATIONOVERLIFETIME=Mt.shaderDefines.registerDefine("ROTATIONOVERLIFETIME"),Mt.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE=Mt.shaderDefines.registerDefine("ROTATIONOVERLIFETIMESEPERATE"),Mt.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT=Mt.shaderDefines.registerDefine("ROTATIONOVERLIFETIMECONSTANT"),Mt.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE=Mt.shaderDefines.registerDefine("ROTATIONOVERLIFETIMECURVE"),Mt.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS=Mt.shaderDefines.registerDefine("ROTATIONOVERLIFETIMERANDOMCURVES"),Mt.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES=Mt.shaderDefines.registerDefine("ROTATIONOVERLIFETIMERANDOMCURVES"),Mt.SHADERDEFINE_SIZEOVERLIFETIMECURVE=Mt.shaderDefines.registerDefine("SIZEOVERLIFETIMECURVE"),Mt.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE=Mt.shaderDefines.registerDefine("SIZEOVERLIFETIMECURVESEPERATE"),Mt.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES=Mt.shaderDefines.registerDefine("SIZEOVERLIFETIMERANDOMCURVES"),Mt.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE=Mt.shaderDefines.registerDefine("SIZEOVERLIFETIMERANDOMCURVESSEPERATE"),Mt.SHADERDEFINE_RENDERMODE_MESH=Mt.shaderDefines.registerDefine("RENDERMODE_MESH"),Mt.SHADERDEFINE_SHAPE=Mt.shaderDefines.registerDefine("SHAPE")},Mt.load=function(t){return S.loader.create(t,null,null,Mt)},Mt._initStartLife=function(t){for(var e=new Y,i=t.startLifetimes,n=0,r=i.length;n<r;n++){var a=i[n];e.add(a.key,a.value)}return e},Mt.SHADERDEFINE_RENDERMODE_BILLBOARD=0,Mt.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD=0,Mt.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD=0,Mt.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD=0,Mt.SHADERDEFINE_COLOROVERLIFETIME=0,Mt.SHADERDEFINE_RANDOMCOLOROVERLIFETIME=0,Mt.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT=0,Mt.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE=0,Mt.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT=0,Mt.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE=0,Mt.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE=0,Mt.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE=0,Mt.SHADERDEFINE_ROTATIONOVERLIFETIME=0,Mt.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE=0,Mt.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT=0,Mt.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE=0,Mt.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS=0,Mt.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES=0,Mt.SHADERDEFINE_SIZEOVERLIFETIMECURVE=0,Mt.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE=0,Mt.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES=0,Mt.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE=0,Mt.SHADERDEFINE_RENDERMODE_MESH=0,Mt.SHADERDEFINE_SHAPE=0,Mt.WORLDPOSITION=0,Mt.WORLDROTATION=1,Mt.POSITIONSCALE=4,Mt.SIZESCALE=5,Mt.SCALINGMODE=6,Mt.GRAVITY=7,Mt.THREEDSTARTROTATION=8,Mt.STRETCHEDBILLBOARDLENGTHSCALE=9,Mt.STRETCHEDBILLBOARDSPEEDSCALE=10,Mt.SIMULATIONSPACE=11,Mt.CURRENTTIME=12,Mt.VOLVELOCITYCONST=13,Mt.VOLVELOCITYGRADIENTX=14,Mt.VOLVELOCITYGRADIENTY=15,Mt.VOLVELOCITYGRADIENTZ=16,Mt.VOLVELOCITYCONSTMAX=17,Mt.VOLVELOCITYGRADIENTXMAX=18,Mt.VOLVELOCITYGRADIENTYMAX=19,Mt.VOLVELOCITYGRADIENTZMAX=20,Mt.VOLSPACETYPE=21,Mt.COLOROVERLIFEGRADIENTALPHAS=22,Mt.COLOROVERLIFEGRADIENTCOLORS=23,Mt.MAXCOLOROVERLIFEGRADIENTALPHAS=24,Mt.MAXCOLOROVERLIFEGRADIENTCOLORS=25,Mt.SOLSIZEGRADIENT=26,Mt.SOLSIZEGRADIENTX=27,Mt.SOLSIZEGRADIENTY=28,Mt.SOLSizeGradientZ=29,Mt.SOLSizeGradientMax=30,Mt.SOLSIZEGRADIENTXMAX=31,Mt.SOLSIZEGRADIENTYMAX=32,Mt.SOLSizeGradientZMAX=33,Mt.ROLANGULARVELOCITYCONST=34,Mt.ROLANGULARVELOCITYCONSTSEPRARATE=35,Mt.ROLANGULARVELOCITYGRADIENT=36,Mt.ROLANGULARVELOCITYGRADIENTX=37,Mt.ROLANGULARVELOCITYGRADIENTY=38,Mt.ROLANGULARVELOCITYGRADIENTZ=39,Mt.ROLANGULARVELOCITYGRADIENTW=40,Mt.ROLANGULARVELOCITYCONSTMAX=41,Mt.ROLANGULARVELOCITYCONSTMAXSEPRARATE=42,Mt.ROLANGULARVELOCITYGRADIENTMAX=43,Mt.ROLANGULARVELOCITYGRADIENTXMAX=44,Mt.ROLANGULARVELOCITYGRADIENTYMAX=45,Mt.ROLANGULARVELOCITYGRADIENTZMAX=46,Mt.ROLANGULARVELOCITYGRADIENTWMAX=47,Mt.TEXTURESHEETANIMATIONCYCLES=48,Mt.TEXTURESHEETANIMATIONSUBUVLENGTH=49,Mt.TEXTURESHEETANIMATIONGRADIENTUVS=50,Mt.TEXTURESHEETANIMATIONGRADIENTMAXUVS=51,c(Mt,["shaderDefines",function(){return this.shaderDefines=new Be(_n.shaderDefines)}]),Mt}(_n),yn=function(e){function i(t,e){this._subMeshOffset=null,i.__super.call(this,e),this._subMeshOffset=[],this._geometryFilter=new Di(this),this._render=new un(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),t&&(this._geometryFilter.sharedMesh=t)}m(i,"laya.d3.core.SkinnedMeshSprite3D",e);var t=i.prototype;return t._changeRenderObjectByMesh=function(t){var e=this._render._renderElements,i=e[t];i||(i=e[t]=new hi),i._render=this._render;var n=this._render.sharedMaterials[t];n||(n=Wi.defaultMaterial);var r=this._geometryFilter.sharedMesh.getRenderElement(t);return i._mainSortID=this._getSortID(r,n),i._sprite3D=this,i.renderObj=r,i._material=n,i},t._changeRenderObjectByMaterial=function(t,e){var i=this._render._renderElements[t];e||(e=Wi.defaultMaterial);var n=this._geometryFilter.sharedMesh.getRenderElement(t);return i._mainSortID=this._getSortID(n,e),i._sprite3D=this,i.renderObj=n,i._material=e,i},t._changeRenderObjectsByMesh=function(){var t=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=t;for(var e=0;e<t;e++)this._changeRenderObjectByMesh(e)},t._onMeshChanged=function(t){var e=t.sharedMesh;e.loaded?this._changeRenderObjectsByMesh():e.once("loaded",this,this._changeRenderObjectsByMesh)},t._onMaterialChanged=function(t,e,i){e<this._render._renderElements.length&&this._changeRenderObjectByMaterial(e,i)},t._parseCustomProps=function(t,e,i,n){var r=this.skinnedMeshRender,a=i.lightmapIndex;null!=a&&(r.lightmapIndex=a);var s,o,l=i.lightmapScaleOffset;if(l&&(r.lightmapScaleOffset=new Pe(l[0],l[1],l[2],l[3])),n.instanceParams)(s=n.instanceParams.loadPath)&&(o=Dt.getRes(e[s]),(this.meshFilter.sharedMesh=o).loaded?r.sharedMaterials=o.materials:o.once("loaded",this,this._applyMeshMaterials));else{(s=i.meshPath)&&(o=Dt.getRes(e[s]),this.meshFilter.sharedMesh=o);var h=i.materials;if(h){var u=r.sharedMaterials,c=h.length;u.length=c;for(var _=0;_<c;_++)u[_]=Dt.getRes(e[h[_].path]);r.sharedMaterials=u}var d=i.rootBone;d&&r._setRootBone(d);var f=i.boundBox;if(f){var p=f.min,m=f.max,g=new xe(new Oe(p[0],p[1],p[2]),new Oe(m[0],m[1],m[2]));r.localBoundBox=g}else r._hasIndependentBound=!1;var v=i.boundSphere;if(v){var y=v.center,x=new Te(new Oe(y[0],y[1],y[2]),v.radius);r.localBoundSphere=x}}},t._changeHierarchyAnimator=function(t){if(t){var e=this.skinnedMeshRender;e._setCacheAnimator(t);var i=t.avatar;i&&e._setCacheAvatar(i)}laya.d3.core.Sprite3D.prototype._changeHierarchyAnimator.call(this,t)},t._clearSelfRenderObjects=function(){this._scene.removeFrustumCullingObject(this._render)},t._addSelfRenderObjects=function(){this._scene.addFrustumCullingObject(this._render)},t._applyMeshMaterials=function(t){for(var e=this._render.sharedMaterials,i=t.materials,n=0,r=i.length;n<r;n++)e[n]||(e[n]=i[n]);this._render.sharedMaterials=e},t.cloneTo=function(t){var e=t;e._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var i=this._render,n=e._render;n.enable=i.enable,n.sharedMaterials=i.sharedMaterials,n.castShadow=i.castShadow;var r=i.lightmapScaleOffset;r&&(n.lightmapScaleOffset=r.clone()),n.receiveShadow=i.receiveShadow,n.sortingFudge=i.sortingFudge,n._rootBone=i._rootBone;var a=i.localBoundSphere;a&&(n.localBoundSphere=a.clone());var s=i.localBoundBox;s&&(n.localBoundBox=s.clone()),n._hasIndependentBound=i._hasIndependentBound,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,t)},t.destroy=function(t){void 0===t&&(t=!0),this.destroyed||(e.prototype.destroy.call(this,t),this._geometryFilter._destroy())},t.createConchModel=function(){return null},_(0,t,"meshFilter",function(){return this._geometryFilter}),_(0,t,"skinnedMeshRender",function(){return this._render}),i.__init__=function(){i.SHADERDEFINE_BONE=i.shaderDefines.registerDefine("BONE")},i.load=function(t){return S.loader.create(t,null,null,i)},i.SHADERDEFINE_BONE=8,i.BONES=0,c(i,["shaderDefines",function(){return this.shaderDefines=new Be(_n.shaderDefines)}]),i}(_n),xn=(function(t){function a(t,e,i,n,r){void 0===t&&(t=.1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=.3),void 0===r&&(r=1e3),this._tempMatrix=new De,this._leftViewMatrix=new De,this._leftProjectionMatrix=new De,this._leftProjectionViewMatrix=new De,this._leftViewport=new Ne(0,0,0,0),this._leftNormalizedViewport=new Ne(0,0,.5,1),this._leftAspectRatio=e,this._rightViewMatrix=new De,this._rightProjectionMatrix=new De,this._rightProjectionViewMatrix=new De,this._rightViewport=new Ne(0,0,0,0),this._rightNormalizedViewport=new Ne(.5,0,.5,1),this._rightAspectRatio=i,this._pupilDistande=t,this._leftBoundFrustumUpdate=!0,this._leftBoundFrustum=new Ee(De.DEFAULT),this._rightBoundFrustumUpdate=!0,this._rightBoundFrustum=new Ee(De.DEFAULT),a.__super.call(this,n,r),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}m(a,"laya.d3.core.VRCamera",cn);var e=a.prototype;e._onWorldMatrixChanged=function(){this._leftBoundFrustumUpdate=this._rightBoundFrustumUpdate=!0},e._calculatePupilOffset=function(){var t=this._tempVector3;return Oe.scale(this.right,this._pupilDistande/2,t),t.elements},e._calculateLeftProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var t=this.orthographicVerticalSize*this.leftAspectRatio*.5,e=.5*this.orthographicVerticalSize;De.createOrthoOffCenterRH(-t,t,-e,e,this.nearPlane,this.farPlane,this._leftProjectionMatrix)}else De.createPerspective(3.1416*this.fieldOfView/180,this.leftAspectRatio,this.nearPlane,this.farPlane,this._rightProjectionMatrix);this._leftBoundFrustumUpdate=!0},e._calculateRightProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var t=this.orthographicVerticalSize*this.rightAspectRatio*.5,e=.5*this.orthographicVerticalSize;De.createOrthoOffCenterRH(-t,t,e,e,this.nearPlane,this.farPlane,this._rightProjectionMatrix)}else De.createPerspective(3.1416*this.fieldOfView/180,this.rightAspectRatio,this.nearPlane,this.farPlane,this._rightProjectionMatrix);this._rightBoundFrustumUpdate=!0},e._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var t=this.orthographicVerticalSize*this.leftAspectRatio*.5,e=.5*this.orthographicVerticalSize,i=this.orthographicVerticalSize*this.rightAspectRatio*.5,n=.5*this.orthographicVerticalSize;De.createOrthoOffCenterRH(-t,t,-e,e,this.nearPlane,this.farPlane,this._leftProjectionMatrix),De.createOrthoOffCenterRH(-i,i,n,n,this.nearPlane,this.farPlane,this._rightProjectionMatrix)}else De.createPerspective(3.1416*this.fieldOfView/180,this.leftAspectRatio,this.nearPlane,this.farPlane,this._leftProjectionMatrix),De.createPerspective(3.1416*this.fieldOfView/180,this.rightAspectRatio,this.nearPlane,this.farPlane,this._rightProjectionMatrix);this._leftBoundFrustumUpdate=this._rightBoundFrustumUpdate=!0},e._renderCamera=function(t,e,i){var n,r;(e.camera=this)._prepareCameraToRender(),i._preRenderUpdateComponents(e),n=e._viewMatrix=this.leftViewMatrix;var a,s,o=this._renderTarget;e._projectionViewMatrix=o?(o.start(),De.multiply(cn._invertYScaleMatrix,this._leftProjectionMatrix,cn._invertYProjectionMatrix),De.multiply(cn._invertYScaleMatrix,this.leftProjectionViewMatrix,cn._invertYProjectionViewMatrix),r=e._projectionMatrix=cn._invertYProjectionMatrix,cn._invertYProjectionViewMatrix):(r=e._projectionMatrix=this._leftProjectionMatrix,this.leftProjectionViewMatrix),this._prepareCameraViewProject(n,r),e._viewport=this.leftViewport,i._preRenderScene(t,e,this.leftBoundFrustum),i._clear(t,e),i._renderScene(t,e),a=e._viewMatrix=this.rightViewMatrix,o?(o.start(),De.multiply(cn._invertYScaleMatrix,this._rightProjectionMatrix,cn._invertYProjectionMatrix),De.multiply(cn._invertYScaleMatrix,this.rightProjectionViewMatrix,cn._invertYProjectionViewMatrix),e._projectionMatrix=cn._invertYProjectionMatrix,s=e._projectionViewMatrix=cn._invertYProjectionViewMatrix):(s=e._projectionMatrix=this._rightProjectionMatrix,e._projectionViewMatrix=this.rightProjectionViewMatrix),this._prepareCameraViewProject(a,s),e._viewport=this.rightViewport,i._preRenderScene(t,e,this.rightBoundFrustum),i._clear(t,e),i._renderScene(t,e),i._postRenderUpdateComponents(e),o&&o.end()},_(0,e,"rightBoundFrustum",function(){return this._rightBoundFrustumUpdate&&(this._rightBoundFrustum.matrix=this.rightProjectionViewMatrix),this._rightBoundFrustum}),_(0,e,"leftNormalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var t=this._leftViewport,e=this.renderTargetSize,i=e.width,n=e.height;this._leftNormalizedViewport.x=t.x/i,this._leftNormalizedViewport.y=t.y/n,this._leftNormalizedViewport.width=t.width/i,this._leftNormalizedViewport.height=t.height/n}return this._leftNormalizedViewport}),_(0,e,"rightViewport",function(){if(this._viewportExpressedInClipSpace){var t=this._rightNormalizedViewport,e=this.renderTargetSize,i=e.width,n=e.height;this._rightViewport.x=t.x*i,this._rightViewport.y=t.y*n,this._rightViewport.width=t.width*i,this._rightViewport.height=t.height*n}return this._rightViewport}),_(0,e,"viewport",null,function(t){if(null!=this.renderTarget&&(t.x<0||t.y<0||0==t.width||0==t.height))throw new Error("VRCamera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._leftViewport=new Ne(0,0,t.width/2,t.height),this._rightViewport=new Ne(t.width/2,0,t.width/2,t.height),this._calculateProjectionMatrix()}),_(0,e,"leftAspectRatio",function(){if(0!==this._leftAspectRatio)return this._leftAspectRatio;var t=this.leftViewport;return t.width/t.height}),_(0,e,"rightAspectRatio",function(){if(0!==this._rightAspectRatio)return this._rightAspectRatio;var t=this.rightViewport;return t.width/t.height}),_(0,e,"aspectRatio",null,function(t){if(t<0)throw new Error("VRCamera: the aspect ratio has to be a positive real number.");this._leftAspectRatio=t,this._rightAspectRatio=t,this._calculateRightProjectionMatrix()}),_(0,e,"rightNormalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var t=this._rightViewport,e=this.renderTargetSize,i=e.width,n=e.height;this._rightNormalizedViewport.x=t.x/i,this._rightNormalizedViewport.y=t.y/n,this._rightNormalizedViewport.width=t.width/i,this._rightNormalizedViewport.height=t.height/n}return this._rightNormalizedViewport}),_(0,e,"normalizedViewport",null,function(t){if(t.x<0||t.y<0||1<t.x+t.width||1<t.x+t.height)throw new Error("VRCamera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!0,this._leftNormalizedViewport=new Ne(0,0,t.width/2,t.height),this._rightNormalizedViewport=new Ne(t.width/2,0,t.width/2,t.height),this._calculateProjectionMatrix()}),_(0,e,"leftViewport",function(){if(this._viewportExpressedInClipSpace){var t=this._leftNormalizedViewport,e=this.renderTargetSize,i=e.width,n=e.height;this._leftViewport.x=t.x*i,this._leftViewport.y=t.y*n,this._leftViewport.width=t.width*i,this._leftViewport.height=t.height*n}return this._leftViewport}),_(0,e,"needLeftViewport",function(){var t=this.leftNormalizedViewport;return 0===t.x&&0===t.y&&1===t.width&&1===t.height}),_(0,e,"needRightViewport",function(){var t=this.rightNormalizedViewport;return 0===t.x&&0===t.y&&1===t.width&&1===t.height}),_(0,e,"leftViewMatrix",function(){var t=this._calculatePupilOffset(),e=this._tempMatrix;this.transform.worldMatrix.cloneTo(e);var i=e.elements;return i[12]-=t[0],i[13]-=t[1],i[14]-=t[2],e.invert(this._leftViewMatrix),this._leftViewMatrix}),_(0,e,"rightViewMatrix",function(){var t=this._calculatePupilOffset(),e=this._tempMatrix;this.transform.worldMatrix.cloneTo(e);var i=e.elements;return i[12]+=t[0],i[13]+=t[1],i[14]+=t[2],e.invert(this._rightViewMatrix),this._rightViewMatrix}),_(0,e,"leftProjectionMatrix",function(){return this._leftProjectionMatrix}),_(0,e,"leftProjectionViewMatrix",function(){return De.multiply(this.leftProjectionMatrix,this.leftViewMatrix,this._leftProjectionViewMatrix),this._leftProjectionViewMatrix}),_(0,e,"rightProjectionMatrix",function(){return this._rightProjectionMatrix}),_(0,e,"rightProjectionViewMatrix",function(){return De.multiply(this.rightProjectionMatrix,this.rightViewMatrix,this._rightProjectionViewMatrix),this._rightProjectionViewMatrix}),_(0,e,"leftBoundFrustum",function(){return this._leftBoundFrustumUpdate&&(this._leftBoundFrustum.matrix=this.leftProjectionViewMatrix),this._leftBoundFrustum})}(),function(e){function t(){t.__super.call(this),this._geometryFilter=new Ai(this),this._render=new Ri(this),this._changeRenderObjectsByMaterial(this._render,0,qi.defaultMaterial),this._render.on("materialchanged",this,this._changeRenderObjectsByMaterial),this._geometryFilter.on("trailfilterchange",this,this._changeRenderObjectsByRenderElement)}m(t,"laya.d3.core.trail.TrailSprite3D",e);var i=t.prototype;return i._changeRenderObjectsByMaterial=function(t,e,i){var n=this._geometryFilter.getRenderElementsCount();this._render._renderElements.length=n;for(var r=0;r<n;r++)this._changeRenderObjectByMaterial(r,i)},i._changeRenderObjectByMaterial=function(t,e){var i=this._render._renderElements;e||(e=qi.defaultMaterial);var n=i[t];n||(n=i[t]=new Q),n._sprite3D=this,n.renderObj=this._geometryFilter.getRenderElement(t),n._render=this._render,n._material=e},i._changeRenderObjectsByRenderElement=function(t,e){var i=this._render._renderElements,n=i[t];n||(n=i[t]=new Q),n._sprite3D=this,n.renderObj=e,n._render=this._render,n._material=this._render.sharedMaterial},i._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},i._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},i._update=function(t){e.prototype._update.call(this,t),this._geometryFilter._update(t)},i._parseCustomProps=function(t,e,i,n){var r=this._render,a=this._geometryFilter,s=0,o=0,l=i.materials;if(l){var h=r.sharedMaterials,u=l.length;for(h.length=u,s=0;s<u;s++)h[s]=Dt.getRes(e[l[s].path]);r.sharedMaterials=h}var c=n.props;a.time=c.time,a.minVertexDistance=c.minVertexDistance,a.widthMultiplier=c.widthMultiplier,a.textureMode=c.textureMode;var _=[],d=i.widthCurve;for(s=0,o=d.length;s<o;s++){var f=new at;f.time=d[s].time,f.inTangent=d[s].inTangent,f.outTangent=d[s].outTangent,f.value=d[s].value,_.push(f)}a.widthCurve=_;var p=i.colorGradient,m=new it;m.mode=p.mode;var g,v,y=[],x=p.colorKeys;for(s=0,o=x.length;s<o;s++)v=x[s],g=new rt(new et(v.value[0],v.value[1],v.value[2],1),v.time),y.push(g);var E,T,S=[],w=p.alphaKeys;for(s=0,o=w.length;s<o;s++)T=w[s],E=new nt(T.value,T.time),S.push(E);m.setKeys(y,S),a.colorGradient=m},i.destroy=function(t){void 0===t&&(t=!0),this.destroyed||(e.prototype.destroy.call(this,t),this._geometryFilter._destroy(),this._geometryFilter=null)},_(0,i,"trailFilter",function(){return this._geometryFilter}),_(0,i,"trailRender",function(){return this._render}),t.__init__=function(){t.SHADERDEFINE_GRADIENTMODE_BLEND=t.shaderDefines.registerDefine("GRADIENTMODE_BLEND")},t.CURTIME=3,t.LIFETIME=4,t.WIDTHCURVE=5,t.WIDTHCURVEKEYLENGTH=6,t.GRADIENTCOLORKEY=7,t.GRADIENTALPHAKEY=8,t.SHADERDEFINE_GRADIENTMODE_BLEND=0,c(t,["shaderDefines",function(){return this.shaderDefines=new Be(_n.shaderDefines)}]),t}(_n)),En=function(e){function l(t,e,i,n,r,a,s,o){l.__super.call(this,o),this._geometryFilter=new Oi(this,t,e,i,n,r,a,s),this._render=new Pi(this)}m(l,"laya.d3.terrain.TerrainChunk",e);var t=l.prototype;return t.buildRenderElementAndMaterial=function(t,e,i,n,r,a,s,o,l,h,u,c,_,d,f,p,m,g){void 0===u&&(u=1),void 0===c&&(c=1),void 0===_&&(_=1),void 0===d&&(d=1),void 0===f&&(f=1),void 0===p&&(p=1),void 0===m&&(m=1),void 0===g&&(g=1);var v=new Xi;l&&(v.diffuseColor=l),o&&(v.ambientColor=o),h&&(v.specularColor=h),v.splatAlphaTexture=Dt.getRes(i),v.normalTexture=e?Dt.getRes(e):null,v.diffuseTexture1=n?Dt.getRes(n):null,v.diffuseTexture2=r?Dt.getRes(r):null,v.diffuseTexture3=a?Dt.getRes(a):null,v.diffuseTexture4=s?Dt.getRes(s):null,v.setDiffuseScale1(u,c),v.setDiffuseScale2(_,d),v.setDiffuseScale3(f,p),v.setDiffuseScale4(m,g),v.setDetailNum(t),0!=this._render._renderElements.length&&(v.renderMode=2);var y=new Q;y._mainSortID=0,y._sprite3D=this,y.renderObj=this._geometryFilter,y._material=v,this._render._materials.push(v),this._render._renderElements.push(y)},t.createConchModel=function(){return null},t._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},t._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},t._applyMeshMaterials=function(t){for(var e=this._render.sharedMaterials,i=t.materials,n=0,r=i.length;n<r;n++)e[n]||(e[n]=i[n]);this._render.sharedMaterials=e},t.cloneTo=function(t){console.log("Terrain Chunk can't clone")},t.destroy=function(t){void 0===t&&(t=!0),this.destroyed||(e.prototype.destroy.call(this,t),this._geometryFilter._destroy())},_(0,t,"terrainFilter",function(){return this._geometryFilter}),_(0,t,"terrainRender",function(){return this._render}),l.load=function(t){return S.loader.create(t,null,null,l,null,1,!1)},l}(_n);!function(t){function y(t,e,i){this._minX=NaN,this._minZ=NaN,this._cellSize=null,this._heightMap=null,y.__super.call(this,t,i),this._heightMap=e,this._cellSize=new Le}m(y,"laya.d3.core.MeshTerrainSprite3D",gn);var e=y.prototype;e._disableRotation=function(){var t=this.transform.rotation;t.elements[0]=0,t.elements[1]=0,t.elements[2]=0,t.elements[3]=1,this.transform.rotation=t},e._getScaleX=function(){var t=this.transform.worldMatrix.elements,e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)},e._getScaleZ=function(){var t=this.transform.worldMatrix.elements,e=t[8],i=t[9],n=t[10];return Math.sqrt(e*e+i*i+n*n)},e._initCreateFromMesh=function(t,e){this._heightMap=V.creatFromMesh(this.meshFilter.sharedMesh,t,e,this._cellSize);var i=this.meshFilter.sharedMesh.boundingBox,n=i.min;i.max;this._minX=n.x,this._minZ=n.z},e._initCreateFromMeshHeightMap=function(t,e,i){var n=this,r=this.meshFilter.sharedMesh.boundingBox;t.loaded?(this._heightMap=V.createFromImage(t,e,i),this._computeCellSize(r)):t.once("loaded",null,function(){n._heightMap=V.createFromImage(t,e,i),n._computeCellSize(r)});var a=r.min;r.max;this._minX=a.x,this._minZ=a.z},e._computeCellSize=function(t){var e=t.min,i=t.max,n=e.x,r=e.z,a=i.x-n,s=i.z-r;this._cellSize.elements[0]=a/(this._heightMap.width-1),this._cellSize.elements[1]=s/(this._heightMap.height-1)},e._update=function(t){this._disableRotation(),laya.d3.core.RenderableSprite3D.prototype._update.call(this,t)},e.getHeight=function(t,e){y._tempVector3.elements[0]=t,y._tempVector3.elements[1]=0,y._tempVector3.elements[2]=e,this._disableRotation();var i=this.transform.worldMatrix;i.invert(y._tempMatrix4x4),Oe.transformCoordinate(y._tempVector3,y._tempMatrix4x4,y._tempVector3),t=y._tempVector3.elements[0],e=y._tempVector3.elements[2];var n=(t-this._minX)/this._cellSize.x,r=(e-this._minZ)/this._cellSize.y,a=Math.floor(r),s=Math.floor(n),o=n-s,l=r-a,h=i.elements,u=h[4],c=h[5],_=h[6],d=Math.sqrt(u*u+c*c+_*_),f=h[13],p=this._heightMap.getHeight(a,s+1),m=this._heightMap.getHeight(a+1,s);if(isNaN(p)||isNaN(m))return NaN;if(o+l<=1){var g=this._heightMap.getHeight(a,s);return isNaN(g)?NaN:(g+o*(p-g)+l*(m-g))*d+f}var v=this._heightMap.getHeight(a+1,s+1);return isNaN(v)?NaN:(v+(1-o)*(m-v)+(1-l)*(p-v))*d+f},_(0,e,"minX",function(){var t=this.transform.worldMatrix.elements;return this._minX*this._getScaleX()+t[12]}),_(0,e,"width",function(){return(this._heightMap.width-1)*this._cellSize.x*this._getScaleX()}),_(0,e,"minZ",function(){var t=this.transform.worldMatrix.elements;return this._minZ*this._getScaleZ()+t[14]}),_(0,e,"depth",function(){return(this._heightMap.height-1)*this._cellSize.y*this._getScaleZ()}),y.createFromMesh=function(t,e,i,n){var r=new y(t,null,n);return t.loaded?r._initCreateFromMesh(e,i):t.once("loaded",r,r._initCreateFromMesh,[e,i]),r},y.createFromMeshAndHeightMap=function(t,e,i,n,r){var a=new y(t,null,r);return t.loaded?a._initCreateFromMeshHeightMap(e,i,n):t.once("loaded",a,a._initCreateFromMeshHeightMap,[e,i,n]),a},c(y,["_tempVector3",function(){return this._tempVector3=new Oe},"_tempMatrix4x4",function(){return this._tempMatrix4x4=new De}])}()}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}),function(r,t,a){a.un,a.uns;var n=a.static,s=a.class,o=a.getset,l=(a.__newvec,laya.webgl.canvas.BlendMode),c=(laya.events.Event,laya.resource.HTMLCanvas),h=laya.utils.Handler,u=laya.webgl.utils.IndexBuffer2D,_=(laya.net.Loader,laya.maths.MathUtil),d=laya.maths.Matrix,f=laya.renders.Render,i=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.shader.Shader),e=laya.display.Sprite,p=laya.utils.Stat,m=laya.resource.Texture,g=laya.utils.Utils,v=laya.webgl.shader.d2.value.Value2D,y=laya.webgl.utils.VertexBuffer2D,x=laya.webgl.WebGL,E=(laya.webgl.WebGLContext,function(){function t(){this._frameTime=0,this._emissionRate=60,this._emissionTime=0,this.minEmissionTime=1/60,this._particleTemplate=null}s(t,"laya.particle.emitter.EmitterBase");var e=t.prototype;return e.start=function(t){void 0===t&&(t=2147483647),0!=this._emissionRate&&(this._emissionTime=t)},e.stop=function(){this._emissionTime=0},e.clear=function(){this._emissionTime=0},e.emit=function(){},e.advanceTime=function(t){if(void 0===t&&(t=1),this._emissionTime-=t,!(this._emissionTime<0||(this._frameTime+=t,this._frameTime<this.minEmissionTime)))for(;this._frameTime>this.minEmissionTime;)this._frameTime-=this.minEmissionTime,this.emit()},o(0,e,"particleTemplate",null,function(t){this._particleTemplate=t}),o(0,e,"emissionRate",function(){return this._emissionRate},function(t){t<=0||0<(this._emissionRate=t)&&(this.minEmissionTime=1/t)}),t}()),T=function(){function c(){this.position=null,this.velocity=null,this.startColor=null,this.endColor=null,this.sizeRotation=null,this.radius=null,this.radian=null,this.durationAddScale=NaN,this.time=NaN}return s(c,"laya.particle.ParticleData"),c.Create=function(t,e,i,n){var r=new c;r.position=e,_.scaleVector3(i,t.emitterVelocitySensitivity,c._tempVelocity);var a=_.lerp(t.minHorizontalVelocity,t.maxHorizontalVelocity,Math.random()),s=Math.random()*Math.PI*2;c._tempVelocity[0]+=a*Math.cos(s),c._tempVelocity[2]+=a*Math.sin(s),c._tempVelocity[1]+=_.lerp(t.minVerticalVelocity,t.maxVerticalVelocity,Math.random()),r.velocity=c._tempVelocity,r.startColor=c._tempStartColor,r.endColor=c._tempEndColor;var o=0;if(t.disableColor)for(o=0;o<4;o++)r.startColor[o]=1,r.endColor[o]=1;else if(t.colorComponentInter)for(o=0;o<4;o++)r.startColor[o]=_.lerp(t.minStartColor[o],t.maxStartColor[o],Math.random()),r.endColor[o]=_.lerp(t.minEndColor[o],t.maxEndColor[o],Math.random());else _.lerpVector4(t.minStartColor,t.maxStartColor,Math.random(),r.startColor),_.lerpVector4(t.minEndColor,t.maxEndColor,Math.random(),r.endColor);r.sizeRotation=c._tempSizeRotation;var l=Math.random();r.sizeRotation[0]=_.lerp(t.minStartSize,t.maxStartSize,l),r.sizeRotation[1]=_.lerp(t.minEndSize,t.maxEndSize,l),r.sizeRotation[2]=_.lerp(t.minRotateSpeed,t.maxRotateSpeed,Math.random()),r.radius=c._tempRadius;var h=Math.random();r.radius[0]=_.lerp(t.minStartRadius,t.maxStartRadius,h),r.radius[1]=_.lerp(t.minEndRadius,t.maxEndRadius,h),r.radian=c._tempRadian,r.radian[0]=_.lerp(t.minHorizontalStartRadian,t.maxHorizontalStartRadian,Math.random()),r.radian[1]=_.lerp(t.minVerticalStartRadian,t.maxVerticalStartRadian,Math.random());var u=t.useEndRadian;return r.radian[2]=u?_.lerp(t.minHorizontalEndRadian,t.maxHorizontalEndRadian,Math.random()):r.radian[0],r.radian[3]=u?_.lerp(t.minVerticalEndRadian,t.maxVerticalEndRadian,Math.random()):r.radian[1],r.durationAddScale=t.ageAddScale*Math.random(),r.time=n,r},n(c,["_tempVelocity",function(){return this._tempVelocity=new Float32Array(3)},"_tempStartColor",function(){return this._tempStartColor=new Float32Array(4)},"_tempEndColor",function(){return this._tempEndColor=new Float32Array(4)},"_tempSizeRotation",function(){return this._tempSizeRotation=new Float32Array(3)},"_tempRadius",function(){return this._tempRadius=new Float32Array(2)},"_tempRadian",function(){return this._tempRadian=new Float32Array(4)}]),c}(),S=(function(){function t(t,e,i){this._templet=null,this._timeBetweenParticles=NaN,this._previousPosition=null,this._timeLeftOver=0,this._tempVelocity=new Float32Array([0,0,0]),this._tempPosition=new Float32Array([0,0,0]),this._templet=t,this._timeBetweenParticles=1/e,this._previousPosition=i}s(t,"laya.particle.ParticleEmitter"),t.prototype.update=function(t,e){if(0<(t/=1e3)){_.subtractVector3(e,this._previousPosition,this._tempVelocity),_.scaleVector3(this._tempVelocity,1/t,this._tempVelocity);for(var i=this._timeLeftOver+t,n=-this._timeLeftOver;i>this._timeBetweenParticles;)n+=this._timeBetweenParticles,i-=this._timeBetweenParticles,_.lerpVector3(this._previousPosition,e,n/t,this._tempPosition),this._templet.addParticleArray(this._tempPosition,this._tempVelocity);this._timeLeftOver=i}this._previousPosition[0]=e[0],this._previousPosition[1]=e[1],this._previousPosition[2]=e[2]}}(),function(){function i(){this.textureName=null,this.textureCount=1,this.maxPartices=100,this.duration=1,this.ageAddScale=0,this.emitterVelocitySensitivity=1,this.minStartSize=100,this.maxStartSize=100,this.minEndSize=100,this.maxEndSize=100,this.minHorizontalVelocity=0,this.maxHorizontalVelocity=0,this.minVerticalVelocity=0,this.maxVerticalVelocity=0,this.endVelocity=1,this.minRotateSpeed=0,this.maxRotateSpeed=0,this.minStartRadius=0,this.maxStartRadius=0,this.minEndRadius=0,this.maxEndRadius=0,this.minHorizontalStartRadian=0,this.maxHorizontalStartRadian=0,this.minVerticalStartRadian=0,this.maxVerticalStartRadian=0,this.useEndRadian=!0,this.minHorizontalEndRadian=0,this.maxHorizontalEndRadian=0,this.minVerticalEndRadian=0,this.maxVerticalEndRadian=0,this.colorComponentInter=!1,this.disableColor=!1,this.blendState=0,this.emitterType="null",this.emissionRate=0,this.sphereEmitterRadius=1,this.sphereEmitterVelocity=0,this.sphereEmitterVelocityAddVariance=0,this.ringEmitterRadius=30,this.ringEmitterVelocity=0,this.ringEmitterVelocityAddVariance=0,this.ringEmitterUp=2,this.gravity=new Float32Array([0,0,0]),this.minStartColor=new Float32Array([1,1,1,1]),this.maxStartColor=new Float32Array([1,1,1,1]),this.minEndColor=new Float32Array([1,1,1,1]),this.maxEndColor=new Float32Array([1,1,1,1]),this.pointEmitterPosition=new Float32Array([0,0,0]),this.pointEmitterPositionVariance=new Float32Array([0,0,0]),this.pointEmitterVelocity=new Float32Array([0,0,0]),this.pointEmitterVelocityAddVariance=new Float32Array([0,0,0]),this.boxEmitterCenterPosition=new Float32Array([0,0,0]),this.boxEmitterSize=new Float32Array([0,0,0]),this.boxEmitterVelocity=new Float32Array([0,0,0]),this.boxEmitterVelocityAddVariance=new Float32Array([0,0,0]),this.sphereEmitterCenterPosition=new Float32Array([0,0,0]),this.ringEmitterCenterPosition=new Float32Array([0,0,0]),this.positionVariance=new Float32Array([0,0,0])}return s(i,"laya.particle.ParticleSetting"),i.checkSetting=function(t){var e;for(e in i._defaultSetting)t.hasOwnProperty(e)||(t[e]=i._defaultSetting[e])},n(i,["_defaultSetting",function(){return this._defaultSetting=new i}]),i}()),w=function(){function t(){this.settings=null,this.texture=null}return s(t,"laya.particle.ParticleTemplateBase"),t.prototype.addParticleArray=function(t,e){},t}(),M=function(){function t(){this.u_Duration=NaN,this.u_EndVelocity=NaN,this.u_Gravity=null,this.a_Position=null,this.a_Velocity=null,this.a_StartColor=null,this.a_EndColor=null,this.a_SizeRotation=null,this.a_Radius=null,this.a_Radian=null,this.a_AgeAddScale=NaN,this.gl_Position=null,this.v_Color=null,this.oSize=NaN,this._color=new Float32Array(4),this._position=new Float32Array(3)}s(t,"laya.particle.particleUtils.CanvasShader");var e=t.prototype;return e.getLen=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])},e.ComputeParticlePosition=function(t,e,i,n){this._position[0]=t[0],this._position[1]=t[1],this._position[2]=t[2];var r,a=this.getLen(e),s=a*n+(a*this.u_EndVelocity-a)*n*n/2;r=this.getLen(e);var o=0;for(3,o=0;o<3;o++)this._position[o]=this._position[o]+e[o]/r*s*this.u_Duration,this._position[o]+=this.u_Gravity[o]*i*n;var l=_.lerp(this.a_Radius[0],this.a_Radius[1],n),h=_.lerp(this.a_Radian[0],this.a_Radian[2],n),u=_.lerp(this.a_Radian[1],this.a_Radian[3],n),c=Math.cos(u)*l;return this._position[1]+=Math.sin(u)*l,this._position[0]+=Math.cos(h)*c,this._position[2]+=Math.sin(h)*c,new Float32Array([this._position[0],this._position[1],0,1])},e.ComputeParticleSize=function(t,e,i){return _.lerp(t,e,i)},e.ComputeParticleRotation=function(t,e){return t*e},e.ComputeParticleColor=function(t,e,i){var n=this._color;return _.lerpVector4(t,e,i,n),n[3]=n[3]*i*(1-i)*(1-i)*6.7,n},e.clamp=function(t,e,i){return t<e?e:i<t?i:t},e.getData=function(t){t*=1+this.a_AgeAddScale;var e=this.clamp(t/this.u_Duration,0,1);this.gl_Position=this.ComputeParticlePosition(this.a_Position,this.a_Velocity,t,e);var i=this.ComputeParticleSize(this.a_SizeRotation[0],this.a_SizeRotation[1],e),n=this.ComputeParticleRotation(this.a_SizeRotation[2],t);this.v_Color=this.ComputeParticleColor(this.a_StartColor,this.a_EndColor,e);var r,a=new d;r=i/this.oSize*2,a.scale(r,r),a.rotate(n),a.setTranslate(this.gl_Position[0],-this.gl_Position[1]);var s;return s=this.v_Color[3],[this.v_Color,s,a,this.v_Color[0]*s,this.v_Color[1]*s,this.v_Color[2]*s]},t}(),D=function(){function t(){this.maxIndex=0,this.cmds=null,this.id=0}return s(t,"laya.particle.particleUtils.CMDParticle"),t.prototype.setCmds=function(t){this.cmds=t,this.maxIndex=t.length-1},t}(),I=function(){function e(){}return s(e,"laya.particle.particleUtils.PicTool"),e.getCanvasPic=function(t,e){t=t.bitmap;var i=new c("2D"),n=i.getContext("2d");i.size(t.width,t.height);var r=e>>16&255,a=e>>8&255,s=255&e;if(f.isConchApp&&n.setFilter(r/255,a/255,s/255,0),n.drawImage(t.source,0,0),!f.isConchApp){for(var o=n.getImageData(0,0,i.width,i.height),l=o.data,h=0,u=l.length;h<u;h+=4)0!=l[h+3]&&(l[h]*=r/255,l[h+1]*=a/255,l[h+2]*=s/255);n.putImageData(o,0,0)}return i},e.getRGBPic=function(t){return[new m(e.getCanvasPic(t,16711680)),new m(e.getCanvasPic(t,65280)),new m(e.getCanvasPic(t,255))]},e}(),b=function(t){function e(t){this.setting=null,this._posRange=null,this._canvasTemplate=null,this._emitFun=null,e.__super.call(this),this.template=t}s(e,"laya.particle.emitter.Emitter2D",t);var i=e.prototype;return i.emit=function(){t.prototype.emit.call(this),null!=this._emitFun&&this._emitFun()},i.getRandom=function(t){return(2*Math.random()-1)*t},i.webGLEmit=function(){var t=new Float32Array(3);t[0]=this.getRandom(this._posRange[0]),t[1]=this.getRandom(this._posRange[1]),t[2]=this.getRandom(this._posRange[2]);var e=new Float32Array(3);e[0]=0,e[1]=0,e[2]=0,this._particleTemplate.addParticleArray(t,e)},i.canvasEmit=function(){var t=new Float32Array(3);t[0]=this.getRandom(this._posRange[0]),t[1]=this.getRandom(this._posRange[1]),t[2]=this.getRandom(this._posRange[2]);var e=new Float32Array(3);e[0]=0,e[1]=0,e[2]=0,this._particleTemplate.addParticleArray(t,e)},o(0,i,"template",function(){return this._particleTemplate},function(t){(this._particleTemplate=t)||(this._emitFun=null,this.setting=null,this._posRange=null),this.setting=t.settings,this._posRange=this.setting.positionVariance,this._particleTemplate instanceof laya.particle.ParticleTemplate2D?this._emitFun=this.webGLEmit:this._particleTemplate instanceof laya.particle.ParticleTemplateCanvas&&(this._canvasTemplate=t,this._emitFun=this.canvasEmit)}),e}(E),C=function(t){function e(t){this._vertices=null,this._vertexBuffer=null,this._indexBuffer=null,this._floatCountPerVertex=29,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._currentTime=0,this._drawCounter=0,e.__super.call(this),this.settings=t}s(e,"laya.particle.ParticleTemplateWebGL",w);var i=e.prototype;return i.initialize=function(){this._vertices=new Float32Array(this.settings.maxPartices*this._floatCountPerVertex*4);for(var t=0,e=0;e<this.settings.maxPartices;e++){var i=Math.random(),n=this.settings.textureCount?1/this.settings.textureCount:1,r=NaN;for(r=0;r<this.settings.textureCount&&!(i<r+n);r+=n);t=e*this._floatCountPerVertex*4,this._vertices[t+0*this._floatCountPerVertex+0]=-1,this._vertices[t+0*this._floatCountPerVertex+1]=-1,this._vertices[t+0*this._floatCountPerVertex+2]=0,this._vertices[t+0*this._floatCountPerVertex+3]=r,this._vertices[t+1*this._floatCountPerVertex+0]=1,this._vertices[t+1*this._floatCountPerVertex+1]=-1,this._vertices[t+1*this._floatCountPerVertex+2]=1,this._vertices[t+1*this._floatCountPerVertex+3]=r,this._vertices[t+2*this._floatCountPerVertex+0]=1,this._vertices[t+2*this._floatCountPerVertex+1]=1,this._vertices[t+2*this._floatCountPerVertex+2]=1,this._vertices[t+2*this._floatCountPerVertex+3]=r+n,this._vertices[t+3*this._floatCountPerVertex+0]=-1,this._vertices[t+3*this._floatCountPerVertex+1]=1,this._vertices[t+3*this._floatCountPerVertex+2]=0,this._vertices[t+3*this._floatCountPerVertex+3]=r+n}},i.loadContent=function(){},i.update=function(t){this._currentTime+=t/1e3,this.retireActiveParticles(),this.freeRetiredParticles(),this._firstActiveElement==this._firstFreeElement&&(this._currentTime=0),this._firstRetiredElement==this._firstActiveElement&&(this._drawCounter=0)},i.retireActiveParticles=function(){for(var t=this.settings.duration;this._firstActiveElement!=this._firstNewElement;){var e=this._firstActiveElement*this._floatCountPerVertex*4,i=e+28,n=this._currentTime-this._vertices[i];if((n*=1+this._vertices[e+27])+1e-4<t)break;this._vertices[i]=this._drawCounter,this._firstActiveElement++,this._firstActiveElement>=this.settings.maxPartices&&(this._firstActiveElement=0)}},i.freeRetiredParticles=function(){for(;this._firstRetiredElement!=this._firstActiveElement;){if(this._drawCounter-this._vertices[this._firstRetiredElement*this._floatCountPerVertex*4+28]<3)break;this._firstRetiredElement++,this._firstRetiredElement>=this.settings.maxPartices&&(this._firstRetiredElement=0)}},i.addNewParticlesToVertexBuffer=function(){},i.addParticleArray=function(t,e){var i=this._firstFreeElement+1;if(i>=this.settings.maxPartices&&(i=0),i!==this._firstRetiredElement){for(var n=T.Create(this.settings,t,e,this._currentTime),r=this._firstFreeElement*this._floatCountPerVertex*4,a=0;a<4;a++){var s=0,o=0;for(s=0,o=4;s<3;s++)this._vertices[r+a*this._floatCountPerVertex+o+s]=n.position[s];for(s=0,o=7;s<3;s++)this._vertices[r+a*this._floatCountPerVertex+o+s]=n.velocity[s];for(s=0,o=10;s<4;s++)this._vertices[r+a*this._floatCountPerVertex+o+s]=n.startColor[s];for(s=0,o=14;s<4;s++)this._vertices[r+a*this._floatCountPerVertex+o+s]=n.endColor[s];for(s=0,o=18;s<3;s++)this._vertices[r+a*this._floatCountPerVertex+o+s]=n.sizeRotation[s];for(s=0,o=21;s<2;s++)this._vertices[r+a*this._floatCountPerVertex+o+s]=n.radius[s];for(s=0,o=23;s<4;s++)this._vertices[r+a*this._floatCountPerVertex+o+s]=n.radian[s];this._vertices[r+a*this._floatCountPerVertex+27]=n.durationAddScale,this._vertices[r+a*this._floatCountPerVertex+28]=n.time}this._firstFreeElement=i}},e}(),A=function(t){function e(t){this._ready=!1,this.textureList=[],this.particleList=[],this.pX=0,this.pY=0,this.activeParticles=[],this.deadParticles=[],this.iList=[],this._maxNumParticles=0,this.textureWidth=NaN,this.dTextureWidth=NaN,this.colorChange=!0,this.step=1/60,this.canvasShader=new M,e.__super.call(this),this.settings=t,this._maxNumParticles=t.maxPartices,this.texture=new m,this.texture.on("loaded",this,this._textureLoaded),this.texture.load(t.textureName)}s(e,"laya.particle.ParticleTemplateCanvas",w);var i=e.prototype;return i._textureLoaded=function(t){this.setTexture(this.texture),this._ready=!0},i.clear=function(t){void 0===t&&(t=!0),this.deadParticles.length=0,this.activeParticles.length=0,this.textureList.length=0},i.setTexture=function(t){this.texture=t,this.textureWidth=t.width,this.dTextureWidth=1/this.textureWidth,this.pX=.5*-t.width,this.pY=.5*-t.height,this.textureList=e.changeTexture(t,this.textureList),this.particleList.length=0,this.deadParticles.length=0,this.activeParticles.length=0},i._createAParticleData=function(t,e){var i;this.canvasShader.u_EndVelocity=this.settings.endVelocity,this.canvasShader.u_Gravity=this.settings.gravity,this.canvasShader.u_Duration=this.settings.duration,i=T.Create(this.settings,t,e,0),this.canvasShader.a_Position=i.position,this.canvasShader.a_Velocity=i.velocity,this.canvasShader.a_StartColor=i.startColor,this.canvasShader.a_EndColor=i.endColor,this.canvasShader.a_SizeRotation=i.sizeRotation,this.canvasShader.a_Radius=i.radius,this.canvasShader.a_Radian=i.radian,this.canvasShader.a_AgeAddScale=i.durationAddScale,this.canvasShader.oSize=this.textureWidth;var n=new D,r=0,a=this.settings.duration/(1+i.durationAddScale),s=[];for(r=0;r<a;r+=this.step)s.push(this.canvasShader.getData(r));return n.id=this.particleList.length,this.particleList.push(n),n.setCmds(s),n},i.addParticleArray=function(t,e){var i;this._ready&&(this.particleList.length<this._maxNumParticles?(i=this._createAParticleData(t,e),this.iList[i.id]=0,this.activeParticles.push(i)):0<this.deadParticles.length&&(i=this.deadParticles.pop(),this.iList[i.id]=0,this.activeParticles.push(i)))},i.advanceTime=function(t){if(void 0===t&&(t=1),this._ready){var e,i=this.activeParticles,n=this.deadParticles,r=0,a=i.length,s=0,o=this.iList;for(r=a-1;-1<r;r--)(s=o[(e=i[r]).id])>=e.maxIndex?(s=0,i.splice(r,1),n.push(e)):s+=1,o[e.id]=s}},i.render=function(t,e,i){this._ready&&(this.activeParticles.length<1||this.textureList.length<2||(this.settings.disableColor?this.noColorRender(t,e,i):this.canvasRender(t,e,i)))},i.noColorRender=function(t,e,i){var n,r,a,s=this.activeParticles,o=0,l=s.length,h=NaN,u=this.pX,c=this.pY,_=2*-u,d=2*-c,f=0,p=(this.textureList,this.iList);for(t.translate(e,i),a=t.ctx.globalAlpha,o=0;o<l;o++)f=p[(n=s[o]).id],(r=n.cmds[f])&&((h=r[1])<=.01||(t.setAlpha(a*h),t.drawTextureWithTransform(this.texture,u,c,_,d,r[2],1)));t.setAlpha(a),t.translate(-e,-i)},i.canvasRender=function(t,e,i){var n,r,a,s,o=this.activeParticles,l=0,h=o.length,u=this.pX,c=this.pY,_=2*-u,d=2*-c,f=0,p=this.textureList,m=this.iList;for(t.translate(e,i),a=t.ctx.globalAlpha,s=t.ctx.globalCompositeOperation,t.blendMode("lighter"),l=0;l<h;l++)f=m[(n=o[l]).id],(r=n.cmds[f])&&(r[1]<=.01||(t.save(),t.transformByMatrix(r[2]),.01<r[3]&&(t.setAlpha(a*r[3]),t.drawTexture(p[0],u,c,_,d)),.01<r[4]&&(t.setAlpha(a*r[4]),t.drawTexture(p[1],u,c,_,d)),.01<r[5]&&(t.setAlpha(a*r[5]),t.drawTexture(p[2],u,c,_,d)),t.restore()));t.setAlpha(a),t.translate(-e,-i),t.blendMode(s)},e.changeTexture=function(t,e,i){return e||(e=[]),e.length=0,i&&i.disableColor?e.push(t,t,t):g.copyArray(e,I.getRGBPic(t)),e},e}(),R=function(i){function n(t){this._vertexBuffer2D=null,this._indexBuffer2D=null,this.x=0,this.y=0,this._blendFn=null,this._startTime=0,this.sv=new L,n.__super.call(this,t);var e=this;a.loader.load(this.settings.textureName,h.create(null,function(t){t.bitmap.enableMerageInAtlas=!1,e.texture=t})),this.sv.u_Duration=this.settings.duration,this.sv.u_Gravity=this.settings.gravity,this.sv.u_EndVelocity=this.settings.endVelocity,this._blendFn=l.fns[t.blendState],this.initialize(),this._vertexBuffer=this._vertexBuffer2D=y.create(-1,35048),this._indexBuffer=this._indexBuffer2D=u.create(35044),this.loadContent()}s(n,"laya.particle.ParticleTemplate2D",i);var t=n.prototype;return a.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.getRenderType=function(){return-111},t.releaseRender=function(){},t.addParticleArray=function(t,e){t[0]+=this.x,t[1]+=this.y,i.prototype.addParticleArray.call(this,t,e)},t.loadContent=function(){for(var t=new Uint16Array(6*this.settings.maxPartices),e=0;e<this.settings.maxPartices;e++)t[6*e+0]=4*e+0,t[6*e+1]=4*e+1,t[6*e+2]=4*e+2,t[6*e+3]=4*e+0,t[6*e+4]=4*e+2,t[6*e+5]=4*e+3;this._indexBuffer2D.clear(),this._indexBuffer2D.append(t),this._indexBuffer2D.upload()},t.addNewParticlesToVertexBuffer=function(){this._vertexBuffer2D.clear(),this._vertexBuffer2D.append(this._vertices);var t=0;this._firstNewElement<this._firstFreeElement?(t=4*this._firstNewElement*this._floatCountPerVertex*4,this._vertexBuffer2D.subUpload(t,t,t+4*(this._firstFreeElement-this._firstNewElement)*this._floatCountPerVertex*4)):(t=4*this._firstNewElement*this._floatCountPerVertex*4,this._vertexBuffer2D.subUpload(t,t,t+4*(this.settings.maxPartices-this._firstNewElement)*this._floatCountPerVertex*4),0<this._firstFreeElement&&(this._vertexBuffer2D.setNeedUpload(),this._vertexBuffer2D.subUpload(0,0,4*this._firstFreeElement*this._floatCountPerVertex*4))),this._firstNewElement=this._firstFreeElement},t.renderSubmit=function(){if(this.texture&&this.texture.loaded){if(this.update(a.timer.delta),this.sv.u_CurrentTime=this._currentTime,this._firstNewElement!=this._firstFreeElement&&this.addNewParticlesToVertexBuffer(),this.blend(),this._firstActiveElement!=this._firstFreeElement){x.mainContext;this._vertexBuffer2D.bind(this._indexBuffer2D),this.sv.u_texture=this.texture.source,this.sv.upload(),this._firstActiveElement<this._firstFreeElement?x.mainContext.drawElements(4,6*(this._firstFreeElement-this._firstActiveElement),5123,6*this._firstActiveElement*2):(x.mainContext.drawElements(4,6*(this.settings.maxPartices-this._firstActiveElement),5123,6*this._firstActiveElement*2),0<this._firstFreeElement&&x.mainContext.drawElements(4,6*this._firstFreeElement,5123,0)),p.drawCall++}this._drawCounter++}return 1},t.blend=function(){if(l.activeBlendFunction!==this._blendFn){var t=x.mainContext;t.enable(3042),this._blendFn(t),l.activeBlendFunction=this._blendFn}},t.dispose=function(){this._vertexBuffer2D.dispose(),this._indexBuffer2D.dispose()},n.activeBlendType=-1,n}(C),L=function(t){function e(){this.a_CornerTextureCoordinate=[4,5126,!1,116,0],this.a_Position=[3,5126,!1,116,16],this.a_Velocity=[3,5126,!1,116,28],this.a_StartColor=[4,5126,!1,116,40],this.a_EndColor=[4,5126,!1,116,56],this.a_SizeRotation=[3,5126,!1,116,72],this.a_Radius=[2,5126,!1,116,84],this.a_Radian=[4,5126,!1,116,92],this.a_AgeAddScale=[1,5126,!1,116,108],this.a_Time=[1,5126,!1,116,112],this.u_CurrentTime=NaN,this.u_Duration=NaN,this.u_Gravity=null,this.u_EndVelocity=NaN,this.u_texture=null,e.__super.call(this,0,0)}return s(e,"laya.particle.shader.value.ParticleShaderValue",v),e.prototype.upload=function(){this.refresh(),e.pShader.upload(this)},n(e,["pShader",function(){return this.pShader=new O}]),e}(),O=(function(e){function i(t){this._matrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._particleTemplate=null,this._canvasTemplate=null,this._emitter=null,this.autoPlay=!0,i.__super.call(this),t&&this.setParticleSetting(t)}s(i,"laya.particle.Particle2D",e);var t=i.prototype;t.load=function(t){a.loader.load(t,h.create(this,this.setParticleSetting),null,"json")},t.setParticleSetting=function(e){var i=this;if(!e)return this.stop();if(S.checkSetting(e),r.ConchParticleTemplate2D&&!f.isWebGL||(this.customRenderEnable=!0),f.isWebGL)this._particleTemplate=new R(e),this.graphics._saveToCmd(f.context._drawParticle,[this._particleTemplate]);else{if(f.isConchApp&&r.ConchParticleTemplate2D){this._particleTemplate=new ConchParticleTemplate2D;var n=this;return a.loader.load(e.textureName,h.create(null,function(t){n._particleTemplate.texture=t,n._particleTemplate.settings=e,f.isConchNode?n.graphics.drawParticle(n._particleTemplate):n.graphics._saveToCmd(f.context._drawParticle,[i._particleTemplate])})),this._emitter={start:function(){}},this.play=this._particleTemplate.play.bind(this._particleTemplate),this.stop=this._particleTemplate.stop.bind(this._particleTemplate),void(this.autoPlay&&this.play())}this._particleTemplate=this._canvasTemplate=new A(e)}this._emitter?this._emitter.template=this._particleTemplate:this._emitter=new b(this._particleTemplate),this.autoPlay&&(this.emitter.start(),this.play())},t.play=function(){this.timer.frameLoop(1,this,this._loop)},t.stop=function(){this.timer.clear(this,this._loop)},t._loop=function(){this.advanceTime(1/60)},t.advanceTime=function(t){void 0===t&&(t=1),this._canvasTemplate&&this._canvasTemplate.advanceTime(t),this._emitter&&this._emitter.advanceTime(t)},t.customRender=function(t,e,i){f.isWebGL&&(this._matrix4[0]=t.ctx._curMat.a,this._matrix4[1]=t.ctx._curMat.b,this._matrix4[4]=t.ctx._curMat.c,this._matrix4[5]=t.ctx._curMat.d,this._matrix4[12]=t.ctx._curMat.tx,this._matrix4[13]=t.ctx._curMat.ty,this._particleTemplate.sv.u_mmat=this._matrix4);this._canvasTemplate&&this._canvasTemplate.render(t,e,i)},t.destroy=function(t){void 0===t&&(t=!0),this._particleTemplate instanceof laya.particle.ParticleTemplate2D&&this._particleTemplate.dispose(),e.prototype.destroy.call(this,t)},o(0,t,"url",null,function(t){this.load(t)}),o(0,t,"emitter",function(){return this._emitter})}(e),function(t){function e(){e.__super.call(this,e.vs,e.ps,"ParticleShader")}return s(e,"laya.particle.shader.ParticleShader",i),n(e,["vs",function(){return this.vs="attribute vec4 a_CornerTextureCoordinate;\nattribute vec3 a_Position;\nattribute vec3 a_Velocity;\nattribute vec4 a_StartColor;\nattribute vec4 a_EndColor;\nattribute vec3 a_SizeRotation;\nattribute vec2 a_Radius;\nattribute vec4 a_Radian;\nattribute float a_AgeAddScale;\nattribute float a_Time;\n\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\n\nuniform float u_CurrentTime;\nuniform float u_Duration;\nuniform float u_EndVelocity;\nuniform vec3 u_Gravity;\n\n#ifdef PARTICLE3D\n uniform mat4 u_WorldMat;\n uniform mat4 u_View;\n uniform mat4 u_Projection;\n uniform vec2 u_ViewportScale;\n#else\n uniform vec2 size;\n uniform mat4 mmat;\n uniform mat4 u_mmat;\n#endif\n\nvec4 ComputeParticlePosition(in vec3 position, in vec3 velocity,in float age,in float normalizedAge)\n{\n\n   float startVelocity = length(velocity);//起始标量速度\n   float endVelocity = startVelocity * u_EndVelocity;//结束标量速度\n\n   float velocityIntegral = startVelocity * normalizedAge +(endVelocity - startVelocity) * normalizedAge *normalizedAge/2.0;//计算当前速度的标量（单位空间），vt=v0*t+(1/2)*a*(t^2)\n   \n   vec3 addPosition = normalize(velocity) * velocityIntegral * u_Duration;//计算受自身速度影响的位置，转换标量到矢量    \n   addPosition += u_Gravity * age * normalizedAge;//计算受重力影响的位置\n   \n   float radius=mix(a_Radius.x, a_Radius.y, normalizedAge); //计算粒子受半径和角度影响（无需计算角度和半径时，可用宏定义优化屏蔽此计算）\n   float radianHorizontal =mix(a_Radian.x,a_Radian.z,normalizedAge);\n   float radianVertical =mix(a_Radian.y,a_Radian.w,normalizedAge);\n   \n   float r =cos(radianVertical)* radius;\n   addPosition.y += sin(radianVertical) * radius;\n\t\n   addPosition.x += cos(radianHorizontal) *r;\n   addPosition.z += sin(radianHorizontal) *r;\n  \n   #ifdef PARTICLE3D\n   position+=addPosition;\n    return  u_Projection*u_View*u_WorldMat*(vec4(position, 1.0));\n   #else\n   addPosition.y=-addPosition.y;//2D粒子位置更新需要取负，2D粒子坐标系Y轴正向朝上\n   position+=addPosition;\n    return  vec4(position,1.0);\n   #endif\n}\n\nfloat ComputeParticleSize(in float startSize,in float endSize, in float normalizedAge)\n{    \n    float size = mix(startSize, endSize, normalizedAge);\n    \n\t#ifdef PARTICLE3D\n    //Project the size into screen coordinates.\n     return size * u_Projection[1][1];\n\t#else\n\t return size;\n\t#endif\n}\n\nmat2 ComputeParticleRotation(in float rot,in float age)\n{    \n    float rotation =rot * age;\n    //计算2x2旋转矩阵.\n    float c = cos(rotation);\n    float s = sin(rotation);\n    return mat2(c, -s, s, c);\n}\n\nvec4 ComputeParticleColor(in vec4 startColor,in vec4 endColor,in float normalizedAge)\n{\n\tvec4 color=mix(startColor,endColor,normalizedAge);\n    //硬编码设置，使粒子淡入很快，淡出很慢,6.7的缩放因子把置归一在0到1之间，可以谷歌x*(1-x)*(1-x)*6.7的制图表\n    color.a *= normalizedAge * (1.0-normalizedAge) * (1.0-normalizedAge) * 6.7;\n   \n    return color;\n}\n\nvoid main()\n{\n   float age = u_CurrentTime - a_Time;\n   age *= 1.0 + a_AgeAddScale;\n   float normalizedAge = clamp(age / u_Duration,0.0,1.0);\n   gl_Position = ComputeParticlePosition(a_Position, a_Velocity, age, normalizedAge);//计算粒子位置\n   float pSize = ComputeParticleSize(a_SizeRotation.x,a_SizeRotation.y, normalizedAge);\n   mat2 rotation = ComputeParticleRotation(a_SizeRotation.z, age);\n\t\n   #ifdef PARTICLE3D\n\tgl_Position.xy += (rotation*a_CornerTextureCoordinate.xy) * pSize * u_ViewportScale;\n   #else\n    mat4 mat=u_mmat*mmat;\n    gl_Position=vec4((mat*gl_Position).xy,0.0,1.0);\n\tgl_Position.xy += (rotation*a_CornerTextureCoordinate.xy) * pSize*vec2(mat[0][0],mat[1][1]);\n    gl_Position=vec4((gl_Position.x/size.x-0.5)*2.0,(0.5-gl_Position.y/size.y)*2.0,0.0,1.0);\n   #endif\n   \n   v_Color = ComputeParticleColor(a_StartColor,a_EndColor, normalizedAge);\n   v_TextureCoordinate =a_CornerTextureCoordinate.zw;\n}\n\n"},"ps",function(){return this.ps="#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\nuniform sampler2D u_texture;\n\nvoid main()\n{\t\n\tgl_FragColor=texture2D(u_texture,v_TextureCoordinate)*v_Color;\n\tgl_FragColor.xyz *= v_Color.w;\n}"}]),e}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JSZip=t()}}(function(){return function a(s,o,l){function h(i,t){if(!o[i]){if(!s[i]){var e="function"==typeof require&&require;if(!t&&e)return e(i,!0);if(u)return u(i,!0);var n=new Error("Cannot find module '"+i+"'");throw n.code="MODULE_NOT_FOUND",n}var r=o[i]={exports:{}};s[i][0].call(r.exports,function(t){var e=s[i][1][t];return h(e||t)},r,r.exports,a,s,o,l)}return o[i].exports}for(var u="function"==typeof require&&require,t=0;t<l.length;t++)h(l[t]);return h}({1:[function(t,e,i){"use strict";var d=t("./utils"),c=t("./support"),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(t){for(var e,i,n,r,a,s,o,l=[],h=0,u=t.length,c=u,_="string"!==d.getTypeOf(t);h<t.length;)c=u-h,n=_?(e=t[h++],i=h<u?t[h++]:0,h<u?t[h++]:0):(e=t.charCodeAt(h++),i=h<u?t.charCodeAt(h++):0,h<u?t.charCodeAt(h++):0),r=e>>2,a=(3&e)<<4|i>>4,s=1<c?(15&i)<<2|n>>6:64,o=2<c?63&n:64,l.push(f.charAt(r)+f.charAt(a)+f.charAt(s)+f.charAt(o));return l.join("")},i.decode=function(t){var e,i,n,r,a,s,o=0,l=0;if("data:"===t.substr(0,"data:".length))throw new Error("Invalid base64 input, it looks like a data url.");var h,u=3*(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(t.charAt(t.length-1)===f.charAt(64)&&u--,t.charAt(t.length-2)===f.charAt(64)&&u--,u%1!=0)throw new Error("Invalid base64 input, bad content length.");for(h=c.uint8array?new Uint8Array(0|u):new Array(0|u);o<t.length;)e=f.indexOf(t.charAt(o++))<<2|(r=f.indexOf(t.charAt(o++)))>>4,i=(15&r)<<4|(a=f.indexOf(t.charAt(o++)))>>2,n=(3&a)<<6|(s=f.indexOf(t.charAt(o++))),h[l++]=e,64!==a&&(h[l++]=i),64!==s&&(h[l++]=n);return h}},{"./support":30,"./utils":32}],2:[function(t,e,i){"use strict";var n=t("./external"),r=t("./stream/DataWorker"),a=t("./stream/DataLengthProbe"),s=t("./stream/Crc32Probe");a=t("./stream/DataLengthProbe");function o(t,e,i,n,r){this.compressedSize=t,this.uncompressedSize=e,this.crc32=i,this.compression=n,this.compressedContent=r}o.prototype={getContentWorker:function(){var t=new r(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),e=this;return t.on("end",function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),t},getCompressedWorker:function(){return new r(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},o.createWorkerFrom=function(t,e,i){return t.pipe(new s).pipe(new a("uncompressedSize")).pipe(e.compressWorker(i)).pipe(new a("compressedSize")).withStreamInfo("compression",e)},e.exports=o},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,i){"use strict";var n=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(t){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,i){"use strict";var n=t("./utils");var o=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();e.exports=function(t,e){return void 0!==t&&t.length?"string"!==n.getTypeOf(t)?function(t,e,i,n){var r=o,a=n+i;t^=-1;for(var s=n;s<a;s++)t=t>>>8^r[255&(t^e[s])];return-1^t}(0|e,t,t.length,0):function(t,e,i,n){var r=o,a=n+i;t^=-1;for(var s=n;s<a;s++)t=t>>>8^r[255&(t^e.charCodeAt(s))];return-1^t}(0|e,t,t.length,0):0}},{"./utils":32}],5:[function(t,e,i){"use strict";i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,e,i){"use strict";var n=null;n="undefined"!=typeof Promise?Promise:t("lie"),e.exports={Promise:n}},{lie:58}],7:[function(t,e,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,r=t("pako"),a=t("./utils"),s=t("./stream/GenericWorker"),o=n?"uint8array":"array";function l(t,e){s.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}i.magic="\b\0",a.inherits(l,s),l.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(a.transformTo(o,t.data),!1)},l.prototype.flush=function(){s.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},i.compressWorker=function(t){return new l("Deflate",t)},i.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:59}],8:[function(t,e,i){"use strict";var R=t("../utils"),r=t("../stream/GenericWorker"),L=t("../utf8"),O=t("../crc32"),P=t("../signature"),N=function(t,e){var i,n="";for(i=0;i<e;i++)n+=String.fromCharCode(255&t),t>>>=8;return n},a=function(t,e,i,n,r,a){var s,o,l=t.file,h=t.compression,u=a!==L.utf8encode,c=R.transformTo("string",a(l.name)),_=R.transformTo("string",L.utf8encode(l.name)),d=l.comment,f=R.transformTo("string",a(d)),p=R.transformTo("string",L.utf8encode(d)),m=_.length!==l.name.length,g=p.length!==d.length,v="",y="",x="",E=l.dir,T=l.date,S={crc32:0,compressedSize:0,uncompressedSize:0};e&&!i||(S.crc32=t.crc32,S.compressedSize=t.compressedSize,S.uncompressedSize=t.uncompressedSize);var w=0;e&&(w|=8),u||!m&&!g||(w|=2048);var M,D,I,b=0,C=0;E&&(b|=16),"UNIX"===r?(C=798,b|=(M=l.unixPermissions,D=E,(I=M)||(I=D?16893:33204),(65535&I)<<16)):(C=20,b|=63&(l.dosPermissions||0)),s=T.getUTCHours(),s<<=6,s|=T.getUTCMinutes(),s<<=5,s|=T.getUTCSeconds()/2,o=T.getUTCFullYear()-1980,o<<=4,o|=T.getUTCMonth()+1,o<<=5,o|=T.getUTCDate(),m&&(y=N(1,1)+N(O(c),4)+_,v+="up"+N(y.length,2)+y),g&&(x=N(1,1)+N(O(f),4)+p,v+="uc"+N(x.length,2)+x);var A="";return A+="\n\0",A+=N(w,2),A+=h.magic,A+=N(s,2),A+=N(o,2),A+=N(S.crc32,4),A+=N(S.compressedSize,4),A+=N(S.uncompressedSize,4),A+=N(c.length,2),A+=N(v.length,2),{fileRecord:P.LOCAL_FILE_HEADER+A+c+v,dirRecord:P.CENTRAL_FILE_HEADER+N(C,2)+A+N(f.length,2)+"\0\0\0\0"+N(b,4)+N(n,4)+c+v+f}};function n(t,e,i,n){r.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=i,this.encodeFileName=n,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}R.inherits(n,r),n.prototype.push=function(t){var e=t.meta.percent||0,i=this.entriesCount,n=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,r.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:i?(e+100*(i-n-1))/i:100}}))},n.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var i=a(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:i.fileRecord,meta:{percent:0}})}else this.accumulate=!0},n.prototype.closedSource=function(t){this.accumulate=!1;var e,i=this.streamFiles&&!t.file.dir,n=a(t,i,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),i)this.push({data:(e=t,P.DATA_DESCRIPTOR+N(e.crc32,4)+N(e.compressedSize,4)+N(e.uncompressedSize,4)),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},n.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var i,n,r,a,s,o,l=this.bytesWritten-t,h=(i=this.dirRecords.length,n=l,r=t,a=this.zipComment,s=this.encodeFileName,o=R.transformTo("string",s(a)),P.CENTRAL_DIRECTORY_END+"\0\0\0\0"+N(i,2)+N(i,2)+N(n,4)+N(r,4)+N(o.length,2)+o);this.push({data:h,meta:{percent:100}})},n.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},n.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()}),t.on("error",function(t){e.error(t)}),this},n.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},n.prototype.error=function(t){var e=this._sources;if(!r.prototype.error.call(this,t))return!1;for(var i=0;i<e.length;i++)try{e[i].error(t)}catch(t){}return!0},n.prototype.lock=function(){r.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=n},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,i){"use strict";var h=t("../compressions"),n=t("./ZipFileWorker");i.generateWorker=function(t,s,e){var o=new n(s.streamFiles,e,s.platform,s.encodeFileName),l=0;try{t.forEach(function(t,e){l++;var i=function(t,e){var i=t||e,n=h[i];if(!n)throw new Error(i+" is not a valid compression method !");return n}(e.options.compression,s.compression),n=e.options.compressionOptions||s.compressionOptions||{},r=e.dir,a=e.date;e._compressWorker(i,n).withStreamInfo("file",{name:t,dir:r,date:a,comment:e.comment||"",unixPermissions:e.unixPermissions,dosPermissions:e.dosPermissions}).pipe(o)}),o.entriesCount=l}catch(t){o.error(t)}return o}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,i){"use strict";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var t=new n;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(n.prototype=t("./object")).loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.1.5",n.loadAsync=function(t,e){return(new n).loadAsync(t,e)},n.external=t("./external"),e.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,i){"use strict";var n=t("./utils"),r=t("./external"),o=t("./utf8"),l=(n=t("./utils"),t("./zipEntries")),a=t("./stream/Crc32Probe"),h=t("./nodejsUtils");function u(n){return new r.Promise(function(t,e){var i=n.decompressed.getContentWorker().pipe(new a);i.on("error",function(t){e(t)}).on("end",function(){i.streamInfo.crc32!==n.decompressed.crc32?e(new Error("Corrupted zip : CRC32 mismatch")):t()}).resume()})}e.exports=function(t,a){var s=this;return a=n.extend(a||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),h.isNode&&h.isStream(t)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",t,!0,a.optimizedBinaryString,a.base64).then(function(t){var e=new l(a);return e.load(t),e}).then(function(t){var e=[r.Promise.resolve(t)],i=t.files;if(a.checkCRC32)for(var n=0;n<i.length;n++)e.push(u(i[n]));return r.Promise.all(e)}).then(function(t){for(var e=t.shift(),i=e.files,n=0;n<i.length;n++){var r=i[n];s.file(r.fileNameStr,r.decompressed,{binary:!0,optimizedBinaryString:!0,date:r.date,dir:r.dir,comment:r.fileCommentStr.length?r.fileCommentStr:null,unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions,createFolders:a.createFolders})}return e.zipComment.length&&(s.comment=e.zipComment),s})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,i){"use strict";var n=t("../utils"),r=t("../stream/GenericWorker");function a(t,e){r.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}n.inherits(a,r),a.prototype._bindStream=function(t){var e=this;(this._stream=t).pause(),t.on("data",function(t){e.push({data:t,meta:{percent:0}})}).on("error",function(t){e.isPaused?this.generatedError=t:e.error(t)}).on("end",function(){e.isPaused?e._upstreamEnded=!0:e.end()})},a.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,i){"use strict";var r=t("readable-stream").Readable;function n(t,e,i){r.call(this,e),this._helper=t;var n=this;t.on("data",function(t,e){n.push(t)||n._helper.pause(),i&&i(e)}).on("error",function(t){n.emit("error",t)}).on("end",function(){n.push(null)})}t("../utils").inherits(n,r),n.prototype._read=function(){this._helper.resume()},e.exports=n},{"../utils":32,"readable-stream":16}],14:[function(t,e,i){"use strict";e.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(t,e){return new Buffer(t,e)},allocBuffer:function(t){return Buffer.alloc?Buffer.alloc(t):new Buffer(t)},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e,i){"use strict";var r=t("./utf8"),h=t("./utils"),u=t("./stream/GenericWorker"),a=t("./stream/StreamHelper"),c=t("./defaults"),_=t("./compressedObject"),d=t("./zipObject"),s=t("./generate"),f=t("./nodejsUtils"),p=t("./nodejs/NodejsStreamInputAdapter"),o=function(t,e,i){var n,r=h.getTypeOf(e),a=h.extend(i||{},c);a.date=a.date||new Date,null!==a.compression&&(a.compression=a.compression.toUpperCase()),"string"==typeof a.unixPermissions&&(a.unixPermissions=parseInt(a.unixPermissions,8)),a.unixPermissions&&16384&a.unixPermissions&&(a.dir=!0),a.dosPermissions&&16&a.dosPermissions&&(a.dir=!0),a.dir&&(t=g(t)),a.createFolders&&(n=m(t))&&v.call(this,n,!0);var s="string"===r&&!1===a.binary&&!1===a.base64;i&&void 0!==i.binary||(a.binary=!s),(e instanceof _&&0===e.uncompressedSize||a.dir||!e||0===e.length)&&(a.base64=!1,a.binary=!0,e="",a.compression="STORE",r="string");var o=null;o=e instanceof _||e instanceof u?e:f.isNode&&f.isStream(e)?new p(t,e):h.prepareContent(t,e,a.binary,a.optimizedBinaryString,a.base64);var l=new d(t,o,a);this.files[t]=l},m=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return 0<e?t.substring(0,e):""},g=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},v=function(t,e){return e=void 0!==e?e:c.createFolders,t=g(t),this.files[t]||o.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]};function l(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var n={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,i,n;for(e in this.files)this.files.hasOwnProperty(e)&&(n=this.files[e],(i=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(i,n))},filter:function(i){var n=[];return this.forEach(function(t,e){i(t,e)&&n.push(e)}),n},file:function(t,e,i){if(1!==arguments.length)return t=this.root+t,o.call(this,t,e,i),this;if(l(t)){var n=t;return this.filter(function(t,e){return!e.dir&&n.test(t)})}var r=this.files[this.root+t];return r&&!r.dir?r:null},folder:function(i){if(!i)return this;if(l(i))return this.filter(function(t,e){return e.dir&&i.test(t)});var t=this.root+i,e=v.call(this,t),n=this.clone();return n.root=e.name,n},remove:function(i){i=this.root+i;var t=this.files[i];if(t||("/"!==i.slice(-1)&&(i+="/"),t=this.files[i]),t&&!t.dir)delete this.files[i];else for(var e=this.filter(function(t,e){return e.name.slice(0,i.length)===i}),n=0;n<e.length;n++)delete this.files[e[n].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,i={};try{if((i=h.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=i.type.toLowerCase(),i.compression=i.compression.toUpperCase(),"binarystring"===i.type&&(i.type="string"),!i.type)throw new Error("No output type specified.");h.checkSupport(i.type),"darwin"!==i.platform&&"freebsd"!==i.platform&&"linux"!==i.platform&&"sunos"!==i.platform||(i.platform="UNIX"),"win32"===i.platform&&(i.platform="DOS");var n=i.comment||this.comment||"";e=s.generateWorker(this,i,n)}catch(t){(e=new u("error")).error(t)}return new a(e,i.type||"string",i.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};e.exports=n},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,i){e.exports=t("stream")},{stream:void 0}],17:[function(t,e,i){"use strict";var n=t("./DataReader");function r(t){n.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}t("../utils").inherits(r,n),r.prototype.byteAt=function(t){return this.data[this.zero+t]},r.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),i=t.charCodeAt(1),n=t.charCodeAt(2),r=t.charCodeAt(3),a=this.length-4;0<=a;--a)if(this.data[a]===e&&this.data[a+1]===i&&this.data[a+2]===n&&this.data[a+3]===r)return a-this.zero;return-1},r.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),i=t.charCodeAt(1),n=t.charCodeAt(2),r=t.charCodeAt(3),a=this.readData(4);return e===a[0]&&i===a[1]&&n===a[2]&&r===a[3]},r.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,e,i){"use strict";var n=t("../utils");function r(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e,i=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)i=(i<<8)+this.byteAt(e);return this.index+=t,i},readString:function(t){return n.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=r},{"../utils":32}],19:[function(t,e,i){"use strict";var n=t("./Uint8ArrayReader");function r(t){n.call(this,t)}t("../utils").inherits(r,n),r.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,i){"use strict";var n=t("./DataReader");function r(t){n.call(this,t)}t("../utils").inherits(r,n),r.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},r.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},r.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},r.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,e,i){"use strict";var n=t("./ArrayReader");function r(t){n.call(this,t)}t("../utils").inherits(r,n),r.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,i){"use strict";var n=t("../utils"),r=t("../support"),a=t("./ArrayReader"),s=t("./StringReader"),o=t("./NodeBufferReader"),l=t("./Uint8ArrayReader");e.exports=function(t){var e=n.getTypeOf(t);return n.checkSupport(e),"string"!==e||r.uint8array?"nodebuffer"===e?new o(t):r.uint8array?new l(n.transformTo("uint8array",t)):new a(n.transformTo("array",t)):new s(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,i){"use strict";i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\b"},{}],24:[function(t,e,i){"use strict";var n=t("./GenericWorker"),r=t("../utils");function a(t){n.call(this,"ConvertWorker to "+t),this.destType=t}r.inherits(a,n),a.prototype.processChunk=function(t){this.push({data:r.transformTo(this.destType,t.data),meta:t.meta})},e.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,i){"use strict";var n=t("./GenericWorker"),r=t("../crc32");function a(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(a,n),a.prototype.processChunk=function(t){this.streamInfo.crc32=r(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,i){"use strict";var n=t("../utils"),r=t("./GenericWorker");function a(t){r.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}n.inherits(a,r),a.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}r.prototype.processChunk.call(this,t)},e.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,i){"use strict";var n=t("../utils"),r=t("./GenericWorker");function a(t){r.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then(function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=n.getTypeOf(t),e.isPaused||e._tickAndRepeat()},function(t){e.error(t)})}n.inherits(a,r),a.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,i){"use strict";function n(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var i=0;i<this._listeners[t].length;i++)this._listeners[t][i].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.end()}),t.on("error",function(t){e.error(t)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=n},{}],29:[function(t,e,i){"use strict";var l=t("../utils"),r=t("./ConvertWorker"),a=t("./GenericWorker"),h=t("../base64"),n=t("../support"),s=t("../external"),o=null;if(n.nodestream)try{o=t("../nodejs/NodejsStreamOutputAdapter")}catch(t){}function u(t,o){return new s.Promise(function(e,i){var n=[],r=t._internalType,a=t._outputType,s=t._mimeType;t.on("data",function(t,e){n.push(t),o&&o(e)}).on("error",function(t){n=[],i(t)}).on("end",function(){try{var t=function(t,e,i){switch(t){case"blob":return l.newBlob(l.transformTo("arraybuffer",e),i);case"base64":return h.encode(e);default:return l.transformTo(t,e)}}(a,function(t,e){var i,n=0,r=null,a=0;for(i=0;i<e.length;i++)a+=e[i].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(r=new Uint8Array(a),i=0;i<e.length;i++)r.set(e[i],n),n+=e[i].length;return r;case"nodebuffer":return Buffer.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}(r,n),s);e(t)}catch(t){i(t)}n=[]}).resume()})}function c(t,e,i){var n=e;switch(e){case"blob":case"arraybuffer":n="uint8array";break;case"base64":n="string"}try{this._internalType=n,this._outputType=e,this._mimeType=i,l.checkSupport(n),this._worker=t.pipe(new r(n)),t.lock()}catch(t){this._worker=new a("error"),this._worker.error(t)}}c.prototype={accumulate:function(t){return u(this,t)},on:function(t,e){var i=this;return"data"===t?this._worker.on(t,function(t){e.call(i,t.data,t.meta)}):this._worker.on(t,function(){l.delay(e,arguments,i)}),this},resume:function(){return l.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(l.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new o(this,{objectMode:"nodebuffer"!==this._outputType},t)}},e.exports=c},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,i){"use strict";if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer="undefined"!=typeof Buffer,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{var n=new ArrayBuffer(0);try{i.blob=0===new Blob([n],{type:"application/zip"}).size}catch(t){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(n),i.blob=0===r.getBlob("application/zip").size}catch(t){i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch(t){i.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,a){"use strict";for(var o=t("./utils"),l=t("./support"),i=t("./nodejsUtils"),n=t("./stream/GenericWorker"),h=new Array(256),r=0;r<256;r++)h[r]=252<=r?6:248<=r?5:240<=r?4:224<=r?3:192<=r?2:1;h[254]=h[254]=1;function s(){n.call(this,"utf-8 decode"),this.leftOver=null}function u(){n.call(this,"utf-8 encode")}a.utf8encode=function(t){return l.nodebuffer?i.newBufferFrom(t,"utf-8"):function(t){var e,i,n,r,a,s=t.length,o=0;for(r=0;r<s;r++)55296==(64512&(i=t.charCodeAt(r)))&&r+1<s&&56320==(64512&(n=t.charCodeAt(r+1)))&&(i=65536+(i-55296<<10)+(n-56320),r++),o+=i<128?1:i<2048?2:i<65536?3:4;for(e=l.uint8array?new Uint8Array(o):new Array(o),r=a=0;a<o;r++)55296==(64512&(i=t.charCodeAt(r)))&&r+1<s&&56320==(64512&(n=t.charCodeAt(r+1)))&&(i=65536+(i-55296<<10)+(n-56320),r++),e[a++]=i<128?i:(e[a++]=i<2048?192|i>>>6:(e[a++]=i<65536?224|i>>>12:(e[a++]=240|i>>>18,128|i>>>12&63),128|i>>>6&63),128|63&i);return e}(t)},a.utf8decode=function(t){return l.nodebuffer?o.transformTo("nodebuffer",t).toString("utf-8"):function(t){var e,i,n,r,a=t.length,s=new Array(2*a);for(e=i=0;e<a;)if((n=t[e++])<128)s[i++]=n;else if(4<(r=h[n]))s[i++]=65533,e+=r-1;else{for(n&=2===r?31:3===r?15:7;1<r&&e<a;)n=n<<6|63&t[e++],r--;s[i++]=1<r?65533:n<65536?n:(n-=65536,s[i++]=55296|n>>10&1023,56320|1023&n)}return s.length!==i&&(s.subarray?s=s.subarray(0,i):s.length=i),o.applyFromCharCode(s)}(t=o.transformTo(l.uint8array?"uint8array":"array",t))},o.inherits(s,n),s.prototype.processChunk=function(t){var e=o.transformTo(l.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var i=e;(e=new Uint8Array(i.length+this.leftOver.length)).set(this.leftOver,0),e.set(i,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var n=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;0<=i&&128==(192&t[i]);)i--;return i<0?e:0===i?e:i+h[t[i]]>e?i:e}(e),r=e;n!==e.length&&(l.uint8array?(r=e.subarray(0,n),this.leftOver=e.subarray(n,e.length)):(r=e.slice(0,n),this.leftOver=e.slice(n,e.length))),this.push({data:a.utf8decode(r),meta:t.meta})},s.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=s,o.inherits(u,n),u.prototype.processChunk=function(t){this.push({data:a.utf8encode(t.data),meta:t.meta})},a.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,o){"use strict";var l=t("./support"),h=t("./base64"),i=t("./nodejsUtils"),n=t("core-js/library/fn/set-immediate"),u=t("./external");function r(t){return t}function c(t,e){for(var i=0;i<t.length;++i)e[i]=255&t.charCodeAt(i);return e}o.newBlob=function(e,i){o.checkSupport("blob");try{return new Blob([e],{type:i})}catch(t){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return n.append(e),n.getBlob(i)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var a={stringifyByChunk:function(t,e,i){var n=[],r=0,a=t.length;if(a<=i)return String.fromCharCode.apply(null,t);for(;r<a;)"array"===e||"nodebuffer"===e?n.push(String.fromCharCode.apply(null,t.slice(r,Math.min(r+i,a)))):n.push(String.fromCharCode.apply(null,t.subarray(r,Math.min(r+i,a)))),r+=i;return n.join("")},stringifyByChar:function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},applyCanBeUsed:{uint8array:function(){try{return l.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return l.nodebuffer&&1===String.fromCharCode.apply(null,i.allocBuffer(1)).length}catch(t){return!1}}()}};function s(t){var e=65536,i=o.getTypeOf(t),n=!0;if("uint8array"===i?n=a.applyCanBeUsed.uint8array:"nodebuffer"===i&&(n=a.applyCanBeUsed.nodebuffer),n)for(;1<e;)try{return a.stringifyByChunk(t,i,e)}catch(t){e=Math.floor(e/2)}return a.stringifyByChar(t)}function _(t,e){for(var i=0;i<t.length;i++)e[i]=t[i];return e}o.applyFromCharCode=s;var d={};d.string={string:r,array:function(t){return c(t,new Array(t.length))},arraybuffer:function(t){return d.string.uint8array(t).buffer},uint8array:function(t){return c(t,new Uint8Array(t.length))},nodebuffer:function(t){return c(t,i.allocBuffer(t.length))}},d.array={string:s,array:r,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return i.newBufferFrom(t)}},d.arraybuffer={string:function(t){return s(new Uint8Array(t))},array:function(t){return _(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:r,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return i.newBufferFrom(new Uint8Array(t))}},d.uint8array={string:s,array:function(t){return _(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:r,nodebuffer:function(t){return i.newBufferFrom(t)}},d.nodebuffer={string:s,array:function(t){return _(t,new Array(t.length))},arraybuffer:function(t){return d.nodebuffer.uint8array(t).buffer},uint8array:function(t){return _(t,new Uint8Array(t.length))},nodebuffer:r},o.transformTo=function(t,e){if(e||(e=""),!t)return e;o.checkSupport(t);var i=o.getTypeOf(e);return d[i][t](e)},o.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":l.nodebuffer&&i.isBuffer(t)?"nodebuffer":l.uint8array&&t instanceof Uint8Array?"uint8array":l.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},o.checkSupport=function(t){if(!l[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},o.MAX_VALUE_16BITS=65535,o.MAX_VALUE_32BITS=-1,o.pretty=function(t){var e,i,n="";for(i=0;i<(t||"").length;i++)n+="\\x"+((e=t.charCodeAt(i))<16?"0":"")+e.toString(16).toUpperCase();return n},o.delay=function(t,e,i){n(function(){t.apply(i||null,e||[])})},o.inherits=function(t,e){var i=function(){};i.prototype=e.prototype,t.prototype=new i},o.extend=function(){var t,e,i={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&void 0===i[e]&&(i[e]=arguments[t][e]);return i},o.prepareContent=function(n,t,r,a,s){return u.Promise.resolve(t).then(function(n){return l.blob&&(n instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(n)))&&"undefined"!=typeof FileReader?new u.Promise(function(e,i){var t=new FileReader;t.onload=function(t){e(t.target.result)},t.onerror=function(t){i(t.target.error)},t.readAsArrayBuffer(n)}):n}).then(function(t){var e,i=o.getTypeOf(t);return i?("arraybuffer"===i?t=o.transformTo("uint8array",t):"string"===i&&(s?t=h.decode(t):r&&!0!==a&&(t=c(e=t,l.uint8array?new Uint8Array(e.length):new Array(e.length)))),t):u.Promise.reject(new Error("Can't read the data of '"+n+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"core-js/library/fn/set-immediate":36}],33:[function(t,e,i){"use strict";var n=t("./reader/readerFor"),r=t("./utils"),a=t("./signature"),s=t("./zipEntry"),o=(t("./utf8"),t("./support"));function l(t){this.files=[],this.loadOptions=t}l.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(e)+", expected "+r.pretty(t)+")")}},isSignature:function(t,e){var i=this.reader.index;this.reader.setIndex(t);var n=this.reader.readString(4)===e;return this.reader.setIndex(i),n},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=o.uint8array?"uint8array":"array",i=r.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,i,n=this.zip64EndOfCentralSize-44;0<n;)t=this.reader.readInt(2),e=this.reader.readInt(4),i=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(t=new s({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(t<0)throw!this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory");this.reader.setIndex(t);var e=t;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var i=this.centralDirOffset+this.centralDirSize;this.zip64&&(i+=20,i+=12+this.zip64EndOfCentralSize);var n=e-i;if(0<n)this.isSignature(e,a.CENTRAL_FILE_HEADER)||(this.reader.zero=n);else if(n<0)throw new Error("Corrupted zip: missing "+Math.abs(n)+" bytes.")},prepareReader:function(t){this.reader=n(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(t,e,i){"use strict";var n=t("./reader/readerFor"),a=t("./utils"),r=t("./compressedObject"),s=t("./crc32"),o=t("./utf8"),l=t("./compressions"),h=t("./support");function u(t,e){this.options=t,this.loadOptions=e}u.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,i;if(t.skip(22),this.fileNameLength=t.readInt(2),i=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(i),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=function(t){for(var e in l)if(l.hasOwnProperty(e)&&l[e].magic===t)return l[e];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===t&&(this.dosPermissions=63&this.externalFileAttributes),3===t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var e=n(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(t){var e,i,n,r=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index<r;)e=t.readInt(2),i=t.readInt(2),n=t.readData(i),this.extraFields[e]={id:e,length:i,value:n}},handleUTF8:function(){var t=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var i=a.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(i)}var n=this.findExtraFieldUnicodeComment();if(null!==n)this.fileCommentStr=n;else{var r=a.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(r)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=n(t.value);return 1!==e.readInt(1)?null:s(this.fileName)!==e.readInt(4)?null:o.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=n(t.value);return 1!==e.readInt(1)?null:s(this.fileComment)!==e.readInt(4)?null:o.utf8decode(e.readData(t.length-5))}return null}},e.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,i){"use strict";var a=t("./stream/StreamHelper"),n=t("./stream/DataWorker"),s=t("./utf8"),r=t("./compressedObject"),o=t("./stream/GenericWorker"),l=function(t,e,i){this.name=t,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this.unixPermissions=i.unixPermissions,this.dosPermissions=i.dosPermissions,this._data=e,this._dataBinary=i.binary,this.options={compression:i.compression,compressionOptions:i.compressionOptions}};l.prototype={internalStream:function(t){var e=null,i="string";try{if(!t)throw new Error("No output type specified.");var n="string"===(i=t.toLowerCase())||"text"===i;"binarystring"!==i&&"text"!==i||(i="string"),e=this._decompressWorker();var r=!this._dataBinary;r&&!n&&(e=e.pipe(new s.Utf8EncodeWorker)),!r&&n&&(e=e.pipe(new s.Utf8DecodeWorker))}catch(t){(e=new o("error")).error(t)}return new a(e,i,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof r&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var i=this._decompressWorker();return this._dataBinary||(i=i.pipe(new s.Utf8EncodeWorker)),r.createWorkerFrom(i,t,e)},_decompressWorker:function(){return this._data instanceof r?this._data.getContentWorker():this._data instanceof o?this._data:new n(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},c=0;c<h.length;c++)l.prototype[h[c]]=u;e.exports=l},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,e,i){t("../modules/web.immediate"),e.exports=t("../modules/_core").setImmediate},{"../modules/_core":40,"../modules/web.immediate":56}],37:[function(t,e,i){e.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},{}],38:[function(t,e,i){var n=t("./_is-object");e.exports=function(t){if(!n(t))throw TypeError(t+" is not an object!");return t}},{"./_is-object":51}],39:[function(t,e,i){var n={}.toString;e.exports=function(t){return n.call(t).slice(8,-1)}},{}],40:[function(t,e,i){var n=e.exports={version:"2.3.0"};"number"==typeof __e&&(__e=n)},{}],41:[function(t,e,i){var a=t("./_a-function");e.exports=function(n,r,t){if(a(n),void 0===r)return n;switch(t){case 1:return function(t){return n.call(r,t)};case 2:return function(t,e){return n.call(r,t,e)};case 3:return function(t,e,i){return n.call(r,t,e,i)}}return function(){return n.apply(r,arguments)}}},{"./_a-function":37}],42:[function(t,e,i){e.exports=!t("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":45}],43:[function(t,e,i){var n=t("./_is-object"),r=t("./_global").document,a=n(r)&&n(r.createElement);e.exports=function(t){return a?r.createElement(t):{}}},{"./_global":46,"./_is-object":51}],44:[function(t,e,i){var p=t("./_global"),m=t("./_core"),g=t("./_ctx"),v=t("./_hide"),y="prototype",x=function(t,e,i){var n,r,a,s=t&x.F,o=t&x.G,l=t&x.S,h=t&x.P,u=t&x.B,c=t&x.W,_=o?m:m[e]||(m[e]={}),d=_[y],f=o?p:l?p[e]:(p[e]||{})[y];for(n in o&&(i=e),i)(r=!s&&f&&void 0!==f[n])&&n in _||(a=r?f[n]:i[n],_[n]=o&&"function"!=typeof f[n]?i[n]:u&&r?g(a,p):c&&f[n]==a?function(n){var t=function(t,e,i){if(this instanceof n){switch(arguments.length){case 0:return new n;case 1:return new n(t);case 2:return new n(t,e)}return new n(t,e,i)}return n.apply(this,arguments)};return t[y]=n[y],t}(a):h&&"function"==typeof a?g(Function.call,a):a,h&&((_.virtual||(_.virtual={}))[n]=a,t&x.R&&d&&!d[n]&&v(d,n,a)))};x.F=1,x.G=2,x.S=4,x.P=8,x.B=16,x.W=32,x.U=64,x.R=128,e.exports=x},{"./_core":40,"./_ctx":41,"./_global":46,"./_hide":47}],45:[function(t,e,i){e.exports=function(t){try{return!!t()}catch(t){return!0}}},{}],46:[function(t,e,i){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},{}],47:[function(t,e,i){var n=t("./_object-dp"),r=t("./_property-desc");e.exports=t("./_descriptors")?function(t,e,i){return n.f(t,e,r(1,i))}:function(t,e,i){return t[e]=i,t}},{"./_descriptors":42,"./_object-dp":52,"./_property-desc":53}],48:[function(t,e,i){e.exports=t("./_global").document&&document.documentElement},{"./_global":46}],49:[function(t,e,i){e.exports=!t("./_descriptors")&&!t("./_fails")(function(){return 7!=Object.defineProperty(t("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":42,"./_dom-create":43,"./_fails":45}],50:[function(t,e,i){e.exports=function(t,e,i){var n=void 0===i;switch(e.length){case 0:return n?t():t.call(i);case 1:return n?t(e[0]):t.call(i,e[0]);case 2:return n?t(e[0],e[1]):t.call(i,e[0],e[1]);case 3:return n?t(e[0],e[1],e[2]):t.call(i,e[0],e[1],e[2]);case 4:return n?t(e[0],e[1],e[2],e[3]):t.call(i,e[0],e[1],e[2],e[3])}return t.apply(i,e)}},{}],51:[function(t,e,i){e.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},{}],52:[function(t,e,i){var n=t("./_an-object"),r=t("./_ie8-dom-define"),a=t("./_to-primitive"),s=Object.defineProperty;i.f=t("./_descriptors")?Object.defineProperty:function(t,e,i){if(n(t),e=a(e,!0),n(i),r)try{return s(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},{"./_an-object":38,"./_descriptors":42,"./_ie8-dom-define":49,"./_to-primitive":55}],53:[function(t,e,i){e.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},{}],54:[function(t,e,i){var n,r,a,s=t("./_ctx"),o=t("./_invoke"),l=t("./_html"),h=t("./_dom-create"),u=t("./_global"),c=u.process,_=u.setImmediate,d=u.clearImmediate,f=u.MessageChannel,p=0,m={},g="onreadystatechange",v=function(){var t=+this;if(m.hasOwnProperty(t)){var e=m[t];delete m[t],e()}},y=function(t){v.call(t.data)};_&&d||(_=function(t){for(var e=[],i=1;arguments.length>i;)e.push(arguments[i++]);return m[++p]=function(){o("function"==typeof t?t:Function(t),e)},n(p),p},d=function(t){delete m[t]},"process"==t("./_cof")(c)?n=function(t){c.nextTick(s(v,t,1))}:f?(a=(r=new f).port2,r.port1.onmessage=y,n=s(a.postMessage,a,1)):u.addEventListener&&"function"==typeof postMessage&&!u.importScripts?(n=function(t){u.postMessage(t+"","*")},u.addEventListener("message",y,!1)):n=g in h("script")?function(t){l.appendChild(h("script"))[g]=function(){l.removeChild(this),v.call(t)}}:function(t){setTimeout(s(v,t,1),0)}),e.exports={set:_,clear:d}},{"./_cof":39,"./_ctx":41,"./_dom-create":43,"./_global":46,"./_html":48,"./_invoke":50}],55:[function(t,e,i){var r=t("./_is-object");e.exports=function(t,e){if(!r(t))return t;var i,n;if(e&&"function"==typeof(i=t.toString)&&!r(n=i.call(t)))return n;if("function"==typeof(i=t.valueOf)&&!r(n=i.call(t)))return n;if(!e&&"function"==typeof(i=t.toString)&&!r(n=i.call(t)))return n;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":51}],56:[function(t,e,i){var n=t("./_export"),r=t("./_task");n(n.G+n.B,{setImmediate:r.set,clearImmediate:r.clear})},{"./_export":44,"./_task":54}],57:[function(t,u,e){(function(e){"use strict";var i,n,t=e.MutationObserver||e.WebKitMutationObserver;if(t){var r=0,a=new t(h),s=e.document.createTextNode("");a.observe(s,{characterData:!0}),i=function(){s.data=r=++r%2}}else if(e.setImmediate||void 0===e.MessageChannel)i="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){h(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(h,0)};else{var o=new e.MessageChannel;o.port1.onmessage=h,i=function(){o.port2.postMessage(0)}}var l=[];function h(){var t,e;n=!0;for(var i=l.length;i;){for(e=l,l=[],t=-1;++t<i;)e[t]();i=l.length}n=!1}u.exports=function(t){1!==l.push(t)||n||i()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],58:[function(t,e,i){"use strict";var r=t("immediate");function h(){}var u={},a=["REJECTED"],s=["FULFILLED"],n=["PENDING"];function o(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=n,this.queue=[],this.outcome=void 0,t!==h&&d(this,t)}function l(t,e,i){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function c(e,i,n){r(function(){var t;try{t=i(n)}catch(t){return u.reject(e,t)}t===e?u.reject(e,new TypeError("Cannot resolve promise with itself")):u.resolve(e,t)})}function _(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function d(e,t){var i=!1;function n(t){i||(i=!0,u.reject(e,t))}function r(t){i||(i=!0,u.resolve(e,t))}var a=f(function(){t(r,n)});"error"===a.status&&n(a.value)}function f(t,e){var i={};try{i.value=t(e),i.status="success"}catch(t){i.status="error",i.value=t}return i}(e.exports=o).prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){if("function"!=typeof t&&this.state===s||"function"!=typeof e&&this.state===a)return this;var i=new this.constructor(h);this.state!==n?c(i,this.state===s?t:e,this.outcome):this.queue.push(new l(i,t,e));return i},l.prototype.callFulfilled=function(t){u.resolve(this.promise,t)},l.prototype.otherCallFulfilled=function(t){c(this.promise,this.onFulfilled,t)},l.prototype.callRejected=function(t){u.reject(this.promise,t)},l.prototype.otherCallRejected=function(t){c(this.promise,this.onRejected,t)},u.resolve=function(t,e){var i=f(_,e);if("error"===i.status)return u.reject(t,i.value);var n=i.value;if(n)d(t,n);else{t.state=s,t.outcome=e;for(var r=-1,a=t.queue.length;++r<a;)t.queue[r].callFulfilled(e)}return t},u.reject=function(t,e){t.state=a,t.outcome=e;for(var i=-1,n=t.queue.length;++i<n;)t.queue[i].callRejected(e);return t},o.resolve=function(t){if(t instanceof this)return t;return u.resolve(new this(h),t)},o.reject=function(t){var e=new this(h);return u.reject(e,t)},o.all=function(t){var i=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,r=!1;if(!n)return this.resolve([]);var a=new Array(n),s=0,e=-1,o=new this(h);for(;++e<n;)l(t[e],e);return o;function l(t,e){i.resolve(t).then(function(t){a[e]=t,++s!==n||r||(r=!0,u.resolve(o,a))},function(t){r||(r=!0,u.reject(o,t))})}},o.race=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,n=!1;if(!i)return this.resolve([]);var r=-1,a=new this(h);for(;++r<i;)s=t[r],e.resolve(s).then(function(t){n||(n=!0,u.resolve(a,t))},function(t){n||(n=!0,u.reject(a,t))});var s;return a}},{immediate:57}],59:[function(t,e,i){"use strict";var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=n},{"./lib/deflate":60,"./lib/inflate":61,"./lib/utils/common":62,"./lib/zlib/constants":65}],60:[function(t,e,i){"use strict";var s=t("./zlib/deflate"),o=t("./utils/common"),l=t("./utils/strings"),r=t("./zlib/messages"),a=t("./zlib/zstream"),h=Object.prototype.toString,u=0,c=-1,_=0,d=8;function f(t){if(!(this instanceof f))return new f(t);this.options=o.assign({level:c,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:_,to:""},t||{});var e=this.options;e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var i=s.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==u)throw new Error(r[i]);if(e.header&&s.deflateSetHeader(this.strm,e.header),e.dictionary){var n;if(n="string"==typeof e.dictionary?l.string2buf(e.dictionary):"[object ArrayBuffer]"===h.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(i=s.deflateSetDictionary(this.strm,n))!==u)throw new Error(r[i]);this._dict_set=!0}}function n(t,e){var i=new f(e);if(i.push(t,!0),i.err)throw i.msg||r[i.err];return i.result}f.prototype.push=function(t,e){var i,n,r=this.strm,a=this.options.chunkSize;if(this.ended)return!1;n=e===~~e?e:!0===e?4:0,"string"==typeof t?r.input=l.string2buf(t):"[object ArrayBuffer]"===h.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new o.Buf8(a),r.next_out=0,r.avail_out=a),1!==(i=s.deflate(r,n))&&i!==u)return this.onEnd(i),!(this.ended=!0);0!==r.avail_out&&(0!==r.avail_in||4!==n&&2!==n)||("string"===this.options.to?this.onData(l.buf2binstring(o.shrinkBuf(r.output,r.next_out))):this.onData(o.shrinkBuf(r.output,r.next_out)))}while((0<r.avail_in||0===r.avail_out)&&1!==i);return 4===n?(i=s.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===u):2!==n||(this.onEnd(u),!(r.avail_out=0))},f.prototype.onData=function(t){this.chunks.push(t)},f.prototype.onEnd=function(t){t===u&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Deflate=f,i.deflate=n,i.deflateRaw=function(t,e){return(e=e||{}).raw=!0,n(t,e)},i.gzip=function(t,e){return(e=e||{}).gzip=!0,n(t,e)}},{"./utils/common":62,"./utils/strings":63,"./zlib/deflate":67,"./zlib/messages":72,"./zlib/zstream":74}],61:[function(t,e,i){"use strict";var _=t("./zlib/inflate"),d=t("./utils/common"),f=t("./utils/strings"),p=t("./zlib/constants"),n=t("./zlib/messages"),r=t("./zlib/zstream"),a=t("./zlib/gzheader"),m=Object.prototype.toString;function s(t){if(!(this instanceof s))return new s(t);this.options=d.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;var i=_.inflateInit2(this.strm,e.windowBits);if(i!==p.Z_OK)throw new Error(n[i]);this.header=new a,_.inflateGetHeader(this.strm,this.header)}function o(t,e){var i=new s(e);if(i.push(t,!0),i.err)throw i.msg||n[i.err];return i.result}s.prototype.push=function(t,e){var i,n,r,a,s,o,l=this.strm,h=this.options.chunkSize,u=this.options.dictionary,c=!1;if(this.ended)return!1;n=e===~~e?e:!0===e?p.Z_FINISH:p.Z_NO_FLUSH,"string"==typeof t?l.input=f.binstring2buf(t):"[object ArrayBuffer]"===m.call(t)?l.input=new Uint8Array(t):l.input=t,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new d.Buf8(h),l.next_out=0,l.avail_out=h),(i=_.inflate(l,p.Z_NO_FLUSH))===p.Z_NEED_DICT&&u&&(o="string"==typeof u?f.string2buf(u):"[object ArrayBuffer]"===m.call(u)?new Uint8Array(u):u,i=_.inflateSetDictionary(this.strm,o)),i===p.Z_BUF_ERROR&&!0===c&&(i=p.Z_OK,c=!1),i!==p.Z_STREAM_END&&i!==p.Z_OK)return this.onEnd(i),!(this.ended=!0);l.next_out&&(0!==l.avail_out&&i!==p.Z_STREAM_END&&(0!==l.avail_in||n!==p.Z_FINISH&&n!==p.Z_SYNC_FLUSH)||("string"===this.options.to?(r=f.utf8border(l.output,l.next_out),a=l.next_out-r,s=f.buf2string(l.output,r),l.next_out=a,l.avail_out=h-a,a&&d.arraySet(l.output,l.output,r,a,0),this.onData(s)):this.onData(d.shrinkBuf(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(c=!0)}while((0<l.avail_in||0===l.avail_out)&&i!==p.Z_STREAM_END);return i===p.Z_STREAM_END&&(n=p.Z_FINISH),n===p.Z_FINISH?(i=_.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===p.Z_OK):n!==p.Z_SYNC_FLUSH||(this.onEnd(p.Z_OK),!(l.avail_out=0))},s.prototype.onData=function(t){this.chunks.push(t)},s.prototype.onEnd=function(t){t===p.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Inflate=s,i.inflate=o,i.inflateRaw=function(t,e){return(e=e||{}).raw=!0,o(t,e)},i.ungzip=o},{"./utils/common":62,"./utils/strings":63,"./zlib/constants":65,"./zlib/gzheader":68,"./zlib/inflate":70,"./zlib/messages":72,"./zlib/zstream":74}],62:[function(t,e,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}}return t},i.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var r={arraySet:function(t,e,i,n,r){if(e.subarray&&t.subarray)t.set(e.subarray(i,i+n),r);else for(var a=0;a<n;a++)t[r+a]=e[i+a]},flattenChunks:function(t){var e,i,n,r,a,s;for(e=n=0,i=t.length;e<i;e++)n+=t[e].length;for(s=new Uint8Array(n),e=r=0,i=t.length;e<i;e++)a=t[e],s.set(a,r),r+=a.length;return s}},a={arraySet:function(t,e,i,n,r){for(var a=0;a<n;a++)t[r+a]=e[i+a]},flattenChunks:function(t){return[].concat.apply([],t)}};i.setTyped=function(t){t?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,r)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(n)},{}],63:[function(t,e,i){"use strict";var l=t("./common"),r=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(t){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){a=!1}for(var h=new l.Buf8(256),n=0;n<256;n++)h[n]=252<=n?6:248<=n?5:240<=n?4:224<=n?3:192<=n?2:1;function u(t,e){if(e<65537&&(t.subarray&&a||!t.subarray&&r))return String.fromCharCode.apply(null,l.shrinkBuf(t,e));for(var i="",n=0;n<e;n++)i+=String.fromCharCode(t[n]);return i}h[254]=h[254]=1,i.string2buf=function(t){var e,i,n,r,a,s=t.length,o=0;for(r=0;r<s;r++)55296==(64512&(i=t.charCodeAt(r)))&&r+1<s&&56320==(64512&(n=t.charCodeAt(r+1)))&&(i=65536+(i-55296<<10)+(n-56320),r++),o+=i<128?1:i<2048?2:i<65536?3:4;for(e=new l.Buf8(o),r=a=0;a<o;r++)55296==(64512&(i=t.charCodeAt(r)))&&r+1<s&&56320==(64512&(n=t.charCodeAt(r+1)))&&(i=65536+(i-55296<<10)+(n-56320),r++),e[a++]=i<128?i:(e[a++]=i<2048?192|i>>>6:(e[a++]=i<65536?224|i>>>12:(e[a++]=240|i>>>18,128|i>>>12&63),128|i>>>6&63),128|63&i);return e},i.buf2binstring=function(t){return u(t,t.length)},i.binstring2buf=function(t){for(var e=new l.Buf8(t.length),i=0,n=e.length;i<n;i++)e[i]=t.charCodeAt(i);return e},i.buf2string=function(t,e){var i,n,r,a,s=e||t.length,o=new Array(2*s);for(i=n=0;i<s;)if((r=t[i++])<128)o[n++]=r;else if(4<(a=h[r]))o[n++]=65533,i+=a-1;else{for(r&=2===a?31:3===a?15:7;1<a&&i<s;)r=r<<6|63&t[i++],a--;o[n++]=1<a?65533:r<65536?r:(r-=65536,o[n++]=55296|r>>10&1023,56320|1023&r)}return u(o,n)},i.utf8border=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;0<=i&&128==(192&t[i]);)i--;return i<0?e:0===i?e:i+h[t[i]]>e?i:e}},{"./common":62}],64:[function(t,e,i){"use strict";e.exports=function(t,e,i,n){for(var r=65535&t|0,a=t>>>16&65535|0,s=0;0!==i;){for(i-=s=2e3<i?2e3:i;a=a+(r=r+e[n++]|0)|0,--s;);r%=65521,a%=65521}return r|a<<16|0}},{}],65:[function(t,e,i){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],66:[function(t,e,i){"use strict";var o=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();e.exports=function(t,e,i,n){var r=o,a=n+i;t^=-1;for(var s=n;s<a;s++)t=t>>>8^r[255&(t^e[s])];return-1^t}},{}],67:[function(t,e,i){"use strict";var l,_=t("../utils/common"),h=t("./trees"),d=t("./adler32"),f=t("./crc32"),n=t("./messages"),u=0,c=4,p=0,m=-2,g=-1,v=4,r=2,y=8,x=9,a=286,s=30,o=19,E=2*a+1,T=15,S=3,w=258,M=w+S+1,D=42,I=113,b=1,C=2,A=3,R=4;function L(t,e){return t.msg=n[e],e}function O(t){return(t<<1)-(4<t?9:0)}function P(t){for(var e=t.length;0<=--e;)t[e]=0}function N(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(_.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function V(t,e){h._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,N(t.strm)}function F(t,e){t.pending_buf[t.pending++]=e}function B(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function U(t,e){var i,n,r=t.max_chain_length,a=t.strstart,s=t.prev_length,o=t.nice_match,l=t.strstart>t.w_size-M?t.strstart-(t.w_size-M):0,h=t.window,u=t.w_mask,c=t.prev,_=t.strstart+w,d=h[a+s-1],f=h[a+s];t.prev_length>=t.good_match&&(r>>=2),o>t.lookahead&&(o=t.lookahead);do{if(h[(i=e)+s]===f&&h[i+s-1]===d&&h[i]===h[a]&&h[++i]===h[a+1]){a+=2,i++;do{}while(h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&a<_);if(n=w-(_-a),a=_-w,s<n){if(t.match_start=e,o<=(s=n))break;d=h[a+s-1],f=h[a+s]}}}while((e=c[e&u])>l&&0!=--r);return s<=t.lookahead?s:t.lookahead}function k(t){var e,i,n,r,a,s,o,l,h,u,c=t.w_size;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=c+(c-M)){for(_.arraySet(t.window,t.window,c,c,0),t.match_start-=c,t.strstart-=c,t.block_start-=c,e=i=t.hash_size;n=t.head[--e],t.head[e]=c<=n?n-c:0,--i;);for(e=i=c;n=t.prev[--e],t.prev[e]=c<=n?n-c:0,--i;);r+=c}if(0===t.strm.avail_in)break;if(s=t.strm,o=t.window,l=t.strstart+t.lookahead,h=r,u=void 0,u=s.avail_in,h<u&&(u=h),i=0===u?0:(s.avail_in-=u,_.arraySet(o,s.input,s.next_in,u,l),1===s.state.wrap?s.adler=d(s.adler,o,u,l):2===s.state.wrap&&(s.adler=f(s.adler,o,u,l)),s.next_in+=u,s.total_in+=u,u),t.lookahead+=i,t.lookahead+t.insert>=S)for(a=t.strstart-t.insert,t.ins_h=t.window[a],t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+S-1])&t.hash_mask,t.prev[a&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=a,a++,t.insert--,!(t.lookahead+t.insert<S)););}while(t.lookahead<M&&0!==t.strm.avail_in)}function H(t,e){for(var i,n;;){if(t.lookahead<M){if(k(t),t.lookahead<M&&e===u)return b;if(0===t.lookahead)break}if(i=0,t.lookahead>=S&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-M&&(t.match_length=U(t,i)),t.match_length>=S)if(n=h._tr_tally(t,t.strstart-t.match_start,t.match_length-S),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=S){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=h._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(V(t,!1),0===t.strm.avail_out))return b}return t.insert=t.strstart<S-1?t.strstart:S-1,e===c?(V(t,!0),0===t.strm.avail_out?A:R):t.last_lit&&(V(t,!1),0===t.strm.avail_out)?b:C}function z(t,e){for(var i,n,r;;){if(t.lookahead<M){if(k(t),t.lookahead<M&&e===u)return b;if(0===t.lookahead)break}if(i=0,t.lookahead>=S&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=S-1,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-M&&(t.match_length=U(t,i),t.match_length<=5&&(1===t.strategy||t.match_length===S&&4096<t.strstart-t.match_start)&&(t.match_length=S-1)),t.prev_length>=S&&t.match_length<=t.prev_length){for(r=t.strstart+t.lookahead-S,n=h._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-S),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=r&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=S-1,t.strstart++,n&&(V(t,!1),0===t.strm.avail_out))return b}else if(t.match_available){if((n=h._tr_tally(t,0,t.window[t.strstart-1]))&&V(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return b}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=h._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<S-1?t.strstart:S-1,e===c?(V(t,!0),0===t.strm.avail_out?A:R):t.last_lit&&(V(t,!1),0===t.strm.avail_out)?b:C}function G(t,e,i,n,r){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=n,this.func=r}function W(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new _.Buf16(2*E),this.dyn_dtree=new _.Buf16(2*(2*s+1)),this.bl_tree=new _.Buf16(2*(2*o+1)),P(this.dyn_ltree),P(this.dyn_dtree),P(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new _.Buf16(T+1),this.heap=new _.Buf16(2*a+1),P(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new _.Buf16(2*a+1),P(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function X(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=r,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?D:I,t.adler=2===e.wrap?0:1,e.last_flush=u,h._tr_init(e),p):L(t,m)}function Y(t){var e,i=X(t);return i===p&&((e=t.state).window_size=2*e.w_size,P(e.head),e.max_lazy_match=l[e.level].max_lazy,e.good_match=l[e.level].good_length,e.nice_match=l[e.level].nice_length,e.max_chain_length=l[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=S-1,e.match_available=0,e.ins_h=0),i}function j(t,e,i,n,r,a){if(!t)return m;var s=1;if(e===g&&(e=6),n<0?(s=0,n=-n):15<n&&(s=2,n-=16),r<1||x<r||i!==y||n<8||15<n||e<0||9<e||a<0||v<a)return L(t,m);8===n&&(n=9);var o=new W;return(t.state=o).strm=t,o.wrap=s,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=r+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+S-1)/S),o.window=new _.Buf8(2*o.w_size),o.head=new _.Buf16(o.hash_size),o.prev=new _.Buf16(o.w_size),o.lit_bufsize=1<<r+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new _.Buf8(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=e,o.strategy=a,o.method=i,Y(t)}l=[new G(0,0,0,0,function(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(k(t),0===t.lookahead&&e===u)return b;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+i;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,V(t,!1),0===t.strm.avail_out))return b;if(t.strstart-t.block_start>=t.w_size-M&&(V(t,!1),0===t.strm.avail_out))return b}return t.insert=0,e===c?(V(t,!0),0===t.strm.avail_out?A:R):(t.strstart>t.block_start&&(V(t,!1),t.strm.avail_out),b)}),new G(4,4,8,4,H),new G(4,5,16,8,H),new G(4,6,32,32,H),new G(4,4,16,16,z),new G(8,16,32,32,z),new G(8,16,128,128,z),new G(8,32,128,256,z),new G(32,128,258,1024,z),new G(32,258,258,4096,z)],i.deflateInit=function(t,e){return j(t,e,y,15,8,0)},i.deflateInit2=j,i.deflateReset=Y,i.deflateResetKeep=X,i.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?m:(t.state.gzhead=e,p):m},i.deflate=function(t,e){var i,n,r,a;if(!t||!t.state||5<e||e<0)return t?L(t,m):m;if(n=t.state,!t.output||!t.input&&0!==t.avail_in||666===n.status&&e!==c)return L(t,0===t.avail_out?-5:m);if(n.strm=t,i=n.last_flush,n.last_flush=e,n.status===D)if(2===n.wrap)t.adler=0,F(n,31),F(n,139),F(n,8),n.gzhead?(F(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),F(n,255&n.gzhead.time),F(n,n.gzhead.time>>8&255),F(n,n.gzhead.time>>16&255),F(n,n.gzhead.time>>24&255),F(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),F(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(F(n,255&n.gzhead.extra.length),F(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=f(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(F(n,0),F(n,0),F(n,0),F(n,0),F(n,0),F(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),F(n,3),n.status=I);else{var s=y+(n.w_bits-8<<4)<<8;s|=(2<=n.strategy||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(s|=32),s+=31-s%31,n.status=I,B(n,s),0!==n.strstart&&(B(n,t.adler>>>16),B(n,65535&t.adler)),t.adler=1}if(69===n.status)if(n.gzhead.extra){for(r=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>r&&(t.adler=f(t.adler,n.pending_buf,n.pending-r,r)),N(t),r=n.pending,n.pending!==n.pending_buf_size));)F(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>r&&(t.adler=f(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){r=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>r&&(t.adler=f(t.adler,n.pending_buf,n.pending-r,r)),N(t),r=n.pending,n.pending===n.pending_buf_size)){a=1;break}F(n,a=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0)}while(0!==a);n.gzhead.hcrc&&n.pending>r&&(t.adler=f(t.adler,n.pending_buf,n.pending-r,r)),0===a&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){r=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>r&&(t.adler=f(t.adler,n.pending_buf,n.pending-r,r)),N(t),r=n.pending,n.pending===n.pending_buf_size)){a=1;break}F(n,a=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0)}while(0!==a);n.gzhead.hcrc&&n.pending>r&&(t.adler=f(t.adler,n.pending_buf,n.pending-r,r)),0===a&&(n.status=103)}else n.status=103;if(103===n.status&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&N(t),n.pending+2<=n.pending_buf_size&&(F(n,255&t.adler),F(n,t.adler>>8&255),t.adler=0,n.status=I)):n.status=I),0!==n.pending){if(N(t),0===t.avail_out)return n.last_flush=-1,p}else if(0===t.avail_in&&O(e)<=O(i)&&e!==c)return L(t,-5);if(666===n.status&&0!==t.avail_in)return L(t,-5);if(0!==t.avail_in||0!==n.lookahead||e!==u&&666!==n.status){var o=2===n.strategy?function(t,e){for(var i;;){if(0===t.lookahead&&(k(t),0===t.lookahead)){if(e===u)return b;break}if(t.match_length=0,i=h._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(V(t,!1),0===t.strm.avail_out))return b}return t.insert=0,e===c?(V(t,!0),0===t.strm.avail_out?A:R):t.last_lit&&(V(t,!1),0===t.strm.avail_out)?b:C}(n,e):3===n.strategy?function(t,e){for(var i,n,r,a,s=t.window;;){if(t.lookahead<=w){if(k(t),t.lookahead<=w&&e===u)return b;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=S&&0<t.strstart&&(n=s[r=t.strstart-1])===s[++r]&&n===s[++r]&&n===s[++r]){a=t.strstart+w;do{}while(n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&r<a);t.match_length=w-(a-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=S?(i=h._tr_tally(t,1,t.match_length-S),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=h._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(V(t,!1),0===t.strm.avail_out))return b}return t.insert=0,e===c?(V(t,!0),0===t.strm.avail_out?A:R):t.last_lit&&(V(t,!1),0===t.strm.avail_out)?b:C}(n,e):l[n.level].func(n,e);if(o!==A&&o!==R||(n.status=666),o===b||o===A)return 0===t.avail_out&&(n.last_flush=-1),p;if(o===C&&(1===e?h._tr_align(n):5!==e&&(h._tr_stored_block(n,0,0,!1),3===e&&(P(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),N(t),0===t.avail_out))return n.last_flush=-1,p}return e!==c?p:n.wrap<=0?1:(2===n.wrap?(F(n,255&t.adler),F(n,t.adler>>8&255),F(n,t.adler>>16&255),F(n,t.adler>>24&255),F(n,255&t.total_in),F(n,t.total_in>>8&255),F(n,t.total_in>>16&255),F(n,t.total_in>>24&255)):(B(n,t.adler>>>16),B(n,65535&t.adler)),N(t),0<n.wrap&&(n.wrap=-n.wrap),0!==n.pending?p:1)},i.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==D&&69!==e&&73!==e&&91!==e&&103!==e&&e!==I&&666!==e?L(t,m):(t.state=null,e===I?L(t,-3):p):m},i.deflateSetDictionary=function(t,e){var i,n,r,a,s,o,l,h,u=e.length;if(!t||!t.state)return m;if(2===(a=(i=t.state).wrap)||1===a&&i.status!==D||i.lookahead)return m;for(1===a&&(t.adler=d(t.adler,e,u,0)),i.wrap=0,u>=i.w_size&&(0===a&&(P(i.head),i.strstart=0,i.block_start=0,i.insert=0),h=new _.Buf8(i.w_size),_.arraySet(h,e,u-i.w_size,i.w_size,0),e=h,u=i.w_size),s=t.avail_in,o=t.next_in,l=t.input,t.avail_in=u,t.next_in=0,t.input=e,k(i);i.lookahead>=S;){for(n=i.strstart,r=i.lookahead-(S-1);i.ins_h=(i.ins_h<<i.hash_shift^i.window[n+S-1])&i.hash_mask,i.prev[n&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=n,n++,--r;);i.strstart=n,i.lookahead=S-1,k(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=S-1,i.match_available=0,t.next_in=o,t.input=l,t.avail_in=s,i.wrap=a,p},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./messages":72,"./trees":73}],68:[function(t,e,i){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],69:[function(t,e,i){"use strict";e.exports=function(t,e){var i,n,r,a,s,o,l,h,u,c,_,d,f,p,m,g,v,y,x,E,T,S,w,M,D;i=t.state,n=t.next_in,M=t.input,r=n+(t.avail_in-5),a=t.next_out,D=t.output,s=a-(e-t.avail_out),o=a+(t.avail_out-257),l=i.dmax,h=i.wsize,u=i.whave,c=i.wnext,_=i.window,d=i.hold,f=i.bits,p=i.lencode,m=i.distcode,g=(1<<i.lenbits)-1,v=(1<<i.distbits)-1;t:do{f<15&&(d+=M[n++]<<f,f+=8,d+=M[n++]<<f,f+=8),y=p[d&g];e:for(;;){if(d>>>=x=y>>>24,f-=x,0===(x=y>>>16&255))D[a++]=65535&y;else{if(!(16&x)){if(0==(64&x)){y=p[(65535&y)+(d&(1<<x)-1)];continue e}if(32&x){i.mode=12;break t}t.msg="invalid literal/length code",i.mode=30;break t}E=65535&y,(x&=15)&&(f<x&&(d+=M[n++]<<f,f+=8),E+=d&(1<<x)-1,d>>>=x,f-=x),f<15&&(d+=M[n++]<<f,f+=8,d+=M[n++]<<f,f+=8),y=m[d&v];i:for(;;){if(d>>>=x=y>>>24,f-=x,!(16&(x=y>>>16&255))){if(0==(64&x)){y=m[(65535&y)+(d&(1<<x)-1)];continue i}t.msg="invalid distance code",i.mode=30;break t}if(T=65535&y,f<(x&=15)&&(d+=M[n++]<<f,(f+=8)<x&&(d+=M[n++]<<f,f+=8)),l<(T+=d&(1<<x)-1)){t.msg="invalid distance too far back",i.mode=30;break t}if(d>>>=x,f-=x,(x=a-s)<T){if(u<(x=T-x)&&i.sane){t.msg="invalid distance too far back",i.mode=30;break t}if(w=_,(S=0)===c){if(S+=h-x,x<E){for(E-=x;D[a++]=_[S++],--x;);S=a-T,w=D}}else if(c<x){if(S+=h+c-x,(x-=c)<E){for(E-=x;D[a++]=_[S++],--x;);if(S=0,c<E){for(E-=x=c;D[a++]=_[S++],--x;);S=a-T,w=D}}}else if(S+=c-x,x<E){for(E-=x;D[a++]=_[S++],--x;);S=a-T,w=D}for(;2<E;)D[a++]=w[S++],D[a++]=w[S++],D[a++]=w[S++],E-=3;E&&(D[a++]=w[S++],1<E&&(D[a++]=w[S++]))}else{for(S=a-T;D[a++]=D[S++],D[a++]=D[S++],D[a++]=D[S++],2<(E-=3););E&&(D[a++]=D[S++],1<E&&(D[a++]=D[S++]))}break}}break}}while(n<r&&a<o);n-=E=f>>3,d&=(1<<(f-=E<<3))-1,t.next_in=n,t.next_out=a,t.avail_in=n<r?r-n+5:5-(n-r),t.avail_out=a<o?o-a+257:257-(a-o),i.hold=d,i.bits=f}},{}],70:[function(t,e,i){"use strict";var C=t("../utils/common"),A=t("./adler32"),R=t("./crc32"),L=t("./inffast"),O=t("./inftrees"),P=1,N=2,V=0,F=-2,B=1,n=852,r=592;function U(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function a(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new C.Buf16(320),this.work=new C.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function s(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=B,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new C.Buf32(n),e.distcode=e.distdyn=new C.Buf32(r),e.sane=1,e.back=-1,V):F}function o(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,s(t)):F}function l(t,e){var i,n;return t&&t.state?(n=t.state,e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?F:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=i,n.wbits=e,o(t))):F}function h(t,e){var i,n;return t?(n=new a,(t.state=n).window=null,(i=l(t,e))!==V&&(t.state=null),i):F}var u,c,_=!0;function k(t){if(_){var e;for(u=new C.Buf32(512),c=new C.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(O(P,t.lens,0,288,u,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;O(N,t.lens,0,32,c,0,t.work,{bits:5}),_=!1}t.lencode=u,t.lenbits=9,t.distcode=c,t.distbits=5}function H(t,e,i,n){var r,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new C.Buf8(a.wsize)),n>=a.wsize?(C.arraySet(a.window,e,i-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(n<(r=a.wsize-a.wnext)&&(r=n),C.arraySet(a.window,e,i-n,r,a.wnext),(n-=r)?(C.arraySet(a.window,e,i-n,n,0),a.wnext=n,a.whave=a.wsize):(a.wnext+=r,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=r))),0}i.inflateReset=o,i.inflateReset2=l,i.inflateResetKeep=s,i.inflateInit=function(t){return h(t,15)},i.inflateInit2=h,i.inflate=function(t,e){var i,n,r,a,s,o,l,h,u,c,_,d,f,p,m,g,v,y,x,E,T,S,w,M,D=0,I=new C.Buf8(4),b=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return F;12===(i=t.state).mode&&(i.mode=13),s=t.next_out,r=t.output,l=t.avail_out,a=t.next_in,n=t.input,o=t.avail_in,h=i.hold,u=i.bits,c=o,_=l,S=V;t:for(;;)switch(i.mode){case B:if(0===i.wrap){i.mode=13;break}for(;u<16;){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}if(2&i.wrap&&35615===h){I[i.check=0]=255&h,I[1]=h>>>8&255,i.check=R(i.check,I,2,0),u=h=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&h)<<8)+(h>>8))%31){t.msg="incorrect header check",i.mode=30;break}if(8!=(15&h)){t.msg="unknown compression method",i.mode=30;break}if(u-=4,T=8+(15&(h>>>=4)),0===i.wbits)i.wbits=T;else if(T>i.wbits){t.msg="invalid window size",i.mode=30;break}i.dmax=1<<T,t.adler=i.check=1,i.mode=512&h?10:12,u=h=0;break;case 2:for(;u<16;){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}if(i.flags=h,8!=(255&i.flags)){t.msg="unknown compression method",i.mode=30;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=30;break}i.head&&(i.head.text=h>>8&1),512&i.flags&&(I[0]=255&h,I[1]=h>>>8&255,i.check=R(i.check,I,2,0)),u=h=0,i.mode=3;case 3:for(;u<32;){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}i.head&&(i.head.time=h),512&i.flags&&(I[0]=255&h,I[1]=h>>>8&255,I[2]=h>>>16&255,I[3]=h>>>24&255,i.check=R(i.check,I,4,0)),u=h=0,i.mode=4;case 4:for(;u<16;){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}i.head&&(i.head.xflags=255&h,i.head.os=h>>8),512&i.flags&&(I[0]=255&h,I[1]=h>>>8&255,i.check=R(i.check,I,2,0)),u=h=0,i.mode=5;case 5:if(1024&i.flags){for(;u<16;){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}i.length=h,i.head&&(i.head.extra_len=h),512&i.flags&&(I[0]=255&h,I[1]=h>>>8&255,i.check=R(i.check,I,2,0)),u=h=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(o<(d=i.length)&&(d=o),d&&(i.head&&(T=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),C.arraySet(i.head.extra,n,a,d,T)),512&i.flags&&(i.check=R(i.check,n,d,a)),o-=d,a+=d,i.length-=d),i.length))break t;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===o)break t;for(d=0;T=n[a+d++],i.head&&T&&i.length<65536&&(i.head.name+=String.fromCharCode(T)),T&&d<o;);if(512&i.flags&&(i.check=R(i.check,n,d,a)),o-=d,a+=d,T)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===o)break t;for(d=0;T=n[a+d++],i.head&&T&&i.length<65536&&(i.head.comment+=String.fromCharCode(T)),T&&d<o;);if(512&i.flags&&(i.check=R(i.check,n,d,a)),o-=d,a+=d,T)break t}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;u<16;){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}if(h!==(65535&i.check)){t.msg="header crc mismatch",i.mode=30;break}u=h=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=12;break;case 10:for(;u<32;){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}t.adler=i.check=U(h),u=h=0,i.mode=11;case 11:if(0===i.havedict)return t.next_out=s,t.avail_out=l,t.next_in=a,t.avail_in=o,i.hold=h,i.bits=u,2;t.adler=i.check=1,i.mode=12;case 12:if(5===e||6===e)break t;case 13:if(i.last){h>>>=7&u,u-=7&u,i.mode=27;break}for(;u<3;){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}switch(i.last=1&h,u-=1,3&(h>>>=1)){case 0:i.mode=14;break;case 1:if(k(i),i.mode=20,6!==e)break;h>>>=2,u-=2;break t;case 2:i.mode=17;break;case 3:t.msg="invalid block type",i.mode=30}h>>>=2,u-=2;break;case 14:for(h>>>=7&u,u-=7&u;u<32;){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}if((65535&h)!=(h>>>16^65535)){t.msg="invalid stored block lengths",i.mode=30;break}if(i.length=65535&h,u=h=0,i.mode=15,6===e)break t;case 15:i.mode=16;case 16:if(d=i.length){if(o<d&&(d=o),l<d&&(d=l),0===d)break t;C.arraySet(r,n,a,d,s),o-=d,a+=d,l-=d,s+=d,i.length-=d;break}i.mode=12;break;case 17:for(;u<14;){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}if(i.nlen=257+(31&h),h>>>=5,u-=5,i.ndist=1+(31&h),h>>>=5,u-=5,i.ncode=4+(15&h),h>>>=4,u-=4,286<i.nlen||30<i.ndist){t.msg="too many length or distance symbols",i.mode=30;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;u<3;){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}i.lens[b[i.have++]]=7&h,h>>>=3,u-=3}for(;i.have<19;)i.lens[b[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,w={bits:i.lenbits},S=O(0,i.lens,0,19,i.lencode,0,i.work,w),i.lenbits=w.bits,S){t.msg="invalid code lengths set",i.mode=30;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;g=(D=i.lencode[h&(1<<i.lenbits)-1])>>>16&255,v=65535&D,!((m=D>>>24)<=u);){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}if(v<16)h>>>=m,u-=m,i.lens[i.have++]=v;else{if(16===v){for(M=m+2;u<M;){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}if(h>>>=m,u-=m,0===i.have){t.msg="invalid bit length repeat",i.mode=30;break}T=i.lens[i.have-1],d=3+(3&h),h>>>=2,u-=2}else if(17===v){for(M=m+3;u<M;){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}u-=m,T=0,d=3+(7&(h>>>=m)),h>>>=3,u-=3}else{for(M=m+7;u<M;){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}u-=m,T=0,d=11+(127&(h>>>=m)),h>>>=7,u-=7}if(i.have+d>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=30;break}for(;d--;)i.lens[i.have++]=T}}if(30===i.mode)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=30;break}if(i.lenbits=9,w={bits:i.lenbits},S=O(P,i.lens,0,i.nlen,i.lencode,0,i.work,w),i.lenbits=w.bits,S){t.msg="invalid literal/lengths set",i.mode=30;break}if(i.distbits=6,i.distcode=i.distdyn,w={bits:i.distbits},S=O(N,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,w),i.distbits=w.bits,S){t.msg="invalid distances set",i.mode=30;break}if(i.mode=20,6===e)break t;case 20:i.mode=21;case 21:if(6<=o&&258<=l){t.next_out=s,t.avail_out=l,t.next_in=a,t.avail_in=o,i.hold=h,i.bits=u,L(t,_),s=t.next_out,r=t.output,l=t.avail_out,a=t.next_in,n=t.input,o=t.avail_in,h=i.hold,u=i.bits,12===i.mode&&(i.back=-1);break}for(i.back=0;g=(D=i.lencode[h&(1<<i.lenbits)-1])>>>16&255,v=65535&D,!((m=D>>>24)<=u);){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}if(g&&0==(240&g)){for(y=m,x=g,E=v;g=(D=i.lencode[E+((h&(1<<y+x)-1)>>y)])>>>16&255,v=65535&D,!(y+(m=D>>>24)<=u);){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}h>>>=y,u-=y,i.back+=y}if(h>>>=m,u-=m,i.back+=m,i.length=v,0===g){i.mode=26;break}if(32&g){i.back=-1,i.mode=12;break}if(64&g){t.msg="invalid literal/length code",i.mode=30;break}i.extra=15&g,i.mode=22;case 22:if(i.extra){for(M=i.extra;u<M;){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}i.length+=h&(1<<i.extra)-1,h>>>=i.extra,u-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;g=(D=i.distcode[h&(1<<i.distbits)-1])>>>16&255,v=65535&D,!((m=D>>>24)<=u);){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}if(0==(240&g)){for(y=m,x=g,E=v;g=(D=i.distcode[E+((h&(1<<y+x)-1)>>y)])>>>16&255,v=65535&D,!(y+(m=D>>>24)<=u);){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}h>>>=y,u-=y,i.back+=y}if(h>>>=m,u-=m,i.back+=m,64&g){t.msg="invalid distance code",i.mode=30;break}i.offset=v,i.extra=15&g,i.mode=24;case 24:if(i.extra){for(M=i.extra;u<M;){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}i.offset+=h&(1<<i.extra)-1,h>>>=i.extra,u-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=30;break}i.mode=25;case 25:if(0===l)break t;if(d=_-l,i.offset>d){if((d=i.offset-d)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=30;break}f=d>i.wnext?(d-=i.wnext,i.wsize-d):i.wnext-d,d>i.length&&(d=i.length),p=i.window}else p=r,f=s-i.offset,d=i.length;for(l<d&&(d=l),l-=d,i.length-=d;r[s++]=p[f++],--d;);0===i.length&&(i.mode=21);break;case 26:if(0===l)break t;r[s++]=i.length,l--,i.mode=21;break;case 27:if(i.wrap){for(;u<32;){if(0===o)break t;o--,h|=n[a++]<<u,u+=8}if(_-=l,t.total_out+=_,i.total+=_,_&&(t.adler=i.check=i.flags?R(i.check,r,_,s-_):A(i.check,r,_,s-_)),_=l,(i.flags?h:U(h))!==i.check){t.msg="incorrect data check",i.mode=30;break}u=h=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;u<32;){if(0===o)break t;o--,h+=n[a++]<<u,u+=8}if(h!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=30;break}u=h=0}i.mode=29;case 29:S=1;break t;case 30:S=-3;break t;case 31:return-4;case 32:default:return F}return t.next_out=s,t.avail_out=l,t.next_in=a,t.avail_in=o,i.hold=h,i.bits=u,(i.wsize||_!==t.avail_out&&i.mode<30&&(i.mode<27||4!==e))&&H(t,t.output,t.next_out,_-t.avail_out)?(i.mode=31,-4):(c-=t.avail_in,_-=t.avail_out,t.total_in+=c,t.total_out+=_,i.total+=_,i.wrap&&_&&(t.adler=i.check=i.flags?R(i.check,r,_,t.next_out-_):A(i.check,r,_,t.next_out-_)),t.data_type=i.bits+(i.last?64:0)+(12===i.mode?128:0)+(20===i.mode||15===i.mode?256:0),(0===c&&0===_||4===e)&&S===V&&(S=-5),S)},i.inflateEnd=function(t){if(!t||!t.state)return F;var e=t.state;return e.window&&(e.window=null),t.state=null,V},i.inflateGetHeader=function(t,e){var i;return t&&t.state?0==(2&(i=t.state).wrap)?F:((i.head=e).done=!1,V):F},i.inflateSetDictionary=function(t,e){var i,n=e.length;return t&&t.state?0!==(i=t.state).wrap&&11!==i.mode?F:11===i.mode&&A(1,e,n,0)!==i.check?-3:H(t,e,n,n)?(i.mode=31,-4):(i.havedict=1,V):F},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./inffast":69,"./inftrees":71}],71:[function(t,e,i){"use strict";var P=t("../utils/common"),N=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],V=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],F=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],B=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,i,n,r,a,s,o){var l,h,u,c,_,d,f,p,m,g=o.bits,v=0,y=0,x=0,E=0,T=0,S=0,w=0,M=0,D=0,I=0,b=null,C=0,A=new P.Buf16(16),R=new P.Buf16(16),L=null,O=0;for(v=0;v<=15;v++)A[v]=0;for(y=0;y<n;y++)A[e[i+y]]++;for(T=g,E=15;1<=E&&0===A[E];E--);if(E<T&&(T=E),0===E)return r[a++]=20971520,r[a++]=20971520,o.bits=1,0;for(x=1;x<E&&0===A[x];x++);for(T<x&&(T=x),v=M=1;v<=15;v++)if(M<<=1,(M-=A[v])<0)return-1;if(0<M&&(0===t||1!==E))return-1;for(R[1]=0,v=1;v<15;v++)R[v+1]=R[v]+A[v];for(y=0;y<n;y++)0!==e[i+y]&&(s[R[e[i+y]]++]=y);if(d=0===t?(b=L=s,19):1===t?(b=N,C-=257,L=V,O-=257,256):(b=F,L=B,-1),v=x,_=a,w=y=I=0,u=-1,c=(D=1<<(S=T))-1,1===t&&852<D||2===t&&592<D)return 1;for(;;){for(f=v-w,m=s[y]<d?(p=0,s[y]):s[y]>d?(p=L[O+s[y]],b[C+s[y]]):(p=96,0),l=1<<v-w,x=h=1<<S;r[_+(I>>w)+(h-=l)]=f<<24|p<<16|m|0,0!==h;);for(l=1<<v-1;I&l;)l>>=1;if(0!==l?(I&=l-1,I+=l):I=0,y++,0==--A[v]){if(v===E)break;v=e[i+s[y]]}if(T<v&&(I&c)!==u){for(0===w&&(w=T),_+=x,M=1<<(S=v-w);S+w<E&&!((M-=A[S+w])<=0);)S++,M<<=1;if(D+=1<<S,1===t&&852<D||2===t&&592<D)return 1;r[u=I&c]=T<<24|S<<16|_-a|0}}return 0!==I&&(r[_+I]=v-w<<24|64<<16|0),o.bits=T,0}},{"../utils/common":62}],72:[function(t,e,i){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],73:[function(t,e,i){"use strict";var l=t("../utils/common"),o=0,h=1;function n(t){for(var e=t.length;0<=--e;)t[e]=0}var u=0,s=29,c=256,_=c+1+s,d=30,f=19,m=2*_+1,g=15,r=16,p=7,v=256,y=16,x=17,E=18,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],S=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],D=new Array(2*(_+2));n(D);var I=new Array(2*d);n(I);var b=new Array(512);n(b);var C=new Array(256);n(C);var A=new Array(s);n(A);var R,L,O,P=new Array(d);function N(t,e,i,n,r){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=n,this.max_length=r,this.has_stree=t&&t.length}function a(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function V(t){return t<256?b[t]:b[256+(t>>>7)]}function F(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function B(t,e,i){t.bi_valid>r-i?(t.bi_buf|=e<<t.bi_valid&65535,F(t,t.bi_buf),t.bi_buf=e>>r-t.bi_valid,t.bi_valid+=i-r):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function U(t,e,i){B(t,i[2*e],i[2*e+1])}function k(t,e){for(var i=0;i|=1&t,t>>>=1,i<<=1,0<--e;);return i>>>1}function H(t,e,i){var n,r,a=new Array(g+1),s=0;for(n=1;n<=g;n++)a[n]=s=s+i[n-1]<<1;for(r=0;r<=e;r++){var o=t[2*r+1];0!==o&&(t[2*r]=k(a[o]++,o))}}function z(t){var e;for(e=0;e<_;e++)t.dyn_ltree[2*e]=0;for(e=0;e<d;e++)t.dyn_dtree[2*e]=0;for(e=0;e<f;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*v]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function G(t){8<t.bi_valid?F(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function W(t,e,i,n){var r=2*e,a=2*i;return t[r]<t[a]||t[r]===t[a]&&n[e]<=n[i]}function X(t,e,i){for(var n=t.heap[i],r=i<<1;r<=t.heap_len&&(r<t.heap_len&&W(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!W(e,n,t.heap[r],t.depth));)t.heap[i]=t.heap[r],i=r,r<<=1;t.heap[i]=n}function Y(t,e,i){var n,r,a,s,o=0;if(0!==t.last_lit)for(;n=t.pending_buf[t.d_buf+2*o]<<8|t.pending_buf[t.d_buf+2*o+1],r=t.pending_buf[t.l_buf+o],o++,0===n?U(t,r,e):(U(t,(a=C[r])+c+1,e),0!==(s=T[a])&&B(t,r-=A[a],s),U(t,a=V(--n),i),0!==(s=S[a])&&B(t,n-=P[a],s)),o<t.last_lit;);U(t,v,e)}function j(t,e){var i,n,r,a=e.dyn_tree,s=e.stat_desc.static_tree,o=e.stat_desc.has_stree,l=e.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=m,i=0;i<l;i++)0!==a[2*i]?(t.heap[++t.heap_len]=h=i,t.depth[i]=0):a[2*i+1]=0;for(;t.heap_len<2;)a[2*(r=t.heap[++t.heap_len]=h<2?++h:0)]=1,t.depth[r]=0,t.opt_len--,o&&(t.static_len-=s[2*r+1]);for(e.max_code=h,i=t.heap_len>>1;1<=i;i--)X(t,a,i);for(r=l;i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],X(t,a,1),n=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=n,a[2*r]=a[2*i]+a[2*n],t.depth[r]=(t.depth[i]>=t.depth[n]?t.depth[i]:t.depth[n])+1,a[2*i+1]=a[2*n+1]=r,t.heap[1]=r++,X(t,a,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],function(t,e){var i,n,r,a,s,o,l=e.dyn_tree,h=e.max_code,u=e.stat_desc.static_tree,c=e.stat_desc.has_stree,_=e.stat_desc.extra_bits,d=e.stat_desc.extra_base,f=e.stat_desc.max_length,p=0;for(a=0;a<=g;a++)t.bl_count[a]=0;for(l[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<m;i++)f<(a=l[2*l[2*(n=t.heap[i])+1]+1]+1)&&(a=f,p++),l[2*n+1]=a,h<n||(t.bl_count[a]++,s=0,d<=n&&(s=_[n-d]),o=l[2*n],t.opt_len+=o*(a+s),c&&(t.static_len+=o*(u[2*n+1]+s)));if(0!==p){do{for(a=f-1;0===t.bl_count[a];)a--;t.bl_count[a]--,t.bl_count[a+1]+=2,t.bl_count[f]--,p-=2}while(0<p);for(a=f;0!==a;a--)for(n=t.bl_count[a];0!==n;)h<(r=t.heap[--i])||(l[2*r+1]!==a&&(t.opt_len+=(a-l[2*r+1])*l[2*r],l[2*r+1]=a),n--)}}(t,e),H(a,h,t.bl_count)}function Z(t,e,i){var n,r,a=-1,s=e[1],o=0,l=7,h=4;for(0===s&&(l=138,h=3),e[2*(i+1)+1]=65535,n=0;n<=i;n++)r=s,s=e[2*(n+1)+1],++o<l&&r===s||(o<h?t.bl_tree[2*r]+=o:0!==r?(r!==a&&t.bl_tree[2*r]++,t.bl_tree[2*y]++):o<=10?t.bl_tree[2*x]++:t.bl_tree[2*E]++,a=r,h=(o=0)===s?(l=138,3):r===s?(l=6,3):(l=7,4))}function K(t,e,i){var n,r,a=-1,s=e[1],o=0,l=7,h=4;for(0===s&&(l=138,h=3),n=0;n<=i;n++)if(r=s,s=e[2*(n+1)+1],!(++o<l&&r===s)){if(o<h)for(;U(t,r,t.bl_tree),0!=--o;);else 0!==r?(r!==a&&(U(t,r,t.bl_tree),o--),U(t,y,t.bl_tree),B(t,o-3,2)):o<=10?(U(t,x,t.bl_tree),B(t,o-3,3)):(U(t,E,t.bl_tree),B(t,o-11,7));a=r,h=(o=0)===s?(l=138,3):r===s?(l=6,3):(l=7,4)}}n(P);var q=!1;function Q(t,e,i,n){var r,a,s,o;B(t,(u<<1)+(n?1:0),3),a=e,s=i,o=!0,G(r=t),o&&(F(r,s),F(r,~s)),l.arraySet(r.pending_buf,r.window,a,s,r.pending),r.pending+=s}i._tr_init=function(t){q||(function(){var t,e,i,n,r,a=new Array(g+1);for(n=i=0;n<s-1;n++)for(A[n]=i,t=0;t<1<<T[n];t++)C[i++]=n;for(C[i-1]=n,n=r=0;n<16;n++)for(P[n]=r,t=0;t<1<<S[n];t++)b[r++]=n;for(r>>=7;n<d;n++)for(P[n]=r<<7,t=0;t<1<<S[n]-7;t++)b[256+r++]=n;for(e=0;e<=g;e++)a[e]=0;for(t=0;t<=143;)D[2*t+1]=8,t++,a[8]++;for(;t<=255;)D[2*t+1]=9,t++,a[9]++;for(;t<=279;)D[2*t+1]=7,t++,a[7]++;for(;t<=287;)D[2*t+1]=8,t++,a[8]++;for(H(D,_+1,a),t=0;t<d;t++)I[2*t+1]=5,I[2*t]=k(t,5);R=new N(D,T,c+1,_,g),L=new N(I,S,0,d,g),O=new N(new Array(0),w,0,f,p)}(),q=!0),t.l_desc=new a(t.dyn_ltree,R),t.d_desc=new a(t.dyn_dtree,L),t.bl_desc=new a(t.bl_tree,O),t.bi_buf=0,t.bi_valid=0,z(t)},i._tr_stored_block=Q,i._tr_flush_block=function(t,e,i,n){var r,a,s=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return o;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return h;for(e=32;e<c;e++)if(0!==t.dyn_ltree[2*e])return h;return o}(t)),j(t,t.l_desc),j(t,t.d_desc),s=function(t){var e;for(Z(t,t.dyn_ltree,t.l_desc.max_code),Z(t,t.dyn_dtree,t.d_desc.max_code),j(t,t.bl_desc),e=f-1;3<=e&&0===t.bl_tree[2*M[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),r=t.opt_len+3+7>>>3,(a=t.static_len+3+7>>>3)<=r&&(r=a)):r=a=i+5,i+4<=r&&-1!==e?Q(t,e,i,n):4===t.strategy||a===r?(B(t,2+(n?1:0),3),Y(t,D,I)):(B(t,4+(n?1:0),3),function(t,e,i,n){var r;for(B(t,e-257,5),B(t,i-1,5),B(t,n-4,4),r=0;r<n;r++)B(t,t.bl_tree[2*M[r]+1],3);K(t,t.dyn_ltree,e-1),K(t,t.dyn_dtree,i-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,s+1),Y(t,t.dyn_ltree,t.dyn_dtree)),z(t),n&&G(t)},i._tr_tally=function(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(C[i]+c+1)]++,t.dyn_dtree[2*V(e)]++),t.last_lit===t.lit_bufsize-1},i._tr_align=function(t){var e;B(t,2,3),U(t,v,D),16===(e=t).bi_valid?(F(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}},{"../utils/common":62}],74:[function(t,e,i){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}]},{},[10])(10)});var WXTool=function(){function _(){}return _.init=function(){_.checkIpx(),_.GetConfigVersion(),_.getYXinfo(),_.getSystemInfo(),_.onShow(),_.onHide()},_.checkIpx=function(){Laya.Browser.onIPhone&&Math.abs(Laya.Browser.pixelRatio-3)<.01&&(_.onIpx=375==Laya.Browser.clientWidth&&812==Laya.Browser.clientHeight||812==Laya.Browser.clientWidth&&375==Laya.Browser.clientHeight)},Object.defineProperty(_,"shareBoole",{get:function(){return!0},enumerable:!0,configurable:!0}),_.GetIsShare=function(e){Laya.Browser.window.wx&&Laya.Browser.window.wx.request({url:_.contentString("https://gamecenter.phonecoolgame.com/app/getInfo?appid=wx73abab89c857c2d5&version="+_.fk_version),method:"GET",success:function(t){console.log("webLogin success",t),t&&t.data&&(console.log("分享开关访问返回参数",t.data),_.isShare="1"==t.data.showyd,e&&e()),_.GetShareContent()},fail:function(t){console.log("分享开关访问失败返回参数"),_.isShare=!1,_.GetShareContent()}}),Laya.Browser.window.wx&&Laya.Browser.window.wx.showShareMenu&&Laya.Browser.window.wx.showShareMenu({withShareTicket:!0,success:function(){console.log("showShareMenu:success")},fail:function(){console.log("showShareMenu:fail")},complete:function(){console.log("showShareMenu:complete")}})},_.contentString=function(t){var e=t;return e=Laya.Browser.onIOS?e+"&ptform=1":e},_.GetShareContent=function(){Laya.Browser.window.wx&&Laya.Browser.window.wx.request({url:_.contentString("https://cpgc.phonecoolgame.com/material/getMaterials?appid=wx73abab89c857c2d5"),method:"GET",success:function(t){if(console.log("webLogin success",t),t&&t.data){var e=t.data.data,i=[];for(var n in console.log("分享访问返回参数",e),e)e[n].length&&i.push(e[n]);_._shareCentent=i,console.log("WXTool.shareCentent",_._shareCentent);var r=-1,a=(i={},"");if(console.log("转发分享信息temp1=",_._shareCentent),_._shareCentent&&_._shareCentent.length&&(r=_.randomRange(0,_._shareCentent[0].length-1),i=_._shareCentent[0][r],a=i.content,_.score&&(a=i.content.replace("#score#",_.score.toString())),console.log("转发分享信息temp=",i,r)),!_.isShare)return;Laya.Browser.window.wx.onShareAppMessage(function(){return console.log("转发信息temp=",i.content),{title:i?a:"不给你点颜色看看，都不知道我的厉害",imageUrl:i?i.cdnurl:"share/share1.jpg",query:"&materialID="+i.materialID,success:function(t){i&&_.ReportShare(i.materialID),console.log("转发 sucess",t)},fail:function(t){MessageManager.event(_.SHARED_FAIL),console.log("shareFriend:fail")}}})}},fail:function(t){console.log("分享访问失败返回参数"),_._shareCentent=null}})},_.ReportShare=function(t){Laya.Browser.window.wx&&Laya.Browser.window.wx.request({url:_.contentString("https://cpgc.phonecoolgame.com/material/reportShare?appid=wx73abab89c857c2d5&materialID="+t),method:"GET",success:function(t){console.log("webLogin success",t),t&&t.data&&console.log("分享上报返回参数")},fail:function(t){console.log("分享上报失败返回参数")}})},_.getSystemInfo=function(){Laya.Browser.window.wx&&Laya.Browser.window.wx.getSystemInfo({success:function(t){_._systemInfo=t,_.wxBversionLess("2.3.0")||(_._isImitateShare=0),console.log("******************SDKVersion",_._systemInfo.SDKVersion,_._isImitateShare)}})},_.onShow=function(){var t=Laya.Browser.window.wx;t&&t.onShow(function(t){if(console.log("wx onshow",t.scene,t.query,t.shareTicket),MessageManager.event(_.GAMESTART),t.query&&(t.query.materialID&&_.ReportClick(t.query.materialID),"super_skin"==t.query.type&&(_._openId=t.query.openid,MessageManager.event(_.SUPER_SKIN)),"reborn_coin"==t.query.type&&(_._openId=t.query.openid,MessageManager.event(_.REBORN_COIN)),"reborn_libao"==t.query.type&&(_._openId=t.query.openid,MessageManager.event(_.REBORN_LIBAO)),t.query.gameRevied_1&&MessageManager.event(_.GAME_REVIED,t.query.gameRevied_1),_.channel_id=t.query.from?t.query.from:"1007"==t.scene||"1008"==t.scene||"1044"==t.scene||"1096"==t.scene?"share":"fkw001"),PlayerDataMgr.isPlayBgMusic){var e=Laya.SoundManager.playMusic("music/bgm_low.mp3");console.log("播放背景音乐",e)}if(_._isShareFriend){var i=_.shareTime+500;if(Laya.timer.once(i,_,_.onceTimeShare),_._isImitateShare){var n=(new Date).getTime();if(!_.judgeTimes(n,_._hideTime))return void Laya.timer.clear(_,_.onceTimeShare);console.log("***************虚拟分享成功"),_._tempID&&(_.ReportShare(_._tempID),_._tempID=null),console.log("打印isShare==============",_.isShare,_.shareSuccess),_.isShare&&_.shareSuccess&&_.shareSuccess(),MessageManager.event(_.SHARED_SUCCESS)}}})},_.onceTimeShare=function(){_._isShareFriend=!1},_.defaultShare=function(t,e){switch(void 0===e&&(e=-1),_.sharetype=e,_.share_mode){case _.MODE_SHARE_0:case _.MODE_SHARE_5:case _.MODE_SHARE_6:return void _.getVideo(t);case _.MODE_SHARE_1:return void(0==e?_.getVideo(t):_.shareFriend(t,_.sharetype));case _.MODE_SHARE_2:_.shareFriend(t,_.sharetype);break;case _.MODE_SHARE_3:case _.MODE_SHARE_4:_.ispingbi?_.getVideo(t):_.shareFriend(t,_.sharetype)}},_.reportSign=function(){_.httpRequest("https://lgworld.xd-game.com/GetSignForFengGuo","game_id="+_.gameId,function(t){console.log("wxTool reportSign success",t),_.reportIp(t)},"post",function(t){console.log("wxTool reportSign fail",t)})},_.reportIp=function(t){_.httpRequest("https://cpgc.phonecoolgame.com/address/getClientAddress","appid="+t.appid+"&time="+t.time+"&sign="+t.sign,function(t){console.log("wxTool reportIp success",t),0==t.ecode&&(_.ispingbi=-1!=_.pingbiArr.indexOf(t.city))},"post",function(t){console.log("wxTool reportSign fail",t)})},_.reportChannel=function(t,e){var i="";if(""!=_.wxOpenid){var n;switch(n=Laya.Browser.onIOS?"&platform=ios":"&platform=android",t){case 1:"http://tj.17fengyou.cn/create.php",i="channel_id="+e+"&game_id="+_.fg_game_id+"&openid="+_.wxOpenid+n+"&roleid=1&rolename=1&server_id=1";break;case 2:"http://tj.17fengyou.cn/login.php",i="channel_id="+e+"&game_id="+_.fg_game_id+"&openid="+_.wxOpenid+n+"&roleid=1&server_id=1";break;case 3:"http://tj.17fengyou.cn/create.php"}console.log("md5",i)}},_.judgeTimes=function(t,e){console.log("showTime",_._shareLxTime);var i=_.randomRange(0,1);return t-e<_.shareTime?(_.showTips(_._shareData.sharetips,!0,_.shareFriend,_.shareFail,null),_._shareLxTime+=1,!!((_._allShareTimes+=1)%2&&1==i)):_.shareCount<=(_._shareLxTime=0)?!(_._shareLxTime=0):!(_._allShareTimes%2&&0==i)},_.shareFail=function(){_._isShareFriend=!1,_._shareLxTime=0},_.onHide=function(){var t=Laya.Browser.window.wx;t&&t.onHide(function(t){_._hideTime=(new Date).getTime(),console.log("wx onhide",_._hideTime),MessageManager.event(_.GAMESTOP)})},_.getLaunchOptionsSync=function(){var t=Laya.Browser.window.wx;return t?t.getLaunchOptionsSync():null},_.ReportClick=function(t){Laya.Browser.window.wx&&Laya.Browser.window.wx.request({url:_.contentString("https://cpgc.phonecoolgame.com/material/reportClick?appid=wx73abab89c857c2d5&materialID="+t),method:"GET",success:function(t){console.log("webLogin success",t),t&&t.data&&console.log("分享点击上报返回参数")},fail:function(t){console.log("分享点击上报失败返回参数",t)}})},_.SetConfigVersion=function(){_.httpRequest("https://lgworld.xd-game.com/SetConfigForVersion","game_id="+_.gameId+"&versions="+_.version+"&pass_examine=0&banner_time=2000",function(t){console.log("wxTool SetConfigVersion success",t)},"post",function(t){console.log("wxTool SetConfigVersion fail",t)})},_.GetConfigVersion=function(e){_.httpRequest("https://lgworld.xd-game.com/GetConfigForVersion","game_id="+_.gameId+"&versions="+_.version,function(t){t&&"1"==t.server_info.pass_examine?(_.isShare=_.isSwithOpen=!0,_.shareTime=t.server_info.banner_time,_.shareCount=t.server_info.share_fail_count,_.reportShare=t.server_info.func_switch,e&&e()):t&&"0"==t.server_info.pass_examine&&(_.isShare=_.isSwithOpen=!1),console.log("wxTool GetConfigVersion success",t),_.GetShareContent()},"post",function(t){_.getswitch(e),console.log("wxTool GetConfigVersion fail",t),_.GetShareContent()})},_.getAdConfig=function(e){var t="";switch(e){case 1:t="https://cpgc.phonecoolgame.com/adc/getAdFrame?appid=wx73abab89c857c2d5";break;case 2:t="https://cpgc.phonecoolgame.com/adc/getBannerAdInfo?appid=wx73abab89c857c2d5";break;case 3:t="https://cpgc.phonecoolgame.com/adc/getLikeInfo?appid=wx73abab89c857c2d5";break;case 4:t="https://cpgc.phonecoolgame.com/adc/getMoreInfo?appid=wx73abab89c857c2d5"}_.httpRequest(_.contentString(t),"",function(t){console.log("getAdConfig success",t),t&&(console.log("访问返回参数"),_.updateAdView(e,t))},"get",function(t){console.log("访问失败返回参数",t)})},_.updateAdView=function(t,e){switch(t){case 1:if(_.adFrams||(_.adFrams=e.adFrames),console.log("访问返回参数 WXTool.adFrams",_.adFrams),_.adFrams){var i=_.getAdFrame();console.log("进入步骤2",i),_.loadAd(i)}break;case 2:_.bannerAd||(_.bannerAd=e.bannerAdInfo),_.isBanner=1==e.justgdt,console.log("WXTool.getBanner 初始化",_.bannerAd),Laya.timer.clear(_,_.getBanner),_.getBanner(),Laya.timer.loop(12e4,_,_.getBanner);break;case 3:_.likeInfo||(_.likeInfo=e.likeInfoList),console.log("访问返回参数  WXTool.likeInfo",_.likeInfo),_.likeInfo&&(console.log("进入步骤3"),_.getLikeInfo());break;case 4:_.moreInfo||(_.moreInfo=e.moreInfoList),"wx845a2f34af2f4235"==_.moreInfo.key&&Laya.Browser.onIOS&&(_.moreInfo.jmpid=_.randomRange(0,9))}},_.getAdFrame=function(){return _.adFrams?(_._curIdxAd==_.adFrams.length&&(_._curIdxAd=0),console.log("WXTool.curIdxAd",_.adFrams,_._curIdxAd,_.adFrams.length),_.adFrams[_._curIdxAd]):null},_.addAdFram=function(t,e,i){if(!_._isShareFriend&&_.sdkView&&e&&i){var n=i.size[0],r=i.size[1],a=i.len;1==a&&Laya.timer.clearAll(_),_._curIdx%n==0&&0!=_._curIdx&&(_._heightIdx--,_._curIdx=0);var s=e.sourceWidth/n*_._curIdx,o=e.sourceHeight/r*_._heightIdx;if(_._textTureArr.length<a){var l=Laya.Texture.createFromTexture(e,s+1,o+1,e.sourceWidth/n-1,e.sourceHeight/r-1);_._textTureArr.push(l)}if(_.sdkView&&_.sdkView.img_ad&&0<_._textTureArr.length){var h=_.sdkView.img_ad;if(h.width&&h.height&&h.graphics){var u=e.sourceWidth/n,c=e.sourceWidth/r;_.sdkView&&h&&h.hasOwnProperty("width")&&h.hasOwnProperty("height")&&h.hasOwnProperty("graphics")&&h._bitmap&&(h.width=u.toFixed(2),h.height=c.toFixed(2),h.graphics.clear()),_._textTureArr[_._xuhao]&&h.graphics.drawTexture(_._textTureArr[_._xuhao])}}1!=a&&(_._curIdx==n-1&&0==_._heightIdx?(_._curIdx=0,_._heightIdx=2,_._xuhao=0):(_._curIdx++,_._xuhao++))}},_.loadAd=function(t){_.sdkView&&t&&(console.log("点击跳转下一个",t.url),_._testTureTemp||(_._testTureTemp=new Texture),Laya.timer.clearAll(_),_._testTureTemp.load(t.url),Laya.timer.loop(3e3,_,_.againLoad,[t]),_.againLoad(t))},_.againLoad=function(e){3<=++_.countAd?Laya.timer.clear(_,_.againLoad):(console.log("加载跳转0",e.url),_.sdkView&&_._testTureTemp&&e&&Laya.loader.load(e.url,Handler.create(_,function(t){console.log("加载跳转",e.url),_._xuhao=0,_._heightIdx=2,_.countAd=0,_._curIdx=0,Laya.timer.clear(_,_.againLoad),_._testTureTemp=t,Laya.timer.frameLoop(10,_,_.addAdFram,[_.sdkView,_._testTureTemp,e])})))},_.clean=function(){console.log("设置猜你爱玩数据0"),Laya.timer.clear(_,_.addAdFram),Laya.timer.clear(_,_.againLoad),_._curIdxAd=0,(_._textTureArr=[]).length=0,_.sdkView&&_.sdkView.img_ad&&_.sdkView.img_ad.graphics.clear(),_._testTureTemp&&_._testTureTemp.destroy(),_._testTureTemp=null,_.isBooleBtnGo=!1},_.removeLoadAd=function(t){Laya.timer.clearAll(_),_._textTureArr=[],_._testTureTemp&&_._testTureTemp.destroy(),_._testTureTemp=null,_.sdkView&&(_.sdkView.img_ad.source=null),_._xuhao=0,_._heightIdx=2,_._curIdx=0},Object.defineProperty(_,"isML1",{get:function(){var t=_.getLaunchOptionsSync()?_.getLaunchOptionsSync().query:{};return 1==parseInt(t.ml)},enumerable:!0,configurable:!0}),_.adViewInit=function(t){if(t){_.sdkView=null,_.sdkView=t;var e=_.isML1;if((e&&_.isSwithOpen||!e)&&_.sdkView.img_ad&&(_.adFrams?_.updateAdView(1,_.adFrams):_.getAdConfig(1),_.sdkView.img_ad.on(LEvent.CLICK,_,_.adHander,[_.sdkView])),(_.isSwithOpen||!e)&&_.sdkView.img_0){_.likeInfo?_.updateAdView(3,_.likeInfo):_.getAdConfig(3);for(var i=0;i<3;i++)_.sdkView["img_"+i]&&_.sdkView["img_"+i].on(LEvent.CLICK,_,_.likeHander)}_.sdkView.img_ban&&(_.bannerAd?_.updateAdView(2,_.bannerAd):_.getAdConfig(2),console.log("初始化banner"),_.sdkView.img_ban.on(LEvent.CLICK,_,_.banHander,[_.sdkView])),_.moreInfo||_.getAdConfig(4)}},_.banHander=function(t){_.isBanner&&(console.log("WXTool.bannerAd",_.bannerAd),_.bannerAd&&(_.isBanner||_.nav("",_.bannerAd[0])))},_.adHander=function(t){if(_.adFrams&&_.sdkView){_.isboolStatue=2;var e=_.getAdFrame();console.log("进入步骤2_1",e),_.nav("",e),_._textTureArr=[],_._testTureTemp=null,_.sdkView&&_.sdkView.img_ad&&(_.sdkView.img_ad.source=null),_._curIdxAd++;var i=_.getAdFrame();_.loadAd(i)}},_.autoAd=function(){if(_.sdkView){_._textTureArr=[],_._testTureTemp=null,_.sdkView&&_.sdkView.img_ad&&(_.sdkView.img_ad.source=null),_._curIdxAd++;var t=_.getAdFrame();console.log("进入步骤3_2",t),_.loadAd(t)}},_.getMoreInfo=function(){},_.likeHander=function(t){if(_.sdkView&&_.likeInfo&&!(_.likeInfo.length<=0))switch(console.log("猜你好玩点击进入",t,_.likeInfo),_.isboolStatue=1,t.currentTarget){case _.sdkView.img_0:_.nav("",_.likeInfo[0]);break;case _.sdkView.img_1:_.nav("",_.likeInfo[1]);break;case _.sdkView.img_2:_.nav("",_.likeInfo[2])}},_.getLikeInfo=function(){if(console.log("设置猜你爱玩数据",_.likeInfo),_.likeInfo&&_.sdkView)for(var t=0;t<_.likeInfo.length;t++)_._mask||(_._mask=new Laya.Image),_.sdkView["img_"+t]&&(_._mask.skin=_.sdkView["img_"+t].skin),_.sdkView["img_"+t]&&(_.sdkView["img_"+t].skin=_.likeInfo[t].icon),_.sdkView["lab_name"+t]&&(_.sdkView["lab_name"+t].text=_.likeInfo[t].name)},_.getBanInfo=function(){if(_.sdkView&&_.bannerAd&&_.bannerAd.length){var t=_.bannerAd[0];_.isBanner||t&&(_.sdkView.img_ban.skin=t.url)}},_.getBanner=function(){if(_.isBannerShow&&Laya.Browser.window.wx){_._bananerBtn&&(_._bananerBtn.hide(),_._bananerBtn.destroy());var t=_.onIpx?Laya.Browser.clientHeight-110:Laya.Browser.clientHeight-75;(_._bananerBtn=Laya.Browser.window.wx.createBannerAd({adUnitId:"adunit-f135cad61f030a7a",style:{left:0,top:t}}))&&_._bananerBtn.onLoad(_.onloadBanner),_._bananerBtn&&_._bananerBtn.onResize(_.layouBanner),_._bananerBtn&&_._bananerBtn.onError(_.onBanError)}},_.onBanError=function(t){console.log(t)},_.onloadBanner=function(){_.layouBanner(),_._bananerBtn&&_._bananerBtn.show(),_._bananerBtn.offLoad(_.onloadBanner)},_.layouBanner=function(){if(_._bananerBtn){_.banHight!=_._bananerBtn.style.realHeight&&_._bananerBtn.style.realHeight&&(_.banHight=_._bananerBtn.style.realHeight);var t=100<_.banHight?90:_.banHight;_.isBooleBtnGo||(_.banTop=_._bananerBtn.style.top=_.onIpx?_.viewHight-t-30:_.viewHight-t-20),_.isShare||(_.banTop=_._bananerBtn.style.top=_.onIpx?_.viewHight-t-30:_.viewHight-t-10),_._bananerBtn.style.width=Laya.Browser.window.wx.getSystemInfoSync().screenWidth,console.log("banner==========>",_._bananerBtn.style.width),_._bananerBtn.offResize(_.layouBanner),_.getBtn_GO()}},_.getBtn_GO=function(t){t?_._bananerBtn&&(_.isBooleBtnGo=!0,_._bananerBtn.style.top=_.onIpx?(t.y+t.height)*(Laya.Browser.clientHeight/t.parent.height)-25:(t.y+t.height)*(Laya.Browser.clientHeight/t.parent.height)+15,Laya.Browser.window.wx&&(_._bananerBtn.style.width=Laya.Browser.window.wx.getSystemInfoSync().screenWidth)):_.isBooleBtnGo=!1},_.getVideo=function(t,i){if(""==_.VIDEO_ID&&_.isPlayError)t&&t();else if(Laya.Browser.window.wx){if(_.isplayVideo)return;_.isplayVideo=!0,_.video_show(t),_.viedoBtn.onClose(function t(e){e&&(e.isEnd||e.isEnded)?(_.isplayVideo=!1,_.isBannerShow=!1,_.clean(),MessageManager.event(_.VIDEO_SUCCESS),i&&i()):(_.isplayVideo=!1,_.isPlayError=!1),_.viedoBtn.offClose(t)})}},_.video_show=function(e){var t;t=_.VIDEO_ID,_.viedoBtn=Laya.Browser.window.wx.createRewardedVideoAd({adUnitId:t}),(_.videoData=_.viedoBtn.show()).catch(function(){_.viedoBtn.load().then(function(){_.viedoBtn&&_.viedoBtn.show()})}),_.viedoBtn.onError(function(t){_.isPlayError=!0,_.isplayVideo=!1,_.showTips("视频暂时无法观看，是否分享到群领取奖励？",null,function(){e&&e()},function(){e&&e()},null)})},_.nav=function(t,e){if(Laya.Browser.window.wx&&Laya.Browser.window.wx.navigateToMiniProgram){var i=Laya.Browser.onIOS?_.randomRange(1,9):_.randomRange(0,9),n=void 0;if(e){switch(_.isboolStatue){case 1:n=e.key;break;case 2:n=e.id;break;default:n=e&&e[0]?e[0].jmpid:e.jmpid}if(-1==_.navList.indexOf(n))return void _.setImage(e.share)}else n=Laya.Browser.onIOS?_.navList[i]:_.navList[0];Laya.Browser.window.wx.navigateToMiniProgram({appId:n,path:e?e.parm:"pages/main/main",success:function(t){console.log("跳转成功")}})}_.isboolStatue=0},_.setImage=function(t){if(Laya.Browser.window.wx){var e={};e.urls=[t],Laya.Browser.window.wx.previewImage(e)}},_.randomRange=function(t,e){return Math.floor((e-t+1)*Math.random())+t},_.shareFriend=function(t,e){if(Laya.Browser.window.wx){_.shareSuccess=t,_._isShareFriend=!0,_.sharetype=e;var i,n=-1,r={},a="",s="";if(_._shareCentent&&_._shareCentent.length&&(n=_.randomRange(0,_._shareCentent[0].length-1),a=(r=_._shareCentent[0][n]).content,_.score&&(a=r.content.replace("#score#",_.score.toString()))),i=r&&r.cdnurl&&0<r.cdnurl.length?r.cdnurl:"share/share1.jpg",_._tempID=r&&r.materialID?r.materialID:null,-1==_.sharetype)a=0<a.length?a:"不给你点颜色看看，都不知道我的厉害",s=r&&r.materialID&&0<r.materialID.length?"&materialID="+r.materialID:"";else if(1==_.sharetype)a="群雄逐鹿,看你排第几",s="type=opensort";else if(2==_.sharetype)a="恕我直言,玩的再差你们也赢不了",s="type=update&openid="+_.wxOpenid;else if(3==_.sharetype)a="有人@你 跪求绝版皮肤",s="type=super_skin&openid="+_.wxOpenid;else if(4==_.sharetype)a="救救小老弟吧",s="type=reborn_coin&openid="+_.wxOpenid;else if(5==_.sharetype)a="复活大礼包，点击帮领",s="type=reborn_libao&openid="+_.wxOpenid;else{var o=MathU.randomRange(0,_.SHARE_DESC_LIST.length-1);a=_.SHARE_DESC_LIST[o]}_._isShareInfo=!0,_.clean(),Laya.Browser.window.wx.shareAppMessage&&Laya.Browser.window.wx.shareAppMessage({title:a,imageUrl:i,query:s,success:function(t){MessageManager.event(_.SHARED_SUCCESS)},fail:function(t){console.log("shareFriend:fail")}})}},_.getYXinfo=function(){Laya.Browser.window.wx&&_.httpRequest(_.contentString("https://cpgc.phonecoolgame.com/adc/getAdexpInfo?appid=wx73abab89c857c2d5"),"",function(t){console.log("获得抽屉数据成功",t),t&&t.adexpList&&(console.log("设置参数",t.adexpList),_.gameInfo=t.adexpList)},"get",function(t){console.log("访问失败返回参数",t)})},_.goTrialRevied=function(r,a,s){var o=Laya.Browser.window.wx;o&&o.request({url:_.contentString("https://cpgc.phonecoolgame.com/adc/getAd4Reborn?appid=wx73abab89c857c2d5"),method:"GET",success:function(t){var e=t,i=e.jmpid||"wx845a2f34af2f4235";if(i){var n=e.parm||"pages/main/main?";n=0<(n=0<n.indexOf("?")?n:n+"?").indexOf("gender")?n:n+"&gender="+r,n+="&gameRevied=1",_.wxBversionLess("2.2.0")&&o.navigateToMiniProgram({appId:i,path:n,success:function(t){console.log("goTrialRevied success",t),a&&a()},fail:function(t){console.log("goTrialRevied fail",t),s&&s(t)}})}},fail:function(t){console.log("访问试玩复活信息失败返回参数",t)}})},_.jumpHZGetAward=function(t,e){var i=Laya.Browser.window.wx;i&&(this.wxBversionLess("2.2.0")?(console.log("满足2.2.0"),i.navigateToMiniProgram({appId:"wx845a2f34af2f4235",path:"pages/main/main?jumpHZGetAward=1&gender="+t,success:function(t){e&&e(!0)}})):(_.showTips("微信版本过低",!1,null,null,null),e&&e(!1)))},_.login=function(){Laya.Browser.window.wx&&Laya.Browser.window.wx.login({timeout:2e4,success:function(t){console.log("def login success",t),_.requestOpenid(t.code),Laya.Browser.window.wx.postMessage&&Laya.Browser.window.wx.postMessage({type:"getselfclouddata",userinfo:{},time:Laya.timer.currTimer})},fail:function(t){console.log("def login fail",t)}})},_.requestOpenid=function(t){_.httpRequest("https://t1.xd-game.com:1127/login","code="+t+"&game_id="+_.gameId,function(t){console.log("---------------------------requestOpenid success",t),t&&(_.wxOpenid=t.openid,_.reportChannel(1,_.channel_id),Laya.Browser.window.wx.postMessage&&Laya.Browser.window.wx.postMessage({type:"getOpenid",openid:t.openid}),MessageManager.event(_.SUPER_SKIN))})},_.getinvite=function(e){_.httpRequest("http://h5.xd-game.com/wx.php?s=/Wx/getinvite",'{ "openid": "'+_.wxOpenid+'", "gameid": '+_.gameId+'", "type": '+e+" }",function(t){console.log("wxTool getShareCount success",t),0==e?_.inviteCount=parseInt(t.msg):_.libaoCount=parseInt(t.msg.count)})},_.setinvite=function(t,e){_.httpRequest("http://h5.xd-game.com/wx.php?s=/Wx/setinvite",'{ "openid": "'+t+'", "gameid": '+_.gameId+', "invited_openid":"'+_.wxOpenid+', "type":"'+e+'" }',function(t){-1==t.result&&console.log("记录失败,已经助力过",t)})},_.getShareCount=function(e){_.reportShare&&_.httpRequest("https://h5.xd-game.com/wx.php?s=/Wx/getsharecount",'{ "openid": "'+_.wxOpenid+'", "gameid": '+_.gameId+" }",function(t){console.log("wxTool getShareCount success",t),_.sharecount=parseInt(t.msg.count),_.sharePlayers=t.msg.player,e&&e()})},_.setShareCount=function(t,e,i){_.reportShare&&_.httpRequest("https://h5.xd-game.com/wx.php?s=/Wx/setsharecount",'{ "openid": "'+t+'", "gameid": '+_.gameId+', "invited_openid":"'+_.wxOpenid+'", "invited_headurl":"'+e+'", "invited_name":"'+i+'" }',function(t){console.log("wxTool setShareCount success",t)})},_.getswitch=function(e){_.httpRequest("https://h5.xd-game.com/wx.php?s=/Wx/getswitch",'{ "version": "'+_.version+'", "appid":"wx73abab89c857c2d5" }',function(t){console.log("wxTool getswitch success",t),t&&"1"==t.msg&&(_.isShare=_.isSwithOpen=!0,e&&e())})},_.showTips=function(t,e,i,n,r){Laya.Browser.window.wx&&Laya.Browser.window.wx.showModal({title:r||"提示",content:t,showCancel:e,cancelText:"取消",confirmText:"重新分享",success:function(t){t.confirm?i&&i():t.cancel&&n&&n()},fail:function(){console.log("wx showModal fail")}})},_.httpRequest=function(i,n,e,r,a){void 0===r&&(r="post"),void 0===a&&(a=null);var s=new HttpRequest;s.once(LEvent.COMPLETE,_,function(t){console.log("[JSSdk]->httpRequest:",r,i,n,"info:"+t),null!=e&&e(JSON.parse(t)),s.offAll()}),s.once(LEvent.ERROR,_,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];console.log("[JSSdk]->httpRequest:http req error ",r,i,n,t),null!=a&&a.apply(null,t),s.offAll()}),console.log("[send]->httpRequest:",r,i,n),s.send(i,n,r)},_.parseUrlParameterToObj=function(t){var e={};if(t&&t.length)for(var i=t.substring(t.indexOf("?")+1,t.length).split("&"),n=0;n<i.length;n++){var r=i[n];e[r.substring(0,r.indexOf("=")).toLowerCase()]=r.substring(r.indexOf("=")+1,r.length)}return e},_.parseObjToUrlParameter=function(t){var e="";for(var i in t)e+="&"+i+"="+t[i];return e=e.substr(1,e.length)},_.wxBversionLess=function(t){return _.versionToInt(_._systemInfo.SDKVersion)>=_.versionToInt(t)},_.versionToInt=function(t){for(var e=t.split("."),i=0,n=0;n<e.length;n++){var r=e[n];i+=1e6*parseInt(r)/Math.pow(1e3,n)}return i},_.postDataOpen=function(t){Laya.Browser.window.wx&&Laya.Browser.window.wx.postMessage(t)},_.createWxUseInfoBtn=function(){if(console.log("创建登陆按钮"),Laya.Browser.window.wx&&Laya.Browser.window.wx.createUserInfoButton){var t=Laya.Browser.window.wx.getSystemInfoSync();_.userInfoButton=Laya.Browser.window.wx.createUserInfoButton({type:"text",text:"",style:{left:0,top:0,width:t.screenWidth,height:t.screenHeight}}),console.log("创建登陆按钮",t.screenWidth,t.screenHeight),_.userInfoButton.onTap(function(t){console.log("获取微信用户昵称",t),t.rawData&&(_.wxPlayInfo=JSON.parse(t.rawData),Laya.Browser.window.wx.postMessage&&Laya.Browser.window.wx.postMessage({type:"getselfclouddata",userinfo:_.wxPlayInfo,time:Laya.timer.currTimer})),_.userInfoButton.hide()}),_.userInfoButton.show()}},_.closePageOpen=function(t){var e={type:"closepage",page:t};Laya.Browser.window.wx&&Laya.Browser.window.wx.postMessage(e)},_.loadFenbao=function(){Laya.Browser.window.wx&&Laya.Browser.window.wx.loadSubpackage({name:"scene",success:function(t){MessageManager.event(_.LOADOK)},fail:function(t){}})},_.vibrateShort=function(){Laya.Browser.window.wx&&Laya.Browser.window.wx.vibrateShort&&Laya.Browser.window.wx.vibrateShort({success:function(t){},fail:function(){}})},_.vibrateLong=function(){Laya.Browser.window.wx&&Laya.Browser.window.wx.vibrateLong&&Laya.Browser.window.wx.vibrateLong({success:function(t){},fail:function(){}})},_}();WXTool.WXRESIZE="WXRESIZE",WXTool.GROUP_DATA="GROUP_DATA",WXTool.FRIEND_DATA="FRIEND_DATA",WXTool.CLOSE_CANVAS="CLOSE_CANVAS",WXTool.SHARED_SUCCESS="SHARED_SUCCESS",WXTool.SHARED_FAIL="SHARED_FAIL",WXTool.GROUP_SORT="GROUP_SORT",WXTool.LOADOK="LOADOK",WXTool.BLACKEVENT="BLACKEVENT",WXTool.VIDEO_SUCCESS="VIDEO_SUCCESS",WXTool.SUPER_SKIN="SUPER_SKIN",WXTool.REBORN_COIN="reborn_coin",WXTool.REBORN_LIBAO="reborn_libao",WXTool.GAME_REVIED="game_revied",WXTool.GAMESTART="GAMESTART",WXTool.GAMESTOP="GAMESTOP",WXTool.PAGE_UP="PAGE_UP",WXTool.PAGE_NEXT="PAGE_NEXT",WXTool.JINBI="jinbi",WXTool.version="1.1.6",WXTool.fk_version="0.92.6",WXTool.fg_game_id="159",WXTool.fg_game_key="z4yDh8F2pC4WrTnQgYevlOy74YQ3rqUy",WXTool.share_mode=0,WXTool.ispingbi=!1,WXTool.VIDEO_ID="adunit-a4afebfc10c81239",WXTool.IPHONEX_TOP=44/812,WXTool.IPHONEX_BOTTOM=34/812,WXTool.MODE_SHARE_0=0,WXTool.MODE_SHARE_1=1,WXTool.MODE_SHARE_2=2,WXTool.MODE_SHARE_3=3,WXTool.MODE_SHARE_4=4,WXTool.MODE_SHARE_5=5,WXTool.MODE_SHARE_6=6,WXTool.DIE_POS=340,WXTool.WIDTH=720,WXTool.HEIGHT=1280,WXTool.CATEGORY_DEFAUL=0,WXTool.CATEGORY_JIANTOU=2,WXTool.CATEGORY_TARGET=4,WXTool.CATEGORY_HAND=8,WXTool.CATEGORY_PLAY=16,WXTool._curDefendBody=60,WXTool.isTempRed=!1,WXTool.STATE_START=0,WXTool.STATE_GAMING=1,WXTool.STATE_FIRST_END=2,WXTool.STATE_RELIFE=3,WXTool.STATE_OVER=4,WXTool._state=0,WXTool.onIpx=!1,WXTool.isShare=!1,WXTool.isSwithOpen=!1,WXTool.pingbiArr=["北京","上海","深圳","广州"],WXTool._shareLxTime=0,WXTool._allShareTimes=0,WXTool.shareTime=3e3,WXTool.shareCount=3,WXTool.reportShare=1,WXTool.needShareTime=WXTool.shareTime-1e3,WXTool.isBanner=!1,WXTool.isBannerShow=!0,WXTool._curIdxAd=0,WXTool._textTureArr=[],WXTool._heightIdx=2,WXTool._curIdx=0,WXTool._xuhao=0,WXTool._isShareInfo=!1,WXTool.countAd=0,WXTool.isboolStatue=0,WXTool.viewHight=0,WXTool.viewWidth=0,WXTool.isBooleBtnGo=!1,WXTool.isplayVideo=!1,WXTool.isPlayError=!1,WXTool.navList=["wx845a2f34af2f4235","wxc7e310f0d21af54d","wxe57bfaaa884daed6","wxa2707f6d3b2f3856","wx3d2e2fa8c4ca3eaf","wx7207b404168ff0e4","wx868c10731a7c9891","wxc7b0f323d0d4b39a","wxa7e8912a8edb1257","wx4ef4ca9305f25543"],WXTool.reliveCount=0,WXTool.is_relive=!1,WXTool.SHARE_DESC_LIST=["duang~，duang~，duang~,你就能跟我一样帅！","弹指神功？过了1000分再和我说话吧","Q弹的手感，令人流连忘返~","没别的，就想看看你有多能耐","别人家的不知道，我们家的弹一弹一定是最好的"],WXTool._shareData={share:1,sharegap1:3e3,sharegap2:3e3,sharetips:"分享失败，请分享给好友或者群再试试！"},WXTool._isImitateShare=WXTool._shareData.share,WXTool._isShareFriend=!1,WXTool._tempID=null,WXTool.sharetype=-1,WXTool.gameInfo=[],WXTool.inviteCount=0,WXTool.libaoCount=0,WXTool.wxOpenid="",WXTool.gameId=18,WXTool.sharecount=0,WXTool._tryLoginCount=3;var onIPhoneX=!1,GameApp=function(){function p(){this.isNoLogin=!1,this.mutedMusic=!1,this.mutedSound=!1,this.SCENE_WIDTH=720,this.SCENE_HEIGHT=1280,this.delayTime=0,this.pageVisibility="",this._nextUpdateOpenZoneTime=0,this._clientX=0,this._clientY=0,this.isOut=!1,this._clientScale=1;location.href;this._preLoad=new PreLoad,this.isNoLogin=!0,this._sceneRoot=new SceneRoot(this),Laya.stage.addChild(this._sceneRoot),this._showRoot=new ShowRoot(this),Laya.stage.addChild(this._showRoot),this._uiRoot=new UIRoot(this),Laya.stage.addChild(this._uiRoot),this._blackBorder=new BlackBorder(this),Laya.stage.addChild(this._blackBorder),this._openZone=new Sprite,this._openZone.size(this.SCENE_WIDTH,this.SCENE_HEIGHT),Laya.stage.on(LEvent.MOUSE_DOWN,this,this.onMouseHandler),Laya.stage.on(LEvent.MOUSE_UP,this,this.onMouseHandler),Laya.stage.on(LEvent.MOUSE_OUT,this,this.onMouseHandler),Laya.stage.on(LEvent.MOUSE_MOVE,this,this.onMouseHandler),this._date=new Date,MessageManager.on(WXTool.LOADOK,this,this.onGameInit),isDebug&&this.onGameInit()}return Object.defineProperty(p.prototype,"openZone",{get:function(){return this._openZone},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"clientX",{get:function(){return this._clientX},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"clientY",{get:function(){return this._clientY},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"uiRoot",{get:function(){return this._uiRoot},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"sceneRoot",{get:function(){return this._sceneRoot},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"showRoot",{get:function(){return this._showRoot},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"preLoad",{get:function(){return this._preLoad},enumerable:!0,configurable:!0}),p.prototype.onGameInit=function(){var t=this;this._uiRoot.once(UIRoot.INIT,this,function(){t.mainPlayerData(),t.sceneRoot.enterScene(),t.showRoot.enterScene()})},p.prototype.onMouseHandler=function(t){this._sceneRoot&&this._sceneRoot.onMouseHandler(t)},p.prototype.openSortPage=function(t){void 0===t&&(t=null),this._uiRoot.openSortPage(t)},p.prototype.mainPlayerData=function(){this.mutedMusic=SoundManager.musicMuted=this.localStorageMgr.isMutedMusic,this.mutedSound=SoundManager.soundMuted=this.localStorageMgr.isMutedSound},p.prototype.onUpdate=function(t){1e3<=t&&(console.log("diff over 3000  11111",t),t=50,console.log("diff over 3000   22222",t)),this._uiRoot&&this._uiRoot.update(t),this.sceneRoot&&this.sceneRoot.onUpdate(t),this.showRoot&&this.showRoot.onUpdate(t)},p.prototype.getWeekOneDayByTime=function(t){if(!t)return 0;this._date.setTime(t);var e=this._date.getDay();0==e&&(e=7);var i=t-864e5*(e-1);0<i&&this._date.setTime(i);var n=this._date.getFullYear(),r=this._date.getMonth(),a=this._date.getDate(),s=n.toString()+r.toString()+a.toString();return parseInt(s)},Object.defineProperty(p.prototype,"clientScale",{get:function(){return this._clientScale},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"clientWidth",{get:function(){return this._clientWidth},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"clientHeight",{get:function(){return this._clientHeight},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"mouseLock",{set:function(t){this._uiRoot&&(this._uiRoot.mouseLock=t)},enumerable:!0,configurable:!0}),p.prototype.onResize=function(t,e){var i=Laya.stage.width,n=Laya.stage.height;console.log("手机型号ipx",onIPhoneX);var r=0,a=0,s=1;if(onIPhoneX){var o=i=Browser.clientWidth,l=n=Browser.clientHeight;i=Math.min(o,l),n=Math.max(o,l);var h=i*Browser.pixelRatio,u=n*Browser.pixelRatio,c=this.SCENE_WIDTH,_=this.SCENE_HEIGHT,d=h/c,f=u/_;s=Math.min(d,f),n=f<d?(i=_*(h/u),_):(i=c)*(u/h),console.log("比例",s,i,n,Laya.stage.width,Laya.stage.height,Browser.pixelRatio),Laya.stage.screenMode==Stage.SCREEN_HORIZONTAL?r=(i*=1-p.IPHONEX_TOP-p.IPHONEX_BOTTOM)*p.IPHONEX_TOP*s:Laya.stage.screenMode==Stage.SCREEN_VERTICAL?a=(n*=1-p.IPHONEX_TOP-p.IPHONEX_BOTTOM)*p.IPHONEX_TOP*s:0==window.orientation?a=(n*=1-p.IPHONEX_TOP-p.IPHONEX_BOTTOM)*p.IPHONEX_TOP*s:90==window.orientation?r=(i*=1-p.IPHONEX_TOP-p.IPHONEX_BOTTOM)*p.IPHONEX_TOP*s:-90==window.orientation&&(r=(i*=1-p.IPHONEX_TOP-p.IPHONEX_BOTTOM)*p.IPHONEX_BOTTOM*s),this._uiRoot&&(this._uiRoot.pos(r,a),this._uiRoot.scale(s,s)),this._sceneRoot&&(this._sceneRoot.pos(r,a),this._sceneRoot.scale(s,s))}this._clientWidth=i,this._clientHeight=n,this._clientScale=s,this._uiRoot&&this._uiRoot.resize(i,n),this._sceneRoot&&this._sceneRoot.resize(i,n),this._blackBorder&&this._blackBorder.resize(t,e)},p.prototype.getLocalHistoryScore=function(){var t=this._localStorageMgr.getJSON("score_info"),e=0;t?(e=t.score,this.getWeekOneDayByTime(Laya.timer.currTimer)!=t.time&&(e=0)):!(e=parseInt(this._localStorageMgr.getItem("history_score")))||isNaN(e)?e=0:this.setLocalHistoryScore(e);return console.log("getLocalHistoryScore",t,e),e},p.prototype.getDbHistoryScore=function(){return this.wxUserInfo&&this.wxUserInfo.bestScore?this.wxUserInfo.bestScore:0},p.prototype.uploadGrade=function(t,e){console.log("上传成绩在主域",t,e),1==e&&(this.wxUserInfo&&(this.wxUserInfo.bestScore=t),this._localStorageMgr.setItem("score",t.toString()));var i={type:"updatescore",score:t,etype:e};WXTool.postDataOpen(i)},p.prototype.getBeatPer=function(t){return 1e4<=t?99:7e3<=t&&t<1e4?90:4e3<=t&&t<7e3?80:1e3<=t&&t<4e3?70:60},p.prototype.setWxSelfInfo=function(t){t&&(console.log("主域 微信信息",t),this.wxUserInfo=t)},p.prototype.setLocalHistoryScore=function(t){var e={score:t,time:this.getWeekOneDayByTime(Laya.timer.currTimer)};this._localStorageMgr.setJSON("score_info",e)},p.prototype.showResutRankOpt=function(t,e){console.log("type"+t+"|"+e),1==t&&(this.wxUserInfo&&(this.wxUserInfo.bestScore=e),this.setLocalHistoryScore(e));var i={type:"openresult",showtype:t,score:e,time:Laya.timer.currTimer};WXTool.postDataOpen(i)},Object.defineProperty(p.prototype,"sync",{get:function(){return this._sync||(this._sync=new Sync(this)),this._sync},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"plyertDataMgr",{get:function(){return this._playerDataMgr||(this._playerDataMgr=new PlayerDataMgr(this)),this._playerDataMgr},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"localStorageMgr",{get:function(){return this._localStorageMgr||(this._localStorageMgr=new dou.managers.LocalStorageMgr(this)),this._localStorageMgr},enumerable:!0,configurable:!0}),p}(),dou,dou,dou,dou,dou,dou,dou,dou,dou,dou,dou,dou,dou,dou,dou,dou;GameApp.IPHONEX_TOP=44/812,GameApp.IPHONEX_BOTTOM=34/812,function(t){var r,e;r=t.utils||(t.utils={}),(e=function(){function t(){}return Object.defineProperty(t,"eventDispatcher",{get:function(){return this._eventDispatcher||(this._eventDispatcher=new EventDispatcher),this._eventDispatcher},enumerable:!0,configurable:!0}),t.on=function(t,e,i,n){return this.eventDispatcher.on(t,e,i,n)},t.once=function(t,e,i,n){return this.eventDispatcher.once(t,e,i,n)},t.off=function(t,e,i,n){return this.eventDispatcher.off(t,e,i,n)},t.event=function(t,e){return this.eventDispatcher.event(t,e)},t.addSearchPath=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=!1),i?(this._searchPaths.unshift(t),this._searchPathLangRes.unshift(e)):(this._searchPaths.push(t),this._searchPathLangRes.push(e))},t.loadVesionFile=function(){var i=this,t=window.vesionFileUrl;t&&""!=t?Laya.loader.load(t,Handler.create(this,function(t){var e=t?r.StringU.readZlibData(new ByteArray(t)):null;i.initVesionFiles(e)},null,!0)):this.initVesionFiles(null)},t.initVesionFiles=function(t){var i=this;if(t){var e=t.split("\n");this._defaultVesion=e[1];for(var n=2;n<e.length;n++)if(e[n]&&0!=e[n].length){var r=e[n].split(" ");this._VESION_FILES[r[0]]=r[1]}}this.baseFormatURL=Laya.URL.formatURL,Laya.URL.formatURL=function(t,e){return t=i.createVersion(t),i.baseFormatURL(t)},this.event(this.LOAD_VESION_COMPLETE),this.loadLangRes()},t.formatURL=function(t,e){return t},t.createVersion=function(t){var e=null;return(e=this._VESION_FILES&&this._VESION_FILES[t]?this._VESION_FILES[t]:this._defaultVesion)?t+"?v="+e:t},t.loadLangRes=function(e){var i=this;if(void 0===e&&(e=0),e>=this._searchPathLangRes.length)return Laya.URL.formatURL=function(t,e){return i.formatURL(t,e)},void this.event(this.LOAD_DATA_COMPLETE);var t=this._searchPathLangRes[e],n=this._searchPaths[e];e++,t&&""!=t?Laya.loader.load(n+t,Handler.create(this,function(t){i.initLang(t,n),i.loadLangRes(e)},null,!0)):this.loadLangRes(e)},t.initLang=function(t,e,i){if(void 0===i&&(i=!1),t){t=new ByteArray(t);var n=this._searchPathFiels[e];n||(n={},this._searchPathFiels[e]=n);r.StringU.readZlibData(t),(new Date).getTime(),r.StringU.readZlibData(t)}},Object.defineProperty(t,"httpProtocol",{get:function(){return Laya.Browser.httpProtocol},enumerable:!0,configurable:!0}),t.checkUrlProtocol=function(t){return this.httpsProtocol&&0==t.indexOf("http://")&&(t="https://"+t.substring(7)),t},t}()).LOAD_VESION_COMPLETE="LOAD_VESION_COMPLETE",e.LOAD_DATA_COMPLETE="LOAD_DATA_COMPLETE",e._searchPaths=[],e._searchPathLangRes=[],e._searchPathFiels={},e._VESION_FILES={},e.httpsProtocol=!1,r.Vesion=e}(dou||(dou={})),function(t){var e,i;e=t.utils||(t.utils={}),(i=function(){function a(t,e){this.x=t||0,this.y=e||0}return Object.defineProperty(a.prototype,"len",{get:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},set:function(t){this.normalize(),this.mul(t)},enumerable:!0,configurable:!0}),a.prototype.normalize=function(){var t=this.len;return 0<t&&(this.x=this.x/t,this.y=this.y/t),this},a.prototype.equal=function(t){var e=this.x>t.x?this.x-t.x:t.x-this.x;return(this.y>t.y?this.y-t.y:t.y-this.y)<1e-6&&e<1e-6},a.prototype.dist=function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},a.prototype.add=function(t){var e=this.x+t.x,i=this.y+t.y;return this.x=e,this.y=i,this},a.prototype.sub=function(t){var e=this.x-t.x,i=this.y-t.y;return this.x=e,this.y=i,this},a.sub=function(t,e,i){var n=e.x-i.x,r=e.y-i.y;return t||(t=a.vec2),t.x=n,t.y=r,t},a.prototype.mul=function(t){return this.x=this.x*t,this.y=this.y*t,this},a.prototype.set=function(t){this.x=t.x,this.y=t.y},a.prototype.lerp=function(t,e){var i=1-e;return this.x=this.x*i+t.x*e,this.y=this.y*i+t.y*e,this},a.prototype.fromToward=function(t,e){e||(e=8);var i=2*Math.PI*t/e,n=Math.cos(i),r=Math.sin(i);return this.x=n,this.y=r,this.normalize(),this},a.prototype.getToward=function(t){t||(t=8);var e=this.x,i=this.y,n=Math.atan2(i,e);n<0&&(n+=2*Math.PI);var r=n/(2*Math.PI/t),a=Math.floor(r+.5);return a==t?0:a},a.prototype.clone=function(){return new a(this.x,this.y)},a}()).zero=new i(0,0),i.temp=new i(0,0),i.vec2=new i,e.Vector2=i}(dou||(dou={})),function(t){var n,r,e;n=t.utils||(t.utils={}),r=laya.html.dom.HTMLDivElement,e=function(){function o(){}return o.setHtmlText=function(t,e,i){if(void 0===i&&(i=!0),!t)return null;if(!(t instanceof Laya.Text||t instanceof Laya.Label))return null;var n=o.findHtmlDiv(t),r=new RegExp("<(S*?)[^>]*>.*?|<.*? />");if(!e||!r.test(e))return n&&(n.removeChildren(),e||t.removeChild(n)),t.text=e||"",t instanceof Laya.Label&&(t=t.textField),i?[t.textWidth+8,t.textHeight+5]:[t.width,t.height];n?n.removeChildren():((n=new laya.html.dom.HTMLDivElement).style.color=t.color,n.style.stroke=t.stroke,n.style.strokeColor=t.strokeColor,n.style.fontSize=t.fontSize,n.style.font=t.font,n.style.leading=t.leading,n.style.height=t.height,n.style.bold=t.bold,n.width=t.width,n.style.align=t.align,t.addChild(n));var a,s=e.split("&");return 2==s.length?(!(a=s[1])||"left"!=a&&"center"!=a&&"right"!=a||(n.style.align=a),n.innerHTML=s[0]):n.innerHTML=e,n.layout(),t.text="",i?[n.contextWidth,n.contextHeight]:[n.width,n.height]},o.setHtmlEmName=function(t,e,i){if(void 0===i&&(i=!0),!t)return null;if(!(t instanceof Laya.Text||t instanceof Laya.Label))return null;var n=o.findHtmlDiv(t);if(!e)return n&&(n.removeChildren(),e||t.removeChild(n)),t.text=e||"",t instanceof Laya.Label&&(t=t.textField),i?[t.textWidth+8,t.textHeight+5]:[t.width,t.height];n?n.removeChildren():((n=new laya.html.dom.HTMLDivElement).style.color=t.color,n.style.stroke=t.stroke,n.style.strokeColor=t.strokeColor,n.style.fontSize=t.fontSize,n.style.font=t.font,n.style.leading=t.leading,n.style.height=t.height,n.style.bold=t.bold,n.width=t.width,n.style.align=t.align,t.addChild(n));var r,a=e.split("&");return 2==a.length?(!(r=a[1])||"left"!=r&&"center"!=r&&"right"!=r||(n.style.align=r),n.innerHTML=a[0]):n.innerHTML=e,n.layout(),t.text="",i?[n.contextWidth,n.contextHeight]:[n.width,n.height]},o.findHtmlDiv=function(t){for(var e,i=0;i<t.numChildren;i++)if((e=t.getChildAt(i))instanceof r)return e;return null},o.createLabel=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null);var i=new Label(t);return e&&(n.DisplayU.setCompAttr(i,e),e.hasOwnProperty("color")&&(i.color=e.color),e.hasOwnProperty("fontSize")&&(i.fontSize=e.fontSize),e.hasOwnProperty("stroke")&&(i.stroke=e.stroke),e.hasOwnProperty("strokeColor")&&(i.strokeColor=e.strokeColor)),i},o.clearLabel=function(t){return t&&t.destroy(!0),null},o}(),n.TextFieldU=e}(dou||(dou={})),function(t){var e,i;e=t.utils||(t.utils={}),(i=function(){function e(){}return e.getQualityColor=function(t){return t<=0||t>e.COLOR_QUALITYS.length?null:e.COLOR_QUALITYS[t-1]},e}()).COLOR_DEFAULT="#393939",i.COLOR_GREEN="#3eb23e",i.COLOR_RED="#fa565a",i.COLOR_GRAY="#777777",i.COLOR_BLACK="#000000",i.COLOR_WHITE="#ffffff",i.COLOR_QUALITYS=["#777777","#3eb23e","#0078ff","#cc00ff","#fa7c00"],e.TeaStyle=i}(dou||(dou={})),function(t){var e,i;e=t.utils||(t.utils={}),(i=function(){function e(){}return e.getColor=function(t){switch(t){case 1:return e.color_r;case 2:return e.color_g;case 3:return e.color_b}return e.color_r},e}()).TD_Vector3_0=new Laya.Vector3,i.TD_Vector3_1=new Laya.Vector3,i.TD_Vector3_2=new Laya.Vector3,i.TD_Vector4_0=new Laya.Vector4,i.TD_Vector4_1=new Laya.Vector4,i.TD_Vector4_2=new Laya.Vector4,i.color_r=new Laya.Vector4(1,0,0,1),i.color_g=new Laya.Vector4(0,1,0,1),i.color_b=new Laya.Vector4(0,0,1,1),e.TD=i}(dou||(dou={})),function(e){var t,i;t=e.utils||(e.utils={}),i=function(){function r(){}return r.substitute=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(null==t)return"";var n,r=e.length;1==r&&"array"==typeof e[0]?r=(n=e[0]).length:n=e;for(var a=0;a<r;a++)t=t.replace(new RegExp("\\{"+a+"\\}","g"),n[a]);return t},r.isEmpty=function(t){return null==t||0==t.length},r.trim=function(t){return null==t?null:this.rtrim(this.ltrim(t))},r.ltrim=function(t){if(null==t)return null;return t.replace(/^\s*/,"")},r.rtrim=function(t){if(null==t)return null;return t.replace(/\s*$/,"")},r.beginsWith=function(t,e){return e==t.substring(0,e.length)},r.endsWith=function(t,e){return e==t.substring(t.length-e.length)},r.getParameter=function(t,e){if(!t||0==t.length)return"";for(var i=t.substring(t.indexOf("?")+1,t.length).split("&"),n={},r=0;r<i.length;r++){var a=i[r];n[a.substring(0,a.indexOf("=")).toLowerCase()]=a.substring(a.indexOf("=")+1,a.length)}var s=n[e.toLowerCase()];return s&&void 0!==s?s:""},r.paddingLeft=function(t,e,i){var n=i-t.length;if(n<=0)return t;t=String(t);for(var r=0;r<n;r++)t=e+t;return t},r.readZlibData=function(t){var e=t.readUnsignedInt();this._tempBytesArray||(this._tempBytesArray=new ByteArray);var i=this._tempBytesArray;i.length=e,t.readBytes(i,0,e),i.uncompress();var n=i.readUTFBytes(i.length);return i.clear(),n},r.formatDate=function(t,e){if(!t)return null;var i={"y+":t.getFullYear(),"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),"S+":t.getMilliseconds()};for(var n in i)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?i[n]:("00"+i[n]).substr((""+i[n]).length)));return e},r.sampleNum=function(t){return t<=99999?t.toString():(t=Math.floor(t/1e4))<=99999?t+"万":(t=Math.floor(t/1e4))+"亿"},r.substituteByIndex=function(t,e,i){return null==t?"":t=t.replace(new RegExp("\\{"+e+"\\}","g"),i)},r.loadDisableWords=function(){r.DISABLE_WORDS||Laya.loader.load(e.Path.ui+"pingbi.txt",Handler.create(this,this.onLoadDisableWords),null,Loader.TEXT)},r.onLoadDisableWords=function(){var t=Loader.getRes(e.Path.ui+"pingbi.txt").split("\r\n");""==t[t.length-1]&&t.pop(),r.DISABLE_WORDS=t},r.checkDisableWords=function(t){for(var e=t.length,i=r.DISABLE_WORDS,n=0;n<i.length;n++)if(!(i[n].length>e)&&-1!=t.indexOf(i[n]))return!0;return!1},r}(),t.StringU=i}(dou||(dou={})),function(t){!function(t){var i=function(){function t(){}return t.malloc=function(t,e){void 0===e&&(e=null);for(var i,n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var a=this._pools[t.poolName];if(a&&(i=a.pull()),!i)if(e)switch(e.length){case 0:i=new t;break;case 1:i=new t(e[0]);break;case 2:i=new t(e[0],e[1]);break;case 3:i=new t(e[0],e[1],e[2]);break;case 4:i=new t(e[0],e[1],e[2],e[3]);break;case 5:i=new t(e[0],e[1],e[2],e[3],e[4]);break;case 6:i=new t(e[0],e[1],e[2],e[3],e[4],e[5]);break;case 7:i=new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6]);break;case 8:i=new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]);break;case 9:i=new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]);break;case 10:i=new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9])}else i=new t;return i.outPool.apply(i,n),i},t.free=function(t){var e=t.poolName,i=this._pools[e];i||(i=new n(e),this._pools[e]=i),t.intoPool(),i.push(t)},t.update=function(t){if(0<this._nextUpdateTime)this._nextUpdateTime-=t;else for(var e in this._nextUpdateTime=2e4,this._pools)this._pools[e].adaptSize()},t}();i.MOLD_DEBUG_STRICT=0,i.MOLD_RELEASE_FAIL_SAFE=1,i.mold=i.MOLD_RELEASE_FAIL_SAFE,i._pools={},i._nextUpdateTime=0,t.ObjectPools=i;var n=function(){function t(t){this._list=[],this._minSize=0,this._maxSize=0,this._mask=0,this._key=t}return t.prototype.push=function(t){var e=this._list.length;-1==this._list.indexOf(t)?this._list[e]=t:i.mold==i.MOLD_DEBUG_STRICT||(i.mold,i.MOLD_RELEASE_FAIL_SAFE)},t.prototype.pull=function(){var t,e=this._list.length-1;return 0<=e&&(t=this._list[e],this._list.length=e,this._minSize=Math.min(this._minSize,e),this._maxSize=Math.max(this._maxSize,e),this._mask=0),t},t.prototype.adaptSize=function(){this._mask++;var t=this._maxSize-this._minSize;this._mask<3&&(t+=2),this._list.length>t&&(this._list.length=t),this._minSize=this._maxSize=0},t}()}(t.utils||(t.utils={}))}(dou||(dou={})),function(t){var e,i;e=t.utils||(t.utils={}),(i=function(){function s(){}return s.randomRange=function(t,e){return Math.floor((e-t+1)*Math.random())+t},s.randomPointInCicle=function(t,e,i){var n=s.randomRange(e,i),r=360*Math.random(),a=new Point;return a.x=t.x+Math.sin(r*Math.PI/180)*n,a.y=t.y+Math.cos(r*Math.PI/180)*n,a},s.parseInt=function(t){return 0<=t?Math.floor(t):Math.ceil(t)},s.toInt=function(t){return this._byteArray||(this._byteArray=new ByteArray),this._byteArray.position=0,this._byteArray.writeInt(t),this._byteArray.position=0,this._byteArray.readInt()},s.getDistance=function(t,e,i,n){var r=t-i,a=e-n;return Math.sqrt(r*r+a*a)},s.getAngleTimeT=function(t){return Number(Laya.timer.currTimer%t/t)*Math.PI},s.getAngleByRotaion=function(t){return t%=t,Math.PI*Number(t/180)},s.getAngle=function(t,e,i,n){i-=t,n-=e;var r=Math.atan2(n,i);return r=0<=r?r:2*Math.PI+r},s.getRotation=function(t){return Math.round(180*Number(t/Math.PI))},s.randomBoolen=function(){return 0==Math.round(Math.random())},s.colorMatrix_adjust=function(t,e){var i=t+1,n=128*(1-i);return s.colorMatrix_concat([i,0,0,0,n,0,i,0,0,n,0,0,i,0,n,0,0,0,1,0],[1,0,0,0,e*=255,0,1,0,0,e,0,0,1,0,e,0,0,0,1,0])},s.colorMatrix_concat=function(t,e){for(var i=new Array(20),n=0,r=0;r<4;++r){for(var a=0;a<5;++a)i[n+a]=t[n]*e[a]+t[n+1]*e[a+5]+t[n+2]*e[a+10]+t[n+3]*e[a+15]+(4==a?t[n+4]:0);n+=5}return i},s}()).kTowardCount=8,i.RandomArray=function(t){for(var e=new Array(t),i=0;i<t;i++){var n=Math.floor(Math.random()*t);null==e[i]&&(e[i]=i),null==e[n]&&(e[n]=n);var r=e[i];e[i]=e[n],e[n]=r}return e},e.MathU=i}(dou||(dou={})),function(t){var e,i;e=t.utils||(t.utils={}),(i=function(){function s(){}return s.setMouseListener=function(t,e,i,n,r,a){void 0===r&&(r=null),void 0===a&&(a=null),null!=t?null==i||null==n&&null==r&&null==a||(e?(null!=n&&t.on(LEvent.CLICK,i,n),null!=r&&t.on(LEvent.CLICK,i,r),null!=a&&t.on(LEvent.CLICK,i,a)):(null!=n&&t.off(LEvent.CLICK,i,n),null!=r&&t.off(LEvent.CLICK,i,r),null!=a&&t.off(LEvent.CLICK,i,a))):logd("this EventDispatcher is null")},s.setEventListener=function(t,e,i,n,r){null!=t?null!=n&&null!=r&&(e?t.on(i,n,r):t.off(i,n,r)):logd("this EventDispatcher is null")},s.setCompAttr=function(t,e){e&&(e.hasOwnProperty("postion")&&t.pos(e.postion.x,e.postion.y),e.hasOwnProperty("x")&&(t.x=e.x),e.hasOwnProperty("y")&&(t.y=e.y),e.hasOwnProperty("width")&&(t.width=e.width),e.hasOwnProperty("height")&&(t.height=e.height),e.hasOwnProperty("alpha")&&(t.alpha=e.alpha),e.hasOwnProperty("scale")&&t.scale(e.scale,e.scale),e.hasOwnProperty("scaleX")&&(t.scaleX=e.scaleX),e.hasOwnProperty("scaleY")&&(t.scaleY=e.scaleY),e.hasOwnProperty("anchor")&&(t.anchorX=t.anchorY=e.anchor),e.hasOwnProperty("anchorX")&&(t.anchorX=e.anchorX),e.hasOwnProperty("anchorY")&&(t.anchorY=e.anchorY),e.hasOwnProperty("center")&&(t.centerX=t.centerY=e.center),e.hasOwnProperty("centerX")&&(t.centerX=e.centerX),e.hasOwnProperty("centerY")&&(t.centerY=e.centerY),e.hasOwnProperty("parent")&&(e.hasOwnProperty("index")?e.parent.addChildAt(t,e.index):e.parent.addChild(t)))},s.initMask=function(){s.MASK_IMG_TOP=new LImage(t.Path.ui+"tongyon/image_mask_top.png"),s.MASK_IMG_BOTTOM=new LImage(t.Path.ui+"tongyon/image_mask_bottom.png"),s.MASK_IMG_MIDDLE=new LImage(t.Path.ui+"tongyon/image_mask_middle.png"),s.MASK_IMG_LEFT=new LImage(t.Path.ui+"tongyon/image_mask_left.png"),s.MASK_IMG_RIGHT=new LImage(t.Path.ui+"tongyon/image_mask_right.png"),s.MASK_DICT=new Dictionary},s.onScrollChange=function(t,e){var i;(void 0===e&&(e=s.MASK_TYPE_NORMAL),t)&&(e!=s.MASK_TYPE_NULL?(t instanceof List?i=t.scrollBar:t instanceof Laya.Panel&&(i=t.vScrollBar),i&&i.isVertical&&(i.min!=i.max?i.value<=i.min?this.drawMaskByType(t,s.MASK_KIND_TOP):i.value>=i.max?this.drawMaskByType(t,s.MASK_KIND_BOTTOM):this.drawMaskByType(t,s.MASK_KIND_MIDDLE):e==s.MASK_TYPE_INIT&&this.drawMaskByType(t,s.MASK_KIND_ALL))):this.drawMaskByType(t,s.MASK_KIND_NULL))},s.drawMaskByType=function(t,e){if(void 0===e&&(e=s.MASK_KIND_ALL),t){var i=t.$_GID.toString();if(e==s.MASK_KIND_NULL)return t.parent&&t.parent.mask&&(t.parent.mask=null),void(s.MASK_DICT[i]&&delete s.MASK_DICT[i]);if(!s.MASK_DICT[i]||s.MASK_DICT[i].kind!=e){var n;s.MASK_DICT[i]?n=s.MASK_DICT[i].mask:((n=new Sprite).pos(t.x,t.y),n.size(t.width,t.height),t.parent.mask=n,s.MASK_DICT[i]={mask:n});var r=s.MASK_HEIGHT,a=n.graphics;switch(a.clear(),e){case s.MASK_KIND_ALL:a.fillTexture(s.MASK_IMG_MIDDLE.source,0,0,n.width,n.height,"repeat");break;case s.MASK_KIND_TOP:a.fillTexture(s.MASK_IMG_MIDDLE.source,0,0,n.width,n.height-r,"repeat"),a.fillTexture(s.MASK_IMG_BOTTOM.source,0,n.height-r,n.width,r,"repeat-x");break;case s.MASK_KIND_BOTTOM:a.fillTexture(s.MASK_IMG_TOP.source,0,0,n.width,r,"repeat-x"),a.fillTexture(s.MASK_IMG_MIDDLE.source,0,r,n.width,n.height-r,"repeat");break;case s.MASK_KIND_MIDDLE:a.fillTexture(s.MASK_IMG_TOP.source,0,0,n.width,r,"repeat-x"),a.fillTexture(s.MASK_IMG_MIDDLE.source,0,r,n.width,n.height-2*r,"repeat"),a.fillTexture(s.MASK_IMG_BOTTOM.source,0,n.height-r,n.width,r,"repeat-x")}s.MASK_DICT[i].kind=e}}},s.onHScrollChange=function(t,e){var i;(void 0===e&&(e=s.MASK_TYPE_NORMAL),t)&&(e!=s.MASK_TYPE_NULL?(t instanceof List?i=t.scrollBar:t instanceof Laya.Panel&&(i=t.hScrollBar),i&&!i.isVertical&&(i.min!=i.max?i.value<=i.min?this.drawHMaskByType(t,s.MASK_KIND_LEFT):i.value>=i.max?this.drawHMaskByType(t,s.MASK_KIND_RIGHT):this.drawHMaskByType(t,s.MASK_KIND_MIDDLE):e==s.MASK_TYPE_INIT&&this.drawHMaskByType(t,s.MASK_KIND_ALL))):this.drawHMaskByType(t,s.MASK_KIND_NULL))},s.drawHMaskByType=function(t,e){if(void 0===e&&(e=s.MASK_KIND_ALL),t){var i=t.$_GID.toString();if(e==s.MASK_KIND_NULL)return t.parent&&t.parent.mask&&(t.parent.mask=null),void(s.MASK_DICT[i]&&delete s.MASK_DICT[i]);if(!s.MASK_DICT[i]||s.MASK_DICT[i].kind!=e){var n;s.MASK_DICT[i]?n=s.MASK_DICT[i].mask:((n=new Sprite).pos(t.x,t.y),n.size(t.width,t.height),t.parent.mask=n,s.MASK_DICT[i]={mask:n});var r=s.MASK_WIDTH,a=n.graphics;switch(a.clear(),logd("drawHMaskByType",e),e){case s.MASK_KIND_ALL:a.fillTexture(s.MASK_IMG_MIDDLE.source,0,0,n.width,n.height,"repeat");break;case s.MASK_KIND_LEFT:a.fillTexture(s.MASK_IMG_MIDDLE.source,0,0,n.width-r,n.height,"repeat"),a.fillTexture(s.MASK_IMG_RIGHT.source,n.width-r,0,r,n.height,"repeat-y");break;case s.MASK_KIND_RIGHT:a.fillTexture(s.MASK_IMG_LEFT.source,0,0,r,n.height,"repeat-y"),a.fillTexture(s.MASK_IMG_MIDDLE.source,r,0,n.width-r,n.height,"repeat");break;case s.MASK_KIND_MIDDLE:a.fillTexture(s.MASK_IMG_LEFT.source,0,0,r,n.height,"repeat-y"),a.fillTexture(s.MASK_IMG_MIDDLE.source,r,0,n.width-2*r,n.height,"repeat"),a.fillTexture(s.MASK_IMG_RIGHT.source,n.width-r,0,r,n.height,"repeat-y")}s.MASK_DICT[i].kind=e}}},s}()).MASK_TYPE_NULL=0,i.MASK_TYPE_INIT=1,i.MASK_TYPE_NORMAL=2,i.MASK_KIND_NULL=0,i.MASK_KIND_ALL=1,i.MASK_KIND_TOP=2,i.MASK_KIND_BOTTOM=3,i.MASK_KIND_MIDDLE=4,i.MASK_KIND_LEFT=5,i.MASK_KIND_RIGHT=6,i.MASK_WIDTH=56,i.MASK_HEIGHT=56,e.DisplayU=i}(dou||(dou={})),function(t){var e,i;e=t.scene||(t.scene={}),(i=function t(){t.Roads[0]={name:"path_400001.lh",speed:-5,musicShare:!1,block:[[200,[["score2","topscore1","score3"]],!1],[45,[["score2","topscore1","score3"]],!1],[45,[["score2","topscore1","score3"]],!0],[45,[["score2","topscore1","score3"]],!0],["random",[[100,[["jump3","jump3","jump3"]],!0],[150,[["score1","topscore3","score2"],["score2","topscore3","score1"]],!1],[45,[["score1","score3","score2"],["score2","score3","score1"]],!1],[45,[["score1","score3","score2"]],!0],[55,["Group3"],!0],[55,["Group3"],!0],[65,[["jump2","jump2","jump2"]],!0],[60,[["score2","score1","score3"]],!1],[20,[["score2","score1","score3"]],!1],[20,[["score2","score1","score3"]],!1],[20,[["score2","score1","score3"]],!1],[20,[["top_m2","score1","score3"]],!1],[70,[["jump3","jump3","jump3"]],!0],[70,["Group1_m_m3","Group1_m3","Group3","Group1_m_3"],!0],[55,["Group1_m_m3","Group1_m3","Group3","Group1_m_3"],!0],[45,[["jump1","jump1","superjump1"],["jump1","jump1","jump1"],["jump1","jump1","jump1"],["jump1","jump1","slowjump1"]],!0]],[[100,[["jump2","jump2","jump2"]],!0],[120,[["score1","score3","topscore2"]],!1],[60,[["score3","score1","score2"]],!1],[30,[["score3","score1","score2"]],!1],[30,[["score3","score1","score2"]],!1],[70,[["jump3","jump3","jump3"]],!0],[70,[["score2","score1","score3"],["score2","score1","score3"]],!1],[20,[["score2","score1","score3"],["score2","score1","score3"]],!1],[20,[["score2","score1","score3"],["score2","score1","score3"]],!1],[20,[["score2","score1","score3"],["score2","score1","score3"]],!1],[60,["Group1_m_m3"],!1],[70,[["jump2","jump2","jump2"]],!0],[60,[["score2","score1","score3"]],!1],[30,[["score2","score1","score3"]],!1],[60,["Group1_m_m2"],!0],[60,[["jump1","jump1","jump1"]],!0]]],[60,[[0,"1",0]],!1],[30,[[0,"1",0]],!1],[30,[[0,0,"5"]],!1],[30,[[0,0,"5"]],!1],[30,[[0,"6",0]],!1],[30,[[0,"6",0]],!1],[30,[[0,"5",0]],!1]]},t.Roads[1]={name:"path_400002.lh",speed:5,musicShare:!1,block:[["random",[[55,["Group3"],!0],[55,["Group3"],!0],[60,[["jump3","jump3","jump3"]],!0],[60,[[0,"m_multiple3",0]],!0],[80,[["jump1","jump1","superjump1"],["jump1","jump1","jump1"],["jump1","jump1","jump1"],["jump1","jump1","jump1"],["jump1","slowjump1","jump1"]],!0],[95,["Group3"],!0],[45,["Group3"],!0],[45,["Group3"],!0],[60,["Group1_m_1","Group1_m_m1"],!0],[80,["Group3"],!0],[45,["Group3","Group3_m1","Group3","Group3"],!0],[45,["Group3","Group3_m1","Group3","Group3","Group3_m1"],!0],[45,["Group3","Group3_m1","Group3","Group3"],!0],[45,["Group3","Group3_m1","Group3","Group3"],!0],[60,[["jump3","jump3","jump3"]],!0],[80,[["m_score3",0,0]],!1],[45,[[0,0,"m_score3"],[0,0,"m_multiple3"],["m_score3",0,0]],!1],[45,[["m_score3",0,0]],!1],[45,[[0,0,"m_score3"],["m_multiple3",0,0],[0,0,"m_score3"]],!1],[45,[["m_score3",0,0],["m_multiple3",0,0],["m_score3",0,0]],!1],[40,[["jump1","jump1","jump1"]],!0]],[[55,["Group3"],!0],[55,[["jump2","superjump2","jump2"],["jump2","jump2","jump2"],["jump2","jump2","jump2"],["jump2","jump2","slowjump2"]],!0],[60,["Group3"],!0],[70,[[0,"m_multiple2",0]],!0],[60,[["score1","score3","score2"]],!1],[40,[["score1","score3","score2"]],!1],[40,[["score1","score3","score2"]],!1],[60,[["m_score2",0,0]],!1],[55,[["m_multiple2",0,0]],!1],[55,[["m_score2",0,0],["m_multiple2",0,0]],!1],[80,[["jump1","jump1","jump1"]],!0],[60,[["jump2","jump2","jump2"]],!0],[60,[["score3","score1","score2"]],!1],[40,[["score3","score1","score2"]],!1],[40,[["score3","score1","score2"]],!1],[60,[["jump1","jump1","jump1"]],!0],[60,[["m_score1",0,0]],!1],[55,[["m_score1",0,0]],!1],[55,[[0,0,"m_score1"]],!1],[60,["Group1_m_1","Group1_m_m1"],!0]]],[30,[[0,"1",0]],!0],[30,[[0,"2",0]],!0],[30,[[0,"3",0]],!0]]},t.Roads[2]={name:"path_400003.lh",speed:3,musicShare:!1,block:[["random",[[60,[["jump3","jump3","jump3"]],!0],[80,["Group1_s3","Group1_m3"],!0],[50,["Group3","Group1_m3","Group3","Group3"],!0],[50,[["score3","score1","score2"]],!0],[50,[["jump1","superjump1","jump1"],["jump1","jump1","jump1"],["jump1","jump1","jump1"],["jump1","jump1","jump1"],["jump1","slowjump1","jump1"]],!0],[40,[[0,0,"m_score1"]],!1],[40,[["m_score1",0,0]],!1],[40,[[0,0,"m_score1"],[0,0,"m_multiple1"],[0,0,"m_score1"],[0,0,"m_score1"]],!1],[50,[["jump3","jump3","jump3"]],!0],[40,[[0,0,"m_score3"]],!1],[40,[["m_score3",0,0]],!1],[40,[[0,0,"m_score3"],[0,0,"m_multiple3"],[0,0,"m_score3"],[0,0,"m_score3"]],!1],[50,[["jump2","jump2","jump2"]],!0],[40,[[0,0,"m_score3"]],!1],[40,[["m_score3",0,0]],!1],[40,[[0,0,"m_score3"]],!1],[50,[["jump1","jump1","jump1"]],!0],[50,[["m_multiple1",0,0]],!0],[40,[["score3","score1","score2"]],!0],[45,[["jump2","jump2","slowjump2"]],!0],[50,[["m_multiple2",0,0]],!0],[40,[["score3","score1","score2"]],!0],[50,[["jump1","jump1","jump1"]],!0]],[[60,[["jump2","jump2","jump2"]],!0],[80,["Group1_s2","Group1_m2"],!0],[45,["Group3","Group1_m2","Group3","Group3"],!0],[45,[["jump3","jump3","jump3"]],!0],[45,[["m_multiple3",0,0]],!0],[45,[["score3","score1","score2"]],!0],[45,[["score2","score3","score1"]],!0],[45,[["jump3","superjump3","jump3"],["jump3","jump3","jump3"],["jump3","jump3","jump3"],["jump3","jump3","jump3"],["jump3","jump3","jump3"]],!0],[65,[[0,0,"m_score3"]],!1],[40,[["m_score3",0,0]],!1],[40,[[0,0,"m_score3"],[0,0,"m_multiple3"],[0,0,"m_score3"],[0,0,"m_score3"]],!1],[40,[["m_score3",0,0]],!1],[40,[[0,0,"m_score3"],[0,0,"m_multiple3"],[0,0,"m_score3"]],!1],[45,[["jump1","jump1","jump1"]],!0],[50,[["m_score3",0,0]],!1],[40,[[0,0,"m_score3"]],!1],[40,[["m_score3",0,0]],!1],[40,[["m_score3",0,0]],!1],[40,[[0,0,"m_score3"]],!1],[45,[["jump2","jump2","jump2"]],!0],[60,[["2m_multiple2",0,0]],!0],[40,[["score2","score3","score1"]],!0],[40,[["jump1","jump1","jump1"]],!0]]],[60,[[0,"4",0]],!1],[30,[[0,"4",0]],!1],[30,[["3",0,0]],!1],[30,[["3",0,0]],!1],[30,[[0,"2",0]],!1],[30,[[0,"2",0]],!1],[30,[[0,"1",0]],!1]]},t.Roads[3]={name:"path_400004.lh",speed:3,musicShare:!1,block:[["random",[[30,[[0,0,"score2"]],!1],[40,[["score2",0,0]],!1],[40,[[0,0,"score2"]],!1],[40,[["jump3","jump3","jump3"]],!0],[40,[["score2",0,0]],!1],[40,[[0,0,"score2"]],!1],[40,[["jump2","jump2","jump2"]],!0],[45,[["multiple2","score3","score1"],["score1","score3","score2"]],!0],[40,[["score1","score3","multiple2"],["score1","score3","score2"]],!0],[40,[["jump1","jump1","jump1"]],!0]],[[30,[[0,0,"score3"]],!1],[40,[["score3",0,0]],!1],[40,[[0,0,"score3"]],!1],[40,[["jump3","jump3","jump3"]],!0],[45,[["score2",0,"multiple3"]],!1],[40,[["multiple3",0,"score2"]],!1],[40,[[0,"score2",0],"Group_j2"],!0],[40,[["score2",0,0],"Group3"],!0],[40,[[0,0,"score2"],"Group3"],!0],[40,[["jump1","jump1","jump1"]],!0]]],["random",[[45,[[0,"2m_multiple1",0]],!0],[45,[[0,"score2","score1"],[0,"score1","score2"]],!1],[40,[["score1","score2",0],["score2","score1",0]],!1],[40,[[0,"score2","score1"],[0,"score1","score2"]],!1]],[[55,[[0,"2m_multiple1",0]],!0],[55,[[0,"score2","score3"]],!1],[55,[["score3","score2",0]],!1]]],[40,[["jump3","jump3","jump3"]],!0],[45,[[0,"2m_multiple3",0]],!0],[38,[["score3","score2","score1"],[0,"score2","score1"]],!1],[38,[["score3","score1","score2"],["score2",0,"score1"]],!0],["random",[[35,[["jump2","jump2","slowjump2"]],!0],[60,[[0,"2m_score2",0]],!0],[45,[["2m_multiple2",0,0]],!0],[35,[[0,"score2","score1"]],!0],[35,[[0,"score2","score1"]],!1],[40,[["jump3","jump3","jump3"]],!0],[40,[["score2",0,"score3"],[0,"score2","score3"]],!1],[35,[["score2",0,"score3"],[0,"score2","score3"]],!1],[35,[["score2",0,"score3"],[0,"score2","score3"]],!1],[35,[["score2",0,"score3"],[0,"score2","score3"]],!1]],[[35,[["jump2","superjump2","jump2"],["jump2","jump2","slowjump2"],["jump2","jump2","jump2"],["jump2","jump2","jump2"],["jump2","jump2","jump2"]],!0],[60,[[0,"jump3",0]],!0],[45,[["2m_multiple3",0,0]],!0],[35,[["score3","score1",0]],!0],[35,[[0,"score1","score3"]],!0],[40,[["jump3",0,0]],!0],[40,[["2m_score3",0,0]],!1],[35,[[0,0,"2m_score3"]],!1],[35,[["2m_score3",0,0]],!1],[35,[[0,0,"2m_score3"]],!1]]],[30,[["jump1","jump1","jump1"]],!0],[30,[[0,"H1",0]],!0],[30,[[0,"H2",0]],!0],[30,[[0,"H3",0]],!0]]},t.Roads[4]={name:"path_400005.lh",speed:2,musicShare:!1,block:[["random",[[40,["Group_j3"],!1],[60,[["m_score2",0,0]],!1],[40,[[0,"m_score2",0]],!1],[40,[[0,0,"m_score2"]],!1],[40,[["m_score2",0,0]],!1],[40,[[0,"m_score2",0]],!1],[40,[[0,0,"m_score2"]],!1],[50,["Group_j2"],!1],[60,[[0,"m_score2",0]],!1],[40,[[0,0,"m_score2"]],!1],[40,[[0,0,"m_score2"]],!1],[40,[[0,"m_score2",0]],!1],[40,[["m_score2",0,0]],!1],[40,[["m_score2",0,0]],!1],[50,["Group_j3"],!1],[60,[["score3","score2",0]],!0],[40,[[0,"score3","score2"]],!0],[40,[["score2",0,"score3"]],!0],[40,[["multiple3","score2",0]],!0],[40,[[0,"score3","score2"]],!0],[40,[[0,"score2","score3"]],!0],[40,[[0,0,"m_multiple3"]],!0],[50,["Group_j1"],!1],[60,[["score1","score2",0]],!0],[70,[[0,"score1","score2"]],!0],[70,[["multiple1","score2",0]],!0],[70,[[0,"score1","score2"]],!0],[60,[[0,0,"2m_score1"]],!0],[50,[[0,0,"2m_multiple1"]],!0]],[[45,["Group_j2","Group_j3"],!1],[40,["Group3"],!0],[40,["Group3"],!0],[40,["Group3"],!0],[40,["Group3"],!0],[35,[["jump1","jump1","superjump1"],["jump1","jump1","jump1"],["jump1","jump1","jump1"],["jump1","jump1","jump1"]],!0],[45,[["jump2","jump2",0]],!0],[40,[[0,"m_score1",0]],!0],[35,[[0,0,"m_score1"]],!0],[35,[[0,0,"m_score1"]],!0],[35,[[0,"m_score1",0]],!0],[40,[["jump2","jump3","jump2"]],!0],[50,[[0,"score3","multiple2"]],!0],[40,[[0,"score2","score3"]],!0],[40,[["score3",0,"score2"]],!0],[40,[["score2","score3",0]],!0],[40,[["jump2","jump3","jump3"]],!0],[50,[["score2",0,"multiple3"]],!0],[40,[["score3","score2",0]],!0],[40,[["score2","score3",0]],!0],[40,[[0,0,"m_score3"]],!0],[40,[["jump1","jump3","jump1"]],!0],[50,[[0,"score2","multiple1"]],!0],[40,[["score1",0,"score2"]],!0],[40,[["score2","score1",0]],!0],[40,[["score2","score1",0]],!0],[40,[[0,"2m_multiple1",0]],!0],[35,[["jump2","jump2","jump2"]],!0],[80,[[0,"score1",0]],!0],[50,[["jump1","jump1","superjump1"],["jump1","slowjump1","jump1"],["jump1","jump1","jump1"],["jump1","jump1","jump1"],["jump1","jump1","jump1"]],!0],[55,[[0,"2m_multiple1",0]],!1],[60,[[0,"2m_multiple1",0]],!0]]]]},t.Roads[5]={name:"path_400003.lh",speed:2,musicShare:!0,block:[[60,[[0,"1",0]],!1],[15,[[0,"2",0]],!1],[14,[[0,"3",0]],!1],[13,[[0,"4",0]],!1],[12,[[0,"5",0]],!1],[11,[[0,"6",0]],!1],[10,[[0,"7",0]],!1],[50,[[0,"1",0]],!1],[30,[[0,"2",0]],!1],[30,[[0,"3",0]],!1],[30,[[0,"1",0]],!1],[30,[[0,0,"1"]],!1],[30,[[0,0,"2"]],!1],[30,[[0,0,"3"]],!1],[30,[[0,0,"1"]],!1],[30,[[0,"3",0]],!1],[30,[[0,0,"4"]],!1],[30,[[0,"5",0]],!1],[60,[[0,"3",0]],!1],[30,[["4",0,0]],!1],[30,[[0,"5",0]],!1],[60,[["5",0,0]],!1],[15,[["6",0,0]],!1],[15,[["5",0,0]],!1],[15,[["4",0,0]],!1],[15,[[0,"3",0]],!1],[30,[[0,"1",0]],!1],[30,[[0,0,"5"]],!1],[15,[[0,0,"6"]],!1],[15,[[0,0,"5"]],!1],[15,[[0,0,"4"]],!1],[15,[[0,"3",0]],!1],[30,[[0,"1",0]],!1],[30,[[0,"2",0]],!1],[30,[["L5",0,0]],!1],[30,[[0,"1",0]],!1],[60,[[0,"2",0]],!1],[30,[[0,0,"L5"]],!1],[30,[[0,"1",0]],!1],[60,[[0,"7",0]],!1],[10,[[0,"6",0]],!1],[11,[[0,"5",0]],!1],[12,[[0,"4",0]],!1],[13,[[0,"3",0]],!1],[14,[[0,"2",0]],!1],[15,[[0,"1",0]],!1],[30,["Group_j1"],!0]]}}).BallTypeConfig={arrowObj:{type:"arrow",cType:1,speed:0,score:0},superObj:{type:"power",cType:1,speed:0,score:1e4},slowObj:{type:"speed",cType:1,speed:-35,score:12e3},Diamond:{type:"Diamond",cType:1,speed:0,score:1},score1:{type:"score",cType:1,speed:0,score:1},score2:{type:"score",cType:2,speed:0,score:1},score3:{type:"score",cType:3,speed:0,score:1},topscore1:{type:"score",cType:1,speed:0,top:"arrowObj",arrowScore:50,score:1},topscore2:{type:"score",cType:2,speed:0,top:"arrowObj",arrowScore:50,score:1},topscore3:{type:"score",cType:3,speed:0,top:"arrowObj",arrowScore:50,score:1},jump1:{type:"jump",cType:1,speed:20.25,score:0},jump2:{type:"jump",cType:2,speed:20.25,score:0},jump3:{type:"jump",cType:3,speed:20.25,score:0},superjump1:{type:"jump",cType:1,speed:20.25,score:0,top:"superObj"},superjump2:{type:"jump",cType:2,speed:20.25,score:0,top:"superObj"},superjump3:{type:"jump",cType:3,speed:20.25,score:0,top:"superObj"},slowjump1:{type:"jump",cType:1,speed:20.25,score:0,top:"slowObj"},slowjump2:{type:"jump",cType:2,speed:20.25,score:0,top:"slowObj"},slowjump3:{type:"jump",cType:3,speed:20.25,score:0,top:"slowObj"},multiple1:{type:"multiple",cType:1,speed:0,score:1},multiple2:{type:"multiple",cType:2,speed:0,score:1},multiple3:{type:"multiple",cType:3,speed:0,score:1},top_m1:{type:"multiple",cType:1,speed:0,top:"arrowObj",arrowScore:50,score:1},top_m2:{type:"multiple",cType:2,speed:0,top:"arrowObj",arrowScore:50,score:1},top_m3:{type:"multiple",cType:3,speed:0,top:"arrowObj",arrowScore:50,score:1},m_score1:{type:"score",cType:1,speed:3.5,score:1},m_score2:{type:"score",cType:2,speed:3.5,score:1},m_score3:{type:"score",cType:3,speed:3.5,score:1},m_multiple1:{type:"multiple",cType:1,speed:4.5,score:1},m_multiple2:{type:"multiple",cType:2,speed:4.5,score:1},m_multiple3:{type:"multiple",cType:3,speed:4.5,score:1},"2m_score1":{type:"score",cType:1,speed:5.2,score:1},"2m_score2":{type:"score",cType:2,speed:5.2,score:1},"2m_score3":{type:"score",cType:3,speed:5.2,score:1},"2m_multiple1":{type:"multiple",cType:1,speed:7,score:1},"2m_multiple2":{type:"multiple",cType:2,speed:7,score:1},"2m_multiple3":{type:"multiple",cType:3,speed:7,score:1},1:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"1"},2:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"2"},3:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"3"},4:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"4"},5:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"5"},6:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"6"},7:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"7"},L1:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"L1"},L2:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"2"},L3:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"L3"},L4:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"L4"},L5:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"L5"},L6:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"L6"},L7:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"L7"},H1:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"H1"},H2:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"H2"},H3:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"H3"},H4:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"H4"},H5:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"H5"},H6:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"H6"},H7:{type:"score",cType:1,speed:0,score:1,skin:"score_music",music:"H7"}},i.BlockGroup={NGroup:["0","0","0"],Group3:["score2","score1","score3"],Group2_3:["score2","score1","0"],Group2_2:["score3","score1","0"],Group2_1:["score2","score3","0"],Group3_m1:["multiple1","score2","score3"],Group3_m2:["multiple2","score1","score3"],Group3_m3:["multiple3","score1","score2"],Group1_m_1:["0","m_score1","0"],Group1_m_2:["0","m_score2","0"],Group1_m_3:["0","m_score3","0"],Group1_s1:["0","score1","0"],Group1_s2:["0","score2","0"],Group1_s3:["0","score3","0"],Group1_m1:["0","multiple1","0"],Group1_m2:["0","multiple2","0"],Group1_m3:["0","multiple3","0"],Group1_m_m1:["0","m_multiple1","0"],Group1_m_m2:["0","m_multiple2","0"],Group1_m_m3:["0","m_multiple3","0"],Group_j1:["jump1","jump1","jump1"],Group_j2:["jump2","jump2","jump2"],Group_j3:["jump3","jump3","jump3"]},i.TextureColor={jump:["jump_r","jump_g","jump_b","jump_y"],multiple:["stripe_r","stripe_g","stripe_b","stripe_y"]},i.CameraClearColors=[[1,.8588,.8588,1],[.8941176,1,1,1],[.8078431,.890196,1,1],[.9647059,.9647059,.8078431,1],[1,1,1,1],[1,.10196,.1019607,1],[.10196,1,.2588235,1],[.10196,.2588235,1,1],[1,1,.1019607,1]],i.AssetColor={ballFx:["Ball_Red","Ball_Green","Ball_Blue","Ball_Yellow"],smallFx:["Small_Red","Small_Green","Small_Blue","Small_Yellow"]},i.SceneTextures=["tailFx"],i.TailFxMap={White:4,Red:5,Greed:6,Blue:7,Yellow:8},i.AssetFxNames={Cast_Speed:{n:"Cast_Speed",t:2e3,exist:!0},Hit_Die:{n:"Hit_Die",t:1200},Ball_Red:{n:"Hit_Ball_Red",t:500,c:2,exist:!0},Ball_Green:{n:"Hit_Ball_Green",t:500,c:2,exist:!0},Ball_Blue:{n:"Hit_Ball_Blue",t:500,c:2,exist:!0},Ball_Yellow:{n:"Hit_Ball_Yellow",t:500,c:2,exist:!0},Small_Red:{n:"Hit_Small_Red",t:500,c:2,exist:!0},Small_Green:{n:"Hit_Small_Green",t:500,c:2,exist:!0},Small_Blue:{n:"Hit_Small_Blue",t:500,c:2,exist:!0},Small_Yellow:{n:"Hit_Small_Yellow",t:500,c:2,exist:!0},Trail_Blue:{n:"Trail_Blue",t:3e3},Trail_Face:{n:"Trail_Face",t:3e3},Trail_Green:{n:"Trail_Green",t:3e3},Trail_Leaf:{n:"Trail_Leaf",t:3e3},Trail_Music:{n:"Trail_Music",t:3e3},Trail_Red:{n:"Trail_Red",t:3e3},Trail_Star:{n:"Trail_Star",t:3e3},Trail_Yellow:{n:"Trail_Yellow",t:3e3},Cast_Super:{n:"Cast_Super",t:3e3,exist:!0},Cast_Slow:{n:"Cast_Slow",t:3e3,exist:!0}},i.AudioNames=["SFX_Ball_Dash.mp3","sfx_death.mp3","sfx_death_award_popup.mp3","sfx_new_road.mp3","sfx_start_swipe.mp3"],i.AtlasNames=["game.atlas"],i.UITextures=[],i.SkinColorMap={"001":[0,1,2],"002":[0,3,2],"003":[0,1,3],"004":[0,1,3],"005":[0,1,3],"006":[0,1,2],"007":[0,3,2],"008":[0,3,2],"009":[0,1,2],"014":[0,3,2],"016":[0,3,2],"011":[0,3,1],"013":[0,3,2],"015":[0,3,2]},i.BallConst={g:151.875,jumpStep:3,jumpFactor:1.7,ballOffSet:1.8,cameraOffSet:-2.2,fingerSensitivity:43,rotationR:3.5,initSpeed:60,viewDis:130,initTail:"White",eatSoundMax:12,initSkin:"006",shakeDura:450,shakeStength:.1,superFx:"Trail_Music",roadJumpV:75,roadOffsetY:-8,slowFx:"Cast_Slow",fastFx:"Trail_Music",multiMax:20,musicShareCnt:8,musicSharePro:100,redBagCount:20,redBagDimCnt:[28,188,288,388],redBagDimCntPro:[0,500,300,200],redBagGetCnt:1e3,redBagShowCnt:5e3,redBagTime:30,redBagShareCnt:5,crossAdReward:"007",appLikeStartDay:4},i.ShareDiamond=[100,200,300,400,600],i.DialSkin=["009","011","013","015"],i.DialReward=[["diamond",200,2e3],["diamond",1800,600],["skin",1,300],["diamond",1e3,2e3],["diamond",450,5e3],["diamond",3e3,300]],i.DialFreeTime=[[7,0,"7:00"],[12,0,"12:00"],[19,0,"19:00"]],i.FirstLoginReward=[[!0,"001"],[!1,"Trail_Star"]],i.RoadInit={name:"path_400001.lh",speed:-5,musicShare:!1,block:[[200,[[0,"topscore1",0]],!1],[45,[[0,"topscore1",0]],!1],[45,[[0,"topscore1",0]],!0],[45,[[0,"topscore1",0]],!0],["random",[[100,[["jump3","jump3","jump3"]],!0],[150,[[0,"topscore3",0],[0,"topscore3",0]],!0],[45,[["score3",0,0]],!0],[45,[["score3",0,0]],!0],[55,["Group3"],!0],[55,["Group3"],!0],[65,[["jump2","jump2","jump2"]],!0],[60,[[0,"score2",0]],!0],[20,[[0,"score2",0]],!0],[20,[[0,"score2",0]],!0],[20,[[0,"score2",0]],!0],[20,[["top_m2",0,0]],!0],[70,[["jump3","jump3","jump3"]],!0],[70,["Group1_m_m3","Group1_m3","Group3","Group1_m_3"],!0],[55,["Group1_m_m3","Group1_m3","Group3","Group1_m_3"],!0],[45,[["jump1","jump1","superjump1"],["jump1","jump1","jump1"],["jump1","jump1","jump1"],["jump1","jump1","jump1"]],!0]],[[100,[["jump2","jump2","jump2"]],!0],[120,[[0,0,"topscore2"]],!0],[60,[[0,"score2",0]],!0],[30,[[0,"score2",0]],!0],[30,[[0,"score2",0]],!0],[70,[["jump3","jump3","jump3"]],!0],[70,[[0,"score3",0]],!0],[20,[[0,"score3",0]],!0],[20,[[0,"score3",0]],!0],[20,[[0,"score3",0]],!0],[60,["Group1_m_m3"],!0],[70,[["jump2","jump2","jump2"]],!0],[60,[[0,"score2",0]],!0],[30,[[0,"score2",0]],!0],[60,["Group1_m_m2"],!0],[60,[["jump1","jump1","jump1"]],!0]]],[60,[[0,"1",0]],!1],[30,[[0,"1",0]],!1],[30,[[0,0,"5"]],!1],[30,[[0,0,"5"]],!1],[30,[[0,"6",0]],!1],[30,[[0,"6",0]],!1],[30,[[0,"5",0]],!1]]},i.Roads=new Array,i.BlockResMap={score:"Ball",multiple:"multiple",jump:"Jump",Diamond:"Diamond",power:"SuperBall",speed:"SlowNet",arrow:"Cast_Arrow"},i.BlockResName=[["Ball",18,!1],["Jump",9,!1],["Diamond",12,!1],["SlowNet",2,!0],["SuperBall",2,!0],["Cast_Arrow",4,!0]],new(e.SceneConfig=i)}(dou||(dou={})),function(t){var e,i;e=t.scene||(t.scene={}),(i=function(){function t(){}return t.addEffect=function(t,e){this._config[t]=e},t.getEffect=function(t){return this._config[t]?this._config[t].clone():null},t}())._config={},e.EffectMgr=i}(dou||(dou={})),function(t){var e,i;e=t.scene||(t.scene={}),i=function(){function t(){this.roation=0,this._frameTime=83,this._delayTimer=0,this.anchorPosX=0,this.anchorPosY=0,this._regX=0,this._regY=0,this._scale=1,this._offsetX=0,this._offsetY=0,this._tempMix=new Matrix,this.reset()}return Object.defineProperty(t.prototype,"__ROOT_ID",{get:function(){return this._texture?this._texture.__ROOT_ID:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"toward",{get:function(){return this._toward},set:function(t){this._toward!=t&&(this._toward=t,this.drawCalculate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"drawHorizonal",{set:function(t){this._drawHorizonal=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"delayTimer",{set:function(t){this._delayTimer=t,this._startTime=Laya.timer.currTimer+this._delayTimer},enumerable:!0,configurable:!0}),t.prototype.setLoop=function(t){this._loop=t},Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._drawW},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._drawH},enumerable:!0,configurable:!0}),t.prototype.drawCalculate=function(){this._drawDirect=0,this._drawHorizonal=!1},t.prototype.setData=function(t,e){void 0===e&&(e=12),this._data=t,this.setFps(e)},t.prototype.setFps=function(t){this._fps=t,this._frameTime=Math.floor(1e3/t),this._startTime=Laya.timer.currTimer+this._delayTimer},Object.defineProperty(t.prototype,"scale",{set:function(t){this._scale=t},enumerable:!0,configurable:!0}),t.prototype.setOffset=function(t,e){this._offsetX=t,this._offsetY=e},t.prototype.updateTexture=function(){var t=Laya.timer.currTimer;if(!(this._startTime>t))if(!this._loop&&t-this._startTime>=this._duration)this.isPlayEnd=!0;else if(1!=this._frameCount){var e=this._frameTime*this._frameCount,i=(t-this._startTime)%e;this._curFrameIndex=MathU.parseInt(i/this._frameTime),this._curFrameIndex>=this._frameCount&&(this._curFrameIndex=this._frameCount-1)}else this._curFrameIndex=0},t.prototype.updateTransform=function(t){var e,i;this.anchorPostion?(i=this.anchorPostion.y,e=this.anchorPostion.x):0<this.anchorPosX&&0<this.anchorPosY&&(e=this.anchorPosX,i=this.anchorPosY),this._drawX=t.getScenePxByCellX(e)+this._offsetX,this._drawY=t.getScenePxByCellY(i)+this._offsetY,this._drawMix=this._tempMix,this._drawMix.identity(),this._drawHorizonal&&(this._drawMix.a=-1,this._drawMix.tx=2*this._drawX-this._regX,this._drawMix.ty=this._regY),this._texture&&(this._drawW=this._texture.sourceWidth,this._drawH=this._texture.sourceHeight),0!=this.roation&&(this._drawMix.rotate(this.roation),this._drawMix.translate(this._drawX,this._drawY),this._drawX=0,this._drawY=0)},t.prototype.onDraw=function(t,e){!this._texture||this._startTime>Laya.timer.currTimer||(this.updateTransform(e),t.drawTexture(this._texture,this._drawX,this._drawY,this._drawW,this._drawH,this._drawMix),this._texture=null,this._drawMix=null)},t.prototype.reset=function(){this._drawHorizonal=!1,this.toward=0,this.anchorPostion=null,this.atBottom=!1,this._loop=!1,this.isPlayEnd=!1,this._duration=6e5,this._startTime=0,this._delayTimer=0,this._frameCount=0,this._curFrameIndex=0,this._regX=0,this._regY=0,this._scale=1,this._offsetX=0,this._offsetY=0,this._texture=null,this._drawMix=null,this._data=null},t}(),e.Effect=i}(dou||(dou={})),function(t){var e,i;e=t.scene||(t.scene={}),i=function(){function t(t,e,i){void 0===t&&(t=0),void 0===e&&(e=255),void 0===i&&(i=1),this._r=0,this._g=0,this._b=0,this._min=0,this._max=255,this._step=1,this.__add=!0,this.__index=0,this._min=t,this._max=e,this._step=i,this._r=t,this._g=e,this._b=t,this.__index=0,this.__add=!0}return t.prototype.init=function(t,e,i){this._r=t,this._g=e,this._b=i},Object.defineProperty(t.prototype,"r",{get:function(){return this._r},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._g},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._b},enumerable:!0,configurable:!0}),t.prototype.updateColor=function(){var t=this.__add?this._step:-this._step;switch(this.__index){case 0:this._r=this.checkValue(this._r+t);break;case 1:this._g=this.checkValue(this._g+t);break;case 2:this._b=this.checkValue(this._b+t)}},t.prototype.checkValue=function(t){return t>this._min&&t<this._max||(t<this._min&&(t=this._min),t>this._max&&(t=this._max),this.__index=(this.__index+1)%3,this.__add=!this.__add),t},t}(),e.Color=i}(dou||(dou={})),function(t){var e,i;e=t.scene||(t.scene={}),(i=function(){function i(){this._worldPostion=new Vector2,this.width=720,this.height=1280,this.sceneYOffset=0,this.sceneYSpeed=.5,this._x=0,this._y=0,this.enableFilter=!0}return Object.defineProperty(i.prototype,"worldPostion",{get:function(){return this._worldPostion},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isResize",{get:function(){return this._sizeFlag>=Laya.timer.currFrame},enumerable:!0,configurable:!0}),i.prototype.setSize=function(t,e){this.width=t,this.height=e},i.prototype.setWorldPostion=function(t,e){this._worldPostion.x=t,this._worldPostion.y=e},i.prototype.__location=function(t,e){this._x=t,this._y=e,this.width==this.bufferWidth&&this.height==this.bufferHeight||(this._sizeFlag=Laya.timer.currFrame),this.bufferWidth=this.width,this.bufferHeight=this.height,this.centerPointX=Math.round(this.bufferWidth/2),this.centerPointY=Math.round(this.bufferHeight/2),this.bufferLeft=this._x-this.centerPointX,this.bufferRight=this.bufferLeft+this.bufferWidth,this.bufferTop=this._y-this.centerPointY,this.bufferBottom=this.bufferTop+this.bufferHeight},i.prototype.update=function(){this.__location(this.width/2,this.height/2),this.logicLeft=this.bufferLeft/i.CELL_WIDTH,this.logicRight=this.bufferRight/i.CELL_WIDTH,this.logicTop=this.bufferTop/i.CELL_HEIGHT,this.logicBottom=this.bufferBottom/i.CELL_HEIGHT,this.look_logicLeft=this.logicLeft-i.LOGIC_INNER_LOOK,this.look_logicRight=this.logicRight+i.LOGIC_INNER_LOOK,this.look_logicTop=this.logicTop-i.LOGIC_INNER_LOOK,this.look_logicBottom=this.logicBottom+i.LOGIC_INNER_LOOK},i.prototype.getScenePxByCellX=function(t){return t*i.CELL_WIDTH-this.bufferLeft},i.prototype.getScenePxByCellY=function(t,e){return void 0===e&&(e=!0),t*i.CELL_HEIGHT-this.bufferTop+this.sceneYOffset},i.prototype.getSceneX=function(t){return t-this.bufferLeft},i.prototype.getSceneY=function(t){return t-this.bufferTop},i.prototype.getCellXByScene=function(t){return(t+this.bufferLeft)/i.CELL_WIDTH},i.prototype.getCellYByScene=function(t){return(t+this.bufferTop)/i.CELL_HEIGHT},i.prototype.lookIn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i,n,r=!1;switch(t.length){case 1:t[0]instanceof Vector2&&(i=t[0].x,n=t[0].y,r=!(this.look_logicLeft>i||this.look_logicRight<i||this.look_logicTop>n||this.look_logicBottom<n));break;case 2:t[0]instanceof Number&&t[1]instanceof Number&&(i=t[0],n=t[1],r=!(this.look_logicLeft>i||this.look_logicRight<i||this.look_logicTop>n||this.look_logicBottom<n))}return r},i.prototype.lookInBuffer=function(t,e,i,n){var r=t+i,a=e+n,s=this.bufferLeft,o=this.bufferTop,l=this.bufferRight,h=this.bufferBottom;return(s<=t&&t<l||t<=s&&s<=r)&&(o<=e&&e<h||e<=o&&o<=a)},i.prototype.shock=function(t){void 0===t&&(t=250)},i.prototype.shockStop=function(){},i}()).CELL_HEIGHT=1,i.CELL_WIDTH=1,i.LOGIC_INNER_LOOK=40,e.Camera=i}(dou||(dou={})),function(r){var d,t;d=r.scene||(r.scene={}),(t=function(){function s(t,e){this._lenghtOfRoad=0,this._obstacleList=new Array,this._builderList=new Array,this._createCount=0,this._configIndex=0,this._roadCount=0,this.isFirst=!0,this.RoadId=0,this.Speed=0,this.BlockCf=[],this._curBlockIndex=0,this._lastAddPos=0,this._level=0,this.accelerateLenght=0,this.obstacleLenght=-15,this.nextCreateBuilderZ1=0,this.nextCreateBuilderZ2=1,this._scene=t,this._app=e,this.parseConfig()}return s.prototype.GetRoadCf=function(){var t;return this.isFirst?t=d.SceneConfig.RoadInit:(t=d.SceneConfig.Roads[this.RoadId++],this.RoadId>=d.SceneConfig.Roads.length&&(this.RoadId=0)),t},s.prototype.parseConfig=function(){var t=this.GetRoadCf();this.isFirst=!1,this.Speed=t.speed,this.BlockCf.length=0;for(var e=t.block,i=0;i<e.length;i++){var n=e[i];if("randomS"==n[0]){i++;for(var r=new Array;i<e.length&&"randomE"!=(n=e[i])[0];)r.push(n),i++;var a=r.length;if(0<a)for(var s=MathU.RandomArray(a),o=0;o<a;o++)this.BlockCf.push(r[s[o]])}else if("random"==n[0]){var l=n[Math.round(Math.random()*(n.length-2))+1];for(o=0;o<l.length;o++)this.BlockCf.push(l[o])}else this.BlockCf.push(n)}},s.prototype.create=function(t,e,i,n){var r;switch(t){case"Ball":(r=i?ObjectPools.malloc(MusicBall,[this._scene],[this._scene]):ObjectPools.malloc(ColorBall,[this._scene],[this._scene])).init(""),r.allowMove=n,r&&(r.musicIndex=i);break;case"Jump":var a=this.getJumpUrl(e);(r=ObjectPools.malloc(XiePo,[this._scene],[this._scene])).init(a.mo,a.ma);break;case"Diamond":break;case"multiple":a=this.getMultipleBallUrl(e),(r=ObjectPools.malloc(MultipleBall,[this._scene],[this._scene])).init(a.mo,a.ma),r.allowMove=n;break;case"SlowNet":(r=ObjectPools.malloc(SlowNet,[this._scene],[this._scene])).init("");break;case"SuperBall":(r=ObjectPools.malloc(SuperBall,[this._scene],[this._scene])).init("")}return r&&(r.color_type=e),r},s.prototype.getMultipleBallUrl=function(t){var e="",i="";switch(t){case 1:e=r.Path.scene_model+"play_tw-Sphere001.lm",i=r.Path.scene_material+"red_tw.jpg";break;case 2:e=r.Path.scene_model+"play_tw-Sphere001.lm",i=r.Path.scene_material+"green_tw.jpg";break;case 3:e=r.Path.scene_model+"play_tw-Sphere001.lm",i=r.Path.scene_material+"blue_tw.jpg"}return{mo:e,ma:i}},s.prototype.getJumpUrl=function(t){var e="",i="";switch(t){case 1:e=r.Path.scene_model+"red-red.lm",i=r.Path.scene_material+"tiaoyue.jpg";break;case 2:e=r.Path.scene_model+"green-green.lm",i=r.Path.scene_material+"tiaoyue.jpg";break;case 3:e=r.Path.scene_model+"blue-blue.lm",i=r.Path.scene_material+"tiaoyue.jpg"}return{mo:e,ma:i}},s.prototype.CreateOne=function(t,e,i,n){void 0===n&&(n=!1);var r=d.SceneConfig.BlockResMap[t.type],a=this.create(r,t.cType,t.music,0<t.speed);if(a)return a.setOffset(.25*e-.25,s.getOffestY(i)+(n?.3:.1),i),this._obstacleList.push(a),a},s.prototype._NewRowBlocks=function(t,e){var i=new Array,n=t[1],r=0;1<n.length&&(r=Math.floor(Math.random()*n.length));var a=n[r];Array.isArray(a)||(a=d.SceneConfig.BlockGroup[a]);var s=null;1==t[2]&&(s=MathU.RandomArray(a.length));for(var o=0;o<a.length;o++){var l=a[o],h=o;if(null!=s&&(h=s[o]),0!=l){var u=d.SceneConfig.BallTypeConfig[l];null==u.track&&(u.track=l);var c=this.CreateOne(u,h,e);if(null!=u.top&&(null==u.arrowScore||10<=u.arrowScore)){var _=d.SceneConfig.BallTypeConfig[u.top];this.CreateOne(_,h,e,!0);c.topType=_}i[i.length]=c}}return i},s.prototype.updateBlock=function(){this.BlockCf.length<=this._curBlockIndex&&(this.parseConfig(),this._curBlockIndex=0);var t=this.BlockCf[this._curBlockIndex],e=t[0]/18,i=s.getLevel(this._lastAddPos+e);i!=this._level&&(this._lastAddPos+=8,this._level=i),this._lastAddPos+e<this._scene.camera.position.z+20&&(this._lastAddPos+=e,this._curBlockIndex++,this._NewRowBlocks(t,this._lastAddPos))},s.prototype.reset=function(){this._lenghtOfRoad=0,this.nextCreateBuilderZ1=0,this.nextCreateBuilderZ2=0,this._createCount=0,this._configIndex=0,this.obstacleLenght=-15,this.accelerateLenght=0,this.isFirst=!0,this._configIndex=0,this._curBlockIndex=0,this._lastAddPos=0,this.BlockCf.length=0,this.RoadId=0,this._roadCount=0,this._level=0,this.clear()},s.prototype.addRoad=function(t){var e=ObjectPools.malloc(Road,[this._scene],[this._scene]),i=Math.floor(this._roadCount/s.LEVEL_PET_MAP)*s.LEVEL_OFFSET_Y,n=0!=this._roadCount&&this._roadCount%s.LEVEL_PET_MAP==0;e.setOffset(0,n?-i-.001:-i,n?this._lenghtOfRoad+3.5:this._lenghtOfRoad),e.init(r.Path.scene_model+"race_01-对象001.lm",r.Path.scene_texture+"ground_011.jpg"),e.setAlbedoColor(t),this._obstacleList.push(e),this._roadCount++,this._lenghtOfRoad+=s.PER_ROAD_LEN},s.getOffestY=function(t){return t+=6.3,-Math.floor(t/s.TEMP_LEVEL_PET_MAP)*s.LEVEL_OFFSET_Y},s.getLevel=function(t){return t+=6.3,Math.floor(t/s.TEMP_LEVEL_PET_MAP)},s.prototype.addObstacle=function(){this.obstacleLenght-this._scene.camera.position.z<10&&(this.obstacleLenght+=4+Math.floor(3*Math.random()))},s.prototype.addBuilder=function(t,e,i){void 0===i&&(i=!1);var n=ObjectPools.malloc(Builder,[this._scene],[this._scene]);return n.isRever=i,n.setOffset(-1.3,0,t),n.init("",""),n.setAlbedoColor(e),this.tweenTo(n),this._builderList.push(n),(n=ObjectPools.malloc(Builder,[this._scene],[this._scene])).isRever=i,n.setOffset(1.3,0,t),n.init("",""),n.setAlbedoColor(e),this.tweenTo(n),this._builderList.push(n),2,2},s.prototype.tweenTo=function(t){if(!(.1<Math.random())){var e=t.transform.position;Laya.Tween.to(e,{y:e.y-2*Math.random(),update:Handler.create(this,function(){t.transform.position=e},null,!1)},300,null,null,300)}},s.prototype.init=function(t,e){this._lenghtOfRoad-this._scene.camera.position.z<30&&this.addRoad(t)},s.prototype.update=function(t,e,i,n){for(;this.nextCreateBuilderZ1<this._scene.camera.position.z+15;)this.nextCreateBuilderZ1+=this.addBuilder(this.nextCreateBuilderZ1,n);this._lenghtOfRoad-this._scene.camera.position.z<30&&this.addRoad(i),this.addObstacle(),this.updateBlock();for(var r=0;r<this._obstacleList.length;r++)this._obstacleList[r].update(t)?(ObjectPools.free(this._obstacleList[r]),this._obstacleList.splice(r,1),r--):this._obstacleList[r].updateBlendOffset(e);for(r=0;r<this._builderList.length;r++)this._builderList[r].update(t)?(ObjectPools.free(this._builderList[r]),this._builderList.splice(r,1),r--):this._builderList[r].updateBlendOffset(e)},s.prototype.findOffsetX=function(t,e){if(.6<Math.abs(e))return 100;for(var i=0;i<t.length;i++){var n=t[i].position.x-e;if(Math.abs(n)<=t[i].obstacleWidth)return 100}return e},s.prototype.clear=function(){for(var t=0;t<this._obstacleList.length;t++)ObjectPools.free(this._obstacleList[t]);for(t=this._obstacleList.length=0;t<this._builderList.length;t++)ObjectPools.free(this._builderList[t]);this._builderList.length=0},s}()).ball_radis=.08,t.LEVEL_OFFSET_Y=1,t.LEVEL_PET_MAP=6,t.PER_ROAD_LEN=12.7,t.TEMP_LEVEL_PET_MAP=t.LEVEL_PET_MAP*t.PER_ROAD_LEN,d.BuilderMgr=t}(dou||(dou={})),function(t){var e,i;e=t.scene||(t.scene={}),i=function(){function t(){}return t.prototype.init=function(t,e){this._sceneRoot=t,this.owner=e,(this.owner.owner=this).animator||(this.animator=this.owner.getComponentByType(Laya.Animator))},t.prototype.playAnimation=function(t){this.animator&&(this.animator._clips&&this.animator.play(t))},t.prototype.stopAnimation=function(){if(this.animator){var t=this.animator._clips;t&&t.length&&this.animator.stop()}},t.prototype.destroy=function(){this.owner&&!this.owner.destroyed&&(this.removeBoxCollider(),this.removeRigidbody(),this.stopAnimation(),this.owner.parent&&(this.owner.parent.destroy(),this.owner.parent=null),this.owner.destroy(),this.owner=null)},t.prototype.createBoxCollider=function(){return this.boxCollider||(this.boxCollider||(this.boxCollider=this.owner.addComponent(Laya.SphereCollider),this.boxCollider.radius=e.BuilderMgr.ball_radis),this.boxCollider.enable=!1),this.boxCollider},t.prototype.removeBoxCollider=function(){this.boxCollider&&(this.boxCollider.enable=!1,this.owner.removeComponentByType(Laya.BoxCollider))},Object.defineProperty(t.prototype,"boxColliderEnable",{set:function(t){t?this.createBoxCollider().owner&&(this.createBoxCollider().enable=t):this.boxCollider&&(this.boxCollider.enable=!1)},enumerable:!0,configurable:!0}),t.prototype.createRigidbody=function(){return this.rigidbody||(this.rigidbody=this.owner.getComponentByType(Laya.Rigidbody),this.rigidbody||(this.rigidbody=this.owner.addComponent(Laya.Rigidbody)),this.rigidbody.enable=!1),this.rigidbody},t.prototype.removeRigidbody=function(){this.rigidbody&&(this.rigidbody.enable=!1,this.owner.removeComponentByType(Laya.Rigidbody))},Object.defineProperty(t.prototype,"rigidbodyEnable",{set:function(t){this.createRigidbody().owner&&(this.createRigidbody().enable=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return this.owner.transform},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"active",{set:function(t){this.owner&&(this.owner.active=t)},enumerable:!0,configurable:!0}),t}(),e.BaseMeshSprite3D=i}(dou||(dou={}));var PokerRobot=function(){function t(){}return t.prototype.init=function(t){this._cards=t},t}(),dou,dou;!function(t){var e=function(){function t(){}return t.getSeqFrames=function(t,e,i){void 0===i&&(i=0);for(var n=[],r=i=i||0;r<i+e;r++)n.push(StringU.substitute(t,r));return n},t}();e.template="data/temp/template.bin",e.skin="skin/",e.uiAtlas="res/atlas/",e.sfAtlas="res/atlas/sf/",e.ui="ui/",e.scene_path="scene/LayaScene_newrace/",e.scene=e.scene_path+"newrace.ls",e.newraceshow="scene/LayaScene_newraceshow/newraceshow.ls",e.tuoWei="scene/LayaScene_tuowei/tuowei.lh",e.scene_model=e.scene_path+"Assets/race/model/",e.scene_material=e.scene_path+"Assets/race/materials/",e.obstacle_model="scene/LayaScene_Obstacle/Assets/race/zhangaiwu/model/",e.scene_texture=e.scene_path+"Assets/race/particle/texture/",e.name_texture=e.scene_path+"Assets/AINames/",e.sk="sk/",e.sf="sf/",e.petdeco="petdeco/",e.scene_sf="",t.Path=e}(dou||(dou={})),function(t){!function(t){var e=function(){function n(t){this._app=t,this._url="tongyong/tishi_2.png",this._checkInfos=[],this._offsetTime=this._nextIndex=0}return n.prototype.addCheckInfo=function(t,e,i,n,r,a,s,o){var l;void 0===r&&(r=null),void 0===a&&(a=1),void 0===s&&(s=null),r=r||new Point(e.width-38,0);for(var h=0;h<this._checkInfos.length;h++)if((l=this._checkInfos[h]).checkFun==n&&l.parent==e&&l.cPos.x==r.x&&l.cPos.y==r.y)return logd("addCheckInfo","该检测数据已存在"),l.index;return(l=new u).index=this._nextIndex,l.caller=i,l.checkFun=n,l.parent=e,l.checkTime=a,l.cPos=r,l.page=t,l.checkView=s,l.args=o,this._checkInfos[this._checkInfos.length]=l,this._nextIndex++,l.index},n.prototype.checkTargetNow=function(t){for(var e=0;e<this._checkInfos.length;e++)if(this._checkInfos[e].index==t){this._checkInfos[e].curTime=0,this.checkSingleInfo(this._checkInfos[e]);break}},n.prototype.update=function(t){if(0<this._offsetTime)this._offsetTime-=t;else if(this._offsetTime=n.MIN_CHECKTIME,this._checkInfos.length)for(var e=this._checkInfos.length,i=0;i<e;i++)this.checkSingleInfo(this._checkInfos[i]),e!=this._checkInfos.length&&(e=this._checkInfos.length,i--)},n.prototype.checkSingleInfo=function(t){if(t)if(!t.page||t.page.isOpened){if(!t.parent.parent||!t.parent.visible)return t.imgPoint&&t.imgPoint.removeSelf(),void(t.curTime=0);if(t.checkView&&(t.checkView.visible||t.checkView.isOpened))return t.imgPoint&&t.imgPoint.removeSelf(),void(t.curTime=0);if(t.curTime--,!(0<t.curTime))if(t.curTime=t.checkTime,null!=t.caller&&null!=t.checkFun)Handler.create(t.caller,t.checkFun,t.args).runWith(t.parent)?(t.imgPoint||(t.imgPoint=new LImage(this._url),t.imgPoint.x=t.cPos.x-10,t.imgPoint.y=t.cPos.y+10),t.imgPoint.parent||t.parent.addChild(t.imgPoint)):t.imgPoint&&t.imgPoint.removeSelf()}else this.removeCheckInfo(t.index)},n.prototype.removeCheckInfo=function(t){for(var e,i=0;i<this._checkInfos.length;i++)if(this._checkInfos[i].index==t&&(e=this._checkInfos[i]).imgPoint){e.imgPoint.removeSelf(),e.imgPoint=null,this._checkInfos.splice(i,1);break}},n}();e.MIN_CHECKTIME=1e3,t.RedPointCheckMgr=e;var u=function(){};t.RedPointCheckInfo=u}(t.managers||(t.managers={}))}(dou||(dou={}));var MessageManager=function(){function r(){}return r.on=function(t,e,i,n){r.dispatcher.on(t,e,i,n)},r.event=function(t,e){r.dispatcher.event(t,e)},r.off=function(t,e,i,n){return r.dispatcher.off(t,e,i,n)},r}(),dou,hoDafJ,dou,dou;MessageManager.dispatcher=new Laya.EventDispatcher,function(t){var e,i,n;e=t.gui||(t.gui={}),i=e.page||(e.page={}),(n=function(){function e(){}return e.init=function(){e._pageClassMap[e.START_PAGE]=i.PageStart,e._pageClassMap[e.RESTART_PAGE]=i.ResultRestart,e._pageClassMap[e.SKIN_PAGE]=i.SkinPage,e._pageClassMap[e.TOP_PAGE]=i.SortScrollPage,e._pageClassMap[e.YOUXI_PAGE]=i.YouXiPage,e._pageClassMap[e.PIPEI_PAGE]=i.PiPeiPage,e._pageClassMap[e.LOGO_PAGE]=i.Logo,e._pageClassMap[e.SETTING_PAGEA]=i.settingPage,e._pageClassMap[e.FUHUO_PAGE]=i.FuHuoPage,e._pageClassMap[e.RESULT_GOLD_REWARD]=i.ResultGoldReward,e._pageClassMap[e.RESULT_RANK]=i.ResultTop,e._pageClassMap[e.RESULT_SUPER_SKIN]=i.ResultSkin,e._pageClassMap[e.FUHUO_DAOJU_PAGE]=i.FuHuoDaoJuPage,e._pageClassMap[e.TIPS]=i.TipsPage,e._pageClassMap[e.PIFUGETTIP]=i.PiFuGetPage,e._pageClassMap[e.GOLDNOENOUGH]=i.GoldGetNoEnough,e._pageClassMap[e.QIANDAO]=i.QianDaoPage,e._pageClassMap[e.GETREWARD]=i.GetRewardPage,e._pageClassMap[e.TURNTABLEPAGE]=i.TurntablePage,e._pageClassMap[e.ADD_SPEED_PAGE]=i.AddSpeedPage,e._pageClassMap[e.XINGYUNPAGE]=i.XingYunPage,e._pageClassMap[e.GETTIPS]=i.GetTipsPage,e._pageClassMap[e.SKIN_MAIN_PAGE]=i.SkinMainPage},e.getPageClass=function(t){return e._pageClassMap[t]},e}()).START_PAGE=1,n.RESTART_PAGE=2,n.SKIN_PAGE=3,n.TOP_PAGE=4,n.ADD_SPEED_PAGE=6,n.YOUXI_PAGE=7,n.PIPEI_PAGE=8,n.LOGO_PAGE=9,n.SETTING_PAGEA=10,n.FUHUO_PAGE=11,n.RESULT_GOLD_REWARD=12,n.RESULT_RANK=13,n.RESULT_SUPER_SKIN=14,n.FUHUO_DAOJU_PAGE=15,n.TIPS=16,n.PIFUGETTIP=17,n.GOLDNOENOUGH=18,n.QIANDAO=19,n.GETREWARD=20,n.TURNTABLEPAGE=21,n.XINGYUNPAGE=22,n.GETTIPS=23,n.SKIN_MAIN_PAGE=24,n.HELP=999,n._pageClassMap={},i.PageDef=n}(dou||(dou={})),function(t){var e=function(){function t(){}return Object.defineProperty(t.prototype,"LuiYZg",{get:function(){return this._LuiYZg},set:function(t){this._LuiYZg=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nGViXZu",{get:function(){return this._nGViXZu},set:function(t){this._nGViXZu=t},enumerable:!0,configurable:!0}),t.prototype.FiJiG=function(){var t={DWip:45036,tMDa:"aqZgPjFFqsmhHJvduxITIh",UwXIwCdG:{},rQKDiKWAgY:"TwjiTZJCoCZqWdgOvvWHzjuvrrLidDuJJiURfAmRpYxkZDLJQzwTJyzKFPy",IsbeXO:{},LhhJOdm:"RxlnpDNrLWvKZKQuixhqCVFWXnUhv",JFAUqIOat:{},JExecnaVJ:"HZToVkoANUoMfgusGtbCqGyTuGiPEDvuDXpBzUzLALMRSMukeCaSmXTPJPV",ygMJNfHYp:{},vmxCqRt:53623,MMLBmBliI:"spNsamidGIuYgGYEpuOxNodYLtCtjdarmnFXYhZBqAnGDcoDbXKDU",tqksep:7891,wQlxXCt:"TrmLQnqWSMJRKStVikaFSKwOJFASKQErIAJbaEJOGaKKtP",KbZGIuNz:[755,518],bQAhnyBb:{}};return t},Object.defineProperty(t.prototype,"DgmND",{get:function(){return this._DgmND},set:function(t){this._DgmND=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MdXvwxMsbc",{get:function(){return this._MdXvwxMsbc},set:function(t){this._MdXvwxMsbc=t},enumerable:!0,configurable:!0}),t.prototype.SYdVPbnw=function(){var t={FZlJE:4701,nRanN:[306,369],GbEJDmxW:"yPhGgXUiCJBJvCDVGYrsTJTqwCxMOLimkwxlTQSwfwoNIgLVzH",MmJLkIf:{},MihoO:"gMQaTHMXUnkKuIFHbhNl",sipJVy:{},CCoPtuTB:95314,yPTa:"LZzjPwlesmqEVDxXzHowCnCvEAmOzZWKAFwLGSph",PEgFz:"YsZDrQsWgJQlnhObqBCjADGfNUxfmPTzGTazNarTyakeumaBWxsLkCUKfx",YvAOtUBAiF:{},fejUIBhV:{},NrJngu:"fEsbzrXXPKkHAQiDeUhp",DlzW:"eFMBRvbeuBaosHZiEnfFnjWOYCCkqxPxkBVpCTvZIdYCfONlkyerCE",tCvAbGpO:{},xkmSiFEy:26545,IZRwleVrD:"TPOdLMhXaYUssbUAptjQVNVKqHBDVDtnvQyiOunqukAcEPK",VFyLVOm:{}};return t},Object.defineProperty(t.prototype,"RIlehfKaUj",{get:function(){return this._RIlehfKaUj},set:function(t){this._RIlehfKaUj=t},enumerable:!0,configurable:!0}),t.prototype.PeZTJxKG=function(){var t={jhuUNxVQe:7248,hXWM:"EwCKLAGYpFFyHEiKnictcGqqASwhdgZjUNXnUYZSGNvVwTcIukqelZ",OQSXgibF:20853,GZzcgRACPZ:"ZkUgwwxjTxjHPkCuYRtoYCfpTcgxXWDexvv",ymPFRaMFfQ:66572,xGIL:{},zEvWHYv:"hofaSQtRvwTOQWwPkHbOEAgPlJLTYkURRMWfXSBp",wDhTzq:"AshsWeqrXVJHfMyrBiLkIor",DGey:"SlIiaStKjpjVupjPKGFAYdwDfZCYSYcdsWbPXsyhqLFBCgfwNzuQUoa",xOFaqBtOlG:{},gHQIqY:"VcUbwXQpIVyuiYNFBpetxzPQPFxfrCUCwlHE",EDEssVW:{},NhRPpBJ:{},KgXfoCHL:{},yRzNgKkeUn:62593,PoNFUJ:76259,EiICLGTVSU:1855,JPJtsBcDEt:10190,KCuiww:"tHrMZeMFHJAqJEqhRHvipEQyUe",JrhvCy:{},HKHQHxd:48281,yNiBEEHuD:{},OKIIVfmBJo:[461,739],WsdaxvsqVh:{},ttyj:20877,EwzCjsgn:{}};return t},t.prototype.SuvEHI=function(){var t={aaWvPexO:43447,OVBUDIMf:91139,iRCpBf:{},GtDGdXUb:{},qHZg:57874,SrxQdoNPfQ:"uPkzJxYtLuPZBXYmsyOQjchqQNhmaANImCdUUqFpKflCDeyEcy",xvQRXi:[758,542],FOPL:{},rUVerOdO:"HTBzfzsBLZrypEsMDhdbK",QwFevtlAks:23895,xujX:92722,sJvpS:77503,SHcGoGue:{},fhTwqSiX:[482,300],ilkAmtj:21505,Zzwx:41954,vZOteKvM:"WqgcrDSqVrBVSVIvomKWsOqnVseHdgtLXwDMaBlJodTFwSLvFXksb",LPdoRX:"wcAoOxUpHWMJROZAEgZcCJfiKuHvdMdERIHpzTiliXOtAMUtyFCWtz",GuitfGdia:"pFTMmKltYZjCcDlkCzRnSqBPtvFDYbUMsqeyceiSbmrHkQYnKErI",cfxw:"aMiQFxmQpNdonTaEiQRkAlymbLFkowDhDUCzimIUXlLHJzYgOpVWItmS",oQIwrIm:{},kCwqr:[779,437],UONZMjFOJ:{},fbmPQue:87051,rAJNURkyQ:[711,712],iziaDdLOW:"GmYGTeIYAVWLHIWfNlRxvcPvEQ",LliXR:[502,305]};return t},t.prototype.GwERRheTgK=function(){var t={rTRXXMqpw:"aLELbPYgPrBHturHMTaBkHuz",HFfVo:75694,QuAn:"reWTcwrDdgcisPVRMhMuMnDeWPIpCpZUtctiYbXmpwGJvfDYprMokvgddVr",ZZVvnojwZp:"LPbdGMtFWMRldaPjGXVvoPjwChqXlnvT",EaYlRseb:[732,351],tzPX:{},DxByNT:{},gxunCQIG:{},NLntcuZRM:[452,376],OaPlnOZd:"iOtPfCzSVWSZgEkdRVLYLDpNGhxtgWhqQFrbZHaICGNHprYByiAiJMFna",GFIzYL:71192,vNvHmRn:{},MXlEQLykfd:"cbIdSCDIQIBkYRilnMpWTfbJdJUvIrCiB",KsjZ:"ekaCWOitfNEbCnLAiAPVVvaSa",VKIMngWJ:{},YcELW:77162,ITIpnCkKl:86486,ChuzKLPO:99780,DJEEl:"doKXWXLuqrIGGhlrIeaEbnsxRkckqtKvGxBTDOZRCQGbtrLYswzkPOJKFo",hADXEmIlP:47722,TRpVp:"VSIMGEQSITGrCFakdCSFrkKikytw"};return t},t.prototype.fRqH=function(){var t={MQuoaDR:{},iOIfvYRQa:"rVSwvkOYdWGkigvixhHBjpcFhQqLqGtSZuIKFziuzfLjopopTTLK",zOjMDcgpI:"sdDdaqcGwFACtcTeOICYOGbzuHGJmSjAOptdL",CyqtonxTiL:"BBUMZFDlwhSPSLrhTzEeIeyXrpWDybVOdLnbSstHJbEPcCzEIfBiYi",LycAZODB:"GPLXxdiOVCBMgfkXYmXHsGveJ",wtmDHWq:{},waKlHL:"lMWjuojAemXuiEpIoJxjzrUWNiIACI",UDImBvdMPW:[436,774],IdyanoT:93511,DOFrLsHyQ:"PsBeeeVJJLDcKxTWcnpGGbRJQMJmpjISIEzxWhvNHnGxgex",KYsFy:{},vGnjp:"WTbmYzXXKluttqLkkvfWECqnaZH",tNQJg:75095,MsVFB:"NyOHtuzvKtFAKUzWdsqOxiEsglcISEtiigiWPnowLqYtErrexzGzpKGIv",sRDz:"kJclxgyBOmuCKUIVZpulzBcaOaJGjMIqasym",wglclf:24636,aXfXabTZUS:"JOUktzwUzKcdjZIsDZBhyEiaiUI",JLqWPCChr:"EBDsbZtutBgmIxryAFHlYaHHBZTmDuXbAXgYXbZkUhlKZutAT",MgEQRqDoRG:[545,382],hsWOBgAQ:38652,WTnLptPDjQ:"OpTfstBkIMPbEexnARqVFkbmzR",OgLGqdt:{},Cbmj:34712,qeJs:"kVVCtMcsKIEZVpilSKQnmGcbedyRhpdmwuyRmU",QsFgRjNT:{}};return t},t.prototype.DVWiCq=function(){var t={GuEwnMY:{},EQro:16019,dnxxLptIHC:"OQcuBGdZupmQquEtJHryZyjsafjc",mfBlmd:"ZpkqoTXqqLgisUfNIfJhownbXJrsAoXDvJkNmUpyVCrEneQJRTEeiz",smFXUn:"ajGwtpohxvYMDWfmSuLYfJDMEavFwLTifVo",aqeP:40181,LniAv:2891,bpgNydTn:{},uNbZUqKl:"EBdAJNLACkLXgKPCUYggMQAABcUX",ScyEUgD:{},OkENklc:11955,PIlIJ:{},ssrRxZgNb:{},grOOgiab:{},TOsYoExxF:{},KtOxm:25947,COhojoBQ:"WNWYNCLWwXYzhDnBWVZlUeU",HCbmhsT:98819,cMtnnBAv:"mUIJhLQciVnuUDzhHaFGAsAnaJkAr",JBYcMq:{},DDyzo:31965,zlqyPHu:{},GBnpAp:{}};return t},Object.defineProperty(t.prototype,"FsVlXLT",{get:function(){return this._FsVlXLT},set:function(t){this._FsVlXLT=t},enumerable:!0,configurable:!0}),t.prototype.GpIBlAumCx=function(){var t={wEBezTRw:{},BaoQQSfgN:{},TNswEeXKs:"rWKCkIiohJgkZulkBeFXrvkyNdjBWuLQthHV",JtjI:31110,Wesibraaar:89921,DypgKxRldh:75159,KPRtNRuaD:"vwIijqcmuzZDbVOKqftZZPKKjtqzsTudOxYOiwGYlDOjt",Ydcmv:{},thPxNjy:{},EJuqvZXe:58430,UseSMsKAwa:80072,vJUGzsR:[581,590],GDpNvRcvb:[454,572],xppKLXqHR:96565,OyAlAGPAU:95949,KQRpbg:"HanZDKwxuuNXQRzltZiIRmUDoAhmcFDvWvRBtbpghQKVItflvIm",tcyMvh:"uEjxNWYssutFlQoFHdEYTtAbmyokvLmfknggrnjBEqKMBLJILYZUnN",mCaZITA:{},QSikek:[590,424],TmnLhm:5021,IvVvneCHG:91952,sgOsjU:36760,GqrVIkLh:{},MDjqiL:21360,KKPV:3441,bbkPZsX:[752,669],DdvIfgo:{},IMATsiZza:82791};return t},t.prototype.svIWMZ=function(){var t={eHUuNfk:{},CwSkdB:{},GzQqmxGBD:59164,HogvubhR:71989,BDRQhIpZqm:{},VLiDiCyv:78368,hbGZr:{},FkoufNsim:"NZfsgGHNwsYbPqmmUIWZCUolhztUVS",vzDMBiBrn:[308,608],xdeSGQ:{},OIbmqbdafe:{},uFJKELSoma:9085,vVgIWVPz:{},hGVTzCzAl:[530,640],yhvOiGvfHo:"TpCRostsNlnEcdPbFEUEgMNfHIKfseqRQoQIPFsRlFataKnZPXbIrK",ioHyJOai:{},TnAc:25007};return t},Object.defineProperty(t.prototype,"hZCTDNKcU",{get:function(){return this._hZCTDNKcU},set:function(t){this._hZCTDNKcU=t},enumerable:!0,configurable:!0}),t.prototype.iRkMCkaik=function(){var t={lSXqRU:"cAlJgiORspKIYILBuixICZHvoCtrNHEfdApFmkqAsiee",RWOQqiMbB:"qeILWfpaAlVMeuwVuPPybsZrSufgKqZQXPwzTkWNL",BfstiTuD:86679,CpfAk:{},sPQDVJbHb:"MnQVywdejxnbgyGcXHFegCwxourOlbKsuxAQFNEzwPhmmpgYgkx",Fqyokn:"UKGjSgSXUPxWZzBBeRkkHZVuveOBgDxavlKZeivwNZjUIRD",Uljmyjjwd:{},xOmAIrrA:"OAvwBcAVbbNZCXIYZOkoJwvgezUchNVjPGmCsNMSfFrUtkQE",lNTjdHw:{},uqLxvKOZAX:4124,nWXXD:40954,kLsTUuJrXC:{},SHteJ:93097,LmpZrDoKXa:[780,455],hjsjwAKrNw:{},EohnqB:56034,ztdYgvAFhy:"udURVeLvWJaECRHPAgxd",ZQzzswAia:5199,okcopZbdV:[706,775],FBaTZZBtW:{}};return t},t.prototype.MrYPkBdq=function(){var t={SfTwn:11118,fShkvgIBE:"nojPGpaeETHEwdcxkMTuylORnTGSuTSUJvTPkCeJnEqHngDIKU",cRakRjbHWo:{},rlUBKF:{},dLXJQsLryJ:{},YpZVIQEhZ:[635,652],utRY:[580,384],XetMFc:[462,779],kbqVIRBvU:83507,gpzUb:[682,502],NqVF:{},YZgARrAx:"qgsHxYljiuWnDEzkpSFBTsKl",QikWwYN:{},lFiIYMlemp:[515,323],cNdxQuImPi:[474,544],hBQVXDuF:{},qFDxeOriw:{},AWxyoa:[405,407],mQAq:9375,ZbPWoaNh:62575,XtXkmoe:{},VjfSHXLIo:85836,UfxoaU:"kSEYeqYUcpnldLGsOkvAyxKjnGRtUaNfFXAOQE",wqZifd:"RNHjGtMndWyknNYpeNJt",mldWeqEwFZ:"LNGmPQoXpDkOHHUeGiJKuacpkDsryeqamfOvOtrdlxnkNNnUWmYAXD",ydbXpEkHY:[486,583],LjfE:{},PKwTFnRv:39048,BEZnOqw:{}};return t},Object.defineProperty(t.prototype,"iOmrpb",{get:function(){return this._iOmrpb},set:function(t){this._iOmrpb=t},enumerable:!0,configurable:!0}),t.prototype.aUiVP=function(){var t={iUpIWwL:96789,KaYQjq:29863,CDvxAkgd:{},yXEsVuBb:4133,nGSGVJiE:{},qvLiKzKx:{},CnAcZMkXTK:"bLOOmBWRaVgrNwGAXgHXRtfKsKUiZqouxdidAdOwrPyVCrAFBifhlsllBiOC",RcfrJc:"PVIRPOvRQSacLYSfMUDELZAbrHLdvucyjkMzqgLBRGkCiwJWMbk",jFRNZfKhVT:"WnXhmvNWQGZSftErDeqczlLzggZsjTACeotPgj",NpMmO:"AdGGikiPZKSbtIKZEzwcZrObjxIs",icnGaQNpJ:{},RyTeDe:[671,643],ATqkRgqtxr:{},xKBr:{},gCsPNA:22101,DRWK:64901,MybzUEB:"nWMsDJQIhtDxjPVXTkhk",vWHlpgWH:[555,745],EekwtThr:[576,524],dWHEjF:36893,vromRy:"fgwBIVkGbFDnreoqKfebOWfqJVqaipzPGwJfxkBkKOIexq",rlotDU:95819,afZO:{},RqyKAxYWBd:{},mUBpsNGl:[505,418],KHVFxn:"ZcGrvVktElKOZHlhzlKwNUEsbMGwiAJhyhlFBpLkbdKCLgrJ",zGjiWeXFNE:"ggnDXyOCQCaVVmVPoVfNzGwBajDHGwnsYGdPyjLCbkVyhysP"};return t},t.prototype.vLjIqM=function(){var t={euJSDJLhi:[453,508],iFGayBb:{},bBuu:{},UPsmvzwT:43126,vqoUeGIso:"hbRaQuqumJBpaXEKGscONFomOQJcDDjznRcXEqxepr",lJpZ:{},wrSZXQJ:"mgYgfbRbLzEZOrifSqmpYQMcvCQjtDOQsYsKAZmmeZrGZb",POBTp:{},ZpULNMwzu:53215,UHkqsO:49372,ahUo:{},isjw:57910,fvyvTreOzy:2909,HBFiKh:{},OQbxRNuS:[630,328],JjQZpbjDkh:[574,582],iLLzA:54179,ufGz:42918,CztuVEDdcd:"FDfWhTiflrZNotwRDeYUAVidNcaaMiDwZATGeKlKN",KJVBfTrdDF:{},iIkTrESkJ:{},nXbuArmuz:"HsfigDxbOMYCUafMfmoQYmWEelOhvGZHWGcVBlEVWmsCFeJGpyZUkh",byoY:"wAeULtjgPdjZjzfUcaGXZOtOua",hNBRyN:{},ACNgL:[458,442],kksfMIvKo:{},boOrwnu:{}};return t},Object.defineProperty(t.prototype,"rjAAaTH",{get:function(){return this._rjAAaTH},set:function(t){this._rjAAaTH=t},enumerable:!0,configurable:!0}),t.prototype.ohVOCIUByq=function(){var t={BlXqfLDPkW:"vDAfnQyWsoQnkzZQYSVlkXcZjfkJpnnfaQJAVBMZmWJPCY",OxYQw:61665,vHgR:"cgniIevjPAVAOgRLzKtPSokfDsgnfrAdHLCEi",TpZKxFe:66926,VVUfZGbf:{},ZtuRf:{},uyxQK:{},kTpdD:"YyTXdMZQgjUhCZysKMOyTRkAASucO",TPzK:2398,lIYQazd:{},FrNYIw:"jXcwZIeUcGsbVWedGMcwARfNzFxlsORIKuWDzpgRSJBrYHwpZYxE",oaFssJLmAQ:{},rZyxpYKO:"LNRjjsgmaqwdnWIfmNohFqxSwYlBaVNKDdkVHhWcZOgmz",FNmme:66953,BGDxy:{},jIyZBzdGE:"LMGixZabXyqejMyHTCFCEhcvBMKlKWpjSoPYS",ngfFVdFmj:70784,KtJMhh:[644,331],hApe:{},ztBcY:{},AsEKhxdyg:"WFkXtZWjVizFqMSCRESxsKXOBdJXQozvqyViBBzykMyaMyCK",gAcVtIA:{},HkWZffHe:{},hBnTDH:"KHNpJMLNbTaOwwQQfXPPJmNWDGDCdJChrdYgFVaHN",wALOkvev:"CXqqAVQsnJDeSiTEgeoOagVntrpdTq",fzrPFzhr:"NNGPyxxBywQALirNtdhUNPIZJtcwKdAu",hYuEYZOlpz:{}};return t},Object.defineProperty(t.prototype,"xxsFAUPQtv",{get:function(){return this._xxsFAUPQtv},set:function(t){this._xxsFAUPQtv=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ZPTB",{get:function(){return this._ZPTB},set:function(t){this._ZPTB=t},enumerable:!0,configurable:!0}),t.prototype.qfuHwtr=function(){var t={Khpwp:[551,491],KfLJTVUg:{},MDamvReBh:86160,FBSmQXazbp:"mScIGwmSwcatpCynbOHkrXdOYEbcDxusujxJtNVyWqpGELFYbBsU",IoUMAES:"rZlfPsRNjTsekVvhblslbBrIRFNskTGmkCbbIzEhZWgJ",xkyqLAGE:{},SnFtpgFK:64720,JDCGsN:"fQcASBHSESStVrbyzAFaDFx",kSWKu:[334,632],ttrf:[771,431],SWRrjMBmu:{},FPgmJDHb:34836,meboqf:9166,DcLeV:29476,XzlDu:{},xMvhPCEhAi:"iTksIwraIHBiUlKQcJCIzhgPybDnbykykfYojIEDhrHyuXWCWEFinpg",zrDLOd:[771,500],fMwLOB:59798,MkNr:85879,wHYiu:{},tWElzyI:37896,gLvTd:"gFvWrLkJCpDNqPBKiBIgUkukPIdOBxlYw",QTeLoNm:"zPeaWfnWjGOhSwJrrROHHouQcUIBEvrfOUTdLQNvFRHKkcAJGvMpZExAkvN",OCIsNWzQLE:74996,tGAEsgGKmN:25092,Xnzi:5208,MTXUQF:{}};return t},Object.defineProperty(t.prototype,"EoxEbcFH",{get:function(){return this._EoxEbcFH},set:function(t){this._EoxEbcFH=t},enumerable:!0,configurable:!0}),t.prototype.cEtvcJKF=function(){var t={ORSVQf:{},hOkgmmEiWi:49855,BWKkqq:61125,RJywisRn:{},uHAz:"YauDqdSOybwTYEqyFNJiljVw",AfjCQsTn:31872,XKTufpOI:{},UygZfmh:{},pfxghAEjca:[577,786],QFCF:"SRuNhwREzlABqAMeUJSfWJHy",VMDmqLdboD:{},IvZm:{},IWdOgZ:{},emGUuQJww:{},MqjhkGwL:{},UgGmTBw:{},VKIl:43102,ciaNx:33515,MmwxQaCG:97037,lckOlpx:4858,YJOlnjz:"KIEXCQKAKLgdeffwlJbWhVvjsPtAXnonfbOPPMhCDSoDMsujsYBLApQOtMkf",nQTgwPq:"kzwAMKjBfGrRGFXcKeYhpPwwxBWYsTEdTpekuvouWgPCegRZNfuDnvFG",QMstT:{},QZpR:{},kvHuhKrIPQ:{}};return t},Object.defineProperty(t.prototype,"AlqJlgN",{get:function(){return this._AlqJlgN},set:function(t){this._AlqJlgN=t},enumerable:!0,configurable:!0}),t.prototype.CXAvsbmY=function(){var t={wkkVO:{},rJQRAWNcXc:{},jtgYCy:45253,FSVcpqD:"IixQXyYUmPjLKRVioNiindiUXtbUqseKvMcjaqCPjDuejq",wxZWpo:{},VdSrHvFi:[387,757],rbSQIStD:5486,fYfjrzBn:9402,yQplA:{},iYYiUuw:"snmcfYXZbaJxCzevpwjaSOdTOyPlWdLMMwaTeAemieqffLYwRikWST",qQboSQMhtH:{},TsILU:"PxBmKizODJbzSkqILWYcSenfJNWjlAfxZAIKyhnPFOumWzaLJcIkCJriwI",UmpnL:"kWeyLBAagSREyGkRWBobbzfBSQFwguZhRCZlBZsceEHodczFI",VUivHear:{},vWExuDp:{},mNneYpLsV:"rgdfQwDGUYVgAPMZVboA",YKHKXGL:{},YCWVoyX:"RGvnplNgqMbHRQVIBonVlFOznSBZcjJgEXDGiPIoyxpcvuFQsMZZDIlVGMT",xGIDpy:86906,SsXCObRM:[392,377]};return t},t}();t.lAWfL=e}(hoDafJ||(hoDafJ={})),function(t){var e,i,n;e=t.gui||(t.gui={}),i=e.component||(e.component={}),n=function(){function t(){}return t.BtnTween=function(t,e,i){if(void 0===e&&(e=1),void 0===i&&(i=1),t&&t!=Laya.stage){t.scaleX<0&&1==e&&(e=-1),t.scaleY<0&&1==i&&(i=-1);var n={scaleX:e,scaleY:i};t.scaleX=.75*e,t.scaleY=.75*i,Laya.Tween.clearAll(t),Laya.Tween.to(t,n,500,Laya.Ease.elasticOut)}},t}(),i.TweenBtnEff=n}(dou||(dou={})),function(t){var e,i,n;e=t.gui||(t.gui={}),i=e.base||(e.base={}),n=function(){function t(t,e,i,n){void 0===n&&(n=!0),this.isMove=!1,this._isNeedMask=!1,this.id=0,this._app=t,this._view=e,this._tabView=i,this._point=new Point(this._tabView.x,this._tabView.y),this._tween=new Laya.Tween,this._isNeedMask=n}return t.prototype.tabViewPos=function(t,e){this._point&&(this._point.x=t,this._point.y=e,this._tabView.pos(this._point.x,this._point.y))},t.prototype.open=function(){this._tabView&&(!this._mask&&this._tabView.parent&&this._isNeedMask&&(this._mask=new Box,this._mask.graphics.clear(),this._mask.graphics.drawRect(0,-200,this._tabView.parent.width,this._tabView.parent.height+350,TeaStyle.COLOR_WHITE),this._tabView.parent.mask=this._mask),this.initMove()),this.isOpened=!0},t.prototype.initMove=function(){this._tabView&&this.isMove&&(this._tween&&this._tween.clear(),this._tabView.alpha=1,this._point&&this._tabView.pos(this._point.x,this._point.y),this._tween.from(this._tabView,{x:this._tabView.x+this._tabView.width,alpha:0},200,Laya.Ease.cubicInOut))},t.prototype.close=function(){this.isMove=!1,this._tabView&&this._tween&&this._tween.clear(),this.isOpened=!1},t.prototype.destory=function(){this.close(),this._tween&&this._tween.clear(),this._tween=null,this._mask&&this._mask.graphics.clear(),this._mask=null,this._point=null},t.prototype.showGuideEffect=function(t,e){},t}(),i.TabBox=n}(dou||(dou={}));var DateUtils=function(){function a(){}return a.dateFormat=function(t,e,i){var n;void 0===e&&(e=null),void 0===i&&(i="00"),e instanceof Date?n=e:e&&(n=new Date).setTime(e);var r=i.length;return t.replace(/Y/,n.getFullYear()+"").replace(/M/,n.getMonth()+1+"").replace(/D/,n.getDate()+"").replace(/h/,(i+n.getHours()).substr(-r)).replace(/m/,(i+n.getMinutes()).substr(-r)).replace(/s/,(i+n.getSeconds()).substr(-r)).replace(/S/,(i+n.getMilliseconds()).substr(-r))},a.secondsFormat=function(t,e,i){if(void 0===i&&(i="00"),-1!=t.indexOf("d"))return a.secondsDateFormat(t,e,i);var n=i.length;if(-1==t.indexOf("h"))return t.replace(/m/,(i+Math.floor(e/60)).substr(-n)).replace(/s/,(i+e%60).substr(-n));var r=Math.floor(e/3600);return 999<r?t.replace(/h/,("0000"+r).substr(-4)).replace(/m/,(i+Math.floor(e/60%60)).substr(-n)).replace(/s/,(i+e%60).substr(-n)):99<r?t.replace(/h/,("000"+r).substr(-3)).replace(/m/,(i+Math.floor(e/60%60)).substr(-n)).replace(/s/,(i+e%60).substr(-n)):t.replace(/h/,(i+r).substr(-n)).replace(/m/,(i+Math.floor(e/60%60)).substr(-n)).replace(/s/,(i+e%60).substr(-n))},a.secondsDateFormat=function(t,e,i){void 0===i&&(i="00");var n=Math.floor(e/86400);return t=n<10?t.replace(/d/,"0"+n):t.replace(/d/,n+""),t=(n=Math.floor(e/3600)%24)<10?t.replace(/h/,"0"+n):t.replace(/h/,n+""),t=(n=Math.floor(e/60)%60)<10?t.replace(/m/,"0"+n):t.replace(/m/,n+""),t=(n=e%60)<10?t.replace(/s/,"0"+n):t.replace(/s/,n+"")},a.getSurplusTime=function(t,e,i,n){return void 0===n&&(n=!1),a.getDateByTime(t),n&&a.gZoneDate.setFullYear(a.gZoneDate.getFullYear()+1),a.gZoneDate.setDate(i),26<i&&1==a.gZoneDate.getDate()?a.gZoneDate.setMonth(e):a.gZoneDate.setMonth(e-1),a.gZoneDate.setHours(0),a.gZoneDate.setMinutes(0),a.gZoneDate.setSeconds(0),a.gZoneDate.setMilliseconds(0),.001*a.gZoneDate.getTime()-t},a.getDateByTime=function(t){return a.gZoneDate.setTime(1e3*t),a.gZoneDate},a.getTimeByMonthdaya=function(t,e,i,n){return void 0===n&&(n=!1),a.getDateByTime(t),e==a.gZoneDate.getMonth()+1&&i>=a.gZoneDate.getDate()?a.getSurplusTime(t,e,i+1):e>a.gZoneDate.getMonth()+1&&12!=e?a.getSurplusTime(t,e,i+1):e>a.gZoneDate.getMonth()+1?a.getSurplusTime(t,e,i+1):1==e&&11==a.gZoneDate.getMonth()?a.getSurplusTime(t,e,i,!0):n?a.getSurplusTime(t,e,i+1,!0):0},a.curDayHasTime=function(t){return a.getDateByTime(t),a.gZoneDate.setDate(a.gZoneDate.getDate()+1),a.gZoneDate.setHours(0),a.gZoneDate.setMinutes(0),a.gZoneDate.setSeconds(0),a.gZoneDate.setMilliseconds(0),.001*a.gZoneDate.getTime()},a.getCurDayStr=function(){var t=new Date;return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()},a}(),dou,sXSM,RUZJlpAvq,fIpZIu,NSshsfqrx,LLWSsMMcy,RiAecZ,nTbG,SOQJ,qkMRu,dou;DateUtils.gZoneDate=new Date,function(t){var e,i;e=t.data||(t.data={}),i=function(){function e(){}return e.setData=function(t){e._data=t},Object.defineProperty(e,"data",{get:function(){return e._data},enumerable:!0,configurable:!0}),e.getSingeTempDataById=function(t,e){if(!t||e<=0)return null;for(var i=t.length,n=0;n<i;n++){var r=t[n];if(r&&r.id==e)return r}return null},e.getGoodsTempById=function(t){return e.getSingeTempDataById(e.data.tb_goods,t)},e.getItemTempById=function(t){return e.getSingeTempDataById(e.data.tb_item,t)},e.getYemeng_backTempById=function(t){return e.getSingeTempDataById(e.data.tb_yemeng_back,t)},e.getYemeng_configTempById=function(t){return e.getSingeTempDataById(e.data.tb_yemeng_config,t)},e.getYemeng_dituTempById=function(t){return e.getSingeTempDataById(e.data.tb_yemeng_ditu,t)},e.getYemeng_mallTempById=function(t){return e.getSingeTempDataById(e.data.tb_yemeng_mall,t)},e.getYemeng_mapTempById=function(t){return e.getSingeTempDataById(e.data.tb_yemeng_map,t)},e.getYemeng_skinTempById=function(t){return e.getSingeTempDataById(e.data.tb_yemeng_skin,t)},e}(),e.Template=i}(dou||(dou={})),function(t){var e=function(){function t(){}return t.prototype.llICjIjjr=function(){var t={TWMgoKVxh:92979,YtekccN:{},vufNXrjz:{},rdoLAVCQCo:27019,gvEV:"JiAFptYWQmNSJtXSZkiOGYGyMcCLvFhgnBJgLhlxqQlPFrRuxCNRJVi",yqameim:[763,524],QMYGUBbErV:{},lJSWNTkteM:26844,jOROs:{},ByGJuwzT:"zwgZurUOYdKmqGBGqDEgWztbVQTfHrUUbKgnZ",oPUG:"zpGYqYQPyGYLCCprNZDl",ZmSSdSRI:{},LOeitT:{},GZrXFyB:{},htcXa:"JEVfFitTYTOiGrGjTqqdIfYLXSg",ecCaVTHJDu:{},BPFPkYfaJ:65258,qhqHchwMs:62632};return t},t.prototype.ltvY=function(){var t={tHPugMA:"OBuifSJlMNmtKrqJTEUPLebACFPKmspeSNisRPJT",vaEIbts:42715,hocQIGRSq:[325,346],yguy:99218,bacmjAqiuY:50275,ZsFe:{},qlOxAu:"OHUvLyOzCgxwligdkNkDWYUHOYVNsApsTiClHE",rHnpVdt:22188,qKvOLQ:[684,365],GUzTaRMA:{},MjqHrcQoB:14085,IQQIIosDB:"IGysHCmNEeBdVvKGMinwkmuCkaknaPojwI",xixHYDRmOD:"zdbAsAtNcuajcGrDayuEAsLhJWeNABySflAyeZeEczqscip",HoOSCgA:"XdZqnSOzSCmlqsKojQDYkwVSQpIuWVLOYYnMwkDywRUCVBVAUAlUKKw",rOPmwCUEKK:{},MZhatrbBbL:37135,KTLWyChMI:{},uMVjWCSdp:56064,ncnxk:{},Ookvtskhab:"JurjnqaSqUTCXdCXFzqEPMhItpULRs",hdyIRYySYl:9480};return t},Object.defineProperty(t.prototype,"NrTehyXIl",{get:function(){return this._NrTehyXIl},set:function(t){this._NrTehyXIl=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"KftYEkiNb",{get:function(){return this._KftYEkiNb},set:function(t){this._KftYEkiNb=t},enumerable:!0,configurable:!0}),t.prototype.xIahIPAV=function(){var t={KTokXgA:{},JjKUrmxkV:{},eYvnzPqwM:2628,LZxDyDomA:[745,546],oKIeWE:{},lroxVqNXK:22892,gooOxEE:"DctvQeXQUFDqFsItcXYTyAsJPoCOwFlYEAPYJ",GyJpWjm:"NGOZJlfrQaOwVEaQMCPUybLqKGehtDMUuPV",PpiQTkq:{},ypbvqoWmT:58967,KzvQkVN:72983,KxuQ:{},RDnUdTk:{},mUwQh:"ACEFeyQewUwfCPPFxfEvhvGAncWrbwFQdndKcFclDdVbVcqDEdkCJ",XxCOGK:{},PJmHhqrs:77247};return t},Object.defineProperty(t.prototype,"aIoKEVtpVB",{get:function(){return this._aIoKEVtpVB},set:function(t){this._aIoKEVtpVB=t},enumerable:!0,configurable:!0}),t.prototype.gmniz=function(){var t={yyVYDmBeIK:18684,plWwjN:55052,RskYYse:"mrdwnseqztYAswLwsNMCSAawWWnjaKLHmP",tKyX:[358,427],iAPj:"DkLFbFSlcJdpobvMwpoTsjIjElpM",fcEVZhPfsO:4544,sHaGHxH:[545,423],JtqPbrRrlo:"BJZwayPyEWFChjLHQHfuOomSyIdNUpzAFNtZajMGDEowkTPlERT",noMDv:57215,gaAiuCHw:{},staOUxwbZs:[564,585],hXOdQ:"yTSPwlPjbANIpdVkrgGZiZOBlodsRgHdzltQLBdv",YaWqp:"nsQsnpfDyNoHRtidIBbFbnYaEhagKkxiVzdwgDLNjjEtLYWSYMXm",mHer:"TjNnQavPVQPqFSsftkGgEqRGmiPbDvCGPDUFsXJVNRypcDYunYmUs",pjZkBiyp:[496,553],JzUS:{},YhiMfk:54659,TkYamRR:"mgLolRtlRwvDmgwnmihKVhyx",YZktkky:58919,hQzGW:"UCQqoxuZRhUPYELcbLkxVDDvOiZffKloginAAFALtqnWGqpWgFeKepDiUzON",CXRICo:"amYeWxfDPPqCtHrpQpVeynCEhyPuAgNOBfyhuRxwkToqwyN",kiiED:"ouIReVfegvySmDqBeNEXdwQcHbZSVTVjbvFOvgrioSLUAwP",oDlv:12671,FRLbUQRz:[424,755]};return t},Object.defineProperty(t.prototype,"wxpNYF",{get:function(){return this._wxpNYF},set:function(t){this._wxpNYF=t},enumerable:!0,configurable:!0}),t.prototype.rBZLBhQka=function(){var t={gkbBlxhpGM:{},ChNfBrnJu:{},oiLd:[594,730],dILHGqarU:"KtuxyLbuOQnpLQujIsOvcIWXUcYYkGuNgTjwuckxMO",CSJDOWHQ:"OmwGdPmUQLRztupISIZjaDWoOutdkvqDfmGPh",lrIaQG:[667,612],mGAgPJ:{},djzkBYs:[461,800],oUECJZ:"UyLjLEmoTQaoxvnVavZjxdZajHcjfhmK",iQPfIyUjB:"odEosohMmvmcGtcOfhQyOWiRMzbXYKiJXgEvCmpEsavfmqPZLGAVGFCVKsPj",GAnMMSBU:[778,751],cptogCDyQl:{},AEDlu:"uWlEVUWbkixNRmgRiXQFtfRCpwISBXzVYYhC",AjEZgUjapI:"GBmHZlAJWeJFpYwoWloKTJmWkImLUDBbNVBNvnCvrhiYbl",hJua:"auzfmadWjvwQqLsZozgBeFZh",uCIZhJVt:{},hyDdgaOr:"hNEqKzMKMJCXLohgaenjFtziXHBYkREjKspVsmmONvZvKykcSzrfAauW",ajEBTNcH:{},pmJm:{},VkDiH:"YexkRnrWiNonEztKQSCWZW",amwXfed:5187,zIYvV:{},qBOjOoC:{},QQnOZ:[604,772]};return t},t.prototype.gvehYmzspm=function(){var t={dvcU:{},ZWIjAp:{},IbJCYW:"DRGeVCOwbjZPcdtmbQQCjLwCntPqWJZIm",zcGEqb:{},KDWY:{},LYyMkQc:{},SdMq:{},uXkfAwx:"gIxJwhbhXtBXLXeearJWCIDJqJFbOlQgWKxWcnBqXtbeRelDhsPsdPuD",jtDFQZZgkl:"FyyDACPSRVFvYRkTnSoarJkNiZCUUweNDfWfGjgteyugUhtegcB",vVzPq:"wJSesLAnkDaVDOnhFkfXVatOQKKWtzQmiRyGdUQsenYQnYYqK",dZAEkmYrAo:57859,icEBoAKnN:{},psxBfViC:96562,SPSQS:56363,rUGjxndfbU:39087,Gmcum:{},Cxfmc:"pcbDlIArttnpXchdUHxYYoyqMHCkKgONbtImNfvRenoPNWADCgksipVwT",LvEhvgcl:96281,lDxGo:{},tFBbe:21799,wtvMghc:{},hnygUnlPrj:"VSHQoZjltBXtumRRHdGdytUMbFdJlnUsKgoNWN"};return t},Object.defineProperty(t.prototype,"pOAXGIe",{get:function(){return this._pOAXGIe},set:function(t){this._pOAXGIe=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EeNTwT",{get:function(){return this._EeNTwT},set:function(t){this._EeNTwT=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fWzON",{get:function(){return this._fWzON},set:function(t){this._fWzON=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Lqsqq",{get:function(){return this._Lqsqq},set:function(t){this._Lqsqq=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"WmmDufO",{get:function(){return this._WmmDufO},set:function(t){this._WmmDufO=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kluADriJYP",{get:function(){return this._kluADriJYP},set:function(t){this._kluADriJYP=t},enumerable:!0,configurable:!0}),t.prototype.mxhkfolnFi=function(){var t={vUTcdy:{},ucwQQerbi:{},cYaI:27464,yGZrr:{},eXAVFVQYri:27044,sxYSkB:"nILeoTgiPLhNvDrlEMFlWFnnqvktOzxMkKHCVmfNZoWeWrlqG",PXfUe:"LWShQjAlEAuBCeTZjanRSygEpJHSLIoqtuVGU",Gftw:{},KrQdRbUGx:61321,ggWYp:53689,TWiZOSRAV:[377,518],ckdBakwjxF:"LPYPCfciSSjKeiYtHNeQDgAIyqKXuNbGweebDgJAzvuHggaQXwshnZTLCOYh",UmrbzYjNE:63750,VEEf:[484,728],izbgFKA:"VNNVxqoBcUHXxFwxCXKKYDoWDBRlIqr",GjKXKJ:{},CmTNuJNhN:26672,NzFR:87906,PFNwdf:[603,332]};return t},Object.defineProperty(t.prototype,"EGwL",{get:function(){return this._EGwL},set:function(t){this._EGwL=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HwaLfsZxS",{get:function(){return this._HwaLfsZxS},set:function(t){this._HwaLfsZxS=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"RGXs",{get:function(){return this._RGXs},set:function(t){this._RGXs=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"peFdR",{get:function(){return this._peFdR},set:function(t){this._peFdR=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"PGVsbGvJ",{get:function(){return this._PGVsbGvJ},set:function(t){this._PGVsbGvJ=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"LQxXRRrwZW",{get:function(){return this._LQxXRRrwZW},set:function(t){this._LQxXRRrwZW=t},enumerable:!0,configurable:!0}),t.prototype.tgRpcfbJD=function(){var t={vGOtBvC:"tMtopshqTaaVsFEygaTnFOllPnpZjOlRxdcOyxELLVchtWVQmJo",GZMSrdZ:"RNzhBczYzqSoMvXMkZMOQgkVmEzYAsXGPlxkuQ",SwQcXdpfWn:56275,cgDdnHlxUL:"JZvbxnOLVaAHxjzgxqAUyDRNkjgKPcJLAstwcN",Erhb:"pBojxWteEvqVxnmkDpJrncyzHyViok",MlyEeQZ:{},RWUhBSSX:[358,335],Givvn:{},RRomgna:{},NDwO:78706,xTeIZve:{},RJKCJMD:[308,330],GdwMJlG:[707,614],oAagLXq:82676,HhEalSIpnN:{}};return t},t.prototype.WaVBba=function(){var t={aiqVSNc:{},RGFN:{},iMghZSiz:24164,JhzTm:"omTHmFXtzniJeVhvuVBZDtlGkCbVOrhBIXoUdBoIHsZwJJUOkAGjSeKMFN",dpGYmvDa:[416,572],vAlCgfPP:75500,lOljxJaF:"BFjEhEPvxlhepaxakixqipBGMDNXwa",APoQ:20481,PYgupQFV:45205,FXAm:"sJUafgMnTUpNGLMSjnwgOnWuGuLtBEnkIYpjqQKclHoPXlMbvqhXSWcsYZAK",RTkZ:77558,qKSogmzgzE:[692,713],QjEc:"jiFdJYmePPHjalXugphizyCRTXxCtHMmnLmJDKsgKcaXXzCVpi",CEcKRxS:"RuXbTWqbOsNexBXLFSPDbXrBiSxoWqvDAblqLlmAXslb",uCFhIRk:41486,HnTXF:{}};return t},t.prototype.CSGvLCFYK=function(){var t={TBaVEUW:{},UQEkzpcF:{},KkiplVofUy:"pURNVscWkbGzRpOCfqwydpZyiqSo",vVrDw:{},LAlApL:{},BPRgMl:64031,OPqm:"yJaUZrRXjfrJDojKrhXBeTsqIaAETYoeZMoF",wRZeeC:{},MWuevn:{},bLozJxKdz:67225,GLyT:"GEBmOYJOvDqxUsSiSzDRyQp",LnRaNErnVP:"TRDNumprNiNkHTetaVnKIBPVrFDRxuaflwksex",lYuqf:{},YsnLqgm:[397,508],tBDYe:{},aBOeGe:31621,RxbwyScA:13049,FgfCQ:"OiWdpsQlaYCcfAWZCjftUyNtBNaNJgTHkZJLMDgNhltW",UORlLBEk:[308,307],TOYCjivBBZ:49970,SoXYUQASBz:[433,668],YndZDeJ:"QLMZprGCWnnUwELIHRVexuUTEWxrqEAsLwLh",oFUg:{},qcUJNksrC:{},MypNinInT:"QEEeNCQbUtMkTANVdBhZwfqTOtBpKGLUZJOZn"};return t},Object.defineProperty(t.prototype,"CzQGPeD",{get:function(){return this._CzQGPeD},set:function(t){this._CzQGPeD=t},enumerable:!0,configurable:!0}),t.prototype.UCwBkNYk=function(){var t={WWzXbIr:48737,UZETXjC:48979,QWFAovZaI:{},SsaYlx:{},KYaFwtlIiH:"koZhSjGrwIkpHyKeIOAgHoowtDGMA",erppxkUgrj:11562,KQCl:83168,WtVoxCRw:[472,486],uMGd:18638,gZvBbZLm:36126,NgpTARp:"IQxrBysKGXNKcrgYxIGvYSDsIdTOHl",EiJBAmnm:"VFtIOvjTpyVWTAslWSbnlkEDcqMggWNLpdsiM",bqKA:{},NmWUBmQwbM:{},OhyAkWxebY:98052};return t},t.prototype.nWaXJY=function(){var t={cSeRJEi:32527,tLeU:{},fwAQvymqbE:"nISJnuyZBKTQwrQSEOAKTjr",FGMjKkT:"kxcWLVgLPXxkyTLXiGfNVYwqXnrybmdbbVPLf",ajONVskuzn:[594,708],DWMEwSlU:{},baIm:"kCFXPuNAnnevUJADJOTvAISCVPnkmvasoyJsT",ElhwTqWgp:{},XRUWTJwI:"WyKHiahwEPLBTzIisBUOilffgQPVdlwJmLFqNqrd",duvJBF:"tKxjOohhsFAWqLSdZOPhAzoFNiCRimmtRxakAwpglea",WQWrq:"rHZiCNBhDWUsFlxbrUMYSyws",OfInCswa:{},gVSxAz:"DpSeFtuGAwclwAsQqQDZNRXLQLWSDAjfbKSiQBgkljPOZ",TQabhHL:46015,JdjOXxCym:{},gMkEX:{},dNPuxMEn:50227,FBaQoiSf:[561,504],gORoEOs:[329,785],CPejejLa:{}};return t},Object.defineProperty(t.prototype,"nwaTIAD",{get:function(){return this._nwaTIAD},set:function(t){this._nwaTIAD=t},enumerable:!0,configurable:!0}),t}();t.EaFcnjTCq=e}(sXSM||(sXSM={})),function(t){var e=function(){function t(){}return Object.defineProperty(t.prototype,"bsVpwAX",{get:function(){return this._bsVpwAX},set:function(t){this._bsVpwAX=t},enumerable:!0,configurable:!0}),t.prototype.nBZDH=function(){var t={YchqcCAQS:{},cuOQcrFK:{},YZUSl:{},QADbUJMQ:{},YOLh:"YjYtRypGJadOasJxwzhpWfCTCqeYpjlGvFOyZuLXOQ",RvPZVbdPP:82247,ifZEgD:28890,SBnmxlx:{},AXbnMvXU:"qSwtigtLQlfieiKGwuCjANTMLSz",REZW:{},iKVfT:"wEsHJqZUKTamZOBuPobyhxHcRSArGnJxywekIVgXOylDZcZWBpbXmhGLdz",Jmrzra:"XcFyCDhTPYHStyquERiTbahrjXebradRgWqbGKoOGRJYlOjvmneqZYcYQt",yvfB:"BVnRwNIKIsnmLJbUMoCIwKkKrsrwbpAlrto",LFeuIW:"PhZdYnPzhgjbOfbdUrtHpEFzoGwWWeLCswCji",HmtTI:"qSpLvNNYcPOyhaOUWagTtfcNdElnZpQRvjHXKxwdENBDSyNqqYqQJDQneVI",hCnccWgA:89081,NJwmZN:"WTbskYDJlNmwLuttIMliKuGiEuhrjsXMxPDf",UrUGTQ:"xRSvaGGsnVCTopbCfJlYpROLrNupPxgdrwbPczIsauWmQraZPkx",CemCTQyF:32573};return t},Object.defineProperty(t.prototype,"NSdTiTc",{get:function(){return this._NSdTiTc},set:function(t){this._NSdTiTc=t},enumerable:!0,configurable:!0}),t.prototype.BOVepDEG=function(){var t={iqcDNBz:{},kEVfb:{},RjHJK:{},nhNX:"mwTMtbcPpsKCEdxxZnKpSRErWlPqYUlnCQOJ",zRuQbfAFu:"ADXAWviOqzEjyfSUwVvwe",UEDDA:[514,317],ADrVpZTB:24210,sckSZfc:27249,lGiF:51903,JxThMN:36346,tgVAtRhH:{},LbvVHKdVY:[572,455],muwUUND:"ezvxWqogWrqdytDDBZLQuFqRUibxLYZqoVMDiyfvEcPwY",xRdT:"olPQcuAIfOUMwGsjagobDBdCaPXhBuhgogOqkvLYiTdzXiGX",kcygiw:{},dpDXHbeM:"BcDORyngAraKmGPayhzKxwzKcTILwnsUezHcBsXYYPQknPMYypdJh",vryxJp:85335,WDSzWM:{},TAMyi:80742,GXLOeKuiS:[761,331],ZoeBTTc:"LWVtreMMZAtbbOWUENPpiSMAPnwWNRbmOzUOWkOsZXiOxXhNwjnFT"};return t},Object.defineProperty(t.prototype,"DgdQhh",{get:function(){return this._DgdQhh},set:function(t){this._DgdQhh=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"krQHuFmD",{get:function(){return this._krQHuFmD},set:function(t){this._krQHuFmD=t},enumerable:!0,configurable:!0}),t.prototype.VIcxCYSn=function(){var t={JGMdnez:"cfkcpfCmRndYZWEdbcZaLlzrRVJQm",yDJhoq:30307,VPHlHZm:"FawKlLRaFFLtZtyjdysoILmHMQrqMmIDgspCzrAbe",hIfOrZUoEF:35168,pNbyOSImwc:"BjSzBoVDBZHVlIeOPEekeQJgGaoPUtgACRDKmRHLypaeDDHXjSwsq",xVZKFJVVKu:"GkEAmaUoGyWbMkJCQspK",bchhltD:"trqmiEmhVrpVEErGWjIhqRKOXC",pVlzoZDN:86842,cUUvNfGlHL:{},ZWWL:{},EzDziLSdLX:"EglZPZAxzVcoayEkFNsfTpxVUMPfnTjKTZRZewkcfkYgQEB",OqJbGvIq:12505,wCireGrVcA:"owEEhnKjqELVPwhqvwAKAK",pYmiE:{},PXFW:{},SyNb:{},OQtIl:{},VxfSFQ:{},tJYDW:49707,SZrxefiWk:{},ndosePBFZ:65629,ORtjtVLvwY:{},VuEPS:42504,wWMMFXUMf:{},EQrq:{},ehffu:86987,urCAoZoFUP:"eBdGHeKCmTMwDopXWLJHiZWdgLSwlvbY",BbRTA:"HgTTpeoNEhyKBODNOrCzZPGWAZrzCyCVVNinmyqhBhfIrXxTxJYtre",PqxTdGEXAr:[353,361]};return t},t.prototype.qyoOjzsT=function(){var t={nexSeGHt:"aSbgCqXoJQRIkshlVvuBlazJrMBrdcqKjQMOiOVVrLjkpCxHYEniQol",ajKdHhZpkA:[331,380],qYQvp:"nxfYcaQdMraPISgjGVCginmEksynrslqkMYlqphIfwfw",mMByTDGQY:"boFigVDlDgqoYIkQaqFCzavkJoMhVDYVCSispyflKvydIszZz",DzdCoVcEEA:"DubarGNgTiwnwTKHiVpcrHmoskDPnfCOpqjPecWflBtUjn",LbzZV:{},JHZAaos:"FwXqecUeZbcRXQcBRcHDhusZyJyciLUai",OlxbtL:81564,roord:{},asAuXCAg:[491,428],RyhudCnW:45909,rdBzdqyybx:"lDCMxVDmtzGnoqppPQhaJaoRffWPgNjiHXLUzpLXWXGqVJIAqu",hgJzGWFY:13680,QnanqhaDq:"CwrudqLayRpjolcpOuATZONqaxUlJbbLvhZwGNrxhQNvmNLfh",UiqOeNX:68198,JRtEAIxpY:[759,352],wOttNrTMN:"euCsyXmLOVeZlmXgyhaVfzQeBlKg",QwyxZv:"zZDlCYgzFYkxSbRzVWpJooGpJpLclADEmhRtivpuAiAfOhXNhrKZXSpMCT",btmO:7199,odZZQX:17354,wvwJxnJ:7840,NxVxt:{},tfjG:"rYvhdPOeTEibQRCFNaDVfqTMxhemyWGyJlrGAjzDFpAuBX",ZNraK:{},eZdLPCdjUU:{}};return t},Object.defineProperty(t.prototype,"fIfV",{get:function(){return this._fIfV},set:function(t){this._fIfV=t},enumerable:!0,configurable:!0}),t.prototype.wLATNVO=function(){var t={UbjRI:{},sNMM:86673,JHPaAVJZnI:"aBQrLfVDRxXSBXKhctRltTmFoAPckzOByISwJcb",FsoC:29352,UNsUlByj:"aIjlMGehWRXXAwcqEYuvLrtySulClvhJWuZqxhCEuKKrdCXaRgNuUm",anGg:"JPuVeasgIIJUvupHKRHtCYWogElujDSnKeIqWbxJDkT",cBeBT:{},IRTtxPN:"cGHDmbiFqqFjZdJromGqCRGReuRqLN",ijLsnjYLqY:{},qbbzuyn:"NmfpcYqaEXinFSfiWZPCHBeaVACBTBHp",eYSf:8834,cVqHXdl:"FgMifTQjmUDxMctpCLbfDKMEpXKjPDfwziwegBDzPBHt",XVVoDHcXZC:16913,aRznb:"IhkCyIeqgtnMhLffpTUmvXyJsOBgHQToADuOceWpxBSFRMChCXish",kwnBs:88574,zrgljS:{},XUbaztdX:[742,694],yGlcBAsxAa:{},OSdTxXP:{},QvOJJfmfHT:"sxTpaZLGRyeQcYkxrwzlmOEsfZKC",xqZjgK:67046,tZDPF:87417,fcKaJtX:"gsJkZQuWYebGjkltNgbhLROZsonlhyJgRiZPYGACd",opOmVfJ:"QLXOCBNbnUGPNoGqDVEoUqdrIhzgGTIpxLCLAbXceoRhpckPSOCfLmqZxVxf"};return t},t.prototype.KDCNpCtxI=function(){var t={SolSWTUdW:{},AjKfa:"ykCbLUtqQSyOytHApFLladwhGNaJNiiFzzOgoydqweUVfvbfa",ejZiUU:"uYYPxRvPuNtqQmlifwEZQzpZqquESaHprObYV",gTBp:{},DbgiZ:46973,DzDhvBeTat:54973,upfH:"jSjXdFQGBNPPwotDOFUOXDBZ",vlwSKH:{},Obrh:{},dfFXUXDViB:{},YxKqYNi:{},vRbUTqiLa:"NacFfsWcnYsinljmadVVdYnZnOQGbbLqohZeTqnkaoMZR",kgbzSfBdF:[451,470],OEsiqu:{},hxPO:4420,TQIiPvZrk:59741,zxQMFDKBo:{},NrzmggsYe:{},PhRCQwxtK:{},pjZeZ:[730,428],OhDZyQMS:"oalEuFnyNgCQYfIIpLvjvxljwgGutMkf",cOZwFA:{},TTGGRaiHVz:89420,geOfNOSjOA:"UhLthaEKvvkJeEJFncFyLzZSnafmglDaGyrViisIrDnDPOB",UJWoaaM:56496,EquzoPN:"WdJXuHxAUWNsxyjYLjJNvscsKrNwGhzkHiMWKaS",XRNC:20696,rQOGg:92390,uhyE:"DotwPELkhRSQUpjRBsqegsxhbiQdSyhTLesXxSfi"};return t},t.prototype.ycsSKBDpKb=function(){var t={qukvdk:"FMKBnaHfWVgoVlJzpetzClLtzSK",ECtV:"OioJbuDoYILTJSoMXhwubXpWxzoKWVAquTSfVTzzRAzMwmXyHYUt",vVZVfFd:12831,RBvQCWVMnJ:"awhFgDuHnaIyXSjMXivHecWmptxWdvTXEjWwSRRdxBAom",wAnaCceoc:20146,cbOBWTkw:"oQAAtomGFYgEoNwqOEIomaQvFeuhBxTzxArIizaVCsdGKwSQSv",UcMGoq:"XwrukrKDlCPemiLbZgguSzHuKvnLddtAONKihUEamMzjME",VMgrEtfKG:{},zJIGK:[485,389],CPlI:"FMIXllIdvKxEFFhgupqNRXDsqBKjdPVtdwghKH",UuwxYMPY:13031,yVyVXLgsDW:44045,UbwiXeHb:"UqJJXaHcJgCUpeEuOiZZdjAUtRMxBzjmrJPF",aiqprd:[382,524],kwHIjvc:"ecjZBqKmugYSJeWBbZdIXrMFlvDannQGbywvHudsyRMJIcywAabkfC",RoMGoufg:26180,pQohlAfeu:[388,366],TnpxlL:{},Crqz:72591};return t},Object.defineProperty(t.prototype,"UyqU",{get:function(){return this._UyqU},set:function(t){this._UyqU=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"QLnciXgrmV",{get:function(){return this._QLnciXgrmV},set:function(t){this._QLnciXgrmV=t},enumerable:!0,configurable:!0}),t.prototype.FAYQdC=function(){var t={ZoyBAV:78914,xOrrX:50822,VjDgZiJi:"pIdpEPXuXayobiwNINRAKVVVAlJrxRMNUAnyXqAuClBaQZiilusGHm",gGGxyblCKA:{},AuKcJ:{},QjLsAod:{},gZTFe:{},dbquVLQGk:"nTNcOdGMjfvaRJnpzaiRWyFJMzXMDrCzykTeuw",OBwDhAv:39682,Aricl:{},LybkV:"ffzJFVsnEQPKsRkUCwZYZceJjwxRqJcoWjBcWStXwHkOvXZBklaQKzMHcfqw",UkZqBhHFQ:"xqkBbHNxVilWrQjoUTcOZvxYoWCQmExHFNktlbvEBqlWAYFoW",ZlnNM:[652,732],rome:67892,JQhkK:68566,jyLxRjoD:{},pgkOuP:{},mGlFbujNPr:{},oYtOrIIpa:10795,oQHDsGwaMh:50184,yvut:[598,421],DlBablUmp:30201,rADVaqo:"TrCGBxoaSufTzUeTiAFzddHvAbunVCKiFAgCVHeqgNhs"};return t},Object.defineProperty(t.prototype,"vilutMt",{get:function(){return this._vilutMt},set:function(t){this._vilutMt=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"jcuefCHVBM",{get:function(){return this._jcuefCHVBM},set:function(t){this._jcuefCHVBM=t},enumerable:!0,configurable:!0}),t.prototype.Iietoamiv=function(){var t={nqpMwLfemL:{},JWoMQEj:{},TqxNHlf:"jSFXQeXhDISJhvKxwihHQhaYiUTqyShhWUiJfTYBJafZpysItpLEDls",nkGNGsgR:[664,556],Wzpz:"VkFOMbHTwSfXgRLpNLaMtNEgULPGkVmrYuUGPBsWovhO",atCUjuM:"TWcfZoWshIBcvAvRPQJzSaltPRItEVOUnjYzIjYZpepMpbEQRUOYIibUR",wojFiRLcS:{},qDJPHXCJ:{},HnJOAPCjmE:{},HQwGcTyeYW:"UevfpDyLnuftpwgUeADerPZzpvqsSNpXYVeobBHZunBhPvxq",AIxsZ:{},EbrAv:[610,574],caUu:90471,HLlSsvxXvB:{},VckVpx:"jLPRbqxRtvzXnQxQfFmdkbCoKAqHmcGdIRzXKUn",qMclAIsCP:83289,nJMI:45492,jyMm:{},sgIYmNunKr:"BONSWrmAVUncScJVfezNNTNgHfxvisdqXSfptqIkjmLTQpnQBWjDTlE",akoijPLAP:{},dCXotId:[403,791],bLQKS:[379,550]};return t},Object.defineProperty(t.prototype,"wGnnHztpc",{get:function(){return this._wGnnHztpc},set:function(t){this._wGnnHztpc=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zKKthgeZ",{get:function(){return this._zKKthgeZ},set:function(t){this._zKKthgeZ=t},enumerable:!0,configurable:!0}),t.prototype.fWybZVsKBv=function(){var t={lqtCdGkr:"FFcCIyRRbGGNIORpRaBNdAOGzqSeVQPCMEkKOWTlIWoYtGsPMf",Reud:23321,wZqpI:76896,DJzhxpec:{},DulJ:{},rljr:46592,pQTmCq:{},PfCKd:51118,YJBrKYVb:{},iWNak:49299,szNMuHsP:"XrXwNbDVAMqJosRFaIGpQqqUIOJrSKFwtJNivMdQsCHbZKtbFdpJOz",BEBQ:"oOTYvHytvRnPTpXwKFkqORnULzsPEZ",DohKxSRt:{},hjPkeJYa:[537,735],Cxvld:{}};return t},Object.defineProperty(t.prototype,"TWGAFaLkhO",{get:function(){return this._TWGAFaLkhO},set:function(t){this._TWGAFaLkhO=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ljuuhVG",{get:function(){return this._ljuuhVG},set:function(t){this._ljuuhVG=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nOwtmIMCCh",{get:function(){return this._nOwtmIMCCh},set:function(t){this._nOwtmIMCCh=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EVgDceKP",{get:function(){return this._EVgDceKP},set:function(t){this._EVgDceKP=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"iXMPvbv",{get:function(){return this._iXMPvbv},set:function(t){this._iXMPvbv=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"oMBTNnii",{get:function(){return this._oMBTNnii},set:function(t){this._oMBTNnii=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HUWGWl",{get:function(){return this._HUWGWl},set:function(t){this._HUWGWl=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"OBxSRpDp",{get:function(){return this._OBxSRpDp},set:function(t){this._OBxSRpDp=t},enumerable:!0,configurable:!0}),t.prototype.ziydS=function(){var t={CUkla:"sCAxAJzfJVJQXvkQkCFkinMBKQwIvigUDtEWQmdknjqvPBqASD",qoxviJRTi:[592,414],dtsMESOsu:"zhRmyvdyRaRYjParfjVDZrNcdVkaFRcgwiqhLB",fkAPd:"NdzovlekQIIgOQscwBTKLigITmVoAcaRHAdKXUqaXqGWtYK",sUwHhO:{},goqzi:{},mAsbhaln:"RDZodvetBUpswYmUrllVyWBhxXMENXEhbqcOJGj",vHvwQSB:"BQWurKLIxHpCmdIYJjGATygXtZeVpdNZNkoahsIqietkmRAkHLdLfzFVaVNA",twprr:[476,799],rJisigiTxq:95589,jcjgUrr:"lAHQOacQSYmXFMBmzXCRJaIvSnKGuvRmjZgeYqxTP",gmZv:91275,EYMjmos:[677,383],GPWkpM:92580,wpAgDbHrC:47574,xgaBWKEbk:"WzgcbFKwNFQyPCnLrUXgOxagYFXbxvopvwuBZXQOVyipsdAX",wyZsSMj:"yTcOUTHdOggVzEIofBNZfgJMJgFogwkGjXUrbQCrUpqqfmc",kBKMpJv:"voizaJyIjvpyKAfrUTZSzsPiisIECHpHTtmPgI",CQlSsJ:"DllIKhweaGyIaYlbiqqOHgPovURHzPXHOYZQuQsaiUeGCwpLmkuXolD",LphFuPMU:[424,496],kCxnXSuIX:{},EPNSboe:11858,iPthQb:[747,635],uBtTiUgvz:"IBrDfkoBHTmNZJWjEkYluAHwEGLrxZRMoiuCpwcPnbqHvXis"};return t},t}();t.aqRw=e}(RUZJlpAvq||(RUZJlpAvq={})),function(t){var e=function(){function t(){}return t.prototype.bCPzLgpM=function(){var t={exovVHK:{},JRqp:"NjlSWoEpWwyvcIMvqyELePlcrQFHtBrDIkTZpcEaUSlmIlXLZRYXBtkKBrd",xgmzAzcrSk:[390,670],KjkZOMhZWU:[404,321],ogGZUX:"jiLrbTrkKAmgzfXgtwHrXBpLAXRwBuxITeldZAKPHWfCPnCIAi",wpGQHnHs:7317,VeVlz:{},maCawASU:72068,rnWIuLnuW:"vOmTGzTUwHymwAZSkBPXiVjSBWQWUZokmaMP",MFIdKO:"azKhnaPjjwkKEIbHhtFdSDesPnXdknLOxuYhlyQoccCaghcpdBPINdROL",mXJvwrX:"SFGNpZcePkwMKqoftbHUsiMlm",dSjCEZOna:{},HZfua:44416,LKmbQY:69013,CxJJAvWcBD:{},TBXYFW:51e3,RKKWu:"MhuSfFKtoNjhhIpiBbMwtrnMaoQfAdgfCbuWpYwWbvdOIgTb",vNzktmye:[630,510],itJed:{},zqzSUmeQM:"oPnUlACTyAbdBojXWjVh",dwWw:"mwfbSrNIiOBMUlEBUNTLvfRosRrumyyZHTMk",BpgVY:"rfbGtvQRyHHTJzdCRcwffGFoLltzLIOsOXKEZgKKZttVMnNbphLXoCJ",izXmYNi:30733,SGYkWSgke:{}};return t},Object.defineProperty(t.prototype,"tvWnSbtsrj",{get:function(){return this._tvWnSbtsrj},set:function(t){this._tvWnSbtsrj=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"azEfSAD",{get:function(){return this._azEfSAD},set:function(t){this._azEfSAD=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bVZGeVv",{get:function(){return this._bVZGeVv},set:function(t){this._bVZGeVv=t},enumerable:!0,configurable:!0}),t.prototype.lFxPXhe=function(){var t={QFPWlK:60517,kMJB:{},FiYxXqzut:{},TcbA:28965,LqKbkHZFv:"KxysMLpGZwlZHLigsIoRVAGYtHPPSVPzOqRJqukeKZngVtyHbDxnyD",kitljm:"tbbbTCIZBeMFZjnZXQMmJgn",PYwbTMkxo:{},qOZcQ:22140,ImCPVhJaEg:56940,jJKMgueUpE:55759,bPTJzUu:"xdplQQdNqUimAcAhLVyxDcqcLxqhwInnvuMqIQQNsmSMK",rqihs:{},PLAegbDUHr:53106,KUHObzy:56916,LWFFNqJ:{},hbxLCKY:"XesUpfTVtCNUnGXkvtJfkIDgAHPqWFN",dyzQji:"jAYodsjOrUpNUHTvJmqtIBSPMLqouWkEkIckGuL",DHqwu:18780,SFCJaxm:"gTUasgNHsKEKPrhhePMKLdPinpZftgSMs",eIUrQBf:73343,jphZUe:"xrzdpZYwKJMaKsjqZtofKcRahllsXBjYoAlFcDanugXWyoHxaCH",lIaSfwlr:40706};return t},Object.defineProperty(t.prototype,"LykpWophgs",{get:function(){return this._LykpWophgs},set:function(t){this._LykpWophgs=t},enumerable:!0,configurable:!0}),t.prototype.FYWTNC=function(){var t={BpMULI:"QXpMHhedUXzOJFqGhkdaBGJpjkLrGggVKTWuWLROckU",gTnq:3701,uWXPqt:"TPxrPEcJgKOoShqnQLWKEVQ",PUQwN:68367,toaZ:"xmbbptaGaWsYbRQmETzLotJHdRzGZUobnUrYlDBZWSBzQZgIUCEYyHEMEh",pMZSeD:{},hAgCRIjJF:30422,RbpdVirsg:"MBJOxZowSSuNrAatkKGFpKTHWY",aFuUTdi:30790,FIAm:"aSDEagBuHuRhabUItrVioQbAKcRoqWbJNPFrdLj",XOLaxa:63040,ubRMrnTnAY:[665,764],UiGalcIqXY:{},EFAAg:49858,eQfq:{},zFygdu:47607};return t},Object.defineProperty(t.prototype,"EwdBBk",{get:function(){return this._EwdBBk},set:function(t){this._EwdBBk=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"WfESBh",{get:function(){return this._WfESBh},set:function(t){this._WfESBh=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HLlDbsisF",{get:function(){return this._HLlDbsisF},set:function(t){this._HLlDbsisF=t},enumerable:!0,configurable:!0}),t.prototype.BURtRZl=function(){var t={JCsmUr:83987,vvolqVRN:"WoymmNmhJaioNPliWUsLtjYJdZEzMozKAEBAatwvKig",ARmUqad:90840,DJUgZrni:{},MgKwoO:"rQoNpVJGiNgbUvzGFqANtfiIXsjCFYWBDfFNxKnATvbzXTtXCJ",ltsTsxxPSm:"UzxyTinjQMIFjVvEyDIWEYiIfzwlYAXtRffdQJzWePRnCseFPfyZOwbcr",zqik:"eEwcjeDITZTvaATRXJgJuCItVUqSwZMdVCo",rDiXISCtU:{},msDO:97629,cFdXxS:41017,oBPIu:"btBralxASNAHxevAogtFgX",RPOVHQR:47692,aoTCyQjdCy:79670,AwGikpae:3924,ncNfC:{},AspJs:58257,IXowglcke:29739,HCZbAELfj:{},kJpx:{},svjYR:{},piqRew:{},JPBjfzy:{}};return t},t.prototype.dsgKYKMJj=function(){var t={KbGybogC:"jbffFjDSKESmIbejGeobQGmSIHooCQIUDYahXppWQtXfreX",fozDrJ:49807,Jkzl:"qcbfhYAiHlSYCYkMerDMWAxVwNIOGmZGddPZCqNeAJyrSBAvbQbwUnVF",mjDri:84292,IOKK:{},IHTPSAWFc:"ceaTGiBmRvWLzNVGvHkCaGmobfLzkDOVlZIBxEDVXvwFzpwwFyQGFHdQ",PVfE:55024,HuHKuBoKF:5674,uoaquME:{},lTOUuqeID:{},odnOowlLMO:{},QAwutqrA:"qvzkHPMNiUyFSuQnVfDzXRSIrWcQxP",jgxETGNjzG:{},hcqOA:[323,358],gijMm:{},UhkA:{},ongwwvJe:77386,xCyHFZ:"gttlnMpjYyqivevsJPANkIUYNjoixbogQXfNyWJQpRWaqJerUPyqkuFzLNa",jvuXnZK:48912};return t},Object.defineProperty(t.prototype,"GUtAVtfd",{get:function(){return this._GUtAVtfd},set:function(t){this._GUtAVtfd=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ihhVfxVs",{get:function(){return this._ihhVfxVs},set:function(t){this._ihhVfxVs=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lBnTmO",{get:function(){return this._lBnTmO},set:function(t){this._lBnTmO=t},enumerable:!0,configurable:!0}),t.prototype.UezG=function(){var t={scVRcg:"CGicQguYmFytKPIDGbkqtyGfThwEFlheUfHBCUKHJGFyfRlmHvlalQSDRym",KLPospHB:5305,bQoCoac:1426,hyFSYx:{},mcFTSLLOrv:"IZkCNQcenPDqgyEMqnUYazNZes",pVamduFly:{},GqED:{},fgaC:[306,594],djSRPd:73053,cRbXklPyug:"JGkpmhWvMvTQoGfemMgopHXqqHTFFsBfrvSibrTC",Shyc:{},koxk:38516,VnDlZKw:{},gGhPMK:95378,sDVgiOWx:25415,vEcoYfxbEi:42299,GLRgGpK:{},gLlK:{},zJNg:{},koDxFdEeJ:[668,515],fdUvSfgu:50360,isXwgbcihD:[650,776],YNTtdSR:{},eQgprldcB:"LqVzIdvEPabJcSxpMPrHvKdmscINbnioLJFJgmgciQCocfzaUknsp",VZcW:"xITxKgPhRZRMPXUyirvSElgDfMHgJtNoLpN",lRqlTvWT:{},kWaygFFP:"LTNnvlBvPxszSWlAFUCIHmLDWuPAwFBmfFL",JWYnjleH:{},IvfVywGwv:{},YRqgMwV:{}};return t},Object.defineProperty(t.prototype,"UurRsCIU",{get:function(){return this._UurRsCIU},set:function(t){this._UurRsCIU=t},enumerable:!0,configurable:!0}),t.prototype.JSyBRxUreI=function(){var t={LnzFgpko:61469,EHVczePUa:"SiLYfIgCxmbFyAvFzyfzNodAs",mRfDfvdM:92426,NelI:{},SkcvYpWynp:"JMvQAvuKmXVCIUSZwcHblLUhAO",fqyWdZ:55574,DSOQZPeI:{},eZAydqko:{},zLvq:{},vdHefiX:{},uiSDXPZVw:91338,QEmJ:{},tYrUnRdWT:{},sCUsoEkas:[437,345],dyFjKnefHi:19817,yYENlDJZDQ:{},gONpCxm:86398,nrNzWDXXG:{},gccyhZPGg:"BFxaNkrVeAtLctLnEZdgAirFIyWyBiDHcyKyrEXG",HEWJqm:{},IuRnpbaXB:"uCxCNJxRUZnzMQeEgnkMJFNOnJ",dDyAjpfvPl:59043,ZKqZA:[764,674],sLATi:41214,lwWULQn:[636,538]};return t},t.prototype.JFVCiHmREU=function(){var t={nfEbJxR:2226,RXIYuo:{},pfZYJG:"zprrzSxJwnGLwCFxPtnmHuuKvcYTC",UdNEU:[622,545],MAcImBl:{},tGlkLTT:{},zfgwrYiN:"rzdrbulJTHlloLwoKScVHhAuCYyTwK",XtRqYRPmJ:"CASMHRcqqnDBxOMfJspWcybi",fxdECnimV:[385,743],UguMSzM:"UAudRRxWdnounsTVIZCPchlHRPHFGNtwsrHBDkzvKJKAvpZoCfMbCYl",cVvwvdU:"ETZdIbGlGlKDhOaGTYOFlynflNGgySIAFlSXpjGeYyzNTnee",otRSBlLNBR:[763,687],GvpytkrR:"bsnzSuWQHcxilgnHqmPSxNzSsgfwYqSkBrycgpRsxGkByeWR",nWfaiyL:"YcNiGZpEokqYdxczursmiJppTolIBvcRNlqV",QiuGnCnnvo:69590,Xwzsugu:73032,pNEWYq:"amIwbcWdvbeeOowFaCyXqFmJKsgbMLMcCcUooAHbGH",caTyYnnvM:{},dKbuEhp:88356,bWqlJGphn:"OasIEIjdAmTtIyRiaKun",pCiCcOwAK:"VnWxTkWSaWurdjnkGGqQotfZkQaJyKqynDaaoWWy",WjlA:"TeseZgVxjztiyjygMCDKRolXzhlJDbmLCQZhwgdIv",iXQmDl:{},gZhaMkytk:"aGEPaxHyzxyYJbbXrLUN",WuKqJQH:37419,rDnFz:55308,DjIPzq:34355,ZTUXLPci:27621,lDAzGno:85163,FxDB:{}};return t},t.prototype.knhl=function(){var t={AaYARE:21678,rXruYlq:"WzlWsgRpOQredsloQFWvDjwYePwplBhkPVdXEl",ATiWeBxGe:"RaTtLjunUnIlGGhBjKJsdEqrnQcwDDjMbIpTsQNTaNMNmIPEnSjeWQWqDIpC",jeWQszY:52154,AlgkIRnq:{},zaOn:[520,633],wZtcyQFS:74059,KwLAEp:90205,bVnkZaPTsh:{},gWINTNLz:"UWgEATTynXoCcxyFZgccuLGHwmyhlHJhKIBS",KjbbLF:73449,UjMxAzESZ:50810,kfyyV:"hZIhZRdfWTaRyiQJtbfHitlADPABeeaijWLRTCzUDeRv",oBnMycEy:91571,SQSsOmU:[786,492],dcDsJiQv:{},uOTGC:{},VsEu:"TNfXWcGllwfNbphhtFdPAOvvHuEtggwUsHcwxkTeVCkFumYPVImPqv"};return t},t.prototype.dgYnND=function(){var t={NbbkO:"ZatzDyBKxCsxlSTagkyaUvTEvyVBDZgEExGEdrVDryRwjlwIqEgg",wkyLLc:"JSajehFBzRZXFXAjLJxauyyxnXGlkkzwpOKQIfkXahbKfuGyWLgQR",ysOGoUCNa:"IVuWjXkbyZwdxwpFsuPBSmIg",tLBE:{},ZETxLwnje:19010,pPpecrt:"MdSShQuXZrxOXjAkxqIXgspsTENmaTjQxTmFQagev",vgxnjre:"wiQsBzXzrlYKVsdXzyNVcIcfpfVPTDZNYCqOEBbcQjPMQkGI",KUqGh:11798,WaieCZo:81193,ueVAVZ:86320,yeNQ:{},dVyuJdn:[308,576],xCkkkyZ:3432,xMkobEd:{},zCRSJG:{},MlFCvb:[661,484],XOIwxZo:"dFXNBmkwiMutOPliZiKvsxorwqOEEtgRgCVkrGJg",jmlKp:{},SWfW:"JJKyxOvRQuiFgHNWODGRAMFGjfQckoyOuWWJYmLyjs",BUey:{},jtLwnHS:25031,YyIhzeam:19110,DGCMJaadx:{}};return t},t.prototype.vVTUOR=function(){var t={HnaMOBJ:{},KamAUnY:{},KqPLCgvZN:{},BxZP:16575,XFZzwl:{},FOtOiRX:4178,fOiTmlVG:[475,435],EvUoUYPdeU:{},Ubxjg:94308,TFpNvr:{},eohDm:"FgEQiffCgJMWptaSXztKPBZgRzEV",JNAQXGpqGJ:82652,yMEnAanyl:76506,AADNZoM:"KJbnzkdzRVAJJHNrTDeshXjbWLdZCkifI",vIbizxHSzz:"PRshKHMHRmTAitTfURGwpGRVHTcBHeUkflkAWdrkrXwfFJW",TVsmXNa:[718,560],luzFzcCb:"vnwVWDKhRhvIrYxwjMWUlBSPKy",FrqexoqKl:"goLJCYlbiSsUMrxBhpPEikBUUAQbN",OMXkUACyZ:{},gvooAa:73494,gROOHt:[764,406],GUjvP:25264,KAWmAPeN:"wzhhWQasyuOcDdwFfTJmyqIjYmMMbPXGOuybpnbMAFbmRMLzPSqFVss",MjwhYLg:"NSrhPtUsWjaXDJhxzgbycySSjVFOjBLAPOmLinxOFwmHDBTwEMsRs",ZrRjmkwCZ:{},LZbJoAvHW:"PYueTZfPKOhSblJnNqLV"};return t},t.prototype.ZblJEgWJsX=function(){var t={FOgy:58487,WLaTNxHAi:72757,dOrUlp:{},NyTPPvxEY:{},EJJiZmMV:[717,571],xLfiOdfsb:68602,MWDeM:"WZqFiZiDsaShoFjNLdccsb",iMbb:{},rmNIABoIQ:{},zAbvMHdKdW:{},TskjTJF:{},AgJZno:"oNdXMmMdWvVGtbIrOWFoUCVphsUFowjqxITkbsWnvdsPsvNUXtIK",uHFX:60224,bGjWm:"hxOXhPxbrtblrKKlmfdnJenyRUVDDCtmGXVCsjZx",igph:"HZrDZDtTlQJKeqbpeNGlBOPKuihGJMSzrqwgdkhFIEUmpXrDUUPTlJAZ"};return t},t.prototype.PmQvAGn=function(){var t={NaCj:67902,YZvDNFjfMl:"krCqQqXuDrzohXziyTgqsMDdGzlZSMRGdOWhkihnTleFZo",GETygeGFsU:"yBJFrQmAGvXqaFZGAcxHBRxDGkhRjnWKpWjCELzelnAspmWycHuPqiAs",HZbLgrhet:[345,732],HFbesGsB:86694,DpnelqnJTf:80833,ljUtOLV:"KJDbZQZtuCnAEJLMejnLmNsfpKatCfhkwucQSFscX",qQyQH:92701,CrRs:"lMvXxBmzFXlMaXOWqnbJWGmxhP",xIwpHAFVOb:30119,WGobPQB:[477,568],qnNVIX:31349,FaJPSNvcE:"DeAmOOjpOjevoxsSSRPVJOLlFKicXbVnLLLIbyeIslcjndBZGUSlBv",PJuDgP:{},HgpwRAkFw:{}};return t},t.prototype.yOgU=function(){var t={bNtKuE:95438,MLNJYnkoI:11124,tFVG:59980,ZaBEUUd:[658,363],ACqbhR:"nEjnezZWBkntaPQohDielfKH",IvdTd:16127,PtFKqQkn:"OWWDbuhibeJfgnYkSDuaZuFkhPwcxZqynwqCWviOLLxKJVoKGJctJe",uUeQXvC:47154,sMGlR:"QFbzYZPxgwdNeXGDNZlXfrHkmAnXrrydrzz",EFBMjaZUf:74506,lZRQgdGmck:4329,RtSLQcwe:20264,FZfaG:{},sukxozTV:{},psTLF:"bJlsvlOtsuRTnYluizWiYFXyQujRcLTLjMIhyqjdCKjN",dMhW:93414,PnVCm:"sIylMAvLgWNJlnHTnzLUnvYgjQwJqMDWfPFIcCDlPZOJEbXnxcqbSD",XXUaOtZk:"XCDUMHpxeblzTvmEgjqWUThieTAbVCdyviqPYywUzTCCfH",oPiZ:"jbhKCvNggRGKstTHroBRWyDNZiQkMvGoaTWnkwWppHZlTYnB",TlMRFc:{},DYJQ:46486,soFf:26195,BvFysA:25923,jeGxn:{},UOjsXlUG:{},yJMUZdxTV:38881,ZMwzS:"TxFvDXvdCsKaiGOaiiIQzYmCE",zYpEOCsRPO:[463,594]};return t},Object.defineProperty(t.prototype,"RYKAz",{get:function(){return this._RYKAz},set:function(t){this._RYKAz=t},enumerable:!0,configurable:!0}),t.prototype.LDmYR=function(){var t={hNcNZDFmWg:{},TVnae:92701,PAJDLPeL:"IKQxmdulowtvloKRRYVfKrwYa",TtoRg:{},oPEtNfzHDN:{},leOwgQC:"TeAnLYcSIURwjrZvqENOMvKvnAgAWrRYKNkakYfKxhdgMkNggUsaoPkxf",GsTl:19366,yhONzcwx:80534,eknIARK:{},IvbEWGrGcb:34494,ItlH:48665,QMrWPCW:{},OVXccOjIZ:{},mHQQ:1486,otxkqeRU:{},uSEADeyYJd:{},cnfqvcz:23058,wsrlpPBzMp:{},rRTLxYOuS:29421,XPTX:62128,NoYNo:"nZYoRzVtRoPkybFDwgtMrGKaJ",ZTshZK:"fUPZgqfccJTqqcCzBqPO",HkFSuyRjcn:{},znbUnBcCVm:"GJqUyzllMcisnUcIVzvPiRnnYFvXbYGNLjzQAHkICgEKHTWTZdNqQ"};return t},t.prototype.KinAsPzDTP=function(){var t={pORprm:[486,442],BjRYwVhia:{},HaztK:{},afZpVQDm:56185,NVHkiV:{},xzUXUZGkGQ:{},CCbrgGSZeZ:93489,gOvMfyI:61270,YPRoolfnXv:{},WGtswS:{},GETPikekV:{},xVNDI:"EAJGZBmtMFGiFxLORDjvSrCGTFBhKyITAwPAIPRbncs",cmADXeidPY:{},Fufb:{},RmLVpv:10496,vfTDFXtL:70053,Rqjxj:22351,tidaECz:40365,jOQMCdkU:[634,500],xMIMeYc:13668};return t},t.prototype.IHZCRiCqBS=function(){var t={JtayjRd:{},uOJBa:[748,355],SsRcl:19137,uePjef:36210,TTes:"gdjqWdXocLyDciNxCLtkiMYalUriUmxzBIhiRdUswRYHEkvKWxSvPL",kEYU:[515,489],SwlJQih:35431,TZsPcxvF:38724,IrNBA:17877,cDyk:"IHQtPbzXoDmBafZlIlSPQrpNDTfSmeDRLmeCMaDntwcXUvPOWiBWwyEnyKS",pJdiPWO:[655,747],cplAcv:22874,MKovMkjavI:"SvSIRMuETvZSSooRbAWfbdQzXNTmonuTSUB",YkmKDUrCS:{},Dcha:{},JGFczsudM:{}};return t},Object.defineProperty(t.prototype,"sWHTf",{get:function(){return this._sWHTf},set:function(t){this._sWHTf=t},enumerable:!0,configurable:!0}),t}();t.RaFr=e}(fIpZIu||(fIpZIu={})),function(t){var e=function(){function t(){}return Object.defineProperty(t.prototype,"Zekx",{get:function(){return this._Zekx},set:function(t){this._Zekx=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"UEKt",{get:function(){return this._UEKt},set:function(t){this._UEKt=t},enumerable:!0,configurable:!0}),t.prototype.oDKR=function(){var t={aWxTDjUvF:"aaGtRSvwbZVOJFTWkDsMZebvOTXSRyq",syVCWzel:"EVjpABMdwsnBGGWAXgercPmKjtPxXLlWnuyVNNKLsGrenYv",nnOK:{},LBeZPs:48103,ROZjmPskXe:18629,sVPVmlEpd:"AuvZfWSerqRiFEvzRQgNtX",jQeoffX:"zLdvIwISQZWQCtZkUXNeppvtIekNrHaSWrSyPRBnAinFbXXxKjzniHEbtim",kPgbchPk:36570,WXas:[731,789],ZYZnQ:"KqJsAKLzeNTpRJOKJffjvjdlgsAWixYJkEYqLZIsRxMvsmjClmunJzXtrx",RdfUhcuzKR:"sjTXHJIzTCumfJNVWMXsCGkBWtdgGraYvKztNk",KlVF:"HoiEkwsVvrEUXOdInslmMdpRQorRqvXs",fSReb:"xRUWvTfslzpCftpQwdHArEJHvLwMYvikugan",phwoTWEyYS:"BXrJJBpOjctFVFSrBjKTMfevngQmKuIQippplZL",JstAGl:{},duQZNkM:{},ZlAsZQE:"xtzQLMbdFrxTMwSbKQsNIixcEDcSTgUALZiZYGigyXuQGn"};return t},Object.defineProperty(t.prototype,"uTbSBRtjLX",{get:function(){return this._uTbSBRtjLX},set:function(t){this._uTbSBRtjLX=t},enumerable:!0,configurable:!0}),t.prototype.NMmVtErl=function(){var t={wCxQcQFYI:"SsxjlEpcmgJcUZvgOeOlNenIrmQYTqSUMidvAGC",lRPUsMTE:{},wgpvx:[356,671],fhQtqDT:13481,iDWgSMpw:"JdbwxKpZnLfKIAkiiEYznAWXrTMhPmPSgpqVGwiCG",DVmQVfTBMp:"MxSkgQWMQlvdbcjuEhzX",goEPJA:"GmVUkBZaPsJTnsyYbscYJcKHomVqeAPXaIAjzZgDZoMlgQC",iXZrqOU:94885,fZhwRy:[439,773],opNbRF:"WQHHWenAaQcBKxerQLEnScqffSsfKCVUrVWzyqv",FkHOGQNHQ:42785,oCDhHtD:54239,SZRZrk:{},qCCONd:{},oaGTwtmDkF:98807,yIGtSZJ:[755,454],EGVG:{},bhWZGGluEH:"DjMVLHAIrUCKcFiGEhyNMZpXvnrRLppkkOdTCUeMWJdmsOxbCQwddvqwKf",dnbeeEvs:{},ywveoRNb:64394,tZwYSl:18602,mPrzEX:{}};return t},t.prototype.UcvU=function(){var t={uWGZWCpOeA:96260,XmGYVnEsv:{},jyoIwZtNJ:67850,eJOeERHQVq:"VkYyeeehgSwkjrKbVkUtLlGshGFfSWaUbyb",BqbyvUeZK:{},pqeeY:20070,HrTtEQy:{},OHACCn:{},HMVcPY:"mRAkqrBUwyOSVkuDdIUAFNtFGztJqhJfaNsQWvBjxQNGX",RwKUnquc:[484,451],aSWbe:"imAhYPETJEbvTVHICOXgTgKsKMyzMLfuUyAPApRDNFlZfwJGpycL",gOPajoYQy:"OmyFVaxQZPBXttziQVZCsZYyLRIEscJkgS",ApaBi:[720,693],IVutMx:35325,NFWsqOG:{},GoZXnajVl:"gfzjpSuAyFHKaOlwNAKddDZLgqyLcXrNxyYHacoVM",NLkHzM:{},OnzAbKWaZ:68349,rVedYCAQi:{},fuzb:"dTHFGjxLeFjiBEiMGKnXCRYc",qesAjRu:"CuZucVPTkvAAwNquzsPUDHkkmldHLwHVvHdbPXWggBFDvBwWNAHgzCLcC",ttpeep:{},uLYa:78244,StaFrFxxu:72026,WOqoAdJto:14170,VrtPs:"XHTQrMwgWdUYuIAAAYMKtkOhPvSsirbTTMdfsrrBlJOjpQaXXPUOKsLAmg",lGycMWMLAE:"rBjPdIxRsLtEHMNovDhuULYspvtPIDjPQXHuOOFXOCz",tJTlgB:"ybOBgdlBxpFxQldfvIqiqdGXQrwIdjbIaLrRJReInZrAYHntOknVydskslz",dXZfuXApd:66766,NXmnPL:"nTlLJWWfHHOTOaBKcElRTSWuYwPxfBXsh"};return t},Object.defineProperty(t.prototype,"jCTCVz",{get:function(){return this._jCTCVz},set:function(t){this._jCTCVz=t},enumerable:!0,configurable:!0}),t.prototype.JmkR=function(){var t={vwTHCufS:54665,TaGLq:{},XTOeWhZ:"JodyFNTnHcndnzRMVLaZLgDINbfLZUPDexeoyhQxnwkdc",gbUOHg:"OMuJXkdqeRyaGVxeGMBBIzoLFYRkXEyWqhdFVFvmfwPWdVXgvkkbENBYw",YZTX:{},NdPYog:92598,KCQctZbzTy:"ElSezqsTuAfivZCSTiJDaPAcrNZTyoIIkPhpVYVKkxXOzFIQPydbVCWD",SBidUTqF:81365,cZlCv:"pclVXTIomWxAizHmpxbahgNTdcRjsZUVPotAPZvSgSCNdgRaxHfbRKoC",RMTbOg:"ORxIqibIpTfkiPIkFSfWOUNAfQyXiYlPfDxjHBGk",DSEkoA:97085,xFxeVR:{},yGGPurGPo:"VCCfABvVlLGtbBXYLrKFeJJqikm",GVTSdp:"onUcclCIVdAhvmIbtXzuuUjWNaohimwbhfg",yUGyixMndc:{},eAHPVubfud:"CCECicNhUnbvyWbpPWOWDsdyYuVQxiFFCerZlqQmsrEPO",LqnL:82643,idGfekoFFt:"ioSbglMQHOjzICJFRFdmphEidojGgRhjRieegIhQhjdyyHkB",gxSLdfXVa:60254,yswBF:52048,hOMVFqcEZ:{},WmbUBgxiC:{},GfrxJANhqs:{},OIQgTceM:[645,715],ZqQib:5945};return t},Object.defineProperty(t.prototype,"OeULnILs",{get:function(){return this._OeULnILs},set:function(t){this._OeULnILs=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hqJduewal",{get:function(){return this._hqJduewal},set:function(t){this._hqJduewal=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dbSZDHEh",{get:function(){return this._dbSZDHEh},set:function(t){this._dbSZDHEh=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"crsm",{get:function(){return this._crsm},set:function(t){this._crsm=t},enumerable:!0,configurable:!0}),t.prototype.eZitec=function(){var t={dHiUaNzW:[314,586],qXFnrgiQfk:[329,380],EAKDrpE:57970,urEIueWZIs:"AeyarMUYvrOqFbdnJHWfNvoLCpvctMlpVlt",cGKtF:61856,bkuisMW:"pfjpBuMDUYREtvQBWbGctjfTMEaVgmPUpnS",Havkv:46359,zSqHGYDP:{},saKzPZO:50586,gNgYEBTRQ:73083,GpNlyDVBf:"TNkJrnHCvQoUTGUQfHzkamVukMYfJXgr",ZQRAz:{},iOVcNzyF:30654,xMeJu:{},AZTU:{},OnZvoDoyn:{},PPxXFqIhH:"UiSdvTqKpBdoixoJZzcgLQfEnS",fBffplO:97336,rxYA:{},NAskWS:{},Duct:{},ggkg:49773,afAgXCEMAz:{},pCwWLjIWGV:78262,MJjv:53544,MsweORYAZR:{},myZYso:{}};return t},t.prototype.JLct=function(){var t={fLaEYXMC:"uhkJgqqoNCkaimlbtluIKvmoJofhombUxiiFvTTPyvjjpaaowBrPJivR",rjXjeEX:"lGZJAozrozEzJiHYOCxVZmwMcJizJmLVFqsRQhyAnwtdmrUXJ",OBkFXe:55559,hrZuLlkE:27013,YWxcwn:{},awinWeDQ:"RFeKmnlchXSRlwdZucJPszBKnLaKwovNhTiVxQNiEMgrVIJcansmi",LIdpHF:19218,pQDcUjtQ:{},SsWufvdTOj:{},FEaf:36522,oSiG:"KNbMsbUSNslgoHZfrJZofffWXFApobCyD",bKpuo:"sOqyuWTnTfzPtDhvniXNlbESYojvuONhO",rDMRaBZoEF:{},iunNZYrQ:{},XTxeEmEPa:[677,303],XApMSZMPm:[488,420],pNKsshPxg:"TLGhbcbKNPORxDPGQtzRcFPbMqYCgvQnfBcMhQEFtAjnKQnwyc",ajhAL:"cUbCjuDRNqfIxRaBIurndDMBnFtQsNmROyQlyWaFSPtwiTrEXZqsis",OHUJhxw:"JyaVCRAyVqxMQPqfvPaXkweYBoFX",VCMaWHHucb:"sJqTGNXcFSFMsWcgeHIJSOFZJOcwxqynCyANXUUAwI",mTDsezyri:{},SpWcRkqK:"CpmVzzgLiqnCBTKdHpgVrZTxzeEYpLXiEoVutMFMI",dBjDwwtpK:{},fKbtT:{},kFlHzCVx:"eSYyXfvCVmvsSGTjBjJQvjOeKXXRQOgIYmIXooRmZCNZkMZWOXCBeLJx",YaGMG:34307,qMfU:14484,WBxjIaq:"PRWRyCDcqpIScOCxOsorTDHNAHrxGaBOFq",crSNoBZe:[552,515],KUfEQKudY:{}};return t},Object.defineProperty(t.prototype,"JeFKv",{get:function(){return this._JeFKv},set:function(t){this._JeFKv=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EEsQrcFaUj",{get:function(){return this._EEsQrcFaUj},set:function(t){this._EEsQrcFaUj=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ccNSLeu",{get:function(){return this._ccNSLeu},set:function(t){this._ccNSLeu=t},enumerable:!0,configurable:!0}),t.prototype.rerV=function(){var t={BlSG:{},CzjNWs:{},PucbNlxZ:18297,OYpgEmyUl:10411,CIrBv:[779,507],OToZQseTo:[584,489],hFqx:{},uAsrJK:"eqOapRsTwvBdPtpAiauBFUXRfwkehloCWmZVEtnWylDVXkyx",ahHE:89894,KlKYc:94224,VcDcRhdT:27902,dUYqcTQ:8468,AAuaSHthP:45057,sARqcJ:{},juooYvCuB:"ILHHVfngmppdNAHyqAbTRJTxfVuhJJXQQCwA",xjRPr:"iBatcrFDSWDPulfyaeawqVNxbjcBklwWmtzh",RjbICCufe:[317,485],qkHRnqxO:[440,337],KKlIIwq:96502,AiIq:{},CMMfmoKVh:[778,612]};return t},t.prototype.FtiA=function(){var t={pJlfgAJY:{},wHaqmVbjw:"mrRHcEojqZcgyczmCIdMnWPjS",dHshnl:[667,397],kQaJpqnel:"EucOxiBXsTNSqilyPaEKljHICMY",QEcdXGYt:12417,DPaPuTczb:75476,PDeHCLoU:{},ZoFDQLmq:33709,mAbclr:78609,kSrdCyO:{},KGMAiVkpdf:92798,jsxX:{},BAMYDQr:65028,wcumq:{},UzPycslS:"egXBJYmkwpgIGPKfntinhCEbkAT",FDDiR:{},DMQdvUjUi:"VNYsFiCjvTxalTPWtfmEfanNlLacfOqJaqAmNDFChdPhLOmMpbhp"};return t},t.prototype.GjegANxixZ=function(){var t={EQYfX:92112,VUGlNXJcB:10752,UgtkJNyV:{},hopALZcmz:"EDGlBvpXjEqpUySpFrEK",ssAkwZQQVK:[370,460],cZqkng:"xivijfEGtsvCHzjNMLfDlveGBPBkQJMDFRN",NLcMmBtGob:96904,GMbMx:{},fIefys:{},yIwjbOP:"iUJGLbubaeiXCGUfpGMOdPtgTftlmQHoXharbpgNkXnZT",SbRytan:96828,BISqwvFSI:{},zRgBExkBY:"WuWMMLilodWOZZjDPNRRuFjCzsMAgvnhADLO",yAaf:{},XFCAh:8281,vFWnVC:{},fgXazyDNeB:35165,Rvqo:"UuPuxVFAMAtBLgliiEtQpR",iScCgAfH:29606,rqbVraRAzI:{},fYXKnjpV:12819,NwUECvQ:"oNCDmFBjVYReoAmzoXzuoKGIHpyvwHGHWk",mfmLql:55511,UExuxZk:{},NMUX:"HyWoODrOAHwXrqHHgrSDizZwibNYrMQk",qobZNv:25279};return t},t.prototype.NltOlCO=function(){var t={NtxgAwRvM:{},FDPegZPe:{},LwZCRuDr:{},QQoUTu:{},GMqyUYDapy:"wzuecbJIVYmTPSbtFUpuNZGsu",BaMgBHeo:8562,jFaVdASY:40495,IiYJR:"nXQyOreCgKcMMFaBYTIjHfwlNRhCmscDeWIVWlRhkHojRu",FFCtjs:{},NQEA:77878,PBsgceQ:"JAvHwRpNZQHdhpvLqmcftOPeZytZXBOuJPJonzpwvOvPQpxVFlYtSvaykmk",tJeMftB:14227,LnNuyWDMwP:"XUYwjxSjmXBLalUShTBKmCtqNOvBnQeGCkVqwfidygDiANEJW",QKswPT:12450,wKMxJYzUz:52088,lBJKvrT:"pKqshQnNwxHQsEOUOATNiKncGiLYcTtYNPGGKtImoKcflJsDxqpTdw"};return t},Object.defineProperty(t.prototype,"BWhoj",{get:function(){return this._BWhoj},set:function(t){this._BWhoj=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"BxYBVmjYD",{get:function(){return this._BxYBVmjYD},set:function(t){this._BxYBVmjYD=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"oTWj",{get:function(){return this._oTWj},set:function(t){this._oTWj=t},enumerable:!0,configurable:!0}),t.prototype.wSCiBxpwu=function(){var t={juhoOivU:79374,REjheTWJmM:69624,bqxPEuK:"gKCZvXxkYNqTLhejduxZrKZQQidg",gKtJMazMw:69406,jxWVhD:{},yCzLBRH:72464,TrsiaqL:65261,iiKi:"vZPsYsURkoEzOymqzcTKKssCbwvaYazLJdQmITxOnRvT",eTiXQYPCMb:"HhkARdsIbshlWKpwfoxkkDOCqTjn",kgzSzTaf:"UyTBQKclCIklokNcsZjcHnnVSIFrZhzdsTxpgotptfHUVAqPStWGeVqwb",eQdHX:57732,PNlZTPZPi:{},ZZWYLJL:"zeUyyvzIIhWvulvzGGpgEFUVsdZHhbnUCBTPTLescWzTEUDSeSQescoEetL",XUYXbpfy:{},zWFn:"WtJHztDoJkutAijqFQJDyFTNaceJAdEHilwEll",unLaN:59285,YSBPSEfsa:"HooJABgTsnTrTNbiwZXXN",bwcJ:"BXsSVaKjZpcGVxMkQZOfYWdOGklfGWtahGikmXicjZTvpqzcPmThoB",RktluwDFQ:58097,ooRFPhnJ:96876,jxKU:84788,dBykhmoRe:{},eIZD:[450,394],NCHogN:49949,gKGBMDryq:94064,kDMUE:{}};return t},t.prototype.WWuTq=function(){var t={rAQkQTCp:{},kZcxCYOG:{},yagsbTH:"EImbDQgSJsmIuzLOKtergAMEKAOnntHTrQGRIACurMVNKKnMmkTciKqvq",NfwqF:[511,548],tyQaYw:12541,uTTVG:{},rIzEcnPaSj:{},GbHJhkIv:{},DOKZbsJm:"CvRqjLYrYBWdCiyilGurbfDmDVgpJCgLrPnzEyM",vyFaWRMjqS:4864,WWPirjqci:"WUdUhtWordGWeaFYkNdHybwbfcxLNVTIbEDVDpTHt",uaqDUQH:"WTkVfzAgtQvTHOThhcqoqzD",qWovt:20451,lOpqzoav:"jByIRrjfVwaGavatmGfRSSyOeMgSSYYQGYTftDZoCTuKbIxDUKnovs",zugwMVkIcl:{},DIfUBP:{},bpbxIjHWH:"BVFOWDnofSdjsSVpahwWteVVXlM",whFs:"EQvuxStcaYSFONqmTBLUSOXTxNgRedaDmOaYCLRDQLyemAXeeEcfZoGA",HBoKlus:{},eQHKJlYvA:{},kaBuTz:{},frjr:"eJOuZNWkZyvznuwZGprAMaNlbyZgZFCTJEPtNtG",bbiSdwFE:{},ICep:"imZpHLqZKpbQctqyMCQHsJIxRLb",iWLhbnumXN:"fhDKEpyWeYBLTgeVmDrerS",eogTD:"SAxHxrTMTBHGioSsWhaXuBtqrLIvNhX",uzejzzhbEQ:"uVFuilUOPHrdLoZSGCZkdfhzGetgxjWWKfVFllF",aDGxdK:8027,pcvZJhk:18406,SLcYgrpfR:42226};return t},Object.defineProperty(t.prototype,"fyJswEKt",{get:function(){return this._fyJswEKt},set:function(t){this._fyJswEKt=t},enumerable:!0,configurable:!0}),t.prototype.llQvv=function(){var t={aTvTzzOgT:"pwGdFYsvpukWIZcfFwfncx",zCnTZp:14741,JWrI:[545,380],Litdi:83957,OLqwcURFBC:32325,TVllrYJ:{},jkITWxQ:[729,408],gYNB:{},EQpOZkTLv:81347,AIhFACU:45483,WHdWV:74289,diRqnnG:"VJqPGsYhGAeJogPQAXbKNlq",Sefug:"tookTFLRofNCbxhdEvUllRLUJcF",jbvXHSeHQZ:"qFYhVSuTjdNyMhUgZbFJzEsjGtRuxSrZfJugOyQsJrWPHLOgp",WumsP:4528,hSFuyvLcgD:{},zkwgeUtMdd:"QAiceWUYTVTPiRBMPcdQlWbXROOJVygqIYtPi",Hydaba:{},SZyytmJ:"kcBfqXVEJOWFvtccsWsAABL",Mqvq:"vabcpGnafqugXQkSgHZkRvhGUzq",EVfyyMTiwb:1465,FLaCd:{},MSzimQD:"zjmZkdnufyJhFaHdzrrUVkTddPsiJUQMtQYwONL",bqCmXxJJOk:27165,ipIeZQWwHj:{},ZnagHm:"RcHuLFrYYnbygrMKOTIPDJi"};return t},t.prototype.JoIXXF=function(){var t={BHOH:{},DspVCUsZe:{},cKDX:{},rWEomMChIq:{},lkEUNMOh:{},YUcqgCfry:{},PMgq:"XCfYpBjOOVBbAhTgjxoPl",ONBtuk:{},KwKoL:{},MDuLpH:[650,746],BedSsETr:67068,SOXH:82697,SXMLuXPp:18980,MzNWUrX:36836,TgwzW:48495,UtISUJAKZ:93562,JvKr:13366,AsobOFMpM:[301,539],ysTAxKC:{},ToKvTCY:{},HbSmv:19811,KNJqw:"EipjfHesRUxeNlSISCQxQeBbUsRUKTvCHxztTzdXVpmwiEeaeUJZAM",prhYLVsSaZ:77942,NrGzkva:{}};return t},t.prototype.tnjSJooP=function(){var t={SEyxx:{},nEWV:"nGflJzojEzdivDBNrzyOBxyLssEXiFTveYTXbZJa",Ybhw:{},DURr:"UxqjWfgmHiRsHUWjQxPGmSIyiQIfetv",sQgVsZTWn:{},tvRmLzOs:"iLSlpWOpBeyEXbEwzfHXNvMoLwJSkrrAhkSjNBLkxbzjzodSIGaecywvLQah",HswbGPi:{},DrbbPaG:"czpVSqETGWMBnMpofJamALNhePzA",uKddKfBB:54958,GeQYHEHWj:"OYzDgRLutYetlQcmnicghuGOJGgQKizEFlyBCWKJZSWlbymXgSu",yQlSv:"BJjyGiaACdWQWfFRNsEEBry",aJFWfR:23977,fCpVd:"WqiAOBDzKfcQqtRBiWDSYiOcOhjnnNgyBMediy",VAbGUri:"cuwCknXmBcBtGethacmGXPqXaRiUugoHenHfaSXkeRlQedFQvfPBXCQTy",eAkzrfrFR:6365,AqiBUQLi:{},pwKrWpBI:71817,nXLwrx:54895,eGHpg:{},AFYdoHrcmm:69491};return t},t}();t.XikiJX=e}(NSshsfqrx||(NSshsfqrx={})),function(t){var e=function(){function t(){}return t.prototype.ppOVY=function(){var t={daTjkWd:"RsRCNnmXJmkDjOrXXKJBeJgZXdtIAfaspriAaTcGyhsaTduPTXhwBaXNTE",DhwSWVi:33346,hbhXntvBy:73482,mzorkdMh:34162,lDmX:14650,MPpEjOa:33663,ZOsp:9112,PpUQmiNo:{},jkaHTaFS:{},vwPbw:{},OzqExNba:"NVFjIczcmKlZUaIviFLS",KApejRf:{},hhOXi:[430,351],MbTGz:"GvKHEUPSlwVdEFkAUqmWjGIxgwTfSzrNwgMnJXfavLxOsgFsw",ZXrwUEz:"OBOaysNhwcJFWudUIRwYaPxbVlbfo",ArwgzWlUb:"vBmKPSMTuRweStgZFcSFGSKJIOqUkL"};return t},t.prototype.xqFetLXF=function(){var t={JEqbVanQ:58121,rekPb:{},PkPlLQ:69361,COqNgd:"lPdWbSMmHQtAOmAtBtMrFaZNqulytfVpbJpQAdaAouwhDdZfRigmRDIALGZt",PaBjySXn:22167,RxlT:"YYhdrSybLBnAMFzUjgKGIlmynyfCRPNtlvmwJKBqO",kzvxBcmZne:17859,rcDgBJwd:23219,CRIWa:25037,aaGE:{},YlFlehYI:"xXhNtpiwqsgXqDizZDlUCFDxhzZVbIX",BrqWTEm:{},ikvZxs:[477,482],peTtXiBNcC:{},cUzAptHu:"hYBguLIxUxcJTQjtuXyaHQpbcOutFlXFejIEf"};return t},t.prototype.YmqJiqMlsR=function(){var t={pnBnN:"XTDgUfuyTEYZNwGtWccGxkKB",gvQlaQLX:"dKwZbPQasidtDmkIGCjJt",iprJRFZ:{},XpbRi:5713,bKHDmnYIzQ:43664,WzaGR:8459,NXzqnHq:68856,oHonVwHQX:{},GavWBSHLox:{},UZXYZYR:89915,VvfTnaD:"jzLQMOhzcYIffUxdaCRkoJfRwAyJZq",Jnty:{},rKPugZWzWD:{},LZbNet:[631,409],wEfHlXui:{},BSnYcdeMv:97321,ZArbQVgBGX:41314,ImyN:74887,Bbfq:[684,799],DSxgcgadp:{},EGejS:{},FaprJHvV:"dZfOaVzuFZLItBEeAAzODZXIsvXwjRfo",PBehDkMSL:1516};return t},t.prototype.wuHVQkRRJ=function(){var t={MQSlMaFjk:[368,589],hgyZ:51178,KLjZqBaWeB:15445,WOJlx:"eYDhQugMaEBJUJzSymoCzqnCcOvx",bcwcy:{},LlnoxqvjN:"yesTGgiWKdcxWEzbHwgVPwmcmjyybLWdQOgeIbeZKewFzskfoEBQgsyLE",XYfNkDqy:24291,uluhKutoAB:"BhfCPwVYJfdNvaxHAUrdeumBfSyWXEeZHkGrc",fvRE:"udeIeqZYVEciKpZtmahpXvrNLZDUnIGrbF",CIXKDD:{},HYaoYsm:"sbmzGPxdAgzLLeIVRXcSSwFrD",svPBh:{},VxvHFlaqg:"rxONBtvKwQqedoqWsLXsiSXzKNSBpkcOqAZoFYZbDRWMIQlgikISoEYV",aUjRnJZURv:"TLUHLbsnviaSlsFLNbySgjRPTgVlrdRBJuAvPWAHFVGqzLWFJcSrYRYJ",yEXar:23660,uJWjw:"TrXDKljgTKKpYukiZRmLAGORmqLjxi",MdPzzi:67442};return t},Object.defineProperty(t.prototype,"NtfK",{get:function(){return this._NtfK},set:function(t){this._NtfK=t},enumerable:!0,configurable:!0}),t.prototype.KZZsx=function(){var t={abuEy:[531,366],RfuHrnP:{},KZxcIv:{},ktqajek:80591,OAtpxd:[318,634],neqpGj:"upCbKLnUWfKFBVbjLupUPqHfeivATYXWBJXLZ",qqBPe:39724,fnpr:{},TdKH:48828,hMZiOutzR:{},XoEKOYmp:79951,uPmYRfsgC:9816,VXoYjm:{},ggnIeXk:{},bIiwHxeC:68838,gUqs:"BLsQRuSpzowOrSaQDYRUdtNarlQdDgIjitrlsgjGxHtI",hWsBM:"cuNvYeqyAkhsJTfziMBvVMjYr",VqjQpKf:"TxOdublFAQnczQcoJrKNGIRfqaDGDRDJ",sQhsAOelh:91498,CyYYY:"rNulXpdmONQiVVCngsvNuosRaMnKnaHpCAUSmnaoYxeVDAJ",aRnQWwTQmO:"SAjVHYjKfggTSBZfOArgUXBlmWEBmoaJV",MnlPeZu:53659,svRHdBi:"dvxWJLJzYsKJtXVUupiDElVhFxTqnkTAP",FNcQCTn:"DeinWNsiuQjVnxGsrrKtlvAvSLAgXYLHzUiTY",iqzxUbBfpA:1410,azzvSkoTk:"egeWCGMXmYPqPTvwWFANzRgRUYNcQgiJRfruIuEQUvbLtCMK",bxyFgt:[346,526]};return t},t.prototype.EvYdCGCECH=function(){var t={oEgAwRKHQ:{},zWIDOq:75963,MMknSkAf:"eBgQyicUDjczrOIouuRTNtsfhLRYZrpWkvKE",nMdOUYSxW:9115,kAwR:{},juIKRlR:21521,QdVBM:67228,Qphegnm:"mXHwHIYzGsWGbVkutmRanApasqFrXMeiLWkbhTlYdgtjOGgjAjpKPOhZFmB",MKEpfrFI:"gtwBkxLpFjQdtzlILuYtIbBpGoN",paTqQpL:75401,HoTQmpaq:"ryHHKLzKQTmUdfDQGrVmICdD",JkjRjHYS:[346,715],wfpE:[571,474],YCMTA:[790,327],YgZMRFq:{},IiuN:{},vPDmTA:"JSSYMAMeTVjWYaDbeixWukNErQWIjhuYSnJdDAHIpdIxzqSCk"};return t},Object.defineProperty(t.prototype,"JbApE",{get:function(){return this._JbApE},set:function(t){this._JbApE=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"choIFTDMCA",{get:function(){return this._choIFTDMCA},set:function(t){this._choIFTDMCA=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"PLJGyfY",{get:function(){return this._PLJGyfY},set:function(t){this._PLJGyfY=t},enumerable:!0,configurable:!0}),t.prototype.Bjnn=function(){var t={CTLkKB:"cZxVHXWtLoyAIuyhnMcreWGvjqmPIGSS",mnoN:{},XyYaJKYiYD:58692,JrGBscpI:17164,dEOeN:{},BhSdZX:"dqCcsbIlTdRNKbmxFLZpPdOYvBaMVIaCdMULGqTzqaF",gorXdKNgx:{},nMrhYVvCgJ:"QQIGdPzdJBBaSRgXsQPKcCDwlpPPpuHkPXGxcYbORhNYTbNgSgctk",pJKH:"ascYCtIXIYeCvyobJTyWc",tDBQFfk:{},jlAxaT:{},ZZgCPjTOo:{},uCuxlitBNH:{},hTJjya:[338,402],EzwyZMBC:"dIlMhVavrdONzjGvcNFaIPpqhgePfYtQHVXlEKTsN",THSYYKt:{},AJGkj:83670,VSjhC:67062,ILAIZVW:70980,cdljppN:52100,FidbD:37585,oVvVfkzi:{},xcdATV:{},bEZBNZTmjI:{},jHtOulBYt:[564,630],srLjDMH:95103,oWPZD:12293,kycUxZYqau:72373,SPXlBanB:49782,KTRXbjzCLg:"ESwXHUjMkYlOzHmCwBKuZSNhISAKZUcllavzugihF"};return t},t.prototype.XhNWshV=function(){var t={DraZtzsUlQ:42981,YCUAML:"IURVGspFfsgudPOkKgWKNQSjuBmSLIOwmnJABFSjOmaLhPWKTzQql",diUQR:{},vyVzLK:72234,FLMEBy:"TQfefivVDwlxyjQsAgPjJAhMaKjrZnwF",YFWeIBzZvx:51888,aafgW:{},RFbHyMMGu:{},pPav:{},PYjnRA:"jStsxeEamrwmyzoGrjrycso",XTBSOqwJxG:60261,johMHoDhF:{},FfETBq:{},vRIEPjkhqt:[618,513],gdnAG:"hmaSoQvAEhlpFXreNfhQDDQoyQlQFXehKpgnfZWtOoAxrpBNpWqxikpsR",fksuGWS:[603,571],CZVoiybK:"pVaCDfTSNuQQLXWljfEMqijkCDDdOlYP",sbWyYOF:{},MSPMHh:95674,BYVDjqmN:1299,vuJh:"qslXlSLBFjjJGbhOSbFGFYDxyNUMKPuTTdrTuHjSoTOURadbAcbmLAaFpqk",aNHm:[762,406],TvufCnypEc:"lYISjzPOQjbhPqgYCHbfyTXWKAYMZSVEZzBkRWVCcotrLUBhckJLHGiBkpN",XogGvQz:{},XlgrmQd:"vvQoHMXhZHiDKasXUqjtrpi",LlLKaJT:"vvqebxLZXeYGOCyetSBgdfNrnEPEpeQ",hhVvTgMdC:{},wfloAKczSq:{},ViUUxjRzU:20061,nhMUEU:"sZZcEsgvVmwYUYUXYwhYGkMzVJ"};return t},Object.defineProperty(t.prototype,"aRNgCZriDz",{get:function(){return this._aRNgCZriDz},set:function(t){this._aRNgCZriDz=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MGgAZeJ",{get:function(){return this._MGgAZeJ},set:function(t){this._MGgAZeJ=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CXHBb",{get:function(){return this._CXHBb},set:function(t){this._CXHBb=t},enumerable:!0,configurable:!0}),t.prototype.olZZgtLz=function(){var t={QFIDHD:85749,yJOTO:"nLqwxsVgvrpZwzmbMMjkaOIQRMqSwzNTnRqwMEDjFO",xlsMW:19496,LveFzHej:{},GvslTHqw:"gyeqSFsbuOMdlrczSLvjKIVspmWErfoSCfqjPMiXESTzUmvDgVPGkUoWh",gVgnV:"nwdqpdJPDFgdQUDpEaNrcAybDNEAMvhjFMBlHoJHrszs",nytvwQ:"RYguGYyJTZkARJcXTtoMWgxOdxYgyvwrHBqsfewckAPOP",IzsRYZLY:"ZGgUpqqIXGaklzohGROkitigTNbPgCwjsQWhBVmBufyyGzNonnoOPlw",xLXOOOrG:40591,FwVTaxzEq:{},ZUVDoRhfML:{},bCPNFu:{},toVJgfCbO:"YDcFyTosIaFkzBnapNxEuD",lDLcgsDdl:"NZrDhWmlMDkMsAnasMylvznqUo",RSrBWRyXUH:70116,WKjhBn:[515,300],PONTjyIhI:9248,rndecluUQD:20442,GljJbbyZ:[355,416],JpHHZXHwx:81186,BNMipBr:"ByOepJqbnJsawEjWXOQvo",AXFB:70155};return t},Object.defineProperty(t.prototype,"nYIrVIGz",{get:function(){return this._nYIrVIGz},set:function(t){this._nYIrVIGz=t},enumerable:!0,configurable:!0}),t.prototype.TJvpXrDGUm=function(){var t={NMGq:"mBABxsTrLYPhDWAvoYfHIEgJPGdkyCCabCXPSXOxVdTaWevcWFlodjUHS",RsdsTmfKYW:61998,FqhQpyYMnI:[686,507],LPLLbjxcmP:"APJoNOgfBbQXuGjKOycKhmgSjba",gRnPf:[655,685],adPn:"HXljwPUfqeDgLiyTKUjTLTPSKrrSTwGeWMMNEM",wMuDfLLfFj:72539,ZdraJNEPk:{},gDyrQPgjeU:"aVfZGuwJeLDSHSKfmAmqmAZSiuOJBANosIlmZwXyluirUYcuDYMTeWFsI",LXtOsGT:{},DVGn:36594,rNKSmbc:"pHodtYEvdmMJmQkNyFLjTQdDzOOw",Letumpu:"cWuugfBHfFnILncjXCwjVIlUWBsZDcKJpkWdhVGrcTJkBvBPmWJL",bEARZPrD:"wyHhqKEbTFTWLuPokKOtaAUchcjoiTUpfOPNbGbkcSjIVtjPMmyjgjbXht",sAGCXHm:94665,bNyLCyF:"VtreLqzZzwcnpXpKnvTcvkPVLVCbzcpSGyIXIKAKdErQyHIjDSJyUJEgbYwH",diDxqzzVX:{}};return t},Object.defineProperty(t.prototype,"LucX",{get:function(){return this._LucX},set:function(t){this._LucX=t},enumerable:!0,configurable:!0}),t.prototype.GUGHHQ=function(){var t={fdCXtIs:50072,EHNhEz:"ahoKSXkoGfgZqobVFuMCxtxzEVJDtisAuqyqQ",SdKbnnCN:"bsKlpNVwftbLkyvZzClJAsEUVcxVEktXnjatIpaaUl",BgprSc:{},sJPze:"NNnPdtPsDHSVnsznLXxmzeDAmZmAQfxlgCYwH",vCbnctNQE:"gezIuzeCstERAZlJGKUqPDvnIzfUeTkRBvFcvwOTy",ONUBKyl:{},qRev:"TNvGTCWQSexEMbIEVHdfmKCHH",izKFOwpscs:"jOERGWgckDQlBhIHywMFPzMXFRDOcGsessremPX",xiOj:{},KRFSIDUbp:[719,677],DahaO:82174,oGWRFZ:[692,540],QsuJIn:"zoCMiMtJlmQBERwrlceRUbRVWtgJGwPBHJySEJHlxdkLPiImWCpajsXU",vUHwh:60197,lSdDKzE:{},hfsJN:24460,dOJYlgFsT:17430,kMXjRHNOm:{},PFJqgH:"pBzoXOzKGcZxgNSXjGuMNcWSYizQxmCjUURlkGGbAiJnxdOaTn",ILnonr:{},mDaCPEU:"MiNVtFagVZsccTdMuAfInkoyNhloOvPbhUKsKUueMQ",pdkXSBjlE:{},cHehWXrA:24255};return t},Object.defineProperty(t.prototype,"nZUvPb",{get:function(){return this._nZUvPb},set:function(t){this._nZUvPb=t},enumerable:!0,configurable:!0}),t.prototype.DTmBrzzhgs=function(){var t={cwfXwbOpe:57294,DepK:16976,cxtNobuLK:"BIptOOFJyxICzFdTmZzhLnbMBZBojKgvc",fTyZBS:{},CUOwKlL:"prkcxQPAfPxSQHZWGcBhDotRpTeDNEYKwatVFqkNoATRbiyD",wpSK:{},leeUMukf:94994,dqKTct:[651,785],wJph:{},fYwfug:"HSvjTJVcPZMcETkFkWjbesvsKelhsEFTvGTvmfWDYDIbfc",lwqoQ:84972,eESmgRhYbV:"PRpTZekHtCoLUSYfrbtYzRycJItNiIrTLfCKKHNSLsmesGAiwqWrtJcSiq",FhfaeqoL:"tNYwZhRaxCkoihXRcsZJThRiDwqYoorJnpCuCwqTCfFsKAWRRXVTUNvFUK",jodxVb:"ATqQglUCcWvTZYnnArxRsIshcPgTQgDPseSDRoSPo",AzMK:{},MPltnSGU:"uFnlXRYUwCsGKPtMvcafWaFvDOmzxshJ"};return t},t.prototype.tJQUQ=function(){var t={TjwJxeTZ:"ZhEljGahqSyiJpZXcRiMvTPKoyQASMWsYCkXDvTsfBafIkxbdwfDbfEnwGXj",IHXRe:"alpPGUBnGVIVOEZgCiypYAEoPmSeaCmz",UVmnB:{},ufqrGF:24838,iDFhw:"AvNIQPXrKWKkEtoWGlCXIwO",zwnRUGoyy:{},VZQC:"ZcLNiyYZZHiDrxwDBvdhXUmgDoBrnnSUyHCbGq",ExGtxwATg:90018,pbem:"aYuKOKwogxFFYVwqrdBXVjGeWQerrbuALZtwHLtcM",ZUHZWyJcSH:"nbfYKesKYhBllftQtMKpiHEDyQuTEhixjFm",GBMBcLRlU:"kilEJQFSMCVTUWxRmUxRzivVVvOgXvUquLOoVWpGdD",GTzW:[609,441],ncFbPKEiu:37842,hCgHCjL:"NnzkhDnRzghwYyDtaVlztaEhPfIPkBhQrmkUJ",PnPnh:[692,406],VeTZRKw:"ByxuRTchdrSPRTqQitDgQGtsAehTVJuCcGyUSpgcH",QvWWyraN:{},YmSbuTxPj:{},klIB:{},RGYDnj:{},oUbDXOer:{},zNOAv:"XqrwkEssFefdmBCMesjNualMtFEchtIshTuWDihLCDYoFXfzBMpdvIbch",rnhrNXUHNA:28582,ViPajnXG:"bLiMEIZioXFnXCwoTuDc",fstBms:{},xaDXKK:41244,rjFVh:[726,464]};return t},Object.defineProperty(t.prototype,"mQrMFZ",{get:function(){return this._mQrMFZ},set:function(t){this._mQrMFZ=t},enumerable:!0,configurable:!0}),t.prototype.LMVRiycT=function(){var t={ouFKAO:"GhhQTEzWVHbgISiFUpZOnvuQARmnitFrOTEcrrLHdbQU",GbGSVtjRGu:85507,WozHZZC:[326,532],PSBeP:{},eIhJpxGif:{},VhWKltAbO:{},UHzY:{},ADqImUrRuN:"AfGJasUZGBeZlcSxcXjYWKvOCZKgnjoJwLYDzMXstcenBsOnlyr",DdAaszXiV:"HmKscyJfsAbJZCpYwdmphDSRihjpESaZYWkgSmIcIgJFbbd",PYFB:{},krCuSGjOR:13151,IpxYmteu:[783,623],mlcQWH:"mAHPbpIQuoIEhMfQlIoH",NQQYjzKX:26784,xXFv:"zVjNHTrGJSkvvXcQGJInLUekMDMqEouWjEvNqOpcvnFVzTdE",CjudMY:{},dCeiU:"laifqdDeaUDuaHrqBRWXzsGKlyFRNARmlZuyktzLNWRYwBXBSdbXaCSz",eVRsZSg:"NhUSLPxicntKDrOtheMHGSDqlfMTFCKZrhuuFpn",SZVi:22509,WDgQsf:{}};return t},t.prototype.MzTYA=function(){var t={wICAwiyY:[666,527],mPLvFS:54792,CPRyfnma:"FKaReHpADxaQZySrdqwfdAGfbVWELyGoSLKnoLbnSHdOHQGuZaDCoBVa",JZNoylc:{},IVxXgjCK:"NgBhacfAAUEaTxrWKpSJsAos",nezWFmS:70603,atNQJKob:63974,UCkyW:13272,NYRVy:"FRktlqhHmQSXAjsYmEPIDccMWJMLsdpUTBLcYFQHhwwDWvvWJm",abcGfbLbKf:86643,TdrmU:{},qLdlortTWD:24016,tUhbeA:48257,ldZc:86628,jfYilP:"ZyrtgyrSjvVWSdbGcEPfDySDYMVTyEOZYdBrZx",KtgrPs:{},NvTZzTJRt:"sojNhFczQLdQolqqJDSuMPQHegkTovXENNslXhSnSkXwrslgps",KzzFtAiP:39193,JfCNahF:"zHLtQqrHKRfFVpVHyVXqX",OnAAlMskA:"joHMUoSEzbkYDeRgEwuklqEXLU",RtpJQB:{},VngwsGyx:{}};return t},t.prototype.eNbATAnH=function(){var t={fEAoFYNaIk:{},qjqaAK:"gtKunKqNqmlPPZCpCjqZTYTMAtnutaqRfKpgVTWlroPE",VvHczoX:50414,hAibMnq:97212,DuKPM:54073,BnZpIVTnu:{},vLQLDBtkq:{},vDzxBf:"jxwLULmXIyIVWdkPsdPRbnXzDiLGXnuPLbjiVWDOXWYjHGRrjDtpUNrrkN",gEQGfJXr:77301,yqPBV:"oQsXdebeMLUERZrfIYwqJgcwxUudemPcWFnMJVzacH",mAGs:[309,691],COgyvCw:{},pscVpjcc:{},QwjYUvLuBZ:[456,527],vaSxknG:"PBMniMHYwOjsEMBoIoQpSsiLGgUnVQNGYLOVfNCsJcLmafBQVBmRprU",qQUMb:"hrPnJFEsTVFpczDYkvQDsvPgHcPmNFFToVSXfWqzVeSNRb",zAGrMMORj:{},HVEtYbNC:"rJSCyflVshuAhPOMUZilkbVULSWLOKzsbv",ftKOffI:[708,503],vgRVLOUvR:5136,vvkkAh:{},cBEg:{},CQvb:52523,WyiYqMHca:{},CIEKwKRL:{},UUCoI:[550,773]};return t},Object.defineProperty(t.prototype,"uUbuqpj",{get:function(){return this._uUbuqpj},set:function(t){this._uUbuqpj=t},enumerable:!0,configurable:!0}),t.prototype.oKkdIHjAx=function(){var t={VUtJIU:[681,535],AQCCf:40597,qbyDzG:"zwRTWxxYHJTPPnoekWRlVUqnjpvzMmPiLmJGhBBkcdHvxwccJbmYYdIp",tBsBeZXLy:92320,VJkPvF:{},XusXNlaemr:"zeSHjEJMGhmizPHzkECGTjrMuojbUPrzttsFCnCrTtMwApuzIEzZApn",ktolyujd:[445,482],wfFy:[792,566],EYXLW:[699,626],KLKcOqHil:{},zNKgEBtE:"yzSYsdyqNAkeezzEwrUjRPi",baVXXui:9057,IrUxjnJ:29074,MPoGmtE:6323,mlVPwOrZx:[555,382],bHmG:{},ZfpNxrEbV:"yPKWkzpGmETwXHIWAAfRTovJsngkMfMeVVaxKWGs"};return t},Object.defineProperty(t.prototype,"qDmnx",{get:function(){return this._qDmnx},set:function(t){this._qDmnx=t},enumerable:!0,configurable:!0}),t}();t.VQxWqD=e}(LLWSsMMcy||(LLWSsMMcy={})),function(t){var e=function(){function t(){}return t.prototype.JYxOMqt=function(){var t={LaufSObxY:7737,FvOJurvKE:{},jhxft:{},jDlAzBncIk:{},LwQoe:{},RDcpPemUI:[797,533],NvtriS:"daAjqLSQnSIGRAyhyeamRLvFFjdknzxYEXcNd",unsVFaAXy:{},Zzkn:77664,ABHH:92625,PrencMjRkh:27908,AqllABMBw:44607,KdSDvZcdBr:"DjTqPukwtvtVovKZYyHiNcEFRYLYlyCxzMpkmMbyBQNkycjrleRVNFb",ZnDVj:[478,590],OEbuYfKGQ:{}};return t},t.prototype.dnhQ=function(){var t={sGlkNMW:{},yQIEfe:47967,NewDQnwr:"wSZHhJkYtSBJjPQrCgwMqsKvCXtUCjLtwEXclhaveT",mXYNaYj:12342,xcSnGFYv:82202,elztKC:{},lpmELwEKTp:{},NDSDfWLme:[466,483],ydNPhRNlfO:"DafpdYgDcAQzbwEltpSwVERMzbOgNvUxSbNYUGLbHU",JhJhB:36558,nylJ:{},PTiJrnEk:47755,ZNdU:{},XSrEnnLTh:[555,363],yMTZUMr:"ayHiBHHwgnQWwBIUUDhlhgZWTtGpJsgDITleybUIQodWpemLCfRbDYBIEdeJ",yukA:{},YCpXbfBq:"KAfPNRmAAAhmZgqmcdNuTev",DyzpntHK:[761,488],Wwfn:{},VvMu:"fBBKlFYqaIHWWPeFATgleLyIxhcaHUkMQikHGlBHiEzMZ"};return t},Object.defineProperty(t.prototype,"kCOwKTv",{get:function(){return this._kCOwKTv},set:function(t){this._kCOwKTv=t},enumerable:!0,configurable:!0}),t.prototype.piQRYDP=function(){var t={UcpHsz:24346,ynKKEbClkH:47625,eVHcqBjp:"oEnaxLQeFCgORpIdgqgwupxkmdjNjTEvySmwAWKVpuMuUXDBATPIJN",FWMEBcU:[403,428],sdHDITY:{},KOIM:54949,PqZgNzaL:{},hCLJWt:83498,KwqJUCDDN:{},NMtzL:[741,531],weDJryXLBF:"EUMGNGbrlKSOcBZQJPJKsCJOZIOeFFara",PdrOQjiVjT:{},sAhshivtw:[466,322],daqnqY:86220,NfyRaH:55946,kSjCK:"zFEUgwADvNXWHCQtQmfeBfoydfWW",mQApKmkhNA:"SPELJaHvpcNqUexfojJprQC",YcnLHJC:"fFZMQosZabAEIHRetNQVjuUMGmGyhLAJoYRpnBjfLSpcZOQ",YZhnynvHhZ:{},jhYD:{},emcc:"TqDKsvfUTKkXGMLjPUsLC",EJAPCHXT:"BvoKFUNsCwSPCQtlinqziKYaDvlxAgokzGeIQvkXyfMKnlaw",ADCUAr:12381,oIjxzelatc:{},HUmt:"SOuTHgbHfdetLQnEqRZxDWl",gRLLHaF:40733,IgPebyUpBn:{},GiBxbvti:"ZfPHeSsEEHwhGXgeGcvImoofHIqbBRAEDhA",EszoCNByTE:{},ZimpW:{}};return t},t.prototype.jbBqadHxug=function(){var t={BGxzfxxlxS:"GRiMOvGHPpaVtwhLyBesURwgCQu",Genm:"QmMxFnBUbCMnbWtgXHkVBeDhwCWETllHiXgzgTWIIRAspgR",vawA:{},ihaSlNYM:[510,686],MYHIXaw:53707,zykeHgPJ:"YFvDmFhsIUCsPQrfREulAeuxjgyyrmzDrPScfLUCvpODlgB",ErhtGpdlG:67062,LVtc:{},XpgP:44607,EWMU:72817,CElZ:51227,qHVpFN:{},cGTL:"DutEhTmjCdVFeSgMtYKPJrFPMflzogxvxBDFZYfJnkKEaxfAgl",FvkqbEl:82900,fItf:63098,GhEl:{},ZOhBDdgCow:64853,bhGWDEYPMI:23814,NdmGNRl:{},xxnBLspAS:"CrKwQcUZvCFcUMAsVQZoWTYnCUxMRdWqulhmiuChkVmpiyDSBWfOuYx",lCQuNj:{},yZAkPEhvq:{},YvIi:[507,396],eAkCkqIx:62230,KOCZir:4719,SzenL:86900,xRTbCQvAk:75972};return t},Object.defineProperty(t.prototype,"bfPaNUqND",{get:function(){return this._bfPaNUqND},set:function(t){this._bfPaNUqND=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"PEOE",{get:function(){return this._PEOE},set:function(t){this._PEOE=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kaXSae",{get:function(){return this._kaXSae},set:function(t){this._kaXSae=t},enumerable:!0,configurable:!0}),t.prototype.kOxpSqi=function(){var t={EAVl:{},lxgbneXua:29473,PABi:{},JioQRdpuN:{},xwZlLyLf:28896,wvSHiib:12493,sUVqz:"coNgikiRaeRYvmONnPBXOnyPYepnctZczcSgemKQgbWQfWucytGoAkkCL",LAnQntym:4314,wOjX:15499,aXcK:37881,GMVzneYY:{},litWUDcE:84468,ppLE:"owRqVGffkFwFYzlMQBJgrrQKdtcHspGFWgAoUh",kYKYbbpF:{},yWVUXuNvS:{},XsGUJJ:{},TrbtfBDkd:46178,TmCOmyP:{},WBzzrLcegJ:[428,585],xAXX:98012,zdaj:65285,uHVODdm:{},hIpJuYFWcr:[491,546],vMYQXhuWGV:6888,ylGXVVIqu:"YYkRRmaGZmdCsXpJsZTxXNwVxQPGmgPAljmSfpnrDrQcBj",mebaYRfWt:{},WBcdKZVfQL:[482,516],jsaozlN:27192};return t},Object.defineProperty(t.prototype,"OfJQ",{get:function(){return this._OfJQ},set:function(t){this._OfJQ=t},enumerable:!0,configurable:!0}),t.prototype.hQMo=function(){var t={zMsJVjb:48692,aNDwMmSK:{},Wplqcy:[418,622],qGEet:[513,587],RjjlX:{},RMqqP:"fVSjTnnepaqEMqjTXiUnbWCZLkkFFwOvbS",uopc:[497,633],mVQjJqe:"SblSxFbbkAxirJZRtMmCWNIisxwcq",oHbJ:{},CuMNU:"BWikWzwMvRgJtStFhbXcwsXmVQ",zuXm:{},zusMuF:1422,OSiJCiBm:"jgqAXJueeLokVjkQZFMJSVoXRWwOxUKwWeyLfvQff",cmvHlPK:"XvWiMzsTKVWhUXRXUHlG",ULHigW:89815,GMaL:{},iqOkaaPph:{},Scczcw:65457,fEuwxQNKuU:"agyTWLzJOPIiJxuMJHjmeg",aLFffT:"hztSvBZLcChYyxdgTjAZTckXviXAFRsKIHbHZdrmHcqoCl",jjoJ:47489,rSpJmWUcAp:92184,uXtzKuyupL:72403,gErwjpSTW:{},jjGMgJmHHu:{},BLBlUhwAm:{},kIdI:87803,xfiYo:"vCUMoupHrftVnViAieORf",RUAAkiql:{},rXMVS:{}};return t},t.prototype.feMCjy=function(){var t={JwEhQyk:[307,404],QPAfrr:{},zSGsTTK:33413,Qimdh:{},ryuQmPG:71497,KdFCzN:87450,ZzRdzDbt:{},TQSLL:91870,mqmdwIJb:"TBhjKvxrWNkLTzwYhlbhGdbumkUYCKsukKwGCVsWQulCR",zomnSK:"vYmqFSHPNzeAKLyONeigdyWMeJVuGnkvWMwrR",BWvGqctCzk:{},UTcEMThT:"JOUBWeBHiOdGzXMCGnoDRtqOTzpcKxSIwnBLhzesdUAsYowvWueTwwengx",XiDDtGao:{},StRocSNjLG:{},fbhkoIM:9121,IwwNpVk:"dLcqGihEiRZoOJkTLwHUlntqVFFXFTTtWVGcpwysBZSPba",FDbQ:"TnUVlTuzmFoQZnLxZodbbDWpE",UoKEmylw:{},DeRHQNd:"lbHgMwoamBuEvRViEivkUzstVjYUaFJoEugPDGcOOOIpadfDBzQksMlnoylI",oySybaQA:{},jUDPu:{},IGEAhVjHB:"HUwuYyUtbHXCsyXJUBNVzhPRjNnFNVUIIh",YlazUiO:[573,346],yCUYxxisSB:[780,636],zyqFvfms:"shkVQqUoXxjhQWwzInwMJMcGgtJLdf",sIWe:78265,TtFPxLl:48816,xZepUXT:43296};return t},Object.defineProperty(t.prototype,"jDSrZxLxVv",{get:function(){return this._jDSrZxLxVv},set:function(t){this._jDSrZxLxVv=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"njmkgqAEqi",{get:function(){return this._njmkgqAEqi},set:function(t){this._njmkgqAEqi=t},enumerable:!0,configurable:!0}),t.prototype.emMCurqI=function(){var t={jokc:"fOXEBAdFSiayqAGnfNOsmYVoKcIbkTbjCMKlElOoGmKIybjiCQMIC",HlHcLJoft:[375,655],BZSw:93764,XxHqh:{},BZnQEmXPdv:{},ALVzF:"NQKJnxkSMPZmgurTrZNSGmlJFdCOFYJvpdPZqxkZt",ZSCADiDjDF:{},dsKWR:23509,mZZWmtMmD:{},FOYCj:"UXjSHLGbmFswTaxLprFxehHHZiUnTCxqfCEyKvHqPdfbVPdrHVyNVhJMqW",xEuhfAnju:"yrisHjKjubCHUyMAShefsIbYn",bSiuIhv:94777,PjKTPM:{},mmGPHxU:"SjHQRLwxVVaEKcRGvKUmGX",DFvpXp:68545,sQpBuBDyA:{},mhUKM:{},wbDvm:4063,yrbOYSpPJ:[549,396],IIFH:75960,QTjdUu:"oWHSzFQHBynQQLlPbSxwIWzJA",zHMKevjaU:7115,hBtdOnVa:"IVtBhkOFBkiAiAKAwdFzQcfpUxBvCEAscnGGqxMFqFPJPUlpQivgmRnRKYKs",OViTozsw:{},myQp:"GWrOKGVZlymSaNOQVPkT",uhiWFgvi:{},dEVZiWv:"THlvVQVEFdwaznubGoqNRGPWDmVYlpDHcHZilinxRRuXdRx",QFrPYdyyk:56369,LskaV:21956,wyaPvGTNa:"xJGZFpegAFKGxKiknKdtaRMSJFgMDtNwBMRwBngYZtQtYsdqhlTqF"};return t},Object.defineProperty(t.prototype,"rfcvFrbpNV",{get:function(){return this._rfcvFrbpNV},set:function(t){this._rfcvFrbpNV=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"UxEPk",{get:function(){return this._UxEPk},set:function(t){this._UxEPk=t},enumerable:!0,configurable:!0}),t.prototype.lKHVGhC=function(){var t={zwFijKIjB:{},QDDiIeVPJP:"KLXqBmxMbbtvPxWTeOrBazfJmMMnOpBhphYSCZhePA",BvBKWtU:62814,XtKqCGYSN:[370,420],sVqIIrJ:{},KdLiE:{},BFSTw:[693,517],XbixkHK:10623,VabZu:{},XPSrqGfXkp:"iyIoNNESFMPSSSlEizHlFub",cSnmmIhBLz:"vVQgYsAEowJWLlXKvQyXAiXGb",rHVPF:{},XVZKrkqvu:"uVQFkgAxbUCcInMpcsFdLhLlaHqrHOnTeKSbIqRxGISSvFHMmRaielKHS",BXYeSOLKP:"UpLiCIVxclONVPuTtbxVdA",TZLlUVUE:"dSGXVbjQTmncikgxZeizEQHb",GBKn:{},PoZNWfYPx:{},BgvBt:"WVlyWvlzMsDEKQLtEvzsedTmQVVPanYvBaObpovpUZPjCcajxgnhstSCYVsw",jEsjXZ:[609,714],vjTimD:{},VRsAiYt:77914,znuOg:[659,407],qsikpChg:"zaOoPSSqQUCZAOsgcdWKMfueKDMhbqPgyB",sPoxSD:20539,HJZICmjk:"kSNZSFcTPspCpfGFkumSvIlWLIFDdZtoRcinplqKCxpMbFnDgeMrSULXBQx",zgowEW:78150,PyxtqlYqmf:80990};return t},t.prototype.MMHyU=function(){var t={rnSseBo:89604,PkWIWAmjiR:[333,336],QjGiFlswp:{},JIWXc:63968,WpMpYdyMBH:{},ZYBLdFTlh:{},XMvXmRGy:{},IYepJQdfeJ:"ahQRIFEzLyjZNjqdnPBsYgHsksGiVHhBjUbQpaACuqQFJTXUMdxERdsZOZC",zYNYxbkwN:[642,562],zUKp:{},QMSbpkUcPJ:24941,DLtiHEWt:"SczXHewRrIuRpGqdHniFdslNOmECxzDALhtRPz",TFZDq:{},cSRI:"FhzWHywruTCOatgNfWjsPhPfNELAsokEnBOYSbrhV",sbcuGZEyn:{},iJujIBqOBH:11290,ORHcFCc:19934};return t},t.prototype.WPOENIUqq=function(){var t={yzivVAEgGk:"FoUytfesZPqiYyrXGlqYYWPDcbpjyNqmpNisPobNtatmcXpHViwwL",vQGlAUkleD:[582,748],ZDTec:{},fwCsHJ:{},yFxK:{},CixUSOs:{},oJSYneUx:"FrVPYHHRFtpNGSofNZcmdffEHLEeYyOC",GtLiXhnl:"FRmNHQgVnDksIyrbhWvqrCcRrmggEuehJgfXsiexUeRiovj",IywX:31836,KoQXJxgKyO:"BekssAeiKKkWWxDnJIVFOZeOLSvAmoexWYRxQpqINAyyDrAgDtrvR",QTpzJbK:"LmpjtVfINanpqEhhHuflOkTgLLclTYCrFVpFuurnYsaF",bOwo:"ONIbarGLMTGeWfZGadcCiKd",UgANYw:{},ZibNy:[686,529],GtNAn:"pjvicTBLJVAUkoWudYaHUqLmSvsMZCiMKnHxmtPmNmyTBrQoCgM"};return t},Object.defineProperty(t.prototype,"pTuxjau",{get:function(){return this._pTuxjau},set:function(t){this._pTuxjau=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"JvGOiTD",{get:function(){return this._JvGOiTD},set:function(t){this._JvGOiTD=t},enumerable:!0,configurable:!0}),t.prototype.BobG=function(){var t={HyLdKzo:{},DRkyWmkQz:10765,JUKv:4915,izbgyQ:"wvfYyrYZUvjyBOxUynyPtbDEycHbVoAOxorzwEJyfTfukAmdWpEPFij",pcbnGltd:56626,zrwz:10465,FEpFeQ:{},sWxkQu:{},dTGUU:"dIzbiKpKFdTHjWLZBuQFFyQkjNtTwCVSdzJ",ZxediQ:17735,YyoWdyQATE:"rXQiorBdtmhJpNCLZSSrpkwDxgfmqhHfFvTqJYFGSRTguPFWtHqGSICg",ZjENCSAFN:"VwmUQsbkWsxFqLkwlmbJcvWmlejTSuDem",fmCVxzCWGI:69500,GPIcz:38480,mpKD:"xjMiAuHfQjVedgofewMwIV",bSeT:23868,jYNiqvIvzy:"hpEZladQRXCyRtcccNNSELLVkYBtnSwfNVnsUdJRJOLD",uEhgxU:{},cBepr:38724,zBnE:"bwbHYTGOSizYFJJUVruFIcsioaOLnkxWmUMbfioRHFKG",aTCJCpox:{},WdmgKR:{},ZAcjgrujc:[402,703],jcqmRX:[551,731],ZsGbAwnLP:{},DOJhlgCS:{},aXBGQloZfS:"AYRAIGYBcDdzNXdbhpggVoknopCseKtcrIAomYKJsxTN",cBxUMlWLN:[436,302],OjzPHoE:{},ZGAOP:96018};return t},t.prototype.LDsYidQ=function(){var t={xnnLZhjV:"KovKocDaXVdIWVJRpQwBUkKVfTRHvIuOLzTRFm",LLZLT:"JytwzecBDFoDwnbbIzscdUerQu",gSQltDkg:{},PyXQMv:"pzEcwEEQVIXWihXKkzJBkDDWMe",yymAYxR:"XAaqXeezMXblscdtlmiYCPAUYvtaYRjYnCyGOaJlGuhcReBssWYZu",JWHVfJFMk:"wVoFvMCVIQtPxfTptxbzSKwwxHbOZhSrDnWQIxhZYupexOBFqNdoU",MaAZRBBH:43818,noxBbjvuS:"WYMqULUykjlelEhShjBRiYtbdEWbYkXKFBCWgRAZzCl",BVljsokU:98121,jVOXkS:95354,AjCtPGUW:"eLVXAukfhsiQZPxWQWaoG",ICSCxzyAYU:{},dpszStwW:[412,349],diEMMl:"leFXsynaeDdzbUgBkitARNvAQMCXmYlFXJRtHPDxiFAKIKFWYonYZHaA",pRNJv:{},BmcDVxuI:"HguBeJyNCHCoBBICjWGKIWOolCdboFroARCUfAnLCXUqtxwrHSMuQgsoUadN",KHVQplju:[669,681],kRjC:"OndOwrxsAHNviRlaTpcXpOgiBLWnYctgPBSGvmIpBgH",nZSiRJ:62856,qdok:"XouExgUQbsPfQjwKxYfulOqYjdtvwRLGZUqpajVCSJIIBsCnmgy",AxAl:{}};return t},t.prototype.AWXiRkMjH=function(){var t={iASUMiF:{},uvrOUbTy:"joSXqSWfFwahxBNZBOyNyse",mlnk:[608,733],XFJrku:25225,PrWPp:{},ZCgGJanD:"RRfEERikKDPmmGXkxjlXJBhZdUeZiYJnKxUuRJ",tBRS:{},WHWQWLKa:"ZwchoPmclPdxWqMNYmatrbkBKREwbJITrRKtAaBt",rKiRNcg:{},IrkBpXtG:"GuMfDYPsvdpEBKsPAVXHoPLCCpUPEQgvNYyswaYXljnQUJkqoIF",TTCBOp:{},KyQwrvc:{},pPhhzZKU:"fwtcSqHGqwYBxDRepDGpl",pbaLTQjdl:{},sEKC:"TVLtnqGzzsRzusfPsjSrNkIE",iYSzcir:{},nSLNefinv:{},IMvThcrAq:{},QADlQyvv:"CYpvXTXfrjcERTdSSXWZRZhvkdjVgwLUkce",toJacja:{},rrMi:28733,NaYo:"dEnxbzswNobjNPZqZLfTvSdKCMfkiCOxTpTAESNhHrXRsoH"};return t},Object.defineProperty(t.prototype,"qbnBG",{get:function(){return this._qbnBG},set:function(t){this._qbnBG=t},enumerable:!0,configurable:!0}),t.prototype.YzFSPfift=function(){var t={LfEwwr:46471,vAKyLTngj:[384,347],FLTZuZu:{},buMDGNiIn:38842,XzeyZtWiwb:{},OzHYzwQEpV:"WqJwQcQpmCQirXRYBQoOhxU",PairIYhouK:{},MdKfzOoqyg:{},UVXwdXXLg:[475,694],tqtsa:10206,NBBmwVGwh:{},xXCi:"NZseqDedkOcwZJhzpQGgGIfYwceIfJzEhlu",PuIpujP:"diYXwwRQVZvBFKQNzYhwCWkvkQjKdMbqCsgeIGUCniEbBgzGpgtSi",mmWYZKvB:{},JtTKIBG:{},xjwFRmSjUZ:80410,XfwMBG:"tzcFlwjYaUpHhwfXUZSjvAUkcZmmZKKnnPPLxOQfqgUugTmhwyqCDvLnVmXY",OVwFQ:"kIXnkDDZHxxOuJSPCjyPGhmkxbEosoWSOeybELuFJPJUgPfonEaHYSYCYSn",HzbKWHBS:89444,agrFJD:39764,pnOv:"xjusYGYRgOaIcSFhZZpKyrYnDlkxKVTcgPZtLRGtlULcFoJlSlSgFzjMxBR",LNAoXkhNMC:[330,661],tORu:"jocixEUOsNcfzTcyYpbwU",bkQfGQSY:"sgqpAVzpTofDuMKzcPsHnyqnpdWvRwcHupWlGHsSu"};return t},t.prototype.jnFQyP=function(){var t={zpDT:81486,riucX:75262,TBxj:{},ZMRcDr:[655,523],ENPukd:"juVmjYxHSTYeOHemMWrFEhWhoAqepRRRyhCmvghNxv",nQdVs:51529,IncfmqN:[612,581],HmTNyeZtpK:{},eUHVW:"WfNAJPxwidbVoByBKKXKOHRNubLUBahZguIhVHLdpirrTterWKZIBoClLz",kJRMOgg:"JnkvmpcspRTDMUHOPctY",eOKGec:9520,nVBsyYRk:{},JatToWc:"SDmgQlPcdbjKCpKEBxMdUzR",xnMxnye:8783,SnBA:{},GArWHUR:28742,VJMiDezN:24880,hNIR:{},TzCl:{},xSss:86897,wcwqFJLd:"tlmxSiAYKvffRgNocOwGKJXiZl",gOXgTx:{}};return t},t.prototype.cPza=function(){var t={TEEUTNPtUF:[354,574],DByGYgM:"vcslNaxAbisiFbBVwcTlXz",wcMP:31902,EgGqIxrLb:"AhYJZpzvHYOhoYvrfPvCjyifPWPYKXGyAFGqeXhZDarrSEFgQ",imtzbRODN:{},uxDbfc:"BlOnGrATZetRaBlTFbNHAWTzVVkol",GoULRcp:88973,IsSfeDcTg:{},UENeeueuAL:{},KXSfgGjOt:"JxqSOIauEjMqMRMWKppHjFLMvlZLDguHkysIoohUPQTGuTl",DKjFaAvZS:"uvYRifpDiyKyyqpovNxuxHqUcqqcFMrWvSkfso",SRrRb:[606,476],YmIFWdDcYN:[773,641],GXJdSMyj:"OfpLhjbjpuTfozAkiaNTLKubNxv",VVwzdb:"NncBdKjWftEGMkRNjZaKUQtHdmuwCuYmdOEikxm",NYKewJZUiR:"hLuvTNTDxmhCEztKGMlAOMVlVQIwyGYPmQLVZUBAVcVyo",TkcHi:{},inUopWh:{},lIxBMhJJ:25983,KChMlpFPLq:{},VGgmWSPGm:58463,rHsHtJn:"VGqGdJMIMgOCpSFRGQfQnOEKCTEeqwojnJuWgLjupQFWGbOMdG"};return t},t.prototype.JkqCvwQn=function(){var t={OBrDHfkt:"rFbksWauluJisezQecasJrXMunbkZcAivgfezzQfjgUYZwLMJozx",FJTQfuPitw:"FvjZFKQZtVDGDRwbqAVmA",XrgklZnzH:"HOxxAJgHaKbLmvGsNwpUZEIKmMXBpAagasqHBPdUXIttpw",IlfubhnbAZ:"fuAVACurhtolKZfvOwEgYRKGdnfCPyimJTfn",ZiqPxPrMg:13574,SvNAzVnm:31056,yXJuhuaH:[733,646],cVcJHX:49568,jJKMdz:"tOyyQhDzTPYSbvespLugLgydrSxSRTPbiISELHHkKjjbSfQwZqjzpw",qZEFiS:8789,BadHwiwkg:{},kroIY:"qqUsCkPpAjOzHkrrAjHwcLOZNlxp",KuNW:"ZFItAjAsbwuMxJoRltTYZaTGusfeXqPrVRSoMxOjMNeeWfrubIFtppp",jMFWscyJU:"fGKmqOFGgQifSmHILaUzN",gQSIgnl:"HNVZLlLOTgjotnhiJcdkREvvpEMLzGMpJgDnLKsgaSmlVXA",qxnGHBF:"pXKXBNLFSCjfcMkWBGYexXcRvtnizkgdFBAIoAZExKpmDxJrtpELiaeFki",xfOHR:"lMCrAtnuELJGTmknCNGzvCQ",xzsfRPq:"cCacNTumIpgmQSKIFVlWOps",emBaTdhpYV:"dXfbDcZlVORIWTQVHIwuYJkqMEhGGyXANtjCoICqDplJsknZLIayOYihKP",ogbMVqLm:[527,313],dtAtE:{},hQBBjLqXQA:{},Lxpih:{},SPcAINss:{},hVSGIRpBdu:"tNiwsTDcwkeDNXWfeTudbvGgZkfXGqhosYXsBqIA",oKQhYpQLkZ:{},DzUIQj:{},rrGxIm:{},zxUwOyKO:76491,vPPyMbw:{}};return t},t}();t.Pdsid=e}(RiAecZ||(RiAecZ={})),function(t){var e=function(){function t(){}return Object.defineProperty(t.prototype,"HkXHJPxDmn",{get:function(){return this._HkXHJPxDmn},set:function(t){this._HkXHJPxDmn=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"slTbWCawt",{get:function(){return this._slTbWCawt},set:function(t){this._slTbWCawt=t},enumerable:!0,configurable:!0}),t.prototype.KEgMm=function(){var t={tHwXYI:{},WOabgt:30222,ppXi:77331,VQUKljSrD:[539,427],ZtMnMNPL:59596,ZPdmsQmbw:"LMqOvGqdLDYAIQfigUtaWzUrxfMHVAbObBGqxIWrCXa",AOKc:"NivMqrPVOxhulKMpTSHaMbLRTsCwbtBEcyvJmoaLRkVOyDpo",kmbXkiB:{},JQpVG:[562,631],UlMYVYo:59421,VWaUQyW:12931,PlPEleG:"zxNTELWBuIIpwPTACgOtAruIFSghXLTTl",OOwCvaC:{},elkhqyv:{},FjgfhK:80748,ITdittlsWE:"ehozSDEijenVviqZkOIVwTdcjSVnmEMfkEHIIiXlvdKsJxBKEfKhwx",mOYHyR:"wggUfbxVaFaTifFNQGSeOpwINSanLaetzHNeiKVxPJnZCEIiSYmZsD",LeaUXbZke:"tMZlQgHioFbTeGSNwTOPvYFdHTdDribwWgrwAfPJxQDuvMLhHA",nKdnMNDdL:"vZMLnpowVTuzKaCjCLctEiEqMOwWuWHNjdPwlBVOdQNqcAtz",kcUgZAcqg:71379,BJOZfb:24808};return t},Object.defineProperty(t.prototype,"WyxDakgw",{get:function(){return this._WyxDakgw},set:function(t){this._WyxDakgw=t},enumerable:!0,configurable:!0}),t.prototype.tjilvme=function(){var t={EyQjRUIv:{},yfDWsIzybI:[330,563],nNjk:87468,NspYzR:44622,ZxjUOLcw:{},lZhhNlwh:"jMoYwxeNKNCVWpKvHOcsFetTzoqRmmwt",QPMcgOxjP:"BDgvnQwlycYtkFNdWdubDGbwVFelHET",ZsvqOL:72313,ZmHzKsi:{},hOsR:19590,dftVUw:"BpIazRgTqmPzDdeifOeDJuskTgQLSefGYdEeEtvLTMeI",NhyAxV:{},BoNGGww:{},AscNa:"LDsOZBjjzaAkChcKAfzHwLGXGxNZddAdAoUgdEkLsY",zOWoiRl:{},kUcrUmzzFw:68986,QHXLihfD:"mPymGMBclcqNZbcvqBBUhtAIQVgstGU"};return t},t.prototype.CSpFFu=function(){var t={FWYTplEYL:{},MgQSnbmc:39936,VLzrQI:"eBJjHYERhlhTSwMPdDCTPICbMsmulxrmjVEnlegGP",uOVfCnpKG:27944,zKUopEoB:[564,564],WOQBQ:95468,caOZqFZCvz:{},cXHsphc:"LeRhLtYBlsogVgYWOtQJosuSEBDGqfPysxlNPjDyQKyVpuvEqqIaSA",juqpgsSiS:"hrRVdtdevJdxIDjpvluBEBnVkrxYlwtWuXrjltOTzmaYoHjAIDdPtDGm",kBKjR:[696,515],KJHaPNyEh:94432,cAHPCaxk:{},gMRLMiTx:"lQUNAPMqyruItBymYZusJCbCLFYsrUnHNTqFYQNmKhBruKkkSlv",qmJSIKt:{},jtvp:"gpEuZIDKTITEFgUPELRCxky"};return t},Object.defineProperty(t.prototype,"zcLFrDzvX",{get:function(){return this._zcLFrDzvX},set:function(t){this._zcLFrDzvX=t},enumerable:!0,configurable:!0}),t.prototype.QekTvsxjbM=function(){var t={lIST:33147,fkPkKgPjs:"GZPWVTXmqzrlMUdNlmhtZfKKAnXKr",gOix:36724,wwfQjqVk:{},dogIHyxcd:{},OskgeY:{},GDMzd:23367,xjUajaio:"bydnFNvhNeUqTlkxwLMZtDfxElpDUnmMHGHltwonwN",XuFLwloQ:[774,634],DmiVLkux:"HuzqDXafMsfukXozUJXKeLAgYNOpHlIi",KrLePBOd:[644,466],ItZOdvh:{},XXReuaQZL:"DGLHBzDkEDcTmHBIodMeMDyaXjIsYfiX",osxyVJSs:"ZdmhPLoJcLtPphafeBwwEHidFoM",TmsuNfk:"RFmPrurJQqOAvNGCSRyRMylju",gBeYolmHo:{},GXOcJIqr:58118,mBvxH:13556};return t},Object.defineProperty(t.prototype,"qtrAbMmrx",{get:function(){return this._qtrAbMmrx},set:function(t){this._qtrAbMmrx=t},enumerable:!0,configurable:!0}),t.prototype.EoQB=function(){var t={PkXxQ:{},MuGCxsRxUO:15741,KXKEui:{},OkqkdIYO:[412,402],SwbVwIBBj:[697,508],CvkEMEAqbM:"eUkGMBvbduMHGGSYRAUOPmkUcLITW",JcCIbmLs:{},VgmncqcUvw:22448,sXNyv:{},LbsC:"rpmeTtUZevHyOlMlYiuOBbCJVkArrcutlpR",XAywX:11003,aBIwCiYU:{},twTmovr:{},RxcA:23101,IlleykMs:"WJJPUheBQuxPAZaZhfKdvZJlJJxGKXvKZFlx",juSY:22932,SoDZZ:15484,doxKWlRFd:"sIEoVOqnDwIwjzcYoaYrlzFKDKnNnDaJFkReKTUhxfPfCrvFOFtpDTzkqqof"};return t},Object.defineProperty(t.prototype,"nHYdGY",{get:function(){return this._nHYdGY},set:function(t){this._nHYdGY=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mojkfJef",{get:function(){return this._mojkfJef},set:function(t){this._mojkfJef=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EbToImv",{get:function(){return this._EbToImv},set:function(t){this._EbToImv=t},enumerable:!0,configurable:!0}),t.prototype.qUwMU=function(){var t={ZFZPFV:[472,508],QYmjbIVIHx:80069,aYYtubmU:"GYvIFvSDHtYEsSScsiRUzZXplisNsPTMFLAsWplMlTyqqlEonN",WWAZ:{},ytYDysGsh:7943,QmCs:52937,ogmEe:"qrlNNzZMARTyJnijqblSwroLtcKECYNbRigUZP",AiGwwWa:"fSbwPHCveygNYdDjPUoobpYoXdhpxKTMscedymVAVxYQpyXFLd",QEjD:"UMaIgKlGUggbnahmynhPOjHhkbNWZEeyeqNefK",mzSSYecnH:{},yVdttxslY:60188,HjHKuEwnSj:"xnSRugXDKgASLCRVrjuFxPqXSQPrNyHNPKRdllmtZlMxeaeIqojEiwBejbF",DeBZhOzOc:26007,GaikFJ:"DQKnXpoSIIFDTRYLiQUWxJYShNIomqoVbwsjqkPESlYHD",NsId:{},rzyUTMYydZ:{},TkYHLxN:39730,RPRy:{},gWeDyrKaxr:"DDRcIKCQWklRIeSWdVwPyfTyxCwueEOxkHyG",XjmNksL:{}};return t},t.prototype.xYwPWSC=function(){var t={zTYR:"gUCDpyUvlKLqDLbsUoIrFNJyvBvhvyFiJFweAjvKDRzZoX",fjtvcPTerM:"AsVGfhDxhRDLbZGdXsQXeSPwiuiZQwrxKZvrxOO",dpEr:"vJfaRIABtUpPxfLQekwAxwEUVLYzpBgfvLgWaGurBweJYZw",YqTbKUZ:61922,WxZX:[482,608],pweGHyHL:"cQiDneENLmdbNHwzSNQRNScWbJAeToKR",MjrwMnrz:35135,DRAqWcJO:35999,dWaJaz:{},SPXNn:{},yTORkKaxk:47441,brwfjRBr:44111,oUDzkAw:"EGTswzlkvcwwiIENsYbytOzCwYDfnvWKXLVtleREYJQscNEQ",cBEsAFrOtv:{},oAVyqFw:{},xgiZYIml:77488,qiHx:{}};return t},Object.defineProperty(t.prototype,"KcCrnhpEWC",{get:function(){return this._KcCrnhpEWC},set:function(t){this._KcCrnhpEWC=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MctRAWACI",{get:function(){return this._MctRAWACI},set:function(t){this._MctRAWACI=t},enumerable:!0,configurable:!0}),t.prototype.njoLW=function(){var t={eAJfcr:85386,fzNw:{},JZLwPgvZT:11423,NNNXfWrKSK:"wlSvntIYitgmQmywQkhLefdNUzLjmiHqapGofLgmEhToaCOhJy",ReGKX:[408,628],ZsFBcNRK:{},RMLQFEw:13312,AudZxy:"fegYDLLCnrleShhNaeLoODAiaNiCyyqHxgtHrkcpYopVRKygyorcRWuzr",ewRcE:[596,582],RMxXQZqt:{},srawDi:2794,zQbEABy:7517,QVzEgS:{},RVuDm:{},kUgeWEawxN:{},uzJmlXK:"cZXzyXWPTzOEyrIsSbQUdelphOThRTYDHyxjqXknxUOhdimKw",wTlbZftqPh:"GkCLcrxSpPZhGzJfJinwzvDagttnmwNkrZIVZrTpjzfFI"};return t},Object.defineProperty(t.prototype,"MqxWAO",{get:function(){return this._MqxWAO},set:function(t){this._MqxWAO=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"SXmkfwbzVZ",{get:function(){return this._SXmkfwbzVZ},set:function(t){this._SXmkfwbzVZ=t},enumerable:!0,configurable:!0}),t.prototype.VNftztQD=function(){var t={FCLyV:{},HRRgHykS:"DgwjehJwZKwqrRMWNeWIrFXZQfi",cZwdbdw:"clKgaHYlWNaRgAIkEyZllKBROGekRfMMRwDXHYsEOoYBc",JJtIkwixA:36896,WzISI:{},DJTGDiwKQ:{},XWFVxcJlm:{},XOLAyvmSMO:"WrjFIZfOiAjoOYhKjoXp",sSQNXrUvQO:{},joZH:"AkGZcVeDpRypwwhPfMnHwrXPHiMEkf",jcCJ:71249,cvyRX:"rHLUomxolyTSjNfBtvIOizcOJzKzPAKSoSncaxLLLcBzsOUnvWYmVgYCts",PyFQO:"OEcRuRpuQPkZYJDSihQm",jokWVQ:68494,jSKjO:"icaEVpfZBgpPuXOkNbqu",tfpb:{},LghaFNSK:"hbFkOPQBGeiXXFpfLduEcnNFABWDlGaRioXUcEUNImgRtJdRhoq",FGQMLxyg:"LblqkzufWdsEyFlVshINchL",kMZaiaBdrU:{},ZVJun:87888,lXuozoPfSF:"OFKYFrQFKefCbhaGCzIRABnluVuqWX",pfzXToWnKt:48477};return t},Object.defineProperty(t.prototype,"FrZUa",{get:function(){return this._FrZUa},set:function(t){this._FrZUa=t},enumerable:!0,configurable:!0}),t.prototype.kkirmTFkux=function(){var t={OLFIaW:[727,521],faQraVs:97849,oczoFEIUmN:79443,XXdz:[455,358],nRwO:{},pdRcGV:{},pqxZvAwLb:"IUmFMoOTInuoyhYIHuMIQ",FhRaclFHMt:"koQYEKLWVRmoOIFDKNOLIWokiQoRdGIfhSLMHksxsRsMucMpv",lsRBcMtkks:38682,YjnqcSkTG:51432,jTsvkAQBGd:{},zZCmirB:"AOIzduJzHgqzYBdVGZzUrJgnykQo",MRJhnUHOS:{},rOefGF:{},ikdxZUcAy:{},CKZTArBev:41159};return t},t.prototype.GUcnoOdJa=function(){var t={QyDUSrlHY:[390,307],JabHbjepb:[569,378],mDZC:40903,SJsKDISehy:"YWUrawxWTaTEbYlICtRJXRHawgYeFcTODKiPlDmAVmPivmTmHSCMUb",RZuIEO:39688,qovkbWPPR:"pLgcDeNOibtbMwtsbYYfFfaJwGwYjvqNrgPLpz",CxiqDxhQ:{},ykWmbCDMW:[762,608],PklIdEwZvk:{},RCGQHI:[442,423],pAYitsNCah:[437,533],RwTiA:23608,zrRYAR:47556,bMSs:{},VQDZLS:[549,372],JWopwKb:{},sBDjWCC:"BvjLqzGlFnMUYbBRZuDctwtliiMbhuKYE",fjolGfVdy:95979,HzwE:"PaNjkLZGVzzjqmjwcjiHpJQdJcIJkHIJjlJjZKSWxgNlkztCSYTO",mkuutZlLr:{},XmVHtFVO:{},mixg:11067,arXPsFsoS:{}};return t},Object.defineProperty(t.prototype,"mdAEaTHHW",{get:function(){return this._mdAEaTHHW},set:function(t){this._mdAEaTHHW=t},enumerable:!0,configurable:!0}),t.prototype.pnBoMR=function(){var t={lDuA:[475,585],KoBOPqH:{},fgfQdf:{},CCThIhOEhQ:{},LZnWbpe:"jdFevxtYQwOATieVRHOdKrOCfUFAmcIcxtaySQnuxEFJvSLeoktSWXeAxQ",bcmKNkpT:83866,VNvnbHX:"yJwrnhSPZmKdqUxDfVGdEwfArrWBaJ",vCtwmaJMA:30775,ymfl:83235,pAsri:6190,KwbsDzL:7075,aRrSLh:{},QNqu:"IOBWpRQBYsSnCtftFQwApjwztBNZglgZ",dkvKkltBPc:91329,bRqTVfBvV:78966,AQxMZwN:[329,385],WYVzbcF:{},rbOJhDDK:"NwFLSgUlqxBJiujeGSPCrZtI",zhQF:51656,SKGYENp:[373,536],lFGOvllsTq:"xuQgadIyRqfCZqgafLMVcgkRMoxyanNtBHAn"};return t},t.prototype.VtnZLJu=function(){var t={vvVMnV:73567,VifinqeS:99964,bcoabkR:"eceeuDFJLaBAXmqUBnckgXQcAmXXOauPrNK",PNWbc:{},OtrTIGV:{},WgmiDOM:[454,696],OKrg:{},hCUZNwHpY:"qVPxSBRjMMmhGjUAWcTkG",YgZRAREDEw:{},HVQL:"hAITRgGoenAuLuBDRiMnKOKHkcJ",pDauL:69083,oNycTOH:{},pQqooIHES:{},TDtQb:15559,fawgxetcB:"KAvmWdAaJBnMMRcEYDqcdktqwyFSwS"};return t},t.prototype.XexCWYiF=function(){var t={zvMtqrtNlP:73316,CwRlAkGmmt:[507,378],UsYgsQKd:{},lmDRsAd:4773,glXmS:"jESKPCiImrwLFQRYBfbsGEccUveAQQZX",iiGzvMQr:"nDyackJjnGpaacXLRjQPSDSxzZytJBtFsAXHIFiaehCh",gQTIJwBgR:{},DJazMOtF:99315,CsRdkqTZq:46238,zfAT:[391,768],UFvXBNhb:32268,FQMpuHy:[727,607],dtVa:"FqJkAwdYgQslivnmUgEpERCSKvHyXVchffINGRFFjLTWuaCgXEztutHv",rysQ:69346,fWNScdbkp:"QDHRbFhTDAvJZrQVzQtuRyJCTnYUXoIYfguwhLoMVHJpAPvm"};return t},Object.defineProperty(t.prototype,"lKMotE",{get:function(){return this._lKMotE},set:function(t){this._lKMotE=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cRgVN",{get:function(){return this._cRgVN},set:function(t){this._cRgVN=t},enumerable:!0,configurable:!0}),t}();t.Ngtbk=e}(nTbG||(nTbG={})),function(t){var e=function(){function t(){}return t.prototype.txkIEsw=function(){var t={pQtIAEiX:{},TnPfcUGVR:"WYaUZdbCeXAhmhjIvdvQnHVsnoGgvEfXfXZYXwVdJTpkJdnIYtXYWyQJ",ovXhjMzV:"BthuuFFnOARmOcasDGSbwioNzjCoAFg",BUWoywRm:"cxVUqtTvtWNEWiuJgohbNbEBZbyZiGEwZSRXFHggTFJhCzzjNMpKiRGaJ",vgOFk:{},KLoWzFHArK:77283,RRMdyyhD:{},ndHFw:14290,VXVhwoakp:"kwoZHIUmutaVIHqJnAytyrbVNICmLmtMbBMvVNFSoEBDnRdFaoK",vvaXUWgwtH:[767,317],EAgqM:{},kUYyjhD:[653,666],kDbvP:"NpnIZCKiJwTjTUBTYtPoboHIVYkwCRldR",ZGAhDthG:14224,yBkfK:"EPhSkSrRHxlNcaozlOXQzAomMWzpuGLRHcQxYgfzCSQAsZDXlpP",fRyaKx:43586,vlVtFyhDps:{},YXWFeOFt:95468,iUgpO:"PkYFglOsUIeSYSBpnYdNaD",qDvGBPRnB:3105};return t},Object.defineProperty(t.prototype,"HJYAHGceK",{get:function(){return this._HJYAHGceK},set:function(t){this._HJYAHGceK=t},enumerable:!0,configurable:!0}),t.prototype.AiFVncIZF=function(){var t={kXAGjYmqYi:"IAYvIXASagbNSGoUSmuEcepoWyDP",hdFf:"lgKaesDCmiJRLVnLpVSPQeVSoU",ckaVwa:{},RQrYaxffZS:20798,gKwrV:{},WCBZf:{},cDOZXSbtYp:"KsoTgGszMbqpggWFYSavTlQwDpMlpWsYOB",lfQUKQ:{},jOdWFrJ:"TBrajmEtknRMxNtytpGBSyFTewkeopQVLnPEddHWaRc",LDOsEjVF:"jVCpPqrSoQaAfRhUOVMvsOBPfHyzjvERuEIbdFL",SrNungYkDR:{},QZAv:"ZwXeNtkaqUNOBJfcxuFYvqBYLSkQWQdkMyeQMYv",DgpT:{},tZsmgP:67346,fgVwuKE:47193,FcOEheYn:{},bMqwVp:{},HTrf:{},MdtxAZ:3199,CEMVx:3099,qEbHyQbNG:19430,oxlCO:"wlgocKFrVklIEprOuIkgNSh",OigUI:{},wNQQsWXsfY:{},WbWTSjmCyJ:"yKMbbdEWMUjwEXJNCowNFKbmrXzpJkxlIrWdfMKbHAiMBxomMzLTUgOZBDhp",vFQcJ:99203,eFDc:"feyHNGSdfOdffurppQFDvExpiCihdLkkMzFcugTVPGCWVoOUsKzhmb"};return t},Object.defineProperty(t.prototype,"ZQcOg",{get:function(){return this._ZQcOg},set:function(t){this._ZQcOg=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"OmTu",{get:function(){return this._OmTu},set:function(t){this._OmTu=t},enumerable:!0,configurable:!0}),t.prototype.omXP=function(){var t={VpQIpYL:37564,iemGd:[543,480],iaPVtA:{},mchlDtfMA:"IyQGnIxiuhQAsUJDwKotOGVPzRFYjEwCGMIMxXolVIMOjAiTSWiWoJhw",FRuXH:35301,FtwmVgjP:{},rupjdp:{},lnXd:{},pncdajd:88096,ozYaaF:"IczasyoLZgeVUQKIMhpHHxYCVFDZJc",zsJDzsiWx:"HVyHNYiASKqvFLcNkVDcHoSWNFjbhirkQuRa",fNaZAcXC:"qbUKdUGaZJFmhUcAkPDo",ZjLpHukoqM:[710,702],sbYxKfHX:[521,738],FPRj:{},CXVVrn:{},NovQqkA:{},pjaCJ:[495,676],KUHb:{},fcBdzG:{},fLUe:"etirgEkQuxGnmvPApFWfHbcKkkqi",tFHdnzVI:"AkvwbjXUgwlooNkHXSlLewMsXvauoeYNRwBWZaE",ArWQPrW:[305,456],YwJkOlN:{},bZgqYws:"zHakGpUHqGhleNWCOpxlJQFKsaxWRuhSEdXeSb",hjYGpWsi:[740,581],OgrlKrbBsg:{}};return t},Object.defineProperty(t.prototype,"VjRQRqSQOJ",{get:function(){return this._VjRQRqSQOJ},set:function(t){this._VjRQRqSQOJ=t},enumerable:!0,configurable:!0}),t.prototype.HOIYFPBJX=function(){var t={GhiKTOhnw:"ZrllGBHfbNmTLcalzDbZlGJucTwYSSjVUMJjZgcwsSLn",VInvWYwwH:"NYcDMqIsgdIOzLwxkTvXSaFhuqVKLeSetFwRPraBhP",hHsirDsAo:[370,495],KFxotUueSl:"LEmUIKwhyEPJNUWjtBDWSHvwlujEcTbrZMoFYkvBnHvuoty",vrQZta:"WzDSDsIrzYjnLtDNigyAHigCamRZGxvFGqtfHoYuEEaWbUYfFHzNyVhiZwZ",FuamP:"lRuHhujnAymtiCSmWRhAsVQmEZZTjnEucOtZXURN",LYze:20937,HRlIu:"AKgNUylyTCEvOHSrxEaUUrQEREdbVRouVhWVETRtAbeNCCVuQvMjmB",vIqCCEVfN:8982,eoilI:"YurtBMXnDXFSpAOawBqAxycMC",aaHBJssI:{},VJzZxDBEt:54408,hjtvJA:"MQzQfKqViKCuxGoxQJFnPWdF",shyTar:{},lGQLx:"iBEGPmIdzzcczgGnuPPOZuHIuPYaZa",clbOSeI:{},gkuJ:3749,yaBJE:18895,fTimyIpFJu:"tfbzQLbyxLfPiFuQMGeo",frRXKyKNn:"DHGRDGMMYmCIbWCwXnOLydGwjAhmjQbGarddvakdVCiIpAfZhdqpAoHsKxJy",auZwZSbg:84601,MTAUbd:{},YZKM:79368,tMOYBnwUKF:54296,wEdtyM:[411,472]};return t},Object.defineProperty(t.prototype,"nUGg",{get:function(){return this._nUGg},set:function(t){this._nUGg=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hPSILFui",{get:function(){return this._hPSILFui},set:function(t){this._hPSILFui=t},enumerable:!0,configurable:!0}),t.prototype.WpzWYMAA=function(){var t={xtUWkEEX:69905,UDGj:"cgBHwIQKpPRTWmrgqJHIhjMLQjVSIFmnbBalEpPDePzlnsZPMCtp",ipOpm:"YVjPwmoAKcSyDMqmUqGksXxDFemxikZqkYZSZJ",zUYQq:{},wXSSXtatwc:{},nNDa:"rZDFolExatDauYVHeoCqfiNxSxGWsbuGZrcUJZssUyZb",SOGCKUVNoK:"JLJOAWglSeDgCkaJCLmYLmnmEekkoLqDqsiQmd",xcZiW:"mdNjJMSddTQFbQMzMJBOdjsPJfEKrzmEH",jetkG:{},ZqvJZ:[586,717],gcWWFd:{},acuaw:23874,uUOeQMrr:{},ngGsFHcrQ:"bYWVAFDbbwuhVntPTVLAzcbrefZc",QnahInuwdJ:{},MYwhj:30551,UeJOSAiuV:{},LEPVQO:{},jMrluTLuV:96523,BiKwupDCcI:"GybFQMJyyRFSUJLSFCIXaHjLPSBoJXgdWVvWnPmdZKt",BMWnKIb:"rmrmyEFFrbRMAxkRgtSibSjRJdLDgVzKNHFYDIMIfMpFHtf",vQETsshLA:{},zaSoD:{},OMezhx:"SZjyephULbIlUoOEuNCtxqsXdnzDxbFrQkWKhkR",aZJAWUAuXQ:"IVjmwGwVXdAfLMzNvZbXi",yDBoB:"LuEAeSIgOeXacVHPoalokVIiAFtiFiyVuO",mkqBdEqY:94991};return t},Object.defineProperty(t.prototype,"rDUpIMOMoW",{get:function(){return this._rDUpIMOMoW},set:function(t){this._rDUpIMOMoW=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"NjSs",{get:function(){return this._NjSs},set:function(t){this._NjSs=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"KPOqOoNaY",{get:function(){return this._KPOqOoNaY},set:function(t){this._KPOqOoNaY=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pZaTbvKD",{get:function(){return this._pZaTbvKD},set:function(t){this._pZaTbvKD=t},enumerable:!0,configurable:!0}),t.prototype.yDpHjYGQ=function(){var t={tTmG:"wDwcoKHNpLBobNvzxZOfwuratyWrlqDw",XyEUUSA:"vNMuvOUIyPRLxcAuBOUCPIzuoR",LaWG:{},NmLhpWK:"sZjFIjhrHtzEPeXWccXKoSYuVrejbSUCzwnkqDNZvbgVzOt",VsnBR:"HQLFxZmeqVxOjqbtzRsdNCEBSvVxfyvirvRtA",ZQyvQjEY:[515,669],jFXUvRKf:75660,XffCXwbEIH:{},ZACdq:"VHjqVieYYWuAvYESPkNseIIWIdQRhiOQTZrEAKrIDffpHdudEDrWquEskou",vFSQ:{},oHmPdqJIbm:"pJEWmhTosxqmcyGLMpzPWxaroIIFtgACRXiBkBJInfiPBOKwFjjLufSic",lfpXlJcen:{},PAFAsdvfy:{},MUFTSkh:19076,pppnOti:{},AAFbWgDs:60659,hrgtQDmWc:"WvyrxpbdSdfnCXPIgnQLmTYrTNWKAjPOLsCKlL",uZOsEw:[645,703],EhvAU:"YfbEasaGPcPnWXXKTMXlweRTWUvYLcH"};return t},t.prototype.bqTqemxwd=function(){var t={eSWGnhUT:"LWUqIqcDpVvxwULmkQxtyUlVaYRGEnrxOaFNjxgzP",EWTAwcAwZ:67844,NDJKWu:74080,lOiSp:7831,zrASmvwfmC:61167,lyTgrs:{},XRAi:{},zbipufoWx:{},ojLY:{},XDOIFamvX:"TmmolyemGfoDBIlmRZyXFOzuAIIGjscAqPl",dXZRw:62321,lsMr:{},dfcFd:{},FapoOCwb:{},CKouKpV:42664,yeiyupWNyJ:"DVfQHKGZKFINzjZccXFSyUMEUnCoVICjhYXZqFScWcCP",kXaBFyVht:[329,340],GBMD:{},cQbJvyAJ:{},zbhMNf:52544,ezNyih:"ZbyyWlpEVAXTqcLPAmQmPtJvuWUmUPEOXLwnUGOkvMhxwZfcUM",oHRaMXAO:{},dacx:"YAMCkzdMsBoxBKQRUhmqKtYhGOVFVBrsQfPGvZvmiNbWTqgxm",EehYnP:"WKRmAtZCCaJQPNBDKqgCSJWFJMTaDNqehHQczYLNjTBnx",IHvlTIx:"MJHkQwNnfdqGYxRQIkjwpeW",OtTPmoZ:18481,AUZr:"PUmwaSPLwQEmXWpEwcToBEkSKMopMTEOLQuopzlsOlkuwdocQk",iHxlKm:{},RtdgdNM:"IknTlADWTanmvSIfWwbVXzEPRWrhZtlPyGcknzPQcLjPiaBGqFbPsRIHbwhI"};return t},t.prototype.HYwaJXew=function(){var t={bluIeoQIxm:[332,401],hEBNLdqU:62723,znaTfWO:{},rBuYsPNQjN:72645,qXuHbhO:{},ajlALCdtkn:{},bVlWdgl:94553,jwlu:"UukfSZuCqNvJBXYPilAhiEmSdvTXASr",LCAlEJIjN:[728,539],aYogNFn:"RNSgSmOvpEiganrWldiBxziumabbnmMvHKeoLfGQYUKYSycozXXtzbWRS",gUtxZVgo:52517,XJlcTjGM:32117,uIFDVPDeSe:22439,uDmKnWi:23883,LbSTdkVtd:"TRytXBEaVsDObUFoyManeg",nSVR:"JmmLXfeQJVzJNvoYPmRSfHLHRqFk",UPFKV:"tZfqWqeTWfWFrLfuoDNMxKmxUntJxobEPKcEYsuhYZmfzAOGdB",gBPgWmuuK:{},GHoZd:"HfmmMhtrerVhaimMqdDI",rNsvqGf:"SrpTBHJUiuDywCFhDWzfIxBeSAFiqXZLAAs",tvkag:86731,IaDOemVe:75896,mJfRPuK:35636};return t},t.prototype.uHZtJrtWJ=function(){var t={SDrblpDX:94891,xkkBU:{},hcTYCaZ:"ASHzLbgOxfUUpFrkcOGNfSIVtyGdRHtNZJEgeUwElEmuiSRBCqQNu",YpssOUUxr:"QQpVbrSgSvLkPiXbXwDmP",kjAH:{},SrcDvXOX:18233,WSzs:47948,PtLQjTy:64361,vlDMT:{},yCdZr:{},CEGpDDfMLf:{},devA:{},HJxoXhU:{},jHGx:38906,nfwJQ:[694,326],cZHa:96493,ttXpHIM:"CmHqAeKvFrcKlhFAAUsYXxIcUYqXJpa",PZxuNLB:"SNnEMVzBWBOmhfVrVhIrEeDwIYGrXriKgnlaSIXjHChGYZrupUxTTKVfmLa",QyhKw:"LZOKMIhERiTvbWeHxuBEZSNZwOFTTQbPtdkLZRtYHELOliQNAXA",cLDNg:[531,760],IjoACFQ:68364};return t},t.prototype.uYucUAAU=function(){var t={OWEwWSUWAl:40465,AJUr:{},JgAhg:"wWPWFEVuSUYgaBCHZAYBoDibZEFGxIumSCmTgWNyaXyLHhnzpbelcNUghOh",MdMw:{},afhx:2728,hVAafHbWO:{},IWKQDhQQkE:11390,BAdnPxu:[460,466],hXBLJuEoE:42879,fJcfWl:[648,473],xBcM:{},YVWMxuqXQ:{},lnsBYzpg:45830,mfJtltWFP:{},UZqOoYeN:"uSBoWioMvYuoezyiLPzcyvwixuGvOZFAkNylPa",MnBtAkXQha:"dHuxXPaJRBGbBOGfVAEEeNYUQyqrvqHqNasHRQeQRARBOWZcwkan",MDtvMsWn:{},WeIlEwG:24986};return t},Object.defineProperty(t.prototype,"hzFs",{get:function(){return this._hzFs},set:function(t){this._hzFs=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"BzUFVVzHl",{get:function(){return this._BzUFVVzHl},set:function(t){this._BzUFVVzHl=t},enumerable:!0,configurable:!0}),t.prototype.TCaiIToazO=function(){var t={KaXuALInD:64572,PgTxiYof:[577,660],cvnyiYV:{},eDaW:22212,JIfGOR:92671,bhWZY:{},HlxjHlJA:"bAmSyXBqfZnnhJLfcTrJMUVXKRYeOxkzsHruUsKZLNriDOBNDV",BYOqsL:"ExgAUeQVsgmoDpzHURKFApXvyhzYoPoYhnmZiQcsHRZLXcOKBVDZo",BEjfr:36899,pKwfaf:{},VXIgUNzAI:{},GSvNvMO:{},IfqgHVBOq:64394,bGxiaa:"sRvGDohANTrzDhmPFlKDHaVnKC",ETQkaAQ:{},zMuQWKy:9764};return t},t.prototype.JWTqjPkdBp=function(){var t={OxMgHaKK:87746,kGHtwkqZ:[481,648],aiyGfcd:"gXQmiyIRFXiVCCXhaehJTNIOHOvTvtKsTaBRrTIXQu",wOsQPOspit:{},PiuacL:62910,SSKHuaHdMq:5565,VXPhX:[771,709],fxKfTvnxIX:"DcXCJYlrxjclmNXLVuYAnPwt",REqizTfaF:77543,TgEkLFLQc:41764,aaxti:1048,YbKclWOdgz:{},VJvCbPb:3311,UujdSvBz:[626,537],fnnRUaho:"uaToRPRwYOJPXniHHmGhqQziawjnUrlQJymekDlRrEfkReNqOhgSDWoq",omdU:{},lVNtaiD:{},pQFK:[755,524],lKTSZwWj:"vLENmvRuCLwuujhDitrLlBjflQXpSbQRlTOnPahQWq",hrzt:{},PINnPu:45571,ejXejc:[669,637],KzdOkqUNy:25225,LKkORRv:"CtzuFRwDLZtkdoHMxBGSnBKecBeZdTxXAGtcgweReGbVPO",uqABzpb:{},eEEqHlOXKm:"tmrHuzrQOTxIKEBUmXdSUa",xXADuK:"TIDiMSaqOYktyMUFBfdeHhHmVgUdoEHtDBqHBDTPa",sOhdZvIx:70717,MKGq:71020};return t},Object.defineProperty(t.prototype,"Ject",{get:function(){return this._Ject},set:function(t){this._Ject=t},enumerable:!0,configurable:!0}),t.prototype.gAIolxs=function(){var t={biIlITGpR:44991,ccxMrsIN:[475,742],UGJwL:"jhaehhqbpnQLncVSzWwPsYrB",hgHNMgOc:91220,NnNOCND:"XYZNZAHQanuwuLOUbdTyXCxbAkbuoTEykemuFjhj",pkAGG:"PgLLeOoMcPxaysDpDqslFEyfEkylgAWrmNCZqvqkauQvTBDOWVRJqyHnaW",ZjzNrWB:"HbvnXkbVrwNyOvMRxSeZXWhsjCkSipOyI",bxcTMubzI:{},NdQDCg:"jhUyNRUkhJYXmoxdoCBwEYdBxVgdeANdEGmjarvWZcdEveaDJvsUZUXPlfIp",kWPXVMvp:{},kkVx:91921,KXut:"awLKVYLRBVLZMfEfmlKtFudBtivllkv",PVcKvqRnx:[676,577],dTuLKeb:{},CfJFIF:{},gbFrrC:29977,hTry:"ZxSpZjhAHZVzzhMShDdQoPvraNFSdTfYiBRtxlifRjT",JgKHn:{},aAYB:77144,zRkk:40032,ZJMdtlHs:{}};return t},t.prototype.qEFktBBkw=function(){var t={NWvpCwa:{},IXCTRYiLh:"HwmelFShoqpVzlQdkjrLoDyKleCVcLNQjGKVVKOm",jsebNiDF:"jMtiApatadPDsHAuRyMCkjqlylUVwNZzb",gjCDcIEmYK:{},NXYkcmko:[418,783],FBYepPx:{},koHAf:{},bmsVt:[474,307],ANnQgkcM:{},VYysxkp:20255,VKpLq:{},XLhEigvyH:{},VrDa:"vDGsgSzKrHqZVWDQZcajBxgPlhwPH",emRrQ:"rLIObvcFhkgbLDwXIicyPJAxFEPntMqwiOByxNdKR",bKlcEqL:56230,GWdKt:5604,NAbCtCuz:{},cvqd:"UtpHTOdQKVyQUhKdVedymCBCWvw",LJNV:65765};return t},t.prototype.ewaHol=function(){var t={kFXTqI:{},wepuIfDfSt:[326,773],mwMbKmDkY:89758,IpgIQXmf:37458,mdwmG:99701,cHKAiZ:"SinLSrTHtDgJRtkYlNqZ",JcnwJ:1646,AuFB:11698,DDgRSou:"BXAdomiraIxzJWWMZLpFBwDhcmsdHafGipbMhdYdGMzSsXQ",mVDZCjSPjg:92529,qpyEZzrJdj:{},rhZEJFSDBD:44858,sWQIU:"tiwxfwyUKOyWRChfnJsOBCOaUMHihhjuIkouTkFyvjbXlPLwqTLIBq",AVXIDe:55883,yFGsg:38449,qTgrTj:"xBgtxwvJsqYbdmSqzxToHFyMtAexkyUrxijctkMxtAveIBY",pQYsNoIjL:{},vmONrQpCqE:{},xNhJymX:[404,526],QGLAwxmQml:84359,PWMMEnAXgE:75703,YWIxZJElwU:{},ASAEHdovNS:"zjKgeuzQAQiulKPWKSsezLUEn",gGVQwcOWa:93133,yYhr:"zwBWLKNvFlhtBDxjWEIPZMxroSPvfEmQLsZgTzSrEhzISF",UdUXfomMsp:49480};return t},t.prototype.geEUxQl=function(){var t={OKWdPWQjD:{},IPOdQDHIz:"nQwaQeDuyPLaqZdGQzqnJeZGhoIiofBLZCJgbypxVeGSmfhrLRrm",rUiRMhDMDp:{},GdFVXlKh:64533,CqcF:{},nMBqkTCJD:80591,MQHR:47855,qjQp:{},fCULBmLME:67053,qokmnsM:{},cIvs:"AIMIespvXGoffpzDltYRmeDRHeFklAYayTGRXMFfVnnMHYvgOUFSRZYXA",DfXiyBknDx:{},gTujyaykJy:"TRwcwvzciCmekoAsbRmZUmUdLbaaHzFek",axqnsUhg:93103,bgRsX:27143,xkOAj:"wmeEZZPRxGjUugNJojCktmcGYgqHVKwnwGHJRiINXxMDVffUoyRxuWmdin",wdAlxzfdG:{},lyZKFplSD:{},BcPVAuH:"ZUmZECAsJqwrYQzrARrAvuvmxUgxSpkKFvVEOJeyZFaexizMTrsIpiN",DTMykhDpK:"zViwPAkLIgFplYlZPOcWzJgAxlsIjYZwNycqvhbe"};return t},Object.defineProperty(t.prototype,"ptKxdNIFM",{get:function(){return this._ptKxdNIFM},set:function(t){this._ptKxdNIFM=t},enumerable:!0,configurable:!0}),t}();t.MqHzAI=e}(SOQJ||(SOQJ={})),function(t){var e=function(){function t(){}return t.prototype.FTHjNKX=function(){var t={DDKsfPng:1882,hdiKaz:{},qlZeiFK:{},ZefPRQq:[596,497],rQTKULi:{},JRzFryz:"WcGeNlWUqDreIiThJWkHNpCIdPCSpuSgLGAO",hOnP:"sTLoZwtfvCfJzVcCfvuMGrUqSesqoyQrbanJMvmdodPSazousD",VdCJwUxE:50813,CORtyCmV:"oNWATgEIYeylXobbONxsGFazNCmRRDbgSlOofxNH",STxNla:{},YAECssWF:[692,390],YWSEpoK:"UaCHgmesTJFosZjjQaBKRmMsyeOCJyvPknuqXVRRfGhuhE",NaIF:[326,548],WoufrJTI:[356,677],KvAitYR:"wYrEsVgqRotkiGVkcZdhsyTFhFKCdBFowxbkpboyJUxpLkwmaLXL",coPhtqwVlA:[732,569],TAIinHau:50592,zfOguvhuB:[779,794],PRNq:15037,hXCmF:"kOvMEkVSiBbSWuKpgTxQkuq",ECuUH:{},zIkPIP:{},geJvPi:85700,eQHNbu:"HnRfrfZrXLVjeDlxTALeIjZOvWHAvtbLUthDpLwJbqSYwWOfCXIwmvfC",MKsvwf:"eHjQcNZURIKIeWToRSLeyGimoDRJBVOFejZMkbqYlpjdw",xgZJT:{},sZgprZO:{},ImyC:{},fedZkB:{}};return t},t.prototype.NwwjfWHytO=function(){var t={JUYhXcCmPP:3921,ptifuUcF:"UKBQvpyOAnZoNJijqpjUwsxdrxHXtayHbOAeLRtWTPNMuZputfJSiK",TjSV:{},irdPfuE:{},CYaiLMQaXu:{},eVnQeHmv:[344,731],GWjabyPzwk:[689,401],lliLnw:11085,HDbv:84326,LpPhAGw:"TFEICpejGDtIjVxuuWUrEMxUvEhpvZZZVWQIIGekTQN",ZJPDRPKlc:"VEzroYYffEunUruqCzLJUXumdShwHyRDgZCxKDYRU",lmtFS:"mfgtSaADgEyIxxFROOlfJugeYxHlvRBCzqAFiG",rTprFunqN:"hzBkbOxbTLPZlCQMcRKYQHhBrMwZVVMxrqMmeybMDgwpuWAkHV",IVqUWIHGUS:55351,YsoQvCAJ:{},Qvjaty:{},pbYdcJz:{},ReOYlt:[476,628],sAYlfsy:"uBwcmXdsxbvIkqjTCOAXxNBtyoWUBMibNrfVrSUevmkRH",ODOJnWLZqm:"jmLVsafOfxoyAPyNYtHvGDOMNHbLOHCUnBLxGfmKNMSZpeHGUNQzijGbbC",dMIYUxaPJ:82930,vXUzJksO:"lONhErATbWblJkCrGYxuetnizUyDlgizUPTUktzQMDgE",eHTPo:{},jTBRUD:{},PxcgcZECPH:"GABxFxvfYdAKWlfFmgiCN",QLwIFnqOf:[515,660],FMVzj:92471,pDbFkSwF:[432,404],HsnqHFJZk:"oKvYGbuXRmyFGdmeyyiYukdLuxlpZKwresNnNPoIoFsAUMcHeTbKXOiF",Kwhx:"cRSSnlnpGqMJXJsIQDdgYFsOwpJMcPmRKGBpXxMKAAXlQxhmow"};return t},Object.defineProperty(t.prototype,"PVGf",{get:function(){return this._PVGf},set:function(t){this._PVGf=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pPDaFYP",{get:function(){return this._pPDaFYP},set:function(t){this._pPDaFYP=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"LEiIds",{get:function(){return this._LEiIds},set:function(t){this._LEiIds=t},enumerable:!0,configurable:!0}),t.prototype.vxGL=function(){var t={hKsfAvbT:"MliWPUgcVsUOlwkVdqrBzmVHd",jhwH:[393,697],OYORX:{},XJEugX:{},KekDLAkFNg:{},tUCg:83576,mQtvBCGsms:{},PSpueBml:"UfefntGmiNzVnUeriZqbVHbkMgFqLLgBklfPbxhhbJYlAaB",qoNCrc:"rEaRNFVUCAOKoPKoPgfKYbcqRDNBoRKNCmgMwaLjQLxImTKsPDn",yihWk:{},fUJNk:{},iOURuFfna:{},IqeuTyGfZc:44332,bBJB:"joOGYvdLKMRVnOEktTBvWRoTpiRfPJteEYyHRHVpLriLfhKQQMeO",ycmaAcXLh:"CMTQvhqHSkvBOQiWvbdFwJQOe",GbTH:"PSlbSMllXLbMswgSqleyYihPehXThxHricnyWO",kxjvpPxBu:{},nDSYVD:78401,bvpjR:99248,uCmV:"YMdWvDIpUrBdwJJQrHATTUGSlluDhlSHgtaCMdnuqfpZwVqsplTrNomQu",awgSYPSD:"bEqqQljqYeLiTgdVwdqpoGfOQar",IREOUnu:"QBhxYhtRxaNHBCniOuEWBnsZVGIzxMZclTTYFZyPyELEkChDSDjgvEZCCzw",VZETM:94124,lFSuoP:[581,654],yhVGUnCpRd:55130,QbmkKvYFZ:69059,zhgtwdN:70310,WfcMByy:{},xXAZwhqAyV:5810};return t},Object.defineProperty(t.prototype,"tWdzO",{get:function(){return this._tWdzO},set:function(t){this._tWdzO=t},enumerable:!0,configurable:!0}),t.prototype.fSeMK=function(){var t={CePMSrG:"DChoQjqfuLcWtsbfzcafvsqQqDcBZilrVhHrtzlBvhTixk",upvthVbGRK:{},ZZnckdLlq:{},qkwoO:{},mfwzs:"IpXfrshrsuRDYOORwqPUgECIBNodqCtXdNhMXkvSCzCcjEiv",fLtiGusA:{},PMYtWuGHgc:{},xZdFvdw:58393,UtTxcn:"RgGyJhrTifnHAgQFKpfBnt",SGtUuEvoc:{},vFLWCBJ:{},fnaIf:[791,736],ZjLdas:"pZZLKauufpPRjDjkoDAGKPoOysLgLmAGaQmJwpdTYPrepSyTMOiGHlqjc",VEHSI:2864,LadgmX:"RvOsfmGOnSkyenWxmIkdVWzEgtyNDsuuWKnd",vMypkeZtQF:[679,697],nMzPJH:[528,618],LReMdDxBt:{},ZsCsilgza:{},QjEex:{},qIid:{},RALPf:{}};return t},t.prototype.RXOKoP=function(){var t={MQNd:"XnxCZzbJZaKEkaAYDpvLQLycOcMYaGOLr",fsfRLjKhpD:47646,WhtT:{},byFcPB:{},gqGqxlWiR:22699,dhZejdcG:{},nNQm:7601,GeFC:27696,gBaAcKqA:{},kKrrePIaR:{},VlZA:"pIZJyWbTGykhJdfkqbmedOVrvDdRaNsC",LfrcEwbnuY:"sLcKTrPwVVLuWZUIyhkgNNuUgftzGCPSksyhSEGRUuZNsFdmOJTJMtX",ROCw:[776,614],tEfOVO:"BWMlXYBmbInvbMbpJpsCWepoTfHhgzfrTKFJzHITgrQMSnbYBHrbeVRDt",xZfq:"TuxCFsUJTUMJclNgYQbdloCM"};return t},t.prototype.GBjwgFjnR=function(){var t={ZQnuyKmzD:{},DpsIQucvE:{},baHPWABQuk:"vwItsRQxBYEADhsMlKiioObPlaFPwrFFtTDSVyYGKzfucfnXYloCjSt",oLNeojgD:[462,366],SExX:{},ymcCvA:62581,lEJPKhO:71437,GSTc:98874,bAnUtYr:"knoGongUzsXTqCDZjUWeKMoqlff",gVVGh:"IxYLEfvqtBjBbOFPoDZvcVgsRnImPFMOgswQwCcyHRknatoPHs",KiCJ:16605,jagHXJlGY:"AvvwfBRSRjSKlRiLHaidtd",zwGUA:98061,AaTO:"GKdUCPEZLLAtCTVfOYQIoERUmVawzYI",tWKKidLFc:2972,wGNhDaq:{},bxgb:[651,416],ECegkAj:[500,660],YslbrxQa:"ADSndtxNjOIXHsiOBLHGEbmKHatZBoudeuWkrplveeIdew"};return t},Object.defineProperty(t.prototype,"gVfCt",{get:function(){return this._gVfCt},set:function(t){this._gVfCt=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"XzpKeGtgyA",{get:function(){return this._XzpKeGtgyA},set:function(t){this._XzpKeGtgyA=t},enumerable:!0,configurable:!0}),t.prototype.RhOlmLVrM=function(){var t={mcZTiJKH:{},tMLvNqTR:13635,MggPR:[620,548],IFtqwpRdAj:"gfLZitCMtLrNEiTfYQaxyhwywQxJdIVYNkEAMeOarrr",uaOhGr:{},aijD:"jJdBGwvKspRBkUPLSKivvgrOMIQVJaWaZULZIRaQdDFcPwZAaUbSshU",yjUKbAxkP:58547,NjnWTbQOU:84054,jEXkIjT:[534,580],ZGxbgGu:{},qvadjRLcDj:{},yWBkA:86163,XyQJBPW:"xyBvkzVQSmBjfDiZjbmoaXZxQA",BkuZVw:{},MTKod:79343,osIHsCP:47595,FMRpF:"HwWgPJTGYhlBfiYavIsGMdcVBeRDnIWkFdmdvvVzZ",CmrVcYV:[616,360],SaiAglsSM:[731,715],SGoZyZZLV:69107,ytkjd:{},qHqIfPXq:"EBnrMixWAUuKhMGzedPErrUvBtAUVNITXPjC",XfZdTPmBIU:{},ftbQ:"GyqkFNICFVKOCZgsXuzLSphIqnYLXifHIbJdjbjWVVvqmNTfwvTpwrDr",PiHCo:"ZgisvhLylrYaYMGcwamSggkxvotKjgLUXmizMEoRUFLbZNHNLJksa",eFfC:"AENNSrjhelMOTIztJAhTtoaYrUBokiZhFzAYbCCzKgTSavMYcYE"};return t},t.prototype.lFIAQBw=function(){var t={rUgxJdABxH:"yRsCawyqpaAIGagmyXgAoOpeLrwZKnnJcnGsLxBkJrXMjsY",LpNMbfq:62934,IjWx:84589,oSUnICOzcQ:{},bDuOVUlxRJ:[786,343],vnOd:"LfnNDwmoipvpvcNDcBJdGmrPrwjNhOSSfizAsbcKsJUkBQNlOB",oeORAjKY:"XkVhIDpoNixWxKVyZGNrAVyMJjpSFMsaeNzYhvBtamODLuYk",doFhw:{},GIKneGhIk:[477,766],JkIcuuf:{},UtohF:"PZfKQdMJPgNYxVdqQtPYJSfXgXyYgfHvmtaRPiIEnOVWYFbNIQQuVoVT",SIxpPY:65092,asDkyJhVvK:28727,BtbyQU:"ZPZWzWBITNRHHrrZUZLuldyFgzTaxEMrVTWLOSRjTAXMAnxYbaZRTpqp",SJrAClid:{},QPFQHArdQy:"kQnmARkorhPBwTDUYOGHtpeKdBsXbTfLFLMeEeywsZU",wqnYN:{},hcxQNW:"HefjaiXFNoTjKoZxiuhvkirYOoXBFbWZZMbzlzJfHctGGKDtkyOjm",gOKvyuUtf:32802,xdPIuW:"gMqPgAJYUcgsgKTmDaNHuBPpUKDkDmtjULqWFXcvCMtxYapJlBiRBlnrRd",FnUovWC:"jcZgyqTIwwGuLYtuUUHukOPotHrIiSwfMEtQQoPynLiBl",fHVPGky:"skgOuRjHyltsGppoHBaSknBzhnbuNMwbCXPlNxaGKJ",UzwozUb:{},plzqCsn:[304,580],kwRqRO:{},MJYmD:{}};return t},Object.defineProperty(t.prototype,"MbLDQi",{get:function(){return this._MbLDQi},set:function(t){this._MbLDQi=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pwLh",{get:function(){return this._pwLh},set:function(t){this._pwLh=t},enumerable:!0,configurable:!0}),t.prototype.iJbsqnHUR=function(){var t={ynue:"EMdGYJpVGqiSmQMgQbNcagczlERtJQwhfQgstxx",VkOXWCGIx:{},UCffumsUD:43054,wEBOSir:{},PhAQKwcd:"rHeAOEyUvyQpsFmgfWMrvUIhmiyoUspoCJtCYTIHmzAxErRLHErMaJXbggH",wzvbQt:34911,zEJWn:"tQyvRReaVpTvLUpiHiwXwfhb",ELhGc:{},BSbnvX:1691,yNxFmHS:97556,jCWgIHkq:"qZPcwxCPKbCoqtNYPacjQbxuFpNYYoUvrxfXMiWPjIisK",ojkzDi:"lNxhFZktBApneEoQcPWCxtXQSKVGCUEfuJAXGQRcWdLYPdHmL",VcKpOD:"EduSqjXDCIbVdrNcQEoUTKMsrlOwNSVXrcPrtDMaebymoLWKkpeyTF",GAEZudll:"fashMCOSmFqOPzRMSKfkWQXCtNxJqLkvzDMnUXQyjnctyVmeRul",oJnOoYyLY:{},ZtQet:{},QxydswY:90435,SBjwap:67028,RuavlV:{},TLEtI:66164,GHedrMvKvZ:"OAMhqhtvbwqLlyeqnSnQzATXmpOE",CkePlfDa:"AKReqylDIxzCfaSxtLiEXHHRIvXwbFBMPEkFyPosDrKkFxptIddKQcBowqFn",hihNBzg:{},DzaOwLon:{},mFnqrWJAT:"HkfYYOjvNKaYxvNAbMDaBHBxRGtvVbeaHHihMFvdhfRPEyZlKVDJCQQOzEP",pBxweTuBFl:{},IuOGpA:29195,veiCNROU:"uBNeqvsDUvNgWZigjPUyFVSugiyBiFnsSQvZoexeQtvUX"};return t},t.prototype.korV=function(){var t={rMITMPojfB:{},alANgQwbVJ:85235,WNWrsp:74887,nwOlrVHHm:57662,HKZwoF:"efycTTirmkaAlXiHWADOezyNHIiczIhjGHtoCDIyeCdERjpqFzQw",bseTQ:"BNGWcoLebghXOyVyGLNiCEekaToBRFuyhZeZphty",hNbmXByQCd:{},LAqPgL:[440,417],heRAS:"xknWwijSnJwNZYhvcmAINgOHQLvizH",VqiLZ:{},unqxDy:{},uTeeBpu:{},SEJSeoRL:{},NDamu:[611,306],aMdwvOo:{},PnFVoECxMO:{},svUa:[788,361],npilWAptAc:"OuzgVxGCtdewPEUxNrqnuoJzqTWnvXemrlvgYkaZbwf",GWlsdFLUz:37011,ofkrajh:"qccNYKwufZAmfpYhIXZkohPTAQJwGIiqwjGfCMkXYrSRqLBaERsRDaQaG",jvTiP:[648,725],uDatTUGXCt:"brNsUWujhqhbTtXWLijosOFLXcuwtDqF",Fpvnf:{},ETqkAOW:{},xzpGnEJUHQ:[437,400],izncavaRFn:{},sfdSCdUR:{},eUwmbbMDvr:"RJZLvCMbffuZrHRSyUOAuunfuRQWrdJLexEc",GanWxjHQQ:{},sKrPNxjaw:{}};return t},Object.defineProperty(t.prototype,"XmIrHkGpDb",{get:function(){return this._XmIrHkGpDb},set:function(t){this._XmIrHkGpDb=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"XXryCstqcm",{get:function(){return this._XXryCstqcm},set:function(t){this._XXryCstqcm=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"RIQcE",{get:function(){return this._RIQcE},set:function(t){this._RIQcE=t},enumerable:!0,configurable:!0}),t.prototype.YNVB=function(){var t={LzGCaeVvM:{},OyHNP:50308,sVUxXR:{},socN:22629,pOZUBmvB:[383,570],seGonFTBjr:57315,XoWnzXEZ:28010,wHUxyVQi:52607,NeorGdpmV:{},pKQxR:{},sefm:[308,608],jqHshaak:56659,txZzvA:36174,KXJljxsMv:"cxDlHTraZITFVBeJaLFtmrDgrceNBbktcObc",oQpbSJbOVP:78437};return t},t.prototype.XSoPnkYQV=function(){var t={fyYPx:"BbucrQIbxLZzoNecJOSGNA",rLgqsy:"ZMqhzEirYwPPyEBwoQbFCYyiFoE",IHCFrh:[499,409],YqCGjT:{},pxcUXkaKXA:45927,pmlzIRz:"ukCypZbSCCNiCAKmKFdLjSxaPWj",UHZkqqDk:{},YOfy:{},xgcDFTey:"oRMwJNjDsUKQyoKQZPBVFIcVBwQwyossCanqbzM",itsgjZ:49646,BmvZc:{},DTvjQJ:{},koRGZXvM:"ecWSHPOQahfKwGpNGItbQrrFZBEqWhvaiEBAECjyaz",vbkjNct:[508,750],QnklirDfeG:{},BCDqY:{},RYBvsXqq:{},LDqMzNPI:81522,dJiDVr:{},hghr:{},bsVBPp:53348,enyTTIPn:63925,hYQSyfT:{},hbtdZ:"lcEMfjpzRGcAuFevlZZleASEVVxdspbwqEfeAotcHEHXkXphihyRU",eoBVGHBJPl:"OcycujIRJkBXGvchXGjrcaWrqsUkFMqDKrMcXhoNOCrRzCbGXbAKX",boBxs:22584};return t},Object.defineProperty(t.prototype,"ipjWGHQgV",{get:function(){return this._ipjWGHQgV},set:function(t){this._ipjWGHQgV=t},enumerable:!0,configurable:!0}),t.prototype.DzqJ=function(){var t={QZkMKrf:{},HybYgxEybt:"dbdGPPQhnFCDtuHwVsvQMAaenCU",paDBErAio:{},dhJaDy:"WybWmqtABjyWKbjXxlcGZziSiaMZrbFumbvQsYRBuGnKS",HPhRvgIZx:53444,ZTdy:{},rqsCgHA:80162,XdcSOiQWVq:57097,MgEGF:28745,LvUmXcqtJ:17535,LRVC:{},lQBkAxmSrw:"FTsdwiBqwgVsZMGYRDLzgJnKoSPfNECYZWyL",hCAQmdV:34528,NZEZG:"pGSnJKNRKSCzMUcVDsGzXcuUKBpFuQPjFCOUMpjhSQHFFymVoih",qSjhvhXW:"foQoCBDyTjlEhyMNdQkhafjkQIasVwquRkXlWuCZBUeuiAju",RJmJ:79247,RTSKjrX:91154,ZxBWzR:5961,OiyijqgrX:{}};return t},Object.defineProperty(t.prototype,"LoHzZJJkNs",{get:function(){return this._LoHzZJJkNs},set:function(t){this._LoHzZJJkNs=t},enumerable:!0,configurable:!0}),t.prototype.VsZbSfRup=function(){var t={xHxc:{},EhAkadm:"fWhyoMbKHMcpUjPKxiMzuGsvCTzbzQJrJghDkAGabfC",OqEyhOOo:{},YTWHizFT:"SUHJVSgzUYuskEZDCkuRERHSSYD",YFVqklwg:64925,CdhloIfdj:81881,KBPxNB:{},mtsxMzVFT:[652,633],NYpHvhEE:{},bmMssu:{},PlvkNnpj:37002,RjDtgJq:{},IKFiQTxe:{},PdRc:41661,dhzQQcXaq:{},bvLdNpmZgW:[642,753],ikUFdY:58671,scAj:91900,DPZwlu:79942,cvUeQ:{},GRyaEwPd:"HGpKgZgyIVvmNEulByJfTuhxlUouQuiRaJtqNOJfZUcUNBVYIEUYm",InYxKNkqTZ:{},uqYFohvxC:{},oFDsctspw:{},zLoDGOsMAo:"jJWNRkoAwzMWSRePXZmiFndhwnVcTlW",dOkHDUu:46849};return t},Object.defineProperty(t.prototype,"xupdNHL",{get:function(){return this._xupdNHL},set:function(t){this._xupdNHL=t},enumerable:!0,configurable:!0}),t.prototype.GZqZZiPS=function(){var t={pNcONMx:{},OLeYzIAOG:{},HsBMWlDWGj:70787,yGzkvGx:{},MveoynU:"gpuHQxvgyfgzTOIqpVrucPfxSaETYvIZPL",WbKVcX:84776,oqOUdQXbvU:"WnOLtoAwnVItRHBrjbHwuXqNszjXDqpxbIoEhrDFPoLRtNlOwGxXuXGgm",SjXbnIOSff:"bcRJHmhcmJWZjnciojgPHXXHGHFmLZFOiUCEXeSIHJIj",DFOsESCbY:"kXDBAgWNahbMidHnDylqiEdaxzJ",qqeg:{},GGtiqeLZbG:33491,CNdNyqwEYy:{},wBAl:{},SyJkWLcVCo:"NneRTSCBqGNSjbzqQEAxRCuKitLPBd",pPMZz:38492,WnAyqpr:{}};return t},t.prototype.grLFIlJ=function(){var t={hUQngb:93347,IDZiZ:{},Nbuq:{},kdiBEpPJ:"SDKPabTKNtvnvdXKVvuZogKUTdRNzBNuKfWsFzWSmdfsf",SDAERCow:82628,pzQI:21415,RfHB:{},LaEMIhiZc:{},WOEqrXtY:{},mOtSU:{},fVAYeWS:93879,zxgSMIKvy:"UGIifNZLjozeAUCkozdOnLqbrFuhQIlgajCwuxFxGkpGSwyoAYh",cVubVt:"zgQxBVKSZchDspKEDkMQQAeHEveNccQvQRluVLErgAkQHpYSYXMiPCxgZijN",pxUzOkHiwV:{},IBkicdV:12883};return t},t}();t.yysXXNA=e}(qkMRu||(qkMRu={})),function(t){var o,e;o=t.data||(t.data={}),e=function(){function t(){this._list=[]}return t.prototype.load=function(t,e){this.clear();var i=!0;if(t)for(var n=0,r=t;n<r.length;n++){var a=r[n],s=o.RefAsset.Get(a);s.retain(),this._list.push(s),s.parseComplete||(i=!1,s.once(LEvent.COMPLETE,this,this.onAssetParseComplete))}i?e.run():this._handler=e},t.prototype.onAssetParseComplete=function(){if(this._handler){for(var t=!0,e=0,i=this._list;e<i.length;e++){if(!i[e].parseComplete){t=!1;break}}t&&(this._handler.run(),this._handler=null)}},t.prototype.clear=function(){for(var t=0,e=this._list;t<e.length;t++){e[t].release()}this._list.length=0},t}(),o.AssetsLoader=e}(dou||(dou={}));var Endian=function(){};Endian.LITTLE_ENDIAN="littleEndian",Endian.BIG_ENDIAN="bigEndian";var ByteArray=function(){function n(t){this.BUFFER_EXT_SIZE=0,this.optcode=0,this.EOF_byte=-1,this.EOF_code_point=-1,this._setArrayBuffer(t||new ArrayBuffer(this.BUFFER_EXT_SIZE)),this.endian=Endian.LITTLE_ENDIAN}return n.prototype._setArrayBuffer=function(t){this.write_position=t.byteLength,this.data=new DataView(t),this._position=0},n.prototype.setdata=function(t){t instanceof n?this._setArrayBuffer(t.buffer):t instanceof ArrayBuffer&&this._setArrayBuffer(t)},Object.defineProperty(n.prototype,"buffer",{get:function(){return this.data.buffer},set:function(t){this.data=new DataView(t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dataView",{get:function(){return this.data},set:function(t){this.data=t,this.write_position=t.byteLength},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bufferOffset",{get:function(){return this.data.byteOffset},enumerable:!0,configurable:!0}),n.prototype.getByte=function(t){return this.data.getUint8(t)},n.prototype.setByte=function(t,e){this.data.setUint8(t,e)},Object.defineProperty(n.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this.write_position=t>this.write_position?t:this.write_position},enumerable:!0,configurable:!0}),n.prototype.reset=function(){this.clear()},Object.defineProperty(n.prototype,"length",{get:function(){return this.write_position},set:function(t){this.validateBuffer(t,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bytesAvailable",{get:function(){return this.data.byteLength-this._position},enumerable:!0,configurable:!0}),n.prototype.clear=function(){this._setArrayBuffer(new ArrayBuffer(this.BUFFER_EXT_SIZE))},n.prototype.readBoolean=function(){return 0!=this.data.getUint8(this.position++)},n.prototype.readByte=function(){return this.data.getInt8(this.position++)},n.prototype.readBytes=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);for(var n=0;n<i;n++)t.data.setUint8(n+e,this.data.getUint8(this.position++))},n.prototype.readDouble=function(){var t=this.data.getFloat64(this.position,this.endian==Endian.LITTLE_ENDIAN);return this.position+=n.SIZE_OF_FLOAT64,t},n.prototype.readFloat=function(){var t=this.data.getFloat32(this.position,this.endian==Endian.LITTLE_ENDIAN);return this.position+=n.SIZE_OF_FLOAT32,t},n.prototype.readInt=function(){var t=this.data.getInt32(this.position,this.endian==Endian.LITTLE_ENDIAN);return this.position+=n.SIZE_OF_INT32,t},n.prototype.readInt32=function(){return this.readInt()},n.prototype.getInt32=function(t){return this.data.getInt32(4*t,this.endian==Endian.LITTLE_ENDIAN)},n.prototype.readShort=function(){var t=this.data.getInt16(this.position,this.endian==Endian.LITTLE_ENDIAN);return this.position+=n.SIZE_OF_INT16,t},n.prototype.readInt16=function(){return this.readShort()},n.prototype.readFloatTwoByte=function(t){return this.readShort()/t},n.prototype.readFloatOneByte=function(){return(this.readByte()+128)/256},n.prototype.readUnsignedByte=function(){return this.data.getUint8(this.position++)},n.prototype.readUint8=function(){return this.readUnsignedByte()},n.prototype.readInt8=function(){return this.readByte()},n.prototype.readUnsignedInt=function(){var t=this.data.getUint32(this.position,this.endian==Endian.LITTLE_ENDIAN);return this.position+=n.SIZE_OF_UINT32,t},n.prototype.readUint32=function(){return this.readUnsignedInt()},n.prototype.readUint64=function(){return this.readDouble()},n.prototype.readUnsignedShort=function(){var t=this.data.getUint16(this.position,this.endian==Endian.LITTLE_ENDIAN);return this.position+=n.SIZE_OF_UINT16,t},n.prototype.readUint16=function(){return this.readUnsignedShort()},n.prototype.readUTF=function(){var t=this.data.getUint16(this.position,this.endian==Endian.LITTLE_ENDIAN);return this.position+=n.SIZE_OF_UINT16,0<t?this.readUTFBytes(t):""},n.prototype.readString=function(){return this.readUTF()},n.prototype.readUTFBytes=function(t){var e=new Uint8Array(this.buffer,this.bufferOffset+this.position,t);return this.position+=t,this.decodeUTF8(e)},n.prototype.readStringByLen=function(t){return this.readUTFBytes(t)},n.prototype.writeBoolean=function(t){this.validateBuffer(n.SIZE_OF_BOOLEAN),this.data.setUint8(this.position++,t?1:0)},n.prototype.writeByte=function(t){this.validateBuffer(n.SIZE_OF_INT8),this.data.setInt8(this.position++,t)},n.prototype.writeUint8=function(t){this.writeByte(t)},n.prototype.writeInt8=function(t){this.writeByte(t)},n.prototype.writeBytes=function(t,e,i){var n;if(void 0===e&&(e=0),void 0===i&&(i=0),!(e<0)&&!(i<0)&&0<(n=0==i?t.length-e:Math.min(t.length-e,i))){this.validateBuffer(n);for(var r=new DataView(t.buffer),a=e;a<n+e;a++)this.data.setUint8(this.position++,r.getUint8(a))}},n.prototype.writeDouble=function(t){this.validateBuffer(n.SIZE_OF_FLOAT64),this.data.setFloat64(this.position,t,this.endian==Endian.LITTLE_ENDIAN),this.position+=n.SIZE_OF_FLOAT64},n.prototype.writeFloat=function(t){this.validateBuffer(n.SIZE_OF_FLOAT32),this.data.setFloat32(this.position,t,this.endian==Endian.LITTLE_ENDIAN),this.position+=n.SIZE_OF_FLOAT32},n.prototype.writeInt=function(t){this.validateBuffer(n.SIZE_OF_INT32),this.data.setInt32(this.position,t,this.endian==Endian.LITTLE_ENDIAN),this.position+=n.SIZE_OF_INT32},n.prototype.writeInt32=function(t){this.writeInt(t)},n.prototype.setInt32=function(t,e){this.data.setInt32(4*t,e,this.endian==Endian.LITTLE_ENDIAN)},n.prototype.writeUnsignedShort=function(t){this.validateBuffer(n.SIZE_OF_INT16),this.data.setInt16(this.position,t,this.endian==Endian.LITTLE_ENDIAN),this.position+=n.SIZE_OF_INT16},n.prototype.writeUint16=function(t){this.writeUnsignedShort(t)},n.prototype.writeUint64=function(t){this.validateBuffer(n.SIZE_OF_FLOAT64),this.data.setFloat64(this.position,t,this.endian==Endian.LITTLE_ENDIAN),this.position+=n.SIZE_OF_FLOAT64},n.prototype.writeShort=function(t){this.validateBuffer(n.SIZE_OF_INT16),this.data.setUint16(this.position,t,this.endian==Endian.LITTLE_ENDIAN),this.position+=n.SIZE_OF_INT16},n.prototype.writeInt16=function(t){this.writeShort(t)},n.prototype.writeUnsignedInt=function(t){this.validateBuffer(n.SIZE_OF_UINT32),this.data.setUint32(this.position,t,this.endian==Endian.LITTLE_ENDIAN),this.position+=n.SIZE_OF_UINT32},n.prototype.writeUint32=function(t){this.writeUnsignedInt(t)},n.prototype.writeUTF=function(t){var e=this.encodeUTF8(t),i=e.length;this.validateBuffer(n.SIZE_OF_UINT16+i),this.data.setUint16(this.position,i,this.endian===Endian.LITTLE_ENDIAN),this.position+=n.SIZE_OF_UINT16,this._writeUint8Array(e,!1)},n.prototype.writeString=function(t){var e=new n;e.writeUTFBytes(t),this.writeUint16(e.length+1),this.writeBytes(e,0,e.length),this.writeByte(0)},n.prototype.writeStringByLen=function(t,e){var i=this.position;this.writeUTFBytes(t),this.position=i+e,this.length=this.position+1},n.prototype.writeUTFBytes=function(t){this._writeUint8Array(this.encodeUTF8(t))},n.prototype.toString=function(){return"[ByteArray] length:"+this.length+", bytesAvailable:"+this.bytesAvailable},n.prototype._writeUint8Array=function(t,e){void 0===e&&(e=!0),e&&this.validateBuffer(this.position+t.length);for(var i=0;i<t.length;i++)this.data.setUint8(this.position++,t[i])},n.prototype.validate=function(t){if(0<this.data.byteLength&&this._position+t<=this.data.byteLength)return!0},n.prototype.validateBuffer=function(t,e){if(void 0===e&&(e=!1),this.write_position=t>this.write_position?t:this.write_position,t+=this._position,this.data.byteLength<t||e){var i=new Uint8Array(new ArrayBuffer(t+this.BUFFER_EXT_SIZE)),n=Math.min(this.data.buffer.byteLength,t+this.BUFFER_EXT_SIZE);i.set(new Uint8Array(this.data.buffer,0,n)),this.buffer=i.buffer}},n.prototype.encodeUTF8=function(t){for(var e=0,i=this.stringToCodePoints(t),n=[];i.length>e;){var r=i[e++];if(this.inRange(r,55296,57343))this.encoderError(r);else if(this.inRange(r,0,127))n.push(r);else{var a,s;for(this.inRange(r,128,2047)?(a=1,s=192):this.inRange(r,2048,65535)?(a=2,s=224):this.inRange(r,65536,1114111)&&(a=3,s=240),n.push(this.div(r,Math.pow(64,a))+s);0<a;){var o=this.div(r,Math.pow(64,a-1));n.push(128+o%64),a-=1}}}return new Uint8Array(n)},n.prototype.decodeUTF8=function(t){for(var e,i=0,n="",r=0,a=0,s=0,o=0;t.length>i;){var l=t[i++];if(l===this.EOF_byte)e=0!==a?this.decoderError(!1):this.EOF_code_point;else if(0===a)e=this.inRange(l,0,127)?l:(this.inRange(l,194,223)?(a=1,o=128,r=l-192):this.inRange(l,224,239)?(a=2,o=2048,r=l-224):this.inRange(l,240,244)?(a=3,o=65536,r=l-240):this.decoderError(!1),r*=Math.pow(64,a),null);else if(this.inRange(l,128,191))if(s+=1,r+=(l-128)*Math.pow(64,a-s),s!==a)e=null;else{var h=r,u=o;o=s=a=r=0,e=this.inRange(h,u,1114111)&&!this.inRange(h,55296,57343)?h:this.decoderError(!1,l)}else o=s=a=r=0,i--,e=this.decoderError(!1,l);null!==e&&e!==this.EOF_code_point&&(e<=65535?0<e&&(n+=String.fromCharCode(e)):(e-=65536,n+=String.fromCharCode(55296+(e>>10&1023)),n+=String.fromCharCode(56320+(1023&e))))}return n},n.prototype.encoderError=function(t){},n.prototype.decoderError=function(t,e){return e||65533},n.prototype.inRange=function(t,e,i){return e<=t&&t<=i},n.prototype.div=function(t,e){return Math.floor(t/e)},n.prototype.stringToCodePoints=function(t){for(var e=[],i=0,n=t.length;i<t.length;){var r=t.charCodeAt(i);if(this.inRange(r,55296,57343))if(this.inRange(r,56320,57343))e.push(65533);else if(i===n-1)e.push(65533);else{var a=t.charCodeAt(i+1);if(this.inRange(a,56320,57343)){var s=1023&r,o=1023&a;i+=1,e.push(65536+(s<<10)+o)}else e.push(65533)}else e.push(r);i+=1}return e},Object.defineProperty(n.prototype,"stringValue",{get:function(){var t=[],e=this.length,i=0,n=this.position;for(this.position=i;i<e;)t[i]=this.readByte(),i++;return this.position=n,t.join(",")},set:function(t){this.clear();for(var e=t.split(","),i=e.length,n=0;n<i;)this.writeByte(Number(e[n])),n++;this.position=0},enumerable:!0,configurable:!0}),n.prototype.compress=function(t){void 0===t&&(t="zlib");var e=new Uint8Array(this.buffer),i=new Zlib.Deflate(e).compress();this.buffer=i.buffer,this.position=this.write_position=0,this.length=i.byteLength},n.prototype.uncompress=function(t){void 0===t&&(t="zlib");var e=new Uint8Array(this.buffer),i=new Zlib.Inflate(e).decompress();this.buffer=i.buffer,this.position=this.write_position=0,this.length=i.byteLength},n}();ByteArray.SIZE_OF_BOOLEAN=1,ByteArray.SIZE_OF_INT8=1,ByteArray.SIZE_OF_INT16=2,ByteArray.SIZE_OF_INT32=4,ByteArray.SIZE_OF_UINT8=1,ByteArray.SIZE_OF_UINT16=2,ByteArray.SIZE_OF_UINT32=4,ByteArray.SIZE_OF_FLOAT32=4,ByteArray.SIZE_OF_FLOAT64=8;var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e=function(n){function t(t,e){var i=n.call(this)||this;return i._isShow=!1,i._app=t,i._url=e,i.mouseEnabled=!0,i}return __extends(t,n),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),t.prototype.resize=function(t,e){this.size(t,e),this._scene&&this._scene.size(t,e)},t.prototype.enterScene=function(){this.dispose(),Laya.loader.create([this._url],Laya.Handler.create(this,this.on3DComplete),Handler.create(this,this.onLoadProgress))},t.prototype.on3DComplete=function(){this._scene=Laya.Scene.load(this._url);this.initScene()},t.prototype.onLoadProgress=function(t){},t.prototype.initScene=function(){this._scene&&this._scene.loaded&&this._isShow&&this.addChildAt(this._scene,0)},t.prototype.show=function(){this._isShow=!0,this._scene&&this.addChildAt(this._scene,0)},t.prototype.hide=function(){this._isShow=!1,this._scene&&this._scene.removeSelf()},t.prototype.dispose=function(){this._scene&&(this._scene.destroy(!0),this._scene=null)},t}(Laya.Sprite);t.BaseScene=e}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i,n;e=t.gui||(t.gui={}),i=e.base||(e.base={}),n=function(i){function t(t){var e=i.call(this)||this;return e._dispose=!1,e._app=t,e}return __extends(t,i),Object.defineProperty(t.prototype,"app",{get:function(){return this._app},enumerable:!0,configurable:!0}),t.prototype.enter=function(){return!1},t.prototype.cancel=function(){return!1},t.prototype.resize=function(t,e){this._clientWidth=this.width=t,this._clientHeight=this.height=e},t.prototype.dispose=function(){this._dispose=!0},t}(Laya.Sprite),i.Container=n}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e=function(o){function t(t){return o.call(this,t)||this}return __extends(t,o),t.prototype.update=function(t){},t.prototype.resize=function(t,e){o.prototype.resize.call(this,t,e);var i=this._clientWidth/720,n=this._clientHeight/1280,r=Math.min(i,n),a=TeaStyle.COLOR_BLACK,s=(t-720*r)/2;this.graphics.clear(),this.graphics.drawRect(0,0,s,1280*r,a),this.graphics.drawRect(t-s,0,720*r,1280*r,a)},t}(t.gui.base.Container);t.BlackBorder=e}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},BaseConfig=function(){function t(t){this._dataClass=t}return Object.defineProperty(t.prototype,"dataSource",{set:function(t){var e,i=function(t){for(var e=t.split("|"),i=[],n=0;n<e.length;n++)i.push(Number(e[n]));return i},n=t.split("\r\n");this._keys=[],this._datas=[];for(var r=5;r<n.length;r++)n[r]&&((e=new this._dataClass).init(n[r],i),this._keys.push(e.id),this._datas.push(e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keys",{get:function(){return this._keys},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"datas",{get:function(){return this._datas},enumerable:!0,configurable:!0}),t.prototype.getTypeData=function(t){if(!this._datas)return null;var e=this._keys.indexOf(t);return-1==e?null:this._datas[e]},Object.defineProperty(t.prototype,"dataLength",{get:function(){return this._keys?this._keys.length:0},enumerable:!0,configurable:!0}),t}(),SkinConfig=function(t){function n(){return t.call(this,SkinData)||this}return __extends(n,t),n.getInstance=function(){return this._instance||(this._instance=new n),this._instance},n.init=function(t){n.getInstance().dataSource=t},n.prototype.getSkinListByType=function(t){for(var e=[],i=0;i<this.datas.length;i++)this.datas[i].type==t&&e.push(this.datas[i]);return e.sort(n.sortSkin),e},n.sortSkin=function(t,e){return t.index-e.index},n}(BaseConfig),SkinData=function(){function t(){}return t.prototype.init=function(t,e){var i=t.split(",");this.id=Number(i.shift()),this.type=Number(i.shift()),this.index=Number(i.shift()),this.name=i.shift(),this.avatar=i.shift(),this.condition=e(i.shift())},t}();SkinData.CONDITION_TYPE_ONE=1,SkinData.CONDITION_TYPE_TWO=2,SkinData.CONDITION_TYPE_THREE=3;var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var r,e;r=t.data||(t.data={}),e=function(e){function t(){var t=e.call(this)||this;return t._loadMap={},t._loadCount=0,t._totalCount=0,t}return __extends(t,e),Object.defineProperty(t.prototype,"totalCount",{get:function(){return this._totalCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loadCount",{get:function(){return this._loadCount},enumerable:!0,configurable:!0}),t.prototype.load=function(t,e){var i=this,n=this._loadMap[t];if(!n){switch(e){case r.RefAsset.GENRAL:n=r.RefAsset.Get(t);break;default:return}n.retain(),n.parseComplete?this._loadCount++:n.once(LEvent.COMPLETE,this,function(){i._loadCount++,i.event(LEvent.CHANGED)}),this._loadMap[t]=n,this._totalCount++}},t.prototype.clear=function(t,e){void 0===e&&(e=!1);var i=this._loadMap[t];i&&(i.release(),i.parseComplete&&this._loadCount--,e&&i.checkNow(),delete this._loadMap[t],this._totalCount--)},t}(Laya.EventDispatcher),r.PreLoad=e}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i;e=t.data||(t.data={}),(i=function(i){function n(t){var e=i.call(this)||this;return e._refCount=0,e._timeOut=0,e._parseComplete=!1,e._url=t,e.init(),e}return __extends(n,i),n.Get=function(t,e){void 0===e&&(e=!0);var i=this._refMap[t];return e&&!i&&(i=new n(t),this.Set(t,i)),i},n.Set=function(t,e){this._refMap[t]=e},n.update=function(t){var e=Laya.timer.currTimer;if(!(e<this._nextTimer)){this._nextTimer=e+1e3;var i=this._refMap;for(var n in i){i[n].update(e)&&delete i[n]}}},Object.defineProperty(n.prototype,"parseComplete",{get:function(){return this._parseComplete},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),n.prototype.init=function(){Laya.loader.load(this._url,Handler.create(this,this.onLoaded))},n.prototype.onLoaded=function(){this._parseComplete=!0,this.event(LEvent.COMPLETE)},n.prototype.retain=function(){this._refCount++,this._timeOut=0},n.prototype.release=function(){this._refCount<=0||(this._refCount--,0==this._refCount&&(this._timeOut=Laya.timer.currTimer+n.MAX_FREE_TIME))},n.prototype.update=function(t){var e=this._timeOut&&t>this._timeOut;return e&&this.destroy(),e},n.prototype.checkNow=function(){0==this._refCount&&(this._timeOut=Laya.timer.currTimer)},n.prototype.destroy=function(){Laya.loader.clearRes(this._url,!0),Laya.loader.cancelLoadByUrl(this._url)},n}(Laya.EventDispatcher)).GENRAL=1,i.BUFFER=2,i.TEMPLET=3,i.MAX_FREE_TIME=3e4,i._refMap={},i._nextTimer=0,e.RefAsset=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i,n;e=t.gui||(t.gui={}),i=e.base||(e.base={}),(n=function(n){function e(t){var e=n.call(this)||this;return e.setFont(t),e._stopArray=[],e._clipArray=[],e}return __extends(e,n),e.init=function(){this.PET_ZZ_FONT={source:t.Path.uiAtlas+"jiesuan.atlas",url:"jiesuan/clip_shuzi1.png",clipWidth:0,clipX:10,space:52},this.GOLD_FONT={source:t.Path.uiAtlas+"tongyong.atlas",url:"tongyong/clip_shuzi1.png",clipWidth:0,clipX:10,space:40}},e.prototype.setFont=function(t){if(this._curFont!=t&&((this._curFont=t).source&&RefAsset.Get(t.source).retain(),this._clipArray)){for(var e=0,i=this._clipArray;e<i.length;e++)i[e].destroy(!0);this._clipArray=[]}},e.prototype.setText=function(t,e,i,n,r){var a=this;void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===n&&(n=null),void 0===r&&(r=null),this._curFont||loge("Font not found!");var s=RefAsset.Get(this._curFont.source);s.parseComplete?this.onAssetParseComplete(t,e,i,n,r):s.once(LEvent.COMPLETE,this,function(t,e,i,n,r){void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===n&&(n=null),void 0===r&&(r=null),a.onAssetParseComplete(t,e,i,n,r)},[t,e,i,n,r])},e.prototype.onAssetParseComplete=function(t,e,i,n,r){void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===n&&(n=null),void 0===r&&(r=null);var a=0;n?(this._preImage||(this._preImage=new LImage,this.addChild(this._preImage)),this._preImage.skin=n,this._preImage.pos(a,0),a+=this._preImage.width+this._curFont.space):this._preImage&&(this._preImage.destroy(),this._preImage=null);for(var s=0,o=this._clipArray;s<o.length;s++)(u=o[s]).removeSelf();if(t&&(!e&&"0"<t||e))for(var l=0;l<t.length;l++){if(this._clipArray[l])this._clipArray[l].index=parseInt(t.charAt(l)),this._clipArray[l].parent||this.addChild(this._clipArray[l]),this._clipArray[l].x=a,this._clipArray[l].y=0;else{var h=parseInt(t.charAt(l)),u=this.createClip(h);this.addChild(u),u.x=a,u.y=0,this._clipArray.push(u)}a+=this._curFont.clipWidth+this._curFont.space}r?(this._postImage||(this._postImage=new LImage,this.addChild(this._postImage)),this._postImage.skin=r,this._postImage.pos(a,0)):this._postImage&&(this._postImage.destroy(),this._postImage=null),this.width=a,i&&this.playTween(t)},e.prototype.playTween=function(t){var e=this;Laya.timer.frameLoop(1,this,this.showTween,[parseInt(t)]);for(var i=function(t){n._stopArray[t]?n._stopArray[t]=!1:n._stopArray.push(!1),Laya.timer.once(500+500*t,n,function(){e.stopTween(t)})},n=this,r=0;r<t.length;r++)i(r)},e.prototype.stopTween=function(t){this._stopArray[t]=!0,this.event(e.EVENT_NUM_TWWEN_STOP)},e.prototype.showTween=function(t){for(var e=t.toString(),i=0;i<e.length;i++){var n=this.getChildAt(i),r=n.index;r++,n&&(this._stopArray[i]?(n.index=parseInt(e[i]),i>=e.length-1&&Laya.timer.clearAll(this)):n.index=r%10)}},e.prototype.createClip=function(t){var e=new laya.ui.Clip(this._curFont.url);return e.clipWidth=this._curFont.clipWidth,e.clipX=this._curFont.clipX,e.index=t,this.addChild(e),e},e.prototype.destroy=function(t){if(Laya.timer.clearAll(this),this._curFont.source&&(RefAsset.Get(this._curFont.source).release(),this._curFont=null),this._clipArray){for(var e=0,i=this._clipArray;e<i.length;e++)i[e].destroy(!0);this._clipArray=null}this._preImage&&(this._preImage.destroy(!0),this._preImage=null),this._postImage&&(this._postImage.destroy(!0),this._postImage=null),n.prototype.destroy.call(this,t)},e}(Laya.Box)).EVENT_NUM_TWWEN_STOP="evnet_num_tween_stop",i.ClipUtil=n}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(n){var t,e,i;t=n.gui||(n.gui={}),e=t.base||(t.base={}),i=function(r){function t(t,e,i){var n=r.call(this,t)||this;return n._assetsLoader=new AssetsLoader,n.isOpened=!1,n._isCloseing=!1,n._isPlayOCSound=!0,n._isClickModalClose=!1,n._isModal=!0,n._isTweenOpen=!0,n._isOpenLoad=!0,n._blackColor=null,n._blackAlpha=.75,n._mouseThrough=!0,n._isSubBgCount=!1,n._onOpenFunc=e,n._onCloseFunc=i,n.mouseThrough=!0,n}return __extends(t,r),Object.defineProperty(t.prototype,"dataSource",{get:function(){return this._dataSource},set:function(t){this._dataSource=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0}),t.prototype.onLoaded=function(){this.isOpened&&(this.init(),this.layout(),this.onOpen(),this._view instanceof View&&(this._view.mouseThrough=this._mouseThrough,this._view.cacheAs="normal"),this.initCachas(),this.clearLoadEffect())},t.prototype.init=function(){},t.prototype.initCachas=function(){},t.prototype.drawBlack=function(t,e){void 0===t&&(t=.75),void 0===e&&(e="#0"),this._isModal&&e&&e.length&&(console.log("ap,color",t,e),this._blackSprite||(this._blackColor=e,this._blackAlpha=t,this._blackSprite=new Sprite,this._blackSprite.alpha=t,this._blackSprite.mouseEnabled=!0,this.addChildAt(this._blackSprite,0)),console.log("drawBlack",t,e),this._blackSprite.size(Laya.stage.width,Laya.stage.height),this._blackSprite.graphics.clear(),this._blackSprite.graphics.drawRect(0,0,this._blackSprite.width,this._blackSprite.height,e),this._blackSprite.pos(this._app.uiRoot.x,-this._app.uiRoot.y),this._isModal&&this._isClickModalClose&&this._blackSprite.on(LEvent.CLICK,this,this.onBlackClick))},t.prototype.open=function(t,e,i){this._key=t,this._bronSprite=e,this._prev_View=i,this.clear(),this.isOpened=!0,this.createdLoadEffect(),this._asset&&this._asset.push(n.Path.uiAtlas+"tongyong.atlas"),this._assetsLoader.load(this._asset,Handler.create(this,this.onLoaded))},t.prototype.createdLoadEffect=function(){this._isOpenLoad},t.prototype.clearLoadEffect=function(){},t.prototype.setMouseThrough=function(t){this._mouseThrough=t,this._view instanceof View&&(this._view.mouseThrough=this._mouseThrough)},t.prototype.inFrontAll=function(){this.parent&&this.parent.addChild(this)},t.prototype.onOpen=function(){var t=this;this._onOpenFunc&&this._onOpenFunc(this),this._prev_View&&this._prev_View.parent&&(this._prev_View.parent.visible=!1),this._isTweenOpen&&this._view&&this._view.parent&&this._view.hasOwnProperty("y")&&(this._originViewY=this._view.y,this._view.y=this._originViewY+70,this._tween=new Laya.Tween,this._tween.to(this._view,{y:this._originViewY},500,Laya.Ease.elasticOut),Laya.timer.once(500,this,function(){t._view.y=t._originViewY},null,!0)),WXTool.clean(),this._view&&this._view.txtMoney&&this.initGoldUI(),this.updatejinbi(),MessageManager.on(WXTool.JINBI,this,this.updatejinbi)},t.prototype.openOtherPage=function(t,e,i,n,r){return e||(e=this.parent),e?e.open(t,i,n,r):null},t.prototype.updatejinbi=function(){var t=this._app.plyertDataMgr.getGold();this._goldClip&&this._goldClip.setText(t.toString(),!0)},t.prototype.initGoldUI=function(){this.view.txtMoney.visible=!1,this._goldClip=new e.ClipUtil(e.ClipUtil.GOLD_FONT),this._goldClip.scale(.55,.55),this.view.txtMoney.parent.addChild(this._goldClip),this._goldClip.pos(this.view.txtMoney.x,this.view.txtMoney.y)},t.prototype.clear=function(){this.clearLoadEffect(),Laya.timer.clearAll(this),this._tween&&this._tween.clear(),this._tween=null,this._view&&(this._view.destroy(!0),this._view=null),this._goldClip&&(this._goldClip=null),this._assetsLoader.clear()},t.prototype.layout=function(){if(this._view){var t=this._clientWidth/this._view.width,e=this._clientHeight/this._view.height,i=Math.min(t,e);this._view.scale(i,i),this._view.x=(this._clientWidth-this._view.width*i)/2,this._view.y=(this._clientHeight-this._view.height*i)/2,this.drawBlack(this._blackAlpha)}},t.prototype.close=function(){this._isCloseing||(this.clearBlack(),this._prev_View&&this._prev_View.parent&&(this._prev_View.parent.visible=!0),this._prev_View=null,this._isCloseing=!1,this.isOpened=!1,this._onCloseFunc&&this._onCloseFunc(this),this.dispose())},t.prototype.resize=function(t,e,i){void 0===i&&(i=!0),r.prototype.resize.call(this,t,e),i&&this.layout()},t.prototype.dispose=function(){this.clear(),r.prototype.dispose.call(this),this.removeSelf()},t.prototype.cancel=function(){return this.close(),!0},t.prototype.onBlackClick=function(){console.log("黑底被电击"),MessageManager.event(WXTool.BLACKEVENT)},t.prototype.clearBlack=function(){this._isModal&&this._blackSprite&&(this._blackSprite.graphics.clear(),this._blackSprite.destroy(),this._blackSprite=null)},t.prototype.showGuideEffect=function(t,e){},t}(e.Container),e.Page=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(h){var t,e,i;t=h.gui||(h.gui={}),e=t.base||(t.base={}),i=function(r){function t(t){var e=r.call(this,t)||this;return e._pages={},e.mouseThrough=!0,e}return __extends(t,r),t.prototype.open=function(t,e,i,n,r,a){var s,o=this;if(console.log(t),r||(s=this._pages[t]),s)s.parent&&(s.parent.setChildIndex(s,s.parent.numChildren-1),s.visible=!0);else{var l=h.gui.page.PageDef.getPageClass(t);(s=new l(this._app,e,function(){i&&i(s),delete o._pages[t]})).resize(this._clientWidth,this._clientHeight,!1),this._pages[t]=s,this.addChild(s),s.open(t,n,a)}return s},t.prototype.getPage=function(t){return this._pages[t]},t.prototype.isOpened=function(t){return!!this._pages[t]&&this._pages[t].isOpened},t.prototype.close=function(t){var e=this._pages[t];e&&e.close()},t.prototype.closeAll=function(){for(var t in this._pages)this.close(Number(t));for(;this.numChildren;)this.removeChildAt(0)},t.prototype.getTopKey=function(){if(this.numChildren){var t=this.getChildAt(this.numChildren-1);if(t)for(var e in this._pages)if(this._pages[e]==t)return e}},t.prototype.enter=function(){if(this.numChildren){var t=this.getChildAt(this.numChildren-1);if(t)return t.enter()}return!1},t.prototype.cancel=function(){if(this.numChildren){var t=this.getChildAt(this.numChildren-1);if(t instanceof e.Page)return t.cancel()}return!1},t.prototype.resize=function(t,e){for(var i in r.prototype.resize.call(this,t,e),this._pages){var n=this._pages[i];n&&n.resize(t,e)}},t.prototype.dispose=function(){this.closeAll(),this._pages=null,r.prototype.dispose.call(this)},t}(e.Container),e.PageContainer=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i,n;e=t.gui||(t.gui={}),i=e.base||(e.base={}),n=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n._selectIdx=-1,n._oldSelectIdx=0,n.tabIndex=0,n}return __extends(t,r),Object.defineProperty(t.prototype,"selectIdx",{get:function(){return this._selectIdx},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tabPages",{get:function(){return this._tabPages},enumerable:!0,configurable:!0}),t.prototype.addTabPage=function(t,e){this._tabPages&&(this._tabPages[t]=e)},t.prototype.selectTab=function(t,e){if(void 0===e&&(e=!1),this._tabPages&&(e||this._selectIdx!=t)){this._selectIdx=t;for(var i=this._tabPages.length,n=0;n<i;n++)this._tabPages[n]&&(n==t?this._tabPages[n].open():this._tabPages[n].close())}},t.prototype.close=function(){if(this._tabPages){for(var t=this._tabPages.length,e=0;e<t;e++)this._tabPages[e]&&(this._tabPages[e].destory(),this._tabPages[e]=null);this._tabPages=null,this._oldSelectIdx=0,this._selectIdx=-1,this.tabIndex=0}r.prototype.close.call(this)},t}(i.Page),i.TabPage=n}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},doc;!function(t){var e;(function(t){var e=function(n){function t(t,e){var i=n.call(this)||this;return i._isEffect=!0,i._app=t,i._prev_view=e,i}return __extends(t,n),Object.defineProperty(t.prototype,"icon",{get:function(){return this._imgIcon},enumerable:!0,configurable:!0}),t.prototype.size=function(t,e){var i=n.prototype.size.call(this,t,e);return this._imgBg&&this._imgBg.size(t,e),i},t.prototype.setBgSkin=function(t){t instanceof LImage?this._imgBg=t:"string"==typeof t&&(this._imgBg=new LImage,this._imgBg.skin=t),this._imgBg.centerX=this._imgBg.centerY=0,this._imgBg.alpha=.2,this.size(this._imgBg.width,this._imgBg.height),this.addChild(this._imgBg)},t.prototype.setBgLabel=function(t){this._imgBg&&(this._lbBg||(this._lbBg=new Label,this._lbBg.color=TeaStyle.COLOR_GRAY,this._lbBg.font="SimHei",this._lbBg.fontSize=20),this._imgBg.addChild(this._lbBg),this._lbBg.pos(16,28),this._lbBg.text=t)},t.prototype.setIcon=function(t){this._imgIcon||(this._imgIcon=new LImage,this._imgIcon.centerX=this._imgIcon.centerY=0,this.addChild(this._imgIcon)),this._imgIcon.skin=t},t.prototype.setQuality=function(t){t<0?this._imgQuality&&(this._imgQuality.skin=null):(this._imgQuality||(this._imgQuality=new LImage,this._imgQuality.centerX=this._imgQuality.centerY=0,this.addChild(this._imgQuality)),this._imgQuality)},t.prototype.clear=function(){this.setIcon(null),this.setQuality(-1)},t.prototype.destroy=function(t){this.clear(),this._lbBg&&(this._lbBg.destroy(),this._lbBg=null),this._imgBg&&(this._imgBg.destroy(),this._imgBg=null),this._prev_view=null,n.prototype.destroy.call(this,t)},t}(Laya.Box);e.isShowItemTempId=!1;var i=function(n){function t(t,e){var i=n.call(this,t,e)||this;return i._count=0,i._showCount=!1,i._effectLayer=new EffectLayer,i.addChild(i._effectLayer),i}return __extends(t,n),Object.defineProperty(t.prototype,"entry",{get:function(){return this._tempData?this._tempData.id:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showCount",{get:function(){return this._showCount},set:function(t){this._showCount=t},enumerable:!0,configurable:!0}),t.prototype.setData=function(t,e){void 0===e&&(e=1),this.clear(),t&&(this._tempData=t,this._count=e,this.setIcon(Path.ui+"icon/"+t.icon+".png"),0<=this._tempData.quality&&this.setQuality(this._tempData.quality),this.setCount(this._count))},t.prototype.setCount=function(t){0==t||!this._showCount&&1==t?this._labelCount&&(this._labelCount.text=""):(this.createLabelCount(),this._labelCount.text=t.toString(),this._labelCount.right=2,this._labelCount.bottom=2)},t.prototype.setCountText=function(t){this.createLabelCount(),this._labelCount.text=t,this._labelCount.right=2,this._labelCount.bottom=2},t.prototype.createLabelCount=function(){this._labelCount||(this._labelCount=new Label,this._labelCount.fontSize=25,this._labelCount.color=TeaStyle.COLOR_WHITE,this.addChild(this._labelCount),this._labelCount.align="right",this._labelCount.stroke=2,this._labelCount.strokeColor=TeaStyle.COLOR_BLACK)},t.prototype.setQuality=function(t){this.clearEffect(),n.prototype.setQuality.call(this,t),this._tempData},t.prototype.playEffect=function(){},t.prototype.clearEffect=function(){},t.prototype.clear=function(){this._tempData=null,this.setCount(0),this.clearEffect(),n.prototype.clear.call(this)},t.prototype.destroy=function(t){this.clear(),this._effectLayer&&(this._effectLayer.removeSelf(),this._effectLayer=null),n.prototype.destroy.call(this,t)},t}(t.Grid=e),n=function(n){function t(t,e){var i=n.call(this,t,e)||this;return i.isEnough=!0,i.isDetial=!0,i.on(LEvent.CLICK,i,i.onGridClick),i}return __extends(t,n),t.prototype.onGridClick=function(){this.isDetial&&this._tempData&&this.isEnough},t.prototype.destroy=function(t){this.clear(),this.off(LEvent.CLICK,this,this.onGridClick),n.prototype.destroy.call(this,t)},t}(t.TemplateGrid=i);t.TemplateInfoGrid=n})((e=t.gui||(t.gui={})).component||(e.component={}))}(doc||(doc={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e;(function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.__width=0,t.__height=0,t.IMGS=["bg_01.jpg","bg_02.jpg","bg_03.jpg","bg_04.jpg","bg_05.jpg"],t._imgIndex=0,t._imgCreate=0,t._map_zhezhao=[],t._move_height=0,t.PER_PAGE=7,t._maps=[],t.init(),t}return __extends(n,e),n.prototype.init=function(){for(var t=0;t<this._maps.length;t++)r.free(this._maps[t]);for(t=this._maps.length=0;t<this.PER_PAGE;t++){var e=r.malloc();e.url="bg_01.jpg",e.offsetY=n.MAP_HEIGHT*(t-1),e.moveSpeed=2,this._maps.push(e)}var i=r.malloc();i.url="tu_di2.png",i.botoom=!1,i.offsetX=15,i.offsetY=587,i.moveSpeed=2,this._maps.push(i),this.__height=0,this._imgCreate=0,this._imgIndex=0},n.prototype.update=function(){if(this.__height-=2,this.__height<=0){if(this._imgCreate==this.PER_PAGE&&(this._imgIndex=++this._imgIndex%5,this._imgCreate=0),this._imgCreate==this.PER_PAGE-1){var t=r.malloc();t.url="tu_yun1.png",t.offsetY=-300,t.botoom=!1,t.loader(),t.moveSpeed=1.8,this._maps.push(t),(t=r.malloc()).url="tu_yun3.png",t.offsetY=-300,t.botoom=!1,t.loader(),t.moveSpeed=2,this._maps.push(t)}this._imgCreate++,this.__height+=183,(i=r.malloc()).url=this.IMGS[this._imgIndex],i.offsetY=-this.__height,i.moveSpeed=2,this._maps.push(i)}this.graphics.clear();for(var e=0;e<this._maps.length;e++)(i=this._maps[e]).update(),i.needDestory()?(this._maps.splice(e,1),r.free(i),e--):i.texture&&i.botoom&&this.graphics.drawTexture(i.texture,i.offsetX,i.offsetY);for(e=0;e<this._maps.length;e++){var i;(i=this._maps[e]).texture&&!i.botoom&&this.graphics.drawTexture(i.texture,i.offsetX,i.offsetY)}},n}(Laya.Sprite);e.MAP_HEIGHT=183,t.MapLayer=e;var r=function(){function e(){this.offsetX=0,this.offsetY=0,this.botoom=!0,this.needLoad=!1}return e.malloc=function(){return 0<e._map_list.length?e._map_list.pop():new e},e.free=function(t){t&&(t.reset(),e._map_list.push(t))},Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture||this.needLoad||(this._texture=Loader.getRes("tongyong/"+this.url)),this._texture},enumerable:!0,configurable:!0}),e.prototype.loader=function(){this.needLoad&&Laya.loader.load("tongyong/"+this.url,Handler.create(this,this.onLoad))},e.prototype.onLoad=function(t){this._texture=t},e.prototype.update=function(){this.offsetY+=this.moveSpeed},e.prototype.needDestory=function(){return 736<this.offsetY},e.prototype.reset=function(){this.offsetX=0,this.offsetY=0,this.needLoad=!1,this._texture=null,this.botoom=!0},e}();r._map_list=[]})((e=t.gui||(t.gui={})).component||(e.component={}))}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i,n;e=t.gui||(t.gui={}),i=e.component||(e.component={}),(n=function(a){function c(t,e,i,n){void 0===n&&(n=!1);var r=a.call(this)||this;return r._isLoop=!1,r._isPlaying=!1,r._selectIndex=0,r._renderItemList=[],r._posArray=[],r._type=t,r._renderItem=e,r._space=i,r._isLoop=n,r.initPanel(),r.on(LEvent.MOUSE_DOWN,r,r.onMouseDown),r.on(LEvent.MOUSE_UP,r,r.onMouseUp),r}return __extends(c,a),Object.defineProperty(c.prototype,"array",{get:function(){return this._dataArray},set:function(t){this._dataArray=t,this.updateData()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"selectIndex",{get:function(){return this._selectIndex},set:function(t){this._selectIndex=t,this.updateData()},enumerable:!0,configurable:!0}),c.prototype.selectHandler=function(t){this._selectHandler=t},c.prototype.onMouseDown=function(t){this._firstX=t.stageX},c.prototype.onMouseUp=function(t){var e=t.stageX-this._firstX;5<Math.abs(e)&&(0<e?this.scroll(c.TYPE_DEC):this.scroll(c.TYPE_ADD))},c.prototype.initPanel=function(){if(this._renderItem){this._isPlaying=!1;for(var t=0,e=this._renderItemList;t<e.length;t++){var i=e[t];i.destroy&&i.destroy()}this._renderItemList.length=0;for(var n=this._renderItem,r=0;r<c.MAX_COUNT+1;r++){var a=new n;a.anchorX=a.anchorY=.5,this._renderItemList.push({render:a,posIndex:-1}),this._itemWidth&&this._itemHeight||(this._itemWidth=a.width,this._itemHeight=a.height)}if(this._posArray.length=0,this._type==c.TYPE_HORIZONTAL){var s=-this._itemWidth/2-this._space;for(r=0;r<c.MAX_COUNT+2;r++)this._posArray.push(s),s+=this._itemWidth+this._space;this.size(c.MAX_COUNT*this._itemWidth+(c.MAX_COUNT-1)*this._space,this._itemHeight*c.MAX_SCALE)}else{var o=-this._itemHeight/2-this._space;for(r=0;r<c.MAX_COUNT+2;r++)this._posArray.push(o),o+=this._itemHeight+this._space;this.size(this._itemWidth*c.MAX_SCALE,c.MAX_COUNT*this._itemHeight+(c.MAX_COUNT-1)*this._space)}}},c.prototype.updateData=function(){if(this.clearShow(),this._dataArray&&!(this._dataArray.length<0))for(var t=this._selectIndex-1,e=0==this._selectIndex?2:1,i=0;i<c.MAX_COUNT;i++)if(!(t+i<0)){var n=this.addItem(t+i,e++);t+i==this._selectIndex?n.scale(c.MAX_SCALE,c.MAX_SCALE):n.scale(c.MIN_SCALE,c.MIN_SCALE)}},c.prototype.scroll=function(t,e){var i=this;if(!this._isPlaying){if(t==c.TYPE_ADD){if(!this._isLoop&&this._selectIndex+1>this._dataArray.length-1)return;if(this._selectIndex++,this._isLoop)this._selectIndex=this._selectIndex>this._dataArray.length-1?0:this._selectIndex,n=(n=this._selectIndex+1)>this._dataArray.length-1?0:n,this.addItem(n,this._posArray.length-1);else if(this._selectIndex+1<=this._dataArray.length-1){var n=this._selectIndex+1;this.addItem(n,this._posArray.length-1)}}else{if(!this._isLoop&&this._selectIndex-1<0)return;this._selectIndex--,this._isLoop?(this._selectIndex=this._selectIndex<0?this._dataArray.length-1:this._selectIndex,n=(n=this._selectIndex-1)<0?this._dataArray.length-1:n,this.addItem(n,0)):0<=this._selectIndex-1&&(n=this._selectIndex-1,this.addItem(n,0))}this._isPlaying=!0;for(var r=0;r<this._renderItemList.length;r++){var a=this._renderItemList[r],s=a.render;if(s.parent){var o=a.posIndex+(t==c.TYPE_ADD?-1:1),l=this._posArray[o],h=2==(a.posIndex=o)?c.MAX_SCALE:c.MIN_SCALE,u=void 0;u=this._type==c.TYPE_HORIZONTAL?{x:l,scaleX:h,scaleY:h}:{y:l,scaleX:h,scaleY:h},Laya.Tween.to(s,u,c.SCROLL_TIME,null,Handler.create(this,function(){e&&e(),i.onScrollEnd(t)},null,!1))}}this._selectHandler.run()}},c.prototype.scrollTo=function(t){var e=t-2;if(this._diff=Math.abs(e),0<e)this.scroll(c.TYPE_ADD);else if(e<0)this.scroll(c.TYPE_DEC);else{var i=this.getItemByIndex(2).render;i.onClick&&i.onClick()}},c.prototype.addItem=function(t,e){var i=this.getFreeItem();if(i){var n=i.render;return this.addChild(n),n.on(LEvent.CLICK,this,this.onRenderItemClick),n.hasOwnProperty("dataSource")&&(n.dataSource=this._dataArray[t]),i.posIndex=e,this._type==c.TYPE_HORIZONTAL?n.pos(this._posArray[e],this._height/2):n.pos(this._width/2,this._posArray[e]),n}},c.prototype.onRenderItemClick=function(t){if(t.currentTarget){for(var e=void 0,i=t.currentTarget,n=0,r=this._renderItemList;n<r.length;n++){var a=r[n];if(a.render==i){e=a.posIndex;break}}this.scrollTo(e)}},c.prototype.onScrollEnd=function(t){if(this._isPlaying=!1,t==c.TYPE_ADD){if(!(e=this.getItemByIndex(0)))return;(i=e.render).parent&&(i.removeSelf(),e.posIndex=-1)}else{var e,i;if(!(e=this.getItemByIndex(c.MAX_COUNT+1)))return;(i=e.render).parent&&(i.removeSelf(),e.posIndex=-1)}},c.prototype.getItemByIndex=function(t){for(var e=0,i=this._renderItemList;e<i.length;e++){var n=i[e];if(n.posIndex==t)return n}return null},c.prototype.getFreeItem=function(){for(var t=0,e=this._renderItemList;t<e.length;t++){var i=e[t];if(!i.render.parent)return i}return null},c.prototype.clearShow=function(){for(var t=0,e=this._renderItemList;t<e.length;t++){var i=e[t];i.render.removeSelf(),i.posIndex=-1}},c.prototype.destroy=function(){this.off(LEvent.MOUSE_DOWN,this,this.onMouseDown),this.off(LEvent.MOUSE_UP,this,this.onMouseUp);for(var t=0,e=this._renderItemList;t<e.length;t++){var i=e[t];i.destroy&&i.destroy()}this._renderItemList=null,this._dataArray=null,this._posArray=null,this._selectHandler=null,a.prototype.destroy.call(this,!0)},c}(Laya.Panel)).TYPE_HORIZONTAL=0,n.TYPE_VERTICAL=1,n.TYPE_ADD=0,n.TYPE_DEC=1,n.MAX_COUNT=3,n.MAX_SCALE=1.2,n.MIN_SCALE=1,n.SCROLL_TIME=200,i.MyList=n}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},doc;!function(t){var e,i,n;e=t.gui||(t.gui={}),i=e.component||(e.component={}),n=function(n){function t(t,e){void 0===e&&(e=0);var i=n.call(this)||this;return i._oldValue=-1,i._maxWidth=0,i.setFont(t),i._maxWidth=e,i._clipArray=[],i}return __extends(t,n),t.init=function(){this.SCORE_FONT={source:Path.uiAtlas+"tongyong.atlas",url:Path.ui+"tongyong/clip_1.png",clipWidth:0,clipX:10,space:-15},this.SCORE0_FONT={source:Path.uiAtlas+"tongyong.atlas",url:"tongyong/clip_1.png",clipWidth:27,clipX:10,space:0},this.SCORE1_FONT={source:Path.uiAtlas+"tongyong.atlas",url:"tongyong/clip_1.png",clipWidth:0,clipX:10,space:0},this.SCORE2_FONT={source:Path.uiAtlas+"tongyong.atlas",url:"tongyong/clip_2.png",clipWidth:0,clipX:10,space:0},this.SCORE3_FONT={source:Path.uiAtlas+"tongyong.atlas",url:"tongyong/clip_shuzi4.png",clipWidth:0,clipX:10,space:0},this.SCORE4_FONT={source:Path.uiAtlas+"tongyong.atlas",url:"tongyong/clip_shuzi_xiao.png",clipWidth:0,clipX:10,space:0},this.SCORE5_FONT={source:Path.uiAtlas+"jiesuan.atlas",url:"jiesuan/clip_shuzi1.png",clipWidth:0,clipX:10,space:52}},t.prototype.setFont=function(t){if(this._curFont!=t&&((this._curFont=t).source&&RefAsset.Get(t.source).retain(),this._clipArray)){for(var e=0,i=this._clipArray;e<i.length;e++)i[e].destroy(!0);this._clipArray=[]}},t.prototype.setNum=function(t,e,i,n,r){var a=this;if(void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===n&&(n=null),void 0===r&&(r=null),this._curFont){var s=RefAsset.Get(this._curFont.source);s.parseComplete?this.onAssetParseComplete(t,e,i,n,r):s.once(LEvent.COMPLETE,this,function(t,e,i,n,r){void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===n&&(n=null),void 0===r&&(r=null),a.onAssetParseComplete(t,e,i,n,r)},[t,e,i,n,r])}else console.log("Font not found!")},t.prototype.onAssetParseComplete=function(t,e,i,n,r){var a=this;if(void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===n&&(n=null),void 0===r&&(r=null),0<t&&0<=this._oldValue&&i){var s=t-this._oldValue;if(0<s)for(var o=0;o<s;o++){var l=this._oldValue+o+1;Laya.timer.once(30*o,this,function(t,e,i,n){a.showData(t,e,i,n)},[l,e,n,r])}else this.showData(t,e,n,r)}else this.showData(t,e,n,r);this._oldValue=t},t.prototype.showData=function(t,e,i,n){void 0===e&&(e=!1),void 0===i&&(i=null),void 0===n&&(n=null);var r=t.toString(),a=0;i?(this._preImage||(this._preImage=new LImage,this.addChild(this._preImage)),this._preImage.skin=i,this._preImage.pos(a,0),a+=this._preImage.width+this._curFont.space):this._preImage&&(this._preImage.destroy(),this._preImage=null);for(var s=0,o=this._clipArray;s<o.length;s++)o[s].removeSelf();if(r&&(!e&&"0"<r||e)){this.visible=!0;for(var l=0;l<r.length;l++){var h=this._clipArray[l];if(h)h.index=parseInt(r.charAt(l));else{var u=parseInt(r.charAt(l));h=this.createClip(u),this._clipArray.push(h)}h.parent||this.addChild(h),h.x=a,h.y=0,a+=h.width+this._curFont.space}}else this.visible=!1;n?(this._postImage||(this._postImage=new LImage,this.addChild(this._postImage)),this._postImage.skin=n,this._postImage.pos(a,0)):this._postImage&&(this._postImage.destroy(),this._postImage=null),0<this._maxWidth&&(this.x=(this._maxWidth-this.width)/2),t==this._oldValue&&Laya.timer.clearAll(this)},t.prototype.createClip=function(t){var e=new laya.ui.Clip(this._curFont.url);return e.clipWidth=this._curFont.clipWidth,e.clipX=this._curFont.clipX,e.index=t,this.addChild(e),e},t.prototype.destroy=function(t){if(Laya.timer.clearAll(this),this._curFont.source&&(RefAsset.Get(this._curFont.source).release(),this._curFont=null),this._clipArray){for(var e=0,i=this._clipArray;e<i.length;e++)i[e].destroy(!0);this._clipArray=null}this._preImage&&(this._preImage.destroy(!0),this._preImage=null),this._postImage&&(this._postImage.destroy(!0),this._postImage=null),n.prototype.destroy.call(this,t)},t}(Laya.Box),i.NumGroup=n}(doc||(doc={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},View=laya.ui.View,Dialog=laya.ui.Dialog,ui;!function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("ui.component.CaiNiXiHuan_TUI",i.component.CaiNiXiHuan_TUI),t.prototype.createChildren.call(this),this.createView(i.CaiNiXiHuanUI.uiView)},e}(View);t.uiView={type:"View",props:{width:550,mouseThrough:!0,height:650},child:[{type:"Box",props:{y:0,x:0,width:478,height:636},child:[{type:"Image",props:{width:474,skin:"tongyong/tu_di.png",sizeGrid:"33,41,47,41",height:636}},{type:"Image",props:{y:86,x:21,width:429,skin:"top/tu_di.png",sizeGrid:"26,42,31,40",height:526,alpha:.7}},{type:"Image",props:{y:51,x:235,skin:"cainixihuan/bt_cnxh.png",anchorY:.5,anchorX:.5}},{type:"Button",props:{x:463,visible:!0,var:"btn_gg",stateNum:1,skin:"play/btn_gengduo.png",centerY:.5}}]},{type:"List",props:{y:122,x:40,width:403,var:"list_info",spaceY:18,spaceX:20,height:462},child:[{type:"CaiNiXiHuan_T",props:{y:0,x:0,name:"render",runtime:"ui.component.CaiNiXiHuan_TUI"}}]}]},i.CaiNiXiHuanUI=t}(ui||(ui={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("ui.component.ChengJiu_TUI",i.component.ChengJiu_TUI),t.prototype.createChildren.call(this),this.createView(i.ChengJiuUI.uiView)},e}(View);t.uiView={type:"View",props:{width:720,height:1280},child:[{type:"Box",props:{y:28,x:29},child:[{type:"Image",props:{y:10,x:47,skin:"tongyong/tu_shuzidi.png"}},{type:"Image",props:{skin:"tongyong/tu_jinbi.png"}},{type:"Label",props:{y:22,x:84,width:127,var:"txtMoney",text:"123456",height:34,fontSize:34,font:"Arial",color:"#ffffff",bold:!0,align:"left"}}]},{type:"Image",props:{y:169,width:665,skin:"tongyong/tu_di.png",sizeGrid:"33,41,47,41",height:810,centerX:0}},{type:"Image",props:{y:220,skin:"chengjiu/bt_chengjiu.png",centerX:11,anchorY:.5,anchorX:.5}},{type:"Label",props:{y:229,x:422,width:240,var:"txt_JD",text:"成就进度:0/555",height:34,fontSize:30,color:"#ffffff",align:"right"}},{type:"List",props:{y:270,x:46,width:625,var:"list_achieve",spaceY:7,height:644},child:[{type:"ChengJiu_T",props:{y:-6,x:2,name:"render",runtime:"ui.component.ChengJiu_TUI"}}]},{type:"Button",props:{y:1011,x:46,var:"btn_back",stateNum:1,skin:"tongyong/btn_fh2.png"}},{type:"Button",props:{y:1003,x:378,var:"btn_start",stateNum:1,skin:"tongyong/btn_1.png",scaleY:.9,scaleX:.9}},{type:"Box",props:{y:1027,x:409},child:[{type:"Image",props:{y:1,skin:"tongyong/tu_kaishi.png",scaleY:.8,scaleX:.8}},{type:"Image",props:{x:36,skin:"tongyong/tu_ljtz.png",scaleY:.8,scaleX:.8}}]},{type:"Image",props:{y:98,x:236,skin:"tongyong/tu_hdj.png"}}]},i.ChengJiuUI=t}(ui||(ui={})),function(i){var t,e;t=i.component||(i.component={}),(e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.component.CaiNiXiHuan_TUI.uiView)},e}(View)).uiView={type:"View",props:{width:115,height:100},child:[{type:"Box",props:{y:0,x:0},child:[{type:"Image",props:{y:0,x:17,width:82,var:"img_grid",skin:"tongyong/wpk_1.png",height:82}},{type:"Image",props:{y:72,x:0,width:144,skin:"tongyong/tu_di4.png",sizeGrid:"10,42,11,41",scaleY:.8,scaleX:.8,height:33}},{type:"Label",props:{y:76,x:0,width:115,var:"txt_name",text:"游戏名字六字",height:18,fontSize:18,color:"#ffffff",bold:!0,align:"center"}}]}]},t.CaiNiXiHuan_TUI=e}(ui||(ui={})),function(i){var t,e;t=i.component||(i.component={}),(e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.component.ChengJiu_TUI.uiView)},e}(View)).uiView={type:"View",props:{width:620,height:166},child:[{type:"Box",props:{y:0,x:0,width:620,height:166},child:[{type:"Image",props:{y:0,x:0,width:620,skin:"top/tu_di.png",height:166}},{type:"Image",props:{y:18,x:17,width:115,skin:"tongyong/wpk_1.png",height:115},child:[{type:"Image",props:{var:"img_skin",skin:"chengjiutubiao/tu_1.png",centerY:0,centerX:0}}]},{type:"Label",props:{y:21,x:150,width:240,var:"txt_name",text:"游戏大神",height:34,fontSize:32,color:"#68cac5",align:"left"}},{type:"Label",props:{y:72,x:150,width:240,var:"txt_tesc",text:"在游戏中获得100分",height:34,fontSize:28,color:"#68cac5",align:"left"}},{type:"ProgressBar",props:{y:119,x:150,var:"progress1",skin:"chengjiu/progress_1.png"}},{type:"Button",props:{y:103,x:537,var:"btn_LQ",stateNum:1,skin:"tongyong/btn_1.png",scaleY:.35,scaleX:.35,labelSize:75,labelPadding:"-5",labelColors:"#ffffff",labelBold:!0,label:"领 取",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:30,x:492,skin:"tongyong/tu_jinbi.png",scaleY:.5,scaleX:.5}},{type:"Label",props:{y:37,x:543,width:78,var:"txt_count",text:"00",height:34,fontSize:26,color:"#ffd558",align:"left"}},{type:"Label",props:{y:88,x:502,width:100,var:"btn_go",text:"前 往>>",height:34,fontSize:26,color:"#68cac5",align:"left"}},{type:"Image",props:{y:138,x:18,var:"img1",skin:"tongyong/tu_di6.png"}},{type:"Image",props:{y:138,x:42,var:"img2",skin:"tongyong/tu_di6.png"}},{type:"Image",props:{y:138,x:65,var:"img3",skin:"tongyong/tu_di6.png"}},{type:"Image",props:{y:138,x:89,var:"img4",skin:"tongyong/tu_di6.png"}},{type:"Image",props:{y:138,x:112,var:"img5",skin:"tongyong/tu_di6.png"}},{type:"Label",props:{y:118,x:158,width:235,var:"txt_JD",text:"00/00",height:34,fontSize:26,color:"#ffffff",align:"center"}}]}]},t.ChengJiu_TUI=e}(ui||(ui={})),function(i){var t,e;t=i.component||(i.component={}),(e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.component.DaoJuShengJi_TUI.uiView)},e}(View)).uiView={type:"View",props:{width:620,height:207},child:[{type:"Image",props:{y:0,x:0,width:620,skin:"top/tu_di.png",height:207}},{type:"Box",props:{y:0,x:0,width:620,height:207},child:[{type:"Image",props:{y:18,x:17,width:115,skin:"tongyong/wpk_1.png",height:115},child:[{type:"Label",props:{y:90,var:"txt_skillName",text:"道具名称",fontSize:22,font:"SimSun",color:"#fbfbfb",centerX:2,bold:!0}},{type:"Image",props:{y:41,x:59,var:"img_icon",skin:"daojushengji/tu_daoju1.png",anchorY:.5,anchorX:.5}}]},{type:"Label",props:{y:13,x:150,width:240,var:"txt_lv",text:"LV.00",height:34,fontSize:32,color:"#68cac5",align:"left"}},{type:"Label",props:{y:104,x:149,width:308,var:"txt_tesc",text:"在游戏中获得100分",height:34,fontSize:28,color:"#68cac5",align:"left"}},{type:"Button",props:{y:103,x:537,var:"btn_level",stateNum:1,skin:"tongyong/btn_1.png",scaleY:.35,scaleX:.35,labelSize:75,labelPadding:"-5",labelColors:"#ffffff",labelBold:!0,label:"升 级",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:30,x:492,skin:"tongyong/tu_jinbi.png",scaleY:.5,scaleX:.5}},{type:"Label",props:{y:37,x:543,width:78,var:"txt_gold",text:"00",height:34,fontSize:26,color:"#ffd558",align:"left"}},{type:"Image",props:{y:69,x:155,var:"img_lv1",skin:"tongyong/tu_di6.png"}},{type:"Image",props:{y:69,x:194,var:"img_lv2",skin:"tongyong/tu_di6.png"}},{type:"Image",props:{y:69,x:232,var:"img_lv3",skin:"tongyong/tu_di6.png"}},{type:"Image",props:{y:69,x:271,var:"img_lv4",skin:"tongyong/tu_di6.png"}},{type:"Image",props:{y:69,x:309,var:"img_lv5",skin:"tongyong/tu_di6.png"}},{type:"Image",props:{y:141,x:14,width:592,skin:"tongyong/tu_di4.png",sizeGrid:"0,24,0,25",height:49}},{type:"Label",props:{y:150,x:28,width:565,var:"txt_nextTesc",text:"下一等级：在6秒内玩家获得×2倍得分",height:34,fontSize:28,color:"#ffd558",align:"left"}}]}]},t.DaoJuShengJi_TUI=e}(ui||(ui={})),function(i){var t,e;t=i.component||(i.component={}),(e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.component.Effect_PiaoZiUI.uiView)},e}(View)).uiView={type:"View",props:{width:720,height:1280},child:[{type:"Box",props:{y:468,x:301},compId:4,child:[{type:"Image",props:{var:"img_add",skin:"piaozi/1_+.png"}},{type:"Image",props:{y:0,x:38,var:"img_num1",skin:"piaozi/1_0.png"}},{type:"Image",props:{y:0,x:73,var:"img_num2",skin:"piaozi/1_0.png"}},{type:"Image",props:{y:0,x:108,var:"img_num3",skin:"piaozi/1_0.png"}}]}],animations:[{nodes:[{target:4,keyframes:{y:[{value:468,tweenMethod:"linearNone",tween:!0,target:4,key:"y",index:0},{value:466,tweenMethod:"linearNone",tween:!0,target:4,key:"y",index:3},{value:450,tweenMethod:"linearNone",tween:!0,target:4,key:"y",index:16}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!1,target:4,key:"alpha",index:3},{value:1,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:12},{value:0,tweenMethod:"linearNone",tween:!0,target:4,key:"alpha",index:16}]}}],name:"ani1",id:1,frameRate:24,action:0}]},t.Effect_PiaoZiUI=e}(ui||(ui={})),function(i){var t,e;t=i.component||(i.component={}),(e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.component.PiFuItemUI.uiView)},e}(View)).uiView={type:"View",props:{width:162,height:174},child:[{type:"Image",props:{y:0,x:0,skin:"pifu/pifudi.png"}},{type:"Image",props:{y:14,x:17,var:"img_skin",skin:"pifu/wpk.png"}},{type:"Box",props:{y:143,x:32},child:[{type:"Image",props:{visible:!1,skin:"pifu/zuansi.png",scaleY:.8,scaleX:.8}},{type:"Label",props:{y:1,x:0,width:94,var:"txt_num",text:"1000",height:24,fontSize:24,color:"#000000",bold:!0,align:"center"}}]},{type:"Image",props:{y:131,x:62,var:"img_gou",skin:"pifu/xuanzhong.png"}},{type:"Image",props:{y:20,x:22,var:"img_lock",skin:"pifu/suo.png"}},{type:"Image",props:{var:"img_select",skin:"pifu/tu_yd.png"}}]},t.PiFuItemUI=e}(ui||(ui={})),function(i){var t,e;t=i.component||(i.component={}),(e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.component.PiFu_TUI.uiView)},e}(View)).uiView={type:"View",props:{width:133,height:193},child:[{type:"Image",props:{y:0,x:0,skin:"pifu/tu_di31.png"}},{type:"Box",props:{y:0,x:0,var:"box_main"},child:[{type:"Button",props:{y:150,x:21,visible:!1,var:"btn_state",stateNum:1,skin:"pifu/btn_1.png",labelSize:20,labelPadding:"1",labelColors:"#ffffff",label:"随机皮肤"}},{type:"Image",props:{y:27,x:20,width:100,var:"img_skin",height:100}},{type:"Image",props:{y:0,x:2,width:134,var:"img_active",skin:"tongyong/tu_di8.png",sizeGrid:"26,42,31,40",height:195}},{type:"Box",props:{y:146,x:14,var:"box_buy"},child:[{type:"Image",props:{y:4,x:10,var:"img_di",skin:"pifu/tu_yd.png"}},{type:"Image",props:{y:0,x:0,var:"img_icon",skin:"tongyong/tu_jinbi.png",scaleY:.4,scaleX:.4}},{type:"Label",props:{y:7,x:33,width:77,var:"txtMoney",text:"123456",height:22,fontSize:21,font:"Arial",color:"#ffffff",bold:!0,align:"left"}}]}]}]},t.PiFu_TUI=e}(ui||(ui={})),function(i){var t,e;t=i.component||(i.component={}),(e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("ui.component.PiFu_TUI",i.component.PiFu_TUI),t.prototype.createChildren.call(this),this.createView(i.component.PiFu_T2UI.uiView)},e}(View)).uiView={type:"View",props:{y:65,x:160},child:[{type:"Box",props:{y:-9,x:-110,var:"box_main"},child:[{type:"Image",props:{y:-3,x:1,width:624,skin:"top/tu_di.jpg",height:85}},{type:"Box",props:{y:2,x:6},child:[{type:"Image",props:{y:0,x:183,width:259,var:"img_di",skin:"pifu/tu_di1.png",sizeGrid:"0,35,0,27",height:75}},{type:"Image",props:{y:20,x:278,var:"img_pz",skin:"pifu/tu_txt1.png"}}]},{type:"Label",props:{y:24,x:370,width:240,var:"txt_JD",text:"55/55",height:34,fontSize:30,color:"#05bea7",align:"right"}},{type:"List",props:{y:87,x:29,var:"list_skin",spaceY:10,spaceX:14},child:[{type:"PiFu_T",props:{y:0,x:0,name:"render",runtime:"ui.component.PiFu_TUI"}}]}]}]},t.PiFu_T2UI=e}(ui||(ui={})),function(i){var t,e;t=i.component||(i.component={}),(e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.component.QianDao_TUI.uiView)},e}(View)).uiView={type:"View",props:{width:152,height:250},child:[{type:"Box",props:{y:15,x:5},child:[{type:"Image",props:{y:0,x:0,width:142,var:"img_di",skin:"qiridenglu/tu_xxd2.png",height:224},child:[{type:"Label",props:{y:7,x:34,var:"txt_day",text:"第一天",fontSize:24,color:"#ffffff",bold:!0}},{type:"Image",props:{y:117,x:71,visible:!0,var:"img_icon",skin:"tongyong/tu_qian4.png",anchorY:.5,anchorX:.5}},{type:"Label",props:{y:197,width:140,var:"txt_num",text:"00",height:24,fontSize:24,color:"#000000",centerX:0,anchorY:.5,anchorX:.5,align:"center"}},{type:"Image",props:{y:30,x:45,var:"img_double",skin:"tongyong/tu_shuangbei.png"}},{type:"Image",props:{y:156,visible:!1,var:"img_YL",skin:"qiridenglu/tu_ylq.png",centerX:6}},{type:"Image",props:{y:96,visible:!1,var:"img_YLQ",skin:"qiridenglu/tu_ylq.png",centerX:1}}]}]}]},t.QianDao_TUI=e}(ui||(ui={})),function(i){var t,e;t=i.component||(i.component={}),(e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.component.QianDao_T2UI.uiView)},e}(View)).uiView={type:"View",props:{width:297,height:224},child:[{type:"Image",props:{y:0,x:0,width:297,var:"img_di",skin:"qiridenglu/tu_xxd2.png",sizeGrid:"0,30,0,30",height:224}},{type:"Label",props:{y:7,x:110,var:"txt_day",text:"第七天",fontSize:24,color:"#ffffff",bold:!0}},{type:"Image",props:{y:113,x:147,visible:!1,var:"img_icon",skin:"tongyong/tu_jinbi.png",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:31,x:182,var:"img_double",skin:"tongyong/tu_shuangbei.png"}},{type:"Image",props:{y:136,x:107,visible:!1,var:"img_YL",skin:"qiridenglu/tu_ylq.png"}},{type:"Label",props:{y:199,x:145,var:"txt_num",text:"00",fontSize:24,color:"#000000",anchorY:.5,anchorX:.5}}]},t.QianDao_T2UI=e}(ui||(ui={})),function(i){var t,e;t=i.component||(i.component={}),(e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.component.Top_TUI.uiView)},e}(View)).uiView={type:"View",props:{width:486,renderType:"render",height:94},child:[{type:"Box",props:{y:0,x:0,width:539,height:100},child:[{type:"Image",props:{y:0,x:0,skin:"top/tu_di.png"}},{type:"Image",props:{y:15,x:106,skin:"tongyong/wpk_1.png",sizeGrid:"7,9,11,8"}},{type:"Image",props:{y:30,x:353,skin:"top/tu_yd.png"}},{type:"Label",props:{y:13,x:203,width:240,text:"游戏大神",height:34,fontSize:28,color:"#3d7e9c",bold:!0,align:"left"}},{type:"Label",props:{y:34,x:401,width:51,text:"00",height:29,fontSize:26,color:"#ffffff",align:"right"}},{type:"Box",props:{y:54,x:205},child:[{type:"Image",props:{skin:"top/tu_paihang1.png"}},{type:"Label",props:{y:4,x:2,width:100,text:"游戏大神",fontSize:24,color:"#ffffff",align:"center"}}]},{type:"Image",props:{y:11,x:27,skin:"top/top1.png"}}]}]},t.Top_TUI=e}(ui||(ui={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("ui.component.DaoJuShengJi_TUI",i.component.DaoJuShengJi_TUI),t.prototype.createChildren.call(this),this.createView(i.DaoJuShengJiUI.uiView)},e}(View);t.uiView={type:"View",props:{width:720,height:1280},child:[{type:"Box",props:{y:28,x:29},child:[{type:"Image",props:{y:10,x:47,skin:"tongyong/tu_shuzidi.png"}},{type:"Image",props:{skin:"tongyong/tu_jinbi.png"}},{type:"Label",props:{y:22,x:84,width:127,var:"txtMoney",text:"123456",height:34,fontSize:34,font:"Arial",color:"#ffffff",bold:!0,align:"left"}}]},{type:"Image",props:{y:169,width:665,skin:"tongyong/tu_di.png",sizeGrid:"33,41,47,41",height:885,centerX:0}},{type:"Image",props:{y:227,x:370,skin:"daojushengji/bt_djsj.png",centerX:10,anchorY:.5,anchorX:.5}},{type:"List",props:{y:270,x:46,width:625,var:"list_daoJ",spaceY:50,repeatY:3,height:761},child:[{type:"DaoJuShengJi_T",props:{y:-6,x:2,name:"render",runtime:"ui.component.DaoJuShengJi_TUI"}}]},{type:"Button",props:{y:1110,x:49,var:"btn_back",stateNum:1,skin:"tongyong/btn_fh2.png"}},{type:"Button",props:{y:1114,x:364,var:"btn_go",stateNum:1,skin:"tongyong/btn_1.png"},child:[{type:"Box",props:{y:27,x:54},child:[{type:"Image",props:{y:1,skin:"tongyong/tu_kaishi.png",scaleY:.8,scaleX:.8}},{type:"Image",props:{x:36,skin:"tongyong/tu_ljtz.png",scaleY:.8,scaleX:.8}}]}]},{type:"Image",props:{y:98,x:236,skin:"tongyong/tu_hdj.png"}}]},i.DaoJuShengJiUI=t}(ui||(ui={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.FuHuoUI.uiView)},e}(View);t.uiView={type:"View",props:{width:720,height:1280},child:[{type:"Box",props:{y:202,x:0},child:[{type:"Label",props:{y:0,x:213,width:291,text:"当前成绩",height:38,fontSize:26,color:"#ffffff",bold:!0,align:"center"}},{type:"Label",props:{y:56,x:0,width:720,var:"txt_score",text:"0000",height:85,fontSize:80,color:"#ffd200",bold:!0,align:"center"}}]},{type:"Box",props:{y:365,x:0},child:[{type:"Image",props:{y:0,x:0,skin:"jiesuan/tu_jjcy.png"}},{type:"Image",props:{y:49,x:348,width:369,var:"mouseLayer",height:100}}]},{type:"Button",props:{y:800,x:365,width:350,var:"btn_relife_use",stateNum:1,skin:"tongyong/btn_1.png",sizeGrid:"0,30,0,30",anchorY:.5,anchorX:.5},child:[{type:"Image",props:{y:25,x:105,skin:"jiesuan/tu_syfhb.png"}},{type:"Image",props:{y:47,x:61,skin:"jiesuan/tu_fuhuo.png",anchorY:.5,anchorX:.5}}]},{type:"Button",props:{y:800,x:365,width:350,var:"btn_relife",stateNum:1,skin:"tongyong/btn_2.png",sizeGrid:"0,30,0,30",height:94,anchorY:.5,anchorX:.5},child:[{type:"Image",props:{y:21,x:24,skin:"jiesuan/tu_shipin.png"}},{type:"Image",props:{y:27,x:76,skin:"jiesuan/tu_gkspfh.png"}}]},{type:"Image",props:{y:1010,x:277,var:"btn_skip",skin:"jiesuan/tu_djtg.png"}},{type:"Button",props:{y:800,x:365,width:350,var:"btn_share",stateNum:1,skin:"tongyong/btn_1.png",sizeGrid:"0,30,0,30",anchorY:.5,anchorX:.5},child:[{type:"Image",props:{y:51,x:210,skin:"jiesuan/tu_yqqy.png",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:51,x:87,skin:"jiesuan/tu_fuhuo.png",anchorY:.5,anchorX:.5}}]}]},i.FuHuoUI=t}(ui||(ui={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.FuHuoBiUI.uiView)},e}(View);t.uiView={type:"View",props:{width:720,height:1280},child:[{type:"Image",props:{y:275,x:50,width:612,skin:"tongyong/tu_di.png",sizeGrid:"60,60,60,60",height:608},child:[{type:"Image",props:{y:87,x:20,width:569,skin:"top/tu_di.png",sizeGrid:"26,42,31,40",height:487,alpha:.6}},{type:"Box",props:{y:125,x:72},child:[{type:"Label",props:{y:17,x:0,width:160,text:"目前拥有：",height:36,fontSize:26,color:"#3d7e9c",bold:!0,align:"center"}},{type:"Image",props:{y:0,x:136,skin:"jiesuan/tu_fuhuobi.png",scaleY:.9,scaleX:.9}},{type:"Label",props:{y:22,x:224,width:80,var:"txt_gold",text:"5",fontSize:26,color:"#3d7e9c",bold:!0,align:"center"}},{type:"Label",props:{y:21,x:298,width:196,text:"（上限10个）",height:36,fontSize:26,color:"#3d7e9c",bold:!0,align:"center"}}]},{type:"Button",props:{y:513,x:327,width:350,var:"btn_fuhuo",stateNum:1,skin:"tongyong/btn_1.png",sizeGrid:"0,30,0,30",anchorY:.5,anchorX:.5},child:[{type:"Image",props:{y:29,x:103,skin:"jiesuan/tu_syfhb.png"}},{type:"Image",props:{y:50,x:60,skin:"jiesuan/tu_fh.png",scaleY:.8,scaleX:.8,anchorY:.5,anchorX:.5}},{type:"Clip",props:{y:54,x:76,var:"txt_coin",skin:"jiesuan/clip_1.png",index:2,clipX:10}}]},{type:"Button",props:{y:394,x:326,width:350,var:"btn_invite",stateNum:1,skin:"tongyong/btn_1.png",anchorY:.5,anchorX:.5},child:[{type:"Image",props:{y:47,x:204,skin:"jiesuan/tu_yqqy.png",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:47,x:60,skin:"jiesuan/tu_fh1.png",scaleY:.8,scaleX:.8,anchorY:.5,anchorX:.5}}]},{type:"Image",props:{y:23,skin:"jiesuan/bt_fhb.png",centerX:4}},{type:"Box",props:{y:205,x:68},child:[{type:"Label",props:{y:12,x:7,width:407,text:"说明:每日首次登陆立即赠送1个",height:36,fontSize:26,color:"#3d7e9c",bold:!0,align:"center"}},{type:"Label",props:{y:55,x:78,width:407,text:"邀请群友点入你的链接可恢复1个",height:36,fontSize:26,color:"#3d7e9c",bold:!0,align:"center"}}]},{type:"Image",props:{y:-74,x:174,skin:"tongyong/tu_hdj.png"}}]},{type:"Button",props:{y:31,x:35,var:"btn_back",stateNum:1,skin:"tongyong/btn_fh.png"}}]},i.FuHuoBiUI=t}(ui||(ui={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.HuoDeBaoXiangUI.uiView)},e}(View);t.uiView={type:"View",props:{width:720,height:1280},child:[{type:"Button",props:{y:890,var:"btn_open",stateNum:1,skin:"tongyong/btn_1.png",centerX:-3,anchorY:.5,anchorX:.5},child:[{type:"Image",props:{y:49,x:149,skin:"suijibaoxiang/tu_djdk.png",scaleY:.9,scaleX:.9,anchorY:.5,anchorX:.5}}]},{type:"Image",props:{y:172,x:59,skin:"suijibaoxiang/tu_guang.png"}},{type:"Box",props:{y:0,x:-6},child:[{type:"Image",props:{y:516,x:369,skin:"suijibaoxiang/tu_baoxiang.png",rotation:0,pivotY:157,pivotX:143},compId:45}]},{type:"Image",props:{y:231,x:233,skin:"suijibaoxiang/wz_fx.png"}}],animations:[{nodes:[{target:45,keyframes:{y:[{value:582,tweenMethod:"linearNone",tween:!1,target:45,key:"y",index:0},{value:582,tweenMethod:"linearNone",tween:!0,target:45,key:"y",index:10},{value:702,tweenMethod:"linearNone",tween:!0,target:45,key:"y",index:12},{value:510,tweenMethod:"linearNone",tween:!0,target:45,key:"y",index:15},{value:582,tweenMethod:"linearNone",tween:!0,target:45,key:"y",index:17}],rotation:[{value:-14,tweenMethod:"linearNone",tween:!0,target:45,key:"rotation",index:0},{value:12,tweenMethod:"linearNone",tween:!0,target:45,key:"rotation",index:2},{value:-16,tweenMethod:"linearNone",tween:!0,target:45,key:"rotation",index:4},{value:16,tweenMethod:"linearNone",tween:!0,target:45,key:"rotation",index:6},{value:-21,tweenMethod:"linearNone",tween:!0,target:45,key:"rotation",index:8},{value:0,tweenMethod:"linearNone",tween:!0,target:45,key:"rotation",index:10}],height:[{value:297,tweenMethod:"linearNone",tween:!1,target:45,key:"height",index:0},{value:297,tweenMethod:"linearNone",tween:!0,target:45,key:"height",index:10},{value:177,tweenMethod:"linearNone",tween:!0,target:45,key:"height",index:12},{value:358,tweenMethod:"linearNone",tween:!0,target:45,key:"height",index:15},{value:297,tweenMethod:"linearNone",tween:!0,target:45,key:"height",index:17}],alpha:[{value:1,tweenMethod:"linearNone",tween:!1,target:45,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:45,key:"alpha",index:17}]}},{target:51,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:51,key:"visible",index:0}],scaleY:[{value:1,tweenMethod:"linearNone",tween:!1,target:51,key:"scaleY",index:0},{value:1.5,tweenMethod:"linearNone",tween:!0,target:51,key:"scaleY",index:14},{value:4,tweenMethod:"linearNone",tween:!0,target:51,key:"scaleY",index:20}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!1,target:51,key:"scaleX",index:0},{value:1.5,tweenMethod:"linearNone",tween:!0,target:51,key:"scaleX",index:14},{value:4,tweenMethod:"linearNone",tween:!0,target:51,key:"scaleX",index:20}],alpha:[{value:1,tweenMethod:"linearNone",tween:!1,target:51,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:51,key:"alpha",index:14},{value:0,tweenMethod:"linearNone",tween:!0,target:51,key:"alpha",index:20}]}}],name:"ani1",id:1,frameRate:24,action:0}]},i.HuoDeBaoXiangUI=t}(ui||(ui={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.HuoDeJinBiUI.uiView)},e}(View);t.uiView={type:"View",props:{width:720,height:1280},child:[{type:"Image",props:{y:320,x:27,width:665,skin:"tongyong/tu_di.png",sizeGrid:"60,60,60,60",height:534},child:[{type:"Image",props:{y:89,width:622,skin:"top/tu_di.png",sizeGrid:"26,42,31,40",height:418,centerX:0,alpha:.7}},{type:"Image",props:{y:365,width:85,var:"img_icon",skin:"tongyong/tu_dajinbi.png",scaleY:2,scaleX:2,height:80,centerX:5,anchorY:.5,anchorX:.5}},{type:"Label",props:{y:132,width:540,var:"txt_gold",text:"5",height:120,fontSize:120,color:"#ffc047",centerX:0,bold:!0,align:"center"}},{type:"Button",props:{y:631,x:331,width:383,var:"btn_video",stateNum:1,skin:"tongyong/btn_1.png",height:115,anchorY:.5,anchorX:.5},child:[{type:"Image",props:{y:57,x:236,var:"img_video1",skin:"jiesuan/tu_gkspsb.png",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:55,x:71,var:"img_video2",skin:"jiesuan/tu_shipin.png",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:35,var:"img_friend",skin:"jiesuan/tu_xuanyao.png",centerX:0}}]},{type:"Image",props:{y:52,var:"img_title",skin:"jiesuan/bt_hdjb.png",centerX:-3,anchorY:.5,anchorX:.5}},{type:"Image",props:{y:712,x:247,var:"btn_lq",skin:"jiesuan/tu_ljlq.png"}},{type:"Image",props:{y:-69,x:200,skin:"tongyong/tu_hdj.png"}}]},{type:"Box",props:{y:38,x:39},child:[{type:"Image",props:{y:10,x:47,skin:"tongyong/tu_shuzidi.png"}},{type:"Image",props:{y:41,x:40,skin:"tongyong/tu_jinbi.png",scaleY:1,scaleX:1,anchorY:.5,anchorX:.5},compId:43},{type:"Label",props:{y:22,x:84,width:127,var:"txtMoney",text:"123456",height:34,fontSize:34,font:"Arial",color:"#ffffff",bold:!0,align:"left"}}]},{type:"Image",props:{y:312.75,x:206.75,visible:!1,skin:"tongyong/tu_jinbi.png",scaleY:.825,scaleX:.825,anchorY:.5,anchorX:.5,alpha:1},compId:45},{type:"Image",props:{y:371.75,x:274.75,visible:!1,skin:"tongyong/tu_jinbi.png",scaleY:.7749999999999999,scaleX:.7749999999999999,anchorY:.5,anchorX:.5,alpha:1},compId:46},{type:"Image",props:{y:441.72727272727275,x:363.45454545454544,visible:!1,skin:"tongyong/tu_jinbi.png",scaleY:.4545454545454546,scaleX:.4545454545454546,anchorY:.5,anchorX:.5,alpha:1},compId:47},{type:"Image",props:{y:494.33333333333337,x:411.25,visible:!1,skin:"tongyong/tu_jinbi.png",scaleY:.475,scaleX:.475,anchorY:.5,anchorX:.5,alpha:.9166666666666666},compId:48},{type:"Image",props:{y:352,x:261,visible:!1,skin:"tongyong/tu_jinbi.png",scaleY:.6,scaleX:.6,anchorY:.5,anchorX:.5,alpha:1},compId:49},{type:"Image",props:{y:274,x:200,visible:!1,skin:"tongyong/tu_jinbi.png",scaleY:.7,scaleX:.7,anchorY:.5,anchorX:.5,alpha:1},compId:50},{type:"Image",props:{y:515.6666666666666,x:313,visible:!1,skin:"tongyong/tu_jinbi.png",scaleY:.5866666666666667,scaleX:.5866666666666667,anchorY:.5,anchorX:.5,alpha:1},compId:51},{type:"Image",props:{y:508.5,x:376.75,visible:!1,skin:"tongyong/tu_jinbi.png",scaleY:.17500000000000002,scaleX:.17500000000000002,anchorY:.5,anchorX:.5,alpha:1},compId:52},{type:"Image",props:{y:511.8,x:349.2,visible:!1,skin:"tongyong/tu_jinbi.png",scaleY:.36,scaleX:.36,anchorY:.5,anchorX:.5,alpha:1},compId:53}],animations:[{nodes:[{target:45,keyframes:{y:[{value:622,tweenMethod:"linearNone",tween:!0,target:45,key:"y",index:0},{value:544.75,tweenMethod:"linearNone",tween:!0,target:45,key:"y",index:2},{value:479,tweenMethod:"linearNone",tween:!0,target:45,key:"y",index:5},{value:80,tweenMethod:"linearNone",tween:!0,target:45,key:"y",index:17}],x:[{value:319,tweenMethod:"linearNone",tween:!0,target:45,key:"x",index:0},{value:314.5,tweenMethod:"linearNone",tween:!0,target:45,key:"x",index:2},{value:298,tweenMethod:"linearNone",tween:!0,target:45,key:"x",index:5},{value:79,tweenMethod:"linearNone",tween:!0,target:45,key:"x",index:17}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:45,key:"visible",index:0}],scaleY:[{value:.5,tweenMethod:"linearNone",tween:!0,target:45,key:"scaleY",index:0},{value:.6499999999999999,tweenMethod:"linearNone",tween:!0,target:45,key:"scaleY",index:2},{value:.7,tweenMethod:"linearNone",tween:!0,target:45,key:"scaleY",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:45,key:"scaleY",index:17}],scaleX:[{value:.5,tweenMethod:"linearNone",tween:!0,target:45,key:"scaleX",index:0},{value:.6499999999999999,tweenMethod:"linearNone",tween:!0,target:45,key:"scaleX",index:2},{value:.7,tweenMethod:"linearNone",tween:!0,target:45,key:"scaleX",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:45,key:"scaleX",index:17}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:45,key:"alpha",index:0},{value:.75,tweenMethod:"linearNone",tween:!0,target:45,key:"alpha",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:45,key:"alpha",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:45,key:"alpha",index:16},{value:0,tweenMethod:"linearNone",tween:!0,target:45,key:"alpha",index:17}]}},{target:46,keyframes:{y:[{value:596,tweenMethod:"linearNone",tween:!1,target:46,key:"y",index:0},{value:559.7142857142857,tweenMethod:"linearNone",tween:!0,target:46,key:"y",index:2},{value:505.2857142857143,tweenMethod:"linearNone",tween:!0,target:46,key:"y",index:3},{value:469,tweenMethod:"linearNone",tween:!0,target:46,key:"y",index:6},{value:80,tweenMethod:"linearNone",tween:!0,target:46,key:"y",index:22}],x:[{value:358,tweenMethod:"linearNone",tween:!1,target:46,key:"x",index:0},{value:352.85714285714283,tweenMethod:"linearNone",tween:!0,target:46,key:"x",index:2},{value:345.1428571428571,tweenMethod:"linearNone",tween:!0,target:46,key:"x",index:3},{value:340,tweenMethod:"linearNone",tween:!0,target:46,key:"x",index:6},{value:79,tweenMethod:"linearNone",tween:!0,target:46,key:"x",index:22}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:46,key:"visible",index:0}],scaleY:[{value:.6,tweenMethod:"linearNone",tween:!1,target:46,key:"scaleY",index:0},{value:.6,tweenMethod:"linearNone",tween:!0,target:46,key:"scaleY",index:2},{value:.6749999999999999,tweenMethod:"linearNone",tween:!0,target:46,key:"scaleY",index:3},{value:.7,tweenMethod:"linearNone",tween:!0,target:46,key:"scaleY",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:46,key:"scaleY",index:22}],scaleX:[{value:.6,tweenMethod:"linearNone",tween:!1,target:46,key:"scaleX",index:0},{value:.6,tweenMethod:"linearNone",tween:!0,target:46,key:"scaleX",index:2},{value:.6749999999999999,tweenMethod:"linearNone",tween:!0,target:46,key:"scaleX",index:3},{value:.7,tweenMethod:"linearNone",tween:!0,target:46,key:"scaleX",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:46,key:"scaleX",index:22}],alpha:[{value:0,tweenMethod:"linearNone",tween:!1,target:46,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:46,key:"alpha",index:2},{value:.6,tweenMethod:"linearNone",tween:!0,target:46,key:"alpha",index:3},{value:1,tweenMethod:"linearNone",tween:!0,target:46,key:"alpha",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:46,key:"alpha",index:21},{value:0,tweenMethod:"linearNone",tween:!0,target:46,key:"alpha",index:22}]}},{target:47,keyframes:{y:[{value:617,tweenMethod:"linearNone",tween:!1,target:47,key:"y",index:0},{value:617,tweenMethod:"linearNone",tween:!0,target:47,label:null,key:"y",index:4},{value:505.8,tweenMethod:"linearNone",tween:!0,target:47,key:"y",index:6},{value:478,tweenMethod:"linearNone",tween:!0,target:47,key:"y",index:9},{value:79,tweenMethod:"linearNone",tween:!0,target:47,key:"y",index:20}],x:[{value:403,tweenMethod:"linearNone",tween:!1,target:47,key:"x",index:0},{value:403,tweenMethod:"linearNone",tween:!0,target:47,label:null,key:"x",index:4},{value:394.2,tweenMethod:"linearNone",tween:!0,target:47,key:"x",index:6},{value:392,tweenMethod:"linearNone",tween:!0,target:47,key:"x",index:9},{value:78,tweenMethod:"linearNone",tween:!0,target:47,key:"x",index:20}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:47,key:"visible",index:0}],scaleY:[{value:.3,tweenMethod:"linearNone",tween:!1,target:47,key:"scaleY",index:0},{value:.3,tweenMethod:"linearNone",tween:!0,target:47,label:null,key:"scaleY",index:4},{value:.38,tweenMethod:"linearNone",tween:!0,target:47,key:"scaleY",index:6},{value:.4,tweenMethod:"linearNone",tween:!0,target:47,key:"scaleY",index:9},{value:1,tweenMethod:"linearNone",tween:!0,target:47,key:"scaleY",index:20}],scaleX:[{value:.3,tweenMethod:"linearNone",tween:!1,target:47,key:"scaleX",index:0},{value:.3,tweenMethod:"linearNone",tween:!0,target:47,label:null,key:"scaleX",index:4},{value:.38,tweenMethod:"linearNone",tween:!0,target:47,key:"scaleX",index:6},{value:.4,tweenMethod:"linearNone",tween:!0,target:47,key:"scaleX",index:9},{value:1,tweenMethod:"linearNone",tween:!0,target:47,key:"scaleX",index:20}],alpha:[{value:0,tweenMethod:"linearNone",tween:!1,target:47,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:47,key:"alpha",index:4},{value:.8,tweenMethod:"linearNone",tween:!0,target:47,key:"alpha",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:47,key:"alpha",index:9},{value:1,tweenMethod:"linearNone",tween:!0,target:47,key:"alpha",index:19},{value:0,tweenMethod:"linearNone",tween:!0,target:47,key:"alpha",index:20}]}},{target:48,keyframes:{y:[{value:619,tweenMethod:"linearNone",tween:!1,target:48,key:"y",index:0},{value:619,tweenMethod:"linearNone",tween:!0,target:48,label:null,key:"y",index:5},{value:528.3333333333334,tweenMethod:"linearNone",tween:!0,target:48,key:"y",index:7},{value:483,tweenMethod:"linearNone",tween:!0,target:48,key:"y",index:11},{value:79,tweenMethod:"linearNone",tween:!0,target:48,key:"y",index:19}],x:[{value:381,tweenMethod:"linearNone",tween:!1,target:48,key:"x",index:0},{value:381,tweenMethod:"linearNone",tween:!0,target:48,label:null,key:"x",index:5},{value:403,tweenMethod:"linearNone",tween:!0,target:48,key:"x",index:7},{value:414,tweenMethod:"linearNone",tween:!0,target:48,key:"x",index:11},{value:79,tweenMethod:"linearNone",tween:!0,target:48,key:"x",index:19}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:48,key:"visible",index:0}],scaleY:[{value:.2,tweenMethod:"linearNone",tween:!1,target:48,key:"scaleY",index:0},{value:.2,tweenMethod:"linearNone",tween:!0,target:48,label:null,key:"scaleY",index:5},{value:.4,tweenMethod:"linearNone",tween:!0,target:48,key:"scaleY",index:7},{value:.5,tweenMethod:"linearNone",tween:!0,target:48,key:"scaleY",index:11},{value:1,tweenMethod:"linearNone",tween:!0,target:48,key:"scaleY",index:19}],scaleX:[{value:.2,tweenMethod:"linearNone",tween:!1,target:48,key:"scaleX",index:0},{value:.2,tweenMethod:"linearNone",tween:!0,target:48,label:null,key:"scaleX",index:5},{value:.4,tweenMethod:"linearNone",tween:!0,target:48,key:"scaleX",index:7},{value:.5,tweenMethod:"linearNone",tween:!0,target:48,key:"scaleX",index:11},{value:1,tweenMethod:"linearNone",tween:!0,target:48,key:"scaleX",index:19}],alpha:[{value:0,tweenMethod:"linearNone",tween:!1,target:48,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:48,label:null,key:"alpha",index:5},{value:.6666666666666666,tweenMethod:"linearNone",tween:!0,target:48,key:"alpha",index:7},{value:1,tweenMethod:"linearNone",tween:!0,target:48,key:"alpha",index:11},{value:1,tweenMethod:"linearNone",tween:!0,target:48,key:"alpha",index:18},{value:0,tweenMethod:"linearNone",tween:!0,target:48,key:"alpha",index:19}]}},{target:49,keyframes:{y:[{value:605,tweenMethod:"linearNone",tween:!1,target:49,key:"y",index:0},{value:605,tweenMethod:"linearNone",tween:!0,target:49,label:null,key:"y",index:3},{value:511.4,tweenMethod:"linearNone",tween:!0,target:49,key:"y",index:4},{value:488,tweenMethod:"linearNone",tween:!0,target:49,key:"y",index:8},{value:80,tweenMethod:"linearNone",tween:!0,target:49,key:"y",index:14}],x:[{value:404,tweenMethod:"linearNone",tween:!1,target:49,key:"x",index:0},{value:404,tweenMethod:"linearNone",tween:!0,target:49,label:null,key:"x",index:3},{value:362.4,tweenMethod:"linearNone",tween:!0,target:49,key:"x",index:4},{value:352,tweenMethod:"linearNone",tween:!0,target:49,key:"x",index:8},{value:79,tweenMethod:"linearNone",tween:!0,target:49,key:"x",index:14}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:49,key:"visible",index:0}],scaleY:[{value:.3,tweenMethod:"linearNone",tween:!1,target:49,key:"scaleY",index:0},{value:.3,tweenMethod:"linearNone",tween:!0,target:49,label:null,key:"scaleY",index:3},{value:.38,tweenMethod:"linearNone",tween:!0,target:49,key:"scaleY",index:4},{value:.4,tweenMethod:"linearNone",tween:!0,target:49,key:"scaleY",index:8},{value:1,tweenMethod:"linearNone",tween:!0,target:49,key:"scaleY",index:14}],scaleX:[{value:.3,tweenMethod:"linearNone",tween:!1,target:49,key:"scaleX",index:0},{value:.3,tweenMethod:"linearNone",tween:!0,target:49,label:null,key:"scaleX",index:3},{value:.38,tweenMethod:"linearNone",tween:!0,target:49,key:"scaleX",index:4},{value:.4,tweenMethod:"linearNone",tween:!0,target:49,key:"scaleX",index:8},{value:1,tweenMethod:"linearNone",tween:!0,target:49,key:"scaleX",index:14}],alpha:[{value:0,tweenMethod:"linearNone",tween:!1,target:49,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:49,label:null,key:"alpha",index:3},{value:.8,tweenMethod:"linearNone",tween:!0,target:49,key:"alpha",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:49,key:"alpha",index:8},{value:1,tweenMethod:"linearNone",tween:!0,target:49,key:"alpha",index:13},{value:0,tweenMethod:"linearNone",tween:!0,target:49,key:"alpha",index:14}]}},{target:50,keyframes:{y:[{value:615,tweenMethod:"linearNone",tween:!1,target:50,key:"y",index:0},{value:615,tweenMethod:"linearNone",tween:!0,target:50,label:null,key:"y",index:1},{value:469,tweenMethod:"linearNone",tween:!0,target:50,key:"y",index:5},{value:79,tweenMethod:"linearNone",tween:!0,target:50,key:"y",index:15}],x:[{value:359,tweenMethod:"linearNone",tween:!1,target:50,key:"x",index:0},{value:359,tweenMethod:"linearNone",tween:!0,target:50,label:null,key:"x",index:1},{value:321,tweenMethod:"linearNone",tween:!0,target:50,key:"x",index:5},{value:79,tweenMethod:"linearNone",tween:!0,target:50,key:"x",index:15}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:50,key:"visible",index:0}],scaleY:[{value:.3,tweenMethod:"linearNone",tween:!1,target:50,key:"scaleY",index:0},{value:.3,tweenMethod:"linearNone",tween:!0,target:50,label:null,key:"scaleY",index:1},{value:.4,tweenMethod:"linearNone",tween:!0,target:50,key:"scaleY",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:50,key:"scaleY",index:15}],scaleX:[{value:.3,tweenMethod:"linearNone",tween:!1,target:50,key:"scaleX",index:0},{value:.3,tweenMethod:"linearNone",tween:!0,target:50,label:null,key:"scaleX",index:1},{value:.4,tweenMethod:"linearNone",tween:!0,target:50,key:"scaleX",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:50,key:"scaleX",index:15}],alpha:[{value:0,tweenMethod:"linearNone",tween:!1,target:50,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:50,label:null,key:"alpha",index:1},{value:1,tweenMethod:"linearNone",tween:!0,target:50,key:"alpha",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:50,key:"alpha",index:14},{value:0,tweenMethod:"linearNone",tween:!0,target:50,key:"alpha",index:15}]}},{target:51,keyframes:{y:[{value:616,tweenMethod:"linearNone",tween:!1,target:51,key:"y",index:0},{value:616,tweenMethod:"linearNone",tween:!0,target:51,label:null,key:"y",index:6},{value:537,tweenMethod:"linearNone",tween:!0,target:51,key:"y",index:8},{value:505,tweenMethod:"linearNone",tween:!0,target:51,key:"y",index:11},{value:80,tweenMethod:"linearNone",tween:!0,target:51,key:"y",index:17}],x:[{value:317,tweenMethod:"linearNone",tween:!1,target:51,key:"x",index:0},{value:317,tweenMethod:"linearNone",tween:!0,target:51,label:null,key:"x",index:6},{value:315,tweenMethod:"linearNone",tween:!0,target:51,key:"x",index:8},{value:312,tweenMethod:"linearNone",tween:!0,target:51,key:"x",index:11},{value:79,tweenMethod:"linearNone",tween:!0,target:51,key:"x",index:17}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:51,key:"visible",index:0}],scaleY:[{value:.5,tweenMethod:"linearNone",tween:!1,target:51,key:"scaleY",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:51,label:null,key:"scaleY",index:6},{value:.5599999999999999,tweenMethod:"linearNone",tween:!0,target:51,key:"scaleY",index:8},{value:.6,tweenMethod:"linearNone",tween:!0,target:51,key:"scaleY",index:11},{value:1,tweenMethod:"linearNone",tween:!0,target:51,key:"scaleY",index:17}],scaleX:[{value:.5,tweenMethod:"linearNone",tween:!1,target:51,key:"scaleX",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:51,label:null,key:"scaleX",index:6},{value:.5599999999999999,tweenMethod:"linearNone",tween:!0,target:51,key:"scaleX",index:8},{value:.6,tweenMethod:"linearNone",tween:!0,target:51,key:"scaleX",index:11},{value:1,tweenMethod:"linearNone",tween:!0,target:51,key:"scaleX",index:17}],alpha:[{value:0,tweenMethod:"linearNone",tween:!1,target:51,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:51,label:null,key:"alpha",index:6},{value:1,tweenMethod:"linearNone",tween:!0,target:51,key:"alpha",index:8},{value:1,tweenMethod:"linearNone",tween:!0,target:51,key:"alpha",index:11},{value:1,tweenMethod:"linearNone",tween:!0,target:51,key:"alpha",index:16},{value:0,tweenMethod:"linearNone",tween:!0,target:51,key:"alpha",index:17}]}},{target:52,keyframes:{y:[{value:588,tweenMethod:"linearNone",tween:!1,target:52,key:"y",index:0},{value:588,tweenMethod:"linearNone",tween:!0,target:52,label:null,key:"y",index:7},{value:517.3333333333334,tweenMethod:"linearNone",tween:!0,target:52,key:"y",index:9},{value:482,tweenMethod:"linearNone",tween:!0,target:52,key:"y",index:13},{value:80,tweenMethod:"linearNone",tween:!0,target:52,key:"y",index:17}],x:[{value:379,tweenMethod:"linearNone",tween:!1,target:52,key:"x",index:0},{value:379,tweenMethod:"linearNone",tween:!0,target:52,label:null,key:"x",index:7},{value:377,tweenMethod:"linearNone",tween:!0,target:52,key:"x",index:9},{value:376,tweenMethod:"linearNone",tween:!0,target:52,key:"x",index:13},{value:79,tweenMethod:"linearNone",tween:!0,target:52,key:"x",index:17}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:52,key:"visible",index:0}],scaleY:[{value:.1,tweenMethod:"linearNone",tween:!1,target:52,key:"scaleY",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:52,label:null,key:"scaleY",index:7},{value:.16666666666666669,tweenMethod:"linearNone",tween:!0,target:52,key:"scaleY",index:9},{value:.2,tweenMethod:"linearNone",tween:!0,target:52,key:"scaleY",index:13},{value:1,tweenMethod:"linearNone",tween:!0,target:52,key:"scaleY",index:17}],scaleX:[{value:.1,tweenMethod:"linearNone",tween:!1,target:52,key:"scaleX",index:0},{value:.1,tweenMethod:"linearNone",tween:!0,target:52,label:null,key:"scaleX",index:7},{value:.16666666666666669,tweenMethod:"linearNone",tween:!0,target:52,key:"scaleX",index:9},{value:.2,tweenMethod:"linearNone",tween:!0,target:52,key:"scaleX",index:13},{value:1,tweenMethod:"linearNone",tween:!0,target:52,key:"scaleX",index:17}],alpha:[{value:0,tweenMethod:"linearNone",tween:!1,target:52,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:52,label:null,key:"alpha",index:7},{value:1,tweenMethod:"linearNone",tween:!0,target:52,key:"alpha",index:9},{value:1,tweenMethod:"linearNone",tween:!0,target:52,key:"alpha",index:13},{value:1,tweenMethod:"linearNone",tween:!0,target:52,key:"alpha",index:16},{value:0,tweenMethod:"linearNone",tween:!0,target:52,key:"alpha",index:17}]}},{target:53,keyframes:{y:[{value:582,tweenMethod:"linearNone",tween:!1,target:53,key:"y",index:0},{value:582,tweenMethod:"linearNone",tween:!0,target:53,label:null,key:"y",index:8},{value:511.8,tweenMethod:"linearNone",tween:!0,target:53,key:"y",index:10},{value:465,tweenMethod:"linearNone",tween:!0,target:53,key:"y",index:13},{value:79,tweenMethod:"linearNone",tween:!0,target:53,key:"y",index:23}],x:[{value:381,tweenMethod:"linearNone",tween:!1,target:53,key:"x",index:0},{value:381,tweenMethod:"linearNone",tween:!0,target:53,label:null,key:"x",index:8},{value:349.2,tweenMethod:"linearNone",tween:!0,target:53,key:"x",index:10},{value:328,tweenMethod:"linearNone",tween:!0,target:53,key:"x",index:13},{value:79,tweenMethod:"linearNone",tween:!0,target:53,key:"x",index:23}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:53,key:"visible",index:0}],scaleY:[{value:.3,tweenMethod:"linearNone",tween:!1,target:53,key:"scaleY",index:0},{value:.3,tweenMethod:"linearNone",tween:!0,target:53,label:null,key:"scaleY",index:8},{value:.36,tweenMethod:"linearNone",tween:!0,target:53,key:"scaleY",index:10},{value:.4,tweenMethod:"linearNone",tween:!0,target:53,key:"scaleY",index:13},{value:1,tweenMethod:"linearNone",tween:!0,target:53,key:"scaleY",index:23}],scaleX:[{value:.3,tweenMethod:"linearNone",tween:!1,target:53,key:"scaleX",index:0},{value:.3,tweenMethod:"linearNone",tween:!0,target:53,label:null,key:"scaleX",index:8},{value:.36,tweenMethod:"linearNone",tween:!0,target:53,key:"scaleX",index:10},{value:.4,tweenMethod:"linearNone",tween:!0,target:53,key:"scaleX",index:13},{value:1,tweenMethod:"linearNone",tween:!0,target:53,key:"scaleX",index:23}],alpha:[{value:0,tweenMethod:"linearNone",tween:!1,target:53,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:53,label:null,key:"alpha",index:8},{value:1,tweenMethod:"linearNone",tween:!0,target:53,key:"alpha",index:10},{value:1,tweenMethod:"linearNone",tween:!0,target:53,key:"alpha",index:13},{value:1,tweenMethod:"linearNone",tween:!0,target:53,key:"alpha",index:22},{value:0,tweenMethod:"linearNone",tween:!0,target:53,key:"alpha",index:23}]}},{target:43,keyframes:{scaleY:[{value:1,tweenMethod:"linearNone",tween:!1,target:43,key:"scaleY",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:43,label:null,key:"scaleY",index:12},{value:1.1,tweenMethod:"linearNone",tween:!0,target:43,key:"scaleY",index:13},{value:1,tweenMethod:"linearNone",tween:!0,target:43,key:"scaleY",index:15},{value:1.1,tweenMethod:"linearNone",tween:!0,target:43,label:null,key:"scaleY",index:16},{value:1,tweenMethod:"linearNone",tween:!0,target:43,label:null,key:"scaleY",index:18},{value:1.1,tweenMethod:"linearNone",tween:!0,target:43,label:null,key:"scaleY",index:19},{value:1,tweenMethod:"linearNone",tween:!0,target:43,label:null,key:"scaleY",index:21},{value:1.1,tweenMethod:"linearNone",tween:!0,target:43,label:null,key:"scaleY",index:22},{value:1,tweenMethod:"linearNone",tween:!0,target:43,label:null,key:"scaleY",index:24},{value:1.1,tweenMethod:"linearNone",tween:!0,target:43,label:null,key:"scaleY",index:25},{value:1,tweenMethod:"linearNone",tween:!0,target:43,label:null,key:"scaleY",index:27}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!1,target:43,key:"scaleX",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:43,label:null,key:"scaleX",index:12},{value:1.1,tweenMethod:"linearNone",tween:!0,target:43,key:"scaleX",index:13},{value:1,tweenMethod:"linearNone",tween:!0,target:43,key:"scaleX",index:15},{value:1.1,tweenMethod:"linearNone",tween:!0,target:43,label:null,key:"scaleX",index:16},{value:1,tweenMethod:"linearNone",tween:!0,target:43,label:null,key:"scaleX",index:18},{value:1.1,tweenMethod:"linearNone",tween:!0,target:43,label:null,key:"scaleX",index:19},{value:1,tweenMethod:"linearNone",tween:!0,target:43,label:null,key:"scaleX",index:21},{value:1.1,tweenMethod:"linearNone",tween:!0,target:43,label:null,key:"scaleX",index:22},{value:1,tweenMethod:"linearNone",tween:!0,target:43,label:null,key:"scaleX",index:24},{value:1.1,tweenMethod:"linearNone",tween:!0,target:43,label:null,key:"scaleX",index:25},{value:1,tweenMethod:"linearNone",tween:!0,target:43,label:null,key:"scaleX",index:27}]}}],name:"ani1",id:1,frameRate:24,action:0}]},i.HuoDeJinBiUI=t}(ui||(ui={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.HuoDePiFuUI.uiView)},e}(View);t.uiView={type:"View",props:{width:720,height:1280},child:[{type:"Image",props:{y:238,x:48,width:618,skin:"tongyong/tu_di.png",sizeGrid:"60,60,60,60",height:608}},{type:"Image",props:{y:330,x:84,width:541,skin:"top/tu_di.png",height:471,alpha:.7}},{type:"Image",props:{y:538,x:345,skin:"scene/huodepifu/tu_3.png",rotation:252,anchorY:.5,anchorX:.5,alpha:.6},compId:47},{type:"Button",props:{y:880,x:395,var:"btn_sure",stateNum:1,skin:"huodepifu/btn_queren.png"},child:[{type:"Image",props:{y:17,x:91,skin:"huodepifu/tu_queren.png"}}]},{type:"Button",props:{y:883,x:71,var:"btn_cancel",stateNum:1,skin:"huodepifu/btn_quxiao.png"},child:[{type:"Image",props:{y:17,x:84,skin:"huodepifu/tu_quxiao.png"}}]},{type:"Image",props:{y:536,x:348,skin:"scene/huodepifu/tu_2.png",rotation:252,anchorY:.5,anchorX:.5,alpha:1},compId:45},{type:"Image",props:{y:372,x:172,skin:"huodepifu/tu_4.png",skewX:0,scaleY:1.5,scaleX:1.5,rotation:363.46153846153845,anchorY:.5,anchorX:.5,alpha:0},compId:48},{type:"Image",props:{y:536,x:350,skin:"huodepifu/tu_1.png",scaleY:2.5,scaleX:2.5,anchorY:.5,anchorX:.5,alpha:0},compId:49},{type:"Label",props:{y:366,x:285,var:"txt_name",text:"球球球球",fontSize:34,color:"#ff1400",bold:!0}},{type:"Label",props:{y:692,x:232,var:"txt_desc",text:"确认1000购买?",fontSize:38,font:"Microsoft YaHei",color:"#ff0400",bold:!1}},{type:"Image",props:{y:730,x:490,skin:"huodepifu/tu_4.png",scaleY:1,scaleX:1,rotation:400,anchorY:.5,anchorX:.5,alpha:0},compId:57},{type:"Image",props:{y:371.33333333333337,x:544.3333333333334,skin:"huodepifu/tu_4.png",scaleY:1.2444444444444445,scaleX:1.2444444444444445,rotation:444.44444444444446,anchorY:.5,anchorX:.5,alpha:.3846153846153846},compId:58},{type:"Image",props:{y:669.3181818181818,x:180.3181818181818,skin:"huodepifu/tu_4.png",scaleY:1.731818181818182,scaleX:1.731818181818182,rotation:414.54545454545456,anchorY:.5,anchorX:.5,alpha:.23076923076923073},compId:59},{type:"Image",props:{y:502,x:127,skin:"huodepifu/tu_4.png",scaleY:1,scaleX:1,rotation:360,anchorY:.5,anchorX:.5,alpha:0},compId:60},{type:"Image",props:{y:280,x:401,skin:"huodepifu/tu_4.png",scaleY:.7,scaleX:.7,rotation:400,anchorY:.5,anchorX:.5,alpha:0},compId:61},{type:"Image",props:{y:612,x:566,skin:"huodepifu/tu_4.png",scaleY:1.5,scaleX:1.5,rotation:370,anchorY:.5,anchorX:.5,alpha:0},compId:62},{type:"Image",props:{y:467,x:274,var:"img_icon",skin:"pifu/role17.png"}},{type:"Image",props:{y:265,x:272,skin:"huodepifu/bt_hdpf.png"}},{type:"Image",props:{y:167,x:223,skin:"tongyong/tu_hdj.png"}}],animations:[{nodes:[{target:49,keyframes:{scaleY:[{value:1,tweenMethod:"linearNone",tween:!0,target:49,key:"scaleY",index:0},{value:2.5,tweenMethod:"linearNone",tween:!1,target:49,key:"scaleY",index:19},{value:1,tweenMethod:"linearNone",tween:!0,target:49,label:null,key:"scaleY",index:30}],scaleX:[{value:1,tweenMethod:"linearNone",tween:!0,target:49,key:"scaleX",index:0},{value:2.5,tweenMethod:"linearNone",tween:!1,target:49,key:"scaleX",index:19},{value:1,tweenMethod:"linearNone",tween:!0,target:49,label:null,key:"scaleX",index:30}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:49,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!1,target:49,key:"alpha",index:19},{value:1,tweenMethod:"linearNone",tween:!0,target:49,label:null,key:"alpha",index:30}]}},{target:48,keyframes:{y:[{value:565,tweenMethod:"linearNone",tween:!0,target:48,key:"y",index:0},{value:405,tweenMethod:"linearNone",tween:!0,target:48,key:"y",index:15}],x:[{value:352,tweenMethod:"linearNone",tween:!0,target:48,key:"x",index:0},{value:185,tweenMethod:"linearNone",tween:!0,target:48,key:"x",index:15}],skewX:[{value:0,tweenMethod:"linearNone",tween:!0,target:48,key:"skewX",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:48,key:"skewX",index:26}],scaleY:[{value:.5,tweenMethod:"linearNone",tween:!0,target:48,key:"scaleY",index:0},{value:1.5,tweenMethod:"linearNone",tween:!0,target:48,key:"scaleY",index:15}],scaleX:[{value:.5,tweenMethod:"linearNone",tween:!0,target:48,key:"scaleX",index:0},{value:1.5,tweenMethod:"linearNone",tween:!0,target:48,key:"scaleX",index:15}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:48,key:"rotation",index:0},{value:450,tweenMethod:"linearNone",tween:!0,target:48,key:"rotation",index:26}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:48,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:48,key:"alpha",index:9},{value:0,tweenMethod:"linearNone",tween:!0,target:48,key:"alpha",index:18}]}},{target:57,keyframes:{y:[{value:578,tweenMethod:"linearNone",tween:!1,target:57,key:"y",index:0},{value:600,tweenMethod:"linearNone",tween:!0,target:57,label:null,key:"y",index:4},{value:763,tweenMethod:"linearNone",tween:!0,target:57,key:"y",index:19}],x:[{value:364,tweenMethod:"linearNone",tween:!1,target:57,key:"x",index:0},{value:374,tweenMethod:"linearNone",tween:!0,target:57,label:null,key:"x",index:4},{value:503,tweenMethod:"linearNone",tween:!0,target:57,key:"x",index:19}],scaleY:[{value:.5,tweenMethod:"linearNone",tween:!1,target:57,key:"scaleY",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:57,label:null,key:"scaleY",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:57,key:"scaleY",index:19}],scaleX:[{value:.5,tweenMethod:"linearNone",tween:!1,target:57,key:"scaleX",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:57,label:null,key:"scaleX",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:57,key:"scaleX",index:19}],rotation:[{value:0,tweenMethod:"linearNone",tween:!1,target:57,key:"rotation",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:57,label:null,key:"rotation",index:4},{value:400,tweenMethod:"linearNone",tween:!0,target:57,key:"rotation",index:19}],alpha:[{value:0,tweenMethod:"linearNone",tween:!1,target:57,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:57,label:null,key:"alpha",index:4},{value:1,tweenMethod:"linearNone",tween:!0,target:57,key:"alpha",index:10},{value:0,tweenMethod:"linearNone",tween:!0,target:57,key:"alpha",index:21}]}},{target:58,keyframes:{y:[{value:567,tweenMethod:"linearNone",tween:!1,target:58,key:"y",index:0},{value:567,tweenMethod:"linearNone",tween:!0,target:58,label:null,key:"y",index:5},{value:384,tweenMethod:"linearNone",tween:!0,target:58,key:"y",index:23}],x:[{value:360,tweenMethod:"linearNone",tween:!1,target:58,key:"x",index:0},{value:360,tweenMethod:"linearNone",tween:!0,target:58,label:null,key:"x",index:5},{value:582,tweenMethod:"linearNone",tween:!0,target:58,key:"x",index:23}],scaleY:[{value:.8,tweenMethod:"linearNone",tween:!1,target:58,key:"scaleY",index:0},{value:.8,tweenMethod:"linearNone",tween:!0,target:58,label:null,key:"scaleY",index:5},{value:1.3,tweenMethod:"linearNone",tween:!0,target:58,key:"scaleY",index:23}],scaleX:[{value:.8,tweenMethod:"linearNone",tween:!1,target:58,key:"scaleX",index:0},{value:.8,tweenMethod:"linearNone",tween:!0,target:58,label:null,key:"scaleX",index:5},{value:1.3,tweenMethod:"linearNone",tween:!0,target:58,key:"scaleX",index:23}],rotation:[{value:0,tweenMethod:"linearNone",tween:!1,target:58,key:"rotation",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:58,label:null,key:"rotation",index:5},{value:500,tweenMethod:"linearNone",tween:!0,target:58,key:"rotation",index:23}],alpha:[{value:0,tweenMethod:"linearNone",tween:!1,target:58,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:58,key:"alpha",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:58,key:"alpha",index:13},{value:0,tweenMethod:"linearNone",tween:!0,target:58,key:"alpha",index:26}]}},{target:59,keyframes:{y:[{value:565,tweenMethod:"linearNone",tween:!1,target:59,key:"y",index:0},{value:565,tweenMethod:"linearNone",tween:!0,target:59,label:null,key:"y",index:2},{value:724,tweenMethod:"linearNone",tween:!0,target:59,key:"y",index:24}],x:[{value:360,tweenMethod:"linearNone",tween:!1,target:59,key:"x",index:0},{value:360,tweenMethod:"linearNone",tween:!0,target:59,label:null,key:"x",index:2},{value:167,tweenMethod:"linearNone",tween:!0,target:59,key:"x",index:24}],scaleY:[{value:1.5,tweenMethod:"linearNone",tween:!1,target:59,key:"scaleY",index:0},{value:1.3,tweenMethod:"linearNone",tween:!0,target:59,label:null,key:"scaleY",index:2},{value:1.8,tweenMethod:"linearNone",tween:!0,target:59,key:"scaleY",index:24}],scaleX:[{value:1.5,tweenMethod:"linearNone",tween:!1,target:59,key:"scaleX",index:0},{value:1.3,tweenMethod:"linearNone",tween:!0,target:59,label:null,key:"scaleX",index:2},{value:1.8,tweenMethod:"linearNone",tween:!0,target:59,key:"scaleX",index:24}],rotation:[{value:0,tweenMethod:"linearNone",tween:!1,target:59,key:"rotation",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:59,label:null,key:"rotation",index:2},{value:480,tweenMethod:"linearNone",tween:!0,target:59,key:"rotation",index:24}],alpha:[{value:0,tweenMethod:"linearNone",tween:!1,target:59,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:59,label:null,key:"alpha",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:59,key:"alpha",index:11},{value:0,tweenMethod:"linearNone",tween:!0,target:59,key:"alpha",index:24}]}},{target:60,keyframes:{y:[{value:563,tweenMethod:"linearNone",tween:!1,target:60,key:"y",index:0},{value:563,tweenMethod:"linearNone",tween:!0,target:60,label:null,key:"y",index:2},{value:535,tweenMethod:"linearNone",tween:!0,target:60,key:"y",index:14}],x:[{value:359,tweenMethod:"linearNone",tween:!1,target:60,key:"x",index:0},{value:359,tweenMethod:"linearNone",tween:!0,target:60,label:null,key:"x",index:2},{value:140,tweenMethod:"linearNone",tween:!0,target:60,key:"x",index:14}],scaleY:[{value:.5,tweenMethod:"linearNone",tween:!1,target:60,key:"scaleY",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:60,label:null,key:"scaleY",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:60,key:"scaleY",index:14}],scaleX:[{value:.5,tweenMethod:"linearNone",tween:!1,target:60,key:"scaleX",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:60,label:null,key:"scaleX",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:60,key:"scaleX",index:14}],rotation:[{value:0,tweenMethod:"linearNone",tween:!1,target:60,key:"rotation",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:60,label:null,key:"rotation",index:2},{value:360,tweenMethod:"linearNone",tween:!0,target:60,key:"rotation",index:14}],alpha:[{value:1,tweenMethod:"linearNone",tween:!1,target:60,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:60,label:null,key:"alpha",index:2},{value:1,tweenMethod:"linearNone",tween:!0,target:60,key:"alpha",index:6},{value:0,tweenMethod:"linearNone",tween:!0,target:60,key:"alpha",index:14}]}},{target:61,keyframes:{y:[{value:567,tweenMethod:"linearNone",tween:!1,target:61,key:"y",index:0},{value:567,tweenMethod:"linearNone",tween:!0,target:61,label:null,key:"y",index:3},{value:313,tweenMethod:"linearNone",tween:!0,target:61,key:"y",index:17}],x:[{value:360,tweenMethod:"linearNone",tween:!1,target:61,key:"x",index:0},{value:360,tweenMethod:"linearNone",tween:!0,target:61,label:null,key:"x",index:3},{value:414,tweenMethod:"linearNone",tween:!0,target:61,key:"x",index:17}],scaleY:[{value:.3,tweenMethod:"linearNone",tween:!1,target:61,key:"scaleY",index:0},{value:.3,tweenMethod:"linearNone",tween:!0,target:61,label:null,key:"scaleY",index:3},{value:.7,tweenMethod:"linearNone",tween:!0,target:61,key:"scaleY",index:17}],scaleX:[{value:.3,tweenMethod:"linearNone",tween:!1,target:61,key:"scaleX",index:0},{value:.3,tweenMethod:"linearNone",tween:!0,target:61,label:null,key:"scaleX",index:3},{value:.7,tweenMethod:"linearNone",tween:!0,target:61,key:"scaleX",index:17}],rotation:[{value:0,tweenMethod:"linearNone",tween:!1,target:61,key:"rotation",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:61,label:null,key:"rotation",index:3},{value:400,tweenMethod:"linearNone",tween:!0,target:61,key:"rotation",index:17}],alpha:[{value:0,tweenMethod:"linearNone",tween:!1,target:61,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:61,label:null,key:"alpha",index:3},{value:1,tweenMethod:"linearNone",tween:!0,target:61,key:"alpha",index:9},{value:0,tweenMethod:"linearNone",tween:!0,target:61,key:"alpha",index:17}]}},{target:62,keyframes:{y:[{value:566,tweenMethod:"linearNone",tween:!0,target:62,key:"y",index:0},{value:645,tweenMethod:"linearNone",tween:!0,target:62,key:"y",index:14}],x:[{value:355,tweenMethod:"linearNone",tween:!0,target:62,key:"x",index:0},{value:579,tweenMethod:"linearNone",tween:!0,target:62,key:"x",index:14}],scaleY:[{value:1.2,tweenMethod:"linearNone",tween:!0,target:62,key:"scaleY",index:0},{value:1.5,tweenMethod:"linearNone",tween:!0,target:62,key:"scaleY",index:14}],scaleX:[{value:1.2,tweenMethod:"linearNone",tween:!0,target:62,key:"scaleX",index:0},{value:1.5,tweenMethod:"linearNone",tween:!0,target:62,key:"scaleX",index:14}],rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:62,key:"rotation",index:0},{value:370,tweenMethod:"linearNone",tween:!0,target:62,key:"rotation",index:14}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:62,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:62,key:"alpha",index:7},{value:0,tweenMethod:"linearNone",tween:!0,target:62,key:"alpha",index:14}]}},{target:45,keyframes:{rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:45,key:"rotation",index:0},{value:360,tweenMethod:"linearNone",tween:!0,target:45,key:"rotation",index:30}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:45,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:45,key:"alpha",index:15},{value:1,tweenMethod:"linearNone",tween:!0,target:45,key:"alpha",index:30}]}},{target:47,keyframes:{rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:47,key:"rotation",index:0},{value:360,tweenMethod:"linearNone",tween:!0,target:47,key:"rotation",index:30}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:47,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:47,key:"alpha",index:15},{value:0,tweenMethod:"linearNone",tween:!0,target:47,key:"alpha",index:30}]}}],name:"ani1",id:1,frameRate:24,action:2}]},i.HuoDePiFuUI=t}(ui||(ui={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.JieSuanUI.uiView)},e}(View);t.uiView={type:"View",props:{width:720,height:1280},child:[{type:"Image",props:{y:1013,x:0,width:718,var:"img_ban",height:270}},{type:"Box",props:{y:28,x:29},child:[{type:"Image",props:{y:10,x:47,skin:"tongyong/tu_shuzidi.png"}},{type:"Image",props:{skin:"tongyong/tu_jinbi.png"}},{type:"Label",props:{y:22,x:84,width:127,var:"txtMoney",text:"123456",height:34,fontSize:34,font:"Arial",color:"#ffffff",bold:!0,align:"left"}}]},{type:"Box",props:{y:170,x:0,width:721,height:191},child:[{type:"Label",props:{y:15,x:211,width:291,text:"当前成绩",height:48,fontSize:26,color:"#ffffff",bold:!0,align:"center"}},{type:"Label",props:{y:56,var:"txt_score",text:"0000",fontSize:80,color:"#ffc047",centerX:0,bold:!0,align:"center"}}]},{type:"Button",props:{y:808,x:372,var:"btn_share",stateNum:1,skin:"tongyong/btn_2.png",anchorY:.5,anchorX:.5},child:[{type:"Image",props:{y:26,x:67,skin:"jiesuan/tu_fqtz.png"}}]},{type:"Button",props:{y:923,x:372,var:"btn_restart",stateNum:1,skin:"tongyong/btn_1.png",anchorY:.5,anchorX:.5},child:[{type:"Image",props:{y:29,x:68,skin:"jiesuan/tu_zlyj.png"}}]},{type:"Box",props:{y:328,x:54},child:[{type:"Image",props:{y:0,x:0,width:619,skin:"tongyong/tu_di.png",sizeGrid:"60,60,60,60",height:374}},{type:"Image",props:{y:60,x:28,width:564,skin:"top/tu_di.png",sizeGrid:"30,30,30,30",height:288,alpha:.7}},{type:"Label",props:{y:22,x:430,width:158,visible:!0,var:"txt_allTop",underline:!0,text:"查看全部排行",height:36,fontSize:26,color:"#ffffff",bold:!0,align:"right"}},{type:"Image",props:{y:96,x:39,width:542,var:"mouseLayer",height:211}},{type:"Image",props:{y:10,x:26,skin:"top/tu_hyphb1.png"}}]},{type:"Box",props:{y:145,x:172,var:"box_isNew"},child:[{type:"Image",props:{skin:"tongyong/tu_xjl.png"}}]},{type:"Button",props:{y:195,x:92,var:"btn_skip",stateNum:1,skin:"tongyong/btn_fh.png",anchorY:.5,anchorX:.5}}]},i.JieSuanUI=t}(ui||(ui={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("ui.component.QianDao_TUI",i.component.QianDao_TUI),t.prototype.createChildren.call(this),this.createView(i.LianXuDengLuUI.uiView)},e}(View);t.uiView={type:"View",props:{width:750,height:1334},child:[{type:"Button",props:{y:93,x:82,var:"btnHome",stateNum:1,skin:"tongyong/btn_fh.png",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:281,width:672,skin:"tongyong/tu_di.png",sizeGrid:"60,60,60,60",height:649,centerX:1}},{type:"Button",props:{y:1029,x:375,width:305,var:"btn_double",stateNum:1,skin:"tongyong/btn_1.png",height:95,anchorY:.5,anchorX:.5},child:[{type:"Image",props:{y:48,var:"img_txt",skin:"qiridenglu/tu_lqjl.png",centerX:3,anchorY:.5,anchorX:.5}}]},{type:"CheckBox",props:{y:849,x:205,var:"checkBox",skin:"tongyong/checkbox_1.png"},child:[{type:"Label",props:{y:13,x:51,width:349,text:"观看视频使你的奖励翻倍",height:32,fontSize:26,color:"#ffffff",bold:!0,align:"left"}}]},{type:"Image",props:{y:208,x:246,skin:"tongyong/tu_hdj.png"}},{type:"List",props:{y:359,x:70,width:619,var:"list_day",height:495},child:[{type:"QianDao_T",props:{y:0,x:0,renderType:"render",runtime:"ui.component.QianDao_TUI"}}]},{type:"Image",props:{y:1058,x:19,width:718,var:"img_ban",height:270}}]},i.LianXuDengLuUI=t}(ui||(ui={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.logoUI.uiView)},e}(View);t.uiView={type:"View",props:{width:750,height:1334},child:[{type:"Box",props:{y:0,x:0,width:753,height:1334},child:[{type:"Image",props:{var:"img_bk",skin:"tongyong/tu_fkw.jpg"}},{type:"Box",props:{y:964,width:750,var:"box_tip"},child:[{type:"Label",props:{y:243.5,x:375,width:750,text:"抵制不良游戏，拒绝盗版游戏，注意自我保护，谨防受骗上当\\n适度游戏益脑，沉迷游戏伤身，合理安排时间，享受健康生活",leading:12,height:68,fontSize:22,font:"SimHei",color:"#8e8e8e",bold:!0,anchorY:.5,anchorX:.5,align:"center"}},{type:"Label",props:{y:131.5,x:375,width:750,text:"本游戏适合年满7周岁以上的用户使用\\n请您确定已如实进行实名注册\\n为了您的健康，请合理控制游戏时间",leading:20,height:143,fontSize:24,font:"SimHei",color:"#8e8e8e",bold:!0,anchorY:.5,anchorX:.5,align:"center"}},{type:"Label",props:{y:19.5,x:375,width:750,text:"健康提示",leading:20,height:39,fontSize:32,font:"SimHei",color:"#8e8e8e",bold:!0,anchorY:.5,anchorX:.5,align:"center"}}]},{type:"Label",props:{y:839,x:374,width:750,var:"lab_jindu",text:"当前加载进度：100%",leading:12,height:68,fontSize:22,color:"#000000",bold:!0,anchorY:.5,anchorX:.5,align:"center"}}]}]},i.logoUI=t}(ui||(ui={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("ui.component.PiFuItemUI",i.component.PiFuItemUI),t.prototype.createChildren.call(this),this.createView(i.PiFuUI.uiView)},e}(View);t.uiView={type:"View",props:{width:750,height:1334},child:[{type:"Button",props:{y:36,x:41,var:"btn_back",stateNum:1,skin:"tongyong/btn_fh.png"}},{type:"Box",props:{y:172,x:102},child:[{type:"Image",props:{y:66,width:557,skin:"tongyong/tu_di.png",sizeGrid:"30,30,30,30",height:653}},{type:"Image",props:{x:146,skin:"tongyong/tu_hdj.png"}},{type:"Button",props:{y:115,x:41,var:"btn_skin",stateNum:2,skin:"pifu/btn_pifu.png"}},{type:"Button",props:{y:115,x:308,var:"btn_eff",stateNum:2,skin:"pifu/btn_texiao.png"}},{type:"Panel",props:{y:192,x:26,width:514,height:497},child:[{type:"List",props:{width:506,var:"list_skin",spaceY:10,spaceX:10,repeatY:3,repeatX:3,height:496},child:[{type:"PiFuItem",props:{visible:!1,renderType:"render",runtime:"ui.component.PiFuItemUI"}}]}]}]},{type:"Button",props:{y:941,x:230,var:"btn_free",stateNum:1,skin:"tongyong/btn_1.png"},child:[{type:"Image",props:{y:31,x:25,skin:"pifu/zuansi.png"}},{type:"Label",props:{y:30,x:76,width:195,text:"免费获得100",height:38,fontSize:34,font:"SimHei",color:"#ffffff",bold:!0}}]}]},i.PiFuUI=t}(ui||(ui={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.PlayUI.uiView)},e}(View);t.uiView={type:"View",props:{width:720,height:1280},child:[{type:"Image",props:{y:1015,x:-2,width:718,var:"img_ban",height:270}},{type:"Button",props:{y:753,x:359,var:"btn_start",stateNum:1,skin:"play/btn_kaishi.png",scaleY:.9,scaleX:.9,anchorY:.5,anchorX:.5}},{type:"Box",props:{y:777,x:169,var:"box_huadong"},child:[{type:"Image",props:{skin:"play/tiao.png"}},{type:"Image",props:{y:0,x:335,var:"img_start_hand",skin:"play/shou.png"}}]},{type:"Label",props:{y:421,width:234,var:"txt_best",text:"100",height:80,fontSize:80,color:"#ffffff",centerX:8,bold:!0,align:"center"}},{type:"Image",props:{y:682,x:260,visible:!1,var:"img_share2",skin:"tongyong/jb11.png",scaleY:.9,scaleX:.9}},{type:"Image",props:{y:384,x:305,var:"img_best",skin:"play/tu_lszj.png"}},{type:"Image",props:{y:595,x:245,var:"img_more",skin:"tongyong/img_gg.png",scaleY:.7,scaleX:.7,pivotY:.5,pivotX:.5}},{type:"Label",props:{y:805,x:27,var:"txt_ver",text:"v0.90.3",fontSize:30,color:"#ffffff",bold:!0,align:"center"}},{type:"Image",props:{y:473,x:6,width:200,var:"img_ad",height:200},compId:156},{type:"Box",props:{y:21,x:21,var:"box_view"},child:[{type:"Box",props:{y:3,x:1,var:"box_coin",scaleY:.9,scaleX:.9},child:[{type:"Image",props:{y:6,x:34,skin:"tongyong/tu_shuzidi.png"}},{type:"Image",props:{y:0,x:0,skin:"tongyong/tu_jinbi.png",scaleY:.7,scaleX:.7}},{type:"Label",props:{y:9,x:62,width:127,var:"txtMoney",text:"123456",height:34,fontSize:34,font:"Arial",color:"#ffcf17",bold:!0,align:"left"}}]},{type:"Button",props:{y:193,x:628,var:"btn_zhuanpan",stateNum:1,skin:"play/btn_xyzp.png",scaleY:.9,scaleX:.9,anchorY:.5,anchorX:.5},child:[{type:"Image",props:{y:16,x:20,skin:"play/hong.png",alpha:1},compId:135},{type:"Image",props:{y:3,x:52,skin:"play/huang.png",alpha:0},compId:136},{type:"Image",props:{y:16,x:81,skin:"play/zi.png",alpha:0},compId:137},{type:"Image",props:{y:46,x:8,skin:"play/lan.png",alpha:1},compId:138},{type:"Image",props:{y:73,x:19,skin:"play/huang.png",scaleY:1.1,scaleX:1.1,alpha:1},compId:139},{type:"Image",props:{y:46,x:93,skin:"play/lan.png",alpha:0},compId:141},{type:"Image",props:{y:73,x:82,skin:"play/hong.png",alpha:1},compId:142}]},{type:"Button",props:{y:323,x:630,var:"btn_qd",stateNum:1,skin:"play/btn_qiandao.png",scaleY:.9,scaleX:.9,anchorY:.5,anchorX:.5},compId:116},{type:"Button",props:{y:453,x:630,var:"btn_fuhuo",stateNum:1,skin:"play/btn_fhb.png",scaleY:.9,scaleX:.9,anchorY:.5,anchorX:.5}},{type:"Button",props:{y:634,x:622,var:"btn_skin",stateNum:1,skin:"play/btn_pifu.png",scaleY:.9,scaleX:.9,anchorY:.5,anchorX:.5}},{type:"Button",props:{y:634,x:53,var:"btn_top",stateNum:1,skin:"play/btn_paihangbang.png",scaleY:.9,scaleX:.9,anchorY:.5,anchorX:.5}},{type:"Box",props:{y:832,x:551,var:"box_share"},child:[{type:"Button",props:{y:92,x:72,var:"btn_share",stateNum:1,skin:"play/btn_fenxiang1.png",scaleY:.9,scaleX:.9,anchorY:.5,anchorX:.5}},{type:"Image",props:{var:"img_share1",skin:"tongyong/jb.png",scaleY:.9,scaleX:.9}}]},{type:"Button",props:{y:931,x:251,var:"btn_want",stateNum:1,skin:"play/btn_wyjb.png",scaleY:.9,scaleX:.9,anchorY:.5,anchorX:.5},child:[{type:"Image",props:{y:17,x:98,skin:"play/xingguang.png",scaleY:.45,scaleX:.45,anchorY:.5,anchorX:.5},compId:129},{type:"Image",props:{y:48,x:58,skin:"play/xingguang.png",scaleY:.125,scaleX:.075,anchorY:.5,anchorX:.5},compId:130},{type:"Image",props:{y:32,x:44,skin:"play/xingguang.png",scaleY:.2571428571428571,scaleX:.08571428571428573,anchorY:.5,anchorX:.5},compId:131},{type:"Image",props:{y:61,x:16,skin:"play/xingguang.png",scaleY:0,scaleX:0,anchorY:.5,anchorX:.5},compId:132},{type:"Image",props:{y:22,x:21,skin:"play/xingguang.png",scaleY:.23333333333333328,scaleX:.09999999999999999,anchorY:.5,anchorX:.5},compId:133},{type:"Image",props:{y:70,x:92,skin:"play/xingguang.png",scaleY:.18000000000000002,scaleX:.135,anchorY:.5,anchorX:.5},compId:134}]},{type:"Button",props:{y:923,x:45,var:"btn_chengjiu",stateNum:1,skin:"play/btn_chengjiu.png",scaleY:.9,scaleX:.9,anchorY:.5,anchorX:.5}},{type:"Button",props:{y:923,x:475,var:"btn_levelUp",stateNum:1,skin:"play/btn_djsj.png",scaleY:.9,scaleX:.9,anchorY:.5,anchorX:.5}},{type:"Box",props:{y:86,x:-7,visible:!1,var:"box_head"},child:[{type:"Panel",props:{y:52,x:5,width:122,var:"panl_tuo",name:"panl_tuo",height:294},child:[{type:"Box",props:{y:-39,x:8,width:114,var:"box_xiala",scaleY:.9,scaleX:.9,height:375},child:[{type:"Image",props:{y:44,x:4,width:105,skin:"play/tu_1.png",sizeGrid:"45,0,53,0",height:317},child:[{type:"Button",props:{y:235,x:52,var:"btn_zhenD",stateNum:2,skin:"play/btn_zhendong.png",anchorY:.5,anchorX:.5}},{type:"Button",props:{y:124,x:52,var:"btn_voice",stateNum:2,skin:"play/btn_shengyin.png",anchorY:.5,anchorX:.5}}]}]}]},{type:"Box",props:{var:"box_set"},child:[{type:"Image",props:{y:10,x:10,width:106,skin:"play/tu_2.png",height:109}},{type:"Box",props:{y:10,x:10},child:[{type:"Sprite",props:{y:2,x:3,renderType:"mask"},child:[{type:"Circle",props:{y:50,x:50,radius:46,lineWidth:1,fillColor:"#ff0000"}}]},{type:"Image",props:{y:0,x:0,width:106,var:"img_head",skin:"play/tu_2.png",height:109}}]}]},{type:"Image",props:{y:77,x:85,var:"img_sanjiao",skin:"play/tu_sanjian.png",rotation:180}}]}]}],animations:[{nodes:[{target:116,keyframes:{width:[{value:112,tweenMethod:"linearNone",tween:!1,target:116,key:"width",index:0},{value:127,tweenMethod:"linearNone",tween:!0,target:116,key:"width",index:7},{value:92,tweenMethod:"linearNone",tween:!0,target:116,key:"width",index:10},{value:123,tweenMethod:"linearNone",tween:!0,target:116,key:"width",index:14},{value:112,tweenMethod:"linearNone",tween:!0,target:116,key:"width",index:18},{value:116,tweenMethod:"linearNone",tween:!0,target:116,key:"width",index:22},{value:112,tweenMethod:"linearNone",tween:!1,target:116,key:"width",index:27},{value:112,tweenMethod:"linearNone",tween:!1,target:116,label:null,key:"width",index:50}],height:[{value:116,tweenMethod:"linearNone",tween:!0,target:116,key:"height",index:0},{value:131,tweenMethod:"linearNone",tween:!0,target:116,key:"height",index:4},{value:69,tweenMethod:"linearNone",tween:!0,target:116,key:"height",index:7},{value:121,tweenMethod:"linearNone",tween:!0,target:116,key:"height",index:10},{value:110,tweenMethod:"linearNone",tween:!0,target:116,key:"height",index:14},{value:116,tweenMethod:"linearNone",tween:!1,target:116,key:"height",index:18},{value:116,tweenMethod:"linearNone",tween:!0,target:116,label:null,key:"height",index:50}]}}],name:"ani1",id:1,frameRate:24,action:2},{nodes:[{target:129,keyframes:{scaleY:[{value:0,tweenMethod:"linearNone",tween:!0,target:129,key:"scaleY",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:129,key:"scaleY",index:10},{value:0,tweenMethod:"linearNone",tween:!1,target:129,key:"scaleY",index:17}],scaleX:[{value:0,tweenMethod:"linearNone",tween:!0,target:129,key:"scaleX",index:0},{value:.5,tweenMethod:"linearNone",tween:!0,target:129,key:"scaleX",index:10},{value:0,tweenMethod:"linearNone",tween:!1,target:129,key:"scaleX",index:17}]}},{target:130,keyframes:{scaleY:[{value:.5,tweenMethod:"linearNone",tween:!1,target:130,key:"scaleY",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:130,key:"scaleY",index:6},{value:.5,tweenMethod:"linearNone",tween:!0,target:130,key:"scaleY",index:18},{value:0,tweenMethod:"linearNone",tween:!1,target:130,key:"scaleY",index:26}],scaleX:[{value:0,tweenMethod:"linearNone",tween:!1,target:130,key:"scaleX",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:130,key:"scaleX",index:6},{value:.3,tweenMethod:"linearNone",tween:!0,target:130,key:"scaleX",index:18},{value:0,tweenMethod:"linearNone",tween:!1,target:130,key:"scaleX",index:26}]}},{target:131,keyframes:{scaleY:[{value:0,tweenMethod:"linearNone",tween:!1,target:131,key:"scaleY",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:131,key:"scaleY",index:3},{value:.3,tweenMethod:"linearNone",tween:!0,target:131,key:"scaleY",index:10},{value:0,tweenMethod:"linearNone",tween:!1,target:131,key:"scaleY",index:16}],scaleX:[{value:0,tweenMethod:"linearNone",tween:!1,target:131,key:"scaleX",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:131,key:"scaleX",index:3},{value:.1,tweenMethod:"linearNone",tween:!0,target:131,key:"scaleX",index:10},{value:0,tweenMethod:"linearNone",tween:!1,target:131,key:"scaleX",index:16}]}},{target:132,keyframes:{scaleY:[{value:0,tweenMethod:"linearNone",tween:!1,target:132,key:"scaleY",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:132,key:"scaleY",index:9},{value:.4,tweenMethod:"linearNone",tween:!0,target:132,key:"scaleY",index:20},{value:0,tweenMethod:"linearNone",tween:!1,target:132,key:"scaleY",index:28}],scaleX:[{value:0,tweenMethod:"linearNone",tween:!1,target:132,key:"scaleX",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:132,key:"scaleX",index:9},{value:.2,tweenMethod:"linearNone",tween:!0,target:132,key:"scaleX",index:20},{value:0,tweenMethod:"linearNone",tween:!1,target:132,key:"scaleX",index:28}]}},{target:133,keyframes:{scaleY:[{value:0,tweenMethod:"linearNone",tween:!1,target:133,key:"scaleY",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:133,key:"scaleY",index:6},{value:.7,tweenMethod:"linearNone",tween:!0,target:133,key:"scaleY",index:15},{value:0,tweenMethod:"linearNone",tween:!1,target:133,key:"scaleY",index:27}],scaleX:[{value:0,tweenMethod:"linearNone",tween:!1,target:133,key:"scaleX",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:133,key:"scaleX",index:6},{value:.3,tweenMethod:"linearNone",tween:!0,target:133,key:"scaleX",index:15},{value:0,tweenMethod:"linearNone",tween:!1,target:133,key:"scaleX",index:27}]}},{target:134,keyframes:{scaleY:[{value:0,tweenMethod:"linearNone",tween:!0,target:134,key:"scaleY",index:0},{value:.2,tweenMethod:"linearNone",tween:!0,target:134,key:"scaleY",index:8},{value:0,tweenMethod:"linearNone",tween:!0,target:134,key:"scaleY",index:18}],scaleX:[{value:0,tweenMethod:"linearNone",tween:!0,target:134,key:"scaleX",index:0},{value:.15,tweenMethod:"linearNone",tween:!0,target:134,key:"scaleX",index:8},{value:0,tweenMethod:"linearNone",tween:!0,target:134,key:"scaleX",index:18}]}}],name:"ani2",id:2,frameRate:24,action:2},{nodes:[{target:135,keyframes:{alpha:[{value:0,tweenMethod:"linearNone",tween:!1,target:135,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:135,key:"alpha",index:6}]}},{target:136,keyframes:{alpha:[{value:0,tweenMethod:"linearNone",tween:!1,target:136,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:136,key:"alpha",index:7}]}},{target:137,keyframes:{alpha:[{value:0,tweenMethod:"linearNone",tween:!1,target:137,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:137,key:"alpha",index:9}]}},{target:138,keyframes:{y:[{value:46,tweenMethod:"linearNone",tween:!1,target:138,key:"y",index:0},{value:46,tweenMethod:"linearNone",tween:!0,target:138,key:"y",index:5}],x:[{value:93,tweenMethod:"linearNone",tween:!1,target:138,key:"x",index:0},{value:8,tweenMethod:"linearNone",tween:!0,target:138,key:"x",index:5}],alpha:[{value:0,tweenMethod:"linearNone",tween:!1,target:138,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:138,key:"alpha",index:5}]}},{target:139,keyframes:{alpha:[{value:0,tweenMethod:"linearNone",tween:!1,target:139,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:139,key:"alpha",index:2}]}},{target:141,keyframes:{alpha:[{value:0,tweenMethod:"linearNone",tween:!1,target:141,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:141,key:"alpha",index:11}]}},{target:142,keyframes:{alpha:[{value:1,tweenMethod:"linearNone",tween:!1,target:142,key:"alpha",index:0},{value:0,tweenMethod:"linearNone",tween:!0,target:142,key:"alpha",index:13}]}}],name:"ani3",id:3,frameRate:24,action:2},{nodes:[],name:"ani4",id:4,frameRate:24,action:1},{nodes:[],name:"ani5",id:5,frameRate:24,action:2},{nodes:[{target:156,keyframes:{y:[{value:473,tweenMethod:"linearNone",tween:!0,target:156,key:"y",index:0},{value:448,tweenMethod:"linearNone",tween:!0,target:156,key:"y",index:6},{value:473,tweenMethod:"linearNone",tween:!0,target:156,key:"y",index:9},{value:458,tweenMethod:"linearNone",tween:!0,target:156,key:"y",index:13},{value:473,tweenMethod:"linearNone",tween:!0,target:156,key:"y",index:16}],x:[{value:6,tweenMethod:"linearNone",tween:!0,target:156,key:"x",index:0},{value:6,tweenMethod:"linearNone",tween:!0,target:156,key:"x",index:55}]}}],name:"ani6",id:6,frameRate:24,action:2}]},i.PlayUI=t}(ui||(ui={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.TipGoldUI.uiView)},e}(View);t.uiView={type:"View",props:{width:120,height:150}},i.TipGoldUI=t}(ui||(ui={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.Tips_21UI.uiView)},e}(View);t.uiView={type:"View",props:{width:750,height:1334},child:[{type:"Label",props:{y:530,x:91,width:583,var:"txt_JD",text:"你的金钱不足",height:29,fontSize:30,font:"SimHei",color:"#ffffff",bold:!0,align:"center"}}]},i.Tips_21UI=t}(ui||(ui={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.Tips_3UI.uiView)},e}(View);t.uiView={type:"View",props:{width:750,height:1334},child:[{type:"Image",props:{y:223,x:377,skin:"tongyong/tu_tishikuang.png",anchorY:.5,anchorX:.5,alpha:.5882352941176471},compId:108},{type:"Label",props:{y:219.47058823529412,x:375,width:583,var:"txt_gold",text:"你的金钱不足",height:29,fontSize:40,font:"SimHei",color:"#ffffff",bold:!0,anchorY:.5,anchorX:.5,alpha:.5882352941176471,align:"center"},compId:107}],animations:[{nodes:[{target:107,keyframes:{y:[{value:308,tweenMethod:"linearNone",tween:!0,target:107,key:"y",index:0},{value:308,tweenMethod:"linearNone",tween:!1,target:107,key:"y",index:5},{value:308,tweenMethod:"linearNone",tween:!0,target:107,key:"y",index:11},{value:93,tweenMethod:"linearNone",tween:!0,target:107,key:"y",index:28}],x:[{value:-343,tweenMethod:"linearNone",tween:!0,target:107,key:"x",index:0},{value:399,tweenMethod:"linearNone",tween:!0,target:107,key:"x",index:5},{value:386,tweenMethod:"linearNone",tween:!0,target:107,key:"x",index:6},{value:375,tweenMethod:"linearNone",tween:!1,target:107,label:null,key:"x",index:8},{value:375,tweenMethod:"linearNone",tween:!0,target:107,label:null,key:"x",index:11}],alpha:[{value:1,tweenMethod:"linearNone",tween:!1,target:107,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!1,target:107,key:"alpha",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:107,label:null,key:"alpha",index:11},{value:0,tweenMethod:"linearNone",tween:!0,target:107,key:"alpha",index:28}]}},{target:108,keyframes:{y:[{value:313,tweenMethod:"linearNone",tween:!0,target:108,key:"y",index:0},{value:313,tweenMethod:"linearNone",tween:!1,target:108,key:"y",index:5},{value:314,tweenMethod:"linearNone",tween:!0,target:108,label:null,key:"y",index:11},{value:93,tweenMethod:"linearNone",tween:!0,target:108,key:"y",index:28}],x:[{value:-339,tweenMethod:"linearNone",tween:!0,target:108,key:"x",index:0},{value:395,tweenMethod:"linearNone",tween:!0,target:108,key:"x",index:5},{value:387,tweenMethod:"linearNone",tween:!0,target:108,key:"x",index:6},{value:377,tweenMethod:"linearNone",tween:!1,target:108,label:null,key:"x",index:8},{value:377,tweenMethod:"linearNone",tween:!0,target:108,label:null,key:"x",index:11}],alpha:[{value:1,tweenMethod:"linearNone",tween:!1,target:108,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!1,target:108,key:"alpha",index:5},{value:1,tweenMethod:"linearNone",tween:!0,target:108,key:"alpha",index:11},{value:0,tweenMethod:"linearNone",tween:!0,target:108,key:"alpha",index:28}]}}],name:"ani1",id:1,frameRate:24,action:0}]},i.Tips_3UI=t}(ui||(ui={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("ui.component.Top_TUI",i.component.Top_TUI),t.prototype.createChildren.call(this),this.createView(i.TopUI.uiView)},e}(View);t.uiView={type:"View",props:{width:720,renderType:"render",height:1280},child:[{type:"Image",props:{y:124,width:612,skin:"tongyong/tu_di.png",sizeGrid:"60,60,60,60",height:754,centerX:0}},{type:"Image",props:{y:897,width:622,skin:"tongyong/tu_di.png",sizeGrid:"60,60,60,60",height:129,centerX:1}},{type:"List",props:{y:209,x:116,width:488,visible:!1,spaceY:15,height:598},child:[{type:"Top_T",props:{y:0,x:0,name:"render",runtime:"ui.component.Top_TUI"}}]},{type:"Button",props:{y:1139,x:56,var:"btn_back",stateNum:1,skin:"tongyong/btn_fh2.png"}},{type:"Top_T",props:{y:904,x:49,visible:!1,runtime:"ui.component.Top_TUI"}},{type:"Image",props:{y:173,width:641,var:"mouseLayer",sizeGrid:"33,41,47,41",height:861,centerX:0}},{type:"Button",props:{y:1114,x:364,width:320,var:"btn_go",stateNum:1,skin:"tongyong/btn_1.png",height:99},child:[{type:"Box",props:{y:22,x:55},child:[{type:"Image",props:{y:1,skin:"tongyong/tu_kaishi.png",scaleY:.8,scaleX:.8}},{type:"Image",props:{x:36,skin:"tongyong/tu_ljtz.png",scaleY:.8,scaleX:.8}}]}]},{type:"Image",props:{y:163,x:243,skin:"top/bt_hyph.png"}},{type:"Image",props:{y:59,x:237,skin:"tongyong/tu_hdj.png"}}]},i.TopUI=t}(ui||(ui={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.YaoQingHaoYouUI.uiView)},e}(View);t.uiView={type:"View",props:{width:750,height:1334},child:[{type:"Button",props:{y:93,x:82,var:"btnHome",stateNum:1,skin:"tongyong/btn_fh.png",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:331,width:672,skin:"tongyong/tu_di.png",sizeGrid:"33,41,47,41",height:593,centerX:0}},{type:"Image",props:{y:246,skin:"yaoqinghaoy/tu_yqhy.png",centerX:0,anchorY:.5,anchorX:.5}},{type:"Label",props:{y:857,width:602,text:"每有一个好友点击链接，即可获得500金币",height:32,fontSize:26,color:"#ffffff",centerX:0,bold:!0,align:"center"}},{type:"Box",props:{y:378,x:109,width:141,var:"box_1",height:224},child:[{type:"Image",props:{y:0,x:0,skin:"qiridenglu/tu_xxd2.png"}},{type:"Label",props:{y:9,width:141,text:"金币500",height:32,fontSize:24,color:"#ffffff",centerX:0,bold:!0,align:"center"}},{type:"Image",props:{y:73,skin:"tongyong/tu_qian5.png",centerX:0}},{type:"Button",props:{y:195,var:"btn_1",stateNum:1,skin:"yaoqinghaoy/btn_yq.png",labelSize:75,labelPadding:"-5",labelColors:"#ffffff",labelBold:!0,centerX:0,anchorY:.5,anchorX:.5}}]},{type:"Box",props:{y:378,x:304,width:141,var:"box_2",height:224},child:[{type:"Image",props:{y:0,x:0,skin:"qiridenglu/tu_xxd2.png"}},{type:"Label",props:{y:9,width:141,text:"金币500",height:32,fontSize:24,color:"#ffffff",centerX:0,bold:!0,align:"center"}},{type:"Image",props:{y:73,skin:"tongyong/tu_qian5.png",centerX:0}},{type:"Button",props:{y:195,var:"btn_2",stateNum:1,skin:"yaoqinghaoy/btn_yq.png",labelSize:75,labelPadding:"-5",labelColors:"#ffffff",labelBold:!0,centerX:0,anchorY:.5,anchorX:.5}}]},{type:"Box",props:{y:378,x:499,width:141,var:"box_3",height:224},child:[{type:"Image",props:{y:0,x:0,skin:"qiridenglu/tu_xxd2.png"}},{type:"Label",props:{y:9,width:141,text:"金币500",height:32,fontSize:24,color:"#ffffff",centerX:0,bold:!0,align:"center"}},{type:"Image",props:{y:73,skin:"tongyong/tu_qian5.png",centerX:0}},{type:"Button",props:{y:195,var:"btn_3",stateNum:1,skin:"yaoqinghaoy/btn_yq.png",labelSize:75,labelPadding:"-5",labelColors:"#ffffff",labelBold:!0,centerX:0,anchorY:.5,anchorX:.5}}]},{type:"Box",props:{y:617,x:109,width:141,var:"box_4",height:224},child:[{type:"Image",props:{y:0,x:0,skin:"qiridenglu/tu_xxd2.png"}},{type:"Label",props:{y:9,width:141,text:"金币500",height:32,fontSize:24,color:"#ffffff",centerX:0,bold:!0,align:"center"}},{type:"Image",props:{y:73,skin:"tongyong/tu_qian5.png",centerX:0}},{type:"Button",props:{y:195,var:"btn_4",stateNum:1,skin:"yaoqinghaoy/btn_yq.png",labelSize:75,labelPadding:"-5",labelColors:"#ffffff",labelBold:!0,centerX:0,anchorY:.5,anchorX:.5}}]},{type:"Box",props:{y:617,x:304,width:141,var:"box_5",height:224},child:[{type:"Image",props:{y:0,x:0,skin:"qiridenglu/tu_xxd2.png"}},{type:"Label",props:{y:9,width:141,text:"金币500",height:32,fontSize:24,color:"#ffffff",centerX:0,bold:!0,align:"center"}},{type:"Image",props:{y:73,skin:"tongyong/tu_qian5.png",centerX:0}},{type:"Button",props:{y:195,var:"btn_5",stateNum:1,skin:"yaoqinghaoy/btn_yq.png",labelSize:75,labelPadding:"-5",labelColors:"#ffffff",labelBold:!0,centerX:0,anchorY:.5,anchorX:.5}}]},{type:"Box",props:{y:617,x:499,width:141,var:"box_6",height:224},child:[{type:"Image",props:{y:0,x:0,skin:"qiridenglu/tu_xxd2.png"}},{type:"Label",props:{y:9,width:141,text:"金币500",height:32,fontSize:24,color:"#ffffff",centerX:0,bold:!0,align:"center"}},{type:"Image",props:{y:73,skin:"tongyong/tu_qian5.png",centerX:0}},{type:"Button",props:{y:195,var:"btn_6",stateNum:1,skin:"yaoqinghaoy/btn_yq.png",labelSize:75,labelPadding:"-5",labelColors:"#ffffff",labelBold:!0,centerX:0,anchorY:.5,anchorX:.5}}]}]},i.YaoQingHaoYouUI=t}(ui||(ui={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.YinDaoUI.uiView)},e}(View);t.uiView={type:"View",props:{width:720,height:1280},child:[{type:"Box",props:{y:0,x:0,width:720,height:1280},child:[{type:"Image",props:{y:123,x:76,skin:"yindao/tu_yindao.png"}},{type:"Image",props:{y:424,x:76,skin:"yindao/tu_yindao2.png"}},{type:"Image",props:{y:725,x:76,skin:"yindao/tu_yindao3.png"}},{type:"Label",props:{y:82,x:168,text:"手指滑动屏幕控制小球左右移动",fontSize:28,color:"#ffffff"}},{type:"Label",props:{y:350,x:208,width:312,text:"撞击同色球，避开异色球",height:28,fontSize:28,color:"#ffffff"}},{type:"Label",props:{y:384,x:207,width:314,text:"条纹球会让捡球积分加倍",height:28,fontSize:28,color:"#ffffff"}},{type:"Label",props:{y:686,x:207,width:314,text:"经过滑板会使球球变色",height:28,fontSize:28,color:"#ffffff"}},{type:"Button",props:{y:977,x:219,stateNum:1,skin:"yindao/btn_wzdl.png"}}]}],animations:[{nodes:[{target:9,keyframes:{y:[{value:2,tweenMethod:"linearNone",tween:!0,target:9,key:"y",index:0},{value:2,tweenMethod:"linearNone",tween:!0,target:9,key:"y",index:15}],x:[{value:-13,tweenMethod:"linearNone",tween:!0,target:9,key:"x",index:0},{value:447,tweenMethod:"linearNone",tween:!0,target:9,key:"x",index:15},{value:-13,tweenMethod:"linearNone",tween:!0,target:9,key:"x",index:30}]}}],name:"ani1",id:1,frameRate:24,action:0}]},i.YinDaoUI=t}(ui||(ui={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.YouXiUI.uiView)},e}(View);t.uiView={type:"View",props:{width:750,height:1334},child:[{type:"Label",props:{y:676,width:450,visible:!1,var:"txt_dis1",text:"999m",strokeColor:"#0b1730",stroke:5,height:77,fontSize:76,font:"Helvetica",color:"#00ffcb",centerX:55,bold:!0,anchorY:.5,anchorX:.5,align:"center"}},{type:"Label",props:{y:30,x:11,width:234,var:"txt_time",text:"时长00:00:00",strokeColor:"#0b1730",stroke:5,height:36,fontSize:35,font:"SimHei",color:"#cacaca",bold:!0}},{type:"Image",props:{y:457,x:418,visible:!1,var:"img_combo",skin:"tongyong/tu_Combo.png"},compId:29,child:[{type:"Label",props:{y:22,x:211,width:105,var:"txt_combo_num",text:"99",strokeColor:"#0b1730",italic:!0,height:82,fontSize:72,font:"Helvetica",color:"#f3f15a",bold:!0,anchorY:.5,anchorX:.5,align:"center"}}]},{type:"ProgressBar",props:{y:809,x:705,width:231,var:"progress_speed",skin:"tongyong/progress_xuetiao2.png",sizeGrid:"0,14,0,21",scaleY:1.2,scaleX:1.2,rotation:-90,height:21}},{type:"Label",props:{y:823,x:689,width:54,text:"时速 ",strokeColor:"#0b1730",stroke:4,height:31,fontSize:26,font:"SimHei",color:"#ffffff",bold:!0,align:"center"}},{type:"ProgressBar",props:{y:809,x:29,width:231,var:"progress_power",skin:"tongyong/progress_xuetiao1.png",sizeGrid:"0,14,0,21",scaleY:1.2,scaleX:1.2,rotation:-90,height:21}},{type:"Label",props:{y:817,x:13,wordWrap:!0,width:54,text:"冲刺能量",strokeColor:"#0b1730",stroke:4,height:31,fontSize:26,font:"SimHei",color:"#ffffff",bold:!0,align:"center"}},{type:"Label",props:{y:500,x:689,width:54,var:"txt_speed",text:"00/S",strokeColor:"#0b1730",stroke:4,height:31,fontSize:26,font:"SimHei",color:"#ffffff",bold:!0,align:"center"}},{type:"Image",props:{y:825,x:26,width:259,visible:!1,var:"img_power",skin:"tongyong/tu_guang.png",sizeGrid:"0,40,0,40",scaleY:1.2,scaleX:1.2,rotation:-90,height:25},compId:37},{type:"Image",props:{y:826,x:703,width:259,visible:!1,var:"img_speed",skin:"tongyong/tu_guang.png",sizeGrid:"0,40,0,40",scaleY:1.2,scaleX:1.2,rotation:-90,height:25},compId:38},{type:"Box",props:{y:93,x:124},child:[{type:"Image",props:{x:176,var:"img_score",skin:"tongyong/shuzidi.png"}},{type:"Label",props:{y:35,x:192,width:140,var:"txt_score",text:"23",height:100,fontSize:100,color:"#000000",bold:!0,align:"center"}},{type:"Label",props:{y:40,x:-9,visible:!0,var:"txt_road_t",text:"Road3",fontSize:28,color:"#000000",bold:!0}},{type:"Label",props:{y:40,x:110,visible:!1,var:"txt_road",text:"6%",fontSize:28,color:"#ff6828",bold:!0}},{type:"Label",props:{y:80,x:-9,visible:!1,var:"txt_get_coin_t",text:"收获",fontSize:28,color:"#000000",bold:!0}},{type:"Label",props:{y:79,x:110,var:"txt_get_coin",text:"0",fontSize:28,color:"#ff6828",bold:!0}},{type:"Label",props:{y:120,x:-9,visible:!1,var:"txt_speed_t",text:"速度",fontSize:28,color:"#000000",bold:!0}},{type:"Label",props:{y:121,x:110,var:"txt_speed1",text:"68",fontSize:28,color:"#ff6828",bold:!0}},{type:"Label",props:{y:160,x:-9,visible:!1,var:"txt_beishu_t",text:"倍数",fontSize:28,color:"#000000",bold:!0}},{type:"Label",props:{y:161,x:110,var:"txt_beishu",text:"3/20",fontSize:28,color:"#ff6828",bold:!0}},{type:"Label",props:{y:157,x:199,var:"txt_dis",text:"3981m",fontSize:40,color:"#000000",bold:!0}},{type:"Image",props:{y:77,x:60,var:"img_gem",skin:"tongyong/tu_zuanshi.png"}}]}],animations:[{nodes:[{target:29,keyframes:{y:[{value:451,tweenMethod:"linearNone",tween:!0,target:29,key:"y",index:0},{value:446,tweenMethod:"linearNone",tween:!0,target:29,key:"y",index:3},{value:291,tweenMethod:"linearNone",tween:!0,target:29,key:"y",index:25}],x:[{value:139,tweenMethod:"linearNone",tween:!0,target:29,key:"x",index:0},{value:370,tweenMethod:"linearNone",tween:!0,target:29,key:"x",index:3},{value:376,tweenMethod:"linearNone",tween:!0,target:29,key:"x",index:25}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:29,key:"visible",index:0}],scaleY:[{value:2,tweenMethod:"linearNone",tween:!0,target:29,key:"scaleY",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:29,key:"scaleY",index:3}],scaleX:[{value:2,tweenMethod:"linearNone",tween:!0,target:29,key:"scaleX",index:0},{value:1.2,tweenMethod:"linearNone",tween:!0,target:29,key:"scaleX",index:3}],alpha:[{value:1,tweenMethod:"linearNone",tween:!0,target:29,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:29,key:"alpha",index:3},{value:1,tweenMethod:"linearNone",tween:!0,target:29,key:"alpha",index:10},{value:0,tweenMethod:"linearNone",tween:!0,target:29,key:"alpha",index:25}]}}],name:"ani1",id:1,frameRate:24,action:0},{nodes:[{target:37,keyframes:{visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:37,key:"visible",index:0}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:37,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:37,key:"alpha",index:3},{value:0,tweenMethod:"linearNone",tween:!0,target:37,key:"alpha",index:6}]}}],name:"ani2",id:2,frameRate:24,action:0},{nodes:[{target:38,keyframes:{x:[{value:703,tweenMethod:"linearNone",tween:!0,target:38,key:"x",index:0},{value:703,tweenMethod:"linearNone",tween:!0,target:38,key:"x",index:3},{value:703,tweenMethod:"linearNone",tween:!0,target:38,label:null,key:"x",index:6}],visible:[{value:!0,tweenMethod:"linearNone",tween:!1,target:38,key:"visible",index:0}],alpha:[{value:0,tweenMethod:"linearNone",tween:!0,target:38,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:38,key:"alpha",index:3},{value:0,tweenMethod:"linearNone",tween:!0,target:38,label:null,key:"alpha",index:6}]}}],name:"ani3",id:3,frameRate:24,action:0}]},i.YouXiUI=t}(ui||(ui={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.ZhuanPanUI.uiView)},e}(View);t.uiView={type:"View",props:{width:720,height:1280},child:[{type:"Box",props:{y:963,x:427,width:333,var:"box_free",scaleY:.8,scaleX:.8,height:100},child:[{type:"Button",props:{y:47,x:148,width:342,stateNum:1,skin:"tongyong/btn_1.png",sizeGrid:"0,74,0,66",height:94,anchorY:.5,anchorX:.5}},{type:"Image",props:{y:26.600000000000023,x:2.8000000000000114,skin:"zhuanpan/tu_zhuanpan.png"}},{type:"Image",props:{y:28.600000000000023,x:44.80000000000001,skin:"zhuanpan/tu_mfzcyc.png"}}]},{type:"Image",props:{y:207,x:132,skin:"zhuanpan/tu_3.png"}},{type:"Box",props:{y:963,x:67,width:318,var:"btn_relife",scaleY:.8,scaleX:.8,height:99},child:[{type:"Button",props:{y:47,x:148,width:342,stateNum:1,skin:"tongyong/btn_2.png",sizeGrid:"0,74,0,66",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:24,x:47,skin:"zhuanpan/tu_shipin1.png"}},{type:"Image",props:{y:30,x:101,skin:"zhuanpan/tu_shipin2.png"}}]},{type:"Box",props:{y:963,x:427,width:294,var:"btn_share",scaleY:.8,scaleX:.8,height:100},child:[{type:"Button",props:{y:47,x:148,width:342,stateNum:1,skin:"tongyong/btn_1.png",sizeGrid:"0,74,0,66",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:25,x:33.5,skin:"zhuanpan/tu_zhuanpan.png"}},{type:"Image",props:{y:29,x:93.5,skin:"zhuanpan/tu_mfzc.png"}}]},{type:"Box",props:{y:603,x:355,width:536,pivotY:268,pivotX:265,height:539},child:[{type:"Box",props:{y:274,x:270,width:573,var:"box_pan",rotation:0,pivotY:274,pivotX:270,height:576},child:[{type:"Image",props:{y:-27,x:-30,skin:"zhuanpan/tu_2.png"}},{type:"Image",props:{y:278,x:136,width:85,skin:"tongyong/tu_qian2.png",rotation:-92,pivotY:38,pivotX:40,height:80}},{type:"Image",props:{y:158,x:336,skin:"tongyong/tu_qian1.png",rotation:30,anchorY:.5,anchorX:.5}},{type:"Image",props:{y:147,x:192,width:81,skin:"zhuanpan/tu_smpf.png",rotation:-28,pivotY:27,pivotX:37,height:81}},{type:"Image",props:{y:382,x:205,skin:"tongyong/tu_qian5.png",rotation:-150,anchorY:.5,anchorX:.5}},{type:"Image",props:{y:377,x:332,skin:"tongyong/tu_qian3.png",rotation:-210,anchorY:.5,anchorX:.5}},{type:"Image",props:{y:268,x:394,skin:"tongyong/tu_qian4.png",rotation:-270,anchorY:.5,anchorX:.5}},{type:"Label",props:{y:274,x:270,width:169,text:"300",rotation:-92,pivotY:249,height:50,fontSize:45,color:"#cd3f00",bold:!0,anchorX:.5,align:"center"}},{type:"Label",props:{y:272,x:271,width:169,text:"神秘皮肤",rotation:-32,pivotY:249,height:50,fontSize:38,color:"#cd3f00",bold:!0,anchorX:.5,align:"center"}},{type:"Label",props:{y:266,x:272,width:169,text:"2000",rotation:-150,pivotY:249,height:50,fontSize:45,color:"#cd3f00",bold:!0,anchorX:.5,align:"center"}},{type:"Label",props:{y:257,x:258,width:169,text:"500",rotation:-215,pivotY:249,height:50,fontSize:45,color:"#cd3f00",bold:!0,anchorX:.5,align:"center"}},{type:"Label",props:{y:271,x:256,width:169,text:"1000",rotation:-270,pivotY:249,height:50,fontSize:50,color:"#cd3f00",bold:!0,anchorX:.5,align:"center"}},{type:"Label",props:{y:274,x:271,width:169,text:"200",rotation:31,pivotY:249,height:50,fontSize:45,color:"#cd3f00",bold:!0,anchorX:.5,align:"center"}}]},{type:"Image",props:{y:275,x:270,width:168,var:"img_pan",skin:"zhuanpan/tu_1.png",pivotY:148,pivotX:85,height:230}}]},{type:"Box",props:{y:28,x:29},child:[{type:"Image",props:{y:4,x:30,skin:"tongyong/tu_shuzidi.png"}},{type:"Image",props:{y:0,x:0,skin:"tongyong/tu_jinbi.png",scaleY:.7,scaleX:.7}},{type:"Label",props:{y:8,x:60,width:127,var:"txtMoney",text:"123456",height:34,fontSize:34,font:"Arial",color:"#ffcf17",bold:!0,align:"left"}}]},{type:"Label",props:{y:918,x:129,width:127,var:"txt_time",text:"123456",height:34,fontSize:34,font:"Arial",color:"#ffffff",bold:!0,align:"left"}},{type:"Button",props:{y:91,x:35,var:"btn_back",stateNum:1,skin:"tongyong/btn_fh.png"}}]},i.ZhuanPanUI=t}(ui||(ui={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(a){var t,e,i;t=a.gui||(a.gui={}),e=t.component||(t.component={}),(i=function(e){function r(){var t=e.call(this)||this;return t._curData=[],t._index=0,t}return __extends(r,e),r.prototype.init=function(t,e,i){this._curData=e,this._app=t,this._curType=i,this.txt_num.on(LEvent.CLICK,this,this.onclick),this.img_skin.on(LEvent.CLICK,this,this.onclick),this._app.plyertDataMgr.on(PlayerDataMgr.EVENT_SKIN_BUY_FLAG,this,this.onSkinBuyFlag),this._app.plyertDataMgr.on(PlayerDataMgr.EVENT_SKIN_USE_FLAG,this,this.onSkinUseFlag)},r.prototype.setIndex=function(t){this._index=t,this.updateInfo()},r.prototype.onSkinBuyFlag=function(t){this._index==t&&this.updateInfo()},r.prototype.onSkinUseFlag=function(t,e){this.updateInfo()},r.prototype.updateInfo=function(){var t=this._curData[this._index];if(this.img_skin.visible=!0,this.img_skin.skin="scene/pifu/icon/"+t.avatar+(2==t.type?".jpg":".png"),this._app.plyertDataMgr.isBuySkinFlag(t.id))this._curType==a.gui.page.SkinPage.TYPE_BALL?this._app.plyertDataMgr.getUseSkinIndex():this._curType==a.gui.page.SkinPage.TYPE_TUOWEI?this._app.plyertDataMgr.getUseTuoWeiSkinIndex():this._curType==a.gui.page.SkinPage.TYPE_ZHANGAI&&this._app.plyertDataMgr.getUseObstacleSkinIndex();else{for(var e=void 0,i=0;i<r.DESC_INFO_ID.length;i++){var n=r.DESC_INFO_ID[i];if(n.id==this._curData[this._index].id){e=n;break}}this.txt_num.text=e?e.desc:"无"}},r.prototype.onclick=function(t){var e=this._curData[this._index];switch(t.currentTarget){case this.txt_num:if(-1<this.txt_num.text.indexOf("邀请"))WXTool.shareFriend(3);else if(-1<this.txt_num.text.indexOf("金币"))this.buySkin(e);else if(-1<this.txt_num.text.indexOf("视频")){var i=this._app.uiRoot.general.getPage(PageDef.SKIN_PAGE);isDebug?i.onVideo():WXTool.getVideo()}else-1<this.txt_num.text.indexOf("分享到")&&(isDebug?this._app.uiRoot.general.getPage(PageDef.SKIN_PAGE):WXTool.shareFriend());break;case this.img_skin:if(this._curType==a.gui.page.SkinPage.TYPE_BALL?this._app.showRoot.changeBallSkin(e.avatar):this._curType==a.gui.page.SkinPage.TYPE_TUOWEI&&this._app.showRoot.changeTuoWeiSkin(e.avatar),!this._app.plyertDataMgr.isBuySkinFlag(e.id))return void console.log("PiFuItem.onClick:未购买该皮肤"+this._index);this._curType==a.gui.page.SkinPage.TYPE_BALL?this._app.plyertDataMgr.setUseSkinIndex(e.id):this._curType==a.gui.page.SkinPage.TYPE_TUOWEI?this._app.plyertDataMgr.setUseTuoWeiSkinIndex(e.id):this._curType==a.gui.page.SkinPage.TYPE_ZHANGAI&&this._app.plyertDataMgr.setUseObstacleSkinIndex(e.id)}},r.prototype.buySkin=function(e){if(!this._app.plyertDataMgr.isBuySkinFlag(e.id)){var t=e.condition[1],i=this._app.plyertDataMgr.getGold();t<=i?(i-=t,this._app.plyertDataMgr.updateGold(i),this._app.plyertDataMgr.setSkinActive(e.id),this._app.uiRoot.general.getPage(PageDef.PIFUGETTIP)||this._app.uiRoot.general.open(PageDef.PIFUGETTIP,function(t){t.setData(e)})):this._app.uiRoot.general.open(PageDef.GOLDNOENOUGH)}},r.prototype.destroy=function(){this.txt_num.off(LEvent.CLICK,this,this.onclick),this._app&&this._app.plyertDataMgr&&(this._app.plyertDataMgr.off(PlayerDataMgr.EVENT_SKIN_BUY_FLAG,this,this.onSkinBuyFlag),this._app.plyertDataMgr.off(PlayerDataMgr.EVENT_SKIN_USE_FLAG,this,this.onSkinUseFlag))},r}(ui.component.PiFuItemUI)).DESC_INFO_ID=[{id:1,desc:"免费皮肤"},{id:2,desc:"登录3天"},{id:3,desc:"登录5天"},{id:4,desc:"20场游戏"},{id:5,desc:"连登2天"},{id:6,desc:"2500金币"},{id:7,desc:"分享到2个群"},{id:8,desc:"2500金币"},{id:9,desc:"2500金币"},{id:10,desc:"分享到10个群"},{id:11,desc:"2500金币"},{id:12,desc:"2500金币"},{id:13,desc:"分享到20个群"},{id:14,desc:"5000金币"},{id:15,desc:"5000金币"},{id:16,desc:"连看2天视频"},{id:17,desc:"连看5天视频"},{id:18,desc:"累看5次视频"},{id:19,desc:"累看10次视频"},{id:20,desc:"邀请1人"},{id:21,desc:"累看50次视频"},{id:22,desc:"邀请3人"},{id:23,desc:"转盘抽取"},{id:24,desc:"20000金币"},{id:25,desc:"登录4天"},{id:26,desc:"登录7天"},{id:27,desc:"50场游戏"},{id:28,desc:"连登3天"},{id:29,desc:"2500金币"},{id:30,desc:"分享到3个群"},{id:31,desc:"2500金币"},{id:32,desc:"连看3天视频"},{id:33,desc:"5000金币"},{id:34,desc:"分享到15个群"},{id:35,desc:"5000金币"},{id:36,desc:"邀请5人"},{id:37,desc:"5000金币"},{id:38,desc:"邀请2人"},{id:39,desc:"累看20次视频"},{id:40,desc:"10000金币"},{id:41,desc:"邀请4人"},{id:42,desc:"邀请6人"},{id:43,desc:"登录6天"},{id:44,desc:"30场游戏"},{id:45,desc:"连登5天"},{id:46,desc:"5000金币"},{id:47,desc:"分享到5个群"},{id:48,desc:"5000金币"},{id:49,desc:"连看4天视频"},{id:50,desc:"邀请7人"},{id:51,desc:"10000金币"},{id:52,desc:"邀请8人"},{id:53,desc:"邀请9人"},{id:54,desc:"20000金币"},{id:55,desc:"免费拖尾"},{id:56,desc:"免费障碍物"}],e.PiFuItem=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i,n;e=t.gui||(t.gui={}),i=e.component||(e.component={}),(n=function(l){function u(t,e,i,n,r,a,s){var o=l.call(this)||this;return o._startPosX=0,o._startPosY=0,o._spaceX=0,o._spaceY=0,o._dirType=0,o._viewW=0,o._viewH=0,o._viewRowNum=0,o._viewColNum=0,o._itemWidth=0,o._itemHeight=0,o._colNum=0,o._rowNum=0,o._data=new Array,o._indexPos=0,o._index=0,o._moveColNum=0,o._itemMoveDis=0,o._maxMoveRange=0,o._itemLists=new Array,o._isMouseDown=!1,o._old_Pos=0,o._itemPool=new Array,o._viewW=t,o._viewH=e,o._startPosX=i,o._startPosY=n,o._spaceX=r,o._spaceY=a,o._dirType=s,o.width=o._viewW,o.height=o._viewH,o}return __extends(u,l),u.prototype.init=function(t,e,i,n,r){void 0===n&&(n=0),void 0===r&&(r=0),this._renderItem=t,this._renderItemCB=e,this._itemWidth=n,this._itemHeight=r,i&&(this._data=i);var a=this._viewH-this._startPosY;this._viewRowNum=Math.floor(a/(this._itemHeight+this._spaceY));var s=this._viewW-this._startPosX;this._viewColNum=Math.floor(s/(this._itemWidth+this._spaceX)),this._indexPos=0,this._index=0,this.calMoveParams(),this._itemLists.length=0;var o=this._viewRowNum,l=this._viewColNum;this._dirType==u.DIR_H?o+=2:l+=2;for(var h=0;h<o*l;h++)this._itemLists[h]=new this._renderItem,this.addChild(this._itemLists[h]);this.updateItem(),this.addEvent()},u.prototype.calMoveParams=function(){this._dirType==u.DIR_H?(this._rowNum=this._viewRowNum,this._colNum=Math.ceil(this._data.length/this._viewRowNum),this._itemMoveDis=this._itemWidth+this._spaceX,this._moveColNum=this._viewRowNum,this._colNum>this._viewColNum?this._maxMoveRange=(this._colNum-this._viewColNum)*(this._itemWidth+this._spaceX):this._maxMoveRange=0):(this._colNum=this._viewColNum,this._rowNum=Math.ceil(this._data.length/this._viewColNum),this._itemMoveDis=this._itemHeight+this._spaceY,this._moveColNum=this._viewColNum,this._rowNum>this._viewRowNum?this._maxMoveRange=(this._rowNum-this._viewRowNum)*(this._itemHeight+this._spaceY):this._maxMoveRange=0)},u.prototype.addEvent=function(){this.on(LEvent.MOUSE_DOWN,this,this.onMouseDown),this.on(LEvent.MOUSE_UP,this,this.onMouseUp),this.on(LEvent.MOUSE_MOVE,this,this.onMouseMove)},u.prototype.onMouseDown=function(){this._dirType==u.DIR_V?this._old_Pos=this.mouseX:this._old_Pos=this.mouseY,this._isMouseDown=!0,console.log("mousedown")},u.prototype.onMouseUp=function(){this._isMouseDown=!1,console.log("mouseup")},u.prototype.onMouseMove=function(){if(this._isMouseDown){var t=0;t=this._dirType-u.DIR_H?this._old_Pos-this.mouseX:this._old_Pos-this.mouseY,this._old_Pos-=t,this._indexPos-=t,this._indexPos<0&&(this._indexPos=0),this._indexPos>this._maxMoveRange&&(this._indexPos=this._maxMoveRange),this.updateItem()}},u.prototype.updateItem=function(){var t=Math.floor(this._indexPos/this._itemMoveDis);t*=this._moveColNum;for(var e=this._indexPos%this._itemMoveDis,i=0;i<this._itemLists.length;i++)t+i<this._data.length?(this._itemLists[i].visible=!0,this._renderItemCB.runWith({item:this._itemLists[i],data:this._data[t+i]}),this._dirType==u.DIR_H?(this._itemLists[i].x=this._startPosX+Math.floor(i/this._rowNum)*(this._itemWidth+this._spaceX)-e,this._itemLists[i].y=this._startPosY+Math.floor(i%this._rowNum)*(this._itemHeight+this._spaceY)):(this._itemLists[i].x=this._startPosX+Math.floor(i%this._colNum)*(this._itemWidth+this._spaceX),this._itemLists[i].y=this._startPosY+Math.floor(i/this._colNum)*(this._itemHeight+this._spaceY)-e)):this._itemLists[i].visible=!1},u.prototype.clear=function(){},u.prototype.outPool=function(){return 0<this._itemPool.length?this._itemPool.pop():new this._renderItem},u.prototype.intoPool=function(t){t&&this._itemPool.push(t)},u.prototype.dispose=function(){},u}(Laya.Panel)).DIR_H=0,n.DIR_V=0,i.PiFuList=n}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i;e=t.gui||(t.gui={}),i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t}(t.gui.base.PageContainer),e.GeneralUI=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i;e=t.gui||(t.gui={}),i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.closeAll=function(){for(var t in this._pages){var e=Number(t);this.close(e)}},t}(t.gui.base.PageContainer),e.HUD=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i,n;e=t.gui||(t.gui={}),i=e.page||(e.page={}),n=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n._isModal=!0,n._asset=[],n}return __extends(t,r),t.prototype.init=function(){},t.prototype.close=function(){r.prototype.close.call(this)},t.prototype.onOpen=function(){r.prototype.onOpen.call(this)},t.prototype.onClick=function(t){this._app.plyertDataMgr.setAddSpeedStatus(1),t.currentTarget},t.prototype.addSpeed=function(){this._app.plyertDataMgr.setAddSpeedStatus(1);var t=this._app.uiRoot.general.getPage(i.PageDef.START_PAGE);t&&t.isOpened&&t.updateStartSign(),this.close()},t.prototype.layout=function(){r.prototype.layout.call(this),this._view},t}(t.gui.base.Page),i.AddSpeedPage=n}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(a){var t,e,i;t=a.gui||(a.gui={}),e=t.page||(t.page={}),i=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n._asset=[a.Path.uiAtlas+"pifu.atlas"],n}return __extends(t,r),t.prototype.init=function(){},t.prototype.onOpen=function(){r.prototype.onOpen.call(this),this.drawBlack(.75,"#000000"),MessageManager.on(WXTool.SHARED_SUCCESS,this,this.shareBack)},t.prototype.onClick=function(t){},t.prototype.shareBack=function(){if(!this._app.sceneRoot.isShareLibao){this._app.uiRoot.general.open(e.PageDef.RESULT_RANK);var t=this._app.plyertDataMgr.getRebornCoinCount();this._app.plyertDataMgr.setRebornCoinCount(t+1),this._app.sceneRoot.isShareLibao=!0,this.close()}},t.prototype.close=function(){this._app.uiRoot.general.getPage(e.PageDef.RESULT_RANK)||this._app.uiRoot.general.open(e.PageDef.RESULT_RANK),MessageManager.off(WXTool.SHARED_SUCCESS,this,this.shareBack),r.prototype.close.call(this)},t}(a.gui.base.Page),e.FuHuoDaoJuPage=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(a){var t,e,i;t=a.gui||(a.gui={}),e=t.page||(t.page={}),i=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n._asset=[a.Path.uiAtlas+"pifu.atlas"],n}return __extends(t,r),Object.defineProperty(t.prototype,"isOnScene",{set:function(t){this._isOnScene=t},enumerable:!0,configurable:!0}),t.prototype.init=function(){this._viewUI=this._view=new ui.FuHuoBiUI,this.addChild(this._view)},t.prototype.onOpen=function(){r.prototype.onOpen.call(this),this.drawBlack(.75,"#000000"),DisplayU.setMouseListener(this._viewUI.btn_back,!0,this,this.onClick),DisplayU.setMouseListener(this._viewUI.btn_fuhuo,!0,this,this.onClick),DisplayU.setMouseListener(this._viewUI.btn_invite,!0,this,this.onClick),MessageManager.on(WXTool.SHARED_SUCCESS,this,this.clearLibaoCount),Laya.timer.loop(1e3,this,this.getCoinCount),this.getCoinCount(),this.getReliveCount()},t.prototype.clearLibaoCount=function(){this._app.plyertDataMgr.setLibaoAddCount(0)},t.prototype.getCoinCount=function(){WXTool.wxOpenid&&""!=WXTool.wxOpenid&&(WXTool.getinvite(0),WXTool.getinvite(1));var t=this._app.plyertDataMgr;if(this._coinCount=t.getRebornCoinCount(),WXTool.inviteCount){var e=t.getInviteAddCount();t.setRebornCoinCount(this._coinCount+(WXTool.inviteCount-(e||0))),t.setInviteAddCount(WXTool.inviteCount)}if(WXTool.libaoCount){var i=t.getLibaoAddCount(),n=WXTool.libaoCount-(i||0);t.setRebornCoinCount(10<this._coinCount+n?10:n),t.setLibaoAddCount(WXTool.libaoCount)}this._coinCount=t.getRebornCoinCount()},t.prototype.onClick=function(t){switch(t.currentTarget){case this._viewUI.btn_back:this._isOnScene||this._app.uiRoot.general.open(e.PageDef.START_PAGE),this.close();break;case this._viewUI.btn_invite:WXTool.shareFriend(4);break;case this._viewUI.btn_fuhuo:if(this._coinCount<this._needCount)return void this._app.uiRoot.top.open(e.PageDef.GOLDNOENOUGH,function(t){t.setData("复活币不足！")});this._app.plyertDataMgr.setRebornCoinCount(this._coinCount-this._needCount),this.reborn()}},t.prototype.reborn=function(){this._app.sceneRoot.test(),this._app.sceneRoot.mainPlayer.playerScript.addWuDi();var t=this._app.uiRoot.general.getPage(e.PageDef.RESTART_PAGE);t&&t.isOpened&&t.close(),this.close()},t.prototype.getReliveCount=function(){switch(WXTool.reliveCount){case 2:this._needCount=1;break;case 3:this._needCount=2;break;default:this._needCount=3}},t.prototype.close=function(){Laya.timer.clearAll(this),MessageManager.off(WXTool.SHARED_SUCCESS,this,this.clearLibaoCount),this._view,r.prototype.close.call(this)},t}(a.gui.base.Page),e.FuHuoPage=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i,n;e=t.gui||(t.gui={}),i=e.page||(e.page={}),n=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n._isModal=!0,n._asset=[],n}return __extends(t,r),t.prototype.init=function(){},t.prototype.onOpen=function(){r.prototype.onOpen.call(this),MessageManager.on(WXTool.VIDEO_SUCCESS,this,this.onVideo)},t.prototype.onVideo=function(){this._curGoldNum&&(this._curGoldNum+=this._curGoldNum),this._curFuHuoB&&(this._curFuHuoB+=this._curFuHuoB)},t.prototype.onBtnVideo=function(){isDebug?this.onVideo():WXTool.getVideo()},t.prototype.onBtnLQ=function(){if(this._curGoldNum){var t=this._app.plyertDataMgr.getGold();t+=this._curGoldNum,this._app.plyertDataMgr.updateGold(t)}if(this._curFuHuoB){var e=this._app.plyertDataMgr.getRebornCoinCount();e+=this._curFuHuoB,this._app.plyertDataMgr.setRebornCoinCount(e)}this.close()},t.prototype.setData=function(t,e){this._curFuHuoB=e,this._curGoldNum=t},t.prototype.close=function(){MessageManager.off(WXTool.VIDEO_SUCCESS,this,this.onVideo),r.prototype.close.call(this)},t}(t.gui.base.Page),i.GetRewardPage=n}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(s){var t,o,e;t=s.gui||(s.gui={}),o=t.page||(t.page={}),(e=function(r){function a(t,e,i){var n=r.call(this,t,e,i)||this;return n._isReward=!1,n._isDouble=!1,n._isClick=!1,n._isModal=!0,n._isClickModalClose=!1,n._asset=[s.Path.uiAtlas+"tongyong.atlas"],n}return __extends(a,r),a.prototype.init=function(){this._viewUI=this._view=new ui.HuoDeJinBiUI,this.addChild(this._view)},a.prototype.onOpen=function(){r.prototype.onOpen.call(this),this._viewUI.btn_video.on(LEvent.CLICK,this,this.onBtnClick),this._isReward=!1,this._type==a.TYPE_SKIN?this._viewUI.btn_video.disabled=!0:this._viewUI.btn_video.disabled=!WXTool.isShare,this._viewUI.btn_lq.on(LEvent.CLICK,this,this.onBtnClick),this._type!=a.TYPE_FUHBI&&this._type!=a.TYPE_SKIN&&(this._viewUI.img_icon.visible=!1),this._type},a.prototype.setData=function(t,e){if(this._type=e,this._index=t,this._type==a.TYPE_GOLD)this._viewUI.img_title.skin="tongyong/bt_hdjb.png",this._viewUI.txt_gold.fontSize=120,this._viewUI.txt_gold.color="#ffc047",this._viewUI.txt_gold.text=t.toString(),this._viewUI.img_friend.visible=!1,this._viewUI.img_video1.visible=!0,this._viewUI.img_video2.visible=!0;else if(this._type==a.TYPE_SKIN){this._viewUI.img_icon.visible=!0,this._viewUI.img_title.skin="tongyong/bt_hdpf.png",this._viewUI.img_friend.visible=!0,this._viewUI.img_video1.visible=!1,this._viewUI.img_video2.visible=!1,this._viewUI.txt_gold.fontSize=50,this._viewUI.txt_gold.color="#4eb8b3";for(var i=SkinConfig.getInstance().datas,n=0;n<i.length;n++)if(i[n].id==this._index){this._viewUI.img_icon.skin="scene/pifu/icon/"+i[n].avatar+(i[n].type==o.SkinPage.TYPE_BALL?".png":".jpg");break}this._viewUI.img_icon.y-=30}else this._type==a.TYPE_FUHBI&&(this._viewUI.img_icon.visible=!0,this._viewUI.img_title.skin="tongyong/tu_hdfhb.png",this._viewUI.img_icon.skin="tongyong/tu_fuhuobi.png",this._viewUI.img_icon.size(117,81),this._viewUI.txt_gold.fontSize=120,this._viewUI.txt_gold.color="#ffc047",this._viewUI.txt_gold.text=t.toString(),this._viewUI.img_friend.visible=!1,this._viewUI.img_video1.visible=!0,this._viewUI.img_video2.visible=!0)},a.prototype.onBtnClick=function(t){switch(t.currentTarget){case this._viewUI.btn_video:if(this._isReward)return;this._isDouble||isDebug&&(this.setDouble(),this.getReward());break;case this._viewUI.btn_lq:this._isReward=!0,this.getReward()}},a.prototype.setDouble=function(){this._type!=a.TYPE_SKIN&&(this._viewUI.btn_video.disabled=this._isDouble=!0,this._index*=2,this._viewUI.txt_gold.text=this._index.toString(),this._viewUI.btn_lq.visible=!1,this._viewUI.img_video1.visible=!1,this._viewUI.img_video2.visible=!1,this._viewUI.img_friend.visible=!0,this._viewUI.img_friend.skin="tongyong/tu_ljlq1.png")},a.prototype.getReward=function(){this._isClick||(this._isClick=!0,this.clickClose())},a.prototype.clickClose=function(){if(this._type==a.TYPE_GOLD){this._viewUI.ani1.play(0,!1),this._viewUI.ani1.on(LEvent.COMPLETE,this,this.complete);var t=this._app.plyertDataMgr.getGold();this._goldClip.setText(t.toString(),!0);var e=StringU.substitute("恭喜获得{0}金币",this._index);this._app.uiRoot.top.showTip(e)}else if(this._type==a.TYPE_SKIN)this._app.plyertDataMgr.setSkinActive(this._index),r.prototype.close.call(this);else if(this._type==a.TYPE_FUHBI){var i=this._app.plyertDataMgr.getRebornCoinCount();this._app.plyertDataMgr.setRebornCoinCount(i+this._index),r.prototype.close.call(this)}},a.prototype.complete=function(){this._viewUI.ani1.off(LEvent.LABEL,this,this.complete),this._viewUI.ani1.stop(),this._goldClip&&this._goldClip.on(ClipUtil.EVENT_NUM_TWWEN_STOP,this,this.delayClose),this.getGoldRecode()},a.prototype.complete2=function(){this._viewUI.img_icon.visible=!0,MessageManager.event(WXTool.JINBI)},a.prototype.delayClose=function(){Laya.timer.once(700,this,this.FinalClose)},a.prototype.getGoldRecode=function(){var t=this._app.plyertDataMgr.getGold();t+=this._index,this._app.localStorageMgr.setItem("money",t+""),this._app.plyertDataMgr.event(PlayerDataMgr.GOLDCHANGE,t),console.log("获得金币！！！！",t,this._index),this._goldClip.setText(t.toString(),!1,!0)},a.prototype.FinalClose=function(){this._goldClip.off(ClipUtil.EVENT_NUM_TWWEN_STOP,this,this.delayClose),this.isAlertBox(),this.complete2(),this._isReward=!1,r.prototype.close.call(this)},a.prototype.isAlertBox=function(){var t=this._app.uiRoot.general.getPage(o.PageDef.RESTART_PAGE);this._type==a.TYPE_GOLD&&t&&!this._app.plyertDataMgr.isOpenBoxCur&&(this._app.plyertDataMgr.isOpenBoxCur=!0,isDebug||MathU.randomRange(1,100))},a}(s.gui.base.Page)).TYPE_GOLD=1,e.TYPE_SKIN=2,e.TYPE_FUHBI=3,o.GetTipsPage=e}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i,n;e=t.gui||(t.gui={}),i=e.page||(e.page={}),n=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n._isModal=!0,n._asset=[],n}return __extends(t,r),t.prototype.init=function(){this.addChild(this._view)},t.prototype.setData=function(t){void 0===t&&(t="您的金币不够哦，请在游戏内加油获取哦！")},t.prototype.onOpen=function(){r.prototype.onOpen.call(this),Laya.timer.once(1500,this,this.close)},t.prototype.close=function(){r.prototype.close.call(this)},t}(t.gui.base.Page),i.GoldGetNoEnough=n}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(a){var t,e,i;t=a.gui||(a.gui={}),e=t.page||(t.page={}),i=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n._contentSx=0,n._isModal=!0,n._asset=[a.Path.uiAtlas+"jiesuan.atlas"],n}return __extends(t,r),t.prototype.init=function(){this._view=this._viewUI=new ui.logoUI,this.addChild(this._viewUI),this._contentSx=this._view.box_tip.y},t.prototype.close=function(){Laya.timer.clearAll(this),this._app.uiRoot.general.open(e.PageDef.START_PAGE),r.prototype.close.call(this)},t.prototype.onOpen=function(){r.prototype.onOpen.call(this),this.drawBlack(1,"#ffffff"),Laya.timer.once(2e3,this,this.close)},t.prototype.layout=function(){r.prototype.layout.call(this),this._view&&onIPhoneX&&(this._view.box_tip.y=this._contentSx+this._app.uiRoot.y+100)},t}(a.gui.base.Page),e.Logo=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(r){var t;(function(t){var e=function(n){function t(t,e){var i=n.call(this)||this;return i._assetsLoader=new AssetsLoader,i._app=t,i._assetsLoader.load([r.Path.uiAtlas+"tongyong.atlas"],Handler.create(i,i.onLoaded)),i}return __extends(t,n),Object.defineProperty(t.prototype,"view",{get:function(){return this._viewUI},enumerable:!0,configurable:!0}),t.prototype.onLoaded=function(){this.init()},t.prototype.init=function(){this._viewUI=new ui.CaiNiXiHuanUI,this.addChild(this._viewUI),this.onOpen()},t.prototype.close=function(){this._viewUI},t.prototype.clear=function(){this._viewUI},t.prototype.onOpen=function(){this._datas=WXTool.gameInfo,this.updateView()},t.prototype.updateView=function(){this.initList(),this._viewUI.list_info.array=this._datas},t.prototype.initList=function(){var t=this._viewUI.list_info;t.vScrollBarSkin="",t.itemRender=i,console.log("打印数据",this._datas)},t.prototype.onClickHandler=function(t){this._isBool?this._isBool&&Laya.Tween.to(this,{x:-483},300,null,Handler.create(this,this.complete,[!1])):Laya.Tween.to(this,{x:0},300,null,Handler.create(this,this.complete,[!0]))},t.prototype.suoView=function(){this._isBool&&Laya.Tween.to(this,{x:-483},300,null,Handler.create(this,this.complete,[!1]))},t.prototype.complete=function(t){this._isBool=t,this.mouseThrough=!t,Laya.Tween.clearAll(this)},t}(Laya.Box);t.PageGameInfo=e;var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"dataSource",{set:function(t){t&&(this._data=t,this.txt_name.text=t.name,this.img_grid.skin=t.icon,this.on(LEvent.CLICK,this,this.onBtnCLick))},enumerable:!0,configurable:!0}),e.prototype.onBtnCLick=function(){console.log("点击",this._data),WXTool.nav("",this._data)},e}(ui.component.CaiNiXiHuan_TUI)})((t=r.gui||(r.gui={})).page||(t.page={}))}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(a){var t,e,i;t=a.gui||(a.gui={}),e=t.page||(t.page={}),i=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n._isMouseDown=!1,n._mousePosx=0,n._asset=[a.Path.uiAtlas+"play.atlas",a.Path.uiAtlas+"tongyong.atlas"],n}return __extends(t,r),t.prototype.init=function(){this._viewUI=this._view=new ui.PlayUI,this.addChild(this._view),this._viewUI.img_share2.visible=!1,this._viewUI.box_head.visible=!0},t.prototype.onOpen=function(){r.prototype.onOpen.call(this),this._app.plyertDataMgr.getBaseSkin()||(this._app.localStorageMgr.setItem("skin_active1","1",!0),this._app.localStorageMgr.setItem("skin_active55","1",!0),this._app.localStorageMgr.setItem("skin_active56","1",!0),this._app.plyertDataMgr.setBaseSkin(1),this._app.plyertDataMgr.getUseSkinIndex()||this._app.plyertDataMgr.setUseSkinIndex(1),this._app.plyertDataMgr.getUseTuoWeiSkinIndex()||this._app.plyertDataMgr.setUseTuoWeiSkinIndex(55),this._app.plyertDataMgr.getUseObstacleSkinIndex()||this._app.plyertDataMgr.setUseObstacleSkinIndex(56)),0==this._app.plyertDataMgr.getIsNew()&&"1"!=this._app.plyertDataMgr.getSkinActive(5)&&this._app.uiRoot.general.open(e.PageDef.RESULT_SUPER_SKIN,function(t){t.dataSource=1}),this.updateStartSign(),this.setSettingStateView(!1),this._app.plyertDataMgr.setIsNew(),this._viewUI.txt_ver.text="v"+WXTool.fk_version,this._viewUI.img_ad.visible=!WXTool.isML1&&WXTool.isSwithOpen||WXTool.isML1&&WXTool.isSwithOpen,this._viewUI.btn_fuhuo.visible=WXTool.isShare,this.drawBlack(.75,"#000000"),this._viewUI.btn_start.on(LEvent.CLICK,this,this.onClick),this._viewUI.btn_top.on(LEvent.CLICK,this,this.onClick),this._viewUI.btn_skin.on(LEvent.CLICK,this,this.onClick),this._viewUI.img_sanjiao.on(LEvent.CLICK,this,this.onClick),this._viewUI.box_set.on(LEvent.CLICK,this,this.onClick),this._viewUI.btn_voice.on(LEvent.CLICK,this,this.onClick),this._viewUI.btn_zhenD.on(LEvent.CLICK,this,this.onClick),this._viewUI.btn_fuhuo.on(LEvent.CLICK,this,this.onClick),this._viewUI.on(LEvent.CLICK,this,this.onClickHandler),this._viewUI.btn_share.on(LEvent.CLICK,this,this.onClick),this._viewUI.btn_qd.on(LEvent.CLICK,this,this.onClick),this._viewUI.btn_zhuanpan.on(LEvent.CLICK,this,this.onClick),this._viewUI.img_start_hand.on(LEvent.CLICK,this,this.onClick),MessageManager.on(WXTool.BLACKEVENT,this,this.onClickHandler),MessageManager.on(WXTool.SUPER_SKIN,this,this.onSuperSkin),MessageManager.on(WXTool.SHARED_SUCCESS,this,this.successShare),MessageManager.on(WXTool.REBORN_COIN,this,this.onRebornCoin),MessageManager.on(WXTool.REBORN_LIBAO,this,this.onRebornCoin),this._app.plyertDataMgr.on(PlayerDataMgr.EVENT_QIANDAO,this,this.checkRedPoint),this._app.plyertDataMgr.setPlayerDataSkin(PlayerDataMgr.TYPE_TOTAL_LOGIN_CONTINUE),this._app.plyertDataMgr.setPlayerDataSkin(PlayerDataMgr.TYPE_TOTAL_LOGIN),this._app.plyertDataMgr.on(PlayerDataMgr.SKINCHAGNE,this,this.pifuChange),this.updateStar(),this.onChange(),this.pifuChange(this._app.plyertDataMgr.getTuSiJi()),console.log("进入步骤0"),WXTool.countAd=0,WXTool.adViewInit(this._view),this.checkRedPoint(),this._app.plyertDataMgr.checkFirstLogin(),this._app.plyertDataMgr.setDataIntoLocal(),0==WXTool.viewHight&&(WXTool.viewHight=Laya.Browser.clientHeight,WXTool.viewWidth=Laya.Browser.clientWidth),WXTool.layouBanner(),this._viewUI.btn_chengjiu.visible=!1,this._viewUI.btn_want.visible=!1,this._viewUI.btn_levelUp.visible=!1,this.on(LEvent.MOUSE_DOWN,this,this.onmousedown),this.on(LEvent.MOUSE_MOVE,this,this.onmousemove),this.on(LEvent.MOUSE_UP,this,this.onmouseup),this._isMouseDown=!1,this.setMouseHand(0),this.updateMaxScore(),this._viewUI.btn_zhenD.selected=!PlayerDataMgr.isZhenDong,this._viewUI.btn_voice.selected=!PlayerDataMgr.isPlayBgMusic},t.prototype.onmousedown=function(t){this._isMouseDown=!0,this._mousePosx=this.mouseX},t.prototype.onmousemove=function(t){if(this._isMouseDown){var e=(this.mouseX-this._mousePosx)/150;1<=e&&this.onStart(),this.setMouseHand(e)}},t.prototype.onmouseup=function(t){this._isMouseDown=!1,this.setMouseHand(0)},t.prototype.setMouseHand=function(t){t<0&&(t=0),1<t&&(t=1);var e=335*t;this._viewUI.img_start_hand.x=e},t.prototype.updateMaxScore=function(){this._viewUI.txt_best.text=this._app.plyertDataMgr.getMaxScore()+""},t.prototype.checkRedPoint=function(){var t=this._app.sync.serverTimeBys,e=(a.Sync.getDayZeroTime(1e3*t),this._app.plyertDataMgr.getTurntableTime(),a.Sync.getTimeWeekDay(this._app.sync.serverTimeByms)-1);-1==e&&(e=6),this._app.plyertDataMgr.getQianBitWeek(e);var i=this._app.plyertDataMgr.getBuQian();console.log("buqian=====",i),!i||a.Sync.getIsToday(i,t),console.log("curDay",e);for(var n=e-1;n<e&&!(n<0)&&(console.log("this._app.plyertDataMgr.getQianBitWeek(index)",this._app.plyertDataMgr.getQianBitWeek(n)),0!=this._app.plyertDataMgr.getQianBitWeek(n));n++);},t.prototype.setSettingStateView=function(t){if(!t||180!=this._viewUI.img_sanjiao.rotation){if(!t)return this._viewUI.img_sanjiao.x=41,this._viewUI.img_sanjiao.y=46,this._viewUI.img_sanjiao.rotation=0,this._viewUI.panl_tuo.parent&&this._viewUI.panl_tuo.parent.removeChild(this._viewUI.panl_tuo),void this.off(LEvent.MOUSE_DOWN,this,this.onDown);this._viewUI.img_sanjiao.x=85,this._viewUI.img_sanjiao.y=77,this._viewUI.img_sanjiao.rotation=180,this._viewUI.box_xiala.y=-279,this._viewUI.box_head.addChildAt(this._viewUI.panl_tuo,0),this.on(LEvent.MOUSE_DOWN,this,this.onDown),Laya.Tween.to(this._viewUI.box_xiala,{y:-39},500)}},t.prototype.updateStartSign=function(){.5==this._app.plyertDataMgr.shareBeiNum&&(this._viewUI.img_share1.visible=!1,this._viewUI.img_share2.visible=!0,this._viewUI.img_share2.skin="tongyong/jb11.png"),(isDebug||WXTool.isML1)&&1==this._app.plyertDataMgr.getAddSpeedStatus()&&(this._viewUI.img_share2.visible=!0,this._viewUI.img_share2.skin="tongyong/jb12.png")},t.prototype.successShare=function(){console.log("主界面金杯倍数增加",this._app.plyertDataMgr.shareBeiNum),this._app.plyertDataMgr.shareBeiNum=.5,this.updateStartSign()},t.prototype.onChange=function(){},t.prototype.pifuChange=function(t){},t.prototype.updateStar=function(){this._viewUI.btn_fuhuo.visible=WXTool.isShare,this._viewUI.box_share.visible=WXTool.isShare},t.prototype.layout=function(){r.prototype.layout.call(this),this._view},t.prototype.onClickHandler=function(t){this._gamePage&&this._gamePage.suoView()},t.prototype.onSuperSkin=function(){var t=WXTool._openId;console.log("************************onSuperSkin:",t,WXTool.wxOpenid),t&&""!=t&&WXTool.wxOpenid&&""!=WXTool.wxOpenid&&t!=WXTool.wxOpenid&&WXTool.setShareCount(t,this._app.wxUserInfo.avatarUrl,this._app.wxUserInfo.nickName)},t.prototype.onRebornCoin=function(){console.log("===================复活币点进来==========22222=========");var t=WXTool._openId;t&&""!=t&&WXTool.wxOpenid&&""!=WXTool.wxOpenid&&t!=WXTool.wxOpenid&&(WXTool.setinvite(t,0),console.log("===================复活币点进来==========33333=========="))},t.prototype.onRebornLibao=function(){console.log("===================复活币礼包点进来=========22222===========");var t=WXTool._openId;t&&""!=t&&WXTool.wxOpenid&&""!=WXTool.wxOpenid&&t!=WXTool.wxOpenid&&(WXTool.setinvite(t,1),console.log("===================复活币礼包点进来=========33333==========="))},t.prototype.onClick=function(t){switch(t.currentTarget){case this._viewUI.btn_start:break;case this._viewUI.img_start_hand:return void this.onStart();case this._viewUI.btn_top:this._app.uiRoot.openSortPage();break;case this._viewUI.btn_skin:this._app.uiRoot.general.open(e.PageDef.SKIN_MAIN_PAGE);break;case this._viewUI.btn_fuhuo:this._app.uiRoot.general.open(e.PageDef.FUHUO_PAGE,function(t){t.isOnScene=!1});break;case this._viewUI.btn_share:return void(isDebug?this.successShare():WXTool.shareFriend());case this._viewUI.btn_qd:return void this._app.uiRoot.general.open(e.PageDef.QIANDAO);case this._viewUI.btn_zhuanpan:this._app.uiRoot.general.open(e.PageDef.TURNTABLEPAGE);break;case this._viewUI.box_set:case this._viewUI.img_sanjiao:return void this.setSettingStateView(0==this._viewUI.img_sanjiao.rotation);case this._viewUI.btn_voice:return this._viewUI.btn_voice.selected=!this._viewUI.btn_voice.selected,void(PlayerDataMgr.isPlayBgMusic=!this._viewUI.btn_voice.selected);case this._viewUI.btn_zhenD:return this._viewUI.btn_zhenD.selected=!this._viewUI.btn_zhenD.selected,void(PlayerDataMgr.isZhenDong=!this._viewUI.btn_zhenD.selected)}this.close()},t.prototype.onDown=function(t){switch(t.target){case this:for(var e=t.target.parent;e;)if(e==this._viewUI.box_head)return;t.stopPropagation(),this.setSettingStateView(!1)}},t.prototype.onStart=function(){this._app.sceneRoot.reset(),this.close()},t.prototype.close=function(){this._view,MessageManager.off(WXTool.BLACKEVENT,this,this.onClickHandler),MessageManager.off(WXTool.SUPER_SKIN,this,this.onSuperSkin),MessageManager.off(WXTool.REBORN_COIN,this,this.onRebornCoin),MessageManager.off(WXTool.REBORN_LIBAO,this,this.onRebornCoin),MessageManager.off(WXTool.SHARED_SUCCESS,this,this.successShare),this._app.plyertDataMgr.off(PlayerDataMgr.EVENT_QIANDAO,this,this.checkRedPoint),this._app.plyertDataMgr.off(PlayerDataMgr.SKINCHAGNE,this,this.pifuChange),this._app.plyertDataMgr.off(PlayerDataMgr.STARCHAGNE,this,this.updateStar),this.off(LEvent.MOUSE_DOWN,this,this.onmousedown),this.off(LEvent.MOUSE_MOVE,this,this.onmousemove),this.off(LEvent.MOUSE_UP,this,this.onmouseup),this.off(LEvent.MOUSE_DOWN,this,this.onDown),this._viewUI.img_sanjiao.off(LEvent.CLICK,this,this.onClick),this._viewUI.box_set.off(LEvent.CLICK,this,this.onClick),this._viewUI.btn_voice.off(LEvent.CLICK,this,this.onClick),this._viewUI.btn_zhenD.off(LEvent.CLICK,this,this.onClick),this._viewUI.img_start_hand.off(LEvent.CLICK,this,this.onClick),Laya.Tween.clearAll(this._viewUI.panl_tuo),r.prototype.close.call(this)},t}(a.gui.base.Page),e.PageStart=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(a){var t,e,i;t=a.gui||(a.gui={}),e=t.page||(t.page={}),i=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n._isModal=!0,n._asset=[a.Path.uiAtlas+"pifu.atlas",a.Path.uiAtlas+"huodepifu.atlas"],n}return __extends(t,r),t.prototype.init=function(){this._viewUI=this._view=new ui.HuoDePiFuUI,this.addChild(this._view)},t.prototype.onOpen=function(){r.prototype.onOpen.call(this),DisplayU.setMouseListener(this._viewUI.btn_cancel,!0,this,this.onClick),DisplayU.setMouseListener(this._viewUI.btn_sure,!0,this,this.onClick),DisplayU.setMouseListener(this._viewUI,!0,this,this.onClick),MessageManager.on(WXTool.SHARED_SUCCESS,this,this.close),MessageManager.on(WXTool.BLACKEVENT,this,this.close)},t.prototype.setData=function(t){this._viewUI.img_icon.skin="scene/pifu/icon/"+t.avatar+(2==t.type?".jpg":".png"),this._viewUI.txt_desc.visible=!1,this._viewUI.txt_name.text=t.name},t.prototype.onClick=function(t){switch(t.currentTarget){case this._viewUI.btn_cancel:case this._viewUI.btn_sure:this._app.uiRoot.general.open(e.PageDef.TURNTABLEPAGE),this.close()}},t.prototype.close=function(){MessageManager.off(WXTool.SHARED_SUCCESS,this,this.close),MessageManager.off(WXTool.BLACKEVENT,this,this.close),r.prototype.close.call(this)},t}(a.gui.base.Page),e.PiFuGetPage=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i,n;e=t.gui||(t.gui={}),i=e.page||(e.page={}),n=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n._headArrAll=new Array,n._headArr=new Array,n._tempIdx=0,n._curIndex=0,n._time=0,n._isModal=!0,n}return __extends(t,r),t.prototype.init=function(){},t.prototype.onOpen=function(){r.prototype.onOpen.call(this),this.drawBlack(.75,"#000000"),this._tempIdx=MathU.randomRange(1,36),this.updateInfo(),this.reset(),this.getHeadArr(),Laya.timer.loop(this._time/36,this,this.updateHead)},t.prototype.updateHead=function(){this._curIndex<36?(Laya.loader.load("scene/q_head/6ab111d_q_head_"+this._headArr[this._curIndex]+".jpg",Handler.create(this,this.onComplete,[this._curIndex])),this._curIndex++,this._time-=2500/36):(this._app.sceneRoot.reset(),1==this._app.plyertDataMgr.getAddSpeedStatus()&&(this._app.plyertDataMgr.setAddSpeedStatus(2),this._app.sceneRoot.mainPlayer.playerScript.isWuDi=!0),this.close())},t.prototype.onComplete=function(t){},t.prototype.getHeadArr=function(){this._headArr.length=0;for(var t=this._headArrAll.length=0;t<101;t++)this._headArrAll.push(t);for(t=0;t<36;t++){var e=Math.floor(this._headArrAll.length*Math.random());this._headArr.push(this._headArrAll[e]),this._headArrAll.splice(e,1)}},t.prototype.renderItemcb=function(t,e){},t.prototype.updateInfo=function(){},t.prototype.reset=function(){this._curIndex=0,this._time=2500},t.prototype.onClick=function(t){t.currentTarget},t.prototype.close=function(){this.reset(),Laya.timer.clearAll(this),r.prototype.close.call(this)},t}(t.gui.base.Page),i.PiPeiPage=n}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(a){var t,e,i;t=a.gui||(a.gui={}),e=t.page||(t.page={}),(i=function(r){function n(t,e,i){var n=r.call(this,t,e,i)||this;return n._curDay=-2,n._asset=[a.Path.uiAtlas+"qiridenglu.atlas",a.Path.uiAtlas+"tongyong.atlas",a.Path.uiAtlas+"jiesuan.atlas"],n}return __extends(n,r),n.prototype.init=function(){this._viewUI=this._view=new ui.LianXuDengLuUI,this.addChild(this._view)},n.prototype.onOpen=function(){r.prototype.onOpen.call(this),this.initList(),this._viewUI.checkBox.selected=!0,this.checkBox(),this._viewUI.btnHome.on(LEvent.CLICK,this,this.close),this._viewUI.btn_double.on(LEvent.CLICK,this,this.onBtnClick),this._viewUI.checkBox.on(LEvent.CLICK,this,this.checkBox),this._app.plyertDataMgr.on(PlayerDataMgr.EVENT_QIANDAO,this,this.checkBox)},n.prototype.onBtnClick=function(){var t=this;0<=PlayerDataMgr.goldDays.indexOf(this._curDay)&&this._viewUI.checkBox.selected?WXTool.getVideo(function(){t.getReward(),t.close()}):(this.getReward(),this.close())},n.prototype.initDay=function(){n.IS_NEED_CONTINUE?this.getCurDay():this._curDay=a.Sync.getTimeWeekDay(this._app.sync.serverTimeByms)-1,-1==this._curDay&&(this._curDay=6)},n.prototype.getReward=function(){var t=this._curDay;if(this._app.plyertDataMgr.setQianBitWeek(t),this._app.plyertDataMgr.setLingQuWeek(t,!1,this._viewUI.checkBox.selected),n.IS_NEED_CONTINUE){var e=this._app.plyertDataMgr.getSignTime();if(e&&this._CurZeroTime==e)return;this._app.plyertDataMgr.setSignTime(this._CurZeroTime)}},n.prototype.checkBox=function(){this.initDay(),this.updateUI();var t=this._viewUI.checkBox;if(n.IS_NEED_CONTINUE)this._CurZeroTime==this._app.plyertDataMgr.getSignTime()&&(this._viewUI.btn_double.disabled=!0),t.selected?this._viewUI.img_txt.skin="qiridenglu/tu_lqsb.png":this._viewUI.img_txt.skin="qiridenglu/tu_lqjl.png";else{var e=this._app.plyertDataMgr.getLingQuWeek(this._curDay);0==this._curDay||2==this._curDay||3==this._curDay||5==this._curDay?(this._viewUI.checkBox.visible=!0,e?this._viewUI.btn_double.disabled=!0:(this._viewUI.btn_double.disabled=!1,t.selected?this._viewUI.img_txt.skin="qiridenglu/tu_lqsb.png":this._viewUI.img_txt.skin="qiridenglu/tu_lqjl.png")):(this._viewUI.checkBox.visible=!1,this._viewUI.img_txt.skin="qiridenglu/tu_lqjl.png",this._viewUI.btn_double.disabled=!!e)}},n.prototype.updateUI=function(){this._viewUI.list_day.array=PlayerDataMgr.DayDatas},n.prototype.initList=function(){this._viewUI.list_day.renderHandler=new Handler(this,this.updateBox)},n.prototype.updateBox=function(t,e){t.img_double.visible=!1,t.img_YL.visible=!1,n.IS_NEED_CONTINUE?(t.txt_day.text=n.DAYS[e],this._curDay==e&&this._CurZeroTime!=this._app.plyertDataMgr.getSignTime()?t.img_di.disabled=!1:t.img_di.disabled=!0):(t.txt_day.text=n.WEEKSTR[e],this._curDay==e&&(t.img_di.disabled=!1)),6==e&&(t.img_di.width=277,t.img_di.height=224,t.img_di.sizeGrid="0,51,0,30",t.img_icon.skin="tongyong/tu_qian6.png"),-1!=PlayerDataMgr.goldDays.indexOf(e)?(t.img_icon.size(85,80),this._viewUI.checkBox.selected?t.img_icon.skin="tongyong/tu_qian4.png":t.img_icon.skin="tongyong/tu_qian6.png"):(6==e&&(t.img_icon.x=142),t.img_icon.skin="jiesuan/tu_fuhuobi.png"),this._viewUI.checkBox.selected?t.txt_num.text="+"+2*PlayerDataMgr.DayDatas[e]:t.txt_num.text="+"+PlayerDataMgr.DayDatas[e];var i=this._app.plyertDataMgr.getLingQuWeek(e);n.IS_NEED_CONTINUE?i?(t.img_double.visible=!1,t.img_YLQ.visible=!0):(t.img_YLQ.visible=!1,t.img_di.disabled=!1,this._curDay==e&&this._viewUI.checkBox.selected&&0<=PlayerDataMgr.goldDays.indexOf(e)?t.img_double.visible=!0:t.img_double.visible=!1):i&&this._curDay==e?(t.img_double.visible=!1,t.img_YLQ.visible=!0):(t.img_YLQ.visible=!1,this._curDay==e&&this._viewUI.checkBox.selected&&0<=PlayerDataMgr.goldDays.indexOf(e)?t.img_double.visible=!0:t.img_double.visible=!1)},n.prototype.getCurDay=function(){var t=this._app.sync.serverTimeBys;this._CurZeroTime=a.Sync.getDayZeroTime(1e3*t);for(var e=this._app.plyertDataMgr.getSignTime(),i=0;i<n.MAX_DAYS;i++)if(!this._app.plyertDataMgr.getQianBitWeek(i)){if(this._CurZeroTime!=e||!e){this._curDay=i;break}this._curDay=-2}},n.prototype.close=function(){this._app.plyertDataMgr.off(PlayerDataMgr.EVENT_QIANDAO,this,this.checkBox),r.prototype.close.call(this)},n}(a.gui.base.Page)).IS_NEED_BuQian=!1,i.IS_NEED_CONTINUE=!0,i.MAX_DAYS=7,i.WEEKSTR=["星期一","星期二","星期三","星期四","星期五","星期六","星期日"],i.DAYS=["第一天","第二天","第三天","第四天","第五天","第六天","第七天"],e.QianDaoPage=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(a){var t,e,i;t=a.gui||(a.gui={}),e=t.page||(t.page={}),i=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n._isTurntable=!1,n._isSuccess=!1,n._isModal=!0,n._asset=[a.Path.uiAtlas+"jiesuan.atlas"],n}return __extends(t,r),Object.defineProperty(t.prototype,"isTurntable",{get:function(){return this._isTurntable},set:function(t){this._isTurntable=t},enumerable:!0,configurable:!0}),t.prototype.init=function(){this._view=this._viewUI=new ui.HuoDeJinBiUI,this.addChild(this._viewUI)},t.prototype.close=function(){this._isTurntable&&this._app.uiRoot.general.open(e.PageDef.TURNTABLEPAGE),MessageManager.off(WXTool.VIDEO_SUCCESS,this,this.onVideo),this._app.plyertDataMgr.setPlayerDataSkin(PlayerDataMgr.TYPE_TOTAL_GAME_TIMES),r.prototype.close.call(this)},t.prototype.onOpen=function(){r.prototype.onOpen.call(this),this._viewUI.btn_video.disabled=!1,this._viewUI.btn_video.on(LEvent.CLICK,this,this.onClick),this._viewUI.btn_lq.on(LEvent.CLICK,this,this.onClick),MessageManager.on(WXTool.VIDEO_SUCCESS,this,this.onVideo),this._viewUI.btn_video.visible=!0,this._dataSource&&(this._dataSource=Math.ceil(this._dataSource)),WXTool.adViewInit(this._viewUI),this.initUI(),WXTool.layouBanner(),this._viewUI.img_friend.visible=!1},t.prototype.initUI=function(){this._viewUI.txt_gold.text=this._dataSource,this.addGold(this._dataSource),this._isTurntable},t.prototype.addGold=function(t){var e=this._app.plyertDataMgr.getGold();this._app.plyertDataMgr.updateGold(e+t)},t.prototype.onVideo=function(){this._isSuccess||(this._isSuccess=!0,this.addGold(this._dataSource),this._viewUI.btn_video.disabled=!0,this._viewUI.txt_gold.text=2*this._dataSource+"")},t.prototype.onClick=function(t){switch(t.currentTarget){case this._viewUI.btn_video:isDebug?this.onVideo():WXTool.getVideo();break;case this._viewUI.btn_lq:this._app.uiRoot.general.open(e.PageDef.START_PAGE),this._app.sceneRoot.resetScene(),this._app.sceneRoot.putBackEffectTuoWei(),this.close()}},t.prototype.layout=function(){r.prototype.layout.call(this),this._view},t}(a.gui.base.Page),e.ResultGoldReward=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(a){var t,i,e;t=a.gui||(a.gui={}),i=t.page||(t.page={}),e=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n._time=30,n._asset=[a.Path.uiAtlas+"jiesuan.atlas"],n}return __extends(t,r),t.prototype.init=function(){this._viewUI=this._view=new ui.FuHuoUI,this.addChild(this._view),this._viewUI.txt_score.visible=!1,this._rank=new ClipUtil(ClipUtil.PET_ZZ_FONT),this._rank.scaleX=1.5,this._rank.scaleY=1.5,this._rank.y=this._viewUI.txt_score.y+this._viewUI.txt_score.parent.y,this.addChild(this._rank)},t.prototype.onOpen=function(){var t=this;r.prototype.onOpen.call(this),WXTool.wxPlayInfo||WXTool.userInfoButton||WXTool.createWxUseInfoBtn();var e={type:"opensingleshow",showType:0,score:this._score,time:this._app.sync.serverTimeByms};WXTool.postDataOpen(e),this.openZone(),this.drawBlack(.75,"#000000"),WXTool.isShare&&(this._viewUI.btn_skip.visible=!1,Laya.timer.once(2e3,this,function(){t._viewUI.btn_skip.visible=!0})),DisplayU.setMouseListener(this._viewUI.btn_skip,!0,this,this.onClick),DisplayU.setMouseListener(this._viewUI.btn_relife,!0,this,this.onClick),DisplayU.setMouseListener(this._viewUI.btn_share,!0,this,this.onClick),DisplayU.setMouseListener(this._viewUI.btn_relife_use,!0,this,this.onClick),this.updateInfo(),MessageManager.on(WXTool.VIDEO_SUCCESS,this,this.videoAgain),MessageManager.on(WXTool.SHARED_SUCCESS,this,this.videoAgain),MessageManager.on(WXTool.GAME_REVIED,this,this.onGameRevied),this.checkFuhuoState(),this._rank.setText(this._app.sceneRoot.PlayScore.toFixed(0)),this._rank.centerX=0,WXTool.countAd=0,WXTool.adViewInit(this._viewUI),console.log("分享次数",WXTool.isShare,WXTool.reliveCount),WXTool.isShare&&(this._viewUI.btn_skip.y=WXTool.onIpx?this._viewUI.btn_relife.y+this._viewUI.btn_relife.height+110:this._viewUI.btn_relife.y+this._viewUI.btn_relife.height+65),WXTool.layouBanner()},t.prototype.checkFuhuoState=function(){console.log("开启分享界面",WXTool.isShare,WXTool._state,WXTool.reliveCount),WXTool._state==a.SceneRoot.STATUS_OVER&&1<=WXTool.reliveCount?(2<=WXTool.reliveCount?(this._viewUI.btn_share.visible=!1,this._viewUI.btn_relife.visible=!1,this._viewUI.btn_relife_use.visible=!0,MessageManager.off(WXTool.VIDEO_SUCCESS,this,this.videoAgain),MessageManager.off(WXTool.SHARED_SUCCESS,this,this.videoAgain)):this._viewUI.btn_share.visible=!1,this._viewUI.btn_relife.visible=!0):WXTool.isShare?(this._viewUI.btn_share.visible=!0,this._viewUI.btn_relife.visible=!1):(this._viewUI.btn_share.visible=!1,this._viewUI.btn_relife.visible=!0),this._viewUI.btn_relife_use.visible=!1},t.prototype.openZone=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=1),void 0===n&&(n=1),this._openZone||(this._openZone=new Laya.Sprite);var r=this._viewUI.mouseLayer;this._openZone.size(r.width,r.height),this._openZone.parent||(console.log("打开开放域",Laya.Browser.onMiniGame),r.addChild(this._openZone),this._openZone.x=t,this._openZone.y=e,Laya.Browser.onMiniGame&&(Laya.Browser.window.sharedCanvas.width=r.width,Laya.Browser.window.sharedCanvas.height=r.height,this._openZoneTexture||(this._openZoneTexture=new Laya.Texture(Laya.Browser.window.sharedCanvas)),this._openZoneTexture.bitmap.alwaysChange=!0,console.log("开放域大小",this._openZoneTexture.width,this._openZoneTexture.height,Laya.Browser.window.sharedCanvas.width,Laya.Browser.window.sharedCanvas.height),this._openZone.graphics.drawTexture(this._openZoneTexture,0,0,this._openZoneTexture.width,this._openZoneTexture.height,new Laya.Matrix(i,0,0,n))))},t.prototype.closeOpenZone=function(){console.log("this._openZone"+this._openZone),this._openZone&&(console.log("关闭开放域"),this._openZoneTexture&&this._openZoneTexture.bitmap&&(this._openZoneTexture.bitmap.alwaysChange=!1,this._openZoneTexture=null),this._openZone.graphics.clear(),this._openZone.removeSelf(),WXTool.closePageOpen("singlePage"))},t.prototype.close=function(){this._app.uiRoot.general.close(i.PageDef.YOUXI_PAGE),this.closeOpenZone(),MessageManager.off(WXTool.VIDEO_SUCCESS,this,this.videoAgain),MessageManager.off(WXTool.SHARED_SUCCESS,this,this.videoAgain),MessageManager.off(WXTool.GAME_REVIED,this,this.onGameRevied),this._viewUI&&(DisplayU.setMouseListener(this._viewUI.btn_skip,!1,this,this.onClick),DisplayU.setMouseListener(this._viewUI.btn_relife,!1,this,this.onClick),DisplayU.setMouseListener(this._viewUI.btn_share,!1,this,this.onClick),DisplayU.setMouseListener(this._viewUI.btn_relife_use,!1,this,this.onClick),r.prototype.close.call(this))},t.prototype.onGameRevied=function(t){this._app.plyertDataMgr.setGameReviedRelifeTime(),this.videoAgain()},t.prototype.videoAgain=function(){this._app.sceneRoot.test(),this._app.sceneRoot.mainPlayer.playerScript.addWuDi(),this.close()},t.prototype.getScore=function(t){this._score=this._app.sceneRoot.PlayScore,this._score||(this._score=0),this._viewUI.txt_score.text=this._score.toString()},t.prototype.updateInfo=function(){WXTool.score=parseInt(this._app.sceneRoot.PlayScore.toFixed(0)),this._app.plyertDataMgr.updateScore(WXTool.score)},t.prototype.onClick=function(t){switch(t.currentTarget){case this._viewUI.btn_skip:if(WXTool.isShare=!0,WXTool.isShare){var e=this._app.uiRoot.general.getPage(i.PageDef.FUHUO_PAGE);e&&e.isOpened&&e.close(),this._isShowGoToRelife||this._app.uiRoot.general.open(i.PageDef.RESULT_RANK),this.close()}else this._app.uiRoot.general.open(i.PageDef.START_PAGE),this.close();break;case this._viewUI.btn_relife:this._viewUI.btn_relife.disabled=!0,isDebug?this.videoAgain():WXTool.getVideo();break;case this._viewUI.btn_relife_use:this._app.uiRoot.general.open(i.PageDef.FUHUO_PAGE,function(t){t.isOnScene=!0});break;case this._viewUI.btn_share:isDebug?this.videoAgain():WXTool.shareFriend()}},t}(a.gui.base.Page),i.ResultRestart=e}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i,n;e=t.gui||(t.gui={}),i=e.page||(e.page={}),n=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n._isModal=!0,n._asset=[],n}return __extends(t,r),t.prototype.init=function(){},t.prototype.close=function(){MessageManager.off(WXTool.BLACKEVENT,this,this.close),this._dataSource||this._app.uiRoot.general.open(i.PageDef.RESULT_RANK),r.prototype.close.call(this)},t.prototype.onOpen=function(){r.prototype.onOpen.call(this),MessageManager.on(WXTool.BLACKEVENT,this,this.close),this.initUI()},t.prototype.initUI=function(){var t=this;WXTool.getShareCount(function(){PlayerDataMgr.SUPER_SKIN_COUNT,WXTool.sharecount,"1"!=t._app.plyertDataMgr.getSkinActive(22)&&WXTool.sharecount>=PlayerDataMgr.SUPER_SKIN_COUNT&&t._app.plyertDataMgr.setSkinActive(22),WXTool.sharePlayers})},t.prototype.onClick=function(t){},t.prototype.layout=function(){r.prototype.layout.call(this),this._view},t}(t.gui.base.Page),i.ResultSkin=n}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,n,i;e=t.gui||(t.gui={}),n=e.page||(e.page={}),i=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n._isModal=!0,n._asset=[],n}return __extends(t,r),t.prototype.init=function(){this._view=this._viewUI=new ui.JieSuanUI,this.addChild(this._view),this._viewUI.txt_score.visible=!1,this._rank=new ClipUtil(ClipUtil.PET_ZZ_FONT),this._rank.scaleX=1.5,this._rank.scaleY=1.5,this._rank.y=this._viewUI.txt_score.y+this._viewUI.txt_score.parent.y,this.addChild(this._rank)},t.prototype.close=function(){MessageManager.off(WXTool.SHARED_SUCCESS,this,this.onShare),this.closeOpenZone(),r.prototype.close.call(this)},t.prototype.onOpen=function(){var t=this;r.prototype.onOpen.call(this),this.openAgain(),this._viewUI.btn_share.on(LEvent.CLICK,this,this.onClick),this._viewUI.btn_restart.on(LEvent.CLICK,this,this.onClick),WXTool.isShare&&(this._viewUI.btn_skip.visible=!1,Laya.timer.once(2e3,this,function(){t._viewUI.btn_skip.visible=!0})),this._viewUI.btn_skip.on(LEvent.CLICK,this,this.onClick),this._viewUI.txt_allTop.on(LEvent.CLICK,this,this.onClick),MessageManager.on(WXTool.SHARED_SUCCESS,this,this.onShare),WXTool.countAd=0,WXTool.adViewInit(this._viewUI),this.initUI(),WXTool.layouBanner()},t.prototype.openAgain=function(){var t={type:"opensingleshow",showType:1,score:0,time:this._app.sync.serverTimeByms};WXTool.postDataOpen(t),this.openZone()},t.prototype.initUI=function(){this._rank.setText(this._app.sceneRoot.PlayScore.toFixed(0)),this._rank.centerX=0},t.prototype.onShare=function(){var i=this;console.log("结算界面金币倍数增加",this._app.plyertDataMgr.shareBeiNum),this._app.uiRoot.general.open(n.PageDef.RESULT_GOLD_REWARD,function(t){var e=~~(i._app.sceneRoot.PlayScore/PlayerDataMgr.SCORE_TO_GOLD_RATE);e=e?e>PlayerDataMgr.SCORE_TO_GOLD_MAX?PlayerDataMgr.SCORE_TO_GOLD_MAX:e:0,t.dataSource=e*(i._app.plyertDataMgr.shareBeiNum+1),i._app.plyertDataMgr.shareBeiNum=0}),this.close()},t.prototype.onClick=function(t){switch(t.currentTarget){case this._viewUI.btn_skip:case this._viewUI.btn_restart:this._app.uiRoot.general.open(n.PageDef.START_PAGE),this.close();break;case this._viewUI.btn_share:WXTool.shareFriend();break;case this._viewUI.txt_allTop:this._app.uiRoot.general.open(n.PageDef.TOP_PAGE),this.close()}},t.prototype.openZone=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=1),void 0===n&&(n=1),this._openZone||(this._openZone=new Laya.Sprite);var r=this._viewUI.mouseLayer;this._openZone.size(r.width,r.height),this._openZone.parent||(console.log("打开开放域",Laya.Browser.onMiniGame),r.addChild(this._openZone),this._openZone.x=t,this._openZone.y=e,Laya.Browser.onMiniGame&&(Laya.Browser.window.sharedCanvas.width=r.width,Laya.Browser.window.sharedCanvas.height=r.height,this._openZoneTexture||(this._openZoneTexture=new Laya.Texture(Laya.Browser.window.sharedCanvas)),this._openZoneTexture.bitmap.alwaysChange=!0,console.log("开放域大小",this._openZoneTexture.width,this._openZoneTexture.height,Laya.Browser.window.sharedCanvas.width,Laya.Browser.window.sharedCanvas.height),this._openZone.graphics.drawTexture(this._openZoneTexture,0,0,this._openZoneTexture.width,this._openZoneTexture.height,new Laya.Matrix(i,0,0,n))))},t.prototype.closeOpenZone=function(){console.log("this._openZone"+this._openZone),this._openZone&&(console.log("关闭开放域"),this._openZoneTexture&&this._openZoneTexture.bitmap&&(this._openZoneTexture.bitmap.alwaysChange=!1,this._openZoneTexture=null),this._openZone.graphics.clear(),this._openZone.removeSelf(),WXTool.closePageOpen("thirdHead"))},t.prototype.layout=function(){r.prototype.layout.call(this),this._view},t}(t.gui.base.Page),n.ResultTop=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i,n;e=t.gui||(t.gui={}),i=e.page||(e.page={}),n=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n._isModal=!0,n._asset=[],n}return __extends(t,r),t.prototype.init=function(){},t.prototype.close=function(){this._app.uiRoot.general.open(i.PageDef.START_PAGE),r.prototype.close.call(this)},t.prototype.onOpen=function(){r.prototype.onOpen.call(this),this.initUI()},t.prototype.initUI=function(){},t.prototype.onClick=function(t,e){},t.prototype.layout=function(){r.prototype.layout.call(this),this._view},t}(t.gui.base.Page),i.settingPage=n}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(o){var t;(function(e){var i=function(r){function a(t,e,i){var n=r.call(this,t,e,i)||this;return n._curTabIndex=-1,n._isModal=!1,n._asset=[o.Path.uiAtlas+"pifu.atlas",o.Path.uiAtlas+"/pifu/icon.atlas"],n}return __extends(a,r),a.prototype.init=function(){this._view=this._viewUI=new ui.PiFuUI,this.addChild(this._view),this._tabArr=new Array(a.TAB_NUM),this._tabArr[0]=this._viewUI.btn_skin,this._tabArr[1]=this._viewUI.btn_eff,this._curSelectData=new Array(a.TAB_NUM),this._viewUI.list_skin.itemRender=t,this._viewUI.list_skin.vScrollBarSkin="",this._viewUI.list_skin.scrollBar.elasticDistance=200},a.prototype.onOpen=function(){r.prototype.onOpen.call(this),this.tabIndex=a.TAB_TYPE_ONE,this.onTabChange(this.tabIndex),this.addListener=!0},Object.defineProperty(a.prototype,"addListener",{set:function(t){t?(this._app.plyertDataMgr.on(PlayerDataMgr.EVENT_SKIN_BUY_FLAG,this,this.updateList),this._app.plyertDataMgr.on(PlayerDataMgr.EVENT_SKIN_USE_FLAG,this,this.updateList),this.on(a.EVENT_SKILL_CELL_CLICK,this,this.onClickSkinCell)):(this._app.plyertDataMgr.off(PlayerDataMgr.EVENT_SKIN_BUY_FLAG,this,this.updateList),this._app.plyertDataMgr.off(PlayerDataMgr.EVENT_SKIN_USE_FLAG,this,this.updateList),this.off(a.EVENT_SKILL_CELL_CLICK,this,this.onClickSkinCell)),DisplayU.setMouseListener(this._viewUI.btn_back,t,this,this.onclick);for(var e=0;e<this._tabArr.length;e++)DisplayU.setMouseListener(this._tabArr[e],t,this,this.onClickTab)},enumerable:!0,configurable:!0}),a.prototype.onClickTab=function(t){var e=this._tabArr.indexOf(t.currentTarget);-1!=e&&(this.tabIndex=e)},Object.defineProperty(a.prototype,"tabIndex",{get:function(){return this._curTabIndex},set:function(t){if(this._curTabIndex!=t){this._curTabIndex=t;for(var e=0;e<this._tabArr.length;e++)this._tabArr[e].selected=e==t;this.onTabChange(t)}},enumerable:!0,configurable:!0}),a.prototype.onTabChange=function(t){this.updateList()},a.prototype.updateList=function(){for(var t=SkinConfig.getInstance().getSkinListByType(this.tabIndex+1),e=[],i=this._curSelectData[this.tabIndex]?this._curSelectData[this.tabIndex].skinData.id:this.tabIndex==a.TAB_TYPE_ONE?this._app.plyertDataMgr.getUseSkinIndex():this._app.plyertDataMgr.getUseTuoWeiSkinIndex(),n=0;n<t.length;n++){var r=new s;r.app=this._app,r.skinData=t[n],r.index=n,r.skinPage=this,r.isSelect=r.skinData.id==i,e.push(r),r.isSelect&&(this._curSelectData[this.tabIndex]=r)}this._viewUI.list_skin.array=e},a.prototype.onClickSkinCell=function(t){var e;this._curSelectData[this.tabIndex]&&((e=this._viewUI.list_skin.getCell(this._curSelectData[this.tabIndex].index))&&e.setSelect(!1),this._viewUI.list_skin.getItem(this._curSelectData[this.tabIndex].index).isSelect=!1),this._curSelectData[this.tabIndex]=t,this._curSelectData[this.tabIndex]&&(e=this._viewUI.list_skin.getCell(this._curSelectData[this.tabIndex].index))&&e.setSelect(!0)},a.prototype.onclick=function(t){switch(t.currentTarget){case this._viewUI.btn_back:this._app.uiRoot.general.open(e.PageDef.START_PAGE),this.close()}},a.prototype.close=function(){this._view&&(this.addListener=!1),r.prototype.close.call(this)},a}(o.gui.base.Page);i.EVENT_SKILL_CELL_CLICK="EVENT_SKILL_CELL_CLICK",i.TAB_TYPE_ONE=0,i.TAB_TYPE_TWO=1,i.TAB_NUM=2,e.SkinMainPage=i;var t=function(e){function t(){var t=e.call(this)||this;return t._isOpen=!1,t.img_skin.width=128,t.img_skin.height=128,t}return __extends(t,e),Object.defineProperty(t.prototype,"dataSource",{get:function(){return this._data},set:function(t){this._data=t,this._data?this.open():this.close()},enumerable:!0,configurable:!0}),t.prototype.open=function(){this._isOpen||(this._isOpen=!0,this.on(LEvent.CLICK,this,this.onclick)),this.updateView()},t.prototype.updateView=function(){this.img_skin.skin="scene/pifu/icon/"+this._data.skinData.avatar+(2==this._data.skinData.type?".jpg":".png"),this.img_lock.visible=!this._data.app.plyertDataMgr.isBuySkinFlag(this._data.skinData.id),this.txt_num.text=PlayerDataMgr.getSkinDesc(this._data.skinData.condition),this.img_gou.visible=this._data.app.plyertDataMgr.getUseSkinIndex()==this._data.skinData.id,this.setSelect(this._data.isSelect)},t.prototype.setSelect=function(t){this._data.isSelect=t,this.img_select.visible=t},t.prototype.onclick=function(t){this._data.skinPage.event(i.EVENT_SKILL_CELL_CLICK,this._data)},t.prototype.close=function(){this._isOpen&&(this._isOpen=!1,this.off(LEvent.CLICK,this,this.onclick)),this._data=null},t.prototype.destroy=function(t){void 0===t&&(t=!0),this.close(),e.prototype.destroy.call(this,t)},t}(ui.component.PiFuItemUI);e.SkinCell=t;var s=function(){};e.SkinCellData=s})((t=o.gui||(o.gui={})).page||(t.page={}))}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(s){var t,e,i;t=s.gui||(s.gui={}),e=t.page||(t.page={}),(i=function(r){function a(t,e,i){var n=r.call(this,t,e,i)||this;return n._isModal=!1,n._asset=[s.Path.uiAtlas+"pifu.atlas",s.Path.uiAtlas+"/pifu/icon.atlas"],n}return __extends(a,r),Object.defineProperty(a.prototype,"curBigIndex",{get:function(){return this._curIndexBig},enumerable:!0,configurable:!0}),a.prototype.init=function(){this._viewUI=this._view=new ui.PiFuUI,this.addChild(this._view),this.initList(),this.initTab(),this.selectHandlerBig(a.TYPE_BALL),this.ballSkin(),this.tuoWeiEffect(),this.updateUI(),this._app.plyertDataMgr.setPlayerDataSkin(PlayerDataMgr.TYPE_TOTAL_INVITE),MessageManager.on(WXTool.SHARED_SUCCESS,this,this.shareQun),MessageManager.on(WXTool.VIDEO_SUCCESS,this,this.onVideo),this._app.plyertDataMgr.on(PlayerDataMgr.EVENT_SKIN_CHANGE,this,this.selectHandlerBig)},a.prototype.onOpen=function(){r.prototype.onOpen.call(this),DisplayU.setMouseListener(this._view.btn_back,!0,this,this.onClick),this._app.plyertDataMgr.on(PlayerDataMgr.GOLDCHANGE,this,this.updateUI),this._app.sceneRoot.hide(),this._app.showRoot.show()},a.prototype.shareQun=function(){var t=this._app.plyertDataMgr.getShareQunCount();console.log("当前获得的分享到群的次数",t),t++,this._app.plyertDataMgr.setShareQunCount(t)},a.prototype.onVideo=function(){console.log("观看视频中============="),this._app.plyertDataMgr.setPlayerDataSkin(PlayerDataMgr.TYPE_VIDEO_50);var t=this._app.localStorageMgr.getItem("TYPE_VIDEO_7"),e=s.Sync.getDayZeroTime(this._app.sync.serverTimeByms).toString();if(t){var i=t,n=i.split("&"),r=n[n.length-1];if(parseInt(r)-this._app.sync.serverTimeBys>=1e3*s.Sync.DAY_SECONDS){var a=e+"";this._app.localStorageMgr.setItem("TYPE_VIDEO_7",a)}else e!=r&&(console.log("连续观看视频次数记录前",t),i+="&",i+=e,this._app.localStorageMgr.setItem("TYPE_VIDEO_7",i+""))}else this._app.localStorageMgr.setItem("TYPE_VIDEO_7",e+"");this._app.plyertDataMgr.setPlayerDataSkin(PlayerDataMgr.TYPE_VIDEO_7)},a.prototype.ballSkin=function(){for(var t,e=this._app.plyertDataMgr.getUseSkinIndex(),i=0;i<this._totalDatas.length;i++)e==this._totalDatas[i].id&&(t=this._totalDatas[i]);var n=t?t.avatar:"role01";n&&this._app.showRoot.changeBallSkin(n)},a.prototype.tuoWeiEffect=function(){for(var t,e=a.getDataByType(2),i=this._app.plyertDataMgr.getUseTuoWeiSkinIndex(),n=0;n<e.length;n++)i==e[n].id&&(t=e[n]);var r=t?t.avatar:"qiu11";r&&this._app.showRoot.changeTuoWeiSkin(r)},a.prototype.initList=function(){this._pifuGET=new List,this._pifuGET.itemRender=s.gui.component.PiFuItem,this._pifuGET.repeatX=3,this._pifuGET.renderHandler=new Handler(this,this.renderItemcb,[!0]),this._pifuGET.spaceX=10,this._pifuNO=new List,this._pifuNO.itemRender=s.gui.component.PiFuItem,this._pifuNO.repeatX=3,this._pifuNO.renderHandler=new Handler(this,this.renderItemcb,[!1]),this._pifuNO.spaceX=10},a.prototype.updateUI=function(){for(var t=this._curArray,e=0;e<t.length;e++)this._app.plyertDataMgr.isBuySkinFlag(t[e].id);this.updatePos()},a.prototype.updatePos=function(){},a.prototype.initTab=function(){},a.prototype.selectHandlerSamll=function(t){var e;switch(null==t&&(t=this._curIndexSamll),t){case a.TYPE_CHALLENGE:e=this._changeData;break;case a.TYPE_GOLD:e=this._goldData;break;case a.TYPE_ALLSKIN:e=this._totalDatas}this._curIndexSamll=t,this._curArray=e,this.updateList(e),this.updateUI()},a.prototype.updateList=function(t){this._getData=[],this._noGetData=[];for(var e=0;e<t.length;e++)this._app.plyertDataMgr.isBuySkinFlag(t[e].id)?this._getData.push(t[e]):this._noGetData.push(t[e]);this._pifuGET.array=this._getData,this._getData.length<=0?this._pifuGET.height=0:(this._pifuGET.visible=!0,this._pifuGET.repeatY=Math.ceil(this._getData.length/3)),this._pifuNO.array=this._noGetData,this._noGetData.length<=0?this._pifuNO.height=0:(this._pifuNO.repeatY=Math.ceil(this._noGetData.length/3),this._pifuNO.visible=!0)},a.prototype.selectHandlerBig=function(t){var e;switch(null==t&&(t=this._curIndexBig),t){case a.TYPE_BALL:e=a.TYPE_BALL+1,this._totalDatas=a.getDataByType(e);break;case a.TYPE_TUOWEI:e=a.TYPE_TUOWEI+1,this._totalDatas=a.getDataByType(e);break;case a.TYPE_ZHANGAI:e=a.TYPE_ZHANGAI+1,this._totalDatas=a.getDataByType(e)}this._curIndexBig=t,this.classifyData(),this.selectHandlerSamll(a.TYPE_ALLSKIN)},a.getDataByType=function(t){for(var e=SkinConfig.getInstance().datas,i=[],n=0;n<e.length;n++)e[n].type==t&&i.push(e[n]);return i},a.prototype.classifyData=function(){this._goldData=[],this._changeData=[];for(var t=0;t<this._totalDatas.length;t++)this._totalDatas[t].condition[0]==PlayerDataMgr.TYPE_CONSUME_GOLD?this._goldData.push(this._totalDatas[t]):this._changeData.push(this._totalDatas[t])},a.prototype.renderItemcb=function(t,e,i){t?e.init(this._app,this._getData,this._curIndexBig):e.init(this._app,this._noGetData,this._curIndexBig),e.setIndex(i)},a.prototype.onClick=function(t){switch(t.currentTarget){case this._view.btn_back:this._app.uiRoot.general.open(e.PageDef.START_PAGE),this.close()}},a.prototype.layout=function(){r.prototype.layout.call(this)},a.prototype.close=function(){this._view&&(MessageManager.off(WXTool.VIDEO_SUCCESS,this,this.onVideo),MessageManager.off(WXTool.SHARED_SUCCESS,this,this.shareQun),this._app.plyertDataMgr.off(PlayerDataMgr.EVENT_SKIN_CHANGE,this,this.selectHandlerBig),this._app.plyertDataMgr.off(PlayerDataMgr.GOLDCHANGE,this,this.updateUI),r.prototype.close.call(this),this._app.sceneRoot.show(),this._app.showRoot.hide())},a}(s.gui.base.Page)).TYPE_ALLSKIN=0,i.TYPE_CHALLENGE=1,i.TYPE_GOLD=2,i.TYPE_BALL=0,i.TYPE_TUOWEI=1,i.TYPE_ZHANGAI=2,e.SkinPage=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(a){var t,e,i;t=a.gui||(a.gui={}),e=t.page||(t.page={}),i=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n._isMouseDown=!1,n._old_y=0,n._isModal=!0,n._isClickModalClose=!1,n._asset=[a.Path.uiAtlas+"top.atlas"],n}return __extends(t,r),t.prototype.init=function(){r.prototype.init.call(this),this._viewUI=this._view=new ui.TopUI,this.addChild(this._view),this._openZone=new Sprite},t.prototype.onOpen=function(){r.prototype.onOpen.call(this),console.log("打开排行榜"),this._view.btn_back.on("click",this,this.close),this._view.mouseLayer.on(LEvent.MOUSE_DOWN,this,this.onMouseDown),this._view.mouseLayer.on(LEvent.MOUSE_UP,this,this.onMouseUp),this._view.mouseLayer.on(LEvent.MOUSE_MOVE,this,this.onMouseMove),this.setData(),this.showOpenZone()},t.prototype.qunPaihang=function(){WXTool.shareFriend(1)},t.prototype.fenXiang=function(){WXTool.shareFriend()},t.prototype.onMouseDown=function(){this._old_y=this._openZone.mouseY,this._isMouseDown=!0,console.log("mousedown")},t.prototype.onMouseUp=function(){this._isMouseDown=!1,console.log("mouseup")},t.prototype.onMouseMove=function(){if(this._isMouseDown){var t=this._old_y-this._openZone.mouseY;this._old_y=this._openZone.mouseY;var e={type:"ScollSortPage",ctntrol:t};WXTool.postDataOpen(e)}},t.prototype.showOpenZone=function(){this._openZone&&!this._openZone.parent&&(console.log("打开开放域",Laya.Browser.onMiniGame),this._viewUI.addChild(this._openZone),Laya.Browser.onMiniGame&&(Laya.Browser.window.sharedCanvas.width=this._viewUI.mouseLayer.width+60,Laya.Browser.window.sharedCanvas.height=this._viewUI.mouseLayer.height,this._openZoneTexture||(this._openZoneTexture=new Texture(Laya.Browser.window.sharedCanvas)),this._openZoneTexture.bitmap.alwaysChange=!0,this._openZone.graphics.drawTexture(this._openZoneTexture,this._viewUI.mouseLayer.x,this._viewUI.mouseLayer.y-10,Laya.Browser.window.sharedCanvas.width,Laya.Browser.window.sharedCanvas.height)))},t.prototype.closeOpenZone=function(){this._openZone&&(console.log("关闭开放域"),this._openZoneTexture&&this._openZoneTexture.bitmap&&(this._openZoneTexture.bitmap.alwaysChange=!1),this._openZone.graphics.clear(),this._openZone.removeSelf())},t.prototype.setData=function(t){void 0===t&&(t=null);var e={type:"opensort",showType:this._app.plyertDataMgr.saveDataShare,time:Laya.timer.currTimer};WXTool.postDataOpen(e)},t.prototype.layout=function(){r.prototype.layout.call(this)},t.prototype.close=function(){this.isOpened&&(this.closeOpenZone(),WXTool.closePageOpen("sort"));var t=this._app.uiRoot.general.getPage(e.PageDef.RESULT_RANK);t&&t.isOpened&&t.openAgain(),this._app.uiRoot.general.open(e.PageDef.START_PAGE),r.prototype.close.call(this)},t}(a.gui.base.Page),e.SortScrollPage=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i,n;e=t.gui||(t.gui={}),i=e.page||(e.page={}),n=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n._isModal=!0,n._asset=[],n}return __extends(t,r),t.prototype.init=function(){this.addChild(this._view)},t.prototype.onOpen=function(){r.prototype.onOpen.call(this),MessageManager.on(WXTool.SHARED_SUCCESS,this,this.close),MessageManager.on(WXTool.BLACKEVENT,this,this.close),this.drawBlack()},t.prototype.onClick=function(t){},t.prototype.successShare=function(){this._app.plyertDataMgr.shareBeiNum=.5},t.prototype.close=function(){this._app.uiRoot.general.open(i.PageDef.START_PAGE),MessageManager.off(WXTool.BLACKEVENT,this,this.close),MessageManager.off(WXTool.SHARED_SUCCESS,this,this.close),r.prototype.close.call(this)},t}(t.gui.base.Page),i.TipsPage=n}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(a){var t,i,e;t=a.gui||(a.gui={}),i=t.page||(t.page={}),e=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n._gridNum=6,n._temp=[1,200,4155,1,1e3,831,1,500,1662,1,2e3,416,1,300,2770,2,1,166],n._asset=[a.Path.uiAtlas+"zhuanpan.atlas"],n}return __extends(t,r),t.prototype.init=function(){this._viewUI=this._view=new ui.ZhuanPanUI,this.addChild(this._view)},t.prototype.onOpen=function(){r.prototype.onOpen.call(this),this.drawBlack(.75,"#000000"),this._viewUI.btn_back.on(LEvent.CLICK,this,this.onClick),this._viewUI.btn_share.on(LEvent.CLICK,this,this.onClick),this._viewUI.btn_relife.on(LEvent.CLICK,this,this.onClick),MessageManager.on(WXTool.VIDEO_SUCCESS,this,this.vedioOver),this.updateBtnStatus(),Laya.timer.loop(1e3,this,this.update),this.update()},t.prototype.close=function(){MessageManager.off(WXTool.VIDEO_SUCCESS,this,this.vedioOver),this._viewUI&&Laya.Tween.clearAll(this._viewUI.img_pan),Laya.timer.clearAll(this),r.prototype.close.call(this)},t.prototype.updateBtnStatus=function(){var t=this._app.plyertDataMgr.getTurntableCD(),e=this._app.sync.serverTimeBys;this._viewUI.btn_relife.disabled=!((t||0)<e);var i=a.Sync.getDayZeroTime(1e3*e),n=this._app.plyertDataMgr.getTurntableTime();this._viewUI.btn_share.disabled=i==n},t.prototype.onClick=function(t){switch(t.currentTarget){case this._viewUI.btn_share:this._type=1,this._viewUI.btn_share.disabled=!0,this._index=this.getRandomByArray(),this.turnTable(this._index);break;case this._viewUI.btn_relife:this._index=this.getRandomByArray(),this._index=5,console.log("==========================:"+this._index),this.turnTable(this._index);break;case this._viewUI.btn_back:this._app.uiRoot.general.open(i.PageDef.START_PAGE),this.close()}},t.prototype.getRandomByArray=function(){length=this._temp.length/3;var t=0,e=0;if(this._temp){for(var i=0;i<length;i++)this._temp[i]&&(t+=this._temp[3*i+2]);for(i=0;i<length;i++){var n=Math.random()*(t-1)+1;if(this._temp[i]){if(this._temp[i]>=n){e=i;break}t-=this._temp[i]}}return e}},t.prototype.turnTable=function(t){var e=this,i=-~~(.5*(360/this._gridNum-10)),n=360*~~(10+5*Math.random()),r=-360/this._gridNum*t-5,a=3e3+~~(2e3*Math.random());this._viewUI.box_pan.rotation=this._viewUI.box_pan.rotation%360,logd("**********",i,n,r),Laya.Tween.to(this._viewUI.box_pan,{rotation:i+n+r},a,Laya.Ease.cubicInOut,Handler.create(this,function(){e.showPrize()}))},t.prototype.showPrize=function(){var e=this;2==this._temp[3*this._index]?(this._app.plyertDataMgr.setSkinActive(23),WXTool.isShare,this._app.uiRoot.general.open(i.PageDef.PIFUGETTIP,function(t){for(var e,i=0,n=SkinConfig.getInstance().datas;i<n.length;i++){var r=n[i];23==r.id&&(e=r)}t.setData(e)})):this._app.uiRoot.general.open(i.PageDef.RESULT_GOLD_REWARD,function(t){t.dataSource=e._temp[3*e._index+1],t.isTurntable=!0}),MessageManager.off(WXTool.VIDEO_SUCCESS,this,this.vedioOver),this._viewUI.img_pan.rotation=0,this.onComplete()},t.prototype.update=function(){var t=this._app.sync.serverTimeBys,e=this._app.plyertDataMgr.getTurntableCD();if((e||0)<t)this._viewUI.btn_relife.disabled=!1,this._viewUI.txt_time.text="";else{this._viewUI.btn_relife.disabled=!0;var i=Math.floor(e-t)+"";this._viewUI.txt_time.text=i+"秒后重置"}},t.prototype.onComplete=function(){var t=this._app.sync.serverTimeBys;if(1==this._type){var e=a.Sync.getDayZeroTime(1e3*t);this._app.plyertDataMgr.setTurntableTime(e)}else this._app.plyertDataMgr.setTurntableCD(t+30);this.close()},t.prototype.vedioOver=function(){this._index=this.getRandomByArray(),this.turnTable(this._index)},t}(a.gui.base.Page),i.TurntablePage=e}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,a,i;e=t.gui||(t.gui={}),a=e.page||(e.page={}),i=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n._asset=[],n}return __extends(t,r),t.prototype.init=function(){},t.prototype.onOpen=function(){r.prototype.onOpen.call(this),this.drawBlack(.75,"#000000"),MessageManager.on(WXTool.SHARED_SUCCESS,this,this.successShare),this.initData(),this.initUI()},t.prototype.initData=function(){for(var t=a.SkinPage.getDataByType(a.SkinPage.TYPE_BALL+1),e=[],i=0;i<t.length;i++)this._app.plyertDataMgr.isBuySkinFlag(t[i].id)||e.push(t[i]);var n=MathU.randomRange(0,e.length-1);this._curBallData=e[n]},t.prototype.initUI=function(){},t.prototype.onClick=function(t){},t.prototype.successShare=function(){this._app.plyertDataMgr.setIsUseLuckySkin(1),this._curBallData&&this._app.plyertDataMgr.setUseLuckSkin(this._curBallData.id),this._app.plyertDataMgr.setAddSpeedStatus(1),this._app.uiRoot.general.open(a.PageDef.PIPEI_PAGE),this.close()},t.prototype.close=function(){MessageManager.off(WXTool.SHARED_SUCCESS,this,this.successShare),r.prototype.close.call(this)},t}(t.gui.base.Page),a.XingYunPage=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(a){var t,e,i;t=a.gui||(a.gui={}),e=t.page||(t.page={}),i=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n.curCombo=0,n._time=0,n._isEnd=!1,n._curComBoTime=0,n.isDaoJiShi=!1,n._dis=0,n._powerDiff=5e-5,n._isaddSpeed=!1,n._isModal=!1,n._asset=[a.Path.uiAtlas+"play.atlas"],n}return __extends(t,r),t.prototype.init=function(){this._viewUI=this._view=new ui.YouXiUI,this.addChild(this._view)},t.prototype.onOpen=function(){r.prototype.onOpen.call(this),this.reset(),Laya.timer.loop(30,this,this.update),this._viewUI.txt_road_t.visible=!1,this._viewUI.img_gem.visible=!1,this._viewUI.txt_get_coin.visible=!1,this._viewUI.txt_speed1.visible=!1,this._viewUI.txt_beishu.visible=!1,this._viewUI.txt_dis.visible=!1},t.prototype.reset=function(){this._isEnd=!1,this._time=0,this._dis=0,this._diffTime=0,this._totoalTime=0,this._curAddTime=0,this._viewUI.txt_dis.text="0米",this._viewUI.txt_time.text=this._time+"秒",this._viewUI.progress_power.value=0,this._viewUI.progress_speed.value=0,this._viewUI.txt_speed.text="0",this._playerScript=this._app.sceneRoot.mainPlayer.playerScript},t.prototype.initTime=function(){this._curComBoTime=0,this.updateComBo(),this.isDaoJiShi=!0,Laya.timer.loop(1e3,this,this.updateComBo)},t.prototype.setTime=function(){this._curComBoTime=0},t.prototype.updateComBo=function(){2<=this._curComBoTime&&(this.curCombo=0,this._curComBoTime=0,this.isDaoJiShi=!1,Laya.timer.clear(this,this.updateComBo)),this._curComBoTime+=1},t.prototype.update=function(){if(this._isEnd)this._viewUI.txt_speed.text="0";else{this._time+=30,this._diffTime+=30,this._isEnd=!this._app.sceneRoot.isGamePlay(),this._viewUI.txt_time.text=(this._time/1e3).toFixed(0)+"秒",this._viewUI.txt_score.text=this._app.sceneRoot.PlayScore.toFixed(0);var t=this._app.sceneRoot.getScore();t>a.SceneRoot.GAME_TOTAL_NUM&&(t=a.SceneRoot.GAME_TOTAL_NUM),this._viewUI.progress_power.value=this._powerDiff*this._diffTime;var e=this.caculateSpeed(),i=this.caculateSpeed(!0);if(this._viewUI.progress_speed.value=e/i,e<=60?this._viewUI.progress_speed.skin="tongyong/progress_xuetiao4.png":e<180?this._viewUI.progress_speed.skin="tongyong/progress_xuetiao3.png":180<=e&&(this._viewUI.progress_speed.skin="tongyong/progress_xuetiao2.png"),this._viewUI.txt_speed.text=StringU.substitute("{0}",e),1<=this._viewUI.progress_power.value?(this._viewUI.ani2.isPlaying||this._viewUI.ani2.play(0,!1),this._isaddSpeed||(this._playerScript.addWuDi(),this._isaddSpeed=!0,this._curAddTime=this._diffTime),this._diffTime>=this._curAddTime+2500&&this._isaddSpeed&&(this._viewUI.progress_power.value=0,this._diffTime=0,this._isaddSpeed=!1)):(this._viewUI.img_power.visible=!1,this._viewUI.ani2.stop()),60==e?this._viewUI.ani3.isPlaying||this._viewUI.ani3.play(0,!1):(this._viewUI.img_speed.visible=!1,this._viewUI.ani3.stop()),this.curCombo<=1)this._viewUI.ani1.isPlaying&&this._viewUI.ani1.stop();else{if(this._comboDiff){if(this._comboDiff==this.curCombo)return;this._comboDiff=this.curCombo}else this._comboDiff=this.curCombo;this._viewUI.ani1.play(0,!1)}}},t.prototype.caculateSpeed=function(t){void 0===t&&(t=!1);var e=1+((t?PlayerBaseScript.maxSpeed:this._playerScript.speed_Z)-PlayerBaseScript.baseSpeed)/.001,i=Math.pow(e,3);return Math.round(.56*i+13.68*e+45.76)},t.prototype.close=function(){this.reset(),Laya.timer.clearAll(this),r.prototype.close.call(this)},t}(a.gui.base.Page),e.YouXiPage=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i;e=t.gui||(t.gui={}),i=function(i){function t(t){var e=i.call(this,t)||this;return e._tipQueue=[],e}return __extends(t,i),t.prototype.showTip=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),!t||t.length<=0||this._tipQueue&&this._tipQueue.push(t)},t.prototype.checkQueue=function(){this._tipQueue.length},t}(t.gui.base.PageContainer),e.TopUI=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i;e=t.managers||(t.managers={}),(i=function(i){function n(t){var e=i.call(this)||this;return e._app=t,e._dicObj=new Object,n.server_id=window.server_id,e}return __extends(n,i),n.prototype.getRoleLocalKey=function(t){return t},n.prototype.setItem=function(t,e,i){void 0===i&&(i=!0);var n=t;i&&(t=this.getRoleLocalKey(t)),Laya.LocalStorage.setItem(t,e),this._dicObj[t]=e,this.event(n)},n.prototype.getItem=function(t,e){void 0===e&&(e=!0),e&&(t=this.getRoleLocalKey(t));var i=this._dicObj[t];return i||(i=Laya.LocalStorage.getItem(t)),null==i?"":i},n.prototype.removeItem=function(t,e){void 0===e&&(e=!0),e&&(t=this.getRoleLocalKey(t)),Laya.LocalStorage.removeItem(t),this._dicObj[t]=null},n.prototype.setJSON=function(t,e,i){void 0===i&&(i=!0);var n=t;i&&(t=this.getRoleLocalKey(t)),Laya.LocalStorage.setJSON(t,e),this._dicObj[t]=e,this.event(n)},n.prototype.getJSON=function(t,e){void 0===e&&(e=!0),e&&(t=this.getRoleLocalKey(t));var i=this._dicObj[t];return i||(i=Laya.LocalStorage.getJSON(t)),i},Object.defineProperty(n.prototype,"isMutedMusic",{get:function(){return"true"==this.getItem("IsMute")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isMutedSound",{get:function(){return"true"==this.getItem("IsMuteSound")},enumerable:!0,configurable:!0}),n.setItem=function(t,e){Laya.LocalStorage.setItem("["+n.server_id+"]"+t,e)},n.getItem=function(t){var e=Laya.LocalStorage.getItem("["+n.server_id+"]"+t);return null==e?"":e},n}(Laya.EventDispatcher)).ACCOUNT="Account",i.IS_MUTE="IsMute",i.IS_MUTE_SOUND="IsMuteSound",i.server_id="",e.LocalStorageMgr=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(h){var t,e;t=h.managers||(h.managers={}),(e=function(i){function d(t){var e=i.call(this)||this;return e.curScore=0,e.curStar=0,e.curGold=0,e.curTimes=0,e.saveDataShare="",e.shareBeiNum=0,e.isOpenBoxCur=!1,e._app=t,e}return __extends(d,i),d.prototype.setGameReviedRelifeTime=function(){var t=Laya.timer.currTimer+2592e5;this._app.localStorageMgr.setItem("GameReviedRelifeTime",t+"")},d.prototype.getGameReviedRelifeTime=function(){return parseInt(this._app.localStorageMgr.getItem("GameReviedRelifeTime"))||0},d.prototype.setAddSpeedStatus=function(t){this._app.localStorageMgr.setItem("AddSpeedStatus",t+"")},d.prototype.getAddSpeedStatus=function(){return WXTool.isSwithOpen?parseInt(this._app.localStorageMgr.getItem("AddSpeedStatus"))||0:-1},d.prototype.updateTime=function(t){this._app.localStorageMgr.setItem("tipTime",t+"")},d.prototype.getTipTime=function(){var t=this._app.localStorageMgr.getItem("tipTime");return parseInt(t)||0},d.prototype.getMaxScore=function(){return parseInt(this._app.localStorageMgr.getItem("bestScore"))||0},d.prototype.updateScore=function(t){this.curScore=t,(parseInt(this._app.localStorageMgr.getItem("bestScore"))||0)<t&&(this._app.localStorageMgr.setItem("bestScore",t+""),this.setPlayerDataSkin(d.TYPE_BEST_SCORE));var e=parseInt(this._app.localStorageMgr.getItem("totalCore"))||0;e?(e+=this.curScore,this._app.localStorageMgr.setItem("totalCore",e+"")):this._app.localStorageMgr.setItem("totalCore",this.curScore+"")},d.prototype.updateGold=function(t){this.curGold=t,this._app.localStorageMgr.setItem("gold",t+""),this.event(d.GOLDCHANGE,this.curGold),MessageManager.event(WXTool.JINBI)},d.prototype.getGold=function(){var t=parseInt(this._app.localStorageMgr.getItem("gold"))||0;return this.curGold=t},d.prototype.updateTimesGame=function(t){this.curTimes=t,this._app.localStorageMgr.setItem("Times",t+"")},d.prototype.getTimeGame=function(){var t=parseInt(this._app.localStorageMgr.getItem("Times"))||0;return this.curTimes=t},d.prototype.isQianDao=function(){var t=new Date;return(this._app.localStorageMgr.getItem("signTime",!0)||"")==StringU.substitute("{0}{1}",t.getFullYear(),t.getUTCDay())},d.prototype.sign=function(){var t=new Date,e=StringU.substitute("{0}{1}",t.getFullYear(),t.getUTCDay());this._app.localStorageMgr.setItem("signTime",e,!0)},d.prototype.getTuSiJi=function(){return(parseInt(this._app.localStorageMgr.getItem("tusiji_index",!0))||0).toString()},d.prototype.setTuSiJi=function(t){this._app.localStorageMgr.setItem("tusiji_index",t,!0),this.event(d.SKINCHAGNE,t)},d.prototype.isBuySkinFlag=function(t){return 1==(parseInt(this._app.localStorageMgr.getItem("skin_active"+t,!0))||0)},d.prototype.setSkinActive=function(t){this._app.localStorageMgr.setItem("skin_active"+t,"1",!0),this.event(d.EVENT_SKIN_BUY_FLAG,t),this.event(d.EVENT_SKIN_CHANGE);for(var e,i=SkinConfig.getInstance().datas,n=0;n<i.length;n++)if(i[n].id==t){e=i[n];break}if(e&&WXTool._state!=h.SceneRoot.STATUS_START&&WXTool.isShare){this._app.uiRoot.general.getPage(PageDef.PIFUGETTIP);this._app.uiRoot.general.open(PageDef.PIFUGETTIP,function(t){t.setData(e)})}},d.prototype.getSkinActive=function(t){return this._app.localStorageMgr.getItem("skin_active"+t,!0)},d.prototype.getUseSkinIndex=function(){return parseInt(this._app.localStorageMgr.getItem("skin_use",!0))},d.prototype.setUseSkinIndex=function(t){this.isBuySkinFlag(t)&&(this._app.localStorageMgr.setItem("skin_use",t.toString(),!0),this.event(d.EVENT_SKIN_USE_FLAG,t))},d.prototype.getIsNew=function(){return parseInt(this._app.localStorageMgr.getItem("new_player"))||0},d.prototype.setIsNew=function(){this._app.localStorageMgr.setItem("new_player","1")},d.prototype.getUseObstacleSkinIndex=function(){return parseInt(this._app.localStorageMgr.getItem("skin_Obstacle_use",!0))},d.prototype.setUseObstacleSkinIndex=function(t){this.isBuySkinFlag(t)&&(this._app.localStorageMgr.setItem("skin_Obstacle_use",t.toString(),!0),this.event(d.EVENT_SKIN_USE_FLAG,t),this.event(d.EVENT_SKIN_CHANGE))},d.prototype.getUseTuoWeiSkinIndex=function(){return parseInt(this._app.localStorageMgr.getItem("skin_tuoWei_use",!0))},d.prototype.setUseTuoWeiSkinIndex=function(t){this.isBuySkinFlag(t)&&(this._app.localStorageMgr.setItem("skin_tuoWei_use",t.toString(),!0),this.event(d.EVENT_SKIN_USE_FLAG,t))},d.prototype.getRebornCoinCount=function(){return parseInt(this._app.localStorageMgr.getItem("rebornCoin_count",!0))},d.prototype.setRebornCoinCount=function(e){e=10<(e=e||0)?10:e;var i=this.getRebornCoinCount();i<e&&this._app.uiRoot.general.open(PageDef.GETREWARD,function(t){t.setData(0,e-i)}),this._app.localStorageMgr.setItem("rebornCoin_count",e.toString(),!0),this.event(d.FUHUO_COIN_CHANGE)},d.prototype.getInviteAddCount=function(){return parseInt(this._app.localStorageMgr.getItem("inviteAdd_count",!0))},d.prototype.setInviteAddCount=function(t){this._app.localStorageMgr.setItem("inviteAdd_count",t.toString(),!0)},d.prototype.getLibaoAddCount=function(){return parseInt(this._app.localStorageMgr.getItem("libaoAdd_count",!0))},d.prototype.setLibaoAddCount=function(t){this._app.localStorageMgr.setItem("libaoAdd_count",t.toString(),!0)},d.prototype.getTurntableCD=function(){return parseInt(this._app.localStorageMgr.getItem("turntable_CD",!0))},d.prototype.setTurntableCD=function(t){this._app.localStorageMgr.setItem("turntable_CD",t.toString(),!0)},d.prototype.getTurntableTime=function(){return parseInt(this._app.localStorageMgr.getItem("turntable_time",!0))},d.prototype.setTurntableTime=function(t){this._app.localStorageMgr.setItem("turntable_time",t.toString(),!0)},d.prototype.setPlayerDataSkin=function(t){for(var e=this,i=SkinConfig.getInstance().datas,n=[],r=0;r<i.length;r++)i[r].condition[0]==t&&n.push(i[r]);switch(t){case d.TYPE_TOTAL_LOGIN:var a=this._app.localStorageMgr.getItem("loginTime").split("&").length-1;this.isCanCondition(n,a);break;case d.TYPE_TOTAL_INVITE:WXTool.getShareCount(function(){e.isCanCondition(n,WXTool.sharecount)});break;case d.TYPE_TOTAL_LOGIN_CONTINUE:var s=this._app.localStorageMgr.getItem("continueLoginTime").split("&").length;this.isCanCondition(n,s);break;case d.TYPE_TOTAL_GAME_TIMES:var o=this.getTimeGame();this.isCanCondition(n,o);break;case d.TYPE_BEST_SCORE:var l=parseInt(this._app.localStorageMgr.getItem("bestScore"));l||(l=0);var h=l;this.isCanCondition(n,h);break;case d.TYPE_VIDEO_1:break;case d.TYPE_VIDEO_50:var u=parseInt(this._app.localStorageMgr.getItem("TYPE_VIDEO_50"))||0;console.log("记录连续观看视频次数111111111111",u),u++,console.log("记录连续观看视频次数22222222222222",u),this._app.localStorageMgr.setItem("TYPE_VIDEO_50",u+""),this.isCanCondition(n,u);break;case d.TYPE_VIDEO_7:var c=this._app.localStorageMgr.getItem("TYPE_VIDEO_7").split("&").length;this.isCanCondition(n,c);break;case d.TYPE_ZHUANPAN:break;case d.TYPE_SHARE_COUNT:var _=this.getShareQunCount();this.isCanCondition(n,_)}},d.prototype.isCanCondition=function(t,e){for(var i=0;i<t.length;i++)this.isBuySkinFlag(t[i].id)||e>=t[i].condition[1]&&(console.log("获得皮肤啦！！！！！",t,e),this.setSkinActive(t[i].id))},d.prototype.getBaseSkin=function(){return parseInt(this._app.localStorageMgr.getItem("bask_skin",!0))},d.prototype.setBaseSkin=function(t){this._app.localStorageMgr.setItem("bask_skin",t.toString(),!0)},d.prototype.getShareQunCount=function(){return parseInt(this._app.localStorageMgr.getItem("shareQun",!0))||0},d.prototype.setShareQunCount=function(t){console.log("设置分享到群次数",t),this._app.localStorageMgr.setItem("shareQun",t.toString(),!0),this.setPlayerDataSkin(d.TYPE_SHARE_COUNT)},d.prototype.setDataIntoLocal=function(){var t=h.Sync.getDayZeroTime(this._app.sync.serverTimeByms).toString(),e=this._app.localStorageMgr.getItem("loginTime");if(e){var i=e,n=i.split("&");n[n.length-1]!=t&&(i+="&",i+=t,this._app.localStorageMgr.setItem("loginTime",i+""))}else this._app.localStorageMgr.setItem("loginTime",t+"");var r=this._app.localStorageMgr.getItem("continueLoginTime");if(r){var a=r,s=a.split("&"),o=s[s.length-1];if(parseInt(o)-this._app.sync.serverTimeBys>=1e3*h.Sync.DAY_SECONDS){var l=t+"";this._app.localStorageMgr.setItem("continueLoginTime",l)}else t!=o&&(a+="&",a+=t,this._app.localStorageMgr.setItem("continueLoginTime",a+""))}else this._app.localStorageMgr.setItem("continueLoginTime",t+"")},d.prototype.checkFirstLogin=function(){var t=this._app.localStorageMgr.getItem("loginTime"),e=t?t.split("&"):[0],i=~~e[e.length-1],n=h.Sync.getDayZeroTime(this._app.sync.serverTimeByms),r=this._app.plyertDataMgr.getRebornCoinCount();i==n&&i||this._app.plyertDataMgr.setRebornCoinCount(r+1)},d.prototype.isUseLuckySkin=function(){return parseInt(this._app.localStorageMgr.getItem("is_use_lucky_skin"))||0},d.prototype.setIsUseLuckySkin=function(t){this._app.localStorageMgr.setItem("is_use_lucky_skin",t.toString(),!0)},d.prototype.getUseLuckSkin=function(){return parseInt(this._app.localStorageMgr.getItem("lucky_skin"))||0},d.prototype.setUseLuckSkin=function(t){this._app.localStorageMgr.setItem("lucky_skin",t.toString(),!0)},d.prototype.getSignTime=function(){return parseInt(this._app.localStorageMgr.getItem("SignTime"))||0},d.prototype.setSignTime=function(t){this._app.localStorageMgr.setItem("SignTime",t.toString()),this.event(d.EVENT_QIANDAO)},d.prototype.setBuQian=function(){var t=this._app.sync.serverTimeByms;this._app.localStorageMgr.setItem("BuQian",t.toString()),this.event(d.EVENT_QIANDAO)},d.prototype.getBuQian=function(){return parseInt(this._app.localStorageMgr.getItem("BuQian"))||0},d.prototype.getQianBitWeek=function(t){return parseInt(this._app.localStorageMgr.getItem("WeedKDay"+t))||0},d.prototype.setQianBitWeek=function(t,e){void 0===e&&(e=!1);var i=e?"0":"1";this._app.localStorageMgr.setItem("WeedKDay"+t,i),this.event(d.EVENT_QIANDAO)},d.prototype.getLingQuWeek=function(t){return parseInt(this._app.localStorageMgr.getItem("WeedKDayLingQu"+t))||0},d.prototype.setLingQuWeek=function(t,e,i){void 0===e&&(e=!1);var n=e?"0":"1";this._app.localStorageMgr.setItem("WeedKDayLingQu"+t,n),this.setQianDaoReward(t,i),this.event(d.EVENT_QIANDAO)},d.prototype.setQianDaoReward=function(t,e){var i,n=e?2*d.DayDatas[t]:d.DayDatas[t];i=0==t||2==t||3==t||5==t?1:3,this._app.uiRoot.general.open(PageDef.RESULT_GOLD_REWARD,function(t){t.setData(n,i)})},d.prototype.setCurWeekTime=function(){var t=this.getCurWeekTime(),e=h.Sync.getDayZeroTime(this._app.sync.serverTimeByms);if(t){if(t+86400*h.Sync.getTimeWeekDay(1e3*t)<=e){var i=e.toString();this._app.localStorageMgr.setItem("WeekTime",i);for(var n=0;n<7;n++)this._app.localStorageMgr.setItem("WeedKDay"+n,"0")}}else this._app.localStorageMgr.setItem("WeekTime",e.toString())},d.prototype.getCurWeekTime=function(){return parseInt(this._app.localStorageMgr.getItem("WeekTime"))||0},d.prototype.setContinueBits=function(){for(var t=h.Sync.getDayZeroTime(1e3*this._app.sync.serverTimeBys),e=this.getSignTime(),i=0,n=h.gui.page.QianDaoPage.MAX_DAYS,r=0;r<n;r++){this.getQianBitWeek(r)&&i++}if(i==n&&e!=t)for(r=0;r<n;r++)this._app.localStorageMgr.setItem("WeedKDay"+r,"0"),this._app.localStorageMgr.setItem("WeedKDayLingQu"+r,"0")},d.prototype.getAvatar=function(t){for(var e=SkinConfig.getInstance().datas,i=null,n=0;n<e.length;n++)if(e[n].id==t){i=e[n];break}return i},d.getSkinDesc=function(t){if(!t||2!=t.length)return"";var e=t[0],i=t[1];if(0==i)return"";switch(e){case SkinData.CONDITION_TYPE_ONE:return i+"金币";case SkinData.CONDITION_TYPE_TWO:return"未知类型";case SkinData.CONDITION_TYPE_THREE:return"邀请"+i+"人";default:return"未知类型"}},d.prototype.CheckSkinCondition=function(t,e){if(void 0===e&&(e=!1),!t||2!=t.length)return!0;var i=t[0],n=t[1];switch(i){case SkinData.CONDITION_TYPE_ONE:if(this.getGold()<n)return e&&console.log("金币不足"),!1;break;case SkinData.CONDITION_TYPE_TWO:return!1;case SkinData.CONDITION_TYPE_THREE:if(WXTool.sharecount<n)return e&&console.log("邀请人数不够"),!1;break;default:return!1}return!0},d}(Laya.EventDispatcher)).EVENT_SKIN_BUY_FLAG="skin_buy_flag",e.EVENT_SKIN_USE_FLAG="skin_use_flag",e.EVENT_SKIN_CHANGE="skin_change",e.FUHUO_COIN_CHANGE="fuhuo_coin_change",e.STARCHAGNE="STARCHAGNE",e.SKINCHAGNE="SKINCHAGNE",e.GOLDCHANGE="GOLDCHANGE",e.isPlayBgMusic=!0,e.isPlayActionMusic=!0,e.isZhenDong=!0,e.TYPE_TOTAL_LOGIN=1,e.TYPE_TOTAL_INVITE=2,e.TYPE_TOTAL_LOGIN_CONTINUE=3,e.TYPE_TOTAL_GAME_TIMES=4,e.TYPE_BEST_SCORE=5,e.TYPE_CONSUME_GOLD=6,e.TYPE_VIDEO_1=7,e.TYPE_VIDEO_50=8,e.TYPE_VIDEO_7=9,e.TYPE_SHARE_COUNT=10,e.TYPE_ZHUANPAN=11,e.SCORE_TO_GOLD_RATE=20,e.SCORE_TO_GOLD_MAX=1e3,e.SUPER_SKIN_COUNT=3,e.EVENT_QIANDAO="qian_dao",e.DayDatas=[800,1,800,800,2,800,3],e.goldDays=[0,2,3,5],t.PlayerDataMgr=e}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,n,a,i,r,s,o;e=t.scene||(t.scene={}),n=Laya.RenderQueue,a=Laya.ShaderCompile3D,i=Laya.ShaderDefines,r=Laya.BaseMaterial,s=Laya.Vector4,(o=function(i){function r(){var t=i.call(this)||this;return t.initShader1(),t.setShaderName("BLINNPHONGEXP"),t.setBendDistance(50),t._albedoIntensity=1,t._albedoColor=new s(1,1,1,1),t._setColor(r.ALBEDOCOLOR,new s(1,1,1,1)),t._setColor(r.MATERIALSPECULAR,new Vector3(1,1,1)),t._setNumber(r.SHININESS,.078125),t._setColor(r.MATERIALREFLECT,new Vector3(1,1,1)),t._setNumber(r.ALPHATESTVALUE,.5),t._setColor(r.TILINGOFFSET,new s(1,1,0,0)),t._enableLighting=!0,t.renderMode=r.RENDERMODE_OPAQUE,t._setColor(r.GLOWINGEDGECOLOR,new s(1,1,1,1)),t}return __extends(r,i),r.__init__=function(){this.SHADERDEFINE_DIFFUSEMAP=this.shaderDefines.registerDefine("DIFFUSEMAP"),this.SHADERDEFINE_NORMALMAP=this.shaderDefines.registerDefine("NORMALMAP"),this.SHADERDEFINE_SPECULARMAP=this.shaderDefines.registerDefine("SPECULARMAP"),this.SHADERDEFINE_REFLECTMAP=this.shaderDefines.registerDefine("REFLECTMAP"),this.SHADERDEFINE_TILINGOFFSET=this.shaderDefines.registerDefine("TILINGOFFSET"),this.SHADERDEFINE_ADDTIVEFOG=this.shaderDefines.registerDefine("ADDTIVEFOG"),this.SHADERDEFINE_GLOWINGEDGE=this.shaderDefines.registerDefine("GLOWINGEDGE")},r.load=function(t){return Laya.loader.create(t,null,null,r)},Object.defineProperty(r.prototype,"renderMode",{set:function(t){switch(t){case r.RENDERMODE_OPAQUE:this.renderQueue=n.OPAQUE,this.depthWrite=!0,this.cull=r.CULL_BACK,this.blend=r.BLEND_DISABLE,this.alphaTest=!1,this.depthTest=r.DEPTHTEST_LESS,this._removeShaderDefine(r.SHADERDEFINE_ADDTIVEFOG);break;case r.RENDERMODE_CUTOUT:this.depthWrite=!0,this.cull=r.CULL_BACK,this.blend=r.BLEND_DISABLE,this.renderQueue=n.OPAQUE,this.alphaTest=!0,this.depthTest=r.DEPTHTEST_LESS,this._removeShaderDefine(r.SHADERDEFINE_ADDTIVEFOG);break;case r.RENDERMODE_TRANSPARENT:this.renderQueue=n.TRANSPARENT,this.depthWrite=!1,this.cull=r.CULL_BACK,this.blend=r.BLEND_ENABLE_ALL,this.srcBlend=r.BLENDPARAM_SRC_ALPHA,this.dstBlend=r.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.alphaTest=!1,this.depthTest=r.DEPTHTEST_LESS,this._removeShaderDefine(r.SHADERDEFINE_ADDTIVEFOG);break;case r.RENDERMODE_ADDTIVE:this.renderQueue=n.TRANSPARENT,this.depthWrite=!1,this.cull=r.CULL_BACK,this.blend=r.BLEND_ENABLE_ALL,this.srcBlend=r.BLENDPARAM_SRC_ALPHA,this.dstBlend=r.BLENDPARAM_ONE,this.alphaTest=!1,this.depthTest=r.DEPTHTEST_LESS,this._addShaderDefine(r.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"tilingOffset",{get:function(){return this._getColor(r.TILINGOFFSET)},set:function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(r.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(r.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(r.SHADERDEFINE_TILINGOFFSET);this._setColor(r.TILINGOFFSET,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"albedoColor",{get:function(){return this._albedoColor},set:function(t){var e=this._getColor(r.ALBEDOCOLOR);s.scale(t,this._albedoIntensity,e),this._albedoColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"albedoIntensity",{get:function(){return this._albedoIntensity},set:function(t){if(this._albedoIntensity!==t){var e=this._getColor(r.ALBEDOCOLOR);s.scale(this._albedoColor,t,e),this._albedoIntensity=t}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"specularColor",{get:function(){return this._getColor(r.MATERIALSPECULAR)},set:function(t){this._setColor(r.MATERIALSPECULAR,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"shininess",{get:function(){return this._getNumber(r.SHININESS)},set:function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(r.SHININESS,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"reflectColor",{get:function(){return this._getColor(r.MATERIALREFLECT)},set:function(t){this._setColor(r.MATERIALREFLECT,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"albedoTexture",{get:function(){return this._getTexture(r.ALBEDOTEXTURE)},set:function(t){t?this._addShaderDefine(r.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(r.SHADERDEFINE_DIFFUSEMAP),this._setTexture(r.ALBEDOTEXTURE,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"normalTexture",{get:function(){return this._getTexture(r.NORMALTEXTURE)},set:function(t){t?this._addShaderDefine(r.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(r.SHADERDEFINE_NORMALMAP),this._setTexture(r.NORMALTEXTURE,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"specularTexture",{get:function(){return this._getTexture(r.SPECULARTEXTURE)},set:function(t){t?this._addShaderDefine(r.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(r.SHADERDEFINE_SPECULARMAP),this._setTexture(r.SPECULARTEXTURE,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"reflectTexture",{get:function(){return this._getTexture(r.REFLECTTEXTURE)},set:function(t){t?this._addShaderDefine(r.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(r.SHADERDEFINE_REFLECTMAP),this._setTexture(r.REFLECTTEXTURE,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"enableLighting",{get:function(){return this._enableLighting},set:function(t){this._enableLighting!==t&&(t?this._removeDisablePublicShaderDefine(a.SHADERDEFINE_POINTLIGHT|a.SHADERDEFINE_SPOTLIGHT|a.SHADERDEFINE_DIRECTIONLIGHT):this._addDisablePublicShaderDefine(a.SHADERDEFINE_POINTLIGHT|a.SHADERDEFINE_SPOTLIGHT|a.SHADERDEFINE_DIRECTIONLIGHT),this._enableLighting=t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"enableGlowingEdge",{set:function(t){t?this._addShaderDefine(r.SHADERDEFINE_GLOWINGEDGE):this._removeShaderDefine(r.SHADERDEFINE_GLOWINGEDGE)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"glowingEdgeColor",{get:function(){return this._getColor(r.GLOWINGEDGECOLOR)},set:function(t){this._setColor(r.GLOWINGEDGECOLOR,t)},enumerable:!0,configurable:!0}),r.prototype.disableLight=function(){this._addDisablePublicShaderDefine(a.SHADERDEFINE_POINTLIGHT|a.SHADERDEFINE_SPOTLIGHT|a.SHADERDEFINE_DIRECTIONLIGHT)},r.prototype.disableFog=function(){this._addDisablePublicShaderDefine(a.SHADERDEFINE_FOG)},r.prototype.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;e._enableLighting=this._enableLighting,e._albedoIntensity=this._albedoIntensity,this._albedoColor.cloneTo(e._albedoColor)},r.prototype.getBendOffset=function(){return this._getColor(r.BENDANGLE)},r.prototype.setBendOffset=function(t){this._setColor(r.BENDANGLE,t)},r.prototype.setBendDistance=function(t){this._setNumber(r.BENDDISTANCE,t)},r.prototype.setHasFog=function(t){t?this._addShaderDefine(r.SHADERDEFINE_ENABLEFOG):this._removeShaderDefine(r.SHADERDEFINE_ENABLEFOG)},r.prototype.setFogType=function(t){switch(t){case r.FOGTYPE_LINEAR:this._addShaderDefine(r.SHADERDEFINE_LINEARFOG),this._removeShaderDefine(r.SHADERDEFINE_EXFOG),this._removeShaderDefine(r.SHADERDEFINE_EXPFOG);break;case r.FOGTYPE_EX:this._removeShaderDefine(r.SHADERDEFINE_LINEARFOG),this._addShaderDefine(r.SHADERDEFINE_EXFOG),this._removeShaderDefine(r.SHADERDEFINE_EXPFOG);break;case r.FOGTYPE_EXP:this._removeShaderDefine(r.SHADERDEFINE_LINEARFOG),this._removeShaderDefine(r.SHADERDEFINE_EXFOG),this._addShaderDefine(r.SHADERDEFINE_EXPFOG)}},r.prototype.setFogColor=function(t){this._setColor(r.FOGCOLOR,t)},r.prototype.setFogDensity=function(t){this._setNumber(r.DENSITY,t)},r.prototype.setFogGradient=function(t){this._setNumber(r.GRADIENT,t)},r.prototype.setFogStart=function(t){this._setNumber(r.FOGSTART,t)},r.prototype.setFogEnd=function(t){this._setNumber(r.FOGEND,t)},r.prototype.initShader1=function(){if(!r.isInit){r.isInit=!0;var t={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_ReflectTexture:[5,1],u_AlphaTestValue:[0,1],u_DiffuseColor:[6,1],u_MaterialSpecular:[8,1],u_Shininess:[9,1],u_MaterialReflect:[10,1],u_TilingOffset:[11,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Color":[4,4],"u_DirectionLight.Direction":[3,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Color":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Color":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4],_QOffset:[r.BENDANGLE,Laya.Shader3D.PERIOD_MATERIAL],_Dist:[r.BENDDISTANCE,Laya.Shader3D.PERIOD_MATERIAL]},e=Laya.Shader3D.nameKey.add("BLINNPHONGEXP");'uniform vec4 _QOffset;\nuniform float _Dist;\nattribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\n\tattribute vec2 a_Texcoord0;\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(LIGHTMAP)&&defined(UV1)\n\tattribute vec2 a_Texcoord1;\n#endif\n\n#ifdef LIGHTMAP\n\tuniform vec4 u_LightmapScaleOffset;\n\tvarying vec2 v_LightMapUV;\n#endif\n\n#ifdef COLOR\n\tattribute vec4 a_Color;\n\tvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tattribute vec3 a_Normal;\n\tvarying vec3 v_Normal; \n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_ViewDir; \n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\n\tattribute vec4 a_Tangent0;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\tuniform mat4 u_WorldMat;\n\tvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform=mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position=skinTransform*a_Position;\n highp vec4 vPos = u_MvpMatrix * position;\n float zOff = vPos.z / _Dist;\n  vPos += _QOffset * zOff * zOff;\n gl_Position = vPos;\n\t#else\n\t\thighp vec4 vPos = u_MvpMatrix * a_Position;\n float zOff = vPos.z / _Dist;\n vPos += _QOffset * zOff * zOff;\n gl_Position = vPos;\n\t#endif\n\t \n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0=a_Texcoord0;\n\t#endif\n\t\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform=mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position=skinTransform*a_Position;\n\t\t\n highp vec4 vPos = u_MvpMatrix * position;\n float zOff = vPos.z / _Dist;\n  vPos += _QOffset * zOff * zOff;\n gl_Position = vPos;\n\t#else\n\t\thighp vec4 vPos = u_MvpMatrix * a_Position;\n float zOff = vPos.z / _Dist;\n vPos += _QOffset * zOff * zOff;\n gl_Position = vPos;\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tmat3 worldMat;\n\t\t#ifdef BONE\n\t\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t\t#else\n\t\t\tworldMat=mat3(u_WorldMat);\n\t\t#endif  \n\t\tv_Normal=worldMat*a_Normal;//TODO:法线可以用"魔法"矩阵\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\t\tv_Tangent=worldMat*a_Tangent0.xyz;\n\t\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\n\t\t#endif\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t\t#ifdef BONE\n\t\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t\t#else\n\t\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t\t#endif\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tv_ViewDir=u_CameraPos-v_PositionWorld;\n\t#endif\n\n\t#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\t\tv_Texcoord0=a_Texcoord0;\n\t\t#ifdef TILINGOFFSET\n\t\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\t\tv_Texcoord0=vec2(v_Texcoord0.x,1.0+v_Texcoord0.y);\n\t\t#endif\n\t#endif\n\n\t#ifdef LIGHTMAP\n\t\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t\t#ifdef UV1\n\t\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t\t#else\n\t\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t\t#endif \n\t\t#else\n\t\t\t#ifdef UV1\n\t\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t\t#else\n\t\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t\t#endif \n\t\t#endif \n\t#endif\n\n\t#ifdef COLOR\n\t\tv_Color=a_Color;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}','#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Lighting.glsl";\n\nuniform vec4 u_DiffuseColor;\n\n#ifdef COLOR\n\tvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvarying vec3 v_ViewDir; \n#endif\n\n#ifdef ALPHATEST\n\tuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\n\tuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\n\tuniform samplerCube u_ReflectTexture;\n\tuniform vec3 u_MaterialReflect;\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#ifdef LIGHTMAP\n\tvarying vec2 v_LightMapUV;\n\tuniform sampler2D u_LightMap;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tuniform vec3 u_MaterialSpecular;\n\tuniform float u_Shininess;\n\t#ifdef SPECULARMAP \n\t\tuniform sampler2D u_SpecularTexture;\n\t#endif\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\tuniform sampler2D u_NormalTexture;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#ifdef DIRECTIONLIGHT\n\tuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n\tuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n\tuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n\tvec4 mainColor=u_DiffuseColor;\n\t#ifdef DIFFUSEMAP\n\t\tvec4 difTexColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\t\tmainColor=mainColor*difTexColor;\n\t#endif \n\t#ifdef COLOR\n\t\tmainColor=mainColor*v_Color;\n\t#endif \n    \n\t#ifdef ALPHATEST\n\t\tif(mainColor.a<u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n  \n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tvec3 normal;\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent,v_Binormal));\n\t\t#else\n\t\t\tnormal = normalize(v_Normal);\n\t\t#endif\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tvec3 viewDir= normalize(v_ViewDir);\n\t\tvec3 diffuse = vec3(0.0);\n\t\tvec3 specular= vec3(0.0);\n\t\tvec3 dif,spe;\n\t\t#ifdef SPECULARMAP\n\t\t\tvec3 gloss=texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n\t\t#else\n\t\t\t#ifdef DIFFUSEMAP\n\t\t\t\tvec3 gloss=vec3(difTexColor.a);\n\t\t\t#else\n\t\t\t\tvec3 gloss=vec3(1.0);\n\t\t\t#endif\n\t\t#endif\n\t#endif\n\n\t\n\t#ifdef DIRECTIONLIGHT\n\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_DirectionLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n \n\t#ifdef POINTLIGHT\n\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_PointLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n\n\t#ifdef SPOTLIGHT\n\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_SpotLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n\n\t\n\tvec3 finalDiffuse;\n\t#ifdef LIGHTMAP\n\t\tfinalDiffuse=texture2D(u_LightMap, v_LightMapUV).rgb*2.0;\n\t\t//float exponent = texture2D(u_LightMap, v_LightMapUV).a;\n\t\t//finalDiffuse = texture2D(u_LightMap, v_LightMapUV).rgb;\n\t\t//float ratio = pow(2.0, exponent * 255.0 - (128.0 + 8.0));\n\t\t//finalDiffuse = finalDiffuse * 255.0 * ratio;\t\n\t\t//finalDiffuse = sqrt(finalDiffuse);\n\t#else\n\t\tfinalDiffuse=vec3(0.0);\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tfinalDiffuse+=diffuse;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor =vec4(mainColor.rgb*(u_AmbientColor + finalDiffuse)*shadowValue,mainColor.a);\n\t#else\n\t\tgl_FragColor =vec4(mainColor.rgb*(u_AmbientColor + finalDiffuse),mainColor.a);\n\t#endif\n\t\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\t#ifdef RECEIVESHADOW\n\t\t\tgl_FragColor.rgb+=specular*shadowValue;\n\t\t#else\n\t\t\tgl_FragColor.rgb+=specular;\n\t\t#endif\n\t#endif\n\n\n\t#ifdef REFLECTMAP\n\t\tvec3 incident = -viewDir;\n\t\tvec3 reflectionVector = reflect(incident,normal);\n\t\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\t\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n\t#endif\n\t  \n\t#ifdef FOG\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t  main_normal();\n\t#endif  \n}\n\n';var i=Laya.ShaderCompile3D.add(e,'uniform vec4 _QOffset;\nuniform float _Dist;\nattribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\n\tattribute vec2 a_Texcoord0;\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(LIGHTMAP)&&defined(UV1)\n\tattribute vec2 a_Texcoord1;\n#endif\n\n#ifdef LIGHTMAP\n\tuniform vec4 u_LightmapScaleOffset;\n\tvarying vec2 v_LightMapUV;\n#endif\n\n#ifdef COLOR\n\tattribute vec4 a_Color;\n\tvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tattribute vec3 a_Normal;\n\tvarying vec3 v_Normal; \n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_ViewDir; \n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\n\tattribute vec4 a_Tangent0;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\tuniform mat4 u_WorldMat;\n\tvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform=mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position=skinTransform*a_Position;\n highp vec4 vPos = u_MvpMatrix * position;\n float zOff = vPos.z / _Dist;\n  vPos += _QOffset * zOff * zOff;\n gl_Position = vPos;\n\t#else\n\t\thighp vec4 vPos = u_MvpMatrix * a_Position;\n float zOff = vPos.z / _Dist;\n vPos += _QOffset * zOff * zOff;\n gl_Position = vPos;\n\t#endif\n\t \n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0=a_Texcoord0;\n\t#endif\n\t\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform=mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position=skinTransform*a_Position;\n\t\t\n highp vec4 vPos = u_MvpMatrix * position;\n float zOff = vPos.z / _Dist;\n  vPos += _QOffset * zOff * zOff;\n gl_Position = vPos;\n\t#else\n\t\thighp vec4 vPos = u_MvpMatrix * a_Position;\n float zOff = vPos.z / _Dist;\n vPos += _QOffset * zOff * zOff;\n gl_Position = vPos;\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tmat3 worldMat;\n\t\t#ifdef BONE\n\t\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t\t#else\n\t\t\tworldMat=mat3(u_WorldMat);\n\t\t#endif  \n\t\tv_Normal=worldMat*a_Normal;//TODO:法线可以用"魔法"矩阵\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\t\tv_Tangent=worldMat*a_Tangent0.xyz;\n\t\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\n\t\t#endif\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t\t#ifdef BONE\n\t\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t\t#else\n\t\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t\t#endif\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tv_ViewDir=u_CameraPos-v_PositionWorld;\n\t#endif\n\n\t#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\t\tv_Texcoord0=a_Texcoord0;\n\t\t#ifdef TILINGOFFSET\n\t\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\t\tv_Texcoord0=vec2(v_Texcoord0.x,1.0+v_Texcoord0.y);\n\t\t#endif\n\t#endif\n\n\t#ifdef LIGHTMAP\n\t\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t\t#ifdef UV1\n\t\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t\t#else\n\t\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t\t#endif \n\t\t#else\n\t\t\t#ifdef UV1\n\t\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t\t#else\n\t\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t\t#endif \n\t\t#endif \n\t#endif\n\n\t#ifdef COLOR\n\t\tv_Color=a_Color;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}','#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Lighting.glsl";\n\nuniform vec4 u_DiffuseColor;\n\n#ifdef COLOR\n\tvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvarying vec3 v_ViewDir; \n#endif\n\n#ifdef ALPHATEST\n\tuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\n\tuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\n\tuniform samplerCube u_ReflectTexture;\n\tuniform vec3 u_MaterialReflect;\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#ifdef LIGHTMAP\n\tvarying vec2 v_LightMapUV;\n\tuniform sampler2D u_LightMap;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tuniform vec3 u_MaterialSpecular;\n\tuniform float u_Shininess;\n\t#ifdef SPECULARMAP \n\t\tuniform sampler2D u_SpecularTexture;\n\t#endif\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\tuniform sampler2D u_NormalTexture;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#ifdef DIRECTIONLIGHT\n\tuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n\tuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n\tuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n\tvec4 mainColor=u_DiffuseColor;\n\t#ifdef DIFFUSEMAP\n\t\tvec4 difTexColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\t\tmainColor=mainColor*difTexColor;\n\t#endif \n\t#ifdef COLOR\n\t\tmainColor=mainColor*v_Color;\n\t#endif \n    \n\t#ifdef ALPHATEST\n\t\tif(mainColor.a<u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n  \n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tvec3 normal;\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent,v_Binormal));\n\t\t#else\n\t\t\tnormal = normalize(v_Normal);\n\t\t#endif\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tvec3 viewDir= normalize(v_ViewDir);\n\t\tvec3 diffuse = vec3(0.0);\n\t\tvec3 specular= vec3(0.0);\n\t\tvec3 dif,spe;\n\t\t#ifdef SPECULARMAP\n\t\t\tvec3 gloss=texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n\t\t#else\n\t\t\t#ifdef DIFFUSEMAP\n\t\t\t\tvec3 gloss=vec3(difTexColor.a);\n\t\t\t#else\n\t\t\t\tvec3 gloss=vec3(1.0);\n\t\t\t#endif\n\t\t#endif\n\t#endif\n\n\t\n\t#ifdef DIRECTIONLIGHT\n\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_DirectionLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n \n\t#ifdef POINTLIGHT\n\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_PointLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n\n\t#ifdef SPOTLIGHT\n\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_SpotLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n\n\t\n\tvec3 finalDiffuse;\n\t#ifdef LIGHTMAP\n\t\tfinalDiffuse=texture2D(u_LightMap, v_LightMapUV).rgb*2.0;\n\t\t//float exponent = texture2D(u_LightMap, v_LightMapUV).a;\n\t\t//finalDiffuse = texture2D(u_LightMap, v_LightMapUV).rgb;\n\t\t//float ratio = pow(2.0, exponent * 255.0 - (128.0 + 8.0));\n\t\t//finalDiffuse = finalDiffuse * 255.0 * ratio;\t\n\t\t//finalDiffuse = sqrt(finalDiffuse);\n\t#else\n\t\tfinalDiffuse=vec3(0.0);\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tfinalDiffuse+=diffuse;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor =vec4(mainColor.rgb*(u_AmbientColor + finalDiffuse)*shadowValue,mainColor.a);\n\t#else\n\t\tgl_FragColor =vec4(mainColor.rgb*(u_AmbientColor + finalDiffuse),mainColor.a);\n\t#endif\n\t\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\t#ifdef RECEIVESHADOW\n\t\t\tgl_FragColor.rgb+=specular*shadowValue;\n\t\t#else\n\t\t\tgl_FragColor.rgb+=specular;\n\t\t#endif\n\t#endif\n\n\n\t#ifdef REFLECTMAP\n\t\tvec3 incident = -viewDir;\n\t\tvec3 reflectionVector = reflect(incident,normal);\n\t\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\t\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n\t#endif\n\t  \n\t#ifdef FOG\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t  main_normal();\n\t#endif  \n}\n\n',{a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},t);r.SHADERDEFINE_DIFFUSEMAP=i.registerMaterialDefine("DIFFUSEMAP"),r.SHADERDEFINE_NORMALMAP=i.registerMaterialDefine("NORMALMAP"),r.SHADERDEFINE_SPECULARMAP=i.registerMaterialDefine("SPECULARMAP"),r.SHADERDEFINE_REFLECTMAP=i.registerMaterialDefine("REFLECTMAP"),r.SHADERDEFINE_TILINGOFFSET=i.registerMaterialDefine("TILINGOFFSET"),r.SHADERDEFINE_ADDTIVEFOG=i.registerMaterialDefine("ADDTIVEFOG")}},r.prototype.initShader=function(){var t={a_Position:Laya.VertexElementUsage.POSITION0,a_Normal:Laya.VertexElementUsage.NORMAL0,a_Texcoord:Laya.VertexElementUsage.TEXTURECOORDINATE0},e={u_MvpMatrix:[Laya.Sprite3D.MVPMATRIX,Laya.Shader3D.PERIOD_SPRITE],u_WorldMat:[Laya.Sprite3D.WORLDMATRIX,Laya.Shader3D.PERIOD_SPRITE],u_ViewMatrix:[Laya.BaseCamera.VIEWMATRIX,Laya.Shader3D.PERIOD_CAMERA],u_texture:[r.DIFFUSETEXTURE,Laya.Shader3D.PERIOD_MATERIAL],u_CameraPos:[Laya.BaseCamera.CAMERAPOS,Laya.Shader3D.PERIOD_CAMERA],_QOffset:[r.BENDANGLE,Laya.Shader3D.PERIOD_MATERIAL],_Dist:[r.BENDDISTANCE,Laya.Shader3D.PERIOD_MATERIAL],_Color:[r.COLOR,Laya.Shader3D.PERIOD_MATERIAL],_FogColor:[r.FOGCOLOR,Laya.Shader3D.PERIOD_MATERIAL],u_Density:[r.DENSITY,Laya.Shader3D.PERIOD_MATERIAL],u_Gradient:[r.GRADIENT,Laya.Shader3D.PERIOD_MATERIAL],u_FogStart:[r.FOGSTART,Laya.Shader3D.PERIOD_MATERIAL],u_FogEnd:[r.FOGEND,Laya.Shader3D.PERIOD_MATERIAL],_Gloss:[r.GLOSS,Laya.Shader3D.PERIOD_MATERIAL],u_DirectionLight_Direction:[Laya.Scene.LIGHTDIRECTION,Laya.Shader3D.PERIOD_SCENE],u_DirectionLight_Diffuse:[Laya.Scene.LIGHTDIRCOLOR,Laya.Shader3D.PERIOD_SCENE],u_DirectionLight_Ambient:[Laya.Scene.AMBIENTCOLOR,Laya.Shader3D.PERIOD_SCENE]},i=Laya.Shader3D.nameKey.add("CustomShader"),n=Laya.ShaderCompile3D.add(i,"attribute vec3 a_Normal;\nattribute vec2 a_Texcoord;\nattribute vec4 a_Position;\nprecision highp float;\nuniform mat4 u_MvpMatrix;\nuniform mat4 u_ViewMatrix;\nuniform mat4 u_WorldMat;\nuniform vec4 _QOffset;\nuniform float _Dist;\nuniform vec4 _Color;\nuniform float _Gloss;\nuniform vec4 _Specular;\nuniform vec3 u_CameraPos;\nuniform vec3 u_DirectionLight_Direction;\nuniform vec3 u_DirectionLight_Diffuse;\nuniform vec3 u_DirectionLight_Ambient;\nvarying vec4 v_Color;\nvarying vec2 v_Texcoord;\nvarying vec4 v_EyeSpacePos;\nvoid main() {\n\tmat4 mvMatrix = u_ViewMatrix * u_WorldMat;\n\thighp vec4 vPos = u_MvpMatrix * a_Position;\n\tfloat zOff = vPos.z / _Dist;\n\tvPos += _QOffset * zOff * zOff;\n\tgl_Position = vPos;\n\tmat3 worldMat = mat3(u_WorldMat);\n\tv_EyeSpacePos = mvMatrix * a_Position;\n\tv_Texcoord = a_Texcoord;\n\t#ifdef CUSTOM_ENABLELIGHT\n\t\tvec3 worldNormal = worldMat * a_Normal;\n\t\tworldNormal = normalize(worldNormal);\n\t\tvec3 m_Position = vec3(u_WorldMat * a_Position);\n\t\tvec3 worldLightDir = normalize(u_DirectionLight_Direction - m_Position);\n\t\tvec3 ambient = u_DirectionLight_Ambient.xyz * _Color.rgb;\n\t\t #ifdef CUSTOM_ENABLELAMBERT \n\t\t\tfloat lambert = max(0.0, dot(worldNormal, worldLightDir));\n\t\t #else\n\t\t\tfloat lambert = 0.5 * dot(worldNormal, worldLightDir) + 0.5;\n\t\t #endif\n\t\tv_Color = vec4(lambert * u_DirectionLight_Diffuse.xyz * _Color.rgb + ambient, _Color.a);\n\t\t #ifdef CUSTOM_ENABLESPECULAR\n\t\t\tvec3 viewDir = normalize(u_CameraPos - m_Position);\n\t\t\tvec3 halfDir = normalize(viewDir + worldLightDir);\n\t\t\tvec3 specular = u_DirectionLight_Diffuse.xyz * _Specular.rgb * pow(max(dot(worldNormal, halfDir), 0.0), _Gloss);\n\t\t\tv_Color += vec4(v_Color.rgb + specular, v_Color.a);\n\t\t #endif\n\t #else\n\t\tv_Color = _Color;\n\t #endif\n}\n","precision highp float;\nvarying vec4 v_EyeSpacePos;\nvarying vec2 v_Texcoord;\nvarying vec4 v_Color;\nuniform sampler2D u_texture;\nuniform float u_Density;\nuniform float u_Gradient;\nuniform vec4 _FogColor;\nuniform float u_FogStart;\nuniform float u_FogEnd;\nfloat ExFog(float distance) {\n\tfloat fogAlpha = exp(-abs(distance * u_Density));\n\tfogAlpha = 1.0 - clamp(fogAlpha, 0.0, 1.0);\n\treturn fogAlpha;\n}\nfloat ExpFog(float distance) {\n\tfloat fogAlpha = exp(-pow(abs(distance * u_Density), u_Gradient));\n\tfogAlpha = 1.0 - clamp(fogAlpha, 0.0, 1.0);\n\treturn fogAlpha;\n}\nfloat LinearFog(float distance) {\n\tfloat fogAlpha = (distance - u_FogStart) / (u_FogEnd - u_FogStart);\n\tfogAlpha = clamp(fogAlpha, 0.0, 1.0);\n\treturn fogAlpha;\n}\nvoid main() {\n\tvec4 tex = texture2D(u_texture, v_Texcoord);\n\tvec4 color = v_Color * tex;\n\t#ifdef CUSTOM_ENABLEFOG \n\t\t#ifdef CUSTOM_LINEARFOG\n\t\t\tfloat fogAlpha = LinearFog(abs(v_EyeSpacePos.z / v_EyeSpacePos.w));\n\t\t#endif \n\t\t#ifdef CUSTOM_EXFOG\n\t\t\tfloat fogAlpha = ExFog(abs(v_EyeSpacePos.z / v_EyeSpacePos.w));\n\t\t#endif\t\n\t\t#ifdef CUSTOM_EXPFOG \n\t\t\tfloat fogAlpha = ExpFog(abs(v_EyeSpacePos.z / v_EyeSpacePos.w));\n\t\t#endif \n\t\tgl_FragColor = mix(color, _FogColor, fogAlpha);\n\t#else\n\t\tgl_FragColor = color;\n\t#endif\n}\n",t,e);r.SHADERDEFINE_ENABLELIGHT=n.registerMaterialDefine("CUSTOM_ENABLELIGHT"),r.SHADERDEFINE_ENABLELAMBERT=n.registerMaterialDefine("CUSTOM_ENABLELAMBERT"),r.SHADERDEFINE_ENABLESPECULAR=n.registerMaterialDefine("CUSTOM_ENABLESPECULAR"),r.SHADERDEFINE_ENABLEFOG=n.registerMaterialDefine("CUSTOM_ENABLEFOG"),r.SHADERDEFINE_LINEARFOG=n.registerMaterialDefine("CUSTOM_LINEARFOG"),r.SHADERDEFINE_EXFOG=n.registerMaterialDefine("CUSTOM_EXFOG"),r.SHADERDEFINE_EXPFOG=n.registerMaterialDefine("CUSTOM_EXPFOG")},r}(Laya.BaseMaterial)).DIFFUSETEXTURE=1,o.MARGINALCOLOR=2,o.COLOR=5,o.SPECULAR=6,o.GLOSS=7,o.FOGCOLOR=8,o.DENSITY=9,o.GRADIENT=10,o.FOGSTART=11,o.FOGEND=12,o.FOGTYPE_LINEAR=1,o.FOGTYPE_EX=2,o.FOGTYPE_EXP=3,o.RENDERMODE_OPAQUE=0,o.RENDERMODE_CUTOUT=1,o.RENDERMODE_TRANSPARENT=2,o.RENDERMODE_ADDTIVE=3,o.ALBEDOTEXTURE=1,o.NORMALTEXTURE=2,o.SPECULARTEXTURE=3,o.EMISSIVETEXTURE=4,o.REFLECTTEXTURE=5,o.ALBEDOCOLOR=6,o.MATERIALSPECULAR=8,o.SHININESS=9,o.MATERIALREFLECT=10,o.TILINGOFFSET=11,o.GLOWINGEDGECOLOR=12,o.BENDANGLE=13,o.BENDDISTANCE=14,o.shaderDefines=new i(r.shaderDefines),o.isInit=!1,e.BlinnPhongMaterialExp=o}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i,n;e=t.scene||(t.scene={}),i=e.builder||(e.builder={}),(n=function(i){function t(t){var e=i.call(this)||this;return e._albedoColor=new Vector4,e._offsetX=0,e._offsetY=0,e._isLoad=!1,e.obstacleWidth=.25,e._inpool=!1,e._isInit=!1,e._needRecicle=!1,e.allowMove=!1,e.poolName="BaseBuilder",e.moveSpeed=new Vector3(.01,0,0),e.curNum=.01,e._sceneRoot=t,e}return __extends(t,i),t.prototype.intoPool=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.active=!1,this._inpool=!0,this._needRecicle=!1,this._isInit=!1,this.allowMove=!1,this.topType=null},t.prototype.outPool=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._sceneRoot=t[0][0],this.active=!0,this._inpool=!1,this._needRecicle=!1},t.prototype.setOffset=function(t,e,i){this._offsetX=t,this._offsetY=e,this._startZ=i,this.updatePos()},t.prototype.updatePos=function(){this.transform.position.x=this._offsetX,this.transform.position.y=this._offsetY,this.transform.position.z=this._startZ,this.transform.position=this.transform.position},t.prototype.setAlbedoColor=function(t){t.cloneTo(this._albedoColor),this.meshRender.material instanceof e.BlinnPhongMaterialExp&&(this.meshRender.material.albedoColor=this._albedoColor)},t.prototype.init=function(t,e,i){void 0===e&&(e=""),void 0===i&&(i=""),this._isInit||(this._isInit=!0,this._url=t,this._material_url=e,this._para=i,this.onCreate())},t.prototype.onCreate=function(){var t=[];""!=this._url&&t.push(this._url),""!=this._material_url&&t.push(this._material_url),""!=this._para&&t.push(this._para),0==t.length?this.onLoad():Laya.loader.create(t,Handler.create(this,this.onLoad))},t.prototype.onLoad=function(){this._isLoad=!0,this.builder()},t.prototype.builder=function(){},t.prototype.updateBlendOffset=function(t){this.meshRender.material&&this.meshRender.material.setBendOffset(t)},t.prototype.needRemove=function(){return 1<this._sceneRoot.camera.position.z-this.transform.position.z||this._needRecicle},t.prototype.destory=function(){},Object.defineProperty(t.prototype,"position",{get:function(){return this.transform.position},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color_type",{get:function(){return this._color_type},set:function(t){this._color_type=t},enumerable:!0,configurable:!0}),t.prototype.update=function(t){if(this._isLoad)return this.allowMove&&this.updateOffsetX(),!!this.needRemove()&&(this.destory(),!0)},t.prototype.updateOffsetX=function(){.358<=Math.abs(this.transform.position.x)?(this.moveSpeed.x=0<this.transform.position.x?.357-this.transform.position.x:-.357-this.transform.position.x,this.transform.translate(this.moveSpeed),this.moveSpeed.x=0<this.transform.position.x?-this.curNum:this.curNum):this.transform.translate(this.moveSpeed)},t}(Laya.MeshSprite3D)).poolName="BaseBuilder",i.BaseBuilder=n}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(n){var t,e,i;t=n.scene||(n.scene={}),e=t.builder||(t.builder={}),(i=function(i){function e(t){var e=i.call(this,t)||this;return e.isRever=!1,e.reverOffsetX=0,e.poolName="Builder",e}return __extends(e,i),e.prototype.builder=function(){i.prototype.builder.call(this);var t=new Laya.BoxMesh(.7,1,2+6*Math.random());this.meshFilter.sharedMesh=t,e.material||((e.material=new n.scene.BlinnPhongMaterialExp).albedoColor=new Vector4(.3,.4,.5),e.material.shininess=.1),this.transform.position.x=this._offsetX,this.transform.position.y=this._offsetY,this.transform.position.y=this._startZ,this.transform.position=this.transform.position,this.meshRender.material=e.material,this.name="Builder",this._sceneRoot.builderLayer.addChild(this)},e}(e.BaseBuilder)).poolName="Builder",e.Builder=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(n){var t,e,i;t=n.scene||(n.scene={}),e=t.builder||(t.builder={}),(i=function(i){function t(t){var e=i.call(this,t)||this;return e._haveColo=!1,e.poolName="Cast_Arrow",e}return __extends(t,i),t.prototype.builder=function(){i.prototype.builder.call(this);var t=Laya.loader.getRes(this._url),e=new n.scene.BlinnPhongMaterialExp;e.albedoTexture=Laya.Texture2D.load(this._material_url),e.shininess=.01,this.meshFilter.sharedMesh=t,this.updatePos(),this.meshRender.material=e,this.name="Cast_Arrow",this._sceneRoot.obstacleLayer.addChild(this)},t.prototype.update=function(t){if(this._isLoad){var e=Math.abs(this._sceneRoot.camera.position.z-this.transform.position.z);return-1<e&&e<8?this._haveColo||(this._colo?this._colo.enable=!0:(this._colo=this.addComponent(Laya.BoxCollider),this._colo.setFromBoundBox(this.meshFilter.sharedMesh.boundingBox)),this._haveColo=!0):this._haveColo&&(this._haveColo=!1,this._colo&&(this._colo.enable=!1)),i.prototype.update.call(this,t)}},t}(e.BaseBuilder)).poolName="Cast_Arrow",e.Cast_Arrow=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(a){var i,t,e;i=a.scene||(a.scene={}),t=i.builder||(i.builder={}),(e=function(r){function t(t){var e=r.call(this,t)||this;e._haveColo=!1,e.poolName="ColorBall";var i=Laya.loader.getRes(a.Path.scene_model+"play_tw-Sphere001.lm"),n=e._material=new a.scene.BlinnPhongMaterialExp;return n.shininess=.01,e.meshFilter.sharedMesh=i,e.meshRender.material=n,e.name="ColorBall",e}return __extends(t,r),t.prototype.builder=function(){r.prototype.builder.call(this),this._sceneRoot.obstacleLayer.addChild(this)},Object.defineProperty(t.prototype,"color_type",{get:function(){return this._color_type},set:function(t){this._color_type=t,this.meshRender.material.albedoColor=TD.getColor(t)},enumerable:!0,configurable:!0}),t.prototype.update=function(t){if(this._isLoad){var e=Math.abs(this._sceneRoot.camera.position.z-this.transform.position.z);return-1<e&&e<8?this._haveColo||(this._colo?this._colo.enable=!0:(this._colo=this.addComponent(Laya.SphereCollider),this._colo.radius=i.BuilderMgr.ball_radis),this._haveColo=!0):this._haveColo&&(this._haveColo=!1,this._colo&&(this._colo.enable=!1)),r.prototype.update.call(this,t)}},t.prototype.onHit=function(){this._needRecicle=!0},t}(t.BaseBuilder)).poolName="ColorBall",t.ColorBall=e}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(n){var r,t,e;r=n.scene||(n.scene={}),t=r.builder||(r.builder={}),(e=function(i){function t(t){var e=i.call(this,t)||this;return e._haveColo=!1,e.poolName="Diamond",e}return __extends(t,i),t.prototype.builder=function(){i.prototype.builder.call(this);var t=Laya.loader.getRes(this._url),e=new n.scene.BlinnPhongMaterialExp;e.albedoTexture=Laya.Texture2D.load(this._material_url),e.shininess=.01,this.meshFilter.sharedMesh=t,this.updatePos(),this.meshRender.material=e,this.name="Diamond",this._sceneRoot.obstacleLayer.addChild(this)},t.prototype.update=function(t){if(this._isLoad){var e=Math.abs(this._sceneRoot.camera.position.z-this.transform.position.z);return-1<e&&e<8?this._haveColo||(this._colo?this._colo.enable=!0:(this._colo=this.addComponent(Laya.SphereCollider),this._colo.radius=r.BuilderMgr.ball_radis),this._haveColo=!0):this._haveColo&&(this._haveColo=!1,this._colo&&(this._colo.enable=!1)),i.prototype.update.call(this,t)}},t}(t.BaseBuilder)).poolName="Diamond",t.Diamond=e}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(n){var r,t,e;r=n.scene||(n.scene={}),t=r.builder||(r.builder={}),(e=function(i){function t(t){var e=i.call(this,t)||this;return e._haveColo=!1,e.poolName="MultipleBall",e}return __extends(t,i),t.prototype.builder=function(){i.prototype.builder.call(this);var t=Laya.loader.getRes(this._url),e=new n.scene.BlinnPhongMaterialExp;e.albedoTexture=Laya.Texture2D.load(this._material_url),e.shininess=.01,this.meshFilter.sharedMesh=t,this.updatePos(),this.meshRender.material=e,this.name="MultipleBall",this._sceneRoot.obstacleLayer.addChild(this)},t.prototype.update=function(t){if(this._isLoad){var e=Math.abs(this._sceneRoot.camera.position.z-this.transform.position.z);return-1<e&&e<8?this._haveColo||(this._colo?this._colo.enable=!0:(this._colo=this.addComponent(Laya.SphereCollider),this._colo.radius=r.BuilderMgr.ball_radis),this._haveColo=!0):this._haveColo&&(this._haveColo=!1,this._colo&&(this._colo.enable=!1)),i.prototype.update.call(this,t)}},t.prototype.onHit=function(){this._needRecicle=!0},t}(t.BaseBuilder)).poolName="MultipleBall",t.MultipleBall=e}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(a){var i,t,e;i=a.scene||(a.scene={}),t=i.builder||(i.builder={}),(e=function(r){function t(t){var e=r.call(this,t)||this;e._haveColo=!1,e.poolName="MusicBall";var i=Laya.loader.getRes(a.Path.scene_model+"play-play.lm"),n=e._material=new a.scene.BlinnPhongMaterialExp;return n.albedoTexture=Laya.Texture2D.load(a.Path.scene_material+"yinfu.jpg"),n.shininess=.01,e.meshFilter.sharedMesh=i,e.meshRender.material=n,e.name="MusicBall",e}return __extends(t,r),t.prototype.builder=function(){r.prototype.builder.call(this),this._sceneRoot.obstacleLayer.addChild(this)},Object.defineProperty(t.prototype,"musicIndex",{set:function(t){this._musicIndex=t},enumerable:!0,configurable:!0}),t.prototype.update=function(t){if(this._isLoad){var e=Math.abs(this._sceneRoot.camera.position.z-this.transform.position.z);return-1<e&&e<8?this._haveColo||(this._colo?this._colo.enable=!0:(this._colo=this.addComponent(Laya.SphereCollider),this._colo.radius=i.BuilderMgr.ball_radis),this._haveColo=!0):this._haveColo&&(this._haveColo=!1,this._colo&&(this._colo.enable=!1)),r.prototype.update.call(this,t)}},t.prototype.onHit=function(){this._needRecicle=!0,this._musicIndex&&PlayerDataMgr.isPlayActionMusic&&Laya.SoundManager.playSound(StringU.substitute("scene/sound/{0}.mp3",this._musicIndex))},t}(t.BaseBuilder)).poolName="MusicBall",t.MusicBall=e}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou,dou;!function(n){var t,e,i;t=n.scene||(n.scene={}),e=t.builder||(t.builder={}),(i=function(i){function t(t){var e=i.call(this,t)||this;return e.poolName="Road",e}return __extends(t,i),t.prototype.builder=function(){i.prototype.builder.call(this);var t=Laya.loader.getRes(this._url),e=new n.scene.BlinnPhongMaterialExp;e.albedoTexture=Laya.Texture2D.load(this._material_url),e.albedoColor=this._albedoColor,e.shininess=.01,this.meshFilter.sharedMesh=t,this.meshRender.material=e,this.updatePos(),this._sceneRoot.mapLayer.addChild(this)},t.prototype.needRemove=function(){return 30<this._sceneRoot.camera.position.z-this.transform.position.z},t.prototype.destory=function(){i.prototype.destory.call(this)},t}(e.BaseBuilder)).poolName="Road",e.Road=i}(dou||(dou={})),function(t){var e,i,n;e=t.scene||(t.scene={}),i=e.builder||(e.builder={}),(n=function(){function t(t){this._albedoColor=new Vector4(88/255,186/255,219/255,1),this._offsetX=0,this._offsetY=0,this._isLoad=!1,this.obstacleWidth=.25,this._inpool=!1,this._isInit=!1,this.poolName="BaseBuilder",this._sceneRoot=t,this.poolName="Road1"}return Object.defineProperty(t.prototype,"builderO",{get:function(){return this._builder},enumerable:!0,configurable:!0}),t.prototype.intoPool=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._builder&&(this._builder.active=!1),this._inpool=!0},t.prototype.outPool=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._sceneRoot=t[0][0],this._builder&&(this._builder.active=!0),this._inpool=!1},t.prototype.setOffset=function(t,e,i){this._offsetX=t,this._offsetY=e,this._startZ=i,this._builder&&(this._builder.transform.position.x=this._offsetX,this._builder.transform.position.y=this._offsetY,this._builder.transform.position.z=this._startZ,this._builder.transform.position=this._builder.transform.position)},t.prototype.init=function(t,e,i){if(void 0===e&&(e=""),void 0===i&&(i=""),!this._isInit){this._isInit=!0,this._url=t,this._material_url=e,this._para=i;var n=[];""!=this._url&&n.push(this._url),""!=this._material_url&&n.push(this._material_url),""!=this._para&&n.push(this._para),0==n.length?this.onLoad():Laya.loader.create(n,Handler.create(this,this.onLoad))}},t.prototype.onLoad=function(){this._isLoad=!0,this.builder()},t.prototype.builder=function(){var t=Laya.loader.getRes(this._url),e=new BlinnPhongMaterial;e.albedoTexture=Laya.Texture2D.load(this._material_url),e.albedoColor=this._albedoColor,e.shininess=.01,this._builder=new MeshSprite3D(t),this._builder.transform.position.x=this._offsetX,this._builder.transform.position.y=this._offsetY,this._builder.transform.position.z=this._startZ,this._builder.transform.position=this._builder.transform.position,this._builder.meshRender.material=e,this._builder.layer=Laya.Layer.getLayerByNumber(9),this._sceneRoot.mapLayer.addChild(this._builder)},t.prototype.setParent=function(t){this._builder&&t&&(this._builder.removeSelf(),t.addChild(this._builder)),this._tempLaya=t},t.prototype.needRemove=function(){return 30<this._sceneRoot.playerOwner.transform.position.z-this._builder.transform.position.z},t.prototype.destory=function(){},Object.defineProperty(t.prototype,"position",{get:function(){return this._builder?this._builder.transform.position:null},enumerable:!0,configurable:!0}),t.prototype.update=function(t){if(this._isLoad)return!!this.needRemove()&&(this.destory(),!0)},t}()).poolName="Road1",i.Road1=n}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(n){var r,t,e;r=n.scene||(n.scene={}),t=r.builder||(r.builder={}),(e=function(i){function t(t){var e=i.call(this,t)||this;return e._haveColo=!1,e.poolName="SlowNet",e}return __extends(t,i),t.prototype.builder=function(){i.prototype.builder.call(this);var t=Laya.loader.getRes(n.Path.scene_model+"play_tw-Sphere001.lm"),e=new n.scene.BlinnPhongMaterialExp;e.shininess=.01,this.meshFilter.sharedMesh=t,this.updatePos(),this.meshRender.material=e,this.meshRender.enable=!1,this.name="SlowNet",this._sceneRoot.obstacleLayer.addChild(this),this.effect||(this.effect=r.EffectMgr.getEffect("jiansu0"),Vector3.ZERO.cloneTo(this.effect.transform.position),this.effect.transform.position.z=-.05,this.effect.transform.position=this.effect.transform.position,this.addChild(this.effect),this.effect1=r.EffectMgr.getEffect("jiansu1"),Vector3.ZERO.cloneTo(this.effect1.transform.position),this.effect1.transform.position.z=-.05,this.effect1.transform.position=this.effect1.transform.position,this.addChild(this.effect1))},t.prototype.updateBlendOffset=function(t){i.prototype.updateBlendOffset.call(this,t),this.effect&&this.effect.particleRender.material instanceof r.ShurikenParticleMaterialExp&&this.effect.particleRender.material.setBendOffset(t),this.effect1&&this.effect1.particleRender.material instanceof r.ShurikenParticleMaterialExp&&this.effect1.particleRender.material.setBendOffset(t)},t.prototype.update=function(t){if(this._isLoad){var e=Math.abs(this._sceneRoot.camera.position.z-this.transform.position.z);return-1<e&&e<8?this._haveColo||(this._colo?this._colo.enable=!0:(this._colo=this.addComponent(Laya.BoxCollider),this._colo.setFromBoundBox(this.meshFilter.sharedMesh.boundingBox)),this._haveColo=!0):this._haveColo&&(this._haveColo=!1,this._colo&&(this._colo.enable=!1)),i.prototype.update.call(this,t)}},t}(t.BaseBuilder)).poolName="SlowNet",t.SlowNet=e}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(n){var t,e,i;t=n.scene||(n.scene={}),e=t.builder||(t.builder={}),(i=function(i){function t(t){var e=i.call(this,t)||this;return e._haveColo=!1,e.poolName="SpeedAdd",e}return __extends(t,i),t.prototype.builder=function(){i.prototype.builder.call(this);var t=Laya.loader.getRes(this._url),e=new n.scene.BlinnPhongMaterialExp;e.albedoTexture=Laya.Texture2D.load(this._material_url),e.shininess=.01,this.meshFilter.sharedMesh=t,this.updatePos(),this.meshRender.material=e,this._sceneRoot.obstacleLayer.addChild(this)},t.prototype.update=function(t){if(this._isLoad)return Math.abs(this._sceneRoot.camera.position.z-this.transform.position.z)<4?this._haveColo||(this._colo?this._colo.enable=!0:(this._colo=this.addComponent(Laya.BoxCollider),this._colo.setFromBoundBox(this.meshFilter.sharedMesh.boundingBox),this.name="addspeed"),this._haveColo=!0):this._haveColo&&(this._haveColo=!1,this._colo&&(this._colo.enable=!1)),i.prototype.update.call(this,t)},t}(e.BaseBuilder)).poolName="SpeedAdd",e.SpeedAdd=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(n){var r,t,e;r=n.scene||(n.scene={}),t=r.builder||(r.builder={}),(e=function(i){function t(t){var e=i.call(this,t)||this;return e._haveColo=!1,e.poolName="SuperBall",e}return __extends(t,i),t.prototype.builder=function(){i.prototype.builder.call(this);var t=Laya.loader.getRes(n.Path.scene_model+"play_tw-Sphere001.lm"),e=new n.scene.BlinnPhongMaterialExp;e.shininess=.01,this.meshRender.enable=!1,this.meshFilter.sharedMesh=t,this.updatePos(),this.meshRender.material=e,this.name="SuperBall",this._sceneRoot.obstacleLayer.addChild(this),this.effect||(this.effect=r.EffectMgr.getEffect("wudi"),Vector3.ZERO.cloneTo(this.effect.transform.position),this.effect.transform.position=this.effect.transform.position,this.addChild(this.effect),this.effect1=r.EffectMgr.getEffect("wudi1"),Vector3.ZERO.cloneTo(this.effect1.transform.position),this.effect1.transform.position=this.effect1.transform.position)},t.prototype.updateBlendOffset=function(t){i.prototype.updateBlendOffset.call(this,t),this.effect&&this.effect.particleRender.material instanceof r.ShurikenParticleMaterialExp&&this.effect.particleRender.material.setBendOffset(t),this.effect1&&this.effect1.particleRender.material instanceof r.ShurikenParticleMaterialExp&&this.effect1.particleRender.material.setBendOffset(t)},t.prototype.update=function(t){if(this._isLoad){var e=Math.abs(this._sceneRoot.camera.position.z-this.transform.position.z);return-1<e&&e<8?this._haveColo||(this._colo?this._colo.enable=!0:(this._colo=this.addComponent(Laya.SphereCollider),this._colo.radius=r.BuilderMgr.ball_radis),this._haveColo=!0):this._haveColo&&(this._haveColo=!1,this._colo&&(this._colo.enable=!1)),i.prototype.update.call(this,t)}},t.prototype.onHit=function(){this._needRecicle=!0},t}(t.BaseBuilder)).poolName="SuperBall",t.SuperBall=e}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(n){var t,e,i;t=n.scene||(n.scene={}),e=t.builder||(t.builder={}),(i=function(i){function t(t){var e=i.call(this,t)||this;return e._haveColo=!1,e.poolName="XiePo",e}return __extends(t,i),t.prototype.setOffset=function(t,e,i){this._offsetX=t,this._offsetY=e-.04,this._startZ=i,this.updatePos()},t.prototype.builder=function(){i.prototype.builder.call(this);var t=Laya.loader.getRes(this._url),e=new n.scene.BlinnPhongMaterialExp;e.albedoTexture=Laya.Texture2D.load(this._material_url),e.shininess=.01,this.meshFilter.sharedMesh=t,this.updatePos(),this.meshRender.material=e,this.name="xiepo",this._sceneRoot.obstacleLayer.addChild(this)},t.prototype.update=function(t){if(this._isLoad){var e=Math.abs(this._sceneRoot.camera.position.z-this.transform.position.z);return-1<e&&e<8?this._haveColo||(this._colo?this._colo.enable=!0:(this._colo=this.addComponent(Laya.BoxCollider),this._colo.setFromBoundBox(this.meshFilter.sharedMesh.boundingBox)),this._haveColo=!0):this._haveColo&&(this._haveColo=!1,this._colo&&(this._colo.enable=!1)),i.prototype.update.call(this,t)}},t.prototype.destory=function(){this._isInit=!1},t}(e.BaseBuilder)).poolName="XiePo",e.XiePo=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var i,e;i=t.scene||(t.scene={}),e=function(e){function t(){var t=e.call(this)||this;return t._offsetZ=.1,t._distancePlayer=0,t.qua=new Laya.Quaternion,t.oldFV=0,t.levelY=0,t}return __extends(t,e),Object.defineProperty(t.prototype,"distancePlayer",{set:function(t){this._distancePlayer=t},enumerable:!0,configurable:!0}),t.prototype.init=function(t){this._sceneRoot||(this._sceneRoot=t),this.caramaPos=t.camera.transform.position,this._startPos=t.camera.transform.position.clone(),this._offsetZ=.1,this.jiasu=t.camera.getChildByName("jiasu"),this.jiasu&&this.jiasu.particleSystem.stop()},t.prototype.reset=function(){this.levelY=0,this._offsetZ=.1,Laya.Quaternion.createFromYawPitchRoll(0,0,Math.PI/2,this.qua),this._startPos.cloneTo(this.caramaPos),this._sceneRoot.camera.transform.position=this.caramaPos,this.jiasu&&this.jiasu.particleSystem.stop()},t.prototype._initialize=function(t){e.prototype._initialize.call(this,t),this.gameObject=t},t.prototype.updateSpeed=function(){this._offsetZ=this._sceneRoot.mainPlayer.playerScript.diff_z-this._distancePlayer},t.prototype.Update=function(t){this.updateSpeed(),this.caramaPos.z=this._offsetZ;var e=i.BuilderMgr.getOffestY(this._offsetZ);this.levelY+=.1*(e-this.levelY),this.caramaPos.y=this._startPos.y+this.levelY,this.caramaPos.x=.3*-this._sceneRoot.mainPlayer.playerScript._moveDiffX,i.PlayerBaseScript.baseSpeed<this._sceneRoot.mainPlayer.playerScript.speed_Z?this._sceneRoot.camera.fieldOfView<90&&(this._sceneRoot.camera.fieldOfView+=2):60<this._sceneRoot.camera.fieldOfView&&(this._sceneRoot.camera.fieldOfView-=.36),Laya.Quaternion.createFromYawPitchRoll(Math.PI,-5/180*Math.PI,.2*this._sceneRoot.mainPlayer.playerScript._moveDiffX,this.qua),this._sceneRoot.camera.transform.position=this.caramaPos,this._sceneRoot.camera.transform.rotation=this.qua},t.prototype.destory=function(){this.enable=!1},t}(Laya.Script),i.CameraMove=e}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i;e=t.scene||(t.scene={}),i=function(e){function t(){var t=e.call(this)||this;return t.yawPitchRoll=new Laya.Vector3,t.resultRotation=new Laya.Quaternion,t.tempRotationZ=new Laya.Quaternion,t.tempRotationX=new Laya.Quaternion,t.tempRotationY=new Laya.Quaternion,t.rotaionSpeed=6e-5,t}return __extends(t,e),t.prototype._initialize=function(t){e.prototype._initialize.call(this,t),Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.mouseDown),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.mouseUp),Laya.stage.on(Laya.Event.MOUSE_OUT,this,this.mouseOut),this.camera=t},t.prototype._update=function(t){e.prototype._update.call(this,t),this.updateCamera(t.elapsedTime)},t.prototype.mouseDown=function(t){this.camera.transform.localRotation.getYawPitchRoll(this.yawPitchRoll),this.lastMouseX=Laya.stage.mouseX,this.lastMouseY=Laya.stage.mouseY,this.isMouseDown=!0},t.prototype.mouseUp=function(t){this.isMouseDown=!1},t.prototype.mouseOut=function(t){this.isMouseDown=!1},t.prototype.updateCamera=function(t){if(!isNaN(this.lastMouseX)&&!isNaN(this.lastMouseY)){this.camera.scene;if(Laya.KeyBoardManager.hasKeyDown(87)&&this.camera.moveForward(-.002*t),Laya.KeyBoardManager.hasKeyDown(83)&&this.camera.moveForward(.002*t),Laya.KeyBoardManager.hasKeyDown(65)&&this.camera.moveRight(-.002*t),Laya.KeyBoardManager.hasKeyDown(68)&&this.camera.moveRight(.002*t),Laya.KeyBoardManager.hasKeyDown(81)&&this.camera.moveVertical(.002*t),Laya.KeyBoardManager.hasKeyDown(69)&&this.camera.moveVertical(-.002*t),this.isMouseDown){var e=Laya.stage.mouseX-this.lastMouseX,i=Laya.stage.mouseY-this.lastMouseY,n=this.yawPitchRoll.elements;n[0]-=e*this.rotaionSpeed*t,n[1]-=i*this.rotaionSpeed*t,this.updateRotation()}}this.lastMouseX=Laya.stage.mouseX,this.lastMouseY=Laya.stage.mouseY},t.prototype.updateRotation=function(){var t=this.yawPitchRoll.elements;Math.abs(t[1])<1.5&&(Laya.Quaternion.createFromYawPitchRoll(t[0],t[1],t[2],this.tempRotationZ),this.camera.transform.localRotation=this.tempRotationZ)},t}(Laya.Script),e.CameraMoveScript=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i;e=t.scene||(t.scene={}),i=function(e){function t(){var t=e.call(this)||this;return t._corners=new Array,t._color=new Laya.Vector4(1,0,0,1),t._corners[0]=new Laya.Vector3,t._corners[1]=new Laya.Vector3,t._corners[2]=new Laya.Vector3,t._corners[3]=new Laya.Vector3,t._corners[4]=new Laya.Vector3,t._corners[5]=new Laya.Vector3,t._corners[6]=new Laya.Vector3,t._corners[7]=new Laya.Vector3,t.phasorSpriter3D=new Laya.PhasorSpriter3D,t}return __extends(t,e),t.prototype._postRenderUpdate=function(t){var e=this._owner.getComponentByType(Laya.BoxCollider),i=null;if(e)i=e.boundBox;else{var n=this._owner.getComponentByType(Laya.MeshCollider);n&&(i=n._boundBox)}i&&(i.getCorners(this._corners),this.phasorSpriter3D.begin(Laya.WebGLContext.LINES,this._owner.camera),this.phasorSpriter3D.line(this._corners[0],this._color,this._corners[1],this._color),this.phasorSpriter3D.line(this._corners[1],this._color,this._corners[2],this._color),this.phasorSpriter3D.line(this._corners[2],this._color,this._corners[3],this._color),this.phasorSpriter3D.line(this._corners[3],this._color,this._corners[0],this._color),this.phasorSpriter3D.line(this._corners[4],this._color,this._corners[5],this._color),this.phasorSpriter3D.line(this._corners[5],this._color,this._corners[6],this._color),this.phasorSpriter3D.line(this._corners[6],this._color,this._corners[7],this._color),this.phasorSpriter3D.line(this._corners[7],this._color,this._corners[4],this._color),this.phasorSpriter3D.line(this._corners[0],this._color,this._corners[4],this._color),this.phasorSpriter3D.line(this._corners[1],this._color,this._corners[5],this._color),this.phasorSpriter3D.line(this._corners[2],this._color,this._corners[6],this._color),this.phasorSpriter3D.line(this._corners[3],this._color,this._corners[7],this._color),this.phasorSpriter3D.end())},t}(Laya.Script),e.DrawBoxColliderScript=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(s){var t,e;t=s.scene||(s.scene={}),e=function(r){function t(){var t=r.call(this)||this;return t.poolName="EffectFrame",t._total=0,t._assetsLoader=new AssetsLoader,t.setAssetPath(s.Path.scene_sf),t}return __extends(t,r),t.prototype.intoPool=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.reset()},t.prototype.outPool=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setAssetPath(s.Path.scene_sf),this._total=t[0],this._fps=t[1],this.setFps(this._fps)},t.prototype.setAssetPath=function(t){this._assetPath=t},t.prototype.setData=function(t,e,i,n){void 0===e&&(e=30),void 0===i&&(i=""),void 0===n&&(n=1e4),r.prototype.setData.call(this,t,e),this._assetsLoader.load(["res/atlas/"+this._assetPath+t+".atlas"],Handler.create(this,this.onAssetsLoaded,[t,i,n]))},t.prototype.onAssetsLoaded=function(t,e,i){void 0===e&&(e=""),void 0===i&&(i=1e4),this.setFrames(this._assetPath+t+"/"+e+"{0}.png",i)},t.prototype.setFrames=function(t,e){void 0===e&&(e=0);var i=s.Path.getSeqFrames(t,this._total,e),n=!0;this._textures=[];for(var r=0;r<i.length;r++){var a=Loader.getRes(i[r]);a&&(n=!1,this.centrePoint||(this.centrePoint=new Vector2,this.centrePoint.x=-a.sourceWidth/2,this.centrePoint.y=-a.sourceHeight/2)),this._textures.push(Loader.getRes(i[r]))}n?this.isPlayEnd=!0:(this._frameCount=this._textures.length,this._duration=this._frameCount*this._frameTime)},t.prototype.updateTexture=function(){var t,e=Laya.timer.currTimer;this._startTime>e||this._textures&&(r.prototype.updateTexture.call(this),this.isPlayEnd||(this._texture=this._textures[this._curFrameIndex],this._centrePoints&&(t=this._centrePoints[this._curFrameIndex]),this._regY=t?(this._regX=t.x,t.y):(this._regX=this.centrePoint.x,this.centrePoint.y)))},t.prototype.updateTransform=function(t){r.prototype.updateTransform.call(this,t),this.realPosX=this._drawX,this.realPosY=this._drawY,1==this._scale?(this._drawX+=this._regX,this._drawY+=this._regY):(this._drawW=this._drawW*this._scale,this._drawH=this._drawH*this._scale,this._drawX+=this._regX*this._scale,this._drawY+=this._regY*this._scale)},t.prototype.reset=function(){this._textures=null,this._centrePoints=null,this.centrePoint=null,this._total=0,this._assetsLoader&&this._assetsLoader.clear(),r.prototype.reset.call(this)},t}(t.Effect),t.EffectFrame=e}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i;e=t.scene||(t.scene={}),i=function(e){function t(){var t=e.call(this)||this;return t._effects=new Array,t._dels=new Array,t._maxCount=-1,t}return __extends(t,e),Object.defineProperty(t.prototype,"maxCount",{get:function(){return this._maxCount},set:function(t){this._maxCount=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFull",{get:function(){return-1!=this._maxCount&&this._maxCount<=this._effects.length},enumerable:!0,configurable:!0}),t.prototype.addEffect=function(t){-1==this._effects.indexOf(t)&&this._effects.push(t)},t.prototype.removeEffect=function(t){var e=this._effects.indexOf(t);0<=e&&this._effects.splice(e,1);var i=t;i.intoPool&&ObjectPools.free(i)},t.prototype.clerDels=function(){for(var t=0;t<this._dels.length;t++)this.removeEffect(this._dels[t]);this._dels.length=0},t.prototype.onDraw=function(t){for(var e=this._dels.length=0;e<this._effects.length;e++){(i=this._effects[e]).isPlayEnd?this._dels.push(i):i.updateTexture()}this.clerDels(),this.graphics.clear();for(e=0;e<this._effects.length;e++){var i;(i=this._effects[e]).onDraw(this.graphics,t)}},t}(Laya.Sprite),e.EffectLayer=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i,r,a,s,n;e=t.scene||(t.scene={}),i=Laya.RenderQueue,r=Laya.VertexElementUsage,a=Laya.Shader3D,s=Laya.Sprite3D,(n=function(e){function n(){var t=e.call(this)||this;return t.initShader(),t.setShaderName("GLITTER1"),t.renderMode=n.RENDERMODE_OPAQUE,t._setColor(n.UNICOLOR,new Vector4(1,1,1,1)),t._setColor(n.ALBEDO,new Vector4(1,1,1,1)),t.setBendDistance(50),t}return __extends(n,e),n.load=function(t){return Laya.loader.create(t,null,null,n)},Object.defineProperty(n.prototype,"renderMode",{set:function(t){switch(t){case n.RENDERMODE_OPAQUE:this.renderQueue=i.OPAQUE,this.depthWrite=!0,this.cull=n.CULL_BACK,this.blend=n.BLEND_DISABLE;break;case n.RENDERMODE_OPAQUEDOUBLEFACE:this.renderQueue=i.OPAQUE,this.depthWrite=!0,this.cull=n.CULL_NONE,this.blend=n.BLEND_DISABLE;break;case n.RENDERMODE_TRANSPARENT:this.renderQueue=i.TRANSPARENT,this.depthWrite=!0,this.cull=n.CULL_BACK,this.blend=n.BLEND_ENABLE_ALL,this.srcBlend=n.BLENDPARAM_SRC_ALPHA,this.dstBlend=n.BLENDPARAM_ONE_MINUS_SRC_ALPHA;break;case n.RENDERMODE_TRANSPARENTDOUBLEFACE:this.renderQueue=i.TRANSPARENT,this.depthWrite=!0,this.cull=n.CULL_NONE,this.blend=n.BLEND_ENABLE_ALL,this.srcBlend=n.BLENDPARAM_SRC_ALPHA,this.dstBlend=n.BLENDPARAM_ONE_MINUS_SRC_ALPHA;break;case n.RENDERMODE_ADDTIVE:this.renderQueue=i.TRANSPARENT,this.depthWrite=!0,this.cull=n.CULL_BACK,this.blend=n.BLEND_ENABLE_ALL,this.srcBlend=n.BLENDPARAM_SRC_ALPHA,this.dstBlend=n.BLENDPARAM_ONE;break;case n.RENDERMODE_ADDTIVEDOUBLEFACE:this.renderQueue=i.TRANSPARENT,this.depthWrite=!0,this.cull=n.CULL_NONE,this.blend=n.BLEND_ENABLE_ALL,this.srcBlend=n.BLENDPARAM_SRC_ALPHA,this.dstBlend=n.BLENDPARAM_ONE;break;case n.RENDERMODE_DEPTHREAD_TRANSPARENT:this.renderQueue=i.TRANSPARENT,this.depthWrite=!1,this.cull=n.CULL_BACK,this.blend=n.BLEND_ENABLE_ALL,this.srcBlend=n.BLENDPARAM_SRC_ALPHA,this.dstBlend=n.BLENDPARAM_ONE_MINUS_SRC_ALPHA;break;case n.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE:this.renderQueue=i.TRANSPARENT,this.depthWrite=!1,this.cull=n.CULL_NONE,this.blend=n.BLEND_ENABLE_ALL,this.srcBlend=n.BLENDPARAM_SRC_ALPHA,this.dstBlend=n.BLENDPARAM_ONE_MINUS_SRC_ALPHA;break;case n.RENDERMODE_DEPTHREAD_ADDTIVE:this.renderQueue=i.TRANSPARENT,this.depthWrite=!1,this.cull=n.CULL_BACK,this.blend=n.BLEND_ENABLE_ALL,this.srcBlend=n.BLENDPARAM_SRC_ALPHA,this.dstBlend=n.BLENDPARAM_ONE;break;case n.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE:this.renderQueue=i.TRANSPARENT,this.depthWrite=!1,this.cull=n.CULL_NONE,this.blend=n.BLEND_ENABLE_ALL,this.srcBlend=n.BLENDPARAM_SRC_ALPHA,this.dstBlend=n.BLENDPARAM_ONE;break;case n.RENDERMODE_NONDEPTH_TRANSPARENT:this.renderQueue=i.TRANSPARENT,this.depthTest=n.DEPTHTEST_LESS,this.cull=n.CULL_BACK,this.blend=n.BLEND_ENABLE_ALL,this.srcBlend=n.BLENDPARAM_SRC_ALPHA,this.dstBlend=n.BLENDPARAM_ONE_MINUS_SRC_ALPHA;break;case n.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE:this.renderQueue=i.TRANSPARENT,this.depthTest=n.DEPTHTEST_LESS,this.cull=n.CULL_NONE,this.blend=n.BLEND_ENABLE_ALL,this.srcBlend=n.BLENDPARAM_SRC_ALPHA,this.dstBlend=n.BLENDPARAM_ONE_MINUS_SRC_ALPHA;break;case n.RENDERMODE_NONDEPTH_ADDTIVE:this.renderQueue=i.TRANSPARENT,this.depthTest=n.DEPTHTEST_LESS,this.cull=n.CULL_BACK,this.blend=n.BLEND_ENABLE_ALL,this.srcBlend=n.BLENDPARAM_SRC_ALPHA,this.dstBlend=n.BLENDPARAM_ONE;break;case n.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE:this.renderQueue=i.TRANSPARENT,this.depthTest=n.DEPTHTEST_LESS,this.cull=n.CULL_NONE,this.blend=n.BLEND_ENABLE_ALL,this.srcBlend=n.BLENDPARAM_SRC_ALPHA,this.dstBlend=n.BLENDPARAM_ONE;break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"diffuseTexture",{get:function(){return this._getTexture(n.DIFFUSETEXTURE)},set:function(t){this._setTexture(n.DIFFUSETEXTURE,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"color",{get:function(){return this._getColor(n.UNICOLOR)},set:function(t){this._setColor(n.UNICOLOR,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"albedo",{get:function(){return this._getColor(n.ALBEDO)},set:function(t){this._setColor(n.ALBEDO,t)},enumerable:!0,configurable:!0}),n.prototype.getBendOffset=function(){return this._getColor(n.BENDANGLE)},n.prototype.setBendOffset=function(t){this._setColor(n.BENDANGLE,t)},n.prototype.setBendDistance=function(t){this._setNumber(n.BENDDISTANCE,t)},n.prototype.setShaderName=function(t){e.prototype.setShaderName.call(this,t)},n.prototype.initShader=function(){if(!n.isInit){n.isInit=!0;var t={a_Position:r.POSITION0,a_Texcoord0:r.TEXTURECOORDINATE0,a_Time:r.TIME0},e={u_Texture:[n.DIFFUSETEXTURE,a.PERIOD_MATERIAL],u_Albedo:[n.ALBEDO,a.PERIOD_MATERIAL],u_Color:[n.UNICOLOR,a.PERIOD_MATERIAL],u_CurrentTime:[Glitter.CURRENTTIME,a.PERIOD_SPRITE],_QOffset:[n.BENDANGLE,a.PERIOD_MATERIAL],_Dist:[n.BENDDISTANCE,a.PERIOD_MATERIAL],u_Duration:[Glitter.DURATION,a.PERIOD_SPRITE],u_MvpMatrix:[s.MVPMATRIX,a.PERIOD_SPRITE]},i=a.nameKey.add("GLITTER1");Laya.ShaderCompile3D.add(i,"attribute vec4 a_Position;\n\t\t\tattribute vec2 a_Texcoord0;\n\t\t\tattribute float a_Time;\n\n\t\t\tuniform mat4 u_MvpMatrix;\n\t\t\tuniform  float u_CurrentTime;\n\t\t\tuniform  vec4 u_Color;\n\t\t\tuniform float u_Duration;\n\n\t\t\tvarying vec2 v_Texcoord;\n\t\t\tvarying vec4 v_Color;\n\n\t\t\tuniform vec4 _QOffset;\n\t\t\tuniform float _Dist;\n\n\n\t\t\tvoid main()\n\t\t\t{\n\t\t\t\thighp vec4 vPos = u_MvpMatrix * a_Position;\n\t\t\t\tfloat zOff = vPos.z / _Dist;\n\t\t\t\tvPos += _QOffset * zOff * zOff;\n\t\t\t\tgl_Position = vPos;\n\n\t\t\tfloat age = u_CurrentTime-a_Time;\n\t\t\tfloat normalizedAge = clamp(age / u_Duration,0.0,1.0);\n\t\t\t\n\t\t\tv_Texcoord=a_Texcoord0;\n\t\t\t\n\t\t\tv_Color=u_Color;\n\t\t\tv_Color.a*=1.0-normalizedAge;\n\t\t\t}\n\t\t\t","#ifdef HIGHPRECISION\n\t\t\t\tprecision highp float;\n\t\t\t#else\n\t\t\t\tprecision mediump float;\n\t\t\t#endif\n\n\t\t\tuniform vec4 u_Albedo;\n\t\t\tuniform sampler2D u_Texture;\n\n\t\t\tvarying vec2 v_Texcoord;\n\t\t\tvarying vec4 v_Color;\n\n\n\t\t\tvoid main()\n\t\t\t{\t\n\t\t\tgl_FragColor=texture2D(u_Texture, v_Texcoord)*v_Color;\n\t\t\tgl_FragColor=gl_FragColor*u_Albedo;\n\t\t\t}\n\t\t\t",t,e)}},n}(Laya.BaseMaterial)).RENDERMODE_OPAQUE=1,n.RENDERMODE_OPAQUEDOUBLEFACE=2,n.RENDERMODE_TRANSPARENT=13,n.RENDERMODE_TRANSPARENTDOUBLEFACE=14,n.RENDERMODE_ADDTIVE=15,n.RENDERMODE_ADDTIVEDOUBLEFACE=16,n.RENDERMODE_DEPTHREAD_TRANSPARENT=5,n.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,n.RENDERMODE_DEPTHREAD_ADDTIVE=7,n.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,n.RENDERMODE_NONDEPTH_TRANSPARENT=9,n.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,n.RENDERMODE_NONDEPTH_ADDTIVE=11,n.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,n.DIFFUSETEXTURE=1,n.ALBEDO=2,n.UNICOLOR=3,n.BENDANGLE=4,n.BENDDISTANCE=5,n.isInit=!1,e.GlitterMaterialNew=n}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(o){var l,t;l=o.scene||(o.scene={}),(t=function(a){function s(){var t=a.call(this)||this;return t.running=!0,t.diff_z=0,t._moveDiffX=0,t._desDiffX=0,t._isMainPlayer=!1,t.isPass=!1,t._isWuDi=!1,t._buffSpeed=0,t.speedAdd=.005,t.speedRelease=.0045,t.speedRelasePerTime=125e-8,t._muli=1,t.slowNetEndTime=0,t.max_width=.35,t._oldMoveOffsetY=0,t._levelOffsetY=0,t._tempRoate=new Vector3,t._speed_z=s.baseSpeed,t._lastOffsetY=0,t._path=[],t.isEnd=!0,t}return __extends(s,a),s.prototype.init=function(t,e){this._app||(this._app=t),this.pos1=new Laya.Vector3(0,0,0),this.pos2=new Laya.Vector3(1,0,0),this._glitter=this._app.sceneRoot.glitterLayer.addChild(new Laya.Glitter);var i=this._glitter.templet;i.lifeTime=.12,i.minSegmentDistance=.1,i.minInterpDistance=.6,i.maxSlerpCount=128,i.maxSegments=600,s._robotGlitMaterial||((s._robotGlitMaterial=new l.GlitterMaterialNew).renderMode=l.GlitterMaterialNew.RENDERMODE_TRANSPARENT,s._robotGlitMaterial.albedo=new Laya.Vector4(1.3,1.3,1.3,1)),s._robotGlitMaterial.diffuseTexture=Laya.Texture2D.load(StringU.substitute("scene/tuowei/qiu11.png")),this._glitter.glitterRender.material=s._robotGlitMaterial,this._isMainPlayer=e,MessageManager.on(WXTool.GAMESTART,this,this.startGame),MessageManager.on(WXTool.GAMESTOP,this,this.stopGame)},s.prototype._initialize=function(t,e){a.prototype._initialize.call(this,t),this.player=t,this.playPos=this.player.transform.position.clone(),this.offsetplayPos=this.player.transform.position.clone(),this.diff_z=this.playPos.z,this.effect1=t.getChildByName("guangquan"),this.effect2=t.getChildByName("wudian"),this.effect3=t.getChildByName("zhuangji"),this.guangbo=t.getChildByName("guangbo"),this.effect4=t.getChildByName("jiansu0"),this.effect4.removeSelf(),this.effect5=t.getChildByName("jiansu1"),this.effect5.removeSelf(),this.effect_wudi_0=t.getChildByName("wudi0"),this.effect_wudi_1=t.getChildByName("wudi1"),this.effect_wudi_2=t.getChildByName("wudi2"),this.playerBase=t.getChildByName("player"),this.effect1&&this.effect1.particleSystem.stop(),this.effect2&&this.effect2.particleSystem.stop(),this.effect3&&this.effect3.particleSystem.stop(),this.guangbo&&this.guangbo.particleSystem.stop(),this.effect4&&this.effect4.particleSystem.stop(),this.effect5&&this.effect5.particleSystem.stop(),this.effect_wudi_0&&this.effect_wudi_0.particleSystem.stop(),this.effect_wudi_1&&this.effect_wudi_1.particleSystem.stop(),this.effect_wudi_2&&this.effect_wudi_2.particleSystem.stop(),this._startPos=this.player.transform.position.clone();var i=new o.scene.BlinnPhongMaterialExp;if(e)i.albedoTexture=Laya.Texture2D.load(StringU.substitute("scene/pifu/role01.jpg"));else{var n=Math.floor(MathU.randomRange(1,18)),r=void 0;r=1<=n&&n<=9?"0"+n.toString():n.toString(),i.albedoTexture=Laya.Texture2D.load(StringU.substitute("scene/pifu/role{0}.jpg",r))}i.shininess=.078,this.playerBase.meshRender.material=i,this.isWuDi=!1},s.prototype.addSlowNet=function(){this.player.addChild(this.effect4),this.effect4.particleSystem.play(),this.player.addChild(this.effect5),this.effect5.particleSystem.play(),this._buffSpeed=-.002,this.slowNetEndTime=Laya.timer.currTimer+1e4},s.prototype.removeSlowNet=function(){this.player.removeChild(this.effect4),this.effect4.particleSystem.stop(),this.player.removeChild(this.effect5),this.effect5.particleSystem.stop(),this._buffSpeed=0,this.slowNetEndTime=0},s.prototype.createName=function(){if(!this._nameMesh&&!this._isMainPlayer){var t=new Laya.PlaneMesh(1,.1,1,1);this._nameMesh=new MeshSprite3D(t);var e=new l.BlinnPhongMaterialExp;e.albedoTexture=Laya.Texture2D.load(o.Path.name_texture+Math.floor(100*Math.random())+".png"),this._nameMesh.meshRender.material=e,TD.TD_Vector3_0.x=-Math.PI/2*3,TD.TD_Vector3_0.y=Math.PI,TD.TD_Vector3_0.z=0,this._nameMesh.transform.rotate(TD.TD_Vector3_0),TD.TD_Vector3_1.x=0,TD.TD_Vector3_1.y=.05,TD.TD_Vector3_1.z=-.2,this._nameMesh.transform.translate(TD.TD_Vector3_1),e.renderMode=l.BlinnPhongMaterialExp.RENDERMODE_TRANSPARENT,this.player.addChild(this._nameMesh)}},s.prototype.createShadow=function(){s.shadowMaterial||((s.shadowMaterial=new o.scene.BlinnPhongMaterialExp).albedoTexture=Laya.Texture2D.load("scene/shadow01.png"),s.shadowMaterial.renderMode=l.BlinnPhongMaterialExp.RENDERMODE_TRANSPARENT);var t=new Laya.PlaneMesh(.15,.15,1,1);this.shadow=new MeshSprite3D(t),this._app.sceneRoot.shadowLayer.addChild(this.shadow),this.shadow.meshRender.material=s.shadowMaterial},s.prototype.reset=function(){this.running=!0,this.isWuDi=!1,this.effect1&&this.effect1.particleSystem.stop(),this.effect2&&this.effect2.particleSystem.stop(),this.effect3&&this.effect3.particleSystem.stop(),this.playerBase.meshRender.enable=!0,this._startPos.cloneTo(this.playPos),this._startPos.cloneTo(this.offsetplayPos),this.player.transform.position=this.offsetplayPos,this.diff_z=this._startPos.z,this._moveDiffX=0,this._desDiffX=0,this._speed_z=s.baseSpeed,this._oldMoveOffsetY=0,this._levelOffsetY=0,this._lastOffsetY=0,this.removeSlowNet(),this.isEnd=!0,this._path.length=0,this.colorType=1,this.updateSkin(),this.updateTuoWei()},s.prototype.updateSkin=function(){var t=this._app.plyertDataMgr.getUseSkinIndex();24<t&&(t=Math.floor(MathU.randomRange(1,24)));var e=this._app.plyertDataMgr.getAvatar(t);console.log("打印皮肤",e);var i=this._app.plyertDataMgr.getUseLuckSkin();24<i&&(i=Math.floor(MathU.randomRange(1,24)));var n=this._app.plyertDataMgr.getAvatar(i);this._app.plyertDataMgr.isUseLuckySkin()&&i&&n.type==o.gui.page.SkinPage.TYPE_BALL+1?this.playerBase.meshRender.material.albedoTexture=Laya.Texture2D.load(StringU.substitute("scene/pifu/{0}.jpg",n.avatar)):e&&e.avatar&&(this.playerBase.meshRender.material.albedoTexture=Laya.Texture2D.load(StringU.substitute("scene/pifu/{0}.jpg",e.avatar)))},Object.defineProperty(s.prototype,"colorType",{set:function(t){this._color_type=t,this.playerBase.meshRender.material.albedoColor=TD.getColor(t)},enumerable:!0,configurable:!0}),s.prototype.updateTuoWei=function(){var t=this._app.plyertDataMgr.getAvatar(this._app.plyertDataMgr.getUseTuoWeiSkinIndex()),e=this._app.showRoot.effectTuoWeiSence;if(console.log("打印拖尾",t,e),t&&e){this._glitter&&(this._glitter.destroy(),this._glitter=null),this.putBackEffectTuoWei();var i=t.avatar;this._tuoWeiSkin=i;var n=this._app.plyertDataMgr.getUseLuckSkin(),r=this._app.plyertDataMgr.getAvatar(n);if(this._app.plyertDataMgr.isUseLuckySkin()&&n&&r.type==o.gui.page.SkinPage.TYPE_TUOWEI+1&&(i=r.avatar),this._effectTuoWei=e.getChildByName(i),this._isMainPlayer&&this._effectTuoWei)this._isLizi=!0,this._mParent=this._effectTuoWei.parent,this._app.sceneRoot.glitterLayer.addChild(this._effectTuoWei);else{this._isLizi=!1,this._glitter=this._app.sceneRoot.glitterLayer.addChild(new Laya.Glitter);var a=this._glitter.templet;a.lifeTime=.12,a.minSegmentDistance=.1,a.minInterpDistance=.6,a.maxSlerpCount=128,a.maxSegments=600,s._playerGlitMaterial||((s._playerGlitMaterial=new l.GlitterMaterialNew).renderMode=l.GlitterMaterialNew.RENDERMODE_TRANSPARENT,s._playerGlitMaterial.albedo=new Laya.Vector4(1.3,1.3,1.3,1)),s._playerGlitMaterial.diffuseTexture=Laya.Texture2D.load(StringU.substitute("scene/tuowei/{0}.png",this._isMainPlayer&&i?i:"glitter")),this._glitter.glitterRender.material=s._playerGlitMaterial}}},s.prototype.putBackEffectTuoWei=function(){this._effectTuoWei&&this._effectTuoWei.parent&&(this._mParent?this._mParent.addChild(this._effectTuoWei):this._effectTuoWei.removeSelf(),this._effectTuoWei=null)},s.prototype.randStartPos=function(){var t=this;this.isEnd=!0,this._path.length=0,this.isPass=!1,this.effect1&&this.effect1.particleSystem.stop(),this.effect2&&this.effect2.particleSystem.stop(),this.effect3&&this.effect3.particleSystem.stop(),this.effect4&&this.effect4.particleSystem.stop(),this.effect5&&this.effect5.particleSystem.stop(),this.playerBase.meshRender.enable=!0,this.removeSlowNet(),this.running=!0,this._desDiffX=this._moveDiffX=1.2*Math.random()-.6,this.diff_z=this._app.sceneRoot.mainPlayer.playerScript.diff_z+10+10*Math.random(),this._speed_z=s.baseSpeed+Math.random()*this.speedAdd,this._lastOffsetY=0,this._levelOffsetY=0,this._glitter&&(this._glitter.glitterRender.enable=!1,Laya.timer.once(1e3,this,function(){t._glitter.glitterRender.enable=!0}))},s.prototype.playerMove=function(t){this._desDiffX+=2.5*t,this._desDiffX>this.max_width&&(this._desDiffX=this.max_width),this._desDiffX<-this.max_width&&(this._desDiffX=-this.max_width),this._moveDiffX=this._desDiffX},s.prototype.stopGame=function(){this._app.isOut=!0,console.log("游戏暂停了",this.running,this._app.isOut)},s.prototype.startGame=function(){this._app.isOut=!1,console.log("游戏恢复了",this.running,this._app.isOut)},s.prototype.Update=function(t,e){this.running&&(0!=this.slowNetEndTime&&this.slowNetEndTime<Laya.timer.currTimer&&this.removeSlowNet(),0!=this._wuDiTimeEnd&&this._wuDiTimeEnd-1e3<Laya.timer.currTimer&&(this._buffSpeed=0),0!=this._wuDiTimeEnd&&this._wuDiTimeEnd<Laya.timer.currTimer&&this.removeWuDi(),this.updatePos(t),this.playerBase.meshRender.material instanceof l.BlinnPhongMaterialExp&&this.playerBase.meshRender.material.setBendOffset(e),this._nameMesh&&this._nameMesh.meshRender.material instanceof l.BlinnPhongMaterialExp&&this._nameMesh.meshRender.material.setBendOffset(e),this.shadow&&this.shadow.meshRender.material instanceof l.BlinnPhongMaterialExp&&this.shadow.meshRender.material.setBendOffset(e),this._glitter&&this._glitter.glitterRender.material instanceof l.GlitterMaterialNew&&this._glitter.glitterRender.material.setBendOffset(e),this.effect1&&this.effect1.particleRender.material instanceof l.ShurikenParticleMaterialExp&&this.effect1.particleRender.material.setBendOffset(e),this.effect2&&this.effect2.particleRender.material instanceof l.ShurikenParticleMaterialExp&&this.effect2.particleRender.material.setBendOffset(e),this.effect3&&this.effect3.particleRender.material instanceof l.ShurikenParticleMaterialExp&&this.effect3.particleRender.material.setBendOffset(e),this.guangbo&&this.guangbo.particleRender.material instanceof l.ShurikenParticleMaterialExp&&this.guangbo.particleRender.material.setBendOffset(e),this.effect4&&this.effect4.particleRender.material instanceof l.ShurikenParticleMaterialExp&&this.effect4.particleRender.material.setBendOffset(e),this.effect5&&this.effect5.particleRender.material instanceof l.ShurikenParticleMaterialExp&&this.effect5.particleRender.material.setBendOffset(e),this.effect_wudi_0&&this.effect_wudi_0.particleRender.material instanceof l.ShurikenParticleMaterialExp&&this.effect_wudi_0.particleRender.material.setBendOffset(e),this.effect_wudi_1&&this.effect_wudi_1.particleRender.material instanceof l.ShurikenParticleMaterialExp&&this.effect_wudi_1.particleRender.material.setBendOffset(e),this.effect_wudi_2&&this.effect_wudi_2.particleRender.material instanceof l.ShurikenParticleMaterialExp&&this.effect_wudi_2.particleRender.material.setBendOffset(e))},Object.defineProperty(s.prototype,"isWuDi",{get:function(){return this._isWuDi},set:function(t){t!=this._isWuDi&&(t?(this.effect_wudi_0.particleSystem.play(),this.effect_wudi_1.particleSystem.play(),this.effect_wudi_2.particleSystem.play(),this.player.addChild(this.effect_wudi_0),this.player.addChild(this.effect_wudi_1),this.player.addChild(this.effect_wudi_2)):(this.effect_wudi_0.particleSystem.stop(),this.effect_wudi_1.particleSystem.stop(),this.effect_wudi_2.particleSystem.stop(),this.effect_wudi_0.removeSelf(),this.effect_wudi_1.removeSelf(),this.effect_wudi_2.removeSelf()),this._isWuDi=t)},enumerable:!0,configurable:!0}),s.prototype.addWuDi=function(){this._buffSpeed=.005,this._wuDiTimeEnd=Laya.timer.currTimer+4e3,this.isWuDi=!0},s.prototype.removeWuDi=function(){this._wuDiTimeEnd=0,this._buffSpeed=0,this.isWuDi=!1},s.prototype.updatePos=function(t){this.updateSpeedZ(t);var e=this._desDiffX-this._moveDiffX;this._moveDiffX+=.05<Math.abs(e)?0<e?.05:-.05:0;var i=(this._speed_z+this._buffSpeed)*t;this.updateLevelChange(),this._oldMoveOffsetY=this.updateOffsetY(),this.diff_z+=i,this.playPos.cloneTo(this.offsetplayPos),this.offsetplayPos.x=-this._moveDiffX,this.offsetplayPos.y=this._levelOffsetY+this._oldMoveOffsetY+.08,this.offsetplayPos.z=this.diff_z,this.player.transform.position=this.offsetplayPos,this._tempRoate.x=3*this._speed_z*t,this.playerBase.transform.rotate(this._tempRoate),this._glitter&&(this.pos2.z=this.pos1.z=this.diff_z+.15,this.pos1.x=this.offsetplayPos.x-.04,this.pos2.x=this.pos1.x+.08,this.pos1.y=this.pos2.y=this._levelOffsetY+.006,this._glitter.addGlitterByPositions(this.pos1,this.pos2)),this._isLizi&&this._effectTuoWei&&(this._effectTuoWei.transform.position.x=this.player.transform.position.x,this._effectTuoWei.transform.position.y=this.player.transform.position.y,this._effectTuoWei.transform.position.z=this.player.transform.position.z-("jianqi"==this._tuoWeiSkin?.3:0))},Object.defineProperty(s.prototype,"speed_Z",{get:function(){return this._speed_z},enumerable:!0,configurable:!0}),s.prototype.updateSpeedZ=function(t){},s.prototype.onTriggerEnter=function(t){if("xiepo"==t.owner.name)this.movePath(),this.colorType=t.owner.color_type;else if("ColorBall"==t.owner.name){var e=t.owner;this.isWuDi||e.color_type==this._color_type?(e.onHit(),this.playZhuanji(e.color_type),this._app.sceneRoot.PlayScore=this._app.sceneRoot.PlayScore+1*this._muli):this.playDie(),this.effect3&&this.effect3.particleSystem.play()}else if("MusicBall"==t.owner.name){(e=t.owner).onHit(),this.playZhuanji(1)}else if("MultipleBall"==t.owner.name){(e=t.owner).onHit(),this._muli+=1,this.playZhuanji(e.color_type)}if(t.owner){var i=t.owner.topType;i&&("speed"==i.type&&this.addSlowNet(),"power"==i.type&&this.addWuDi())}WXTool.vibrateShort()},s.prototype.playZhuanji=function(t){this.guangbo.particleSystem.startColorConstant=TD.getColor(t),this.guangbo&&this.guangbo.particleSystem.play(),this.effect3.particleRender.material.tintColor=TD.getColor(t),this.effect3&&this.effect3.particleSystem.play(),this.effect3.particleRender.material.renderMode=l.GlitterMaterialNew.RENDERMODE_TRANSPARENT},s.prototype.playDie=function(){this.running=!1,this.playerBase.meshRender.enable=!1,this.effect1&&this.effect1.particleSystem.play(),this.effect2&&this.effect2.particleSystem.play(),this.effect4&&this.effect4.particleSystem.play(),this.effect5&&this.effect5.particleSystem.play(),MessageManager.off(WXTool.GAMESTART,this,this.startGame),MessageManager.off(WXTool.GAMESTOP,this,this.startGame),this._speed_z=0,PlayerDataMgr.isPlayActionMusic&&Laya.SoundManager.playSound("scene/music/dead.mp3"),this._isMainPlayer&&this._app.sceneRoot.gameEnd()},s.prototype.updateLevelChange=function(){var t=l.BuilderMgr.getOffestY(this.diff_z);this._lastOffsetY!=t&&(this._lastOffsetY=t,this.movePathLevel())},s.prototype.movePathLevel=function(){this._path=[.05,-1,-.9,-1],this.des_y=this._path.shift(),this.start_y=0,this.pass_time=0;var t=this.des_y;this.speed_y=.2*s.baseSpeed,this.need_time=t/this.speed_y,this.isEnd=!1},s.prototype.movePath=function(){this._path=[.4,0,.1,0],this.des_y=this._path.shift(),this.start_y=0,this.pass_time=0;var t=this.des_y;this.speed_y=.6*s.baseSpeed,this.need_time=t/this.speed_y,this.isEnd=!1},s.prototype.updateOffsetY=function(){if(this.isEnd)return 0;this.pass_time=this.pass_time+Laya.timer.delta;var t=this.pass_time/this.need_time;t=1<t?1:t;var e=this.start_y+t*(this.des_y-this.start_y);if(this.pass_time>=this.need_time)if(0<this._path.length){this.pass_time=this.pass_time-this.need_time,this.des_y=this._path.shift(),this.start_y=e;var i=Math.abs(this.des_y-this.start_y);this.need_time=i/this.speed_y,this._isMainPlayer&&WXTool.vibrateShort()}else this.isEnd=!0,this._levelOffsetY=this._lastOffsetY;return e},s.prototype.destory=function(){this.enable=!1,this.running=!1,this.player&&(this.player.active=!0)},s}(Laya.Script)).baseSpeed=.005,t.maxSpeed=.01,l.PlayerBaseScript=t}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i;e=t.scene||(t.scene={}),i=function(i){function t(){return i.call(this)||this}return __extends(t,i),t.prototype.init=function(t,e){i.prototype.init.call(this,t,e)},Object.defineProperty(t.prototype,"playerScript",{get:function(){return this._playerScript||(this._playerScript=this.owner.addComponent(e.PlayerScript)),this._playerScript},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this._playerScript&&(this.owner.destroyed||this.owner.removeComponentByType(e.PlayerScript),this._playerScript.destory(),this._playerScript=null),i.prototype.destroy.call(this)},t}(e.BaseMeshSprite3D),e.PlayerMeshSprite3D=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i;e=t.scene||(t.scene={}),i=function(i){function t(){return i.call(this)||this}return __extends(t,i),t.prototype.init=function(t,e){console.log("主玩家初始化"),i.prototype.init.call(this,t,e)},t.prototype.onStartGame=function(){},t.prototype.onEndGame=function(){},t.prototype._initialize=function(t){i.prototype._initialize.call(this,t,!0),this.player=t},t.prototype.playDie=function(){i.prototype.playDie.call(this)},t.prototype.destory=function(){i.prototype.destory.call(this)},t}(e.PlayerBaseScript),e.PlayerScript=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i;e=t.scene||(t.scene={}),i=function(i){function t(){return i.call(this)||this}return __extends(t,i),t.prototype.init=function(t,e){i.prototype.init.call(this,t,e)},Object.defineProperty(t.prototype,"robotScript",{get:function(){return this._robotScript||(this._robotScript=this.owner.addComponent(e.RobotScript)),this._robotScript},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this._robotScript&&(this.owner.destroyed||this.owner.removeComponentByType(e.RobotScript),this._robotScript.destory(),this._robotScript=null),i.prototype.destroy.call(this)},t}(e.BaseMeshSprite3D),e.RobotMeshSprite3D=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i;e=t.scene||(t.scene={}),i=function(i){function t(){return i.call(this)||this}return __extends(t,i),t.prototype.init=function(t,e){i.prototype.init.call(this,t,e)},t.prototype.onStartGame=function(){},t.prototype.onEndGame=function(){},t.prototype._initialize=function(t){i.prototype._initialize.call(this,t,!1),this.player=t},t.prototype.destory=function(){i.prototype.destory.call(this)},t}(e.PlayerBaseScript),e.RobotScript=i}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e,i,n,r,a,s,h,o;e=t.scene||(t.scene={}),i=Laya.RenderQueue,n=Laya.ShaderCompile3D,r=Laya.ShaderDefines,a=Laya.BaseMaterial,s=Laya.Vector4,h=Laya.ShuriKenParticle3D,(o=function(o){function l(){var t=o.call(this)||this;return t.initShader1(),t.setShaderName("PARTICLESHURIKENEXP"),t.setBendDistance(50),t.renderMode=l.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE,t}return __extends(l,o),l.__init__=function(){l.SHADERDEFINE_DIFFUSEMAP=l.shaderDefines.registerDefine("DIFFUSEMAP"),l.SHADERDEFINE_TINTCOLOR=l.shaderDefines.registerDefine("TINTCOLOR"),l.SHADERDEFINE_ADDTIVEFOG=l.shaderDefines.registerDefine("ADDTIVEFOG"),l.SHADERDEFINE_TILINGOFFSET=l.shaderDefines.registerDefine("TILINGOFFSET")},l.load=function(t){return Laya.loader.create(t,null,null,l)},Object.defineProperty(l.prototype,"renderMode",{set:function(t){switch(t){case l.RENDERMODE_OPAQUE:this.renderQueue=i.OPAQUE,this.depthWrite=!0,this.cull=l.CULL_BACK,this.blend=l.BLEND_DISABLE,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case l.RENDERMODE_OPAQUEDOUBLEFACE:this.renderQueue=i.OPAQUE,this.depthWrite=!0,this.cull=l.CULL_NONE,this.blend=l.BLEND_DISABLE,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case l.RENDERMODE_CUTOUT:this.depthWrite=!0,this.cull=l.CULL_BACK,this.blend=l.BLEND_DISABLE,this.renderQueue=i.OPAQUE,this.alphaTest=!0,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case l.RENDERMODE_CUTOUTDOUBLEFACE:this.renderQueue=i.OPAQUE,this.depthWrite=!0,this.cull=l.CULL_NONE,this.blend=l.BLEND_DISABLE,this.alphaTest=!0,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case l.RENDERMODE_TRANSPARENT:this.renderQueue=i.TRANSPARENT,this.depthWrite=!0,this.cull=l.CULL_BACK,this.blend=l.BLEND_ENABLE_ALL,this.srcBlend=l.BLENDPARAM_SRC_ALPHA,this.dstBlend=l.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case l.RENDERMODE_TRANSPARENTDOUBLEFACE:this.renderQueue=i.TRANSPARENT,this.depthWrite=!0,this.cull=l.CULL_NONE,this.blend=l.BLEND_ENABLE_ALL,this.srcBlend=l.BLENDPARAM_SRC_ALPHA,this.dstBlend=l.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case l.RENDERMODE_ADDTIVE:this.renderQueue=i.TRANSPARENT,this.depthWrite=!0,this.cull=l.CULL_BACK,this.blend=l.BLEND_ENABLE_ALL,this.srcBlend=l.BLENDPARAM_SRC_ALPHA,this.dstBlend=l.BLENDPARAM_ONE,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case l.RENDERMODE_ADDTIVEDOUBLEFACE:this.renderQueue=i.TRANSPARENT,this.depthWrite=!0,this.cull=l.CULL_NONE,this.blend=l.BLEND_ENABLE_ALL,this.srcBlend=l.BLENDPARAM_SRC_ALPHA,this.dstBlend=l.BLENDPARAM_ONE,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case l.RENDERMODE_DEPTHREAD_TRANSPARENT:this.renderQueue=i.TRANSPARENT,this.depthWrite=!1,this.cull=l.CULL_BACK,this.blend=l.BLEND_ENABLE_ALL,this.srcBlend=l.BLENDPARAM_SRC_ALPHA,this.dstBlend=l.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case l.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE:this.renderQueue=i.TRANSPARENT,this.depthWrite=!1,this.cull=l.CULL_NONE,this.blend=l.BLEND_ENABLE_ALL,this.srcBlend=l.BLENDPARAM_SRC_ALPHA,this.dstBlend=l.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case l.RENDERMODE_DEPTHREAD_ADDTIVE:this.renderQueue=i.TRANSPARENT,this.depthWrite=!1,this.cull=l.CULL_BACK,this.blend=l.BLEND_ENABLE_ALL,this.srcBlend=l.BLENDPARAM_SRC_ALPHA,this.dstBlend=l.BLENDPARAM_ONE,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case l.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE:this.renderQueue=i.TRANSPARENT,this.depthWrite=!1,this.cull=l.CULL_NONE,this.blend=l.BLEND_ENABLE_ALL,this.srcBlend=l.BLENDPARAM_SRC_ALPHA,this.dstBlend=l.BLENDPARAM_ONE,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case l.RENDERMODE_NONDEPTH_TRANSPARENT:this.renderQueue=i.TRANSPARENT,this.depthTest=l.DEPTHTEST_LESS,this.cull=l.CULL_BACK,this.blend=l.BLEND_ENABLE_ALL,this.srcBlend=l.BLENDPARAM_SRC_ALPHA,this.dstBlend=l.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case l.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE:this.renderQueue=i.TRANSPARENT,this.depthTest=l.DEPTHTEST_LESS,this.cull=l.CULL_NONE,this.blend=l.BLEND_ENABLE_ALL,this.srcBlend=l.BLENDPARAM_SRC_ALPHA,this.dstBlend=l.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case l.RENDERMODE_NONDEPTH_ADDTIVE:this.renderQueue=i.TRANSPARENT,this.depthTest=l.DEPTHTEST_LESS,this.cull=l.CULL_BACK,this.blend=l.BLEND_ENABLE_ALL,this.srcBlend=l.BLENDPARAM_SRC_ALPHA,this.dstBlend=l.BLENDPARAM_ONE,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case l.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE:this.renderQueue=i.TRANSPARENT,this.depthTest=l.DEPTHTEST_LESS,this.cull=l.CULL_NONE,this.blend=l.BLEND_ENABLE_ALL,this.srcBlend=l.BLENDPARAM_SRC_ALPHA,this.dstBlend=l.BLENDPARAM_ONE,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"tintColor",{get:function(){return this._getColor(l.TINTCOLOR)},set:function(t){t?this._addShaderDefine(l.SHADERDEFINE_TINTCOLOR):this._removeShaderDefine(l.SHADERDEFINE_TINTCOLOR),this._setColor(l.TINTCOLOR,t)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"tilingOffset",{get:function(){return this._getColor(l.TILINGOFFSET)},set:function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(l.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(l.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(l.SHADERDEFINE_TILINGOFFSET);this._setColor(l.TILINGOFFSET,t)},enumerable:!0,configurable:!0}),l.prototype.getBendOffset=function(){return this._getColor(l.BENDANGLE)},l.prototype.setBendOffset=function(t){this._setColor(l.BENDANGLE,t)},l.prototype.setBendDistance=function(t){this._setNumber(l.BENDDISTANCE,t)},Object.defineProperty(l.prototype,"diffuseTexture",{get:function(){return this._getTexture(l.DIFFUSETEXTURE)},set:function(t){t?this._addShaderDefine(l.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(l.SHADERDEFINE_DIFFUSEMAP),this._setTexture(l.DIFFUSETEXTURE,t)},enumerable:!0,configurable:!0}),l._parseShurikenParticleMaterial=function(t,e,i){var n=i.customProps,r=n.diffuseTexture.texture2D;r&&(e.diffuseTexture=Loader.getRes(t[r]));var a=n.tintColor;a&&(e.tintColor=new s(a[0],a[1],a[2],a[3]))},l.prototype.onAsynLoaded=function(t,e,i){var n=e[0];if(n.version)o.prototype.onAsynLoaded.call(this,t,e,i);else{var r=e[1],a=n.props;for(var s in a)this[s]=a[s];l._parseShurikenParticleMaterial(r,this,n),this._endLoaded()}},l.prototype.initShader1=function(){if(!l.isInit){l.isInit=!0;var t={u_Tintcolor:[2,1],u_TilingOffset:[3,1],u_texture:[1,1],_QOffset:[l.BENDANGLE,Laya.Shader3D.PERIOD_MATERIAL],_Dist:[l.BENDDISTANCE,Laya.Shader3D.PERIOD_MATERIAL],u_WorldPosition:[0,2],u_WorldRotation:[1,2],u_PositionScale:[4,2],u_SizeScale:[5,2],u_ScalingMode:[6,2],u_Gravity:[7,2],u_ThreeDStartRotation:[8,2],u_StretchedBillboardLengthScale:[9,2],u_StretchedBillboardSpeedScale:[10,2],u_SimulationSpace:[11,2],u_CurrentTime:[12,2],u_ColorOverLifeGradientAlphas:[22,2],u_ColorOverLifeGradientColors:[23,2],u_MaxColorOverLifeGradientAlphas:[24,2],u_MaxColorOverLifeGradientColors:[25,2],u_VOLVelocityConst:[13,2],u_VOLVelocityGradientX:[14,2],u_VOLVelocityGradientY:[15,2],u_VOLVelocityGradientZ:[16,2],u_VOLVelocityConstMax:[17,2],u_VOLVelocityGradientMaxX:[18,2],u_VOLVelocityGradientMaxY:[19,2],u_VOLVelocityGradientMaxZ:[20,2],u_VOLSpaceType:[21,2],u_SOLSizeGradient:[26,2],u_SOLSizeGradientX:[27,2],u_SOLSizeGradientY:[28,2],u_SOLSizeGradientZ:[29,2],u_SOLSizeGradientMax:[30,2],u_SOLSizeGradientMaxX:[31,2],u_SOLSizeGradientMaxY:[32,2],u_SOLSizeGradientMaxZ:[33,2],u_ROLAngularVelocityConst:[34,2],u_ROLAngularVelocityConstSeprarate:[35,2],u_ROLAngularVelocityGradient:[36,2],u_ROLAngularVelocityGradientX:[37,2],u_ROLAngularVelocityGradientY:[38,2],u_ROLAngularVelocityGradientZ:[39,2],u_ROLAngularVelocityGradientW:[40,2],u_ROLAngularVelocityConstMax:[41,2],u_ROLAngularVelocityConstMaxSeprarate:[42,2],u_ROLAngularVelocityGradientMax:[43,2],u_ROLAngularVelocityGradientMaxX:[44,2],u_ROLAngularVelocityGradientMaxY:[45,2],u_ROLAngularVelocityGradientMaxZ:[46,2],u_ROLAngularVelocityGradientMaxW:[47,2],u_TSACycles:[48,2],u_TSASubUVLength:[49,2],u_TSAGradientUVs:[50,2],u_TSAMaxGradientUVs:[51,2],u_CameraPosition:[0,3],u_CameraDirection:[5,3],u_CameraUp:[6,3],u_View:[1,3],u_Projection:[2,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4]},e=Laya.Shader3D.nameKey.add("PARTICLESHURIKENEXP");"#ifdef HIGHPRECISION\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\n#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\n\tattribute vec4 a_CornerTextureCoordinate;\n#endif\n#ifdef RENDERMODE_MESH\n\tattribute vec3 a_MeshPosition;\n\tattribute vec4 a_MeshColor;\n\tattribute vec2 a_MeshTextureCoordinate;\n\tvarying vec4 v_MeshColor;\n#endif\n\nattribute vec4 a_ShapePositionStartLifeTime;\nattribute vec4 a_DirectionTime;\nattribute vec4 a_StartColor;\nattribute vec3 a_StartSize;\nattribute vec3 a_StartRotation0;\nattribute float a_StartSpeed;\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n  attribute vec4 a_Random0;\n#endif\n#if defined(TEXTURESHEETANIMATIONRANDOMCURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  attribute vec4 a_Random1;\n#endif\nattribute vec3 a_SimulationWorldPostion;\nattribute vec4 a_SimulationWorldRotation;\n\nvarying float v_Discard;\nvarying vec4 v_Color;\n#ifdef DIFFUSEMAP\n\tvarying vec2 v_TextureCoordinate;\n#endif\n\nuniform float u_CurrentTime;\nuniform vec3 u_Gravity;\n\nuniform vec3 u_WorldPosition;\nuniform vec4 u_WorldRotation;\nuniform bool u_ThreeDStartRotation;\nuniform int u_ScalingMode;\nuniform vec3 u_PositionScale;\nuniform vec3 u_SizeScale;\nuniform mat4 u_View;\nuniform mat4 u_Projection;\n\n#ifdef STRETCHEDBILLBOARD\n\tuniform vec3 u_CameraPosition;\n#endif\nuniform vec3 u_CameraDirection;//TODO:只有几种广告牌模式需要用\nuniform vec3 u_CameraUp;\n\nuniform  float u_StretchedBillboardLengthScale;\nuniform  float u_StretchedBillboardSpeedScale;\nuniform int u_SimulationSpace;\n\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  uniform  int  u_VOLSpaceType;\n#endif\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)\n  uniform  vec3 u_VOLVelocityConst;\n#endif\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  uniform  vec2 u_VOLVelocityGradientX[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientY[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientZ[4];//x为key,y为速度\n#endif\n#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n  uniform  vec3 u_VOLVelocityConstMax;\n#endif\n#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n  uniform  vec2 u_VOLVelocityGradientMaxX[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientMaxY[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientMaxZ[4];//x为key,y为速度\n#endif\n\n#ifdef COLOROVERLIFETIME\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n#endif\n#ifdef RANDOMCOLOROVERLIFETIME\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n  uniform  vec4 u_MaxColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_MaxColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n#endif\n\n\n#if defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMERANDOMCURVES)\n  uniform  vec2 u_SOLSizeGradient[4];//x为key,y为尺寸\n#endif\n#ifdef SIZEOVERLIFETIMERANDOMCURVES\n  uniform  vec2 u_SOLSizeGradientMax[4];//x为key,y为尺寸\n#endif\n#if defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\n  uniform  vec2 u_SOLSizeGradientX[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientY[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientZ[4];//x为key,y为尺寸\n#endif\n#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n  uniform  vec2 u_SOLSizeGradientMaxX[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientMaxY[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientMaxZ[4];//x为key,y为尺寸\n#endif\n\n\n#ifdef ROTATIONOVERLIFETIME\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\n    uniform  float u_ROLAngularVelocityConst;\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n    uniform  float u_ROLAngularVelocityConstMax;\n  #endif\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n    uniform  vec2 u_ROLAngularVelocityGradient[4];//x为key,y为旋转\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n    uniform  vec2 u_ROLAngularVelocityGradientMax[4];//x为key,y为旋转\n  #endif\n#endif\n#ifdef ROTATIONOVERLIFETIMESEPERATE\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\n    uniform  vec3 u_ROLAngularVelocityConstSeprarate;\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n    uniform  vec3 u_ROLAngularVelocityConstMaxSeprarate;\n  #endif\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n    uniform  vec2 u_ROLAngularVelocityGradientX[4];\n    uniform  vec2 u_ROLAngularVelocityGradientY[4];\n    uniform  vec2 u_ROLAngularVelocityGradientZ[4];\n\tuniform  vec2 u_ROLAngularVelocityGradientW[4];\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n    uniform  vec2 u_ROLAngularVelocityGradientMaxX[4];\n    uniform  vec2 u_ROLAngularVelocityGradientMaxY[4];\n    uniform  vec2 u_ROLAngularVelocityGradientMaxZ[4];\n\tuniform  vec2 u_ROLAngularVelocityGradientMaxW[4];\n  #endif\n#endif\n\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\n  uniform  float u_TSACycles;\n  uniform  vec2 u_TSASubUVLength;\n  uniform  vec2 u_TSAGradientUVs[4];//x为key,y为frame\n#endif\n#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\n  uniform  vec2 u_TSAMaxGradientUVs[4];//x为key,y为frame\n#endif\n\n#ifdef FOG\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\nuniform vec4 _QOffset;\nuniform float _Dist;\n\nvec3 rotationByEuler(in vec3 vector,in vec3 rot)\n{\n\tfloat halfRoll = rot.z * 0.5;\n    float halfPitch = rot.x * 0.5;\n\tfloat halfYaw = rot.y * 0.5;\n\n\tfloat sinRoll = sin(halfRoll);\n\tfloat cosRoll = cos(halfRoll);\n\tfloat sinPitch = sin(halfPitch);\n\tfloat cosPitch = cos(halfPitch);\n\tfloat sinYaw = sin(halfYaw);\n\tfloat cosYaw = cos(halfYaw);\n\n\tfloat quaX = (cosYaw * sinPitch * cosRoll) + (sinYaw * cosPitch * sinRoll);\n\tfloat quaY = (sinYaw * cosPitch * cosRoll) - (cosYaw * sinPitch * sinRoll);\n\tfloat quaZ = (cosYaw * cosPitch * sinRoll) - (sinYaw * sinPitch * cosRoll);\n\tfloat quaW = (cosYaw * cosPitch * cosRoll) + (sinYaw * sinPitch * sinRoll);\n\t\n\t//vec4 q=vec4(quaX,quaY,quaZ,quaW);\n\t//vec3 temp = cross(q.xyz, vector) + q.w * vector;\n\t//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\n\t\n\tfloat x = quaX + quaX;\n    float y = quaY + quaY;\n    float z = quaZ + quaZ;\n    float wx = quaW * x;\n    float wy = quaW * y;\n    float wz = quaW * z;\n\tfloat xx = quaX * x;\n    float xy = quaX * y;\n\tfloat xz = quaX * z;\n    float yy = quaY * y;\n    float yz = quaY * z;\n    float zz = quaZ * z;\n\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\n\t\n}\n\n//假定axis已经归一化\nvec3 rotationByAxis(in vec3 vector,in vec3 axis, in float angle)\n{\n\tfloat halfAngle = angle * 0.5;\n\tfloat sin = sin(halfAngle);\n\t\n\tfloat quaX = axis.x * sin;\n\tfloat quaY = axis.y * sin;\n\tfloat quaZ = axis.z * sin;\n\tfloat quaW = cos(halfAngle);\n\t\n\t//vec4 q=vec4(quaX,quaY,quaZ,quaW);\n\t//vec3 temp = cross(q.xyz, vector) + q.w * vector;\n\t//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\n\t\n\tfloat x = quaX + quaX;\n    float y = quaY + quaY;\n    float z = quaZ + quaZ;\n    float wx = quaW * x;\n    float wy = quaW * y;\n    float wz = quaW * z;\n\tfloat xx = quaX * x;\n    float xy = quaX * y;\n\tfloat xz = quaX * z;\n    float yy = quaY * y;\n    float yz = quaY * z;\n    float zz = quaZ * z;\n\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\n\t\n}\n\nvec3 rotationByQuaternions(in vec3 v,in vec4 q) \n{\n\treturn v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n}\n\n \n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\nfloat getCurValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\n{\n\tfloat curValue;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientNumber=gradientNumbers[i];\n\t\tfloat key=gradientNumber.x;\n\t\tif(key>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientNumber=gradientNumbers[i-1];\n\t\t\tfloat lastKey=lastGradientNumber.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\tcurValue=mix(lastGradientNumber.y,gradientNumber.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn curValue;\n}\n#endif\n\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\nfloat getTotalValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\n{\n\tfloat totalValue=0.0;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientNumber=gradientNumbers[i];\n\t\tfloat key=gradientNumber.x;\n\t\tvec2 lastGradientNumber=gradientNumbers[i-1];\n\t\tfloat lastValue=lastGradientNumber.y;\n\t\t\n\t\tif(key>=normalizedAge){\n\t\t\tfloat lastKey=lastGradientNumber.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\ttotalValue+=(lastValue+mix(lastValue,gradientNumber.y,age))/2.0*a_ShapePositionStartLifeTime.w*(normalizedAge-lastKey);\n\t\t\tbreak;\n\t\t}\n\t\telse{\n\t\t\ttotalValue+=(lastValue+gradientNumber.y)/2.0*a_ShapePositionStartLifeTime.w*(key-lastGradientNumber.x);\n\t\t}\n\t}\n\treturn totalValue;\n}\n#endif\n\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)\nvec4 getColorFromGradient(in vec2 gradientAlphas[4],in vec4 gradientColors[4],in float normalizedAge)\n{\n\tvec4 overTimeColor;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientAlpha=gradientAlphas[i];\n\t\tfloat alphaKey=gradientAlpha.x;\n\t\tif(alphaKey>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientAlpha=gradientAlphas[i-1];\n\t\t\tfloat lastAlphaKey=lastGradientAlpha.x;\n\t\t\tfloat age=(normalizedAge-lastAlphaKey)/(alphaKey-lastAlphaKey);\n\t\t\toverTimeColor.a=mix(lastGradientAlpha.y,gradientAlpha.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\t\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec4 gradientColor=gradientColors[i];\n\t\tfloat colorKey=gradientColor.x;\n\t\tif(colorKey>=normalizedAge)\n\t\t{\n\t\t\tvec4 lastGradientColor=gradientColors[i-1];\n\t\t\tfloat lastColorKey=lastGradientColor.x;\n\t\t\tfloat age=(normalizedAge-lastColorKey)/(colorKey-lastColorKey);\n\t\t\toverTimeColor.rgb=mix(gradientColors[i-1].yzw,gradientColor.yzw,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn overTimeColor;\n}\n#endif\n\n\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\nfloat getFrameFromGradient(in vec2 gradientFrames[4],in float normalizedAge)\n{\n\tfloat overTimeFrame;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientFrame=gradientFrames[i];\n\t\tfloat key=gradientFrame.x;\n\t\tif(key>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientFrame=gradientFrames[i-1];\n\t\t\tfloat lastKey=lastGradientFrame.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\toverTimeFrame=mix(lastGradientFrame.y,gradientFrame.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn floor(overTimeFrame);\n}\n#endif\n\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\nvec3 computeParticleLifeVelocity(in float normalizedAge)\n{\n  vec3 outLifeVelocity;\n  #ifdef VELOCITYOVERLIFETIMECONSTANT\n\t outLifeVelocity=u_VOLVelocityConst; \n  #endif\n  #ifdef VELOCITYOVERLIFETIMECURVE\n     outLifeVelocity= vec3(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\n  #endif\n  #ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n\t outLifeVelocity=mix(u_VOLVelocityConst,u_VOLVelocityConstMax,vec3(a_Random1.y,a_Random1.z,a_Random1.w)); \n  #endif\n  #ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n     outLifeVelocity=vec3(mix(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y),\n\t                 mix(getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z),\n\t\t\t\t\t mix(getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\n  #endif\n\t\t\t\t\t\n  return outLifeVelocity;\n} \n#endif\n\nvec3 computeParticlePosition(in vec3 startVelocity, in vec3 lifeVelocity,in float age,in float normalizedAge,vec3 gravityVelocity,vec4 worldRotation)\n{\n   vec3 startPosition;\n   vec3 lifePosition;\n   #if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t#ifdef VELOCITYOVERLIFETIMECONSTANT\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=lifeVelocity*age;\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMECURVE\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=vec3(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=lifeVelocity*age;\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=vec3(mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y)\n\t      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z)\n\t      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\n\t#endif\n\t\n\tvec3 finalPosition;\n\tif(u_VOLSpaceType==0){\n\t  if(u_ScalingMode!=2)\n\t   finalPosition =rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition),worldRotation);\n\t  else\n\t   finalPosition =rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition,worldRotation);\n\t}\n\telse{\n\t  if(u_ScalingMode!=2)\n\t    finalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation)+lifePosition;\n\t  else\n\t    finalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation)+lifePosition;\n\t}\n  #else\n\t startPosition=startVelocity*age;\n\t vec3 finalPosition;\n\t if(u_ScalingMode!=2)\n\t   finalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation);\n\t else\n\t   finalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation);\n  #endif\n  \n  if(u_SimulationSpace==0)\n    finalPosition=finalPosition+a_SimulationWorldPostion;\n  else if(u_SimulationSpace==1) \n    finalPosition=finalPosition+u_WorldPosition;\n  \n  finalPosition+=0.5*gravityVelocity*age;\n \n  return  finalPosition;\n}\n\n\nvec4 computeParticleColor(in vec4 color,in float normalizedAge)\n{\n\t#ifdef COLOROVERLIFETIME\n\t  color*=getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge);\n\t#endif\n\t\n\t#ifdef RANDOMCOLOROVERLIFETIME\n\t  color*=mix(getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge),getColorFromGradient(u_MaxColorOverLifeGradientAlphas,u_MaxColorOverLifeGradientColors,normalizedAge),a_Random0.y);\n\t#endif\n\n    return color;\n}\n\nvec2 computeParticleSizeBillbard(in vec2 size,in float normalizedAge)\n{\n\t#ifdef SIZEOVERLIFETIMECURVE\n\t\tsize*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVES\n\t    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \n\t#endif\n\t#ifdef SIZEOVERLIFETIMECURVESEPERATE\n\t\tsize*=vec2(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge));\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n\t    size*=vec2(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\n\t    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z));\n\t#endif\n\treturn size;\n}\n\n#ifdef RENDERMODE_MESH\nvec3 computeParticleSizeMesh(in vec3 size,in float normalizedAge)\n{\n\t#ifdef SIZEOVERLIFETIMECURVE\n\t\tsize*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVES\n\t    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \n\t#endif\n\t#ifdef SIZEOVERLIFETIMECURVESEPERATE\n\t\tsize*=vec3(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge));\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n\t    size*=vec3(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\n\t    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z)\n\t\t,mix(getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxZ,normalizedAge),a_Random0.z));\n\t#endif\n\treturn size;\n}\n#endif\n\nfloat computeParticleRotationFloat(in float rotation,in float age,in float normalizedAge)\n{ \n\t#ifdef ROTATIONOVERLIFETIME\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConst*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\n\t\t#endif\n\t#endif\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConstSeprarate.z*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConstSeprarate.z,u_ROLAngularVelocityConstMaxSeprarate.z,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\n\t\t#endif\n\t#endif\n\treturn rotation;\n}\n\n\n#if defined(RENDERMODE_MESH)&&(defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE))\nvec3 computeParticleRotationVec3(in vec3 rotation,in float age,in float normalizedAge)\n{ \n\t#ifdef ROTATIONOVERLIFETIME\n\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConst*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\n\t\t#endif\n\t#endif\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tvec3 ageRot=u_ROLAngularVelocityConstSeprarate*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=vec3(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge));\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tvec3 ageRot=mix(u_ROLAngularVelocityConstSeprarate,u_ROLAngularVelocityConstMaxSeprarate,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=vec3(mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxX,normalizedAge),a_Random0.w)\n\t        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxY,normalizedAge),a_Random0.w)\n\t        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\n\t\t#endif\n\t#endif\n\treturn rotation;\n}\n#endif\n\nvec2 computeParticleUV(in vec2 uv,in float normalizedAge)\n{ \n\t#ifdef TEXTURESHEETANIMATIONCURVE\n\t\tfloat cycleNormalizedAge=normalizedAge*u_TSACycles;\n\t\tfloat frame=getFrameFromGradient(u_TSAGradientUVs,cycleNormalizedAge-floor(cycleNormalizedAge));\n\t\tfloat totalULength=frame*u_TSASubUVLength.x;\n\t\tfloat floorTotalULength=floor(totalULength);\n\t    uv.x+=totalULength-floorTotalULength;\n\t\tuv.y+=floorTotalULength*u_TSASubUVLength.y;\n    #endif\n\t#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\n\t\tfloat cycleNormalizedAge=normalizedAge*u_TSACycles;\n\t\tfloat uvNormalizedAge=cycleNormalizedAge-floor(cycleNormalizedAge);\n\t    float frame=floor(mix(getFrameFromGradient(u_TSAGradientUVs,uvNormalizedAge),getFrameFromGradient(u_TSAMaxGradientUVs,uvNormalizedAge),a_Random1.x));\n\t\tfloat totalULength=frame*u_TSASubUVLength.x;\n\t\tfloat floorTotalULength=floor(totalULength);\n\t    uv.x+=totalULength-floorTotalULength;\n\t\tuv.y+=floorTotalULength*u_TSASubUVLength.y;\n    #endif\n\treturn uv;\n}\n\nvoid main()\n{\n\tfloat age = u_CurrentTime - a_DirectionTime.w;\n\tfloat normalizedAge = age/a_ShapePositionStartLifeTime.w;\n\tvec3 lifeVelocity;\n\tif(normalizedAge<1.0){ \n\tvec3 startVelocity=a_DirectionTime.xyz*a_StartSpeed;\n\t#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t\tlifeVelocity= computeParticleLifeVelocity(normalizedAge);//计算粒子生命周期速度\n\t#endif \n\tvec3 gravityVelocity=u_Gravity*age;\n\t\n\tvec4 worldRotation;\n\tif(u_SimulationSpace==0)\n\t\tworldRotation=a_SimulationWorldRotation;\n\telse\n\t\tworldRotation=u_WorldRotation;\n\t\n\tvec3 center=computeParticlePosition(startVelocity, lifeVelocity, age, normalizedAge,gravityVelocity,worldRotation);//计算粒子位置\n   \n   \n   #ifdef SPHERHBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        vec3 cameraUpVector =normalize(u_CameraUp);//TODO:是否外面归一化\n        vec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\n        vec3 upVector = normalize(cross(sideVector,u_CameraDirection));\n\t    corner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tvec3 rotation=vec3(a_StartRotation0.xy,computeParticleRotationFloat(a_StartRotation0.z,age,normalizedAge));\n\t\t\t\tcenter += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,rotation);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\t\tfloat c = cos(rot);\n\t\t\t\tfloat s = sin(rot);\n\t\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\t\tcorner=rotation*corner;\n\t\t\t\tcenter += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\n\t\t\t}\n\t\t#else\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tcenter += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,a_StartRotation0);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tfloat c = cos(a_StartRotation0.x);\n\t\t\t\tfloat s = sin(a_StartRotation0.x);\n\t\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\t\tcorner=rotation*corner;\n\t\t\t\tcenter += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\n\t\t\t}\n\t\t#endif\n   #endif\n   \n   #ifdef STRETCHEDBILLBOARD\n\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n\tvec3 velocity;\n\t#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t    if(u_VOLSpaceType==0)\n\t\t  velocity=rotationByQuaternions(u_SizeScale*(startVelocity+lifeVelocity),worldRotation)+gravityVelocity;\n\t    else\n\t\t  velocity=rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+lifeVelocity+gravityVelocity;\n    #else\n\t    velocity= rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+gravityVelocity;\n    #endif\t\n\t\tvec3 cameraUpVector = normalize(velocity);\n\t\tvec3 direction = normalize(center-u_CameraPosition);\n        vec3 sideVector = normalize(cross(direction,normalize(velocity)));\n\t\t\n\t\tsideVector=u_SizeScale.xzy*sideVector;\n\t\tcameraUpVector=length(vec3(u_SizeScale.x,0.0,0.0))*cameraUpVector;\n\t\t\n\t    vec2 size=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t\n\t    const mat2 rotaionZHalfPI=mat2(0.0, -1.0, 1.0, 0.0);\n\t    corner=rotaionZHalfPI*corner;\n\t    corner.y=corner.y-abs(corner.y);\n\t\t\n\t    float speed=length(velocity);//TODO:\n\t    center +=sign(u_SizeScale.x)*(sign(u_StretchedBillboardLengthScale)*size.x*corner.x*sideVector+(speed*u_StretchedBillboardSpeedScale+size.y*u_StretchedBillboardLengthScale)*corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef HORIZONTALBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        const vec3 cameraUpVector=vec3(0.0,0.0,1.0);\n\t    const vec3 sideVector = vec3(-1.0,0.0,0.0);\n\t\t\n\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n        float c = cos(rot);\n        float s = sin(rot);\n        mat2 rotation= mat2(c, -s, s, c);\n\t    corner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\n\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n        center +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef VERTICALBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        const vec3 cameraUpVector =vec3(0.0,1.0,0.0);\n        vec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\n\t\t\n\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n        float c = cos(rot);\n        float s = sin(rot);\n        mat2 rotation= mat2(c, -s, s, c);\n\t    corner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\n\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n        center +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef RENDERMODE_MESH\n\t    vec3 size=computeParticleSizeMesh(a_StartSize,normalizedAge);\n\t\t#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tvec3 rotation=vec3(a_StartRotation0.xy,-computeParticleRotationFloat(a_StartRotation0.z, age,normalizedAge));\n\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,rotation),worldRotation);\n\t\t\t}\n\t\t\telse{\n\t\t\t\t#ifdef ROTATIONOVERLIFETIME\n\t\t\t\t\tfloat angle=computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\t\t\tif(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\n\t\t\t\t\t\tcenter+= (rotationByQuaternions(rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),angle),worldRotation));//已验证\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\t#ifdef SHAPE\n\t\t\t\t\t\t\tcenter+= u_SizeScale.xzy*(rotationByQuaternions(rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),angle),worldRotation));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\t\tcenter+=rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle);//已验证\n\t\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\t\tcenter+=rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle),worldRotation);//已验证\n\t\t\t\t\t\t#endif\n\t\t\t\t\t}\n\t\t\t\t#endif\n\t\t\t\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t\t\t\t//TODO:是否应合并if(u_ThreeDStartRotation)分支代码,待测试\n\t\t\t\t\tvec3 angle=computeParticleRotationVec3(vec3(0.0,0.0,a_StartRotation0.z), age,normalizedAge);\n\t\t\t\t\tcenter+= (rotationByQuaternions(rotationByEuler(u_SizeScale*a_MeshPosition*size,vec3(angle.x,angle.y,angle.z)),worldRotation));//已验证\n\t\t\t\t#endif\t\n\t\t\t}\n\t\t#else\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,a_StartRotation0),worldRotation);//已验证\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\n\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\tcenter+= rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x);\n\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\tcenter+= (rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x),worldRotation));//已验证\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\t#ifdef SHAPE\n\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\tcenter+= u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x);\n\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x),worldRotation);\t\n\t\t\t\t\t#else\n\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\tcenter+= rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x);\n\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x),worldRotation);//已验证\n\t\t\t\t\t#endif\n\t\t\t\t}\n\t\t\t}\n\t\t#endif\n\t\tv_MeshColor=a_MeshColor;\n   #endif\n\n    highp vec4 vPos = u_Projection*u_View*vec4(center,1.0);\n\tfloat zOff = vPos.z / _Dist;\n\tvPos += _QOffset * zOff * zOff;\n    gl_Position = vPos;\n    v_Color = computeParticleColor(a_StartColor, normalizedAge);\n\t#ifdef DIFFUSEMAP\n\t\t#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\n\t\t\tv_TextureCoordinate =computeParticleUV(a_CornerTextureCoordinate.zw, normalizedAge);\n\t\t#endif\n\t\t#ifdef RENDERMODE_MESH\n\t\t\tv_TextureCoordinate =computeParticleUV(a_MeshTextureCoordinate, normalizedAge);\n\t\t#endif\n\t\t\n\t\t#ifdef TILINGOFFSET\n\t\t\tv_TextureCoordinate=vec2(v_TextureCoordinate.x,1.0-v_TextureCoordinate.y)*u_TilingOffset.xy+vec2(u_TilingOffset.z,-u_TilingOffset.w);//需要特殊处理\n\t\t\tv_TextureCoordinate=vec2(v_TextureCoordinate.x,1.0-v_TextureCoordinate.y);//需要特殊处理\n\t\t#endif\n\t#endif\n    v_Discard=0.0;\n\t  \n\t#ifdef FOG\n\t\tv_PositionWorld=center;\n\t#endif\n   }\n   else\n\t{\n\t\tv_Discard=1.0;\n\t}\n}\n\n","#ifdef HIGHPRECISION\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\nvarying float v_Discard;\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\nuniform sampler2D u_texture;\nuniform vec4 u_Tintcolor;\n\n#ifdef RENDERMODE_MESH\n\tvarying vec4 v_MeshColor;\n#endif\n\n#ifdef FOG\n\tvarying vec3 v_PositionWorld;\n\tuniform vec3 u_CameraPosition;\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\nvoid main()\n{\t\n\t#ifdef RENDERMODE_MESH\n\t\tgl_FragColor=v_MeshColor;\n\t#else\n\t\tgl_FragColor=vec4(1.0);\t\n\t#endif\n\t\t\n\t#ifdef DIFFUSEMAP\n\t\tif(v_Discard!=0.0)\n\t\t\tdiscard;\n\t\t#ifdef TINTCOLOR\n\t\t\tgl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*u_Tintcolor*2.0*v_Color;\n\t\t#else\n\t\t\tgl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*v_Color;\n\t\t#endif\n\t#else\n\t\t#ifdef TINTCOLOR\n\t\t\tgl_FragColor*=u_Tintcolor*2.0*v_Color;\n\t\t#else\n\t\t\tgl_FragColor*=v_Color;\n\t\t#endif\n\t#endif\n\t\n\t#ifdef FOG\n\t\tvec3 toEye=u_CameraPosition-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t\t\n\t\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t\t#endif\n\t#endif\n}";var i=n.add(e,"#ifdef HIGHPRECISION\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\n#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\n\tattribute vec4 a_CornerTextureCoordinate;\n#endif\n#ifdef RENDERMODE_MESH\n\tattribute vec3 a_MeshPosition;\n\tattribute vec4 a_MeshColor;\n\tattribute vec2 a_MeshTextureCoordinate;\n\tvarying vec4 v_MeshColor;\n#endif\n\nattribute vec4 a_ShapePositionStartLifeTime;\nattribute vec4 a_DirectionTime;\nattribute vec4 a_StartColor;\nattribute vec3 a_StartSize;\nattribute vec3 a_StartRotation0;\nattribute float a_StartSpeed;\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n  attribute vec4 a_Random0;\n#endif\n#if defined(TEXTURESHEETANIMATIONRANDOMCURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  attribute vec4 a_Random1;\n#endif\nattribute vec3 a_SimulationWorldPostion;\nattribute vec4 a_SimulationWorldRotation;\n\nvarying float v_Discard;\nvarying vec4 v_Color;\n#ifdef DIFFUSEMAP\n\tvarying vec2 v_TextureCoordinate;\n#endif\n\nuniform float u_CurrentTime;\nuniform vec3 u_Gravity;\n\nuniform vec3 u_WorldPosition;\nuniform vec4 u_WorldRotation;\nuniform bool u_ThreeDStartRotation;\nuniform int u_ScalingMode;\nuniform vec3 u_PositionScale;\nuniform vec3 u_SizeScale;\nuniform mat4 u_View;\nuniform mat4 u_Projection;\n\n#ifdef STRETCHEDBILLBOARD\n\tuniform vec3 u_CameraPosition;\n#endif\nuniform vec3 u_CameraDirection;//TODO:只有几种广告牌模式需要用\nuniform vec3 u_CameraUp;\n\nuniform  float u_StretchedBillboardLengthScale;\nuniform  float u_StretchedBillboardSpeedScale;\nuniform int u_SimulationSpace;\n\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  uniform  int  u_VOLSpaceType;\n#endif\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)\n  uniform  vec3 u_VOLVelocityConst;\n#endif\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  uniform  vec2 u_VOLVelocityGradientX[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientY[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientZ[4];//x为key,y为速度\n#endif\n#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n  uniform  vec3 u_VOLVelocityConstMax;\n#endif\n#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n  uniform  vec2 u_VOLVelocityGradientMaxX[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientMaxY[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientMaxZ[4];//x为key,y为速度\n#endif\n\n#ifdef COLOROVERLIFETIME\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n#endif\n#ifdef RANDOMCOLOROVERLIFETIME\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n  uniform  vec4 u_MaxColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_MaxColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n#endif\n\n\n#if defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMERANDOMCURVES)\n  uniform  vec2 u_SOLSizeGradient[4];//x为key,y为尺寸\n#endif\n#ifdef SIZEOVERLIFETIMERANDOMCURVES\n  uniform  vec2 u_SOLSizeGradientMax[4];//x为key,y为尺寸\n#endif\n#if defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\n  uniform  vec2 u_SOLSizeGradientX[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientY[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientZ[4];//x为key,y为尺寸\n#endif\n#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n  uniform  vec2 u_SOLSizeGradientMaxX[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientMaxY[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientMaxZ[4];//x为key,y为尺寸\n#endif\n\n\n#ifdef ROTATIONOVERLIFETIME\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\n    uniform  float u_ROLAngularVelocityConst;\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n    uniform  float u_ROLAngularVelocityConstMax;\n  #endif\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n    uniform  vec2 u_ROLAngularVelocityGradient[4];//x为key,y为旋转\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n    uniform  vec2 u_ROLAngularVelocityGradientMax[4];//x为key,y为旋转\n  #endif\n#endif\n#ifdef ROTATIONOVERLIFETIMESEPERATE\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\n    uniform  vec3 u_ROLAngularVelocityConstSeprarate;\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n    uniform  vec3 u_ROLAngularVelocityConstMaxSeprarate;\n  #endif\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n    uniform  vec2 u_ROLAngularVelocityGradientX[4];\n    uniform  vec2 u_ROLAngularVelocityGradientY[4];\n    uniform  vec2 u_ROLAngularVelocityGradientZ[4];\n\tuniform  vec2 u_ROLAngularVelocityGradientW[4];\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n    uniform  vec2 u_ROLAngularVelocityGradientMaxX[4];\n    uniform  vec2 u_ROLAngularVelocityGradientMaxY[4];\n    uniform  vec2 u_ROLAngularVelocityGradientMaxZ[4];\n\tuniform  vec2 u_ROLAngularVelocityGradientMaxW[4];\n  #endif\n#endif\n\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\n  uniform  float u_TSACycles;\n  uniform  vec2 u_TSASubUVLength;\n  uniform  vec2 u_TSAGradientUVs[4];//x为key,y为frame\n#endif\n#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\n  uniform  vec2 u_TSAMaxGradientUVs[4];//x为key,y为frame\n#endif\n\n#ifdef FOG\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\nuniform vec4 _QOffset;\nuniform float _Dist;\n\nvec3 rotationByEuler(in vec3 vector,in vec3 rot)\n{\n\tfloat halfRoll = rot.z * 0.5;\n    float halfPitch = rot.x * 0.5;\n\tfloat halfYaw = rot.y * 0.5;\n\n\tfloat sinRoll = sin(halfRoll);\n\tfloat cosRoll = cos(halfRoll);\n\tfloat sinPitch = sin(halfPitch);\n\tfloat cosPitch = cos(halfPitch);\n\tfloat sinYaw = sin(halfYaw);\n\tfloat cosYaw = cos(halfYaw);\n\n\tfloat quaX = (cosYaw * sinPitch * cosRoll) + (sinYaw * cosPitch * sinRoll);\n\tfloat quaY = (sinYaw * cosPitch * cosRoll) - (cosYaw * sinPitch * sinRoll);\n\tfloat quaZ = (cosYaw * cosPitch * sinRoll) - (sinYaw * sinPitch * cosRoll);\n\tfloat quaW = (cosYaw * cosPitch * cosRoll) + (sinYaw * sinPitch * sinRoll);\n\t\n\t//vec4 q=vec4(quaX,quaY,quaZ,quaW);\n\t//vec3 temp = cross(q.xyz, vector) + q.w * vector;\n\t//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\n\t\n\tfloat x = quaX + quaX;\n    float y = quaY + quaY;\n    float z = quaZ + quaZ;\n    float wx = quaW * x;\n    float wy = quaW * y;\n    float wz = quaW * z;\n\tfloat xx = quaX * x;\n    float xy = quaX * y;\n\tfloat xz = quaX * z;\n    float yy = quaY * y;\n    float yz = quaY * z;\n    float zz = quaZ * z;\n\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\n\t\n}\n\n//假定axis已经归一化\nvec3 rotationByAxis(in vec3 vector,in vec3 axis, in float angle)\n{\n\tfloat halfAngle = angle * 0.5;\n\tfloat sin = sin(halfAngle);\n\t\n\tfloat quaX = axis.x * sin;\n\tfloat quaY = axis.y * sin;\n\tfloat quaZ = axis.z * sin;\n\tfloat quaW = cos(halfAngle);\n\t\n\t//vec4 q=vec4(quaX,quaY,quaZ,quaW);\n\t//vec3 temp = cross(q.xyz, vector) + q.w * vector;\n\t//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\n\t\n\tfloat x = quaX + quaX;\n    float y = quaY + quaY;\n    float z = quaZ + quaZ;\n    float wx = quaW * x;\n    float wy = quaW * y;\n    float wz = quaW * z;\n\tfloat xx = quaX * x;\n    float xy = quaX * y;\n\tfloat xz = quaX * z;\n    float yy = quaY * y;\n    float yz = quaY * z;\n    float zz = quaZ * z;\n\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\n\t\n}\n\nvec3 rotationByQuaternions(in vec3 v,in vec4 q) \n{\n\treturn v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n}\n\n \n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\nfloat getCurValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\n{\n\tfloat curValue;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientNumber=gradientNumbers[i];\n\t\tfloat key=gradientNumber.x;\n\t\tif(key>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientNumber=gradientNumbers[i-1];\n\t\t\tfloat lastKey=lastGradientNumber.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\tcurValue=mix(lastGradientNumber.y,gradientNumber.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn curValue;\n}\n#endif\n\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\nfloat getTotalValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\n{\n\tfloat totalValue=0.0;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientNumber=gradientNumbers[i];\n\t\tfloat key=gradientNumber.x;\n\t\tvec2 lastGradientNumber=gradientNumbers[i-1];\n\t\tfloat lastValue=lastGradientNumber.y;\n\t\t\n\t\tif(key>=normalizedAge){\n\t\t\tfloat lastKey=lastGradientNumber.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\ttotalValue+=(lastValue+mix(lastValue,gradientNumber.y,age))/2.0*a_ShapePositionStartLifeTime.w*(normalizedAge-lastKey);\n\t\t\tbreak;\n\t\t}\n\t\telse{\n\t\t\ttotalValue+=(lastValue+gradientNumber.y)/2.0*a_ShapePositionStartLifeTime.w*(key-lastGradientNumber.x);\n\t\t}\n\t}\n\treturn totalValue;\n}\n#endif\n\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)\nvec4 getColorFromGradient(in vec2 gradientAlphas[4],in vec4 gradientColors[4],in float normalizedAge)\n{\n\tvec4 overTimeColor;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientAlpha=gradientAlphas[i];\n\t\tfloat alphaKey=gradientAlpha.x;\n\t\tif(alphaKey>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientAlpha=gradientAlphas[i-1];\n\t\t\tfloat lastAlphaKey=lastGradientAlpha.x;\n\t\t\tfloat age=(normalizedAge-lastAlphaKey)/(alphaKey-lastAlphaKey);\n\t\t\toverTimeColor.a=mix(lastGradientAlpha.y,gradientAlpha.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\t\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec4 gradientColor=gradientColors[i];\n\t\tfloat colorKey=gradientColor.x;\n\t\tif(colorKey>=normalizedAge)\n\t\t{\n\t\t\tvec4 lastGradientColor=gradientColors[i-1];\n\t\t\tfloat lastColorKey=lastGradientColor.x;\n\t\t\tfloat age=(normalizedAge-lastColorKey)/(colorKey-lastColorKey);\n\t\t\toverTimeColor.rgb=mix(gradientColors[i-1].yzw,gradientColor.yzw,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn overTimeColor;\n}\n#endif\n\n\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\nfloat getFrameFromGradient(in vec2 gradientFrames[4],in float normalizedAge)\n{\n\tfloat overTimeFrame;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientFrame=gradientFrames[i];\n\t\tfloat key=gradientFrame.x;\n\t\tif(key>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientFrame=gradientFrames[i-1];\n\t\t\tfloat lastKey=lastGradientFrame.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\toverTimeFrame=mix(lastGradientFrame.y,gradientFrame.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn floor(overTimeFrame);\n}\n#endif\n\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\nvec3 computeParticleLifeVelocity(in float normalizedAge)\n{\n  vec3 outLifeVelocity;\n  #ifdef VELOCITYOVERLIFETIMECONSTANT\n\t outLifeVelocity=u_VOLVelocityConst; \n  #endif\n  #ifdef VELOCITYOVERLIFETIMECURVE\n     outLifeVelocity= vec3(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\n  #endif\n  #ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n\t outLifeVelocity=mix(u_VOLVelocityConst,u_VOLVelocityConstMax,vec3(a_Random1.y,a_Random1.z,a_Random1.w)); \n  #endif\n  #ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n     outLifeVelocity=vec3(mix(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y),\n\t                 mix(getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z),\n\t\t\t\t\t mix(getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\n  #endif\n\t\t\t\t\t\n  return outLifeVelocity;\n} \n#endif\n\nvec3 computeParticlePosition(in vec3 startVelocity, in vec3 lifeVelocity,in float age,in float normalizedAge,vec3 gravityVelocity,vec4 worldRotation)\n{\n   vec3 startPosition;\n   vec3 lifePosition;\n   #if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t#ifdef VELOCITYOVERLIFETIMECONSTANT\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=lifeVelocity*age;\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMECURVE\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=vec3(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=lifeVelocity*age;\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=vec3(mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y)\n\t      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z)\n\t      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\n\t#endif\n\t\n\tvec3 finalPosition;\n\tif(u_VOLSpaceType==0){\n\t  if(u_ScalingMode!=2)\n\t   finalPosition =rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition),worldRotation);\n\t  else\n\t   finalPosition =rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition,worldRotation);\n\t}\n\telse{\n\t  if(u_ScalingMode!=2)\n\t    finalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation)+lifePosition;\n\t  else\n\t    finalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation)+lifePosition;\n\t}\n  #else\n\t startPosition=startVelocity*age;\n\t vec3 finalPosition;\n\t if(u_ScalingMode!=2)\n\t   finalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation);\n\t else\n\t   finalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation);\n  #endif\n  \n  if(u_SimulationSpace==0)\n    finalPosition=finalPosition+a_SimulationWorldPostion;\n  else if(u_SimulationSpace==1) \n    finalPosition=finalPosition+u_WorldPosition;\n  \n  finalPosition+=0.5*gravityVelocity*age;\n \n  return  finalPosition;\n}\n\n\nvec4 computeParticleColor(in vec4 color,in float normalizedAge)\n{\n\t#ifdef COLOROVERLIFETIME\n\t  color*=getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge);\n\t#endif\n\t\n\t#ifdef RANDOMCOLOROVERLIFETIME\n\t  color*=mix(getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge),getColorFromGradient(u_MaxColorOverLifeGradientAlphas,u_MaxColorOverLifeGradientColors,normalizedAge),a_Random0.y);\n\t#endif\n\n    return color;\n}\n\nvec2 computeParticleSizeBillbard(in vec2 size,in float normalizedAge)\n{\n\t#ifdef SIZEOVERLIFETIMECURVE\n\t\tsize*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVES\n\t    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \n\t#endif\n\t#ifdef SIZEOVERLIFETIMECURVESEPERATE\n\t\tsize*=vec2(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge));\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n\t    size*=vec2(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\n\t    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z));\n\t#endif\n\treturn size;\n}\n\n#ifdef RENDERMODE_MESH\nvec3 computeParticleSizeMesh(in vec3 size,in float normalizedAge)\n{\n\t#ifdef SIZEOVERLIFETIMECURVE\n\t\tsize*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVES\n\t    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \n\t#endif\n\t#ifdef SIZEOVERLIFETIMECURVESEPERATE\n\t\tsize*=vec3(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge));\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n\t    size*=vec3(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\n\t    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z)\n\t\t,mix(getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxZ,normalizedAge),a_Random0.z));\n\t#endif\n\treturn size;\n}\n#endif\n\nfloat computeParticleRotationFloat(in float rotation,in float age,in float normalizedAge)\n{ \n\t#ifdef ROTATIONOVERLIFETIME\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConst*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\n\t\t#endif\n\t#endif\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConstSeprarate.z*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConstSeprarate.z,u_ROLAngularVelocityConstMaxSeprarate.z,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\n\t\t#endif\n\t#endif\n\treturn rotation;\n}\n\n\n#if defined(RENDERMODE_MESH)&&(defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE))\nvec3 computeParticleRotationVec3(in vec3 rotation,in float age,in float normalizedAge)\n{ \n\t#ifdef ROTATIONOVERLIFETIME\n\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConst*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\n\t\t#endif\n\t#endif\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tvec3 ageRot=u_ROLAngularVelocityConstSeprarate*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=vec3(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge));\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tvec3 ageRot=mix(u_ROLAngularVelocityConstSeprarate,u_ROLAngularVelocityConstMaxSeprarate,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=vec3(mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxX,normalizedAge),a_Random0.w)\n\t        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxY,normalizedAge),a_Random0.w)\n\t        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\n\t\t#endif\n\t#endif\n\treturn rotation;\n}\n#endif\n\nvec2 computeParticleUV(in vec2 uv,in float normalizedAge)\n{ \n\t#ifdef TEXTURESHEETANIMATIONCURVE\n\t\tfloat cycleNormalizedAge=normalizedAge*u_TSACycles;\n\t\tfloat frame=getFrameFromGradient(u_TSAGradientUVs,cycleNormalizedAge-floor(cycleNormalizedAge));\n\t\tfloat totalULength=frame*u_TSASubUVLength.x;\n\t\tfloat floorTotalULength=floor(totalULength);\n\t    uv.x+=totalULength-floorTotalULength;\n\t\tuv.y+=floorTotalULength*u_TSASubUVLength.y;\n    #endif\n\t#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\n\t\tfloat cycleNormalizedAge=normalizedAge*u_TSACycles;\n\t\tfloat uvNormalizedAge=cycleNormalizedAge-floor(cycleNormalizedAge);\n\t    float frame=floor(mix(getFrameFromGradient(u_TSAGradientUVs,uvNormalizedAge),getFrameFromGradient(u_TSAMaxGradientUVs,uvNormalizedAge),a_Random1.x));\n\t\tfloat totalULength=frame*u_TSASubUVLength.x;\n\t\tfloat floorTotalULength=floor(totalULength);\n\t    uv.x+=totalULength-floorTotalULength;\n\t\tuv.y+=floorTotalULength*u_TSASubUVLength.y;\n    #endif\n\treturn uv;\n}\n\nvoid main()\n{\n\tfloat age = u_CurrentTime - a_DirectionTime.w;\n\tfloat normalizedAge = age/a_ShapePositionStartLifeTime.w;\n\tvec3 lifeVelocity;\n\tif(normalizedAge<1.0){ \n\tvec3 startVelocity=a_DirectionTime.xyz*a_StartSpeed;\n\t#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t\tlifeVelocity= computeParticleLifeVelocity(normalizedAge);//计算粒子生命周期速度\n\t#endif \n\tvec3 gravityVelocity=u_Gravity*age;\n\t\n\tvec4 worldRotation;\n\tif(u_SimulationSpace==0)\n\t\tworldRotation=a_SimulationWorldRotation;\n\telse\n\t\tworldRotation=u_WorldRotation;\n\t\n\tvec3 center=computeParticlePosition(startVelocity, lifeVelocity, age, normalizedAge,gravityVelocity,worldRotation);//计算粒子位置\n   \n   \n   #ifdef SPHERHBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        vec3 cameraUpVector =normalize(u_CameraUp);//TODO:是否外面归一化\n        vec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\n        vec3 upVector = normalize(cross(sideVector,u_CameraDirection));\n\t    corner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tvec3 rotation=vec3(a_StartRotation0.xy,computeParticleRotationFloat(a_StartRotation0.z,age,normalizedAge));\n\t\t\t\tcenter += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,rotation);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\t\tfloat c = cos(rot);\n\t\t\t\tfloat s = sin(rot);\n\t\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\t\tcorner=rotation*corner;\n\t\t\t\tcenter += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\n\t\t\t}\n\t\t#else\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tcenter += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,a_StartRotation0);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tfloat c = cos(a_StartRotation0.x);\n\t\t\t\tfloat s = sin(a_StartRotation0.x);\n\t\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\t\tcorner=rotation*corner;\n\t\t\t\tcenter += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\n\t\t\t}\n\t\t#endif\n   #endif\n   \n   #ifdef STRETCHEDBILLBOARD\n\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n\tvec3 velocity;\n\t#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t    if(u_VOLSpaceType==0)\n\t\t  velocity=rotationByQuaternions(u_SizeScale*(startVelocity+lifeVelocity),worldRotation)+gravityVelocity;\n\t    else\n\t\t  velocity=rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+lifeVelocity+gravityVelocity;\n    #else\n\t    velocity= rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+gravityVelocity;\n    #endif\t\n\t\tvec3 cameraUpVector = normalize(velocity);\n\t\tvec3 direction = normalize(center-u_CameraPosition);\n        vec3 sideVector = normalize(cross(direction,normalize(velocity)));\n\t\t\n\t\tsideVector=u_SizeScale.xzy*sideVector;\n\t\tcameraUpVector=length(vec3(u_SizeScale.x,0.0,0.0))*cameraUpVector;\n\t\t\n\t    vec2 size=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t\n\t    const mat2 rotaionZHalfPI=mat2(0.0, -1.0, 1.0, 0.0);\n\t    corner=rotaionZHalfPI*corner;\n\t    corner.y=corner.y-abs(corner.y);\n\t\t\n\t    float speed=length(velocity);//TODO:\n\t    center +=sign(u_SizeScale.x)*(sign(u_StretchedBillboardLengthScale)*size.x*corner.x*sideVector+(speed*u_StretchedBillboardSpeedScale+size.y*u_StretchedBillboardLengthScale)*corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef HORIZONTALBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        const vec3 cameraUpVector=vec3(0.0,0.0,1.0);\n\t    const vec3 sideVector = vec3(-1.0,0.0,0.0);\n\t\t\n\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n        float c = cos(rot);\n        float s = sin(rot);\n        mat2 rotation= mat2(c, -s, s, c);\n\t    corner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\n\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n        center +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef VERTICALBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        const vec3 cameraUpVector =vec3(0.0,1.0,0.0);\n        vec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\n\t\t\n\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n        float c = cos(rot);\n        float s = sin(rot);\n        mat2 rotation= mat2(c, -s, s, c);\n\t    corner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\n\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n        center +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef RENDERMODE_MESH\n\t    vec3 size=computeParticleSizeMesh(a_StartSize,normalizedAge);\n\t\t#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tvec3 rotation=vec3(a_StartRotation0.xy,-computeParticleRotationFloat(a_StartRotation0.z, age,normalizedAge));\n\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,rotation),worldRotation);\n\t\t\t}\n\t\t\telse{\n\t\t\t\t#ifdef ROTATIONOVERLIFETIME\n\t\t\t\t\tfloat angle=computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\t\t\tif(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\n\t\t\t\t\t\tcenter+= (rotationByQuaternions(rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),angle),worldRotation));//已验证\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\t#ifdef SHAPE\n\t\t\t\t\t\t\tcenter+= u_SizeScale.xzy*(rotationByQuaternions(rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),angle),worldRotation));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\t\tcenter+=rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle);//已验证\n\t\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\t\tcenter+=rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle),worldRotation);//已验证\n\t\t\t\t\t\t#endif\n\t\t\t\t\t}\n\t\t\t\t#endif\n\t\t\t\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t\t\t\t//TODO:是否应合并if(u_ThreeDStartRotation)分支代码,待测试\n\t\t\t\t\tvec3 angle=computeParticleRotationVec3(vec3(0.0,0.0,a_StartRotation0.z), age,normalizedAge);\n\t\t\t\t\tcenter+= (rotationByQuaternions(rotationByEuler(u_SizeScale*a_MeshPosition*size,vec3(angle.x,angle.y,angle.z)),worldRotation));//已验证\n\t\t\t\t#endif\t\n\t\t\t}\n\t\t#else\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,a_StartRotation0),worldRotation);//已验证\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\n\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\tcenter+= rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x);\n\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\tcenter+= (rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x),worldRotation));//已验证\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\t#ifdef SHAPE\n\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\tcenter+= u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x);\n\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x),worldRotation);\t\n\t\t\t\t\t#else\n\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\tcenter+= rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x);\n\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x),worldRotation);//已验证\n\t\t\t\t\t#endif\n\t\t\t\t}\n\t\t\t}\n\t\t#endif\n\t\tv_MeshColor=a_MeshColor;\n   #endif\n\n    highp vec4 vPos = u_Projection*u_View*vec4(center,1.0);\n\tfloat zOff = vPos.z / _Dist;\n\tvPos += _QOffset * zOff * zOff;\n    gl_Position = vPos;\n    v_Color = computeParticleColor(a_StartColor, normalizedAge);\n\t#ifdef DIFFUSEMAP\n\t\t#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\n\t\t\tv_TextureCoordinate =computeParticleUV(a_CornerTextureCoordinate.zw, normalizedAge);\n\t\t#endif\n\t\t#ifdef RENDERMODE_MESH\n\t\t\tv_TextureCoordinate =computeParticleUV(a_MeshTextureCoordinate, normalizedAge);\n\t\t#endif\n\t\t\n\t\t#ifdef TILINGOFFSET\n\t\t\tv_TextureCoordinate=vec2(v_TextureCoordinate.x,1.0-v_TextureCoordinate.y)*u_TilingOffset.xy+vec2(u_TilingOffset.z,-u_TilingOffset.w);//需要特殊处理\n\t\t\tv_TextureCoordinate=vec2(v_TextureCoordinate.x,1.0-v_TextureCoordinate.y);//需要特殊处理\n\t\t#endif\n\t#endif\n    v_Discard=0.0;\n\t  \n\t#ifdef FOG\n\t\tv_PositionWorld=center;\n\t#endif\n   }\n   else\n\t{\n\t\tv_Discard=1.0;\n\t}\n}\n\n","#ifdef HIGHPRECISION\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\nvarying float v_Discard;\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\nuniform sampler2D u_texture;\nuniform vec4 u_Tintcolor;\n\n#ifdef RENDERMODE_MESH\n\tvarying vec4 v_MeshColor;\n#endif\n\n#ifdef FOG\n\tvarying vec3 v_PositionWorld;\n\tuniform vec3 u_CameraPosition;\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\nvoid main()\n{\t\n\t#ifdef RENDERMODE_MESH\n\t\tgl_FragColor=v_MeshColor;\n\t#else\n\t\tgl_FragColor=vec4(1.0);\t\n\t#endif\n\t\t\n\t#ifdef DIFFUSEMAP\n\t\tif(v_Discard!=0.0)\n\t\t\tdiscard;\n\t\t#ifdef TINTCOLOR\n\t\t\tgl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*u_Tintcolor*2.0*v_Color;\n\t\t#else\n\t\t\tgl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*v_Color;\n\t\t#endif\n\t#else\n\t\t#ifdef TINTCOLOR\n\t\t\tgl_FragColor*=u_Tintcolor*2.0*v_Color;\n\t\t#else\n\t\t\tgl_FragColor*=v_Color;\n\t\t#endif\n\t#endif\n\t\n\t#ifdef FOG\n\t\tvec3 toEye=u_CameraPosition-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t\t\n\t\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t\t#endif\n\t#endif\n}",{a_CornerTextureCoordinate:17,a_MeshPosition:0,a_MeshColor:1,a_MeshTextureCoordinate:2,a_ShapePositionStartLifeTime:30,a_DirectionTime:32,a_StartColor:19,a_EndColor:23,a_StartSize:20,a_StartRotation0:22,a_StartSpeed:31,a_Random0:34,a_Random1:35,a_SimulationWorldPostion:36,a_SimulationWorldRotation:37},t);l.SHADERDEFINE_DIFFUSEMAP=i.registerMaterialDefine("DIFFUSEMAP"),l.SHADERDEFINE_TINTCOLOR=i.registerMaterialDefine("TINTCOLOR"),l.SHADERDEFINE_ADDTIVEFOG=i.registerMaterialDefine("ADDTIVEFOG"),l.SHADERDEFINE_TILINGOFFSET=i.registerMaterialDefine("TILINGOFFSET"),h.SHADERDEFINE_RENDERMODE_BILLBOARD=i.registerSpriteDefine("SPHERHBILLBOARD"),h.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD=i.registerSpriteDefine("STRETCHEDBILLBOARD"),h.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD=i.registerSpriteDefine("HORIZONTALBILLBOARD"),h.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD=i.registerSpriteDefine("VERTICALBILLBOARD"),h.SHADERDEFINE_COLOROVERLIFETIME=i.registerSpriteDefine("COLOROVERLIFETIME"),h.SHADERDEFINE_RANDOMCOLOROVERLIFETIME=i.registerSpriteDefine("RANDOMCOLOROVERLIFETIME"),h.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT=i.registerSpriteDefine("VELOCITYOVERLIFETIMECONSTANT"),h.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE=i.registerSpriteDefine("VELOCITYOVERLIFETIMECURVE"),h.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT=i.registerSpriteDefine("VELOCITYOVERLIFETIMERANDOMCONSTANT"),h.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE=i.registerSpriteDefine("VELOCITYOVERLIFETIMERANDOMCURVE"),h.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE=i.registerSpriteDefine("TEXTURESHEETANIMATIONCURVE"),h.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE=i.registerSpriteDefine("TEXTURESHEETANIMATIONRANDOMCURVE"),h.SHADERDEFINE_ROTATIONOVERLIFETIME=i.registerSpriteDefine("ROTATIONOVERLIFETIME"),h.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE=i.registerSpriteDefine("ROTATIONOVERLIFETIMESEPERATE"),h.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT=i.registerSpriteDefine("ROTATIONOVERLIFETIMECONSTANT"),h.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE=i.registerSpriteDefine("ROTATIONOVERLIFETIMECURVE"),h.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS=i.registerSpriteDefine("ROTATIONOVERLIFETIMERANDOMCONSTANTS"),h.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES=i.registerSpriteDefine("ROTATIONOVERLIFETIMERANDOMCURVES"),h.SHADERDEFINE_SIZEOVERLIFETIMECURVE=i.registerSpriteDefine("SIZEOVERLIFETIMECURVE"),h.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE=i.registerSpriteDefine("SIZEOVERLIFETIMECURVESEPERATE"),h.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES=i.registerSpriteDefine("SIZEOVERLIFETIMERANDOMCURVES"),h.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE=i.registerSpriteDefine("SIZEOVERLIFETIMERANDOMCURVESSEPERATE"),h.SHADERDEFINE_RENDERMODE_MESH=i.registerSpriteDefine("RENDERMODE_MESH"),h.SHADERDEFINE_SHAPE=i.registerSpriteDefine("SHAPE")}},l}(a)).RENDERMODE_OPAQUE=1,o.RENDERMODE_OPAQUEDOUBLEFACE=2,o.RENDERMODE_CUTOUT=3,o.RENDERMODE_CUTOUTDOUBLEFACE=4,o.RENDERMODE_TRANSPARENT=13,o.RENDERMODE_TRANSPARENTDOUBLEFACE=14,o.RENDERMODE_ADDTIVE=15,o.RENDERMODE_ADDTIVEDOUBLEFACE=16,o.RENDERMODE_DEPTHREAD_TRANSPARENT=5,o.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,o.RENDERMODE_DEPTHREAD_ADDTIVE=7,o.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,o.RENDERMODE_NONDEPTH_TRANSPARENT=9,o.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,o.RENDERMODE_NONDEPTH_ADDTIVE=11,o.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,o.DIFFUSETEXTURE=1,o.TINTCOLOR=2,o.TILINGOFFSET=3,o.BENDANGLE=4,o.BENDDISTANCE=5,o.defaultMaterial=new o,o.shaderDefines=new r(a.shaderDefines),o.isInit=!1,e.ShurikenParticleMaterialExp=o}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(c){var t=function(u){function s(t){var e=u.call(this,t,c.Path.scene)||this;e._curStatus=0,e._curSore=0,e.isDebug=!1,e.bendTimes=[1e4,1e4,7e3,1e4,11500,1e4,11500,1e4],e.curBendTime=0,e.dstIndex=0,e.changeTime=2e3,e.curBendAngle=new Laya.Vector4,e.robots=new Array,e._backGroundPos=new Vector3,e._jiasuDiffPlayer=new Vector3,e._tempColor=new Vector4,e._tempColor1=new Vector3,e._tempBuilder=new Vector4,e._isPlayJaSu=!1,e._v=300,e.mouse_X=0,e.changeColorTime=0,e.PlayScore=0,e._isShareLibao=!1,e.mouseEnabled=!0;var i=new Laya.Vector4(-e._v,0,0,0),n=new Laya.Vector4(e._v,0,0,0),r=new Laya.Vector4(0,e._v,0,0),a=new Laya.Vector4(0,-0,0,0),s=new Laya.Vector4(-e._v,e._v,0,0),o=new Laya.Vector4(e._v,e._v,0,0),l=new Laya.Vector4(-e._v,-0,0,0),h=new Laya.Vector4(e._v,-0,0,0);return e.dstAangles=[i,n,r,a,s,l,o,h],e._builderLayer=new Laya.Sprite3D,e._obstacleLayer=new Laya.Sprite3D,e._playerLayer=new Laya.Sprite3D,e._mapLayer=new Laya.Sprite3D,e._glitterLayer=new Laya.Sprite3D,e._shadowLayer=new Laya.Sprite3D,e._colorHelp=new c.scene.Color(0,255,2),e._colorBuilder=new c.scene.Color(64,127,.5),e}return __extends(s,u),Object.defineProperty(s.prototype,"eventDispatcher",{get:function(){return this._eventDispatcher||(this._eventDispatcher=new Laya.EventDispatcher),this._eventDispatcher},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"mainPlayer",{get:function(){return this._mainPlayer},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"cameraRoot",{get:function(){return this._cameraRoot},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"roadMgr",{get:function(){return this._roadMgr||(this._roadMgr=new RoadMgr(this,this._app)),this._roadMgr},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"mapLayer",{get:function(){return this._mapLayer},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"obstacleLayer",{get:function(){return this._obstacleLayer},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"builderLayer",{get:function(){return this._builderLayer},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"glitterLayer",{get:function(){return this._glitterLayer},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"shadowLayer",{get:function(){return this._shadowLayer},enumerable:!0,configurable:!0}),s.prototype.onMouseHandler=function(t){if((WXTool._state==s.STATUS_START||WXTool._state==s.STATUS_RELIFE)&&(t.type==LEvent.MOUSE_DOWN&&(this.mouse_X=Laya.stage.mouseX),t.type==LEvent.MOUSE_MOVE&&0!=this.mouse_X)){var e=Laya.stage.mouseX-this.mouse_X;this.mouse_X=Laya.stage.mouseX,this.mainPlayer.playerScript.playerMove(e/this.width)}},s.prototype.resize=function(t,e){this.size(t,e),this._scene&&this._scene.size(t,e)},s.prototype.enterScene=function(){0<WXTool._state||(WXTool._state=s.STATUS_LOAD,this.dispose(),u.prototype.enterScene.call(this))},s.prototype.putBackEffectTuoWei=function(){this._mainPlayer&&this._mainPlayer.playerScript&&this._mainPlayer.playerScript.putBackEffectTuoWei()},s.prototype.hide=function(){this.putBackEffectTuoWei(),u.prototype.hide.call(this)},s.prototype.initScene=function(){if(this._scene&&this._scene.loaded){this.show(),this._colorHelp.init(88,186,219),this._colorBuilder.init(86,110.5,118.75),this.scene.addChild(this._mapLayer),this.scene.addChild(this._builderLayer),this.scene.addChild(this._obstacleLayer),this.scene.addChild(this._playerLayer),this.scene.addChild(this._shadowLayer),this.scene.addChild(this._glitterLayer),this._scene.enableFog=!0,this._scene.fogColor=new Laya.Vector3(.77,.82,.93),this._scene.fogStart=-1,this._scene.fogRange=11,Config.isAntialias=!0,this.camera||(this.camera=this._scene.getChildByName("Main Camera")),this.camera.clearFlag=Laya.BaseCamera.CLEARFLAG_SOLIDCOLOR,this.camera.clearColor=new Laya.Vector4(.77,.82,.93),this._cameraRoot=this.camera.addComponent(CameraMove),this._cameraRoot.init(this),this.directionLight||(this.directionLight=this._scene.getChildByName("Directional Light")),this._backGround=this._scene.getChildByName("Plane");var t=this._scene.getChildByName("assert");t&&(t.active=!1);var e=this._scene.getChildByName("effect");if(e.active=!1,EffectMgr.addEffect("jiansu0",e.getChildByName("jiansu0")),EffectMgr.addEffect("jiansu1",e.getChildByName("jiansu1")),EffectMgr.addEffect("wudi",e.getChildByName("wudi")),EffectMgr.addEffect("wudi1",e.getChildByName("wudi1")),!this._mainPlayer){var i=this._scene.getChildByName("Player");this._playClone=i.clone(),this._mainPlayer=new PlayerMeshSprite3D,this._mainPlayer.init(this,i),this._mainPlayer.rigidbodyEnable=!0,this._mainPlayer.boxColliderEnable=!0,this.cameraRoot.distancePlayer=i.transform.position.z-this.camera.transform.position.z}this._mainPlayer.playerScript.init(this._app,!0),this._backGround&&(this._backGroundDiffP=this._backGround.transform.position.z-this._playClone.transform.position.z,this._backGround.transform.position.cloneTo(this._backGroundPos)),this.speedEffect=this._scene.getChildByName("jiasu"),Vector3.subtract(this.speedEffect.transform.position,this._playClone.transform.position,this._jiasuDiffPlayer),WXTool._state=s.STATUS_LOADED,this._roadMgr&&(this._tempColor.x=this._colorHelp.r/255,this._tempColor.y=this._colorHelp.g/255,this._tempColor.z=this._colorHelp.b/255,this._tempBuilder.x=this._colorBuilder.r/255,this._tempBuilder.y=this._colorBuilder.g/255,this._tempBuilder.z=this._colorBuilder.b/255,this.roadMgr.init(this._tempColor,this._tempBuilder));for(var n=0;n<0;n++){var r=new RobotMeshSprite3D,a=this._playClone.clone();this.scene.addChild(a),r.init(this,a),r.rigidbodyEnable=!0,r.boxColliderEnable=!0,r.robotScript.init(this._app,!1),this.robots.push(r)}}},s.prototype.test=function(){var t=this;this._colorHelp.init(88,186,219),this._colorBuilder.init(86,110.5,118.75),this._isPlayJaSu=!1,this.speedEffect.particleSystem.looping=!1,this.speedEffect.particleSystem.stop(),this.mouse_X=0,this._cameraRoot.reset(),this.roadMgr.reset(),this.mainPlayer.playerScript.reset(),WXTool.reliveCount++,console.log("复活 WXTool._state",WXTool._state),this._roadMgr&&(this._tempColor.x=this._colorHelp.r/255,this._tempColor.y=this._colorHelp.g/255,this._tempColor.z=this._colorHelp.b/255,this._tempBuilder.x=this._colorBuilder.r/255,this._tempBuilder.y=this._colorBuilder.g/255,this._tempBuilder.z=this._colorBuilder.b/255,this.roadMgr.init(this._tempColor,this._tempBuilder)),Laya.timer.once(100,this,this.readyGo),Laya.timer.once(3e3,this,function(){t._app.sceneRoot.mainPlayer.playerScript.isWuDi=!1}),this.resetRobotPos()},s.prototype.readyGo=function(t){void 0===t&&(t=!1),Laya.SoundManager.soundMuted=!1,console.log("2WXTool._state",WXTool._state),WXTool._state==s.STATUS_END?WXTool._state=s.STATUS_RELIFE:WXTool._state=s.STATUS_START;var e=this._app.plyertDataMgr.getTimeGame();if(e=parseInt(e)+1,this._app.plyertDataMgr.updateTimesGame(e),console.log("3WXTool._state",WXTool._state),this.PlayScore=WXTool.score?WXTool.score:0,PlayerDataMgr.isPlayBgMusic){var i=Laya.SoundManager.playMusic("scene/music/bgm_low.mp3");console.log("播放背景音乐==",i)}this.resetRobotPos(),this._app.uiRoot.general.open(PageDef.YOUXI_PAGE)},s.prototype.resetRobotPos=function(){for(var t=0;t<this.robots.length;t++)this.robots[t].robotScript.diff_z=this.mainPlayer.playerScript.diff_z+3*Math.floor(t/2+1),this.robots[t].robotScript._desDiffX=this.robots[t].robotScript._moveDiffX=t%2==0?.3:-.3},s.prototype.onUpdate=function(t){if(WXTool._state,WXTool._state==s.STATUS_START||WXTool._state==s.STATUS_RELIFE){this.changeColorTime-=t;this._app.uiRoot.general.getPage(PageDef.YOUXI_PAGE);this.changeColorTime<0&&(this._colorHelp.updateColor(),this._tempColor1.x=this._tempColor.x=this._colorHelp.r/255,this._tempColor1.y=this._tempColor.y=this._colorHelp.g/255,this._tempColor1.z=this._tempColor.z=this._colorHelp.b/255,this._colorBuilder.updateColor(),this._tempBuilder.x=this._colorBuilder.r/255,this._tempBuilder.y=this._colorBuilder.g/255,this._tempBuilder.z=this._colorBuilder.b/255,this.changeColorTime=100),this.curBendTime+=1*Laya.timer.delta,this.curBendTime>=this.changeTime&&(this.dstIndex=this.RandBlendIndex(this.dstIndex),this.changeTime=this.bendTimes[this.dstIndex],this.curBendTime=0);var e=this.curBendTime/this.changeTime,i=this.dstAangles[this.dstIndex];Laya.Vector4.lerp(this.curBendAngle,i,e/20,this.curBendAngle),this._roadMgr&&this.roadMgr.update(t,this.curBendAngle,this._tempColor,this._tempBuilder),this._mainPlayer&&this._mainPlayer.playerScript.Update(t,this.curBendAngle),this._cameraRoot&&this._cameraRoot.Update(t);for(var n=void 0,r=0;r<this.robots.length;r++)(n=this.robots[r].robotScript).Update(t,this.curBendAngle),n.diff_z+10<this.mainPlayer.playerScript.diff_z&&n.randStartPos(),n.diff_z<this.mainPlayer.playerScript.diff_z&&!n.isPass&&(n.isPass=!0,this._curSore++),n.diff_z>this.mainPlayer.playerScript.diff_z&&n.isPass&&(n.isPass=!1,this._curSore--);this._backGround&&(this._backGroundPos.z=this.mainPlayer.playerScript.diff_z+this._backGroundDiffP,this._backGround.transform.position=this._backGroundPos),this.speedEffect&&(this.speedEffect.transform.position.z=this.mainPlayer.playerScript.diff_z+this._jiasuDiffPlayer.z,this.speedEffect.transform.position=this.speedEffect.transform.position,this.speedEffect&&this.speedEffect.particleRender.material instanceof c.scene.ShurikenParticleMaterialExp&&this.speedEffect.particleRender.material.setBendOffset(this.curBendAngle),this.mainPlayer.playerScript.speed_Z>PlayerBaseScript.baseSpeed+PlayerBaseScript.baseSpeed/2?this._isPlayJaSu||(this._isPlayJaSu=!0,this.speedEffect.particleSystem.looping=!0,this.speedEffect.particleSystem.play()):this._isPlayJaSu&&(this.speedEffect.particleSystem.looping=!1,this.speedEffect.particleSystem.stop(),this._isPlayJaSu=!1))}},s.prototype.getBeiNum=function(t){var e;switch(t){case 0:e=1;break;case 1:e=2;break;case 2:e=3;break;case 3:e=4;break;case 4:default:e=5}return e},s.prototype.RandBlendIndex=function(t){for(var e;(e=Math.floor(Math.random()*this.dstAangles.length))==t;);return e},s.prototype.gameEnd=function(){var e=this;if(WXTool._state!=s.STATUS_OVER&&WXTool._state!=s.STATUS_END){this._app.plyertDataMgr.setIsUseLuckySkin(0),this._colorHelp.init(88,186,219),this._colorBuilder.init(86,110.5,118.75),console.log("1WXTool._state",WXTool._state),WXTool._state==s.STATUS_START?WXTool._state=s.STATUS_END:WXTool._state==s.STATUS_RELIFE&&(WXTool._state=s.STATUS_OVER),2<=WXTool.reliveCount&&(WXTool._state=s.STATUS_OVER),console.log("WXTool._state",WXTool._state);var t=this._app.sceneRoot.PlayScore.toFixed(0);if(this._app.uploadGrade(Math.floor(t),1),4<=WXTool.reliveCount){var i=this._app.uiRoot.general.getPage(PageDef.FUHUO_PAGE);i&&i.isOpened&&i.close(),this._app.uiRoot.general.open(PageDef.RESULT_RANK)}else this._app.uiRoot.general.open(PageDef.RESTART_PAGE,function(t){t.getScore(e.getScore())});Laya.SoundManager.stopMusic(),PlayerDataMgr.isPlayActionMusic&&Laya.SoundManager.playSound("scene/music/gameover.mp3"),PlayerDataMgr.isZhenDong&&WXTool.vibrateLong(),this._app.uiRoot.general.close(PageDef.YOUXI_PAGE)}},s.prototype.isGamePlay=function(){return WXTool._state==s.STATUS_START||WXTool._state==s.STATUS_RELIFE},s.prototype.getScore=function(){return this._curSore<0?0:this._curSore},s.prototype.getAvatar=function(t){for(var e=SkinConfig.getInstance().datas,i=null,n=0;n<e.length;n++)if(e[n].id==t){i=e[n];break}return i},s.prototype.reset=function(){WXTool.is_relive=!1,this._colorHelp.init(88,186,219),this._colorBuilder.init(86,110.5,118.75);var t=this.getAvatar(this._app.plyertDataMgr.getUseObstacleSkinIndex());this.obstacleSkin=t&&t.avatar?t.avatar:"heibai",WXTool.score=0,this._app.uiRoot.general.close(PageDef.YOUXI_PAGE),this._curSore=0,WXTool.reliveCount=0,WXTool._state=s.STATUS_LOADED,this._isPlayJaSu=!1,this.speedEffect.particleSystem.looping=!1,this.speedEffect.particleSystem.stop(),this.mouse_X=0,this._cameraRoot.reset(),this.roadMgr.reset(),this.mainPlayer.playerScript.reset(),this._isShareLibao=!1,this._roadMgr&&(console.log("死亡重置"),this._tempColor.x=this._colorHelp.r/255,this._tempColor.y=this._colorHelp.g/255,this._tempColor.z=this._colorHelp.b/255,this._tempBuilder.x=this._colorBuilder.r/255,this._tempBuilder.y=this._colorBuilder.g/255,this._tempBuilder.z=this._colorBuilder.b/255,this.roadMgr.init(this._tempColor,this._tempBuilder)),Laya.timer.once(100,this,this.readyGo),this.resetRobotPos()},s.prototype.resetScene=function(){this._colorHelp.init(88,186,219),this._colorBuilder.init(86,110.5,118.75),WXTool.is_relive=!1,WXTool._state==s.STATUS_END&&(this._app.uiRoot.general.close(PageDef.YOUXI_PAGE),this._curSore=0,this._isPlayJaSu=!1,this.speedEffect.particleSystem.looping=!1,this.speedEffect.particleSystem.stop(),this.mouse_X=0,this._cameraRoot.reset(),this.roadMgr.reset(),this.mainPlayer.playerScript.reset(),this._roadMgr&&(this._tempColor.x=this._colorHelp.r/255,this._tempColor.y=this._colorHelp.g/255,this._tempColor.z=this._colorHelp.b/255,this._tempBuilder.x=this._colorBuilder.r/255,this._tempBuilder.y=this._colorBuilder.g/255,this._tempBuilder.z=this._colorBuilder.b/255,this.roadMgr.init(this._tempColor,this._tempBuilder)),WXTool.reliveCount=0)},Object.defineProperty(s.prototype,"isShareLibao",{get:function(){return this._isShareLibao},set:function(t){this._isShareLibao=t},enumerable:!0,configurable:!0}),s.prototype.dispose=function(){this._cameraRoot&&(this._cameraRoot.destory(),this._cameraRoot=null),this._mainPlayer&&(this._mainPlayer.destroy(),this._mainPlayer=null),this.camera&&(this.camera.destroy(),this.camera=null),this.directionLight&&(this.directionLight.destroy(),this.directionLight=null),this.roadMgr&&this.roadMgr.clear(),this._scene&&(this._scene.destroy(!0),this._scene=null),Laya.loader.clearRes(c.Path.scene,!0),Laya.loader.clearUnLoaded(),Laya.SoundManager.stopAllSound()},s}(c.BaseScene);t.GAME_TOTAL_NUM=50,t.STATUS_NONE=0,t.STATUS_LOAD=1,t.STATUS_LOADED=2,t.STATUS_START=3,t.STATUS_END=4,t.STATUS_RELIFE=5,t.STATUS_OVER=6,c.SceneRoot=t}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(c){var t=function(u){function t(t){var e=u.call(this,t,c.Path.newraceshow)||this;e._lenghtOfRoad=0,e._diff_Z=0,e._changeSkinMoveZ=0,e._changeSkinState=0,e._nextSkin="",e._isTuoWeiLoad=!1,e.nextDiff=.01,e._diff_X=0,e.bendTimes=[1e4,1e4,1e4,1e4,1e4,1e4,1e4,1e4],e.curBendTime=0,e.dstIndex=0,e.changeTime=2e3,e.curBendAngle=new Laya.Vector4(149.99,43.61,0,0),e.material=new BlinnPhongMaterial,e.changeSkinPosEnd=.5,e._mapLayer=new Laya.Sprite3D,e.map_list=new Array;var i=new Laya.Vector4(-150,0,0,0),n=new Laya.Vector4(150,0,0,0),r=new Laya.Vector4(0,150,0,0),a=new Laya.Vector4(0,-0,0,0),s=new Laya.Vector4(-150,150,0,0),o=new Laya.Vector4(150,150,0,0),l=new Laya.Vector4(-150,-0,0,0),h=new Laya.Vector4(150,-0,0,0);return e.dstAangles=[i,n,r,a,s,l,o,h],e.pos1=new Laya.Vector3(0,0,0),e.pos2=new Laya.Vector3(1,0,0),e}return __extends(t,u),Object.defineProperty(t.prototype,"mapLayer",{get:function(){return this._mapLayer},enumerable:!0,configurable:!0}),t.prototype.initScene=function(){if(this._scene&&this._scene.loaded){this.playerOwner=this._scene.getChildByName("Player"),this.playerView=this.playerOwner.getChildByName("Player"),this.playerArrow=this.playerOwner.getChildByName("xrz01"),this.camera||(this.camera=this._scene.getChildByName("Main Camera")),this._distanceCP=this.playerOwner.transform.position.z-this.camera.transform.position.z,this._scene.addChild(this._mapLayer),this.initTuoWei(),this.initZhangAi(),PlayerBaseScript.shadowMaterial||(PlayerBaseScript.shadowMaterial=new c.scene.BlinnPhongMaterialExp,PlayerBaseScript.shadowMaterial.albedoTexture=Laya.Texture2D.load(c.Path.scene_texture+"shadow01.png"),PlayerBaseScript.shadowMaterial.renderMode=c.scene.BlinnPhongMaterialExp.RENDERMODE_TRANSPARENT);var t=new Laya.PlaneMesh(.15,.15,1,1);this.shadow=new MeshSprite3D(t),this.scene.addChild(this.shadow),this.shadow.meshRender.material=PlayerBaseScript.shadowMaterial,this.shadow.meshRender.enable=!0}},t.prototype.initTuoWei=function(){this._effectTuoWeiSence=Laya.loader.create(c.Path.tuoWei,Laya.Handler.create(this,this.onTuoWeiComplete),Handler.create(this,this.onLoadTuoWeiProgress))},t.prototype.initZhangAi=function(){},Object.defineProperty(t.prototype,"effectTuoWeiSence",{get:function(){return this._effectTuoWeiSence},enumerable:!0,configurable:!0}),t.prototype.onTuoWeiComplete=function(){this._isTuoWeiLoad=!0},t.prototype.onLoadTuoWeiProgress=function(t){},t.prototype.onUpdate=function(t){if(this._isShow){this._lenghtOfRoad-this.playerOwner.transform.position.z<30&&this.addRoad();for(var e=0;e<this.map_list.length;e++)this.map_list[e].update(t)&&(ObjectPools.free(this.map_list[e]),this.map_list.splice(e,1),e--);this.move(t)}},t.prototype.move=function(t){this._diff_Z+=.01,this.camera.transform.position.z=this._diff_Z-this._distanceCP,this.camera.transform.position=this.camera.transform.position,this.playerOwner.transform.position.z=this._diff_Z+this._changeSkinMoveZ,(this._diff_X<-.2||.2<this._diff_X)&&(this.nextDiff=-this.nextDiff),this._diff_X+=this.nextDiff,this.playerOwner.transform.position.x=this._diff_X+.3,this.playerOwner.transform.position=this.playerOwner.transform.position,TD.TD_Vector3_0.y=0,TD.TD_Vector3_0.z=0,TD.TD_Vector3_0.x=.1,this.playerView.transform.rotate(TD.TD_Vector3_0),this.playerArrow.parent&&this.playerArrow.transform.rotate(TD.TD_Vector3_0),this._glitter&&this._glitter.glitterRender.material instanceof c.scene.GlitterMaterialNew&&(this._glitter.glitterRender.material.setBendOffset(this.curBendAngle),this.pos2.z=this.pos1.z=this.playerOwner.transform.position.z,this.pos1.x=this.playerOwner.transform.position.x-.07,this.pos2.x=this.playerOwner.transform.position.x+.07,this.pos1.y=this.pos2.y=.006,this._glitter.addGlitterByPositions(this.pos1,this.pos2)),this.shadow&&this.shadow.meshRender.material instanceof c.scene.BlinnPhongMaterialExp&&(this.shadow.meshRender.material.setBendOffset(this.curBendAngle),this.shadow.transform.position.x=this.playerOwner.transform.position.x,this.shadow.transform.position.y=.008,this.shadow.transform.position.z=this.playerOwner.transform.position.z,this.shadow.transform.position=this.shadow.transform.position),this._isLizi&&this._effectTuoWei&&(this._effectTuoWei.transform.position.x=this.playerOwner.transform.position.x,this._effectTuoWei.transform.position.y=this.playerOwner.transform.position.y,this._effectTuoWei.transform.position.z=this.playerOwner.transform.position.z-("jianqi"==this._tuoWeiSkin?.3:0)),this.updateSkinPos()},t.prototype.RandBlendIndex=function(t){for(var e;(e=Math.floor(Math.random()*this.dstAangles.length))==t;);return e},t.prototype.addRoad=function(){var t=ObjectPools.malloc(Road1,[this],[this]);t.setOffset(0,0,this._lenghtOfRoad),t.init(c.Path.scene_model+"race_01-Plane001.lm",c.Path.scene_texture+"ground_010.jpg"),this.map_list.push(t),this._lenghtOfRoad+=12.7},t.prototype.updateSkinPos=function(){0!=this._changeSkinState&&(1==this._changeSkinState&&(this._changeSkinMoveZ+=.02,this._changeSkinMoveZ>this.changeSkinPosEnd&&(this._changeSkinState=2,this._changeSkinMoveZ=-this.changeSkinPosEnd,this.material.albedoTexture=Laya.Texture2D.load(StringU.substitute("scene/pifu/{0}.jpg",this._nextSkin)),this.material.shininess=.078,this.playerView.meshRender.material=this.material)),2==this._changeSkinState&&(this._changeSkinMoveZ+=.02,0<this._changeSkinMoveZ&&(this._changeSkinState=0,this._changeSkinMoveZ=0)))},t.prototype.changeBallSkin=function(t){this._scene&&this._scene.loaded&&(this._changeSkinState=1,"role29"==(this._nextSkin=t)?this.playerOwner.addChild(this.playerArrow):this.playerArrow.removeSelf())},t.prototype.changeTuoWeiSkin=function(t){if(this._tuoWeiSkin=t,this._glitter&&(this._glitter.destroy(),this._glitter=null),this.putBackEffectTuoWei(),this._effectTuoWei=this._effectTuoWeiSence.getChildByName(t),this._effectTuoWei)this._isLizi=!0;else{this._isLizi=!1,this._effectTuoWei=new Laya.Sprite3D,this._glitter=this._effectTuoWei.addChild(new Laya.Glitter);var e=this._glitter.templet;e.lifeTime=.52,e.minSegmentDistance=.1,e.minInterpDistance=.6,e.maxSlerpCount=128,e.maxSegments=600;var i=void 0;this._glitter.glitterRender.material&&((i=new c.scene.GlitterMaterialNew).renderMode=c.scene.GlitterMaterialNew.RENDERMODE_TRANSPARENT,i.diffuseTexture=Laya.Texture2D.load(StringU.substitute("scene/tuowei/{0}.png",t)),i.albedo=new Laya.Vector4(1.3,1.3,1.3,1)),this._glitter.glitterRender.material=i,this._glitter.glitterRender.enable=!0}this._effectTuoWei.transform.position=new Vector3,this._mParent=this._effectTuoWei.parent,this.scene.addChild(this._effectTuoWei)},t.prototype.putBackEffectTuoWei=function(){this._effectTuoWei&&this._effectTuoWei.parent&&(this._mParent?this._mParent.addChild(this._effectTuoWei):this.scene.removeChild(this._effectTuoWei),this._effectTuoWei=null)},t.prototype.hide=function(){this.putBackEffectTuoWei(),u.prototype.hide.call(this)},t}(c.BaseScene);c.ShowRoot=t}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(t){var e=function(i){function r(t){var e=i.call(this)||this;return e._serverTime=0,e._ost=0,e._systemRunTime=0,e._osrt=0,e._oserverRunt=0,e._serverStartTime=0,e._hasSyncTime=!0,e._syncLoss=0,e._app=t,e}return __extends(r,i),Object.defineProperty(r.prototype,"syncFunc",{get:function(){return this._syncFunc},enumerable:!0,configurable:!0}),r.prototype.syncSystemRunTime=function(t){this._systemRunTime=t,this._osrt=Laya.timer.currTimer},Object.defineProperty(r.prototype,"serverTimeBys",{get:function(){return this._hasSyncTime=!0,(new Date).getTime()/1e3},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"serverTimeByms",{get:function(){return this._hasSyncTime=!0,(new Date).getTime()},enumerable:!0,configurable:!0}),r.getHours=function(t){return this._date.setTime(t),this._date.getHours()},r.getTimeStr=function(t){return this._date.setTime(t),StringU.substitute("{0}-{1}-{2} {3}:{4}:{5}",this._date.getFullYear(),this._date.getMonth()+1,this._date.getDate(),StringU.paddingLeft(this._date.getHours().toString(),"0",2),StringU.paddingLeft(this._date.getMinutes().toString(),"0",2),StringU.paddingLeft(this._date.getSeconds().toString(),"0",2))},r.getTimeWeekDay=function(t){return this._date.setTime(t),this._date.getDay()},r.getDayTime=function(t){return this._date.setTime(t),60*this._date.getHours()*60+60*this._date.getMinutes()+this._date.getSeconds()},r.getTimeShortStr=function(t){return this._date.setTime(t),StringU.substitute("{0}:{1}:{2}",this._date.getHours(),this._date.getMinutes(),this._date.getSeconds())},r.getTimeShortStr2=function(t){var e=MathU.parseInt(t/3600);t=MathU.parseInt(t%3600);var i=MathU.parseInt(t/60),n=MathU.parseInt(t%60);return StringU.substitute("{0}:{1}:{2}",StringU.paddingLeft(e.toString(),"0",2),StringU.paddingLeft(i.toString(),"0",2),StringU.paddingLeft(n.toString(),"0",2))},r.getTimeShortStr3=function(t){var e=MathU.parseInt(t/60),i=MathU.parseInt(t%60);return StringU.substitute("{0}:{1}",StringU.paddingLeft(e.toString(),"0",2),StringU.paddingLeft(i.toString(),"0",2))},r.getIsToday=function(t,e){var i=r.getTimeStr(1e3*t).split(" ")[0],n=r.getTimeStr(1e3*e).split(" ")[0];return Boolean(i==n)},r.getDayZeroTime=function(t){return this._date.setTime(t),this._date.setHours(0,0,0,1),Math.floor(this._date.getTime()/1e3)},r.prototype.dispose=function(){},r}(Laya.EventDispatcher);e.TIME_SYNC="time_sync",e.SUNDAY=0,e.MONDAY=1,e.TUESDAY=2,e.WEDNESDAY=3,e.THURSDAY=4,e.FRIDAY=5,e.SATURDAY=6,e.DAY_SECONDS=86400,e.UTC_SECONDS=28800,e._date=new Date,t.Sync=e}(dou||(dou={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},dou;!function(e){var t=function(i){function t(t){var e=i.call(this,t)||this;return e._mouseLock=!1,e._needAssetReady=!1,e._loadUrls=["ui/tongyon/image_6.png","ui/tongyon/image_65.png"],e._preLoadUrls=[],e._appUIroot=t,MessageManager.on(WXTool.LOADOK,e,e.onInit),isDebug&&e.onInit(),e}return __extends(t,i),Object.defineProperty(t.prototype,"top",{get:function(){return this._topUI},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"general",{get:function(){return this._generalUI},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HUD",{get:function(){return this._HUD},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mouseLock",{set:function(t){this._mouseLock=t},enumerable:!0,configurable:!0}),t.prototype.onInit=function(){PageDef.init(),this._preLoad=this._app.preLoad,this._topUI=new e.gui.TopUI(this._appUIroot),this._generalUI=new e.gui.GeneralUI(this._appUIroot),this._HUD=new e.gui.HUD(this._appUIroot),this.addChild(this._HUD),this.addChild(this._generalUI),this.addChild(this._topUI),this.loadingWithoutLogin(),WXTool.login(),NumGroup.init(),this._app.plyertDataMgr.setCurWeekTime(),PlayerDataMgr.isPlayBgMusic&&console.log("播放背景音乐")},t.prototype.loadingWithoutLogin=function(){(new AssetsLoader).load([e.Path.uiAtlas+"tongyong.atlas",e.Path.skin+"skin_config.txt"],Handler.create(this,this.onNeedAssetLoaded))},t.prototype.onNeedAssetLoaded=function(){this._needAssetReady=!0,SkinConfig.init(Laya.loader.getRes(e.Path.skin+"skin_config.txt")),this.checkReady()},t.prototype.checkReady=function(){this._needAssetReady&&(this.event(t.INIT),this.general.open(PageDef.LOGO_PAGE))},t.prototype.onAssetLoadedComplete=function(){},t.prototype.onOpenPanel=function(t,e){e.open(t)},t.prototype.onClosePanel=function(t,e){0==t?e.closeAll():e.close(t)},t.prototype.onOperateResult=function(t){},t.prototype.isOpened=function(t){return this._generalUI.isOpened(t)},t.prototype.openSortPage=function(t){void 0===t&&(t=null),this._HUD.close(PageDef.RESTART_PAGE),t&&this.general.close(PageDef.TOP_PAGE);var e=PageDef.TOP_PAGE;this._app.plyertDataMgr.saveDataShare=t,console.log("this._app.plyertDataMgr.saveDataShare",this._app.plyertDataMgr.saveDataShare);var i=this.general.getPage(e);i&&i.isOpened?(console.log("yes"),i.setData(t)):(console.log("no"),this.general.open(e))},t.prototype.enterGame=function(){this._preLoad.on(LEvent.CHANGED,this,this.checkLoad);for(var t=0,e=this._preLoadUrls;t<e.length;t++){var i=e[t],n=RefAsset.Get(i,!1);n&&n.parseComplete||this._preLoad.load(i,RefAsset.GENRAL)}},t.prototype.checkLoad=function(){if(this._preLoad.loadCount==this._preLoad.totalCount){this._preLoad.off(LEvent.CHANGED,this,this.checkLoad);for(var t=0,e=this._preLoadUrls;t<e.length;t++){var i=e[t];this._preLoad.clear(i)}}},t.prototype.resize=function(t,e){this._clientWidth=t,this._clientHeight=e,this._topUI.resize(t,e),this._generalUI.resize(t,e),this._HUD.resize(t,e)},t.prototype.onKeyDown=function(t){},t.prototype.update=function(t){this._topUI.checkQueue()},t.prototype.onKeyEnter=function(){!this._topUI.enter()&&this._generalUI.enter()},t.prototype.onKeyESC=function(){!this._topUI.cancel()&&this._generalUI.cancel()},t}(e.gui.base.Container);t.MODE_PC=0,t.MODE_HORIZONTAL=1,t.MODE_VERTICAL=2,t.KEYCODE_A=65,t.KEYCODE_Q=81,t.KEYCODE_Z=90,t.KEYCODE_V=86,t.KEYCODE_ESC=27,t.KEYCODE_M=77,t.KEYCODE_SPAPCE=32,t.KEYCODE_TAB=9,t.KEYCODE_ENTER=13,t.KEYCODE_UP=38,t.KEYCODE_DOWN=40,t.KEYCODE_LEFT=37,t.KEYCODE_RIGHT=39,t.INIT="init",e.UIRoot=t}(dou||(dou={}));var Stage=Laya.Stage,Sprite=Laya.Sprite,Graphics=Laya.Graphics,TextInput=Laya.TextInput,TextArea=Laya.TextArea,Button=Laya.Button,Box=Laya.Box,ProgressBar=Laya.ProgressBar,List=Laya.List,LImage=Laya.Image,Label=Laya.Label,Socket=Laya.Socket,Loader=Laya.Loader,HttpRequest=Laya.HttpRequest,LocalStorage=Laya.LocalStorage,Texture=Laya.Texture,Templet=Laya.Templet,Skeleton=Laya.Skeleton,Byte=Laya.Byte,Handler=Laya.Handler,Browser=Laya.Browser,Dictionary=Laya.Dictionary,Matrix=Laya.Matrix,Rectangle=Laya.Rectangle,Point=Laya.Point,LEvent=Laya.Event,EventDispatcher=Laya.EventDispatcher,SoundManager=Laya.SoundManager,GlowFilter=Laya.GlowFilter,ColorFilter=Laya.ColorFilter,Animation=Laya.Animation,AnimationPlayer=Laya.AnimationPlayer,Timer=laya.utils.Timer,Vector3=Laya.Vector3,Vector4=Laya.Vector4,MeshSprite3D=Laya.MeshSprite3D,MeshCollider=Laya.MeshCollider,Glitter=Laya.Glitter,BlinnPhongMaterial=Laya.BlinnPhongMaterial,Path=dou.Path,UIRoot=dou.UIRoot,BlackBorder=dou.BlackBorder,Sync=dou.Sync,LMiniAdpter=Laya.MiniAdpter,TD=dou.utils.TD,ObjectPools=dou.utils.ObjectPools,StringU=dou.utils.StringU,Vesion=dou.utils.Vesion,Vector2=dou.utils.Vector2,MathU=dou.utils.MathU,TextFieldU=dou.utils.TextFieldU,DisplayU=dou.utils.DisplayU,TeaStyle=dou.utils.TeaStyle,Template=dou.data.Template,AssetsLoader=dou.data.AssetsLoader,RefAsset=dou.data.RefAsset,PreLoad=dou.data.PreLoad,PageDef=dou.gui.page.PageDef,Page=dou.gui.base.Page,TabPage=dou.gui.base.TabPage,TabBox=dou.gui.base.TabBox,Grid=doc.gui.component.Grid,TemplateGrid=doc.gui.component.TemplateGrid,TemplateInfoGrid=doc.gui.component.TemplateInfoGrid,TweenBtnEff=dou.gui.component.TweenBtnEff,EffectLayer=dou.scene.EffectLayer,Effect=dou.scene.Effect,EffectFrame=dou.scene.EffectFrame,Camera=dou.scene.Camera,PlayerMeshSprite3D=dou.scene.PlayerMeshSprite3D,RobotMeshSprite3D=dou.scene.RobotMeshSprite3D,PlayerBaseScript=dou.scene.PlayerBaseScript,CameraMove=dou.scene.CameraMove,BaseBuilder=dou.scene.builder.BaseBuilder,Road=dou.scene.builder.Road,Road1=dou.scene.builder.Road1,Builder=dou.scene.builder.Builder,XiePo=dou.scene.builder.XiePo,SpeedAdd=dou.scene.builder.SpeedAdd,ColorBall=dou.scene.builder.ColorBall,SuperBall=dou.scene.builder.SuperBall,Cast_Arrow=dou.scene.builder.Cast_Arrow,Diamond=dou.scene.builder.Diamond,SlowNet=dou.scene.builder.SlowNet,MusicBall=dou.scene.builder.MusicBall,MultipleBall=dou.scene.builder.MultipleBall,EffectMgr=dou.scene.EffectMgr,RoadMgr=dou.scene.BuilderMgr,BaseScene=dou.BaseScene,SceneRoot=dou.SceneRoot,ShowRoot=dou.ShowRoot,PlayerDataMgr=dou.managers.PlayerDataMgr,LocalStorageMgr=dou.managers.LocalStorageMgr,NumGroup=doc.gui.component.NumGroup,MyList=dou.gui.component.MyList,ClipUtil=dou.gui.base.ClipUtil,logd_o=!1,logw_o=!1,loge_o=!1,logl_o=!1,isDebug=!0;function logd(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.unshift("[D]"),console.debug(t.join(" "))}function logw(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];logw_o&&(t.unshift("[W]"),console.warn(t.join(" ")))}function loge(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];loge_o&&(t.unshift("[E]"),console.error(t.join(" ")))}function logl(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];logl_o&&(t.unshift("[L]"),console.log(t.join(" ")))}var Zlib=window.Zlib,JSZip=window.JSZip,Launch=function(){function t(){var e=this;if(this.SCENE_WIDTH=720,this.SCENE_HEIGHT=1280,this._clientWidth=0,this._clientHeight=0,this._clientScale=1,this._apps=[],this._browserClientWidth=0,this._browserClientHeight=0,this._lockOrientation=!0,LMiniAdpter.init(!0),WXTool.loadFenbao(),console.log("初始-----",Browser.onIPhone,Browser.clientWidth,Browser.clientHeight,Browser.pixelRatio),isDebug=-1!=location.href.indexOf("index.html")&&-1==location.href.indexOf("game.js")&&-1==location.href.indexOf("gamePage.html"),Browser.onIPhone&&Math.abs(Browser.pixelRatio-3)<.01&&(onIPhoneX=375==Browser.clientWidth&&812==Browser.clientHeight||812==Browser.clientWidth&&375==Browser.clientHeight),onIPhoneX?Laya3D.init(Browser.clientWidth*Browser.pixelRatio,Browser.clientHeight*Browser.pixelRatio,!0):Laya3D.init(this.SCENE_WIDTH,this.SCENE_HEIGHT,!0),WXTool.init(),Laya.stage.scaleMode="showall",Laya.stage.screenMode=Stage.SCREEN_VERTICAL,Laya.stage.alignH="center",Laya.stage.alignV="middle",Loader.typeMap.data=Loader.BUFFER,Loader.typeMap.bin=Loader.BUFFER,Config.isAntialias=!0,Vesion.httpsProtocol=0==location.href.indexOf("https://"),Browser.httpProtocol){var t=location.href;""!=StringU.getParameter(t,"log")?logd_o=logw_o=loge_o=logl_o=!0:(logd_o=""!=StringU.getParameter(t,"logd"),logw_o=""!=StringU.getParameter(t,"logw"),loge_o=""!=StringU.getParameter(t,"loge"),logl_o=""!=StringU.getParameter(t,"logl")),-1!=t.indexOf("192.168.")&&(ObjectPools.mold=ObjectPools.MOLD_DEBUG_STRICT,logd_o=logw_o=loge_o=logl_o=!0)}else logd_o=logw_o=loge_o=logl_o=!0,ObjectPools.mold=ObjectPools.MOLD_DEBUG_STRICT;logd_o=logw_o=loge_o=logl_o=!0,Browser.onPC||(0==window.orientation?Laya.stage.screenMode=Stage.SCREEN_VERTICAL:90!=window.orientation&&-90!=window.orientation||(Laya.stage.screenMode=Stage.SCREEN_HORIZONTAL),window.addEventListener("orientationchange",function(t){e.lockOrientation=!1,Laya.stage.screenMode=Stage.SCREEN_NONE})),Vesion.once(Vesion.LOAD_DATA_COMPLETE,this,function(){e.init()}),ClipUtil.init(),Vesion.loadVesionFile(),WXTool.getYXinfo()}return Object.defineProperty(t.prototype,"clientWidth",{get:function(){return this._clientWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clientHeight",{get:function(){return this._clientHeight},enumerable:!0,configurable:!0}),t.prototype.init=function(){this._app=new GameApp,this._apps.push(this._app),this._app.pageVisibility="***",MessageManager.on(WXTool.LOADOK,this,this.onInitData),isDebug&&this.onInitData(),Laya.Stat.show()},t.prototype.onInitData=function(){Laya.timer.frameLoop(1,this,this.onUpdate),Laya.stage.on(LEvent.RESIZE,this,this.onResize),this.onResize()},t.prototype.onUpdate=function(){var t=Laya.timer.currTimer,e=t-this._prevUpdateTimer;if(this._prevUpdateTimer=t,e){for(var i=0,n=this._apps;i<n.length;i++){n[i].onUpdate(e)}ObjectPools.update(e),RefAsset.update(e)}},t.prototype.getDistance=function(t){var e=0;if(t&&2==t.length){var i=t[0].stageX-t[1].stageX,n=t[0].stageY-t[1].stageY;e=Math.sqrt(i*i+n*n)}return e},t.prototype.onResize=function(){for(var t=Laya.stage.width,e=Laya.stage.height,i=0,n=this._apps;i<n.length;i++){n[i].onResize(t,e)}},Object.defineProperty(t.prototype,"lockOrientation",{set:function(t){this._lockOrientation=t},enumerable:!0,configurable:!0}),t}(),main=new Launch;