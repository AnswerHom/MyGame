{
  "code": "import { Ball } from \"./scene/Ball\";\r\nimport { GameApp } from \"./GameApp\";\r\nexport class SceneRoot extends Laya.Scene3D {\r\n    constructor() {\r\n        super();\r\n        this.gameState = 0;\r\n        this._isMouseDown = false;\r\n        this._ballList = [];\r\n        this._camera = this.addChild(new Laya.Camera(0, 0.1, 100));\r\n        this._camera.transform.rotate(new Laya.Vector3(-15, 0, 0), true, false);\r\n        var directionLight = new Laya.DirectionLight();\r\n        this.addChild(directionLight);\r\n        directionLight.color = new Laya.Vector3(0.6, 0.6, 0.6);\r\n        var mat = directionLight.transform.worldMatrix;\r\n        mat.setForward(new Laya.Vector3(-1.0, -1.0, -1.0));\r\n        directionLight.transform.worldMatrix = mat;\r\n    }\r\n    get mainPlayer() {\r\n        return this._mainPlayer;\r\n    }\r\n    ballDead(ball) {\r\n        if (ball.isMainPlayer) {\r\n            this.event(SceneRoot.EVENT_MAINPLAYER_DEAD);\r\n        }\r\n        let index = this._ballList.indexOf(ball);\r\n        if (index >= 0)\r\n            this._ballList.splice(index, 1);\r\n        ball.clear();\r\n        Laya.Pool.recover(Ball.poolName, ball);\r\n    }\r\n    startGame() {\r\n        GameApp.instance.mapManager.clear();\r\n        this.gameState = SceneRoot.STATE_START;\r\n        GameApp.instance.mapManager.createGround(3);\r\n        this.addMainPlayer();\r\n    }\r\n    addMainPlayer() {\r\n        if (!this._mainPlayer) {\r\n            this._mainPlayer = new Ball();\r\n        }\r\n        this._mainPlayer.isMainPlayer = true;\r\n        this._mainPlayer.setPos(0, 0.5, 0);\r\n        this.onAddMainPlayer();\r\n    }\r\n    onAddMainPlayer() {\r\n        GameApp.instance.mapManager.setMainPlayer = this._mainPlayer;\r\n        this.addChild(this._mainPlayer);\r\n        this._ballList.push(this._mainPlayer);\r\n    }\r\n    update(diff) {\r\n        if (this.gameState != SceneRoot.STATE_START)\r\n            return;\r\n        GameApp.instance.mapManager && GameApp.instance.mapManager.update(diff);\r\n        if (this._ballList) {\r\n            let len = this._ballList.length;\r\n            for (let i = 0; i < len; i++) {\r\n                let ball = this._ballList[i];\r\n                ball && ball.update(diff);\r\n            }\r\n        }\r\n        if (this._camera && this._mainPlayer && this._mainPlayer.parent) {\r\n            let pos = this._camera.transform.position;\r\n            let playerPos = this._mainPlayer.transform.position;\r\n            pos.setValue(0, playerPos.y + 6, playerPos.z + 9.5);\r\n            this._camera.transform.position = pos;\r\n        }\r\n    }\r\n    onMouseDown() {\r\n        this._isMouseDown = true;\r\n        this._startX = Laya.stage.mouseX;\r\n    }\r\n    onMouseUp() {\r\n        this._isMouseDown = false;\r\n    }\r\n    onMouseMove() {\r\n        if (!this._isMouseDown || !this._mainPlayer)\r\n            return;\r\n        let diff = Laya.stage.mouseX - this._startX;\r\n        this._startX = Laya.stage.mouseX;\r\n        if (Math.abs(diff) >= 0.1) {\r\n            let pos = this._mainPlayer.transform.position;\r\n            pos.x += diff * (15 / Laya.Browser.width);\r\n            this._mainPlayer.transform.position = pos;\r\n        }\r\n    }\r\n}\r\nSceneRoot.EVENT_MAINPLAYER_DEAD = \"Dead\";\r\nSceneRoot.STATE_OVER = 0;\r\nSceneRoot.STATE_START = 1;\r\n",
  "references": [
    "D:/work/MyGame/BallGame/src/game/scene/Ball.ts",
    "D:/work/MyGame/BallGame/src/game/manager/MapManager.ts",
    "D:/work/MyGame/BallGame/src/game/GameApp.ts"
  ]
}
